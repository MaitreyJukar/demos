!function(){"use strict";MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab=MathInteractives.Common.Player.Views.Base.extend({directionTextView:null,isFocusOnCanvas:!1,isFirstTab:!0,accessibilityFlagForSnapping:!1,startButtonView:null,nextButonView:null,spriteImagePath:null,animationImagePath:[],shapeViews:[],showTryAnother:!1,boundingBox:null,circleGroup:null,boundingBoxGroup:null,rasterCircleGroup:null,isMouseDownOnElement:!1,tooltipView:null,currentSnappedShapeView:null,previousItem:null,previousItemModel:null,currentTool:null,paperScope:null,isRotationClockwise:!0,negativeFeedbackRoadRepairedPopup:null,flagForWrongPath:!0,$animationScreen:null,masterGroup:null,canvasAcc:null,orderShapesCalled:!1,initialize:function(){this.initializeDefaultProperties();var a=this.model;this._initializePaperScope(),this.render(),MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile||a.on("change:cursor",this._changeCursor,this),this._setHelpElements(),this.createTooltip();var b=MathInteractives.Common.Components.Theme2.Views.Tooltip.EVENTS.TOOLTIP_HIDE_ON_CLOSEBTN_CLICK,c=MathInteractives.Common.Components.Theme2.Views.Tooltip.EVENTS.TOOLTIP_HIDE_ON_DOCUMENT_CLICK;this.listenTo(this.tooltipView,b,this._changeAnglesColor),this.listenTo(this.tooltipView,c,this._changeAnglesColor),this.player.bindTabChange(function(a){a.isLetsGoClicked!==!0&&this.setFocus(this.model.get("animationComplete")?"direction-text-container-direction-text-text":"repair-road-activity-area"),this.updateFocusRect("direction-text-container-direction-text-text")},this,1),this.model.get("activityComplete")&&(this._showHideNextButton(!0),this.player.enableHelpElement("activity-canvas",0,!1),this.player.enableHelpElement("activity-canvas",1,!1))},_initializePaperScope:function(){this.paperScope=new paper.PaperScope,this.paperScope.setup(this.idPrefix+"activity-canvas"),this.currentTool=new this.paperScope.Tool,this.currentTool.onMouseDrag=function(a){a.preventDefault()},this.paperScope.activate()},render:function(){this.loadScreen("repair-roads-screen"),this.loadScreen("acc-string-screen"),this._preloadImagePaths(),this._setBackground(),this._initializeDirectionText(),this._renderStartButton(),this._renderEntirePath(),this._renderNextButton(),this._renderBackgroundArea(),this.model.set("numberOfAngles",{}),this._initializeShapes(),this.model.get("animationComplete")?this.$(".canvas-container").show():this._setAnimationScreen(),this.listenToOnce(this,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_CLICKED,function(){this.showTryAnother=!0}),this._bindActivityListeners(),this.bindChangeEvents(),this._bindActivityCompleteEvent(),this.loadScreen("button-acc-screen"),this._loadCanvasForAcc()},_bindActivityListeners:function(){this.listenToOnce(this,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACTIVITY_COMPLETE,function(){this.showTryAnother=!1,this._changeBackground(),this._createRoadRepairedPopup(),this.canvasAcc.updatePaperItems([]),this.player.enableHelpElement("activity-canvas",0,!1),this.player.enableHelpElement("activity-canvas",1,!1)}),this.listenToOnce(this,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ZSHAPE_WRONG_ACTIVITY_COMPLETE,function(){this._createNegativeFeedbackRoadRepairedPopup()})},bindChangeEvents:function(){var a=this;this.model.on("change:snappedToX",$.proxy(a.changeSnappedPath,a)),this.model.on("change:snappedToY",$.proxy(a.changeSnappedPath,a)),this.model.on("change:snappedToWrongX",$.proxy(a.changeSnappedToWrongPath,a)),this.model.on("change:snappedToWrongY",$.proxy(a.changeSnappedToWrongPath,a)),this.model.on("change:roadComplete",$.proxy(a.changeActivityComplete,a)),this.model.on("change:snappedToPath",$.proxy(a.changeActivityComplete,a)),this.model.on("change:snappedToWrongPath",$.proxy(a.changeActivityComplete,a))},_initializeDirectionText:function(){var a={containerId:this.idPrefix+"direction-text-container",idPrefix:this.idPrefix,player:this.player,manager:this.manager,path:this.filePath,text:this.getMessage("direction-text-box-text",0),accText:this.getMessage("direction-text-box-text",0),showButton:!0,buttonText:this.getMessage("direction-text-box-text",1),btnColorType:MathInteractives.global.Theme2.Button.COLORTYPE.GREEN,clickCallback:{fnc:this._onTryAnotherClick,scope:this},btnBaseClass:"green-button",ttsBaseClass:"tts-green-button",containmentBGcolor:"rgba(0, 0, 0, 0)",textColor:"#FFFFFF",tabIndex:530,buttonTabIndex:1e3};this.directionTextView=MathInteractives.global.Theme2.DirectionText.generateDirectionText(a),this.showHideDirectionText(this.model.get("animationComplete"))},showHideDirectionText:function(a){a?(this.directionTextView.$el.show(),this.enableTab("repair-road-activity-area",!1),this.updateFocusRect("direction-text-container-direction-text-text")):(this.enableTab("repair-road-activity-area",!0),this.directionTextView.$el.hide())},_renderStartButton:function(){var a={idPrefix:this.idPrefix,player:this.player,manager:this.manager,path:this.filePath,data:{id:this.idPrefix+"start-button-container",text:this.getMessage("button-text",0),type:MathInteractives.global.Theme2.Button.TYPE.TEXT,baseClass:"green-button"}};this.startButtonView=new MathInteractives.global.Theme2.Button.generateButton(a),this.startButtonView.$el.on("click.start-button",$.proxy(this.onStartClick,this)),this.showHideStartButton(!this.model.get("animationComplete"))},showHideStartButton:function(a){a?this.startButtonView.showButton():this.startButtonView.hideButton()},_showHideNextButton:function(a){if(a){var b,c=this.model.get("pathDisplayed"),d=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ROADTYPES;c===d.RECTANGLESHAPED?(b=this.getMessage("button-text-next",1),this.nextButtonView.changeText(b),this.changeAccMessage("next-button-container",0,[b])):c===d.ZSHAPED&&(b=this.getMessage("button-text-next",0),this.nextButtonView.changeText(b),this.changeAccMessage("next-button-container",0,[b])),this.nextButtonView.showButton()}else this.nextButtonView.hideButton()},onStartClick:function(){this.showHideStartButton(!1),this._playAnimation()},_onTryAnotherClick:function(){MathInteractives.global.SpeechStream.stopReading(),this.showTryAnother?this._showPopup():this._onClikedTryAnotherYes()},_showPopup:function(){var a={text:this.getMessage("pop-up-text",1),manager:this.manager,player:this.player,path:this.filePath,idPrefix:this.idPrefix,title:this.getMessage("pop-up-text",0),type:MathInteractives.global.Theme2.PopUpBox.CONFIRM,buttons:[{id:"pop-up-ok",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("pop-up-text",2),clickCallBack:{fnc:this._onClikedTryAnotherYes,scope:this},response:{isPositive:!0,buttonClicked:"pop-up-ok"}},{id:"pop-up-cancel",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("pop-up-text",3),clickCallBack:{fnc:this._onClikedTryAnotherCancel,scope:this},response:{isPositive:!0,buttonClicked:"pop-up-cancel"}}]};MathInteractives.global.Theme2.PopUpBox.createPopup(a)},_createRoadRepairedPopup:function(){this.roadRepairedPopup&&(this.roadRepairedPopup.unbind(),this.roadRepairedPopup.remove(),this.roadRepairedPopup.model.destroy()),this.roadRepairedPopup=MathInteractives.global.Theme2.PopUpBox.createPopup({text:this.getMessage("repair-road-feedback-msg",0),manager:this.manager,player:this.player,path:this.filePath,idPrefix:this.idPrefix,title:this.getMessage("repair-road-feedback-title",0),bodyTextColorClass:"repair-road-feedback-msg-text",titleTextColorClass:"repair-road-feedback-title-text",buttons:[{id:"pop-up-ok",text:this.getMessage("feedback-ok-button",0),baseClass:"green-button",clickCallBack:{fnc:this._repairRoadPopupClosed,scope:this}}],backgroundImage:{imageId:"picture-perfect-image",imageHeight:424,imageWidth:479},backgroundImageBackgroundPosition:"0 -2400px"}),this.roadRepairedPopup.adjustBackgroundImgPos({top:159,left:27});var a=MathInteractives.Common.Utilities.Models.BrowserCheck;a.isIOS?(this.roadRepairedPopup.$(".theme2-pop-up-tts-container-defaultType").addClass("tts-ios"),this.roadRepairedPopup.$(".theme2-pop-up-title").addClass("tts-ios-title")):this.roadRepairedPopup.$(".theme2-pop-up-tts-container-defaultType").addClass("tts-others"),this.setFocus("theme2-pop-up-title-text-combined-acc",250),this.tooltipView.hideTooltip(),this.tooltipView.trigger(MathInteractives.Common.Components.Theme2.Views.Tooltip.EVENTS.TOOLTIP_HIDE_ON_CLOSEBTN_CLICK)},_createNegativeFeedbackRoadRepairedPopup:function(){this.negativeFeedbackRoadRepairedPopup&&(this.negativeFeedbackRoadRepairedPopup.unbind(),this.negativeFeedbackRoadRepairedPopup.remove(),this.negativeFeedbackRoadRepairedPopup.model.destroy()),this.negativeFeedbackRoadRepairedPopup=MathInteractives.global.Theme2.PopUpBox.createPopup({text:this.getMessage("negative-repair-road-feedback-msg",0),manager:this.manager,player:this.player,path:this.filePath,idPrefix:this.idPrefix,title:this.getMessage("negative-repair-road-feedback-title",0),accTitle:this.getAccMessage("negative-repair-road-feedback-title",0),bodyTextColorClass:"repair-road-feedback-msg-text",titleTextColorClass:"repair-road-negative-feedback-title-text",buttons:[{id:"pop-up-ok",text:this.getMessage("feedback-ok-button",0),baseClass:"green-button",clickCallBack:{fnc:this._negativeRepairRoadPopupClosed,scope:this}}],backgroundImage:{imageId:"picture-perfect-image",imageHeight:424,imageWidth:479},backgroundImageBackgroundPosition:"0 -2400px"}),this.negativeFeedbackRoadRepairedPopup.adjustBackgroundImgPos({top:159,left:27}),this.negativeFeedbackRoadRepairedPopup.$(".theme2-pop-up-body").addClass("repair-road-negative-feedback-body"),this.negativeFeedbackRoadRepairedPopup.$(".theme2-pop-up-title").addClass("repair-road-negaitive-feedback-popup-title"),this.negativeFeedbackRoadRepairedPopup.$(".theme2-pop-up-title-text-combined-acc-defaultType").addClass("repair-road-update-focus-for-negative-feedback");var a=MathInteractives.Common.Utilities.Models.BrowserCheck;a.isIOS?(this.negativeFeedbackRoadRepairedPopup.$(".theme2-pop-up-tts-container-defaultType").addClass("tts-ios repair-road-negaitive-tts"),this.negativeFeedbackRoadRepairedPopup.$(".theme2-pop-up-title").addClass("tts-ios-title repair-road-negaitive-tts")):this.negativeFeedbackRoadRepairedPopup.$(".theme2-pop-up-tts-container-defaultType").addClass("tts-others repair-road-negaitive-tts"),this.setFocus("theme2-pop-up-title-text-combined-acc",250),this.tooltipView.hideTooltip(),this.tooltipView.trigger(MathInteractives.Common.Components.Theme2.Views.Tooltip.EVENTS.TOOLTIP_HIDE_ON_CLOSEBTN_CLICK)},_repairRoadPopupClosed:function(){this._showHideNextButton(!0);var a,b=this.model.get("pathDisplayed"),c=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ROADTYPES;b===c.RECTANGLESHAPED?a=this.getMessage("button-text-next",1):b===c.ZSHAPED&&(a=this.getMessage("button-text-next",0)),this.changeAccMessage("canvas-acc-container",7,[a]),this.setFocus("canvas-acc-container")},_negativeRepairRoadPopupClosed:function(){this.setAccMessage("canvas-acc-container",""),this.setFocus("canvas-acc-container")},_renderNextButton:function(){var a={idPrefix:this.idPrefix,player:this.player,manager:this.manager,path:this.filePath,data:{id:this.idPrefix+"next-button-container",text:this.getMessage("button-text-next",0),type:MathInteractives.global.Theme2.Button.TYPE.TEXT,baseClass:"green-button"}};this.nextButtonView=new MathInteractives.global.Theme2.Button.generateButton(a),this.nextButtonView.$el.on("click.next-button",$.proxy(this._onTryAnotherClick,this)),this._showHideNextButton(!1)},_setAnimationScreen:function(){this.$animationScreen=$(MathInteractives.Interactivities.PicturePerfect.templates.animation({idPrefix:this.idPrefix})),this.$(".repair-road-activity-area").append(this.$animationScreen);{var a=(this.$("canvas"),this.$(".meteor-animation-screen-1")),b=this.$(".meteor-animation-screen-2"),c=this.$(".meteor-animation-screen-3");this.$(".red-animation-modal")}a.css({"background-image":'url("'+this.animationImagePath[0]+'")'}),b.css({"background-image":'url("'+this.animationImagePath[1]+'")'}),c.css({"background-image":'url("'+this.animationImagePath[2]+'")'})},_onClikedTryAnotherYes:function(){this.showTryAnother=!1,this.showHideStartButton(!0),this._showHideNextButton(!1),this.showHideDirectionText(!1),this._changePath(),this.model.set("animationComplete",!1),this._setAnimationScreen(),this._changeBackground(),this._clearCanvas(),this._clearZombies(),this.model.set("roadComplete",!1),this.model.set("activityComplete",!1),this.model.set("wrongActivityComplete",!1),this._bindActivityListeners(),this.paperScope.activate(),this.model.initializeShapeCollection(),this._renderEntirePath(),this._renderBackgroundArea(),this.model.set("numberOfAngles",{}),this.model.set("orderOfShapeGroups",[]),this.model.set("numberOfShapeGroupChildren",{}),this.model.set("lastSelectedShapeGroup",null),this._initializeShapes(),this.setFocus("repair-road-activity-area"),this.flagForWrongPath=!0,this.listenToOnce(this,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_CLICKED,function(){this.showTryAnother=!0});var a,b=this.model.get("pathDisplayed"),c=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ROADTYPES,d=MathInteractives.global.Theme2.Tooltip;b===c.RECTANGLESHAPED?(a=d.ARROW_TYPE.TOP_MIDDLE,this.$(".dummy-tooltip-div").addClass("rect-shape-road"),this.$(".dummy-tooltip-div").removeClass("z-shape-road")):b===c.ZSHAPED&&(a=d.ARROW_TYPE.BOTTOM_MIDDLE,this.$(".dummy-tooltip-div").addClass("z-shape-road"),this.$(".dummy-tooltip-div").removeClass("rect-shape-road")),this.tooltipView&&this.tooltipView.setArrowType(a),this.player.enableHelpElement("activity-canvas",0,!0),this.player.enableHelpElement("activity-canvas",1,!0),this.canvasAcc.updatePaperItems(this.getPaperObjects())},_onClikedTryAnotherCancel:function(){this.setFocus("direction-text-container-direction-text-buttonholder")},_changePath:function(){var a=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ROADTYPES;this.model.get("pathDisplayed")===a.RECTANGLESHAPED?this.model.set("pathDisplayed",a.ZSHAPED):this.model.set("pathDisplayed",a.RECTANGLESHAPED)},_preloadImagePaths:function(){this.spriteImagePath=this.getImagePath("picture-perfect-image");for(var a=1;3>=a;a++)this.animationImagePath.push(this.getImagePath("picture-perfect-animation-"+a))},_setBackground:function(){this.$el.css({"background-image":'url("'+this.spriteImagePath+'")'}),this._changeBackground()},_changeBackground:function(){var a=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,b=a.BACKGROUND_CLASSES,c=this.model.get("animationComplete")&&!this.model.get("activityComplete");this.model.get("pathDisplayed")===a.ROADTYPES.RECTANGLESHAPED?c?(this.$el.removeClass(b.RECTANGLE+" "+b.BROKEN_ZIGZAG+" "+b.ZIGZAG).addClass(b.BROKEN_RECTANGLE),this.changeAccMessage("canvas-acc-container",0,[this.getAccMessage("type-of-path",1),this.model.get("shapeCollection").length])):(this.$el.removeClass(b.BROKEN_ZIGZAG+" "+b.ZIGZAG+" "+b.BROKEN_RECTANGLE).addClass(b.RECTANGLE),this.changeAccMessage("repair-road-activity-area",0,[this.getAccMessage("type-of-path",1)])):c?(this.$el.removeClass(b.ZIGZAG+" "+b.BROKEN_RECTANGLE+" "+b.RECTANGLE).addClass(b.BROKEN_ZIGZAG),this.changeAccMessage("canvas-acc-container",0,[this.getAccMessage("type-of-path",0),this.model.get("shapeCollection").length])):(this.$el.removeClass(b.BROKEN_RECTANGLE+" "+b.RECTANGLE+" "+b.BROKEN_ZIGZAG).addClass(b.ZIGZAG),this.changeAccMessage("repair-road-activity-area",0,[this.getAccMessage("type-of-path",0)]))},_playAnimation:function(){var a=(this.$("canvas"),this.$(".meteor-animation-screen-1")),b=this.$(".meteor-animation-screen-2"),c=this.$(".meteor-animation-screen-3"),d=this.$(".red-animation-modal");this.player.enableHeaderButtons(!1);var e=this,f=-599,g=0,h=.02,i=1,j=setInterval(function(){switch(i){case 1:f>-4100?(a.css({"background-position":"0px "+f+"px"}),d.css({opacity:g}),f-=599,g+=h):(i++,a.css({"background-position":"0px "+f+"px"}),b.css({"background-position":"0px -599px"}),f=-1198);break;case 2:f>-4100?(b.css({"background-position":"0px "+f+"px"}),d.css({opacity:g}),f-=599,g+=h):(i++,b.css({"background-position":"0px "+f+"px"}),c.css({"background-position":"0px -599px"}),f=-1198);break;case 3:if(f>-3500)c.css({"background-position":"0px "+f+"px"}),d.css({opacity:g}),f-=599,d.fadeOut(400,function(){d.remove()});else{clearInterval(j);var k=!1;c.fadeOut({duration:1e3,step:function(){k||(e.model.set("animationComplete",!0),e._changeBackground(),e.$(".canvas-container").fadeIn(),k=!0)},complete:function(){e.$animationScreen.remove(),e.showHideDirectionText(!0),e.player.enableHeaderButtons(!0),e.setFocus("direction-text-container-direction-text-text"),e.trigger(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ANIMATION_COMPLETE)}})}}},50)},_renderEntirePath:function(){this.model.get("pathDisplayed")===MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ROADTYPES.RECTANGLESHAPED?this._generateRectangularPath():this._generateZigzagPath()},_generateRectangularPath:function(){var a=MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab,b=this.model.get("rectPathCoordinates"),c=this._generatePath([{x:0,y:0},{x:a.CANVAS_SIZE.WIDTH,y:0},{x:a.CANVAS_SIZE.WIDTH,y:a.CANVAS_SIZE.HEIGHT},{x:0,y:a.CANVAS_SIZE.HEIGHT}]),d=this._generatePath(b.outerRectCoordinates),e=this._generatePath(b.innerRectCoordinates);this.entirePath=new this.paperScope.CompoundPath({children:[c,d,e],fillColor:new this.paperScope.Color(0,0,1,0)})},_generatePath:function(a){for(var b=new this.paperScope.Path,c=0,d=a.length;d>c;c++)b.add(new this.paperScope.Point(a[c].x,a[c].y));return b.closed=!0,b},_generateZigzagPath:function(){var a=MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab,b=this.model.get("zPathCoordinates"),c=this._generatePath([{x:0,y:0},{x:a.CANVAS_SIZE.WIDTH,y:0},{x:a.CANVAS_SIZE.WIDTH,y:a.CANVAS_SIZE.HEIGHT},{x:0,y:a.CANVAS_SIZE.HEIGHT}]),d=this._generatePath(b);this.entirePath=new this.paperScope.CompoundPath({children:[c,d],fillColor:new this.paperScope.Color(0,1,0,0)})},_renderBackgroundArea:function(){var a=this,b=MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab,c=new this.paperScope.Point(0,0),d=new this.paperScope.Size(b.CANVAS_SIZE.WIDTH,b.CANVAS_SIZE.HEIGHT),e=new this.paperScope.Path.Rectangle(c,d);e.fillColor=new this.paperScope.Color(0,0),e.on("click",function(c){1!==c.event.which&&0!==c.event.which&&!MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile||a.isMouseDownOnElement||a.trigger(b.EVENTS.BACKGROUND_CLICKED)})},_initializeShapes:function(){var a,b,c=this.model.get("shapeCollection"),d=c.length,e=c.models,f=MathInteractives.Interactivities.PicturePerfect.Views.Shape;this._clearAllViews(),this.masterGroup&&this.masterGroup.remove(),this.masterGroup=new this.paperScope.Group;for(var g=0;d>g;g++)b=e[g],a=new f({model:b,paperScope:this.paperScope,currentTool:this.currentTool,collection:c,repairRoadsView:this,entirePath:this.entirePath}),this.shapeViews.push(a),this.masterGroup.addChild(b.get("paperGroupElem"));this._initiallyOrderShapes(),this.paperScope.view.draw(),this.trigger(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_GENERATION_COMPLETE)},_clearCanvas:function(){this.paperScope.project.activeLayer.children=[],this.paperScope.view.draw(),this.$(".canvas-container").hide()},_clearAllViews:function(){for(var a=this.shapeViews.length,b=0;a>b;b++)this.shapeViews[b].remove(),this.shapeViews[b].unbind();this.shapeViews=[]},_clearZombies:function(){var a=this.model.get("shapeCollection");this._clearAllViews(),a.reset()},_changeCursor:function(){var a=this.model.get("cursor"),b="#"+this.idPrefix+"activity-canvas",c="";switch(a){case 0:c="default";break;case 1:c="url('"+this.filePath.getImagePath("open-hand")+"'), move";break;case 2:c="url('"+this.filePath.getImagePath("closed-hand")+"'), move"}this.$(b).css({cursor:c})},_setHelpElements:function(){var a=this.model.get("helpElements");a.push({elementId:"start-button-container",helpId:"start-instruction",msgId:0,dynamicArrowPosition:!0,position:"top",tooltipWidth:288},{elementId:"activity-canvas",helpId:"drag-rotate-instruction",fromElementCenter:!0,msgId:0,position:"bottom"},{elementId:"activity-canvas",helpId:"drag-rotate-instruction",fromElementCenter:!0,msgId:1,position:"bottom"},{elementId:"next-button-container",helpId:"next-instruction",msgId:0,dynamicArrowPosition:!0,position:"top"})},createTooltip:function(){var a,b=MathInteractives.global.Theme2.Tooltip,c=this.model.get("pathDisplayed");0===c?(a=b.ARROW_TYPE.TOP_MIDDLE,this.$(".dummy-tooltip-div").addClass("rect-shape-road")):1===c&&(a=b.ARROW_TYPE.BOTTOM_MIDDLE,this.$(".dummy-tooltip-div").addClass("z-shape-road"));var d=208,e=MathInteractives.Common.Utilities.Models.BrowserCheck;(e.isIOS||e.isMac)&&(d=228);var f=b.generateTooltip({_player:this.player,manager:this.manager,path:this.filePath,idPrefix:this.idPrefix,id:"multiple-tooltip",containerHeight:67,containerWidth:d,type:b.TYPE.FORM_VALIDATION,text:"",arrowType:a,elementEl:this.idPrefix+"dummy-tooltip-div",tabIndex:-1,accText:"",closeOnDocumentClick:!0,showCloseBtn:!1,filePath:this.filePath});this.tooltipView=f},showTooltip:function(a){var b="",c=27,d=MathInteractives.Interactivities.PicturePerfect.Views.Shape;b=this.getMessage("tooltip-text",a),a===d.ANGLES_TYPE.BOTH&&(c=57),this.tooltipView.changeText(b,""),this.tooltipView.changeContainerHeight(c),this.tooltipView.showTooltip(),this.tooltipView.displayTooltip()},_changeAnglesColor:function(){if(this.currentSnappedShapeView){for(var a=this.currentSnappedShapeView.model.get("paperGroupElem"),b=a.children,c=b.length,d=MathInteractives.Interactivities.PicturePerfect.Views.Shape,e=0;c>e;e++){var f=b[e];if(f.children.length>1){var g=f.children[d.GROUP_ELEMENT_INDEX.ANGLE_GROUP];if(g){var h=g.children;for(var i in h)(h[i].data.isSupplementary||h[i].data.isComplementary)&&(h[i].opacity=.5,h[i].data.opacity=.5)}}}this.orderShapesCalled?this.orderShapesCalled=!1:this._orderShapes(),this.currentSnappedShapeView=null}},_bindActivityCompleteEvent:function(){var a=this;this.model.on("change:activityComplete",$.proxy(a._triggerActivityComplete,a)),this.model.on("change:wrongActivityComplete",$.proxy(a._triggerWrongActivityComplete,a))},_triggerActivityComplete:function(){this.model.get("activityComplete")&&this.trigger(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACTIVITY_COMPLETE)},_triggerWrongActivityComplete:function(){this.model.get("wrongActivityComplete")&&this.trigger(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ZSHAPE_WRONG_ACTIVITY_COMPLETE)},changeActivityComplete:function(){this.model.set("activityComplete",this.model.get("snappedToPath")&&this.model.get("roadComplete")),this.model.set("wrongActivityComplete",this.model.get("snappedToWrongPath")&&this.model.get("roadComplete"))},changeSnappedPath:function(){this.model.set("snappedToPath",this.model.get("snappedToX")&&this.model.get("snappedToY"))},changeSnappedToWrongPath:function(){this.model.set("snappedToWrongPath",this.model.get("snappedToWrongX")&&this.model.get("snappedToWrongY"))},_loadCanvasForAcc:function(){this._initAccessibility(),this._bindAccessibilityListeners()},_initAccessibility:function(){this.canvasAcc&&(this.canvasAcc.unbind(),this.canvasAcc.model.destroy());var a={canvasHolderID:this.idPrefix+"canvas-acc-container",paperItems:[],paperScope:this.paperScope,manager:this.manager,player:this.player};this.canvasAcc=MathInteractives.global.CanvasAcc.intializeCanvasAcc(a),this.canvasAcc.updatePaperItems(this.getPaperObjects())},_bindAccessibilityListeners:function(){var a=this,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,c=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS,d=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,e=$("#"+this.idPrefix+"canvas-acc-container");this._bindSpaceForAccessibility(),e.off(b.TAB).on(b.TAB,function(b,c){a._tabKeyPressed(b,c)}),e.off(d.FOCUS_OUT).on(d.FOCUS_OUT,function(b,c){a._focusOut(b,c)}),e.off(b.ARROW).on(b.ARROW,function(b,d){a._hideToolTipForAccessibility(),a._arrowKeyPressed(b,d),e.off(c.ARROW_KEYUP).on(c.ARROW_KEYUP,function(b,d){a._handleOnArrowKeyUp(b,d),e.off(c.ARROW_KEYUP)})}),e.off(b.ROTATE_CLOCKWISE).on(b.ROTATE_CLOCKWISE,function(b,c){a._hideToolTipForAccessibility(),a._rotateShape(b,c,!0),a._bindRotationUp()}),e.off(b.ROTATE_ANTI_CLOCKWISE).on(b.ROTATE_ANTI_CLOCKWISE,function(b,c){a._hideToolTipForAccessibility(),a._rotateShape(b,c,!1),a._bindRotationUp()})},_bindRotationUp:function(){var a=this,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS,c=$("#"+this.idPrefix+"canvas-acc-container");c.off(b.ROTATION_KEYUP).on(b.ROTATION_KEYUP,function(d,e){a._handleOnRotationKeyUp(d,e),c.off(b.ROTATION_KEYUP)})},_hideToolTipForAccessibility:function(){var a=this;a.tooltipView&&(a.tooltipView.hideTooltip(),a.tooltipView.trigger(MathInteractives.Common.Components.Theme2.Views.Tooltip.EVENTS.TOOLTIP_HIDE_ON_CLOSEBTN_CLICK))},_unbindSpaceForAccessibility:function(){var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=$("#"+this.idPrefix+"canvas-acc-container");b.off(a.SPACE)},_bindSpaceForAccessibility:function(){var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=$("#"+this.idPrefix+"canvas-acc-container"),c=this;b.on(a.SPACE,function(a,b){c._spaceKeyPressed(a,b)})},_tabKeyPressed:function(a,b){var c=this;this.isFirstTab&&(this.isFirstTab=!1,this.isFocusOnCanvas=!0),this.tooltipView.hideTooltip(),this.tooltipView.trigger(MathInteractives.Common.Components.Theme2.Views.Tooltip.EVENTS.TOOLTIP_HIDE_ON_CLOSEBTN_CLICK),null!==this.previousItem&&(a.fromTabKey=!0,c.currentTool.trigger("mouseup",a));var c=this;this.previousItem=b.item;var d=c._createEvent(a,b);if(0!==b.item.children.length)if(b.item.trigger("mousedown",d),b.item.children.length!==this.model.get("shapeCollection").length){var e=c._readAnglesOfShape(b.item),f=e.length;4!==f?c.changeAccMessage("canvas-acc-container",1,e):c.changeAccMessage("canvas-acc-container",6,e)}else c.changeAccMessage("canvas-acc-container",9)},_readAnglesOfShape:function(a){var b=this,c=b.model.get("anglesToBeRead"),d=a.children.length,e=[];e.push(1===d?b.getAccMessage("type-of-piece",0):b.getAccMessage("type-of-piece",1));var f,g=b._getXYCoordinates(c),h=new this.paperScope.Path(g);f=h.position,h.remove();var i=b._getAngleArray(g,f);for(var j in i){var k=i[j][2];1===k.length?e.push(k[0]):15===d&&this._hasAllFourCorners(a)?e.push(k[0],k[1]):e.push(b.getAccMessage("angle-made-of-two-angles",0,[k[0],k[1],parseInt(k[0])+parseInt(k[1])]))}return e},_hasAllFourCorners:function(a){for(var b=a.getItems({data:"rectangle-endpoint-symbol"}),c=b.length,d=0,e=0;c>e;e++){var f=b[e].name;if(f.indexOf("corner")>-1&&f.indexOf("inner")>-1&&d++,4===d)return!0}return!1},_getXYCoordinates:function(a){var b=[],c=this;for(var d in a)b.push(new Array(new c.paperScope.Point(parseInt(d.slice(d.indexOf("x")+2,d.indexOf("y")-1)),parseInt(d.slice(d.indexOf("y")+2,d.length))),a[d]));return b},_getAngleArray:function(a,b){for(var c=a.length,d=[],e=0;c>e;e++)d[e]=180*Math.atan2(a[e][0].y-b.y,a[e][0].x-b.x)/Math.PI;return this._sortAngleAndPoints(d,a)},_sortAngleAndPoints:function(a,b){for(var c=[],d=a.length,e=0;d>e;e++)c.push(new Array(a[e],b[e][0],b[e][1]));return c.sort(function(a,b){return a[0]<b[0]?1:a[0]>b[0]?-1:0}),c},_createEvent:function(a){return a.point=this.previousItem.position,a.event={which:1},a.isAccessible=!0,a},_rotateShape:function(a,b,c){a.target=b.item,a.event={which:b.event.which},a.isAccessible=!0,this.setAccMessage("canvas-acc-container",""),a.rotateAngle=c?MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.TRIANGLE_ROTATE_ANGLE:-MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.TRIANGLE_ROTATE_ANGLE,this.trigger(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACCESSIBILITY_ROTATE,a)},_spaceKeyPressed:function(){this._unbindSpaceForAccessibility()},_focusOut:function(a){this.isFirstTab=!0,this.isFocusOnCanvas=!1;var b=this;a.fromTabKey=!0,b.currentTool.trigger("mouseup",a);var c=b.model.get("pathDisplayed"),d=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ROADTYPES;b._hideToolTipForAccessibility(),c===d.RECTANGLESHAPED?b.changeAccMessage("canvas-acc-container",0,[b.getAccMessage("type-of-path",1),b.model.get("shapeCollection").length]):c===d.ZSHAPED&&b.changeAccMessage("canvas-acc-container",0,[b.getAccMessage("type-of-path",0),b.model.get("shapeCollection").length]),b.trigger(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.BACKGROUND_CLICKED),this._bindSpaceForAccessibility()},_arrowKeyPressed:function(a,b){a.point={x:b.point.x+5*b.directionX,y:b.point.y+5*b.directionY},a.event={which:b.event.which},a.isAccessible=!0,this.setAccMessage("canvas-acc-container",""),b.item.trigger("mousedrag",a),this.paperScope.view.draw()},_handleOnArrowKeyUp:function(a,b){var c=this,d=0;this.accessibilityFlagForSnapping=!1,this.currentTool.trigger("mouseup",a),c.accessibilityFlagForSnapping||(b.keyCode===MathInteractives.global.CanvasAcc.KEYS.LEFTARROW?d=0:b.keyCode===MathInteractives.global.CanvasAcc.KEYS.RIGHTARROW?d=1:b.keyCode===MathInteractives.global.CanvasAcc.KEYS.UPARROW?d=2:b.keyCode===MathInteractives.global.CanvasAcc.KEYS.DOWNARROW&&(d=3),this.changeAccMessage("canvas-acc-container",2,[this.getAccMessage("type-of-direction",d)]),this._setFocusOnCanvas()),this._selectPreviousItem(a,b)},_selectPreviousItem:function(a,b){if(this.previousItem&&0!==this.previousItem.children.length&&this.isFocusOnCanvas&&!this.model.get("activityComplete")){var c=this;this.previousItem.trigger("mousedown",c._createEvent(a,b))}},_handleOnRotationKeyUp:function(a,b){var c=this,d=0;this.accessibilityFlagForSnapping=!1,this.trigger(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACCESSIBILITY_ROTATE_UP,a),a.isRotate=!0,c.accessibilityFlagForSnapping||(b.keyCode===MathInteractives.global.CanvasAcc.KEYS.ROTATE_CLOCKWISE?d=0:b.keyCode===MathInteractives.global.CanvasAcc.KEYS.ROTATE_ANTI_CLOCKWISE&&(d=1),this.changeAccMessage("canvas-acc-container",3,[this.getAccMessage("type-of-rotation",d)]),this._setFocusOnCanvas()),this._selectPreviousItem(a,b)},getPaperObjects:function(){var a,b=this.shapeViews,c=b.length,d=[];this.previousItem=null,this.previousItemModel=null;for(var e=0;c>e;e++)a=b[e].model,a.get("notUsable")||(d[a.get("slotNumber")]=a.get("paperGroupElem"));return _.compact(d)},_setFocusOnCanvas:function(){this.isFocusOnCanvas&&this.canvasAcc.setSelfFocus()},_updateShapeChildrenCount:function(a,b){if(a!==b){var c=this.model,d=c.get("orderOfShapeGroups"),e=c.get("numberOfShapeGroupChildren"),f=d.indexOf(b);d.splice(f,1),e[a]+=e[b],delete e[b]}},_updateShapeOrder:function(){for(var a=this.model,b=a.get("orderOfShapeGroups"),c=a.get("numberOfShapeGroupChildren"),d=(this.model.get("lastSelectedShapeGroup"),0),e=1,f=b.length;f>e&&c[b[0]]>c[b[e]];e++)d=e;0!==d&&this.moveArrayElement(b,0,d)},moveArrayElement:function(a,b,c){return a.splice(c,0,a.splice(b,1)[0])},_orderShapes:function(){this._updateShapeOrder();for(var a=this.model,b=a.get("orderOfShapeGroups"),c=(a.get("numberOfShapeGroupChildren"),null),d=this.model.get("lastSelectedShapeGroup"),e=d?b.indexOf(d):b.length-1;e>=0;e--)c=this.paperScope.project.getItems({name:b[e]}),c.length>0&&c[0].bringToFront();this.paperScope.view.draw()},updateOrderOfFirstElement:function(){var a=this.model.get("lastSelectedShapeGroup");if(a){var b=this.model.get("orderOfShapeGroups"),c=b.indexOf(a);0!==c&&this.moveArrayElement(b,c,0)}},_initiallyOrderShapes:function(){for(var a=this.model,b=a.get("orderOfShapeGroups"),c=null,d=b.length-1;d>=0;d--)c=this.paperScope.project.getItems({name:b[d]}),c.length>0&&c[0].bringToFront()
}},{EVENTS:{BACKGROUND_CLICKED:"background-clicked",SHAPE_CLICKED:"shape-clicked",SHAPE_SNAPPED:"shape-snapped",SHAPE_ROTATED:"shape-rotated",PATH_SNAPPED:"path-snapped",COMPLETE_PATH_SNAPPED:"complete-path-snapped",ANIMATION_COMPLETE:"meteor-animation-complete",SHAPE_GENERATION_COMPLETE:"shape-generation-complete",ACTIVITY_COMPLETE:"activity-complete",ACCESSIBILITY_ROTATE:"accessibility-rotate",ACCESSIBILITY_ROTATE_UP:"accessibility-rotate-up",ZSHAPE_WRONG_ACTIVITY_COMPLETE:"zshape-wrong-activity-complete",PULSE_ANIMATION_COMPLETE:"angles-pulse-animation-complete",ORDERING_COMPLETE:"ordering-complete"},CANVAS_SIZE:{HEIGHT:512,WIDTH:928},TRIANGLE_ROTATE_ANGLE:5})}(),function(){"use strict";var a=MathInteractives.Common.Utilities.Models.Utils;MathInteractives.Interactivities.PicturePerfect.Views.Shape=MathInteractives.Common.Player.Views.Base.extend({eventCode:null,pivot:null,repairRoadsView:null,paperScope:null,currentTool:null,collection:null,arrowImagePath:null,entirePath:null,removedAngleGroup:{},isSnapped:!1,cursors:MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.CURSOR_TYPE,isMouseupOnShape:!1,isMouseupOnCircle:!1,isShapeDragged:!1,isCircleDragged:!1,tooltipMode:-1,allSymbols:{},angleLabels:null,initialize:function(){this.model;this.paperScope=this.options.paperScope,this.currentTool=this.options.currentTool,this.collection=this.options.collection,this.repairRoadsView=this.options.repairRoadsView,this.arrowImagePath=this.repairRoadsView.getSpritePartBase64URL("picture-perfect-image",480,2400,28,28),this.entirePath=this.options.entirePath,this._createShape(),this.render(),this.removedAngleGroup={}},render:function(){var a=this;this.listenToOnce(this.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACTIVITY_COMPLETE,$.proxy(a._onActivityComplete,a))},_createShape:function(){var a=this.model.get("paperGroupElem");if(null!==a){var b=new this.paperScope.Group;b.importJSON(a),this.model.set("paperGroupElem",b);for(var c,d,e,f=b.children,g=f.length,h={},i=MathInteractives.Interactivities.PicturePerfect.Views.Shape,j=0;g>j;j++){var k=f[j];if(k&&(d=k.children[i.GROUP_ELEMENT_INDEX.SHAPE]),d&&(c=d.segments),c){e=k.name;var l=this.collection.where({name:e})[0];l.set("segments",c),h[e]=l.get("snapIndices"),this.model.set("segmentsGroup",h)}}var m=this.repairRoadsView.model.get("activityComplete");if(!m){this._bindShapeEvents();var d=this.model.get("paperGroupElem");this.model.get("isSelected")&&this.listenToOnce(this.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_GENERATION_COMPLETE,function(){this.model.set("isSelected",!1),d.trigger("mousedown",{event:{which:1},point:d.position}),this.currentTool.trigger("mouseup",{event:{which:1},point:d.position},!0)})}this._updateSymbols()}else{var d=new this.paperScope.Path,n=this.model.get("segments").slice();d.strokeColor="white",d.fillColor="#FFB400",d.strokeWidth=2,d.addSegments(n),d.closed=!0,d.strokeJoin="round",d.name="shape",this.model.set("segments",d.segments);var h={};h[this.model.get("name")]=this.model.get("snapIndices"),this.model.set("segmentsGroup",h);var k=new this.paperScope.Group(d);k.name=this.model.get("name");var o=new this.paperScope.Group(k);o.name=this.model.get("groupName"),this.model.set("paperGroupElem",o),this._setEndPoints(n),this._drawAngles(!0),this._removeAngleGroup(),this.model.set("rotation",this._fixRotationAngle(this.model.get("rotation"))),o.rotate(this.model.get("rotation")),o.position=this.model.get("position"),this._drawAngles(),this._bindShapeEvents(),this.repairRoadsView.model.get("orderOfShapeGroups").push(o.name),this.repairRoadsView.model.get("numberOfShapeGroupChildren")[o.name]=1}},_resetShape:function(){this.currentTool.detach("mouseup"),this._removeBoundingBox(),this.stopListening(this.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACCESSIBILITY_ROTATE),this.stopListening(this.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACCESSIBILITY_ROTATE_UP),this.stopListening(this.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_CLICKED),this.stopListening(this.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_SNAPPED),this.model.set("isSelected",!1),this._changeHoverStateOfShape(!1),this._removeAngleGroup(),this._drawAngles(),this.isSnapped?this.isSnapped=!1:this.setCurrentLabelsColor()},bindChangeEvents:function(){var a=this;this.model.on("change:snappedToX",$.proxy(a.changeSnappedPath,a)),this.model.on("change:snappedToY",$.proxy(a.changeSnappedPath,a)),this.model.on("change:snappedToWrongX",$.proxy(a.changeSnappedToWrongPath,a)),this.model.on("change:snappedToWrongY",$.proxy(a.changeSnappedToWrongPath,a))},changeSnappedPath:function(){this.model.set("snappedToPath",this.model.get("snappedToX")&&this.model.get("snappedToY"))},changeSnappedToWrongPath:function(){this.model.set("snappedToWrongPath",this.model.get("snappedToWrongX")&&this.model.get("snappedToWrongY"))},_bindShapeEvents:function(){var a=this,b=this.model.get("paperGroupElem"),c=!1;b.off("mousedown"),b.on("mousedown",function(d){if(a.eventCode=d.event.which,(1===a.eventCode||0===a.eventCode||MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile)&&!a.repairRoadsView.isMouseDownOnElement&&!a.isCircleDragged){MathInteractives.global.SpeechStream.stopReading(),a.model.get("isSelected")||(a.repairRoadsView._orderShapes(),a.repairRoadsView.orderShapesCalled=!0,a.repairRoadsView.trigger(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_CLICKED),a._selectCurrentShape(),a.repairRoadsView.model.set("lastSelectedShapeGroup",a.model.get("groupName")),a.repairRoadsView.updateOrderOfFirstElement(),a.listenToOnce(a.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_CLICKED,function(){a._resetShape()}),a.listenToOnce(a.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_SNAPPED,function(){a._resetShape(),a.repairRoadsView.showTooltip(a.tooltipMode),a.repairRoadsView.currentSnappedShapeView=a,a._addPulseEffect(),a.repairRoadsView.canvasAcc.updatePaperItems(a.repairRoadsView.getPaperObjects(),!0),a.repairRoadsView.previousItem=b}),a.listenToOnce(a.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.BACKGROUND_CLICKED,function(){a._resetShape(),a.repairRoadsView._orderShapes()})),c=!1,d.isRotate||(d.isAccessible?a._drawBoundingBox():a._removeBoundingBox()),a.updateAnglesToBeRead(),a.repairRoadsView.previousItemModel=a.model,a.repairRoadsView.isMouseDownOnElement=!0,a.isMouseDownOnThisShape=!0,a.previousPosition=a._getDifference(d.point,this.position);var e=a.cursors.CLOSE_HAND;a._setCursor(e),a._changeHoverStateOfShape(!0),a.isMouseupOnShape=!1,a.currentTool.on("mouseup",function(d,e){a.repairRoadsView.model.get("activityComplete")||(a.isMouseupOnShape||a._changeHoverStateOfShape(!1),a.repairRoadsView.isMouseDownOnElement=!1,a.isMouseDownOnThisShape=!1,a.isShapeDragged=!1,a._setCursor(a.cursors.DEFAULT),d.isRotate||a._drawBoundingBox(),e||(d.fromTabKey||a._checkSnapOnUp(),a.currentTool.off("mouseup"),b.off("mouseup"),a.repairRoadsView.accessibilityFlagForSnapping=c||a.repairRoadsView.accessibilityFlagForSnapping?!0:!1,a._bringInBounds()))}),b.on("mouseup",function(){MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile&&a._changeHoverStateOfShape(!1),a.isMouseupOnShape=!0,a._setCursor(a.cursors.DEFAULT)})}}),b.off("mousedrag"),b.on("mousedrag",function(b){if(!(1!==a.eventCode&&0!==a.eventCode&&!MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile||a.repairRoadsView.isMouseDownOnElement&&!a.isMouseDownOnThisShape||a.isCircleDragged)){var d=a._getDifference(b.point,a.previousPosition);d=a._fitInBounds(d),this.position=d,c=a.repairRoadsView.accessibilityFlagForSnapping?!0:!1,a.isShapeDragged=!0,b.isAccessible&&a._removeBoundingBox(),a._resetModelSnappingValues()}}),MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile||(b.off("mouseenter"),b.on("mouseenter",function(){if(!a.repairRoadsView.player.getModalPresent()&&!a.repairRoadsView.isMouseDownOnElement){a._changeHoverStateOfShape(!0);var b=a.cursors.OPEN_HAND;a.isShapeDragged&&(b=a.cursors.CLOSE_HAND),a._setCursor(b)}}),b.off("mouseleave"),b.on("mouseleave",function(){a.repairRoadsView.player.getModalPresent()||a.repairRoadsView.isMouseDownOnElement||(a._changeHoverStateOfShape(!1),a.isShapeDragged||a._setCursor(a.cursors.DEFAULT))}),b.off("mousemove"),b.on("mousemove",function(){if(!a.repairRoadsView.player.getModalPresent()&&!a.repairRoadsView.isMouseDownOnElement){if(a.isShapeDragged)return;a._setCursor(a.cursors.OPEN_HAND)}}))},_resetModelSnappingValues:function(){this.repairRoadsView.model.set("snappedToX",!1),this.repairRoadsView.model.set("snappedToY",!1),this.model.set("snappedToX",!1),this.model.set("snappedToY",!1),this.repairRoadsView.model.set("snappedToWrongX",!1),this.repairRoadsView.model.set("snappedToWrongY",!1),this.model.set("snappedToWrongX",!1),this.model.set("snappedToWrongY",!1)},_changeHoverStateOfShape:function(a){var b,c,d=this.model.get("paperGroupElem"),e=d.getItems({name:"shape"}),f=e.length,g="#ffb400",h="#14bfca",i="#ffc438",j="#07a1ab";c=this.model.get("isSelected"),b=c?a?h:j:a?i:g;for(var k=0;f>k;k++)e[k].fillColor=b},_onActivityComplete:function(){var a=this.model.get("paperGroupElem"),b=a.getItems({name:"shape"}),c=b.length;if(c>0){this._unbindShapeEvents(),this._resetShape();for(var d=0;c>d;d++)b[d].fillColor.alpha=.5}},_setCursor:function(a){this.repairRoadsView.model.set("cursor",a)},_fitInBounds:function(a){var b=this.model.get("paperGroupElem"),c=b.position,d=this._getDifference(a,c),e=(b.bounds.topCenter.y+d.y,b.bounds.bottomCenter.y+d.y,b.bounds.leftCenter.x+d.x,b.bounds.rightCenter.x+d.x,b.bounds.width/6),f=b.bounds.height/6,g=MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.CANVAS_SIZE.WIDTH,h=MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.CANVAS_SIZE.HEIGHT,i=0,j=0,k=!1;return a.y<j+f?(a.y=j+f,k=!0):a.y>h-f&&(a.y=h-f,k=!0),a.x<i+e?(a.x=i+e,k=!0):a.x>g-e&&(a.x=g-e,k=!0),k?(this.repairRoadsView.accessibilityFlagForSnapping=!0,this.repairRoadsView.changeAccMessage("canvas-acc-container",10),this.repairRoadsView._setFocusOnCanvas()):this.repairRoadsView.accessibilityFlagForSnapping=!1,a},_bringInBounds:function(){var a=this.model.get("paperGroupElem"),b=10,c=a.bounds.top-b,d=a.bounds.bottom+b,e=(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.CANVAS_SIZE.WIDTH,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.CANVAS_SIZE.HEIGHT),f=0;f>c&&d>e&&(a.position.y=f+(a.position.y-c),this._drawBoundingBox())},_unbindShapeEvents:function(){var a=this,b=this.model.get("paperGroupElem");b.off("mousedown"),b.off("mousedrag"),MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile||(b.off("mouseenter"),b.off("mouseleave"),b.off("mousemove")),a.currentTool.off("mouseup"),a.currentTool.detach("mouseup"),a.stopListening(a.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.BACKGROUND_CLICKED),a._setCursor(a.cursors.DEFAULT)},_selectCurrentShape:function(){var a=this.model.get("paperGroupElem");this.model.set("isSelected",!0),a.fillColor="#07a1ab",a.bringToFront(),this._setAngleSelection(),this._drawBoundingBox()},_bindCircleEvents:function(){var a,b,c,d,e=this.model.get("paperGroupElem"),f=this;MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile||f._bindMouseEnterEvent(),this.stopListening(f.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACCESSIBILITY_ROTATE),this.listenTo(f.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACCESSIBILITY_ROTATE,$.proxy(f._rotateShapeForAccessibility,f)),this.stopListening(f.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACCESSIBILITY_ROTATE_UP),this.listenTo(f.repairRoadsView,MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.ACCESSIBILITY_ROTATE_UP,$.proxy(f._rotateUpShapeForAccessibility,f)),this.repairRoadsView.circleGroup.on("mousedown",function(e){if(f.eventCode=e.event.which,(1===f.eventCode||0===f.eventCode||MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile)&&!f.repairRoadsView.isMouseDownOnElement){MathInteractives.global.SpeechStream.stopReading(),f.isMouseupOnCircle=!1,f.repairRoadsView.isMouseDownOnElement=!0,f.isMouseDownOnThisShape=!0,d=this.children[e.target.name],f._changeHoverState("#ffffff","#b9b9b9",d),c=f.repairRoadsView.rasterCircleGroup.children[e.target.name],c.visible=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?!0:!1,c.sendToBack(),d.bringToFront(),a=e.point,f.pivot=f.repairRoadsView.boundingBox.position;var g=new f.paperScope.Point(f.pivot.x+10,f.pivot.y);b=f._findAngle(a,f.pivot,g,!0),f.repairRoadsView.boundingBoxGroup&&f.repairRoadsView.boundingBoxGroup.remove(),f.repairRoadsView.boundingBoxGroup=new f.paperScope.Group(f.repairRoadsView.boundingBox,f.repairRoadsView.circleGroup,f.repairRoadsView.rasterCircleGroup);var h=f.cursors.CLOSE_HAND;f._setCursor(h),f.repairRoadsView.circleGroup.on("mouseup",function(){f.isMouseupOnCircle=!0,f._setCursor(f.cursors.DEFAULT),MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?(c.visible=!1,f._changeHoverState("#b9b9b9","#ffffff",d)):(c.visible=!0,c.sendToBack(),this.bringToFront()),f.repairRoadsView.circleGroup.off("mouseup")}),f.currentTool.on("mouseup",function(){f._drawAngles(),f.repairRoadsView.isMouseDownOnElement=!1,f.isMouseDownOnThisShape=!1,f._bindMouseEnterEvent(),f._checkSnapOnUp(),!f.isMouseupOnCircle||MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?(f._setCursor(f.cursors.DEFAULT),f._changeHoverState("#b9b9b9","#ffffff",d),c.visible=!1):c.visible=!0,f.isCircleDragged=!1,f.currentTool.off("mouseup"),f.repairRoadsView.circleGroup.off("mouseup"),f._bringInBounds()})}}),this.repairRoadsView.circleGroup.off("mousedrag"),this.repairRoadsView.circleGroup.on("mousedrag",function(d){if((1===f.eventCode||0===f.eventCode||MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile)&&(!f.repairRoadsView.isMouseDownOnElement||f.isMouseDownOnThisShape)){f.isCircleDragged||(c.visible=!1),f.isCircleDragged=!0;var g,h,i;g=new f.paperScope.Point(f.pivot.x+10,f.pivot.y),h=f._findAngle(d.point,f.pivot,g,!0),i=b-h,b=h,a=f.repairRoadsView.circleGroup.position,e.rotate(i,f.pivot),f.repairRoadsView.boundingBoxGroup.rotate(i,f.pivot),f.model.set("rotation",f._fixRotationAngle(f.model.get("rotation")+i)),f._removeAngleGroup(),f._resetModelSnappingValues()}}),this.repairRoadsView.circleGroup.off("mousemove"),this.repairRoadsView.circleGroup.on("mousemove",function(){if(!f.repairRoadsView.player.getModalPresent()&&!f.repairRoadsView.isMouseDownOnElement){if(f.isCircleDragged)return;f._setCursor(f.cursors.OPEN_HAND)}})},_checkSnapOnUp:function(){var a=this,b=this.model.get("paperGroupElem");a.repairRoadsView.model.get("roadComplete")||a._checkSnap(),a.repairRoadsView.model.get("checkPathSnap")?a._checkPathSnap():b.children.length===a.collection.length?(a._checkPathSnap(),a._removeBoundingBox(),a.repairRoadsView.model.set("checkPathSnap",!0)):(a.repairRoadsView.model.set("checkPathSnap",!0),a.repairRoadsView.model.set("snappedToX",a.model.get("snappedToX")),a.repairRoadsView.model.set("snappedToY",a.model.get("snappedToY")),a.repairRoadsView.model.set("snappedToWrongX",a.model.get("snappedToWrongX")),a.repairRoadsView.model.set("snappedToWrongY",a.model.get("snappedToWrongY")))},_rotateShapeForAccessibility:function(a){var b=this.model.get("paperGroupElem"),c=this;c.pivot=c.repairRoadsView.boundingBox.position,b.rotate(a.rotateAngle,c.pivot),c.repairRoadsView.boundingBox.rotate(a.rotateAngle,c.pivot),c.repairRoadsView.circleGroup.rotate(a.rotateAngle,c.pivot),c.repairRoadsView.rasterCircleGroup.rotate(a.rotateAngle,c.pivot),c.model.set("rotation",c._fixRotationAngle(c.model.get("rotation")+a.rotateAngle)),c._removeAngleGroup(),c._resetModelSnappingValues()},_rotateUpShapeForAccessibility:function(){this._drawAngles(),this.paperScope.view.draw(),this.repairRoadsView.isMouseDownOnElement=!1,this.isMouseDownOnThisShape=!1,this._checkSnapOnUp(),this._bringInBounds(),this.repairRoadsView.accessibilityFlagForSnapping=!1},_bindMouseEnterEvent:function(){var a,b,c=this;this.repairRoadsView.circleGroup.off("mouseenter"),this.repairRoadsView.circleGroup.on("mouseenter",function(d){if(!c.repairRoadsView.player.getModalPresent()&&!c.repairRoadsView.isMouseDownOnElement){a=c.repairRoadsView.rasterCircleGroup.children[d.target.name],a.visible=!0,a.sendToBack(),this.bringToFront(),b=this.children[d.target.name],c._changeHoverState("#ffffff","#b9b9b9",b);var e=c.cursors.OPEN_HAND;c.isCircleDragged&&(e=c.cursors.CLOSE_HAND),c._setCursor(e),this.off("mouseleave"),this.on("mouseleave",function(){c.repairRoadsView.player.getModalPresent()||c.repairRoadsView.isMouseDownOnElement||(a.visible=!1,c.isCircleDragged||(c._setCursor(c.cursors.DEFAULT),c._changeHoverState("#b9b9b9","#ffffff",b)))})}})},_findAngle:function(a,b,c,d,e){var f=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)),g=Math.sqrt(Math.pow(b.x-c.x,2)+Math.pow(b.y-c.y,2)),h=Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2)),i=e?a.x<b.x?1:-1:a.y<b.y?1:-1;return d?i*Math.acos(+((g*g+f*f-h*h)/(2*g*f)).toFixed(10))*180/Math.PI:i*Math.acos(+((g*g+f*f-h*h)/(2*g*f)).toFixed(10))},_changeHoverState:function(a,b,c){c.fillColor={gradient:{stops:[a,b]},origin:c.bounds.bottomCenter,destination:c.bounds.topCenter}},_drawBoundingBox:function(){var a,b,c,d,e,f,g=this.model.get("paperGroupElem"),h=6,i=15,j=5,k=0,l=g.bounds.topLeft,m=g.bounds.bottomRight,n=g.bounds.topRight,o=g.bounds.bottomLeft,p=g.bounds.width,q=g.bounds.height,r=new this.paperScope.Point(g.bounds.x-j,g.bounds.y-j),s=new this.paperScope.Size(p+2*j,q+2*j),t=this,u={},v={};this.repairRoadsView.boundingBox&&this._removeBoundingBox(),this.repairRoadsView.boundingBox=new this.paperScope.Path.Rectangle(r,s),this.repairRoadsView.boundingBox.style={strokeColor:"#ffffff",dashArray:[3,3],strokeWidth:2,shadowColor:"#000000",shadowBlur:3,shadowOffset:new this.paperScope.Point(2,2)},this.repairRoadsView.boundingBox.shadowColor.alpha=.38,a=new this.paperScope.Raster({source:this.arrowImagePath}),b=new this.paperScope.Symbol(a),c=new this.paperScope.Path.Circle({radius:h,center:new this.paperScope.Point(0,0),strokeWidth:2,strokeColor:"#4c1787",shadowColor:new this.paperScope.Color(0,0,0),shadowBlur:3,shadowOffset:new this.paperScope.Point(2,2)}),c.shadowColor.alpha=.68,t._changeHoverState("#b9b9b9","#ffffff",c),v=[{name:"circle1",center:this._getDifference(l,new this.paperScope.Point(j,j))},{name:"circle2",center:new this.paperScope.Point(o.x-j,o.y+j)},{name:"circle3",center:new this.paperScope.Point(n.x+j,n.y-j)},{name:"circle4",center:this._getDifference(m,new this.paperScope.Point(-j,-j))}],a.remove(),this.repairRoadsView.rasterCircleGroup=new this.paperScope.Group,this.repairRoadsView.circleGroup=new this.paperScope.Group,e=v.length;for(var w=0;e>w;w++){var x=c.clone();x.position=v[w].center,x.name=v[w].name,this.repairRoadsView.circleGroup.addChild(x)}if(c.remove(),MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile){d=new this.paperScope.Path.Circle({radius:i,center:new this.paperScope.Point(0,0),fillColor:"#ffffff",opacity:0});for(var w=0;e>w;w++){var y=d.clone();y.position=v[w].center,y.name=v[w].name,this.repairRoadsView.circleGroup.addChild(y)}}u=[{name:"circle1",position:this._getDifference(this.repairRoadsView.circleGroup.children[0].bounds.topLeft,new this.paperScope.Point(k,k)),rotate:270},{name:"circle2",position:this._getDifference(this.repairRoadsView.circleGroup.children[1].bounds.bottomLeft,new this.paperScope.Point(k,-k)),rotate:180},{name:"circle3",position:this._getDifference(this.repairRoadsView.circleGroup.children[2].bounds.topRight,new this.paperScope.Point(-k,k)),rotate:0},{name:"circle4",position:this._getDifference(this.repairRoadsView.circleGroup.children[3].bounds.bottomRight,new this.paperScope.Point(-k,-k)),rotate:90}],f=u.length;for(var w=0;f>w;w++){var z=b.place();z.position=u[w].position,z.name=u[w].name,z.rotate(u[w].rotate),z.visible=!1,this.repairRoadsView.rasterCircleGroup.addChild(z)}this._bindCircleEvents(this.repairRoadsView.circleGroup,g)},_removeBoundingBox:function(){var a=this;void 0!==this.repairRoadsView.boundingBox&&null!==this.repairRoadsView.boundingBox&&(a.repairRoadsView.circleGroup.off("mouseenter"),a.repairRoadsView.boundingBox.remove(),a.repairRoadsView.circleGroup.remove(),a.repairRoadsView.rasterCircleGroup.remove())},_isNeighbour:function(a,b){var c=this.repairRoadsView.model.get("pathDisplayed"),d=this,e=d.collection.indexOf(d.collection.where({name:a})[0]),f=d.collection.indexOf(d.collection.where({name:b})[0]);return c===MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ROADTYPES.RECTANGLESHAPED&&(15===e&&0===f||15===f&&0===e)?!0:1===Math.abs(e-f)?!0:!1},_getDistance:function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o=this;h=a.get("name"),i=b.get("name");for(var p=b.get("segmentsGroup")[i],q=Object.keys(p),r=q.length,s=0;r>s;s++)if(o._isNeighbour(q[s],c)&&(n=a.get("segmentsGroup")[o._getNameOfComparedModel(q[s]).get("name")],n&&(j=n[c],m=p[q[s]],k=o.collection.where({name:q[s]})[0].get("segments"),l=o.collection.where({name:c})[0].get("segments"),j&&j.length>0&&m&&m.length>0||g))){var t=l[parseInt(m[d])],u=k[parseInt(j[e])];if(u&&t){var v=u.point.x,w=u.point.y,x=t.point.x,y=t.point.y,z={};return z.value=Math.sqrt(Math.pow(x-v,2)+Math.pow(y-w,2)),z.diff={},z.draggedShapeName=h,z.diff.x=v-x,z.diff.y=w-y,z.segmentIndex={},z.segmentIndex.compared=m[d],z.segmentIndex.dragged=j[e],z.nameOfDraggedShape=q[s],f&&(delete p[q[s]],b.set("snapIndices",p)),z}}},_checkSnap:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=!1,p=this,q=!0,r=!1,s=!0,t=p.model.get("paperGroupElem"),u=p.model.get("name"),v=p.collection.where({name:u}),w=this.collection.length,x=t.children.length,y=!1,z=!1;p.angleLabels=[];var A=v[0].get("segmentsGroup")[u],B=Object.keys(A),C=B.length;if(x!==w)for(var D=0;C>D;D++){var E=B[D],F=p._getNameOfComparedModel(E);if(j=v[0].get("paperGroupElem").children.length,v[0].get("name")!==F.get("name")||w===j){var G=A[B[D]].length;if(4===G&&(q=!1),(v[0].get("name")===F.get("name")||15===F.get("paperGroupElem").children.length)&&1===x){v[0].get("name")===F.get("name")?(F=l,s=!0):s=!1,o=!0,k=F.get("snapIndices")[u];var H=p.collection.where({name:E})[0].get("snapIndices")[u];4!=H.length?(m=H[0],n=H[1]):(m=H[2],n=H[3])}for(var I=0;G>I;I+=2)if(o?(I=2,a=p._getDistance(v[0],F,E,k.indexOf(m),0,r),b=p._getDistance(v[0],F,E,k.indexOf(n),1,r)):(a=p._getDistance(v[0],F,E,0,I,r),b=p._getDistance(v[0],F,E,1,I+1,r)),a&&b&&a.value<=20&&b.value<=20){l=F;var J=F.get("rotation")-v[0].get("rotation");if(p.repairRoadsView._updateShapeChildrenCount(v[0].get("groupName"),F.get("groupName")),t.rotate(J),v[0].set("rotation",F.get("rotation")),v[0].set("snappedToX",F.get("snappedToX")),v[0].set("snappedToY",F.get("snappedToY")),v[0].set("snappedToWrongX",F.get("snappedToWrongX")),v[0].set("snappedToWrongY",F.get("snappedToWrongY")),15!==F.get("paperGroupElem").children.length?r=!0:(s=!1,r=!1,q=!1),o)var K=p._getDistance(v[0],F,E,k.indexOf(m),0,r);else var K=p._getDistance(v[0],F,E,0,I,r);if(r=!1,t.position.x-=K.diff.x,t.position.y-=K.diff.y,p._addInGroup(v[0],F,B[D],K.nameOfDraggedShape,q,s),q=!0,s=!0,c=v[0].get("paperGroupElem"),d=c.children[a.nameOfDraggedShape].children[MathInteractives.Interactivities.PicturePerfect.Views.Shape.GROUP_ELEMENT_INDEX.ANGLE_GROUP],e=c.children[E].children[MathInteractives.Interactivities.PicturePerfect.Views.Shape.GROUP_ELEMENT_INDEX.ANGLE_GROUP],d&&e&&d.children.length>0&&e.children.length>0){f=d.children[a.segmentIndex.dragged],g=d.children[b.segmentIndex.dragged],h=e.children[a.segmentIndex.compared],i=e.children[b.segmentIndex.compared];for(var L=[f,h,g,i],M=0;M<L.length;M+=2){var N=parseInt(L[M]._content),O=parseInt(L[M+1]._content);N+O===180?(L[M].data.fillColor="#174471",L[M+1].data.fillColor="#174471",L[M].data.isSupplementary=!0,L[M+1].data.isSupplementary=!0,p.angleLabels.push(L[M]),p.angleLabels.push(L[M+1]),z=!0):N+O===90&&(L[M].data.fillColor="#aa00b5",L[M+1].data.fillColor="#aa00b5",L[M].data.isComplementary=!0,L[M+1].data.isComplementary=!0,p.angleLabels.push(L[M]),p.angleLabels.push(L[M+1]),y=!0)}p.isSnapped=!0,p._updateSymbols(),p._updateAngles()}}}}if(p.isSnapped){var P=MathInteractives.Interactivities.PicturePerfect.Views.Shape.ANGLES_TYPE;z&&y?this.tooltipMode=P.BOTH:y?this.tooltipMode=P.COMPLEMENTARY:z&&(this.tooltipMode=P.SUPPLEMENTARY);for(var Q,R="",D=0;D<p.angleLabels.length;D+=2)Q=D+2!==p.angleLabels.length?D+4===p.angleLabels.length?p.repairRoadsView.getAccMessage("end-tag-for-angle",0):p.repairRoadsView.getAccMessage("end-tag-for-angle",1):p.repairRoadsView.getAccMessage("end-tag-for-angle",2),p.angleLabels[D].data.isComplementary?R+=p.repairRoadsView.getAccMessage("canvas-acc-container",4,[p.angleLabels[D]._content,p.angleLabels[D+1]._content,Q]):p.angleLabels[D].data.isSupplementary&&(R+=p.repairRoadsView.getAccMessage("canvas-acc-container",5,[p.angleLabels[D]._content,p.angleLabels[D+1]._content,Q]));this.repairRoadsView.accessibilityFlagForSnapping=!0,p.repairRoadsView.trigger(MathInteractives.Interactivities.PicturePerfect.Views.RepairRoadTab.EVENTS.SHAPE_SNAPPED),p.repairRoadsView.model.set("checkPathSnap",!1),t.children.length===p.collection.length?(p.repairRoadsView.model.set("roadComplete",!0),p.repairRoadsView.model.get("activityComplete")||(R+=p.repairRoadsView.getAccMessage("canvas-acc-container",9))):R+=p.repairRoadsView.getAccMessage("canvas-acc-container",1,p.repairRoadsView._readAnglesOfShape(p.model.get("paperGroupElem"))),this.repairRoadsView.setAccMessage("canvas-acc-container",R),this.repairRoadsView._setFocusOnCanvas()}},_setPathSnapAccessibilityText:function(a){a&&(this.repairRoadsView.accessibilityFlagForSnapping=!0,this.repairRoadsView.changeAccMessage("canvas-acc-container",8),this.repairRoadsView._setFocusOnCanvas())},_checkPathSnap:function(){for(var a=this,b=a.model.get("paperGroupElem"),c=b.getItems({name:"endpoint-symbol"}),d=(c.length,b.getItems({name:"shape"})),e=0;e<d.length;e++)if(this.entirePath.getIntersections(d[e]).length>1)return!1;this.entirePath.contains(d[0].position)||this._trySnapping()},_trySnapping:function(){var a=this.repairRoadsView.model.get("pathDisplayed"),b=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads;a===b.ROADTYPES.RECTANGLESHAPED?(this._tryRectangleSnapping(!0),this._tryRectangleSnapping(!1)):(this._tryZigzagSnapping(!0),this._tryZigzagSnapping(!1))},_tryRectangleSnapping:function(a){for(var b=this.allSymbols,c=Object.keys(b).filter(function(a){return a.indexOf("outer")>-1}),d=Object.keys(b).filter(function(a){return a.indexOf("inner")>-1}),e=c.length,f=d.length,g=!1,h=0;e>h&&!g;h++)2===b[c[h]].length&&(g=this._snapToRectanglePath(b[c[h]],a));if(!g)for(var h=0;f>h&&!g;h++)2===b[d[h]].length&&(g=this._snapToRectanglePath(b[d[h]],a))},_tryZigzagSnapping:function(a){for(var b=this.allSymbols,c=Object.keys(b).filter(function(a){return a.indexOf("upper")>-1}),d=Object.keys(b).filter(function(a){return a.indexOf("lower")>-1}),e=Object.keys(b).filter(function(a){return a.indexOf("middle")>-1}),f=c.length,g=d.length,h=e.length,i=!1,j=0;f>j&&!i;j++)2===b[c[j]].length&&(i=this._snapToZigzagPath(b[c[j]],a));if(!i)for(var j=0;g>j&&!i;j++)2===b[d[j]].length&&(i=this._snapToZigzagPath(b[d[j]],a));if(!i)for(var j=0;h>j&&!i;j++)2===b[e[j]].length&&(i=this._snapToZigzagPath(b[e[j]],a))},_snapToRectanglePath:function(a,b){var c=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,d=c.OUTERROADWIDTH,e=c.OUTERROADHEIGHT,f=c.INNERROADWIDTH,g=c.INNERROADHEIGHT,h=(e-g)/2,i=(d-f)/2,j=c.RECTROAD_OFFSET.LEFT,k=c.RECTROAD_OFFSET.TOP,l=j+d,m=k+e,n=j+i,o=k+h,p=n+f,q=o+g,r=a[0],s=a[1],t=r.position,u=s.position,v=c.PATH_SNAP_OFFSET,w=!1;return b?(Math.abs(t.y-k)<v&&Math.abs(u.y-k)<v?(this._snapToPath(a,"outer-top",b),w=!0):Math.abs(t.y-m)<v&&Math.abs(u.y-m)<v?(this._snapToPath(a,"outer-bottom",b),w=!0):Math.abs(t.y-o)<v&&Math.abs(u.y-o)<v&&t.x<p&&t.x>n&&u.x<p&&u.x>n?(this._snapToPath(a,"inner-top",b),w=!0):Math.abs(t.y-q)<v&&Math.abs(u.y-q)<v&&t.x<p&&t.x>n&&u.x<p&&u.x>n&&(this._snapToPath(a,"inner-bottom",b),w=!0),this._setPathSnapAccessibilityText(w),this.repairRoadsView.model.set("snappedToY",w),this.model.set("snappedToY",w)):(Math.abs(t.x-l)<v&&Math.abs(u.x-l)<v?(this._snapToPath(a,"outer-right",b),w=!0):Math.abs(t.x-j)<v&&Math.abs(u.x-j)<v?(this._snapToPath(a,"outer-left",b),w=!0):Math.abs(t.x-p)<v&&Math.abs(u.x-p)<v&&t.y>o&&t.y<q&&u.y>o&&u.y<q?(this._snapToPath(a,"inner-right",b),w=!0):Math.abs(t.x-n)<v&&Math.abs(u.x-n)<v&&t.y>o&&t.y<q&&u.y>o&&u.y<q&&(this._snapToPath(a,"inner-left",b),w=!0),this._setPathSnapAccessibilityText(w),this.repairRoadsView.model.set("snappedToX",w),this.model.set("snappedToX",w)),w},_snapToZigzagPath:function(a,b){var c=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,d=c.ZROAD_OFFSET.LEFT,e=c.ZROAD_OFFSET.TOP,f=(c.ZROAD_OFFSET.SNAP,c.ZROADWIDTH),g=c.ZROADTOTALWIDTH,h=c.ZROADTOTALHEIGHT,i=c.ZROAD_BOTTOM_PATH_WIDTH,j=c.ZROAD_TOP_PATH_WIDTH,k=e+h-f,l=e+h,m=d,n=d+i,o=e,p=e+f,q=d+g-j,r=d+g,s=q,t=n,u=a[0],v=a[1],w=u.position,x=v.position,y=c.PATH_SNAP_OFFSET,z=!1,A=!1;return b?(Math.abs(w.y-o)<y&&Math.abs(x.y-o)<y?(this._snapToPath(a,"upper-top",b),z=!0):Math.abs(w.y-p)<y&&Math.abs(x.y-p)<y&&w.x>t&&x.x>t?(this._snapToPath(a,"upper-bottom",b),z=!0):Math.abs(w.y-k)<y&&Math.abs(x.y-k)<y&&w.x<s&&x.x<s?(this._snapToPath(a,"lower-top",b),z=!0):Math.abs(w.y-l)<y&&Math.abs(x.y-l)<y&&(this._snapToPath(a,"lower-bottom",b),z=!0),this._setPathSnapAccessibilityText(z),Math.abs(this.model.get("rotation"))>90&&Math.abs(this.model.get("rotation"))<270&&(z&&(A=!0),z=!1),this.repairRoadsView.model.set("snappedToY",z),this.model.set("snappedToY",z),this.repairRoadsView.model.set("snappedToWrongY",A),this.model.set("snappedToWrongY",A)):(Math.abs(w.x-r)<y&&Math.abs(x.x-r)<y?(this._snapToPath(a,"upper-right",b),z=!0):Math.abs(w.x-q)<y&&Math.abs(x.x-q)<y?(this._snapToPath(a,"upper-left",b),z=!0):Math.abs(w.x-n)<y&&Math.abs(x.x-n)<y?(this._snapToPath(a,"lower-right",b),z=!0):Math.abs(w.x-m)<y&&Math.abs(x.x-m)<y&&(this._snapToPath(a,"lower-left",b),z=!0),this._setPathSnapAccessibilityText(z),Math.abs(this.model.get("rotation"))>90&&Math.abs(this.model.get("rotation"))<270&&(z&&(A=!0),z=!1),this.repairRoadsView.model.set("snappedToX",z),this.model.set("snappedToX",z),this.repairRoadsView.model.set("snappedToWrongX",A),this.model.set("snappedToWrongX",A)),z||A},_snapToPath:function(a,b,c){var d=a[0],e=a[1],f=d.position,g=e.position,h=f.x>g.x?10:-10,i=f.y>g.y?10:-10,j=c?g.x+h:g.x,k=c?g.y:g.y+i,l=c?f.y>g.y?1:-1:f.x>g.x?-1:1,m=new this.paperScope.Point(j,k),n=l*this._findAngle(f,g,m,!0,c),o=this.model.get("paperGroupElem"),p=this.repairRoadsView.model.get("pathDisplayed"),q=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads;this._removeAngleGroup(),o.rotate(n),this.model.set("rotation",this._fixRotationAngle(this.model.get("rotation")+n)),this._drawAngles(),p===q.ROADTYPES.RECTANGLESHAPED?this._snapToRectangleSide(b,d.position):this._snapToZigzagSide(b,d.position)},_snapToRectangleSide:function(a,b){var c=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,d=c.OUTERROADWIDTH,e=c.OUTERROADHEIGHT,f=c.INNERROADWIDTH,g=c.INNERROADHEIGHT,h=(e-g)/2,i=(d-f)/2,j=c.RECTROAD_OFFSET.LEFT,k=c.RECTROAD_OFFSET.TOP,l=j+d,m=k+e,n=j+i,o=k+h,p=n+f,q=o+g,r=this.model.get("paperGroupElem"),s=b.y,t=b.y,u=b.x,v=b.x,w=0,x=0,y=3;switch(a){case"outer-top":x=k-s-y;break;case"inner-top":x=o-t-y;break;case"outer-bottom":x=m-t-y;
break;case"inner-bottom":x=q-s-y;break;case"outer-left":w=j-u-y;break;case"inner-left":w=n-v-y;break;case"outer-right":w=l-v-y;break;case"inner-right":w=p-u-y}0!==w&&(r.position.x+=w),0!==x&&(r.position.y+=x),this._drawBoundingBox()},_snapToZigzagSide:function(a,b){var c=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,d=c.ZROAD_OFFSET.LEFT,e=c.ZROAD_OFFSET.TOP,f=c.ZROAD_OFFSET.SNAP,g=c.ZROADWIDTH,h=c.ZROADTOTALWIDTH,i=c.ZROADTOTALHEIGHT,j=c.ZROAD_BOTTOM_PATH_WIDTH,k=c.ZROAD_TOP_PATH_WIDTH,l=e+i-g,m=e+i,n=d,o=d+j,p=e,q=e+g,r=d+h-k,s=d+h,t=this.model.get("paperGroupElem"),u=b.y,v=b.y,w=b.x,x=b.x,y=0,z=0,f=3;switch(a){case"upper-top":z=p-u-f+2;break;case"lower-top":z=l-u-f+2;break;case"upper-bottom":z=q-v-f+2;break;case"lower-bottom":z=m-v-f+2;break;case"upper-left":y=r-w-f+3;break;case"lower-left":y=n-w-f+3;break;case"upper-right":y=s-x-f+1;break;case"lower-right":y=o-x-f+2}0!==y&&(t.position.x+=y),0!==z&&(t.position.y+=z),this._drawBoundingBox()},_getNameOfComparedModel:function(a){var b=this,c=b.collection.where({name:a})[0];if(c.get("notUsable")===!0)for(;;)if(c=b.collection.where({name:c.get("isGroupedWith")})[0],c.get("notUsable")===!1)break;return c},_addInGroup:function(a,b,c,d,e,f){for(var g=this,h=b.get("paperGroupElem"),i=a.get("paperGroupElem"),j=h.children.length,k=0;j>k;k++){var l=h.children[0];i.addChild(l)}j!==g.collection.length&&h.remove();var m=a.get("snapIndices"),n=b.get("snapIndices"),o=a.get("segmentsGroup"),p=b.get("segmentsGroup");if(e&&delete m[c],f){delete n[d],$.extend(o,p);for(var q in n)m[q]=void 0===m[q]?n[q]:n[q].concat(m[q])}a.set("segmentsGroup",o),b.set("segmentsGroup",p),a.set("snapIndices",m),b.set("snapIndices",n),b.set("isGroupedWith",a.get("name")),b.set("notUsable",!0)},_getDifference:function(a,b){return new this.paperScope.Point(a.x-b.x,a.y-b.y)},_setEndPoints:function(){var a,b=this.model.get("paperGroupElem"),c=b.children,d=this._createEndPointSymbol();for(var e in c){var f=c[e];if(f.children.length<2){var g=this.collection.where({name:f.name})[0],h=g.get("segments"),i=g.get("angles");a=new this.paperScope.Group;for(var j=h.length,e=0;j>e;e++){var k=d.clone();k.position=h[e].point,this._nameSymbol(k,h[e].point,i[e]),a.addChild(k)}f.addChild(a)}}this._updateSymbols()},_createEndPointSymbol:function(){var a=new this.paperScope.Path.Circle(new this.paperScope.Point(0,0),1);return a.opacity=0,a},_nameSymbol:function(a,b,c){var d=this.repairRoadsView.model.get("pathDisplayed"),e=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads;d===e.ROADTYPES.RECTANGLESHAPED?this._nameRectangleSymbol(a,b,c):this._nameZigzagSymbol(a,b,c)},_nameRectangleSymbol:function(a,b,c){var d=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,e=d.OUTERROADWIDTH,f=d.OUTERROADHEIGHT,g=d.INNERROADWIDTH,h=d.INNERROADHEIGHT,i=(f-h)/2,j=(e-g)/2,k=d.RECTROAD_OFFSET.LEFT,l=d.RECTROAD_OFFSET.TOP,m=k+e,n=l+f,o=k+j,p=l+i,q=o+g,r=p+h;a.data="rectangle-endpoint-symbol",a.angle=c,a.name=b.x===k&&b.y===l?"outer-left-point+outer-top-point+corner":b.x===k&&b.y===n?"outer-left-point+outer-bottom-point+corner":b.x===m&&b.y===n?"outer-right-point+outer-bottom-point+corner":b.x===m&&b.y===l?"outer-right-point+outer-top-point+corner":b.x===o&&b.y===p?"inner-left-point+inner-top-point+corner":b.x===o&&b.y===r?"inner-left-point+inner-bottom-point+corner":b.x===q&&b.y===r?"inner-right-point+inner-bottom-point+corner":b.x===q&&b.y===p?"inner-right-point+inner-top-point+corner":b.y===l?"outer-top-point":b.y===n?"outer-bottom-point":b.y===p?"inner-top-point":b.y===r?"inner-bottom-point":b.x===k?"outer-left-point":b.x===m?"outer-right-point":b.x===o?"inner-left-point":b.x===q?"inner-right-point":"endpoint-symbol"},_nameZigzagSymbol:function(a,b,c){var d=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,e=d.ZROAD_OFFSET.LEFT,f=d.ZROAD_OFFSET.TOP,g=(d.ZROAD_OFFSET.SNAP,d.ZROADWIDTH),h=d.ZROADTOTALWIDTH,i=d.ZROADTOTALHEIGHT,j=d.ZROAD_BOTTOM_PATH_WIDTH,k=d.ZROAD_TOP_PATH_WIDTH,l=f+i-g,m=f+i,n=e,o=e+j,p=f,q=f+g,r=e+h-k,s=e+h,t=r,u=o;a.data="zigzag-endpoint-symbol",a.angle=c,a.name=b.x===n&&b.y===l?"lower-left-point+lower-top-point+corner":b.x===n&&b.y===m?"lower-left-point+lower-bottom-point+corner":b.x===o&&b.y===m?"lower-bottom-point+middle-right-point+corner":b.x===t&&b.y===l?"lower-top-point+middle-left-point+corner":b.x===s&&b.y===p?"upper-right-point+upper-top-point+corner":b.x===s&&b.y===q?"upper-right-point+upper-bottom-point+corner":b.x===r&&b.y===p?"upper-top-point+middle-left-point+corner":b.x===u&&b.y===q?"upper-bottom-point+middle-right-point+corner":b.y===p?"upper-top-point":b.y===q?"upper-bottom-point":b.y===l?"lower-top-point":b.y===m?"lower-bottom-point":b.x===t?"middle-left-point":b.x===s?"upper-right-point":b.x===n?"lower-left-point":b.x===u?"middle-right-point":"endpoint-symbol"},_updateSymbols:function(){var a=this.repairRoadsView.model.get("pathDisplayed"),b=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,c=null,d=this.model.get("paperGroupElem"),e=[],f=[];c=d.getItems(a===b.ROADTYPES.RECTANGLESHAPED?{data:"rectangle-endpoint-symbol"}:{data:"zigzag-endpoint-symbol"});for(var g=0,h=c.length;h>g;g++){var i=c[g].position,j=Math.round(i.x),k=Math.round(i.y),l=[];if(this._findIndex(e,j,l),0===l.length)e.push(j),f.push(k);else{for(var m=!1,n=0;n<l.length;n++)f[l[n]]===k&&(c[g].remove(),m=!0);m||(e.push(j),f.push(k))}}this._updateBounds()},_updateBounds:function(){var a=this.repairRoadsView.model.get("pathDisplayed"),b=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,c=this.model.get("paperGroupElem"),d=null;d=c.getItems(a===b.ROADTYPES.RECTANGLESHAPED?{data:"rectangle-endpoint-symbol"}:{data:"zigzag-endpoint-symbol"});for(var e=d.length,f={},g=0;e>g;g++){var h=d[g].name,i=[];h.indexOf("corner")>-1&&(h=h.replace("+corner","")),i=h.split("+");for(var j=i.length,k=0;j>k;k++){var l=i[k];("undefined"==typeof f[l]||null===f[l])&&(f[l]=[]),_.compact(f[l]),f[l].push(d[g]),f[l].length>2&&this._removeMiddleValue(f[l])}}this.allSymbols=f},_findIndex:function(a,b,c){for(var d=a.indexOf(b);-1!==d;)c.push(d),d=a.indexOf(b,d+1)},_removeMiddleValue:function(a){for(var b=a.length,c=!1,d=a[0].position.x,e=a[0].position.y,f=a[0].position.x,g=a[0].position.y,h=0,i=0,j=0,k=1;b>k;k++){if(a[k].position.x===d){c=!0;break}a[k].position.x>d?(d=a[k].position.x,j=h,h=k):a[k].position.x<f?(f=a[k].position.x,j=i,i=k):j=k}if(c)for(var k=1;b>k;k++)a[k].position.y>e?(e=a[k].position.y,j=h,h=k):a[k].position.y<g?(g=a[k].position.y,j=i,i=k):j=k;a[j].remove(),delete a[j],a.splice(j,1)},_fixRotationAngle:function(a){return a>0?a%360:a%360+360},_drawAngles:function(a){var b,c=this.model.get("paperGroupElem"),d=c.children,e=this.repairRoadsView.model.get("numberOfAngles");for(var f in d){var g=d[f];if(g.children.length<3){var h=this.collection.where({name:g.name})[0],i=h.get("segments"),j=h.get("angles");b=new this.paperScope.Group;for(var k=i.length,f=0;k>f&&!(f>3);f++){var l=Math.round(j[f]),m=i[0>f-1?k-1:f-1].point,n=i[f].point,o=i[(f+1)%k].point,p=this._getLabelStartPoint(n,m,o,l),q=new this.paperScope.PointText,r={fontSize:12,font:"Montserrat"},s="#222222",t=1,u=!0,v=null,w=null,x=this._getPointTextData(g.name,f);if(x&&(x.fillColor&&(s=x.fillColor),x.opacity&&(t=x.opacity),null!==x.toBeRead&&"undefined"!=typeof x.toBeRead&&(u=x.toBeRead),q.data=x,x.typeOfAngle&&(v=x.typeOfAngle),null!==x.isCorner&&"undefined"!=typeof x.isCorner&&(w=x.isCorner)),q.content=l,q.fillColor=s,q.position=p,q.characterStyle=r,q.opacity=t,q.data.fillColor=s,q.data.opacity=t,q.data.toBeRead=u,q.toBeRead=u,q.data.typeOfAngle=v,q.typeOfAngle=v,q.data.isCorner=w,q.isCorner=w,a){var y="angle-at-x-"+Math.round(n.x)+"-y-"+Math.round(n.y);e[y]?e[y]++:e[y]=1,q.data.typeOfAngle=y,q.typeOfAngle=y;var w=this._checkCornerAngle(n);q.data.isCorner=w,q.isCorner=w}b.addChild(q)}g.addChild(b)}}this.removedAngleGroup={},this.model.get("isSelected")&&this._setAngleSelection()},_updateAngles:function(){var a=this.model.get("paperGroupElem"),b=this.repairRoadsView.model.get("numberOfAngles");for(var c in b){var d=a.getItems({typeOfAngle:c}),e=d.length;if(e>=b[c])for(var f=0;e>f;f++)d[f].isCorner||(d[f].data.toBeRead=!1,d[f].toBeRead=!1)}this.updateAnglesToBeRead()},updateAnglesToBeRead:function(){for(var a=this.model.get("paperGroupElem"),b=a.getItems({toBeRead:!0}),c={},d=b.length,e=0;d>e;e++){var f=b[e].typeOfAngle;c[f]?c[f].push(b[e]._content):c[f]=[b[e]._content]}this.repairRoadsView.model.set("anglesToBeRead",c)},_checkCornerAngle:function(a){var b=!1;if(this.repairRoadsView.model.get("pathDisplayed")===MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ROADTYPES.ZSHAPED){var c=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,d=c.ZROAD_OFFSET.LEFT,e=c.ZROAD_OFFSET.TOP,f=c.ZROADWIDTH,g=c.ZROADTOTALWIDTH,h=c.ZROADTOTALHEIGHT,i=e+h-f,j=e+h,k=d,l=e,m=e+f,n=d+g;(a.x===k&&a.y===i||a.x===k&&a.y===j||a.x===n&&a.y===l||a.x===n&&a.y===m)&&(b=!0)}return b},_getPointTextData:function(a,b){var c=null;if(this.removedAngleGroup){var d=this.removedAngleGroup[a];if(d){var e=d.children[b];e.data&&(c=e.data)}}return c},_getLabelStartPoint:function(b,c,d,e){{var f,g,h,i,j;this.model}return f=31>e?45:41>e?40:55>e?30:70>e?25:20,g=a.getPointOnLine(b,c,f,0,!0),h=a.getPointOnLine(b,d,f,0,!0),null!==g||null!==h?(null===g&&null!==h?g=h:null!==g&&null===h&&(h=g),i=a.getPointOnLine(a.getMidPoint(g,h),b,f,0,!1),null===i&&(i=h),j=a.getPointOnLine(b,i,f,0,!0)):void 0},_setAngleSelection:function(){this._setAngleLabelsColor("#ffffff")},_resetAngleSelection:function(){this._setAngleLabelsColor("#222222")},_setAngleLabelsColor:function(a){var b=this.model.get("paperGroupElem"),c=b.children,d=MathInteractives.Interactivities.PicturePerfect.Views.Shape;for(var e in c){var f=c[e];if(f.children.length>1){var g=f.children[d.GROUP_ELEMENT_INDEX.ANGLE_GROUP];g.fillColor=a}}},setCurrentLabelsColor:function(){for(var a=this.model.get("paperGroupElem"),b=a.children,c=b.length,d=MathInteractives.Interactivities.PicturePerfect.Views.Shape,e=0;c>e;e++){var f=b[e];if(f.children.length>1){var g=f.children[d.GROUP_ELEMENT_INDEX.ANGLE_GROUP];if(g){var h=g.children;for(var i in h)h[i].fillColor=h[i].data.fillColor}}}},_removeAngleGroup:function(){for(var a=this.model.get("paperGroupElem"),b=a.children,c=b.length,d=MathInteractives.Interactivities.PicturePerfect.Views.Shape,e=0;c>e;e++){var f=b[e];if(f.children.length>2){var g=f.children[d.GROUP_ELEMENT_INDEX.ANGLE_GROUP];this.removedAngleGroup[f.name]=g,g.remove()}}},_addPulseEffect:function(){for(var a=this.model.get("paperGroupElem"),b=a.children,c=b.length,d=MathInteractives.Interactivities.PicturePerfect.Views.Shape,e=0;c>e;e++){var f=b[e];if(f.children.length>1){var g=f.children[d.GROUP_ELEMENT_INDEX.ANGLE_GROUP];if(g)for(var h=g.children,i=0;i<h.length;i++)if((h[i].data.isSupplementary||h[i].data.isComplementary)&&1===h[i].opacity){h[i].data.increase=!0,h[i].data.frame=1;var j=this;h[i].onFrame=function(){var a=this.data.frame;if(a%5===0){var b=this.fontSize,c=this.data.increase;if(c&&16>b?b++:!c&&b>11&&b--,this.fontSize=b,15===b&&(this.data.increase=!1),!c&&12===b)return this.fontSize=12,void this.detach("frame");j.paperScope.view.draw()}a++,this.data.frame=a}}}}}},{ANGLES_TYPE:{COMPLEMENTARY:0,SUPPLEMENTARY:1,BOTH:2},GROUP_ELEMENT_INDEX:{SHAPE:0,SYMBOL_GROUP:1,ANGLE_GROUP:2}})}(),function(){var a=Handlebars.template,b=MathInteractives.Interactivities.PicturePerfect.templates=MathInteractives.Interactivities.PicturePerfect.templates||{};b.repairRoadTab=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'repair-road-tab-container" class="repair-road-tab-container">\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'repair-road-activity-area" class="repair-road-activity-area">\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'direction-text-container" class="direction-text-container"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'canvas-acc-container" class="canvas-container"></div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'canvas-container" class="canvas-container">\r\n        <canvas id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'activity-canvas" class="activity-canvas" width="928px" height="512px"></canvas>\r\n      </div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'next-button-container" class="next-button-container"></div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'start-button-container" class="start-button-container"></div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'dummy-tooltip-div" class="dummy-tooltip-div"></div>\r\n    </div>\r\n</div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Interactivities.PicturePerfect.templates=MathInteractives.Interactivities.PicturePerfect.templates||{};b.animation=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'red-animation-modal" class="red-animation-modal"></div>\r\n<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'meteor-animation-screen-1" class="meteor-animation-screen-1 meteor-animation-screen"></div>\r\n<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'meteor-animation-screen-2" class="meteor-animation-screen-2 meteor-animation-screen"></div>\r\n<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'meteor-animation-screen-3" class="meteor-animation-screen-3 meteor-animation-screen"></div>'})}();