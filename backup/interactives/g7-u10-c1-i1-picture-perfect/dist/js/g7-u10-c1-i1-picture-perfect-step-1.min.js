!function(a){"use strict";a.Interactivities.PicturePerfect={},a.Interactivities.PicturePerfect.Models={},a.Interactivities.PicturePerfect.Views={}}(window.MathInteractives),function(){"use strict";MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:{currentTab:0,pathDisplayed:1,shapeCollection:null,animationComplete:!1,roadComplete:!1,activityComplete:!1,wrongActivityComplete:!1,cursor:0,zPathCoordinates:null,rectPathCoordinates:null,checkPathSnap:!0,snappedToX:!1,snappedToY:!1,snappedToPath:!1,snappedToWrongX:!1,snappedToWrongY:!1,snappedToWrongPath:!1,numberOfAngles:{},anglesToBeRead:{},orderOfShapeGroups:[],numberOfShapeGroupChildren:{},lastSelectedShapeGroup:null,helpElements:null},initialize:function(){var a=this.get("shapeCollection");null===a?this.initializeShapeCollection():this._createShapeCollectionFromJson(a),this.generatePathCoordinates(),this.set("helpElements",[])},getCurrentStateData:function(){var a=JSON.stringify(this,this.getJSONAttributes);return a},getJSONAttributes:function(a,b){var c=b;switch(a){case"path":case"manager":case"player":case"jsonData":case"helpElements":c=void 0}return c},initializeShapeCollection:function(){var a=this.get("pathDisplayed"),b=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads;a===b.ROADTYPES.RECTANGLESHAPED?this._generateRectRoadShapes():this._generateZRoadShapes()},_createShapeCollectionFromJson:function(a){var b=new MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ShapeCollection(a);this.set("shapeCollection",b)},_addIntoShape:function(a,b,c,d,e){var f={x:a,y:b},g={x:c,y:d},h=[];h.push(f),h.push(g),e[e.length]=h},_generateNumber:function(a,b){var c=b-a+1;return Math.floor(Math.random()*c)+a},_getBaseLength:function(a,b){return Math.tan(Math.abs(a)*Math.PI/180)*b},_getAngles:function(a){var b=a.length,c=[],d=b;b>4&&(d=4);for(var e=0;d>e;e++){var f=a[0>e-1?b-1:e-1],g=a[e],h=a[(e+1)%b];c[e]=this._findAngle(f,g,h,!0)}return c},_findAngle:function(a,b,c,d){var e=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)),f=Math.sqrt(Math.pow(b.x-c.x,2)+Math.pow(b.y-c.y,2)),g=Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2));return d?180*Math.acos((f*f+e*e-g*g)/(2*f*e))/Math.PI:Math.acos((f*f+e*e-g*g)/(2*f*e))},_isPointInShape:function(a,b){var c=a.x,d=a.y;for(var e in b){e=parseInt(e);var f=b[e].x,g=b[e].y;if(c===f&&d===g)return!0}return!1},_generateSnapeSegments:function(a,b){for(var c,d=a.length,e=0;d>e;e++){var f=a[e],g=(e+1)%d,h=0>e-1?d-1:e-1,i=a[g],j=a[h],k=[],l=[];for(var m in f)c=f[m],this._isPointInShape(c,i)&&k.push(m),this._isPointInShape(c,j)&&l.push(m);f.length>=4&&(k=k.reverse());var n={};k.length>0&&(n["shape"+(g+1)]=k),l.length>0&&(n["shape"+(h+1)]=l),b[e]=n}},_generateRectRoadShapes:function(){for(var a=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,b=a.RECTROAD_OFFSET.LEFT,c=a.RECTROAD_OFFSET.TOP,d=a.OUTERROADWIDTH,e=a.OUTERROADHEIGHT,f=b+d,g=c+e,h=a.INNERROADWIDTH,i=a.INNERROADHEIGHT,j=b+(d-h)/2,k=c+(e-i)/2,l=j+h,m=k+i,n=[],o={},p=[],q=[],r=0;2>r;r++){var s,t;0===r?(s=k,t=c):(s=m,t=g);for(var u=15,v=30,w=124,x=j+v,y=this._generateNumber(0,u);-1!==p.indexOf(y);)y=this._generateNumber(0,u);p[p.length]=y;var z=x+y;x+=u,this._addIntoShape(z,s,b,t,n);for(;l-v>=x;){for(var A=this._generateNumber(-20,20);-1!==q.indexOf(A);)A=this._generateNumber(-20,20);q[q.length]=A;var B,C=t-s,D=this._getBaseLength(A,C);if(B=0>A?z-D:z+D,this._addIntoShape(z,s,B,t,n),x+=w,l-v>x){for(y=this._generateNumber(0,u);-1!==p.indexOf(y);)y=this._generateNumber(0,u);p[p.length]=y,z=x+y,x+=u}}this._addIntoShape(z,s,f,t,n)}q=[],v=20;for(var E=84,r=0;2>r;r++){var x,F;0===r?(x=l,F=f):(x=j,F=b);for(var s=k+v;m-v>=s;){var y=this._generateNumber(0,u),G=s+y;s+=u;for(var A=this._generateNumber(-10,10);-1!==q.indexOf(A);)A=this._generateNumber(-10,10);q[q.length]=A;var H,C=F-x,D=this._getBaseLength(A,C);H=0>A?G-D:G+D,this._addIntoShape(x,G,F,H,n),s+=E}}n=n.concat(n.splice(6,6));var I=n.length;n=n.concat(n.splice(I/2,I/2).reverse());for(var J=[],K=0;I>K;K++){var L=[];L=n[K].concat(n[(K+1)%I]),J[K]=L}n=J,n[0].splice(2,1),n[4].splice(2,1),n[8].splice(2,1),n[12].splice(2,1);var M={x:l,y:k},N={x:l,y:m},O={x:j,y:m},P={x:j,y:k};n[5].push(M),n[7].push(N),n[13].push(O),n[15].push(P);for(var K=0;I>K;K++)if(0!==K&&4!==K&&8!==K&&12!==K){var Q=n[K],R=Q[2];Q[2]=Q[3],Q[3]=R}this._generateSnapeSegments(n,o);var S=this.createShapeCollection(n,o);this.set("shapeCollection",S)},_generateZRoadShapes:function(){var a=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,b=a.ZROAD_OFFSET.LEFT,c=a.ZROAD_OFFSET.TOP,d=a.ZROADTOTALHEIGHT+c,e=a.ZROADTOTALWIDTH+b,f=[],g={},h=b,i=d,j=d-a.ZROADWIDTH,k=165,l=15,m=30,n=201,o=-1,p=[],q=-1;h+=k;var r=o=this._generateNumber(0,m);h+=r,this._addIntoShape(h,i,b,j,f);for(var s=this._generateNumber(-10,10);0===Math.abs(s);)s=this._generateNumber(-10,10);p[p.length++]=s;var t,u=a.ZROADWIDTH,v=this._getBaseLength(s,u);t=0>s?h-v:h+v,this._addIntoShape(h,i,t,j,f);var w=b+a.ZROAD_BOTTOM_PATH_WIDTH,x=w-a.ZROADWIDTH,y=d,z=d-a.ZROADWIDTH;z-=l;var r=this._generateNumber(0,m);q=r,z-=r,this._addIntoShape(w,y,x,z,f);for(var A=y-n,s=this._generateNumber(-10,10);s===p[0];)s=this._generateNumber(-10,10);p[p.length++]=s;var B,u=a.ZROADWIDTH,v=this._getBaseLength(s,u);B=0>s?A+v:A-v,this._addIntoShape(w,A,x,B,f);var C=c;y=C+a.ZROADWIDTH,y+=l;for(var r=this._generateNumber(0,m);Math.abs(r-q)<5;)r=this._generateNumber(0,m);y+=r,this._addIntoShape(w,y,x,C,f);var h=e,j=c,i=c+a.ZROADWIDTH;h-=165;for(var r=this._generateNumber(0,m);Math.abs(r-o)<7;)r=this._generateNumber(0,m);h-=r,this._addIntoShape(e,i,h,j,f);for(var s=this._generateNumber(-10,10);0===Math.abs(s)||s===p[0]||s===p[1];)s=this._generateNumber(-10,10);var t,u=a.ZROADWIDTH,v=this._getBaseLength(s,u);t=0>s?h+v:h-v,this._addIntoShape(t,i,h,j,f);var D=f.length;f=f.concat(f.splice(D-2,2).reverse());var E=[];E[0]=f[0];for(var F=0;D>F;F++){var G=[];F==D-1?E[F+1]=f[F]:(G=f[F].concat(f[F+1]),E[F+1]=G)}f=E,f[1].splice(2,1),f[6].splice(3,1);var H={x:b+a.ZROAD_BOTTOM_PATH_WIDTH-a.ZROADWIDTH,y:d-a.ZROADWIDTH},I={x:b+a.ZROAD_BOTTOM_PATH_WIDTH,y:c+a.ZROADWIDTH},J={x:b,y:d},K={x:e,y:c};f[2].push(H),f[5].push(I),f[0].push(J),f[7].push(K);for(var F=0;D>F;F++){if(2==F||3==F||4==F){var L=f[F],M=L[0];L[0]=L[1],L[1]=M}if(5==F){var L=f[F],M=L[2];L[2]=L[3],L[3]=M}}this._generateSnapeSegments(f,g),g[1].shape3=g[1].shape3.reverse(),g[6].shape8=g[6].shape8.reverse(),g[4].shape6=g[4].shape6.reverse();var N=this.createShapeCollection(f,g);this.set("shapeCollection",N)},_getShapesPosition:function(){var a,b,c,d=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,e={},f=0,g=88,h=[],i=this.get("pathDisplayed");i===d.ROADTYPES.RECTANGLESHAPED?(a=d.RECTROAD_SHAPES_SLOT,b=d.RECTROAD_QUADPOSITIONS.slice(0),c=d.RECTROAD_OTHERPOSITIONS.slice(0)):(a=d.ZROAD_SHAPES_SLOT,b=d.ZROAD_QUADPOSITIONS.slice(0),c=d.ZROAD_OTHERPOSITIONS.slice(0));for(var j in a){var k=a[j];h[f++]={x:k.LEFT+k.WIDTH/2,y:k.TOP+k.HEIGHT/2-g}}return e[d.POSITIONS]=h,e[d.QUADPOSITIONS]=b,e[d.OTHERPOSITIONS]=c,e},setAnglesType:function(a){var b=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,c=this.get("pathDisplayed"),d=a.models,e=d.length;if(c===b.ROADTYPES.RECTANGLESHAPED){for(var f in d)if(f=parseInt(f),4===f||7===f||12===f||15===f){var g=(f+1)%e,h=d[f],i=h.get("angles");i[2].isSupplementary=!1,h=d[g],i=h.get("angles"),i[1].isSupplementary=!1}}else for(var f in d){if(f=parseInt(f),0===f){var g=(f+1)%e,h=d[f],i=h.get("angles");i[1].isSupplementary=!1,h=d[g],i=h.get("angles"),i[1].isSupplementary=!1}if(2===f){var g=(f+1)%e,h=d[f],i=h.get("angles");i[2].isSupplementary=!1,h=d[g],i=h.get("angles"),i[1].isSupplementary=!1}if(4===f){var g=(f+1)%e,h=d[f],i=h.get("angles");i[3].isSupplementary=!1,h=d[g],i=h.get("angles"),i[1].isSupplementary=!1}if(6===f){var g=(f+1)%e,h=d[f],i=h.get("angles");i[2].isSupplementary=!1,h=d[g],i=h.get("angles"),i[0].isSupplementary=!1}}},createShapeCollection:function(a,b){for(var c=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,d=this.get("pathDisplayed"),e=this._getShapesPosition(),f=e[c.POSITIONS],g=e[c.QUADPOSITIONS],h=e[c.OTHERPOSITIONS],i=MathInteractives.Interactivities.PicturePerfect.Models.Shape,j=new MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads.ShapeCollection,k=0;k<a.length;k++){var l,m;m=d===c.ROADTYPES.RECTANGLESHAPED?4===a[k].length?g:h:5===a[k].length?h:g;var n=this._generateNumber(0,m.length-1),o=m[n]-1;l=f[o],m.splice(n,1);var p=this._getAngles(a[k]),q=-1;switch(a[k].length){case 3:q=i.SHAPE_TYPE.TRIANGULAR;break;case 4:q=i.SHAPE_TYPE.QUADRILATERAL;break;case 5:q=i.SHAPE_TYPE.CORNER}var r=new i;r.set({name:"shape"+(k+1),groupName:"shapeGroup"+(k+1),segments:a[k],snapIndices:b[k],rotation:this._generateNumber(-180,180),position:l,angles:p,type:q,slotNumber:o}),j.add(r)}return j},generatePathCoordinates:function(){this._generateRectPathCoordinates(),this._generateZPathCoordinates()},_generateRectPathCoordinates:function(){var a=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,b=a.RECTROAD_OFFSET.LEFT,c=a.RECTROAD_OFFSET.TOP,d=a.RECTROAD_OFFSET.SNAP,e=a.OUTERROADWIDTH,f=a.OUTERROADHEIGHT,g=a.INNERROADWIDTH,h=a.INNERROADHEIGHT,i=(f-h)/2,j=(e-g)/2,k=[{x:b-d,y:c-d},{x:b+e+d,y:c-d},{x:b+e+d,y:c+f+d},{x:b-d,y:c+f+d}],l=[{x:b+j+d,y:c+i+d},{x:b+j+g-d,y:c+i+d},{x:b+j+g-d,y:c+ +i+h-d},{x:b+j+d,y:c+ +i+h-d}];this.set("rectPathCoordinates",{outerRectCoordinates:k,innerRectCoordinates:l})},_generateZPathCoordinates:function(){var a=MathInteractives.Interactivities.PicturePerfect.Models.RepairRoads,b=a.ZROAD_OFFSET.LEFT,c=a.ZROAD_OFFSET.TOP,d=a.ZROAD_OFFSET.SNAP,e=a.ZROADWIDTH,f=a.ZROADTOTALWIDTH,g=a.ZROADTOTALHEIGHT,h=a.ZROAD_BOTTOM_PATH_WIDTH,i=a.ZROAD_TOP_PATH_WIDTH,j=[{x:b-d,y:c+g-e-d},{x:b-d,y:c+g+d},{x:b+h+d,y:c+g+d},{x:b+h+d,y:c+e+d},{x:b+f+d,y:c+e+d},{x:b+f+d,y:c-d},{x:b+f-i-d,y:c-d},{x:b+f-i-d,y:c+g-e-d}];this.set("zPathCoordinates",j)}},{ShapeCollection:Backbone.Collection.extend({model:MathInteractives.Interactivities.PicturePerfect.Models.Shape,initialize:function(){this.model=MathInteractives.Interactivities.PicturePerfect.Models.Shape}}),ROADTYPES:{RECTANGLESHAPED:0,ZSHAPED:1},OUTERROADWIDTH:708,OUTERROADHEIGHT:350,INNERROADWIDTH:492,INNERROADHEIGHT:154,POSITIONS:"positions",QUADPOSITIONS:"quadPositions",OTHERPOSITIONS:"otherPositions",ZROADTOTALWIDTH:725,ZROADTOTALHEIGHT:403,ZROADWIDTH:96,ZROAD_BOTTOM_PATH_WIDTH:401,ZROAD_TOP_PATH_WIDTH:420,BACKGROUND_CLASSES:{ZIGZAG:"zigzag-path",BROKEN_ZIGZAG:"broken-zigzag-path",RECTANGLE:"rectangle-path",BROKEN_RECTANGLE:"broken-rectangle-path"},ZROAD_SHAPES_SLOT:[{LEFT:13,TOP:246,WIDTH:234,HEIGHT:184},{LEFT:105,TOP:101,WIDTH:236,HEIGHT:126},{LEFT:394,TOP:105,WIDTH:236,HEIGHT:126},{LEFT:271,TOP:251,WIDTH:236,HEIGHT:126},{LEFT:276,TOP:392,WIDTH:234,HEIGHT:184},{LEFT:672,TOP:99,WIDTH:126,HEIGHT:236},{LEFT:519,TOP:364,WIDTH:236,HEIGHT:126},{LEFT:780,TOP:350,WIDTH:126,HEIGHT:236}],ZROAD_QUADPOSITIONS:[2,3,4,6,7,8],ZROAD_OTHERPOSITIONS:[1,5],RECTROAD_SHAPES_SLOT:[{LEFT:9,TOP:92,WIDTH:178,HEIGHT:216},{LEFT:164,TOP:96,WIDTH:222,HEIGHT:118},{LEFT:360,TOP:90,WIDTH:222,HEIGHT:118},{LEFT:556,TOP:90,WIDTH:178,HEIGHT:216},{LEFT:693,TOP:106,WIDTH:216,HEIGHT:178},{LEFT:0,TOP:279,WIDTH:222,HEIGHT:118},{LEFT:159,TOP:162,WIDTH:178,HEIGHT:216},{LEFT:261,TOP:225,WIDTH:225,HEIGHT:216},{LEFT:473,TOP:189,WIDTH:178,HEIGHT:216},{LEFT:612,TOP:307,WIDTH:222,HEIGHT:118},{LEFT:3,TOP:417,WIDTH:216,HEIGHT:178},{LEFT:164,TOP:374,WIDTH:222,HEIGHT:118},{LEFT:395,TOP:365,WIDTH:222,HEIGHT:118},{LEFT:313,TOP:480,WIDTH:222,HEIGHT:118},{LEFT:518,TOP:402,WIDTH:216,HEIGHT:178},{LEFT:706,TOP:414,WIDTH:216,HEIGHT:178}],RECTROAD_QUADPOSITIONS:[2,3,6,8,10,12,13,14],RECTROAD_OTHERPOSITIONS:[1,4,5,7,9,11,15,16],CURSOR_TYPE:{DEFAULT:0,OPEN_HAND:1,CLOSE_HAND:2},RECTROAD_OFFSET:{TOP:90,LEFT:89,SNAP:20},ZROAD_OFFSET:{TOP:55,LEFT:67,SNAP:20},PATH_SNAP_OFFSET:20})}(),function(){"use strict";MathInteractives.Interactivities.PicturePerfect.Models.Shape=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:{name:null,segments:null,segmentsGroup:null,snapIndices:null,rotation:null,position:null,angles:null,isSelected:!1,type:null,notUsable:!1,isSnappedToRoad:!1,paperGroupElem:null,isGroupedWith:null,snappedToX:!1,snappedToY:!1,snappedToPath:!1,snappedToWrongX:!1,snappedToWrongY:!1,snappedToWrongPath:!1},initialize:function(){}},{SHAPE_TYPE:{TRIANGULAR:0,QUADRILATERAL:1,CORNER:3}})}(),function(){"use strict";MathInteractives.Interactivities.PicturePerfect.Views.OverviewTab=MathInteractives.Common.Player.Views.Base.extend({initialize:function(){this.initializeDefaultProperties(),this.render()},render:function(){this.loadScreen("title-screen"),this.listenTo(this.player,MathInteractives.Common.Components.Theme2.Views.OverviewTab.GO_BUTTON_CLICKED,this.onGoButtonClicked)},onGoButtonClicked:function(){this.player.switchToTab(1)}})}(),function(){var a=Handlebars.template,b=MathInteractives.Interactivities.PicturePerfect.templates=MathInteractives.Interactivities.PicturePerfect.templates||{};b.overviewTab=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'overview-tab-container" class="overview-tab-container"></div>'})}();