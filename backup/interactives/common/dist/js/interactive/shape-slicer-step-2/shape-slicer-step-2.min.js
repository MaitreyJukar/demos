THREE.CustomTrackball=function(a,b){function c(a){if(g.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),p.y+=.01*b,g.dispatchEvent(w),g.dispatchEvent(x)}}function d(a){if(g.enabled!==!1){switch(a.touches.length){case 1:k=h.TOUCH_ROTATE,n.copy(z(a.touches[0].pageX,a.touches[0].pageY)),o.copy(n);break;case 2:k=h.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;s=r=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;t.copy(y(d,e)),u.copy(t);break;default:k=h.NONE}g.dispatchEvent(w)}}function e(a){if(g.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:o.copy(z(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;s=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;u.copy(y(d,e));break;default:k=h.NONE}}function f(a){if(g.enabled!==!1){switch(a.touches.length){case 1:o.copy(z(a.touches[0].pageX,a.touches[0].pageY)),n.copy(o);break;case 2:r=s=0;var b=(a.touches[0].pageX+a.touches[1].pageX)/2,c=(a.touches[0].pageY+a.touches[1].pageY)/2;u.copy(y(b,c)),t.copy(u)}k=h.NONE,g.dispatchEvent(x)}}var g=this,h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.skipCount=1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=1e-6,j=new THREE.Vector3,k=h.NONE,l=h.NONE,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Vector2,q=new THREE.Vector2,r=0,s=0,t=new THREE.Vector2,u=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var v={type:"change"},w={type:"start"},x={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft,this.screen.top=a.top+window.pageYOffset-b.clientTop,this.screen.width=a.width,this.screen.height=a.height}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)};var y=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-g.screen.left)/g.screen.width,(c-g.screen.top)/g.screen.height),a}}(),z=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e){c.set((d-.5*g.screen.width-g.screen.left)/(.5*g.screen.width),(.5*g.screen.height+g.screen.top-e)/(.5*g.screen.height),0);var f=c.length();return g.noRoll?f<Math.SQRT1_2?c.z=Math.sqrt(1-f*f):c.z=.5/f:f>1?c.normalize():c.z=Math.sqrt(1-f*f),m.copy(g.object.position).sub(g.target),a.copy(g.object.up).setLength(c.y),a.add(b.copy(g.object.up).cross(m).setLength(c.x)),a.add(m.setLength(c.z)),a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var c=Math.acos(n.dot(o)/n.length()/o.length());c&&(a.crossVectors(n,o).normalize(),c*=g.rotateSpeed,b.setFromAxisAngle(a,-c),m.applyQuaternion(b),g.object.up.applyQuaternion(b),o.applyQuaternion(b),g.staticMoving?n.copy(o):(b.setFromAxisAngle(a,c*(g.dynamicDampingFactor-1)),n.applyQuaternion(b)))}}(),this.zoomCamera=function(){if(k===h.TOUCH_ZOOM_PAN){var a=r/s;r=s,m.multiplyScalar(a)}else{var a=1+(q.y-p.y)*g.zoomSpeed;1!==a&&a>0&&(m.multiplyScalar(a),g.staticMoving?p.copy(q):p.y+=(q.y-p.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(u).sub(t),a.lengthSq()&&(a.multiplyScalar(m.length()*g.panSpeed),c.copy(m).cross(g.object.up).setLength(a.x),c.add(b.copy(g.object.up).setLength(a.y)),g.object.position.add(c),g.target.add(c),g.staticMoving?t.copy(u):t.add(a.subVectors(u,t).multiplyScalar(g.dynamicDampingFactor)))}}(),this.checkDistances=function(){g.noZoom&&g.noPan||(m.lengthSq()>g.maxDistance*g.maxDistance&&g.object.position.addVectors(g.target,m.setLength(g.maxDistance)),m.lengthSq()<g.minDistance*g.minDistance&&g.object.position.addVectors(g.target,m.setLength(g.minDistance)))},this.update=function(){m.subVectors(g.object.position,g.target),g.noRotate||g.rotateCamera(),g.noZoom||g.zoomCamera(),g.noPan||g.panCamera(),g.object.position.addVectors(g.target,m),g.checkDistances(),g.object.lookAt(g.target),j.distanceToSquared(g.object.position)>i&&(g.dispatchEvent(v),j.copy(g.object.position))},this.reset=function(){k=h.NONE,l=h.NONE,g.target.copy(g.target0),g.object.position.copy(g.position0),g.object.up.copy(g.up0),m.subVectors(g.object.position,g.target),g.object.lookAt(g.target),g.dispatchEvent(v),j.copy(g.object.position)},this.mousedown=function(a){g.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g.counter=0,k===h.NONE&&(k=a.button),k!==h.ROTATE||g.noRotate?k!==h.ZOOM||g.noZoom?k!==h.PAN||g.noPan||(t.copy(y(a.pageX,a.pageY)),u.copy(t)):(p.copy(y(a.pageX,a.pageY)),q.copy(p)):(n.copy(z(a.pageX,a.pageY)),o.copy(n)),document.addEventListener("mousemove",g.mousemove,!1),document.addEventListener("mouseup",g.mouseup,!1),g.dispatchEvent(w))},this.mousemove=function(a){if(g.enabled!==!1){if(g.counter%g.skipCount===0)if(a.preventDefault(),a.stopPropagation(),k!==h.ROTATE||g.noRotate)k!==h.ZOOM||g.noZoom?k!==h.PAN||g.noPan||u.copy(y(a.pageX,a.pageY)):q.copy(y(a.pageX,a.pageY));else{o.copy(z(a.pageX,a.pageY))}g.counter++}},this.mouseup=function(a){g.enabled!==!1&&(g.counter=0,a.preventDefault(),a.stopPropagation(),k=h.NONE,document.removeEventListener("mousemove",g.mousemove),document.removeEventListener("mouseup",g.mouseup),g.dispatchEvent(x))},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",g.mousedown,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",d,!1),this.domElement.addEventListener("touchend",f,!1),this.domElement.addEventListener("touchmove",e,!1),this.handleResize(),this.update()},THREE.CustomTrackball.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.CustomTrackball.prototype.constructor=THREE.CustomTrackball,function(){"use strict";if(!MathInteractives.Common.Interactivities.ShapeSlicer.Views.ExploreShapeSlicer){var a=null,b=MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer.EVENT_MANAGER_MODEL,c=MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer;MathInteractives.Common.Interactivities.ShapeSlicer.Views.ExploreShapeSlicer=MathInteractives.Common.Player.Views.Base.extend({shape3DView:null,shape2DView:null,_directionTextView:null,_resetButtonView:null,errorToolTip:null,_rotateAboutXAxisButtonView:null,_rotateAboutYAxisButtonView:null,_rotateAboutZAxisButtonView:null,_sliceButtonView:null,_shapeButtonsArray:null,popUpView:null,isRotationDown:null,eventManager:null,timer:null,_lastSpaceKeyUpEvent:null,_previousSpaceKeyDownCount:0,_currentSpaceKeyDownCount:0,_keyUpInterval:null,initialize:function(){var c=this;this.initializeDefaultProperties(),a=MathInteractives.Common.Interactivities.ShapeSlicer.Views.ExploreShapeSlicer,this.eventManager=this.model.get("eventManager"),this.render(),this._bindEvents(),this.loadScreen("help-screen"),this._setHelpElements(),this.model.updatePreviousSaveState(),this.player.bindTabChange(function(a){c.model.set("currentTab",1),c.updateFocusRect("explore-tab-direction-text-direction-text-text"),c.eventManager.trigger(b.TAB_CHANGED,1),a.isLetsGoClicked!==!0&&c.setFocus("explore-tab-direction-text-direction-text-text")},c,1),this.model.set("saveStateLoad",!1)},render:function(){this._preloadImagePath(),this._setBackground(),this.loadScreen("explore-tab-screen"),this._initializeDirectionText(),this._createShapeButtons(),this._initialize3DPanel(),this._initialize2DPanel(),this._createButtons(),this._renderToolTip(),this.loadScreen("acc-text-screen"),this.loadScreen("button-acc-screen"),this._loadAccText(),this._disableAllButtons()},_bindEvents:function(){var a=this,c=(this.shape3DView,MathInteractives.Common.Utilities.Models.Utils),d=this.eventManager,e=MathInteractives.Common.Player.Views.Player.Events;this.model.on("change:noOfSlicedShapes",this._onSlicedShapesCountChange,this),this.model.on("change:isSliceShapeButtonEnabled",this._enableDisableSliceButton,this),d.on(b.POINTS_ON_SAME_EDGE,$.proxy(this._showSamePoint,this,1)),d.on(b.POINTS_ON_SAME_FACE,$.proxy(this._showSamePoint,this,2)),d.on(b.CLICK_ON_3D_CANVAS,this._hideToolTip,this),d.on(b.DISABLE_HOVER,this._disableHover,this),d.on(b.ENABLE_HOVER,this._enableHover,this),d.on(b.DISABLE_BUTTON_ON_COLOR_PICKER,this._disableButtonOnColorPicker,this),d.on(b.ENABLE_BUTTON_ON_COLOR_PICKER,this._enableButtonOnColorPicker,this),d.off(b.ENABLE_TRY_ANOTHER).on(b.ENABLE_TRY_ANOTHER,this._enableTryAnother,this),d.off(b.DISABLE_TRY_ANOTHER).on(b.DISABLE_TRY_ANOTHER,this._disableTryAnother,this),d.off(b.SET_RESET_BUTTON_STATE).on(b.SET_RESET_BUTTON_STATE,this._setResetButtonState,this),d.off(b.EDIT_IMAGE,this._onEditButtonClicked).on(b.EDIT_IMAGE,this._onEditButtonClicked,this),this.$(".reset-button-container").off("click.reset").on("click.reset",$.proxy(a._resetButtonClickHandler,a)),this.$(".slice-button-container").off("click.slice").on("click.slice",$.proxy(a._sliceButtonClickHandler,a)),this.$(".rotate-button").off("mousedown").on("mousedown",$.proxy(a._rotateBtnMouseDownHandler,a)).off("keydown.rotate-button").on("keydown.rotate-button",function(b){(32===b.keyCode||13===b.keyCode)&&a._handleSpaceUpTrigger(b)}).off("keyup.rotate-button").on("keyup.rotate-button",function(b){(32===b.keyCode||13===b.keyCode)&&(b.preventDefault(),a._lastSpaceKeyUpEvent=b)}),this.errorToolTip.$("#"+this.idPrefix+"tooltip-display-container-tooltip-text-container").off("keydown.hideToolTip").on("keydown.hideToolTip",function(b,c){9===b.keyCode&&b.shiftKey&&(b.preventDefault(),a._handleFocusOutOnToolTip(b,!0))}),this.errorToolTip.$(".error-tooltip-tts-button").off("keydown.hideToolTip").on("keydown.hideToolTip",function(b,c){9!==b.keyCode||b.shiftKey||(b.preventDefault(),a._handleFocusOutOnToolTip(b,!1))}),c.DisableTouch(this.$(".rotate-button")),c.EnableTouch(this.$(".rotate-button"),0),$(window).off("unload.shapeSlicer").on("unload.shapeSlicer",$.proxy(a._onInteractiveUnload,a)),this.player.off(e.UNLOAD_INTERACTIVE,$.proxy(a._onInteractiveUnload,a)).on(e.UNLOAD_INTERACTIVE,$.proxy(a._onInteractiveUnload,a)),this.player.off(e.SCREENSHOT_START,$.proxy(a.onScreenshotStart,a)).on(e.SCREENSHOT_START,$.proxy(a.onScreenshotStart,a)),this.player.off(e.SCREENSHOT_END,$.proxy(a.onScreenshotEnd,a)).on(e.SCREENSHOT_END,$.proxy(a.onScreenshotEnd,a))},_handleFocusOutOnToolTip:function(a,b){var d=this.model.get("noOfSlicedShapes")===c.MAX_SLICE_SHAPES-1;this.shape3DView.canvasAcc.model.set("disableSelfFocusOnSpace",!1),d&&!b?(this.shape3DView.canvasAcc.updatePaperItems(this.shape3DView.getPaperObjects(),!1),this.shape3DView.canvasAcc.setCurrentPaperItem(this.shape3DView.getPaperObjects()[0],!1),this.setFocus("right-panel-canvas-acc-container")):this.setFocus("canvas-acc-container"),this._hideToolTip()},_loadAccText:function(){for(var a=this.model.get("numberOfShapes"),b=this.model.get("shapeNumber"),c=this.getAccMessage("shape-button-common-text",0),d=0;a>d;d++)this.setAccMessage("shape-button-container-"+d,this.getAccMessage("shape-button-container-"+d,0,[c]));this.setAccMessage("shape-button-container-"+b,this.getAccMessage("shape-button-container-"+b,0,[this.getAccMessage("shape-button-common-text",1)])),this.setAccMessage("canvas-acc-container",this.getAccMessage("shape-button-container-"+b,0,[this.getAccMessage("shape-button-common-text",2)]))},onScreenshotStart:function(){var a=this.$(".activity-canvas"),b=this.$(".activity-canvas-screenshot-hack");this.shape3DView._renderScene(),b.css({"background-image":"url("+a[0].toDataURL()+")"}),a.hide(),b.show()},onScreenshotEnd:function(){var a=this.$(".activity-canvas"),b=this.$(".activity-canvas-screenshot-hack");b.css({"background-image":""}),b.hide(),a.show()},_onInteractiveUnload:function(){var a=this;this.eventManager.trigger(b.UNLOAD_INTERACTIVE),this.model.set("activityLoaded",!1),window.cancelAnimationFrame(this.shape3DView.lastAnimationFrame),$.each(this.shape3DView.shapeViewArr,function(b,c){c.parent.disposeObjects(c.scene),c.parent.disposeObjects(c.frontScene),a._removeDummyLines(c),c.destroy(),c.unbind(),c.remove(),c.model.defaults(),c.model.destroy(),c=null}),this._unbindShape2DViewEvents(),this.shape2DView.destroy(),this.shape2DView.unbind(),this.shape2DView.remove(),this.shape2DView.model.defaults(),this.shape2DView.model.destroy(),this.shape2DView=null,this.shape3DView.shapeViewArr.length=0,this.shape3DView.shapeViewArr=null,this.shape3DView.renderer.domElement&&$(this.shape3DView.renderer.domElement).remove(),this.shape3DView.renderer=null,this.shape3DView.unbind(),this.shape3DView.remove(),this.shape3DView=null,this.destroy(),this.unbind(),this.remove(),this.model.defaults(),this.model.destroy(),$(window).off("unload.shapeSlicer")},_unbindShape2DViewEvents:function(){var a=this,b=this.shape2DView.allShapesGroup;b.children.forEach(function(b){a.shape2DView._unbindShapeEvents(b.children.shape)}),this.shape2DView.paperScope.paper.project.activeLayer.removeChildren()},_removeDummyLines:function(a){a.getLines().length=0},_enableHover:function(a){this.$(".hover-modal").removeClass("hover-modal-show")},_disableHover:function(a){this.$(".hover-modal").not(a.currSelector).addClass("hover-modal-show")},_enableButtonOnColorPicker:function(a){this.$(".buttons-to-be-disabled").removeClass("disabled-modal-buttons"),this._directionTextView.$(".buttons-to-be-disabled").removeClass("disabled-modal-buttons")},_disableButtonOnColorPicker:function(a){this.$(".buttons-to-be-disabled").addClass("disabled-modal-buttons"),this._directionTextView.$(".buttons-to-be-disabled").addClass("disabled-modal-buttons")},_enableTryAnother:function(){this._directionTextView.changeButtonState(MathInteractives.global.Theme2.Button.BUTTON_STATE_ACTIVE),this.model.set("isTryAnotherButtonEnabled",!0),this.eventManager.off(b.ENABLE_TRY_ANOTHER)},_disableTryAnother:function(){this._directionTextView.changeButtonState(MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED),this.model.set("isTryAnotherButtonEnabled",!1),this.eventManager.off(b.DISABLE_TRY_ANOTHER)},_onEditButtonClicked:function(){var a=this.model.get("interacivityType"),b=c.DEFAULT_SHAPE[a],d=this,e={currentTarget:d.$(".shape-button-container-"+b)[0]};this._shapeButtonClickHandler(e),this.model.set("shapeNumber",b)},_initialize3DPanel:function(){var a=this;this.shape3DView=new MathInteractives.Common.Interactivities.ShapeSlicer.Views.Shape3D({model:a.model,el:a.$el,idPrefix:a.idPrefix,parent:this})},_initialize2DPanel:function(){var a=this.model.get("shape2DModel");if(null===a)a=new MathInteractives.Common.Interactivities.ShapeSlicer.Models.Shape2D({player:this.player});else{var b=$.extend(!0,a,{player:this.player});a=new MathInteractives.Common.Interactivities.ShapeSlicer.Models.Shape2D(b)}this.model.set("shape2DModel",a),this.shape2DView=new MathInteractives.Common.Interactivities.ShapeSlicer.Views.Shape2D({mainModel:this.model,model:a,el:this.$(".explore-tab-right-part-container")})},_preloadImagePath:function(){var a=new Image,b=null;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAJBAMAAAD9                        fXAdAAAAMFBMVEX3+fzHyMr5+/7Iyc3////7/f/HyMzFxsnDw8b29/nKy8/Mzc7                        v7/LR0tTy8vTR09adT6jjAAAANUlEQVQI12PYIXuSj0FF81Y1AwtDYSNDkMJGQQb                        VAMMyBvP+Iw4MUoYBDAzJGQ4MDGZWExQADmYLJSOawaMAAAAASUVORK5CYII=",this.spriteImagePath=this.getImagePath("sprites"),b=this.getImagePath("color-picker")},_setBackground:function(){this.$el.css({"background-image":'url("'+this.spriteImagePath+'")'}),this.$el.find(".explore-tab-left-part-container").css({"background-image":'url("'+this.spriteImagePath+'")'})},destroy:function(){this.shape3DView=null,this.shape2DView=null,this._directionTextView=null,this._resetButtonView=null,this.errorToolTip=null,this._rotateAboutXAxisButtonView=null,this._rotateAboutYAxisButtonView=null,this._rotateAboutZAxisButtonView=null,this._sliceButtonView=null,this._shapeButtonsArray=null,this.popUpView=null,this.eventManager=null},_initializeDirectionText:function(){var a=this.idPrefix,b={containerId:a+"explore-tab-direction-text",idPrefix:a,player:this.player,manager:this.manager,path:this.filePath,text:this.getMessage("explore-tab-direction-text-text",0),accText:this.getAccMessage("explore-tab-direction-text-text",0),showButton:!0,buttonText:this.getMessage("explore-tab-direction-text-text",1),containmentBGcolor:"rgba(0, 0, 0,0)",buttonHeight:38,btnTextColor:"#000000",clickCallback:{fnc:this._onTryAnotherClick,scope:this},textColor:"#ffffff",tabIndex:500,buttonTabIndex:1e3,btnBaseClass:"shape-slicer-white-button-base",ttsBaseClass:"shape-slicer-tts-button"};this._directionTextView=MathInteractives.global.Theme2.DirectionText.generateDirectionText(b),this._directionTextView.tryAnotherView.$el.addClass("buttons-to-be-disabled"),this._directionTextView.ttsView.$el.addClass("buttons-to-be-disabled"),this.model.get("isTryAnotherButtonEnabled")||this._directionTextView.changeButtonState(MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED)},_onTryAnotherClick:function(){this.stopReading(),this.model.compareSavedState(1)?this._resetPositiveClick():this._showPopup(this.getMessage("reset-popup",0),this.getMessage("reset-popup",1))},_showPopup:function(a,b){var c,d,e=this;c={title:a,accTitle:"",text:b,accText:"",manager:e.manager,player:e.player,path:e.filePath,idPrefix:e.idPrefix,type:MathInteractives.global.Theme2.PopUpBox.CONFIRM,closeCallback:{fnc:function(a){a.isPositive?e._resetPositiveClick():e.setFocus("explore-tab-direction-text-direction-text-buttonholder")},scope:e},buttons:[{id:e.idPrefix+"ok-btn",text:e.getMessage("reset-popup",2),response:{isPositive:!0,buttonClicked:e.idPrefix+"ok-btn"}},{id:e.idPrefix+"cancel-btn",text:e.getMessage("reset-popup",3),response:{isPositive:!1,buttonClicked:e.idPrefix+"cancel-btn"}}]},d=MathInteractives.global.Theme2.PopUpBox.createPopup(c)},_resetPositiveClick:function(){this._clearAfterResetClick(),this.eventManager.trigger(b.DISABLE_TRY_ANOTHER),this.eventManager.off(b.ENABLE_TRY_ANOTHER).on(b.ENABLE_TRY_ANOTHER,this._enableTryAnother,this),this.eventManager.off(b.DISABLE_TRY_ANOTHER).on(b.DISABLE_TRY_ANOTHER,this._disableTryAnother,this)},_clearAfterResetClick:function(){var a,b={currentTarget:$("#"+this.idPrefix+"shape-button-container-"+c.DEFAULT_SHAPE[this.model.get("interacivityType")])[0]},d=this.model.get("galleryObject");this._resetAllShapeHandler(),this.shape2DView.resetView(),this._shapeButtonClickHandler(b),this.model.updatePreviousSaveState(),a=d.length,this.model.set("currentGalleryIndex",a),this.setFocus("explore-tab-activity-area")},_createButtons:function(){this._createRotatePanelButtons(),this._createOtherButtons()},_createRotatePanelButtons:function(){var a={},b=MathInteractives.global.Theme2.Button,d=c.RESET_ROTATE_BUTTON_HEIGHT,e=c.RESET_ROTATE_BUTTON_WIDTH;a={player:this.player,manager:this.manager,path:this.filePath,idPrefix:this.idPrefix,data:{type:b.TYPE.FA_ICON,height:d,width:e,tooltipText:this.getMessage("reset-tooltip",0),tooltipType:MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.RIGHT_MIDDLE,id:this.idPrefix+"reset-button-container",icon:{faClass:this.filePath.getFontAwesomeClass("fixed-reset"),height:d,width:e},baseClass:"shape-slicer-white-button-base"}},this._resetButtonView=b.generateButton(a),a={player:this.player,manager:this.manager,path:this.filePath,idPrefix:this.idPrefix,data:{id:this.idPrefix+"rotate-about-x-axis-button-container",type:b.TYPE.ICON,height:d,width:e,baseClass:"shape-slicer-white-button-base",tooltipText:this.getMessage("rotate-about-x-axis",0),tooltipType:MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.RIGHT_MIDDLE,icon:{iconPath:this.spriteImagePath,height:d,width:e}}},this._rotateAboutXAxisButtonView=b.generateButton(a),a.data.id=this.idPrefix+"rotate-about-y-axis-button-container",a.data.tooltipText=this.getMessage("rotate-about-y-axis",0),this._rotateAboutYAxisButtonView=b.generateButton(a),a.data.id=this.idPrefix+"rotate-about-z-axis-button-container",a.data.tooltipText=this.getMessage("rotate-about-z-axis",0),this._rotateAboutZAxisButtonView=b.generateButton(a)},_createOtherButtons:function(){var a=MathInteractives.global.Theme2.Button,b={player:this.player,manager:this.manager,path:this.filePath,idPrefix:this.idPrefix,data:{id:this.idPrefix+"slice-button-container",type:a.TYPE.TEXT,baseClass:"shape-slicer-white-button-base",text:this.getMessage("slice-button-container-text",0)}};this._sliceButtonView=a.generateButton(b)},_disableAllButtons:function(){var a=this.shape3DView.shapeViewArr[this.model.get("shapeNumber")],b=this.model.get("noOfSlicedShapes"),c=this.shape2DView;this._setResetButtonState(a.model.get("isResetButtonEnable")),this._enableDisableSliceButton(),c._enableClearButton(b>0),c._onSaveImageButtonStatusChange(),c._onGalleryObjectsCountChange()},_setResetButtonState:function(a){var b=MathInteractives.global.Theme2.Button;a?this._resetButtonView.setButtonState(b.BUTTON_STATE_ACTIVE):this._resetButtonView.setButtonState(b.BUTTON_STATE_DISABLED)},_resetButtonClickHandler:function(a){if($(a.currentTarget).hasClass("clickEnabled")){var c=this.shape3DView,d=c.shapeViewArr[this.model.get("shapeNumber")];this.eventManager.trigger(b.DESELECT_SHAPE),a.stopPropagation(),this.stopReading(),d.controls.reset(),d.model.setCameraInitialValues(),c.setShapeCameraValuesFromModel(d),c._renderScene(d),d.model.set("isResetButtonEnable",!1),this.setFocus("canvas-acc-container")}},_resetAllShapeHandler:function(){var a=this.shape3DView,b=a.shapeViewArr;$.each(b,function(b,c){a.resetPointSelection(c),c.model.setCameraInitialValues(),a.setShapeCameraValuesFromModel(c),a._renderScene(c),c.model.set("isResetButtonEnable",!1)})},_rotateBtnMouseDownHandler:function(a){var c=MathInteractives.Common.Utilities.Models.BrowserCheck;if(!this.isShapeRotating&&$(a.currentTarget).hasClass("clickEnabled")&&(a.isTrigger||1===a.which||c.isMobile===!0)){var d=this,e=null,f=new RegExp("[xyz]"),g=null,h=100,i=23,j=0,k=60,l=1,m=$(a.currentTarget),n=(MathInteractives.Common.Utilities.Models.Utils,this.shape3DView.shapeViewArr[this.model.get("shapeNumber")]);d.eventManager.trigger(b.ENABLE_TRY_ANOTHER,a),d.eventManager.trigger(b.DESELECT_SHAPE),d.model.set("requestAnimation",!0),d.shape3DView._animate(),m.addClass("downState"),a.stopPropagation(),this.stopReading(),this.isRotationDown=!0,$(document).off("mouseup.document-click"+d.idPrefix+" touchend.document-click"+d.idPrefix+" touchcancel.document-click"+d.idPrefix).on("mouseup.document-click"+d.idPrefix+" touchend.document-click"+d.idPrefix+" touchcancel.document-click"+d.idPrefix,$.proxy(d._stopRotating,d)),n.model.set("isResetButtonEnable",!0),g=m[0].className.match(f),a.isTrigger||this._rotateShape(g[0]),this.isShapeRotating=!0,e=function(){d.isShapeRotating&&(d._rotateShape(g[0],i),h>j&&(h-=l,!Detector.webgl&&k>i&&i++),this.timer&&window.clearTimeout(this.timer),window.setTimeout(e,h))},this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(e,500),m.off("mouseup.rotateStop").on("mouseup.rotateStop",$.proxy(d._rotateBtnMouseUpHandler,d))}},_rotateBtnMouseUpHandler:function(a){if($(a.currentTarget).hasClass("clickEnabled")&&!a.isTrigger){var b=$(a.currentTarget),c=this.shape3DView,d=this.model.get("shapeNumber"),e=c.shapeViewArr[d];e.controls.mouseup(a),this._stopRotating(a),b.off("mouseup.rotateStop")}},_handleSpaceUpTrigger:function(a){var b,c,d=this,e=300;d._previousSpaceKeyDownCount=d._currentSpaceKeyDownCount,d._currentSpaceKeyDownCount++,0===d._previousSpaceKeyDownCount&&(d._keyUpInterval&&window.clearInterval(d._keyUpInterval),d._keyUpInterval=window.setInterval(function(){d._previousSpaceKeyDownCount===d._currentSpaceKeyDownCount?(window.clearInterval(d._keyUpInterval),d._keyUpInterval=null,d._previousSpaceKeyDownCount=0,d._currentSpaceKeyDownCount=0,d._rotateBtnMouseUpHandler(d._lastSpaceKeyUpEvent),b=new RegExp("[xyz]"),c=d._lastSpaceKeyUpEvent.currentTarget.className.match(b)[0],d.setAccMessage("canvas-acc-container",d.getAccMessage("canvas-acc-container",6,[c])),d.setFocus("canvas-acc-container"),d.setAccMessage("canvas-acc-container",d.getAccMessage("shape-button-container-"+d.model.get("shapeNumber"),0,[d.getAccMessage("shape-button-common-text",2)])),d._lastSpaceKeyUpEvent=null):d._lastSpaceKeyUpEvent&&(d._previousSpaceKeyDownCount=d._currentSpaceKeyDownCount)},e))},_rotateShape:function(a,b){var d=this.shape3DView,e=d.shapeViewArr[this.model.get("shapeNumber")],f=null,g=null,h=null,i=this.$(".activity-canvas-wrapper canvas")[0],j=$(i).offset(),k=c.LEFT_CANVAS,l=null,m=null,n=null,o=null,p=MathInteractives.Common.Utilities.Models.BrowserCheck;switch(this._hideToolTip(),b=b||23,a){case"x":l=j.left+k.WIDTH/2,m=j.top+k.HEIGHT/2,n=j.left+k.WIDTH/2,o=j.top+k.HEIGHT/2-b;break;case"y":l=j.left+k.WIDTH/2,m=j.top+k.HEIGHT/2,n=j.left+k.WIDTH/2+b,o=j.top+k.HEIGHT/2;break;case"z":l=j.left+k.WIDTH/2,m=j.top,n=j.left+k.WIDTH/2-b,o=j.top}p.isIE||p.isIE11?(f=document.createEvent("CustomEvent"),f.initCustomEvent("mousedown",!0,!0,{}),g=document.createEvent("CustomEvent"),g.initCustomEvent("mousemove",!0,!0,{}),h=document.createEvent("CustomEvent"),h.initCustomEvent("mouseup",!0,!0,{})):(f=new CustomEvent("mousedown",{eventPhase:2}),g=new CustomEvent("mousemove",{eventPhase:2}),h=new CustomEvent("mouseup",{eventPhase:3})),f.button=0,g.button=0,f.pageX=l,f.pageY=m,g.pageX=n,g.pageY=o,h.isCustom=!0,e.controls.mousedown(f),e.controls.mousemove(g),e.controls.mouseup(h)},_stopRotating:function(a){if(!a.isTrigger&&!a.originalEvent.isCustom){var b=this;this.isRotationDown=!1,this.$(".rotate-button").removeClass("downState"),this.isShapeRotating=!1,window.clearInterval(b.timerId),$(document).off(".document-click"+b.idPrefix),b.model.set("requestAnimation",!1)}},_sliceButtonClickHandler:function(a){if($(a.currentTarget).hasClass("clickEnabled")){this.stopReading();var d=this.model.get("noOfSlicedShapes")+1;d<c.MAX_SLICE_SHAPES?(this.model.set("noOfSlicedShapes",d),this.eventManager.trigger(b.SHAPE_SLICED,a),this.setFocus("explore-tab-right-part-container")):(this.errorToolTip.changeText(this.getMessage("tool-tip-text",0)),this.errorToolTip.showTooltip(),this.setTabIndex("tooltip-display-container-tooltip-text-container",745),this.setTabIndex("tooltip-display-container-tooltip-tts-sound-btn",747),this.setFocus("tooltip-display-container-tooltip-text-container"),this.model.set("isSliceShapeButtonEnabled",!1))}},_onSlicedShapesCountChange:function(){var a=this.model.get("noOfSlicedShapes"),b=this.shape3DView,d=this.model.get("shapeNumber"),e=b.shapeViewArr[d],f=e.model.get("pointChecker");this.model.set("isSliceShapeButtonEnabled",f&&a<c.MAX_SLICE_SHAPES)},_enableDisableSliceButton:function(){var a=this.model.get("isSliceShapeButtonEnabled")?MathInteractives.global.Theme2.Button.BUTTON_STATE_ACTIVE:MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED;this._sliceButtonView.setButtonState(a)},_renderToolTip:function(){var a=MathInteractives.global.Theme2.Tooltip,b=this,c=MathInteractives.Common.Components.Theme2.Views.Tooltip,d={_player:b.player,idPrefix:this.idPrefix,manager:b.manager,filePath:b.filePath,type:c.TYPE.FORM_VALIDATION,isTts:!0,tabIndex:635,ttsBaseClass:"error-tooltip-tts-button",accDivOffset:{offsetTop:-5,offsetLeft:-5}};d.containerWidth=390,d.id=b.idPrefix+"maximum-slice-tooltip",d.elementEl=b.idPrefix+"tooltip-display-container",d.isArrow=!1,d.closeOnDocumentClick=!0,b.errorToolTip=a.generateTooltip(d)},_showSamePoint:function(a){this.model.get("shapeNumber");this.errorToolTip.changeText(this.getMessage("tool-tip-text",a)),this.setAccMessage("canvas-acc-container",this.getAccMessage("canvas-acc-container",3)+". "+this.getAccMessage("canvas-acc-container",2)),this.errorToolTip.showTooltip(),this.errorToolTip.$el.find(".tts-container").css({"margin-top":"5px","margin-right":"5px"}),this.setTabIndex("tooltip-display-container-tooltip-text-container",635),this.setTabIndex("tooltip-display-container-tooltip-tts-sound-btn",637),this.setFocus("tooltip-display-container-tooltip-text-container")},_hideToolTip:function(){this.errorToolTip.hideTooltip(),this.stopReading()},_createShapeButtons:function(){this.loadScreen("shape-buttons-screen");var b,d=this.model,e=d.get("type"),f=d.get("numberOfShapes"),g=this.idPrefix,h="shape-button-container-",i=MathInteractives.global.Theme2.Button,j=a.THUMBNAIL_SIZE,k=a.BUTTON_WIDTH,l=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?k.TOUCH:k.NON_TOUCH,m={player:this.player,manager:this.manager,path:this.filePath,idPrefix:g,data:{type:i.TYPE.ICONTEXT,baseClass:"shape-button-base",height:44,width:l}},n=0,o=this.$el.find(".shape-buttons-panel"),p=c.SHAPES[e];for(this._shapeButtonsArray=[],n=0;f>n;n++){var q=this._fetchButtonContainer(n),r=p[n].toLowerCase(),s=null;o.append(q),m.data.id=g+h+n,m.data.text=this.getMessage(r+"-button-label",0),m.data.icon={iconPath:this.spriteImagePath,width:j[r.toUpperCase()][0],height:j[r.toUpperCase()][1]},s=i.generateButton(m),this._shapeButtonsArray.push(s),s.$el.find(".custom-btn-icon").addClass(r+"-shape"),s.$el.attr("shape-id",n)}this._bindEventsOnShapeButtons(),b=this.model.get("shapeNumber"),this._shapeButtonsArray[b].$el.find(".custom-btn-icon").addClass("selected"),this._shapeButtonsArray[b].$el.find(".custom-btn-text").addClass("selected"),this._shapeButtonsArray[b].$el.addClass("selected")},_fetchButtonContainer:function(a){var b=MathInteractives.Common.Interactivities.ShapeSlicer.templates.shapeButton({idPrefix:this.idPrefix,number:a}).trim();return b},_bindEventsOnShapeButtons:function(){var a=this._shapeButtonsArray,b=a.length,c=0;for(c=0;b>c;c++)a[c].$el.off("click").on("click",$.proxy(this._shapeButtonClickHandler,this))},_shapeButtonClickHandler:function(a){var b,c=a.currentTarget.getAttribute("shape-id"),d=this.model.get("shapeNumber"),e=this._shapeButtonsArray;this.stopReading(),this.model.set("shapeNumber",parseInt(c)),b=e[d],b.$el.find(".custom-btn-icon").removeClass("selected"),b.$el.find(".custom-btn-text").removeClass("selected"),b.$el.removeClass("selected"),b=e[c],b.$el.find(".custom-btn-icon").addClass("selected"),b.$el.find(".custom-btn-text").addClass("selected"),b.$el.addClass("selected")},saveImageClick:function(){MathInteractives.Common.Utilities.Models.ScreenUtils.init(),MathInteractives.Common.Utilities.Models.ScreenUtils.getScreenShot({container:self.$(".explore-tab-left-part-container"),type:MathInteractives.Common.Utilities.Models.ScreenUtils.types.BASE64,background:"transparent",useCORS:!0,complete:function(a){self.model.trigger("save-image",{base64Image:a}),$modal.remove(),self.player.setModalPresent(!1)}})},_angleToRadians:function(a){return a*(Math.PI/180)},_setHelpElements:function(){var a=this.model.get("helpElements");a.push({elementId:"shape-buttons-panel",helpId:"shape-buttons-panel-help-text",position:"top",msgId:0,hideArrowDiv:!0},{elementId:"reset-button-container",helpId:"reset-button-container-help-text",position:"left",msgId:0},{elementId:"rotate-about-y-axis-button-container",helpId:"rotate-about-y-axis-button-container-help-text",position:"left",msgId:0,hideArrowDiv:!0},{elementId:"left-canvas-container",
helpId:"left-canvas-container-help-text",position:"top",msgId:0,offset:{x:2,y:220},tooltipWidth:465,hideArrowDiv:!0},{elementId:"right-panel-canvas-container",helpId:"right-panel-canvas-container-help-text",position:"top",msgId:0,fromElementCenter:!0,tooltipWidth:320,hideArrowDiv:!0},{elementId:"background-color-selector-container",helpId:"background-color-selector-container-help-text",position:"bottom",msgId:0,tooltipWidth:278,offset:{x:67,y:0},hideArrowDiv:!0},{elementId:"color-picker-button-container",helpId:"color-picker-button-container-help-text",position:"top",msgId:0},{elementId:"trash-button-container",helpId:"trash-button-container-help-text",position:"top",msgId:0},{elementId:"color-picker-container",helpId:"color-picker-container-help-text",position:"bottom",msgId:0},{elementId:"clear-button-container",helpId:"clear-button-container-help-text",position:"top",msgId:0,tooltipWidth:333},{elementId:"save-image-button-container",helpId:"save-image-button-container-help-text",position:"top",msgId:0},{elementId:"view-gallery-button-container",helpId:"view-gallery-button-container-help-text",position:"top",msgId:0,dynamicArrowPosition:!0},{elementId:"explore-tab-direction-text-direction-text-buttonholder",helpId:"explore-tab-direction-text-direction-text-buttonholder-help-text",position:"bottom",msgId:0,dynamicArrowPosition:!0},{elementId:"in-out-cards-0-wrapper",helpId:"in-out-cards-container-help-text",position:"top",msgId:0,hideArrowDiv:!0,fromElementCenter:!0},{elementId:"button-side-bar",helpId:"button-side-bar-help-text",position:"bottom",msgId:0,tooltipWidth:320,tooltipHeight:180,hideArrowDiv:!0},{elementId:"gallery-tab-back-button",helpId:"gallery-tab-back-button-help-text",position:"bottom",msgId:0,dynamicArrowPosition:!0},{elementId:"gallery-tab-direction-text-container-direction-text-buttonholder",helpId:"gallery-tab-direction-text-container-direction-text-buttonholder-help-text",position:"bottom",msgId:0,dynamicArrowPosition:!0})},_initialExploreHelpScreen:function(){this.player.enableHelpElement("clear-button-container",0,!1),this.player.enableHelpElement("save-image-button-container",0,!1),this.player.enableHelpElement("view-gallery-button-container",0,!1)}},{THUMBNAIL_SIZE:{SPHERE:[24,24],CONE:[24,24],CYLINDER:[23,24],CUBE:[23,24],TETRAHEDRON:[26,24],PRISM:[24,24],PYRAMID:[27,22],TRIANGULARPRISM:[20,26]},BUTTON_WIDTH:{TOUCH:162,NON_TOUCH:163}})}}(),function(){"use strict";if(!MathInteractives.Common.Interactivities.ShapeSlicer.Views.GalleryCanvas){var a;MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer.EVENT_MANAGER,MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer.EVENT_MANAGER_MODEL,MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer;MathInteractives.Common.Interactivities.ShapeSlicer.Views.GalleryCanvas=MathInteractives.Common.Player.Views.Base.extend({allShapesGroup:null,canvasID:null,paperScope:null,currentTool:null,initialize:function(a){this.initializeDefaultProperties(),this.allShapesGroup=a.shapeData,this.render()},render:function(){this._appendCanvas(),this._setPaperScope()},_appendCanvas:function(){var b=this.$el,c=this.el.id,d=(this.model,a.HIGHT),e=a.WIDTH,f=$("<canvas>",{id:c+"-canvas-element","class":"gallery-canvas-element"});b.empty().append(f),b.find(".gallery-canvas-element").attr({id:c+"-canvas-element",height:d,width:e}),this.canvasID=c+"-canvas-element"},_setPaperScope:function(){this.paperScope=new paper.PaperScope,this.paperScope.setup(this.el.id+"-canvas-element"),this.paperScope.activate()},loadShapes:function(b){this.paperScope.activate();var c,d=this.model.get("galleryObject"),e=b,f=d[e].shapeData;this.allShapesGroup&&this.allShapesGroup.remove(),this.allShapesGroup=new this.paperScope.Group,this.allShapesGroup.importJSON(f),c=this.allShapesGroup.position,c.x=c.x*a.SCALE_FACTOR,c.y=c.y*a.SCALE_FACTOR,this.allShapesGroup.scale(a.SCALE_FACTOR),this.paperScope.view.draw()},removeShapes:function(){this.allShapesGroup=this.allShapesGroup||null,null!==this.allShapesGroup&&(this.allShapesGroup.remove(),this.paperScope.view.draw())},destroy:function(){this.allShapesGroup=null,this.canvasID=null,this.paperScope=null,this.currentTool=null}},{HIGHT:158,WIDTH:160,SCALE_FACTOR:.38,createGalleryCanvasView:function(a){var b=a.model,c="#"+a.contanierId,d=(a.shapsGroup,new MathInteractives.Common.Interactivities.ShapeSlicer.Views.GalleryCanvas({el:c,model:b}));return d}}),a=MathInteractives.Common.Interactivities.ShapeSlicer.Views.GalleryCanvas}}(),function(){"use strict";if(!MathInteractives.Common.Interactivities.ShapeSlicer.Views.GalleryShapeSlicer){var a,b=MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer.EVENT_MANAGER_MODEL;MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer;MathInteractives.Common.Interactivities.ShapeSlicer.Views.GalleryShapeSlicer=MathInteractives.Common.Player.Views.Base.extend({_galleryCarousel:null,galleryCanvasViews:null,eventManager:null,initialize:function(){var a=this;this.initializeDefaultProperties(),this.eventManager=this.model.get("eventManager"),this.eventManager.off(b.SAVE_IMAGE,this.updateGallery).on(b.SAVE_IMAGE,this.updateGallery,this),this.eventManager.off(b.EDIT_IMAGE,this._editImage).on(b.EDIT_IMAGE,this._editImage,this),this.eventManager.on(b.UNLOAD_INTERACTIVE,this.onUnloadInteractive,this),this.loadScreen("gallery-screen"),this.galleryCanvasViews=[],this.render(),this.bindEvents(),this.player.bindTabChange(function(c){a.model.set("currentTab",2),a._disableAllSlots(),a.eventManager.trigger(b.TAB_CHANGED,2),c.isLetsGoClicked!==!0&&a.setFocus("gallery-tab-direction-text-container-direction-text-text")},this,2)},render:function(){this._preloadImagePath(),this._setBackground(),this._initializeDirectionText(),this._createGalleryCarousel(),this.createCanvasViews(),this.arrangeGallery(0,!0),this._generateBackButton(),this.loadScreen("gallery-acc-text-screen"),this.loadScreen("carousel-acc-text-screen"),this._disableAllSlots(),this.setCorauselButtonState()},events:{"click .gallery-tab-back-button.clickEnabled":"goToExploreTab"},bindEvents:function(){var a,b=this;this.$(".stepper-block").off("mousedown.galleryImage").on("mousedown.galleryImage",function(c){if($(this).hasClass("click-enable")&&(1===c.which||0===c.which||c.isTrigger)){var d=$(this);d.one("mouseup.galleryImage",function(){b.stopReading(),a=2*d.parent().index()+d.index(),b.player.enableHelpElement("in-out-cards-0-wrapper",0,!1),b.player.enableHelpElement("gallery-tab-back-button",0,!1),b.player.enableHelpElement("gallery-tab-direction-text-container-direction-text-buttonholder",0,!1),b.generateEditModal(a),b.unloadScreen("gallery-popup-buttons"),b.loadScreen("gallery-popup-buttons"),b.setAccMessage("edit-image-container",b.getAccMessage("edit-image-container",0,[a+1])),b.setFocus("edit-image-container")}),$(document).one("mouseup.galleryImage",function(){d.off("mouseup.galleryImage")})}}),this._bindEventOnCards()},_bindEventOnCards:function(){var a=this.$(".stepper-block.click-enable"),b=MathInteractives.Common.Utilities.Models.Utils,c=this;a.off("mouseenter.addhover").on("mouseenter.addhover",$.proxy(c._addHoverEffect,c)).off("mouseleave.removehover").on("mouseleave.removehover",$.proxy(c._removeHoverEffect,c)).off("mousedown.adddown").on("mousedown.adddown",$.proxy(c._addDownEffect,c)),b.DisableTouch(a),b.EnableTouch(a,3,0),$(document).off("mouseup.removedown").on("mouseup.removedown",$.proxy(c._removeDownEffect,c))},_addHoverEffect:function(a){$(a.currentTarget).removeClass("down").addClass("hover")},_removeHoverEffect:function(a){$(a.currentTarget).removeClass("hover")},_addDownEffect:function(a){$(a.currentTarget).removeClass("hover").addClass("down")},_removeDownEffect:function(a){$(".stepper-block.click-enable.down").removeClass("down")},_initializeDirectionText:function(){var a=this.idPrefix,b={containerId:a+"gallery-tab-direction-text-container",idPrefix:a,player:this.player,manager:this.manager,path:this.filePath,text:this.getMessage("gallery-tab-direction-text-text",0),accText:this.getMessage("gallery-tab-direction-text-text",0),showButton:!0,buttonType:MathInteractives.global.Theme2.Button.TYPE.FA_ICONTEXT,containmentBGcolor:"rgba(0, 0, 0,0)",iconData:{faClass:this.getFontAwesomeClass("fixed-delete"),fontColor:"#2D3A3A",height:20,width:26},buttonText:this.getMessage("gallery-tab-direction-text-text",1),buttonHeight:38,btnTextColor:"#000000",clickCallback:{fnc:this._onClearAllClick,scope:this},textColor:"#ffffff",tabIndex:1e3,buttonTabIndex:2e3,btnBaseClass:"shape-slicer-white-button-base",ttsBaseClass:"shape-slicer-tts-button"};this._directionTextView=MathInteractives.global.Theme2.DirectionText.generateDirectionText(b)},_generateBackButton:function(){this.backBtnView=MathInteractives.global.Theme2.ButtonExtended.generateButton({player:this.player,manager:this.manager,path:this.filePath,idPrefix:this.idPrefix,data:{id:this.idPrefix+"gallery-tab-back-button",type:MathInteractives.global.Theme2.Button.TYPE.BACK_ICONTEXT,baseClass:"shape-slicer-white-button-base"}})},_preloadImagePath:function(){this.spriteImagePath=this.getImagePath("sprites")},_setBackground:function(){this.$el.css({"background-image":'url("'+this.spriteImagePath+'")'})},destroy:function(){delete this._directionTextView,delete this._galleryCarousel,delete this.backBtnView,delete this.eventManager,delete this.filePath,delete this.idPrefix,delete this.manager,delete this.galleryCanvasViews},_createGalleryCarousel:function(){var b=this.$("#"+this.idPrefix+"gallery-carousel-container"),c={player:this.player,containerId:b,imagePath:"",defaultBlocks:a.GALLAREY_COLUMN_LENGTH,isBockWithImage:!1,stepperIndex:0,challenge2Data:!1,leftButtonOption:{type:MathInteractives.global.Theme2.Button.TYPE.FA_ICON,tooltipText:this.getMessage("carousel-previous-button-text",0),tooltipType:MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.TOP_MIDDLE,icon:{faClass:this.getFontAwesomeClass("back-circle"),height:50,width:50,fontSize:50},height:50,width:44,baseClass:"carousel-arrow-button-container",borderRadius:25,colorType:"#ffffff"},rightButtonOption:{type:MathInteractives.global.Theme2.Button.TYPE.FA_ICON,tooltipText:this.getMessage("carousel-next-button-text",0),tooltipType:MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.TOP_MIDDLE,icon:{faClass:this.getFontAwesomeClass("next-circle"),height:50,width:44,fontSize:50},height:50,width:50,baseClass:"carousel-arrow-button-container",borderRadius:25,colorType:"#ffffff"},isNavigationWithImage:!1,animateStep:4,animationDuration:350},d=MathInteractives.Common.Components.Theme2.Views.Carousel;this._galleryCarousel=d.generateCarousel(c),this._galleryCarousel.setNavigationalArrowStates(),this._bindSpaceOnGallery(),this._generateCarouselAccScreen(),this._galleryCarousel.on(d.Events.NAVIGATION_BUTTON_CLICKED,$.proxy(this._onCarouselButtonClick,this)),this._galleryCarousel.on(d.Events.ANIMATION_COMPLETE,$.proxy(this._onButtonAnimationComplete,this))},_bindSpaceOnGallery:function(){var a=this;this.$(".in-out-cards-wrapper").off("keyup.enableGallery").on("keyup.enableGallery",function(b){32===b.keyCode&&$(b.target).parent().attr("id")===this.id&&a._enableDisableGalleryPage(!0)})},_generateCarouselAccScreen:function(){for(var b={id:"carousel-acc-text-screen",name:"carousel-acc-text-screen"},c=null,d=null,e=a.GALLAREY_COLUMN_LENGTH,f=[],g=0;e>g;g++)c=1200+20*(g+1),d={accId:"stepper-0-block-0-"+g+"-container",id:"stepper-0-block-0-"+g+"-container",type:"text",tabIndex:c,messages:[{id:0,isAccTextSame:!1,message:{acc:this.getAccMessage("image-text",0,[2*g+1])}}]},f.push(d),d={accId:"stepper-0-block-1-"+g+"-container",id:"stepper-0-block-1-"+g+"-container",type:"text",tabIndex:c+10,messages:[{id:0,isAccTextSame:!1,message:{acc:this.getAccMessage("image-text",0,[2*g+2])}}]},f.push(d);b.elements=f,this.manager.model.parse([b])},createCanvasViews:function(){var a,b,c=this.$(".stepper-block"),d=0;for(d=0;d<c.length;d++)a={model:this.model,contanierId:c[d].id},b=MathInteractives.Common.Interactivities.ShapeSlicer.Views.GalleryCanvas.createGalleryCanvasView(a),this.galleryCanvasViews.push(b)},_onCarouselButtonClick:function(a){this._galleryCarousel.setNavigationButtonState(1,!1),this._galleryCarousel.setNavigationButtonState(0,!1)},_onButtonAnimationComplete:function(a){this.setCorauselButtonState(),this.setFocus("in-out-cards-0-wrapper")},setCorauselButtonState:function(){var a=this._galleryCarousel.getFirstVisibleBlock(),b=this.model.get("galleryObject"),c=null;this.model.set("galleryFirstVisibleColumn",a),this._galleryCarousel.setNavigationButtonState(1,!(Math.ceil(b.length/2)-a<=4)),this._galleryCarousel.setNavigationButtonState(0,!!a),c=".dot-"+(a/4+1),this.$(".gallery-dot").removeClass("active"),this.$(c).addClass("active"),this._setAccTextOfGallery()},updateGallery:function(){var a,b=this.model.get("currentGalleryIndex"),c=this.$(".stepper-block"),d=this.model.get("galleryObject"),e=null;e=d[b].backType.TYPE_NAME,a=this.getLatestFirstVisibleColumn(b),this.setFirstVisibleColumn(a),this.galleryCanvasViews[b].loadShapes(b),$(c[b]).removeClass("white gray").addClass("click-enable").addClass(e),this._bindEventOnCards(),this.setCorauselButtonState()},_setAccTextOfGallery:function(){var a=this.model.get("galleryFirstVisibleColumn"),b=2*a,c=this.$(".click-enable").length,d=c-b>=8?8:c%8,e=b+d;switch(b+=1,d){case 1:this.setAccMessage("in-out-cards-0-wrapper",this.getAccMessage("in-out-cards-0-wrapper",0,[this.getAccMessage("in-out-cards-0-wrapper",1,[b])]));break;case 2:this.setAccMessage("in-out-cards-0-wrapper",this.getAccMessage("in-out-cards-0-wrapper",0,[this.getAccMessage("in-out-cards-0-wrapper",2,[b,e])]));break;default:this.setAccMessage("in-out-cards-0-wrapper",this.getAccMessage("in-out-cards-0-wrapper",0,[this.getAccMessage("in-out-cards-0-wrapper",3,[b,e])]))}},_enableDisableGalleryPage:function(a){for(var b=this.model.get("galleryFirstVisibleColumn"),c=2*b,d=this.$(".click-enable").length,e=this.$(".stepper-block"),f=e.length,g=d-c>=8?8:d%8,h=c+g,i=f;i--;)this.enableTab($(e[i]).attr("id").replace(this.idPrefix,""),i>=c&&h>i);this._bindImageEvents(c,h,a)},_bindImageEvents:function(a,b,c){var d=this.$(".stepper-block"),e=this,f=this.$(".click-enable"),g=$(d[a]),h=$(d[b-1]);g.off("keydown.disableFirstGallery").on("keydown.disableFirstGallery",function(a){9===a.keyCode&&a.shiftKey===!0&&e._bindDocumentUpOnGallery(g,h,f)}),h.off("keydown.disableLastGallery").on("keydown.disableLastGallery",function(a){9===a.keyCode&&a.shiftKey===!1&&e._bindDocumentUpOnGallery(g,h,f)}),f.off("keydown.escapeGallery").on("keydown.escapeGallery",function(a){27===a.keyCode&&(e._bindDocumentUpOnGallery(g,h,f),e.setFocus("in-out-cards-0-wrapper"))}),c&&this.setFocus($(d[a]).attr("id").replace(this.idPrefix,""))},_bindDocumentUpOnGallery:function(a,b,c){var d=this;$(document).off("keyup.disableGallery").on("keyup.disableGallery",function(e){d._disableAllSlots(),b.off("keydown.disableLastGallery"),a.off("keydown.disableFirstGallery"),c.off("keydown.escapeGallery"),$(document).off("keyup.disableGallery")})},_disableAllSlots:function(){for(var a=this.$(".stepper-block"),b=a.length;b--;)this.enableTab($(a[b]).attr("id").replace(this.idPrefix,""),!1)},generateEditModal:function(a){var c=this,d={model:this.model,index:a,eventManager:this.eventManager};this.editModal=MathInteractives.Common.Interactivities.ShapeSlicer.Views.EditPopup.createEditModal(d),this.eventManager.off(b.DELETE_IMAGE,c._deleteImage).on(b.DELETE_IMAGE,c._deleteImage,this),this.eventManager.off(b.SET_FOCUS,c._setFocus).on(b.SET_FOCUS,c._setFocus,this)},arrangeGallery:function(a,b){var c,d=this.model.get("galleryObject"),e=this.$(".stepper-block"),f=null,a=a||0,g=this.model.get("galleryFirstVisibleColumn");for(this._galleryCarousel&&b&&(this._galleryCarousel.setFirstVisibleBlock(g,!0),this.setCorauselButtonState()),this.$(".stepper-block").removeAttr("style").removeClass("click-enable white gray");a<this.galleryCanvasViews.length;a++)this.galleryCanvasViews[a].removeShapes();if(d.length>0)for(c=0;c<d.length;c++)f=d[c].backType.TYPE_NAME,this.galleryCanvasViews[c].loadShapes(c),$(e[c]).addClass("click-enable").addClass(f);else{for(c=0;c<e.length;c++)this.enableTab($(e[c]).attr("id").replace(self.idPrefix,""),!1);this.goToExploreTab(),this.setFocus("explore-tab-activity-area")}this._bindEventOnCards()},_deleteImage:function(a){var b,c=this._galleryCarousel.getFirstVisibleBlock(),d=this.model.get("galleryObject");b=Math.ceil(d.length/2)-c>0?c:c-4==0?0:c-4,this.model.set("galleryFirstVisibleColumn",b),this.arrangeGallery(a,d.length%8===0),this._enableDisableGalleryPage(),this._setAccTextOfGallery()},_setFocus:function(a){var b=$(this.$(".stepper-block")[a]);a>=0&&this.setFocus(b.attr("id").replace(this.idPrefix,""))},_onClearAllClick:function(){this.stopReading(),this._generateClearAllPopup()},_generateClearAllPopup:function(){var a={manager:this.manager,path:this.filePath,player:this.player,idPrefix:this.idPrefix,title:this.getMessage("clear-all-popup",0),accTitle:this.getMessage("clear-all-popup",0),text:this.getMessage("clear-all-popup",1),accText:this.getMessage("clear-all-popup",1),type:MathInteractives.global.Theme2.PopUpBox.CONFIRM,buttons:[{id:"ok-button",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("popup-button-text",0),response:{isPositive:!0,buttonClicked:"ok-button"}},{id:"cancel-button",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("popup-button-text",1),response:{isPositive:!1,buttonClicked:"cancel-button"}}],closeCallback:{fnc:function(a){a.isPositive?this._clearAllImages():this.setFocus("gallery-tab-direction-text-container-direction-text-buttonholder")},scope:this}};this.editPopup=MathInteractives.global.Theme2.PopUpBox.createPopup(a)},_clearAllImages:function(){var a=[];this.model.set("galleryObject",a),this.model.set("currentGalleryIndex",0),this.model.set("galleryFirstVisibleColumn",0),this.arrangeGallery(),this._galleryCarousel.setFirstVisibleBlock(0),this.setCorauselButtonState(),this.eventManager.trigger(b.CLEAR_ALL_IMAGES),this.goToExploreTab(),this.setFocus("explore-tab-activity-area")},getLatestFirstVisibleColumn:function(a){var b;return b=8>a?0:a>=8&&16>a?4:8},setFirstVisibleColumn:function(a){this.model.set("galleryFirstVisibleColumn",a),this._galleryCarousel.setFirstVisibleBlock(a)},_editImage:function(){this.goToExploreTab(),this.setFocus("right-panel-canvas-acc-container")},goToExploreTab:function(){this.player.switchToTab(1)},onUnloadInteractive:function(){this.destroy(),this.unbind(),this.remove()}},{GALLAREY_COLUMN_LENGTH:12}),a=MathInteractives.Common.Interactivities.ShapeSlicer.Views.GalleryShapeSlicer}}(),function(){"use strict";MathInteractives.Common.Interactivities.ShapeSlicer.Models.Colors||(MathInteractives.Common.Interactivities.ShapeSlicer.Models.Colors=MathInteractives.Common.Player.Models.BaseInteractive.extend({_valueRanges:{rgb:{r:[0,255],g:[0,255],b:[0,255]},hsv:{h:[0,360],s:[0,100],v:[0,100]},hsl:{h:[0,360],s:[0,100],l:[0,100]},cmy:{c:[0,100],m:[0,100],y:[0,100]},cmyk:{c:[0,100],m:[0,100],y:[0,100],k:[0,100]},Lab:{L:[0,100],a:[-128,127],b:[-128,127]},XYZ:{X:[0,100],Y:[0,100],Z:[0,100]},alpha:{alpha:[0,1]},HEX:{HEX:[0,16777215]}},_instance:{},_colors:{},colors:null,XYZMatrix:{X:[.4124564,.3575761,.1804375],Y:[.2126729,.7151522,.072175],Z:[.0193339,.119192,.9503041],R:[3.2404542,-1.5371385,-.4985314],G:[-.969266,1.8760108,.041556],B:[.0556434,-.2040259,1.0572252]},grey:{r:.298954,g:.586434,b:.114612},luminance:{r:.2126,g:.7152,b:.0722},initialize:function(){this.colors={RND:{}},this.options={color:"rgba(204, 82, 37, 0.8)",XYZMatrix:this.XYZMatrix,grey:this.grey,luminance:this.luminance,valueRanges:this._valueRanges},this.initInstance({})},initInstance:function(a){var b,c,d=this.options;this.focusInstance();for(var e in a)void 0!==a[e]&&(d[e]=a[e]);b=d.XYZMatrix,a.XYZReference||(d.XYZReference={X:b.X[0]+b.X[1]+b.X[2],Y:b.Y[0]+b.Y[1]+b.Y[2],Z:b.Z[0]+b.Z[1]+b.Z[2]}),c=d.customBG,d.customBG="string"==typeof c?this.txt2color(c).rgb:c,this._colors=this._setColor(this.colors,d.color,void 0,!0)},focusInstance:function(){this._instance!==this&&(this._instance=this,this._colors=this.colors)},setColor:function(a,b,c){return this.focusInstance(),a?this._setColor(this.colors,a,b,void 0,c):(void 0!==c&&(this.colors.alpha=c),this._convertColors(b))},_setColor:function(a,b,c,d,e){if("string"==typeof b){var b=this.txt2color(b);c=b.type,this._colors[c]=b[c],e=void 0!==e?e:b.alpha}else if(b)for(var f in b)a[c][f]=this.limitValue(b[f]/this._valueRanges[c][f][1],0,1);return void 0!==e&&(a.alpha=+e),this._convertColors(c,d?a:void 0)},_saveAsBackground:function(a,b,c){var d=this._instance.options.grey,e={};return e.RGB={r:a.r,g:a.g,b:a.b},e.rgb={r:b.r,g:b.g,b:b.b},e.alpha=c,e.equivalentGrey=Math.round(d.r*a.r+d.g*a.g+d.b*a.b),e.rgbaMixBlack=this.mixColors(b,{r:0,g:0,b:0},c,1),e.rgbaMixWhite=this.mixColors(b,{r:1,g:1,b:1},c,1),e.rgbaMixBlack.luminance=this.getLuminance(e.rgbaMixBlack,!0),e.rgbaMixWhite.luminance=this.getLuminance(e.rgbaMixWhite,!0),this._instance.options.customBG&&(e.rgbaMixCustom=this.mixColors(b,this._instance.options.customBG,c,1),e.rgbaMixCustom.luminance=this.getLuminance(e.rgbaMixCustom,!0),this._instance.options.customBG.luminance=this.getLuminance(this._instance.options.customBG,!0)),e},_convertColors:function(a,b){var c,d,e,f=b||this._colors,g=this._instance.options,h=this._valueRanges,i=f.RND,j="",k="",l={hsl:"hsv",cmyk:"cmy",rgb:a},m=i.rgb;if("alpha"!==a){for(var n in h)if(!h[n][n]){a!==n&&"XYZ"!==n&&(k=l[n]||"rgb",f[n]=this[k+"2"+n](f[k])),i[n]||(i[n]={}),c=f[n];for(j in c)i[n][j]=Math.round(c[j]*("Lab"===n?1:h[n][j][1]))}"Lab"!==a&&delete f._rgb,m=i.rgb,f.HEX=this.rgb2hex(m),f.equivalentGrey=g.grey.r*f.rgb.r+g.grey.g*f.rgb.g+this.mixColors,g.grey.b*f.rgb.b,f.webSave=d=this.getClosestWebColor(m,51),f.webSmart=e=this.getClosestWebColor(m,17),f.saveColor=m.r===d.r&&m.g===d.g&&m.b===d.b?"web save":m.r===e.r&&m.g===e.g&&m.b===e.b?"web smart":"",f.hueRGB=this.hue2RGB(f.hsv.h),b&&(f.background=this._saveAsBackground(m,f.rgb,f.alpha))}var o,p,q,r,s,t,u,v=f.rgb,w=f.alpha,x="luminance",y=f.background;return o=this.mixColors(v,{r:0,g:0,b:0},w,1),o[x]=this.getLuminance(o,!0),f.rgbaMixBlack=o,p=this.mixColors(v,{r:1,g:1,b:1},w,1),p[x]=this.getLuminance(p,!0),f.rgbaMixWhite=p,g.allMixDetails&&(o.WCAG2Ratio=this.getWCAG2Ratio(o[x],0),p.WCAG2Ratio=this.getWCAG2Ratio(p[x],1),g.customBG&&(q=this.mixColors(v,g.customBG,w,1),q[x]=this.getLuminance(q,!0),q.WCAG2Ratio=this.getWCAG2Ratio(q[x],g.customBG[x]),f.rgbaMixCustom=q),r=this.mixColors(v,y.rgb,w,y.alpha),r[x]=this.getLuminance(r,!0),f.rgbaMixBG=r,s=this.mixColors(v,y.rgbaMixBlack,w,1),s[x]=this.getLuminance(s,!0),s.WCAG2Ratio=this.getWCAG2Ratio(s[x],y.rgbaMixBlack[x]),s.luminanceDelta=Math.abs(s[x]-y.rgbaMixBlack[x]),s.hueDelta=this.getHueDelta(y.rgbaMixBlack,s,!0),f.rgbaMixBGMixBlack=s,t=this.mixColors(v,y.rgbaMixWhite,w,1),t[x]=this.getLuminance(t,!0),t.WCAG2Ratio=this.getWCAG2Ratio(t[x],y.rgbaMixWhite[x]),t.luminanceDelta=Math.abs(t[x]-y.rgbaMixWhite[x]),t.hueDelta=this.getHueDelta(y.rgbaMixWhite,t,!0),f.rgbaMixBGMixWhite=t),g.customBG&&(u=this.mixColors(v,y.rgbaMixCustom,w,1),u[x]=this.getLuminance(u,!0),u.WCAG2Ratio=this.getWCAG2Ratio(u[x],y.rgbaMixCustom[x]),f.rgbaMixBGMixCustom=u,u.luminanceDelta=Math.abs(u[x]-y.rgbaMixCustom[x]),u.hueDelta=this.getHueDelta(y.rgbaMixCustom,u,!0)),f.RGBLuminance=this.getLuminance(m),f.HUELuminance=this.getLuminance(f.hueRGB),g.convertCallback&&g.convertCallback(f,a),f},getClosestWebColor:function(a,b){var c={},d=0,e=b/2;for(var f in a)d=a[f]%b,c[f]=a[f]+(d>e?b-d:-d);return c},getHueDelta:function(a,b,c){return(Math.max(a.r-b.r,b.r-a.r)+Math.max(a.g-b.g,b.g-a.g)+Math.max(a.b-b.b,b.b-a.b))*(c?255:1)/765},getLuminance:function(a,b){for(var c=b?1:255,d=[a.r/c,a.g/c,a.b/c],e=this._instance.options.luminance,f=d.length;f--;)d[f]=d[f]<=.03928?d[f]/12.92:Math.pow((d[f]+.055)/1.055,2.4);return e.r*d[0]+e.g*d[1]+e.b*d[2]},mixColors:function(a,b,c,d){var e={},f=void 0!==c?c:1,g=void 0!==d?d:1,h=f+g*(1-f);for(var i in a)e[i]=(a[i]*f+b[i]*g*(1-f))/h;return e.a=h,e},getWCAG2Ratio:function(a,b){var c=1;return c=a>=b?(a+.05)/(b+.05):(b+.05)/(a+.05),Math.round(100*c)/100},limitValue:function(a,b,c){return a>c?c:b>a?b:a},txt2color:function(a){var b={},c=a.replace(/(?:#|\)|%)/g,"").split("("),d=(c[1]||"").split(/,\s*/),e=c[1]?c[0].substr(0,3):"rgb",f="";if(b.type=e,b[e]={},c[1])for(var g=3;g--;)f=e[g]||e.charAt(g),b[e][f]=+d[g]/this._valueRanges[e][f][1];else b.rgb=this.hex2rgb(c[0]);return b.alpha=d[3]?+d[3]:1,b},rgb2hex:function(a){return((a.r<16?"0":"")+a.r.toString(16)+(a.g<16?"0":"")+a.g.toString(16)+(a.b<16?"0":"")+a.b.toString(16)).toUpperCase()},hex2rgb:function(a){return a=a.split(""),{r:parseInt(a[0]+a[a[3]?1:0],16)/255,g:parseInt(a[a[3]?2:1]+(a[3]||a[1]),16)/255,b:parseInt((a[4]||a[2])+(a[5]||a[2]),16)/255}},hue2RGB:function(a){var b=6*a,c=~~b%6,d=6===b?0:b-c;return{r:Math.round(255*[1,1-d,0,0,d,1][c]),g:Math.round(255*[d,1,1,1-d,0,0][c]),b:Math.round(255*[0,0,d,1,1,1-d][c])}},rgb2hsv:function(a){var b,c,d,e=a.r,f=a.g,g=a.b,h=0;return g>f&&(f=g+(g=f,0),h=-1),c=g,f>e&&(e=f+(f=e,0),h=-2/6-h,c=Math.min(f,g)),b=e-c,d=e?b/e:0,{h:1e-15>d?this._colors&&this._colors.hsl&&this._colors.hsl.h||0:b?Math.abs(h+(f-g)/(6*b)):0,s:e?b/e:this._colors&&this._colors.hsv&&this._colors.hsv.s||0,v:e}},hsv2rgb:function(a){var b=6*a.h,c=a.s,d=a.v,e=~~b,f=b-e,g=d*(1-c),h=d*(1-f*c),i=d*(1-(1-f)*c),j=e%6;return{r:[d,h,g,g,i,d][j],g:[i,d,d,h,g,g][j],b:[g,g,i,d,d,h][j]}},hsv2hsl:function(a){var b=(2-a.s)*a.v,c=a.s*a.v;return c=a.s?1>b?b?c/b:0:c/(2-b):0,{h:a.h,s:a.v||c?c:this._colors&&this._colors.hsl&&this._colors.hsl.s||0,l:b/2}},rgb2hsl:function(a,b){var c=this.rgb2hsv(a);return this.hsv2hsl(b?c:_colors.hsv=c)},hsl2rgb:function(a){var b=6*a.h,c=a.s,d=a.l,e=.5>d?d*(1+c):d+c-c*d,f=d+d-e,g=e?(e-f)/e:0,h=~~b,i=b-h,j=e*g*i,k=f+j,l=e-j,m=h%6;return{r:[e,l,f,f,k,e][m],g:[k,e,e,l,f,f][m],b:[f,f,k,e,e,l][m]}},rgb2cmy:function(a){return{c:1-a.r,m:1-a.g,y:1-a.b}},cmy2cmyk:function(a){var b=Math.min(Math.min(a.c,a.m),a.y),c=1-b||1e-20;return{c:(a.c-b)/c,m:(a.m-b)/c,y:(a.y-b)/c,k:b}},cmyk2cmy:function(a){var b=a.k;return{c:a.c*(1-b)+b,m:a.m*(1-b)+b,y:a.y*(1-b)+b}},cmy2rgb:function(a){return{r:1-a.c,g:1-a.m,b:1-a.y}},rgb2cmyk:function(a,b){var c=this.rgb2cmy(a);return this.cmy2cmyk(b?c:_colors.cmy=c)},cmyk2rgb:function(a,b){var c=this.cmyk2cmy(a);return this.cmy2rgb(b?c:_colors.cmy=c)},XYZ2rgb:function(a,b){var c=this._instance.options.XYZMatrix,d=a.X,e=a.Y,f=a.Z,g=d*c.R[0]+e*c.R[1]+f*c.R[2],h=d*c.G[0]+e*c.G[1]+f*c.G[2],i=d*c.B[0]+e*c.B[1]+f*c.B[2],j=1/2.4;return c=.0031308,g=g>c?1.055*Math.pow(g,j)-.055:12.92*g,h=h>c?1.055*Math.pow(h,j)-.055:12.92*h,i=i>c?1.055*Math.pow(i,j)-.055:12.92*i,b||(_colors._rgb={r:g,g:h,b:i}),{r:limitValue(g,0,1),g:limitValue(h,0,1),b:limitValue(i,0,1)}},rgb2XYZ:function(a){var b=this._instance.options.XYZMatrix,c=a.r,d=a.g,e=a.b,f=.04045;return c=c>f?Math.pow((c+.055)/1.055,2.4):c/12.92,d=d>f?Math.pow((d+.055)/1.055,2.4):d/12.92,e=e>f?Math.pow((e+.055)/1.055,2.4):e/12.92,{X:c*b.X[0]+d*b.X[1]+e*b.X[2],Y:c*b.Y[0]+d*b.Y[1]+e*b.Y[2],Z:c*b.Z[0]+d*b.Z[1]+e*b.Z[2]}},XYZ2Lab:function(a){var b=this._instance.options.XYZReference,c=a.X/b.X,d=a.Y/b.Y,e=a.Z/b.Z,f=16/116,g=1/3,h=.008856,i=7.787037;return c=c>h?Math.pow(c,g):i*c+f,d=d>h?Math.pow(d,g):i*d+f,e=e>h?Math.pow(e,g):i*e+f,{L:116*d-16,a:500*(c-d),b:200*(d-e)}},lab2XYZ:function(a){var b=this._instance.options.XYZReference,c=(a.L+16)/116,d=a.a/500+c,e=c-a.b/200,f=Math.pow(d,3),g=Math.pow(c,3),h=Math.pow(e,3),i=16/116,j=.008856,k=7.787037;return{X:(f>j?f:(d-i)/k)*b.X,Y:(g>j?g:(c-i)/k)*b.Y,Z:(h>j?h:(e-i)/k)*b.Z}},rgb2Lab:function(a,b){var c=this.rgb2XYZ(a);return this.XYZ2Lab(b?c:this._colors.XYZ=c)},lab2rgb:function(a,b){var c=this.lab2XYZ(a);return this.XYZ2rgb(b?c:this._colors.XYZ=c,b)}},{}))}(),function(){"use strict";MathInteractives.Common.Interactivities.ShapeSlicer.Models.ColorPicker||(MathInteractives.Common.Interactivities.ShapeSlicer.Models.ColorPicker=MathInteractives.Common.Player.Models.Base.extend({defaults:function(){return{idPrefix:"",player:null,manager:null,filePath:null,color:null,mode:null,alpha:null,luminance:null,position:null,eventManager:null}},getColor:function(){return this.get("color")}},{INITIAL_VALUES:{ALPHA:1,LUMINANCE:100,COLOR:"#000",MODE:"HEX"},MODES:{RGB:"rgb",HEX:"hex",HSV:"hsv"}}))}(),function(){"use strict";if(!MathInteractives.Common.Interactivities.ShapeSlicer.Views.ColorPicker){var a=null,b=null,c=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;MathInteractives.Common.Interactivities.ShapeSlicer.Views.ColorPicker=MathInteractives.Common.Player.Views.Base.extend({paperScope:null,currentTool:null,idPrefix:null,player:null,colorDisc:null,focusRing:null,focusPoint:null,closeTooltipView:null,luminanceSliderView:null,alphaSliderView:null,canvasAcc:null,boundaryCheck:!0,initialize:function(){this.idPrefix=this.model.get("idPrefix"),this.player=this.model.get("player"),this.manager=this.model.get("manager"),this.eventManager=this.model.get("eventManager"),this.filePath=this.model.get("filePath"),this.colorInstance=new MathInteractives.Common.Interactivities.ShapeSlicer.Models.Colors,this.loadScreen("color-picker-messages-screen"),this.player.off(MathInteractives.global.PlayerModel.BEFORE_TAB_SWITCH_EVENT).once(MathInteractives.global.PlayerModel.BEFORE_TAB_SWITCH_EVENT,this._removePopup,this),this.render()},render:function(){this.generateColorPicker(),this.setPaperScope(),this._setInitialPositions(),this.drawCircles(),this.generateLuminanceSlider(),this.renderLuminanceBar(),this.generateAlphaSlider(),this.renderAlphaBar(),this._setBackGroundImages(),this._bindEvents(),this.renderCloseButton(),this.loadScreen("color-picker-screen"),this._loadCanvasForAcc(),this.handleColorPickerAcc()},generateColorPicker:function(){var a={idPrefix:this.idPrefix,type:"color-picker"},b=this.model.get("position")||null,c=null;this.$el.append(MathInteractives.Common.Interactivities.ShapeSlicer.templates.colorPicker(a).trim()),c=this.player.$el,c.append(this.el),null!==b&&this.$(".color-picker-container").css({top:b.top,left:b.left}),this.generateCloseTooltip()},_setBackGroundImages:function(){this.backGroundImagePath=this.getImagePath("color-picker"),this.$(".disk-holder").css({"background-image":'url("'+this.backGroundImagePath+'")'}),this.$(".box.vertical").css({"background-image":'url("'+this.backGroundImagePath+'")'}),this.$(".box.horizontal").css({"background-image":'url("'+this.backGroundImagePath+'")'})},setPaperScope:function(){var a=this.paperScope=new paper.PaperScope;a.setup(this.idPrefix+"color-disk"),this.currentTool=new a.Tool,a.activate()},drawCircles:function(){var b=a.CENTER_POINTS,c=a.DISC_RADIUS,d=a.DISC_STROKE_COLOR,e=a.FOCUS_RING_RADIUS,f=this.focusPoint,g="#000";this.colorDisc=this._drawCircle(b,c,d),this.focusRing=this._drawCircle(f,e,g)},_drawCircle:function(a,b,c){this.paperScope.activate();var d=this.paperScope.Path.Circle({center:a,radius:b,strokeColor:c,fillColor:"#000"});return d.fillColor.alpha=0,this.paperScope.view.draw(),d},renderLuminanceBar:function(){var a=this.$(".luminance-slider").find("canvas")[0],b=a.getContext("2d"),c=b.createLinearGradient(0,0,0,200);c.addColorStop(0,"transparent"),c.addColorStop(1,"black"),b.fillStyle=c,b.fillRect(0,0,11,230)},generateLuminanceSlider:function(){var b=this,c=MathInteractives.Common.Components.Theme2.Models.Slider,d=c.EVENTS,e=MathInteractives.global.Theme2.Slider,f=a.LUMINANCE_SLIDER,g=b.colorInstance.colors.RND.hsv.v;this.luminanceSliderView=e.generateSlider({containerId:"luminance-slider-holder",sliderId:"luminance-slider",idPrefix:this.idPrefix,manager:this.manager,player:this.player,selectedValue:g,minValue:f.min,maxValue:f.max,numberOfDots:0,colorType:c.COLOR_TYPE.CUSTOM,orientation:c.ORIENTATION.VERTICAL,showHandleTooltip:!0,handleTooltipText:this.getMessage("color-picker-messages",1),toolTipArrowType:MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.RIGHT_MIDDLE,
screenId:"luminance-slider-container-screen",tabIndex:860}),this.luminanceSliderView.on(d.SLIDE,$.proxy(this.onSlideLuminanceSlider,this)),this.luminanceSliderView.on(d.VALUE_CHANGE,$.proxy(this.onSlideLuminanceSlider,this))},onSlideLuminanceSlider:function(b,c){var d,e=null;e=this.colorInstance.setColor({v:null!=c.value?c.value:b},"hsv"),d=this.getColorString(e),this.renderAlphaBar(d.hex),this.trigger(a.EVENTS.COLOR_CHANGE,b,d)},renderAlphaBar:function(a){var b=this.$(".opacity-slider").find("canvas")[0],c=b.getContext("2d"),d=c.createLinearGradient(200,0,0,0);a=a||"#"+this.colorInstance.colors.HEX,d.addColorStop(0,a),d.addColorStop(1,"#FFFFFF"),c.fillStyle=d,c.fillRect(0,0,230,11)},generateAlphaSlider:function(){var b=this,c=MathInteractives.Common.Components.Theme2.Models.Slider,d=c.EVENTS,e=MathInteractives.global.Theme2.Slider,f=a.ALPHA_SLIDER,g=b.colorInstance.colors.alpha;this.alphaSliderView=e.generateSlider({containerId:"opacity-bar-holder",sliderId:"opacity-slider",idPrefix:this.idPrefix,manager:this.manager,player:this.player,selectedValue:g,minValue:f.min,maxValue:f.max,step:f.step,numberOfDots:0,colorType:c.COLOR_TYPE.CUSTOM,orientation:c.ORIENTATION.HORIZONTAL,showHandleTooltip:!0,handleTooltipText:this.getMessage("color-picker-messages",2),screenId:"opacity-slider-container-screen",tabIndex:880}),this.alphaSliderView.on(d.SLIDE,$.proxy(this.onSlideAlphaSlider,this)),this.alphaSliderView.on(d.VALUE_CHANGE,$.proxy(this.onSlideAlphaSlider,this))},onSlideAlphaSlider:function(b,c){var d,e=null;e=this.colorInstance.setColor({},"alpha",null!=c.value?c.value:b),d=this.getColorString(e),this.trigger(a.EVENTS.ALPHA_CHANGE,b,d)},_setInitialPositions:function(){var a=this.model.getColor(),b=null,c=null;b=this.colorInstance.setColor(a),c=b.RND.hsv,this.focusPoint=this._getRingPosition(c.h,c.s),this.$(".luminance-slider").css({"background-color":"rgb("+b.hueRGB.r+","+b.hueRGB.g+","+b.hueRGB.b+")"}),this.$(".luminance-bar-white")[0].style.opacity=1-b.hsv.s},_getRingPosition:function(b,c){var d,e,f=a.CENTER_POINTS;return d=f[0]+c*Math.cos(b*Math.PI/180),e=f[1]-c*Math.sin(b*Math.PI/180),[d,e]},_bindEvents:function(){var a=this,b=this.colorDisc,d=this.focusRing,e=a.$(".color-disc"),f=this.$(".theme2-pop-up-modal-color-picker"),g=this.currentTool;b.on("mousedown",function(b){a.diskMouseMove(b)}),b.on("mouseenter",function(){e.removeClass("default-cursor").addClass("crosshair-cursor")}),b.on("mouseleave",function(){e.removeClass("crosshair-cursor").addClass("default-cursor")}),b.on("mousedrag",function(b){a.diskMouseMove(b)}),d.on("mousedrag",function(b){a.diskMouseMove(b)}),g.on("mouseup",function(b){b.point.isInside(a.colorDisc)&&e.removeClass("default-cursor").addClass("crosshair-cursor")}),g.on("mousedown",function(){e.removeClass("crosshair-cursor").addClass("default-cursor")}),g.on("mousedrag",function(a){a.preventDefault()}),this.$(".color-picker-container").on("mousedown",function(b){a._onContainerClick(b)}),c?f.on("click",function(){a._onModalClick()}):f.on("mousedown",function(b){1===b.which&&a._onModalClick()})},diskMouseMove:function(b){if(1===b.event.which||0===b.event.which){var c,d,e,f,g,h=a.DISC_RADIUS,i=this,j=a.CENTER_DISTANCE,k=null;this.boundaryCheck=!0,c=b.point.x-j,d=b.point.y-j,e=360-(180*Math.atan2(d,c)/Math.PI+(0>d?360:0)),b.point.isInside(this.colorDisc)?f=Math.sqrt(c*c+d*d):(this._angleOutOfBounds(e)&&(this.boundaryCheck=!1,this.changeAccMessage("color-picker-acc-disk-container",2),window.setTimeout($.proxy(i._setFocusOnCanvas,i),10)),f=h),g=this.colorInstance.setColor({h:e,s:f},"hsv"),this.focusRing.position=this._getRingPosition(e,f),k=this.getColorString(g),this.$(".luminance-slider").css({"background-color":"rgb("+g.hueRGB.r+","+g.hueRGB.g+","+g.hueRGB.b+")"}),this.$(".luminance-bar-white")[0].style.opacity=1-g.hsv.s,this.renderAlphaBar(k.hex),this.trigger(a.EVENTS.COLOR_CHANGE,b,k)}},_angleOutOfBounds:function(a){return a%=90,a>45?1>90-a:1>a},getColorString:function(a){var b,c=a.RND;return b={rgba:"rgba("+c.rgb.r+","+c.rgb.g+","+c.rgb.b+","+a.alpha+")",hsva:"hsva("+c.hsv.h+","+c.hsv.s+","+c.hsv.v+","+a.alpha+")",hex:"#"+a.HEX,rgb:a.rgb,alpha:a.alpha,luminance:c.hsv.v}},renderCloseButton:function(){var a=this.$(".close-button"),b=this;a.addClass(this.getFontAwesomeClass("close")),a.on("mouseenter",function(){$(this).addClass("hover")}),a.on("mousedown",function(){$(this).removeClass("hover").addClass("down")}),a.on("mouseup",function(){$(this).removeClass("down").addClass("hover")}),a.on("mouseleave",function(){$(this).removeClass("hover")}),a.on("click",function(){b._removePopup()}),$(document).off("mouseup.removedownstate").on("mouseup.removedownstate",function(){b.$(".close-button").removeClass("down")})},generateCloseTooltip:function(){var a,b={path:this.filePath,manager:this.manager,_player:this.player,idPrefix:this.idPrefix,id:this.idPrefix+"close-tooltip",elementEl:this.idPrefix+"close-button",text:this.getMessage("color-picker-messages",0),arrowType:MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.TOP_MIDDLE};this.closeTooltipView=MathInteractives.global.Theme2.Tooltip.generateTooltip(b),a={elementId:"close-button",tabIndex:4895,acc:this.getMessage("color-picker-messages",0),role:"button"},this.createAccDiv(a)},_onCloseTouchStart:function(){this.closeTooltipView.showTooltip()},_onCloseTouchEnd:function(){this.closeTooltipView.hideTooltip()},destroy:function(){this.paperScope=null,this.currentTool=null,this.idPrefix=null,this.colorDisc=null,this.focusRing=null,this.focusPoint=null,this.closeTooltipView=null,this.colorInstance=null,this.manager=null,this.eventManager=null,this.filePath=null,this.model=null,this.luminanceSliderView.remove(),this.alphaSliderView.remove()},_removePopup:function(){this.player.off(MathInteractives.global.PlayerModel.BEFORE_TAB_SWITCH_EVENT,this._removePopup),this.unbindColorPickerAcc(),this.closeTooltipView.remove(),this.luminanceSliderView.handleTooltipView.remove(),this.alphaSliderView.handleTooltipView.remove(),this.$(".theme2-tooltip tooltip-general-container").remove(),this.closeTooltipView.unbind(),this.trigger(a.EVENTS.ENABLE_HELP),this.trigger(a.EVENTS.CLOSE_COLOR_PICKER),this.destroy(),this.unbind(),this.remove()},_onModalClick:function(){this._removePopup()},_onContainerClick:function(a){a.stopPropagation()},_loadCanvasForAcc:function(){this._initAccessibility(),this._bindAccessibilityListeners()},_initAccessibility:function(){this.canvasAcc&&(this.canvasAcc.unbind(),this.canvasAcc.model.destroy());var a={canvasHolderID:this.idPrefix+"color-picker-acc-disk-container",paperItems:[],paperScope:this.paperScope,manager:this.manager,player:this.player};this.canvasAcc=MathInteractives.global.CanvasAcc.intializeCanvasAcc(a),this.canvasAcc.updatePaperItems([this.focusRing])},_bindAccessibilityListeners:function(){var a=this,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,c=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS,d=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,e=this.$("#"+this.idPrefix+"color-picker-acc-disk-container");e.off(b.ARROW).on(b.ARROW,function(b,d){a._arrowKeyPressed(b,d),e.off(c.ARROW_KEYUP).on(c.ARROW_KEYUP,function(b,d){a._handleOnArrowKeyUp(b,d),e.off(c.ARROW_KEYUP)})}),e.off(b.TAB).on(b.TAB,function(b,c){a.focusRing.strokeWidth=2,a.paperScope.view.draw(),a.changeAccMessage("color-picker-acc-disk-container",3),a._setFocusOnCanvas()}),e.off(d.FOCUS_OUT).on(d.FOCUS_OUT,function(b,c){a.focusRing.strokeWidth=1,a.paperScope.view.draw(),a.changeAccMessage("color-picker-acc-disk-container",0)})},_arrowKeyPressed:function(a,b){var c=1;a.point=new this.paperScope.Point(b.point.x+b.directionX*c,b.point.y+b.directionY*c),a.event={which:b.event.which},a.target=b.item,a.isAccessible=!0,this.setAccMessage("color-picker-acc-disk-container",""),b.item.trigger("mousedrag",a),this.paperScope.view.draw()},_handleOnArrowKeyUp:function(a,b){if(this.boundaryCheck){var c=this;this.changeAccMessage("color-picker-acc-disk-container",1),window.setTimeout($.proxy(c._setFocusOnCanvas,c),10)}},_setFocusOnCanvas:function(){this.canvasAcc.setSelfFocus()},handleColorPickerAcc:function(){var a=this.player.$(".custom-btn-type-save");0===a.length?this.player.$(".custom-btn-type-help").on("keydown.colorPicker",$.proxy(this._setFocusToCloseBtn,this)):a.on("keydown.colorPicker",$.proxy(this._setFocusToCloseBtn,this)),this.player.$(".header-subtitle").on("keydown.colorPicker",$.proxy(this._setFocusToColorPicker,this)),this.$(".color-picker-container").on("keydown.colorPicker",$.proxy(this._setFocusToHeaderSubtitle,this)),this.$(".close-button").on("keydown.colorPicker",$.proxy(this._setFocusToHeaderBtn,this))},_setFocusToCloseBtn:function(a){9===a.keyCode&&a.shiftKey&&(a.preventDefault(),this.setFocus("close-button"))},_setFocusToColorPicker:function(a){9!==a.keyCode||a.shiftKey||(a.preventDefault(),this.setFocus("color-picker-container"))},_setFocusToHeaderSubtitle:function(a){$(a.target).parent().hasClass("color-picker-container")&&9===a.keyCode&&a.shiftKey&&(a.preventDefault(),this.setFocus("header-subtitle"))},_setFocusToHeaderBtn:function(a){if(9===a.keyCode&&!a.shiftKey){a.preventDefault();var b=this.player.$(".custom-btn-type-save");0===b.length?this.setFocus("help-btn"):this.setFocus("save-btn")}},unbindColorPickerAcc:function(){this.player.$(".custom-btn-type-help,.custom-btn-type-save,.header-subtitle,.color-picker-container,.close-button").off(".colorPicker")}},{createColorPicker:function(a){if(a){var b=new MathInteractives.Common.Interactivities.ShapeSlicer.Models.ColorPicker(a),c=new MathInteractives.Common.Interactivities.ShapeSlicer.Views.ColorPicker({model:b});return c}},DISC_RADIUS:105,FOCUS_RING_RADIUS:2,DISC_STROKE_COLOR:"#edecec",CENTER_POINTS:[110,110],CENTER_DISTANCE:110,EVENTS:{COLOR_CHANGE:"color-change",ALPHA_CHANGE:"alpha-change",ENABLE_HELP:"enable-help",CLOSE_COLOR_PICKER:"close-color-picker"},LUMINANCE_SLIDER:{min:0,max:100,step:1},ALPHA_SLIDER:{min:0,max:1,step:.01}}),a=MathInteractives.Common.Interactivities.ShapeSlicer.Views.ColorPicker,b=MathInteractives.Common.Interactivities.ShapeSlicer.Models.ColorPicker}}(),function(a){"use strict";if(!a.Common.Interactivities.ShapeSlicer.Views.Shape3D){var b=null,c=a.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer.EVENT_MANAGER_MODEL,d=a.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer;a.Common.Interactivities.ShapeSlicer.Views.Shape3D=a.Common.Player.Views.Base.extend({renderer:null,shapeViewArr:null,canvasHeight:null,canvasWidth:null,allowClick:!0,showHover:!0,mouseMoveCount:0,$canvas:null,eventManager:null,lastAnimationFrame:null,mouseDownOnCanvas:!1,mouseDownOnSphere:!1,parent:null,isFirstSpace:!0,canvasAcc:null,initialize:function(){var d=this,e=null,f=null;this.shapeViewArr=[],this.parent=this.options.parent,this.initializeDefaultProperties(),b=a.Common.Interactivities.ShapeSlicer.Views.Shape3D,this.eventManager=this.model.get("eventManager"),this._render(),this.attachEventListeners(),this.eventManager.on(c.TAB_CHANGED,$.proxy(d._handleTabChange),d),f=b.CANVAS_SIZE,e=this.$canvas,e[0].style.width=f.WIDTH+"px",e[0].style.height=f.HEIGHT+"px"},_render:function(){this._setCanvas(),this._initializeShapeViews(),this._loadCanvasForAcc(),this._showHideCanvas(),this._initializeRenderer(),this._animate()},_loadCanvasForAcc:function(){this._initAccessibility(),this._bindAccessibilityListeners()},_initAccessibility:function(){this.canvasAcc&&(this.canvasAcc.unbind(),this.canvasAcc.model.destroy());var b={canvasHolderID:this.idPrefix+"canvas-acc-container",paperItems:[],manager:this.manager,player:this.player};this.canvasAcc=a.global.CanvasAcc.intializeCanvasAcc(b),this.canvasAcc.updatePaperItems(this.getPaperObjects())},_bindAccessibilityListeners:function(){var b=this,c=a.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,d=a.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,e=this.$("#"+this.idPrefix+"canvas-acc-container");this._bindSpaceForAccessibility(),e.off(c.TAB).on(c.TAB,function(a,c){b.onMouseMoveOnSphere(a,c.item)}),e.off(d.FOCUS_OUT).on(d.FOCUS_OUT,function(a,c){b._focusOut(a,c)})},_focusOut:function(a,c){var d=this.model.get("shapeNumber"),e=this.shapeViewArr[d],f=e.getSphereGroup(),g=e.model,h=g.get("pointsArr"),i=b.SPHERE_COLOR,j=g.get("lastHoveredPoint"),k=null;j&&(k=f.getObjectByName(j),-1===h.indexOf(j)?k.material.color.setHex(i.DESELECTED):k.material.color.setHex(i.SELECTED),g.set("lastHoveredPoint",null)),this.setAccMessage("canvas-acc-container",this.getAccMessage("shape-button-container-"+d,0,[this.getAccMessage("shape-button-common-text",2)])),this.canvasAcc.updatePaperItems(this.getPaperObjects()),this._renderScene()},_bindSpaceForAccessibility:function(){var b=a.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,c=this.$("#"+this.idPrefix+"canvas-acc-container"),d=this;c.on(b.SPACE,function(a,b){d._spaceKeyPressed(a,b)})},_spaceKeyPressed:function(a,b){this.onMouseUpOnSphere(a,b.item),a.isAfterMouseUp=!0,this.onMouseMoveOnSphere(a,b.item),this._renderScene()},_unbindAccessibilityListeners:function(){var b=a.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,c=(a.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,this.$("#"+this.idPrefix+"canvas-acc-container"));c.off(b.SPACE),c.off(b.TAB),c.off(b.FOCUS_OUT)},reOrderSpheres:function(a,b){for(var c=[],d=b.length,e=0;d>e;e++)c.push(a.getObjectByName("sphere-"+b[e][0]+"-position-"+b[e][1]));return c},attachEventListeners:function(){var b=this,d=this.$canvas,e=a.Common.Utilities.Models.BrowserCheck,f=a.Common.Utilities.Models.Utils;this.model.off("change:noOfSlicedShapes",this.setSliceButtonState,this).on("change:noOfSlicedShapes",this.setSliceButtonState,this),this.model.on("change:shapeNumber",$.proxy(b._showHideCanvas),b),this.eventManager.on(c.SHAPE_SLICED,$.proxy(b.shapeSliceHandler),b),e.isMobile!==!0&&Detector.webgl&&d.on("mousemove.sphereEffect",$.proxy(b.onMouseMoveOnSphere,b)),e.isIOS&&this.$canvas.removeClass("common-browser"),d.on("mouseup.sphereEffect",$.proxy(b.onMouseUpOnSphere,b)),d.off("mouseenter.canvas3D").on("mouseenter.canvas3D",$.proxy(b.onMouseEnterOnCanvas,b)),d.off("mouseleave.canvas3D").on("mouseleave.canvas3D",$.proxy(b.onMouseLeaveOnCanvas,b)),f.EnableTouch(d,{specificEvents:f.SPECIFIC_EVENTS.MOUSEMOVE})},_handleTabChange:function(a){var b=this.model.get("shapeNumber");this.shapeViewArr[b].controls.handleResize()},_initializeRenderer:function(){Detector.webgl?this.renderer=new THREE.WebGLRenderer({canvas:this.$canvas[0],antialias:!0,preserveDrawingBuffer:!0}):this.renderer=new THREE.CanvasRenderer({canvas:this.$canvas[0],antialias:!1}),this.renderer.autoClear=!1,this.renderer.setSize(this.canvasWidth,this.canvasHeight)},initializeThreeJS:function(a){a.scene=new THREE.Scene,a.frontScene=new THREE.Scene,a.camera=new THREE.PerspectiveCamera(75,this.canvasWidth/this.canvasHeight,.1,1e4),a.camera.position.z=350,this._initializeMouseInteraction(a),this._initializeControls(a),this.setShapeCameraValuesFromModel(a)},setShapeCameraValuesFromModel:function(a){var b=a.model,c=b.get("cameraQuaternion"),d=b.get("cameraPos"),e=b.get("cameraUp"),f=null;f=new THREE.Quaternion,f.set(c.x,c.y,c.z,c.w),a.controls.object.rotation.setFromQuaternion(f),a.controls.object.position.set(d.x,d.y,d.z),a.controls.object.up.set(e.x,e.y,e.z)},buildAxis:function(a,b,c,d){var e,f=new THREE.Geometry;e=d?new THREE.LineDashedMaterial({linewidth:3,color:c,dashSize:3,gapSize:3}):new THREE.LineBasicMaterial({linewidth:3,color:c}),f.vertices.push(a.clone()),f.vertices.push(b.clone()),f.computeLineDistances();var g=new THREE.Line(f,e,THREE.LinePieces);return g},_setCanvas:function(){this.$canvas=this.$(".activity-canvas-wrapper canvas");var c=a.Common.Utilities.Models.BrowserCheck,d=this.$canvas[0].width,e=this.$canvas[0].height,f=b.CANVAS_SIZE;if(c.isIOS){var g=window.devicePixelRatio;d/=g,e/=g,this.$canvas[0].width=d,this.$canvas[0].height=e}this.canvasWidth=f.WIDTH,this.canvasHeight=f.HEIGHT},_initializeShapeViews:function(){for(var d,e,f,g=this.model.get("interacivityType"),h=this.model.get("numberOfShapes"),i=b.SHAPE_NAMES[g],j=a.Common.Interactivities.ShapeSlicer,k=this.model.get("shapeCollection"),l=this.model.get("saveStateLoad"),m=this.$canvas,n=this.eventManager,o=0;h>o;o++)d=i[o],e=l?new j.Models[d](k.models[o].attributes):new j.Models[d],f=new j.Views[d]({model:e,el:m,parent:this,name:d,eventManager:this.eventManager}),k.remove(k.at(o)),k.add(e,{at:o}),this.shapeViewArr.push(f),l&&this.setPointSelection(f),e.on("change:isResetButtonEnable",function(a){n.trigger(c.SET_RESET_BUTTON_STATE,a.changedAttributes().isResetButtonEnable)});this.disableClicksOnPanning(),this.hideToolTipOnMouseDown(f)},drawLines:function(a,b){var c,d=new THREE.Vector3(a.x,a.y,a.z),e=new THREE.Vector3(b.x,b.y,b.z),f=this.getOutlineDetails(),g=new THREE.LineBasicMaterial({color:f.COLOR}),h=new THREE.Geometry;return h.vertices.push(d,e),c=new THREE.Line(h,g)},_showHideCanvas:function(a){var b=this.model.get("shapeNumber"),d=this.shapeViewArr[b],e=this.eventManager;a&&(this.shapeViewArr[a.previousAttributes().shapeNumber].controls.noRotate=!0),this.eventManager.trigger(c.ENABLE_TRY_ANOTHER),this.eventManager.trigger(c.DESELECT_SHAPE),d.controls.noRotate=!1,this.scene=d.scene,this.camera=d.camera,this.frontScene=d.frontScene,d.controls.handleResize(),e.trigger(c.SET_RESET_BUTTON_STATE,d.model.get("isResetButtonEnable")),this.setSliceButtonState(),this.parent._loadAccText(),this.$(".temp-focus-div").focus(),this.setFocus("shape-button-container-"+b),this.canvasAcc.updatePaperItems(this.getPaperObjects()),this.renderer&&this._renderScene()},getPaperObjects:function(){var a=this.model.get("shapeNumber"),b=this.shapeViewArr[a],c=b.getSphereGroup();return c.children},_initializeMouseInteraction:function(a){a.mouseVector=new THREE.Vector3,a.projector=new THREE.Projector,a.ray=new THREE.Raycaster(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0))},_initializeControls:function(a){a.controls=new THREE.CustomTrackball(a.camera,this.$canvas[0]),a.controls.rotateSpeed=.5,a.controls.zoomSpeed=.2,a.controls.panSpeed=.5,a.controls.noZoom=!0,a.controls.noPan=!0,a.controls.noRotate=!0,a.controls.staticMoving=!0,a.controls.dynamicDampingFactor=.3,Detector.webgl||(a.controls.skipCount=20)},angleToRadians:function(a){return a*(Math.PI/180)},generateClickableSphere:function(a){var c,d,e,f=b.SPHERE_COLOR,g=a||this.model.get("clickableSphereRadius");return e=new THREE.SphereGeometry(g,16,16),c=new THREE.MeshBasicMaterial({color:f.DESELECTED}),d=new THREE.Mesh(e,c)},drawCurve:function(a,b){var c=new THREE.EllipseCurve(0,0,a||50,b||30,0,2*Math.PI,!0),d=new THREE.Path(c.getPoints(50)),e=d.createPointsGeometry(50),f=this.getOutlineDetails(),g=new THREE.LineBasicMaterial({color:f.COLOR}),h=new THREE.Line(e,g);return h},drawPolygon:function(a,b){var c=this._polygonGeometry(a,b),d=this.getOutlineDetails(),e=new THREE.LineBasicMaterial({color:d.COLOR}),f=new THREE.Line(c,e);return f},_polygonGeometry:function(a,b){for(var c=new THREE.Geometry,d=0;a>d;d++){var e=Math.PI/2+d/a*2*Math.PI,f=b*Math.cos(e),g=b*Math.sin(e);c.vertices.push(new THREE.Vector3(f,g,0))}c.vertices.push(c.vertices[0]);for(var h=0;a-2>h;h++)c.faces.push(new THREE.Face3(0,h+1,h+2));return c},returnDeepCopy:function(a){if(typeof a==typeof Object.prototype){if($.isArray(a)){var b={};return b.array=a,$.extend(!0,{},b).array}return $.extend(!0,{},a)}return a},sortPoints:function(a){return 0!==a.length?a.slice().sort(function(a,b){return a-b}):[]},countInstances:function e(a,b,c){var d,f=b.slice();return c=c||0,d=f.indexOf(a),-1!==d&&(f.splice(d,1),c++,c=e(a,f,c)),c},onMouseEnterOnCanvas:function(a){this._setCursor(b.CURSOR_TYPE.OPEN_HAND)},onMouseLeaveOnCanvas:function(a){this._setCursor(b.CURSOR_TYPE.DEFAULT)},onMouseUpOnSphere:function(d,e){var f=a.Common.Utilities.Models.BrowserCheck;if(e||this.allowClick&&(1===d.which||f.isMobile===!0)){this.stopReading();var g=this.model.get("shapeNumber"),h=this.shapeViewArr[g],i=h.getSphereGroup(),j=h.getSelectedSphereGroup(),k=h.model,l=(this.$canvas.offset(),this),m=b.SPHERE_COLOR,n=null;if(d.preventDefault(),l._animate(),e||(n=this._getIntersects(i,d)),e||n.length){this.eventManager.trigger(c.ENABLE_TRY_ANOTHER),this.eventManager.trigger(c.DESELECT_SHAPE),e=e||n[0].object;var o=e.name,p=k.get("pointsArr").slice(),q=(this.model.get("clickableSphereScaleFactor"),p.length),r=null,s=p.indexOf(o);if(-1===s){if(r=e.clone(),r.material.color.setHex(m.SELECTED),j.add(r),q===this.model.get("maxPoints")){j.remove(j.getObjectByName(p[0]));var t=i.getObjectByName(p[0]);t.material.color.setHex(m.DESELECTED),p.shift()}p.push(o),k.set("pointsArr",p),k.get("pointChecker")?(this.changeAccMessage("canvas-acc-container",5),this.canvasAcc.setSelfFocus()):p.length!==this.model.get("maxPoints")&&(this.changeAccMessage("canvas-acc-container",3),this.canvasAcc.setSelfFocus())}else e.material.color.setHex(m.DESELECTED),j.remove(j.getObjectByName(e.name)),p=_.without(p,o),k.set("pointsArr",p),this.changeAccMessage("canvas-acc-container",4),this.canvasAcc.setSelfFocus();k.set("lastHoveredPoint",null),this.setSliceButtonState()}}},onMouseMoveOnSphere:function(a,c){var d=this.model.get("shapeNumber"),e=this.shapeViewArr[d],f=e.getSphereGroup(),g=e.model,h=(this.$canvas.offset(),this),i=null,j=g.get("pointsArr"),k=b.SPHERE_COLOR,l=g.get("lastHoveredPoint"),c=c||null,m=null,n=null,o=null;a.preventDefault(),c||(i=this._getIntersects(f.clone(),a)),h.mouseDownOnSphere=!1,c||this.showHover&&i.length?(this.$canvas.css("cursor","pointer"),h.mouseDownOnSphere=!0,c=c||i[0].object,m=c.name,n=this.model.get("clickableSphereScaleFactor"),m!==l&&(l&&(o=f.getObjectByName(l),-1===j.indexOf(l)?o.material.color.setHex(k.DESELECTED):o.material.color.setHex(k.SELECTED),g.set("lastHoveredPoint",null)),-1===j.indexOf(m)?(c.material.color.setHex(k.DESELECTED_HOVER),a.isAfterMouseUp||this.changeAccMessage("canvas-acc-container",1)):(c.material.color.setHex(k.SELECTED_HOVER),a.isAfterMouseUp||this.changeAccMessage("canvas-acc-container",2)),g.set("lastHoveredPoint",m),this._renderScene())):(h.mouseDownOnCanvas?this._setCursor(b.CURSOR_TYPE.CLOSED_HAND):this._setCursor(b.CURSOR_TYPE.OPEN_HAND),l&&(c=f.getObjectByName(l),-1===j.indexOf(l)?c.material.color.setHex(k.DESELECTED):c.material.color.setHex(k.SELECTED),g.set("lastHoveredPoint",null),this._renderScene())),this._renderScene()},resetPointSelection:function(a){for(var c,d=(this.model.get("shapeNumber"),a.model.get("pointsArr").slice()),e=d.length,f=b.SPHERE_COLOR,g=a.getSelectedSphereGroup(),h=a.getSphereGroup(),i=0;e>i;i++)c=h.getObjectByName(d[i]),g.remove(g.getObjectByName(d[i])),c.material.color.setHex(f.DESELECTED);d.length=0,a.model.set("pointsArr",d)},setPointSelection:function(a){for(var d,e=a.model.get("pointsArr").slice(),f=e.length,g=b.SPHERE_COLOR,h=(this.model.get("clickableSphereScaleFactor"),a.getSphereGroup()),i=0;f>i;i++)d=h.getObjectByName(e[i]),d.material.color.setHex(g.SELECTED);this.eventManager.trigger(c.CREATE_CROSSSECTION)},_getIntersects:function(a,b){var c={x:0,y:0,z:1},d=this.model.get("shapeNumber"),e=this.shapeViewArr[d],f=this.$canvas.offset();return c.x=(b.pageX-f.left)/this.canvasWidth*2-1,c.y=2*-((b.pageY-f.top)/this.canvasHeight)+1,e.mouseVector.set(c.x,c.y,c.z),e.projector.unprojectVector(e.mouseVector,e.camera),e.mouseVector.sub(e.camera.position),e.mouseVector.normalize(),e.ray.set(e.camera.position,e.mouseVector),e.ray.intersectObjects(a.children,!1)},disableClicksOnPanning:function(){var a=this,d=this.$canvas,e=null;d.on("mousedown.checkPanning",function(f){e=f,f.currSelector=a.$(".left-canvas-container-modal"),a.eventManager.trigger(c.DISABLE_HOVER,f),a.stopReading(),a.model.set("requestAnimation",!0),a._animate(),a.mouseDownOnSphere===!1&&a._setCursor(b.CURSOR_TYPE.CLOSED_HAND);var g=a.shapeViewArr[a.model.get("shapeNumber")];a.mouseDownOnCanvas=!0,d.on("mousemove.checkPanning touchmove.checkPanning",function(b){("mousemove"===b.type||a._isActualMouseMove(e,b))&&(a.mouseMoveCount++,a.mouseMoveCount<2&&(g.model.set("isResetButtonEnable",!0),a.eventManager.trigger(c.ENABLE_TRY_ANOTHER),a.eventManager.trigger(c.DESELECT_SHAPE)),a.mouseMoveCount>=5&&(a.allowClick=!1,a.showHover=!1,a.mouseMoveCount=0,d.off("mousemove.checkPanning touchmove.checkPanning")))}),$(document).one("mouseup.checkPanning",function(e){a.eventManager.trigger(c.ENABLE_HOVER,e),a.showHover=!0,a.allowClick=!0,a.mouseMoveCount=0,d.off("mousemove.checkPanning touchmove.checkPanning"),a.model.set("requestAnimation",!1),a.mouseDownOnCanvas=!1,a._setCursor(b.CURSOR_TYPE.OPEN_HAND)})})},_isActualMouseMove:function(a,b){var c=1,d=this._getPointOnScreen(a),e=this._getPointOnScreen(b);return Math.abs(Math.round(d.pageX)-Math.round(e.pageX))>c||Math.abs(Math.round(d.pageY)-Math.round(e.pageY))>c},_getPointOnScreen:function(a){switch(a.type){case"touchmove":return a.originalEvent.touches[0];default:return a}},hideToolTipOnMouseDown:function(a){var b=this,d=this.$canvas;d.off("mousedown.toolTipHide").on("mousedown.toolTipHide",function(){b.eventManager.trigger(c.CLICK_ON_3D_CANVAS)})},_renderScene:function(){this.renderer.clear(),this.renderer.clear(!1,!0,!1),this.renderer.render(this.scene,this.camera),this.renderer.render(this.frontScene,this.camera),this._updateModelValues()},_animate:function(){var a=this,b=this.shapeViewArr[this.model.get("shapeNumber")],c=this.model.get("activityLoaded");this.model.get("requestAnimation")&&c&&(this.lastAnimationFrame=window.requestAnimationFrame($.proxy(a._animate,a))),b.controls.update(),this._renderScene()},_updateModelValues:function(){var a=this.shapeViewArr[this.model.get("shapeNumber")],b=a.model,c=a.camera,d=c.rotation,e=c.position,f=c.up,g=d._quaternion;this.model.get("saveStateLoad")===!1&&(b.set("cameraQuaternion",{w:g.w,x:g.x,y:g.y,z:g.z}),b.set("cameraPos",{x:e.x,y:e.y,z:e.z}),b.set("cameraUp",{x:f.x,y:f.y,z:f.z}))},shapeSliceHandler:function(a){var b=this.model.get("shapeNumber"),c=this.shapeViewArr[b];this.find2DCoordinates(a),this.resetPointSelection(c),this.setSliceButtonState(),this._renderScene()},find2DCoordinates:function(a){var d,e,f,g,h,i=this.model.get("shapeNumber"),j=this.shapeViewArr[i],k=j.crossSection,l=[],m=null,n=j.model.get("pointsArr"),o=j.getSphereGroup(),p=o.getObjectByName(n[0]),q=o.getObjectByName(n[1]),r=o.getObjectByName(n[2]),s=new THREE.Plane,t=p.position,u=q.position,v=r.position;j.name!==b.SHAPE_NAMES[1][b.SPHERE_INDEX]?s.setFromCoplanarPoints(t,u,v):(d=k.geometry,e=d.vertices,f=e.length,s.setFromCoplanarPoints(e[0],e[f/3],e[2*f/3])),h=s.normal,d=this.map3dTo2d(k.geometry,h),e=d.vertices,f=e.length,this.map3dTo2d(d,h);var w=this.getPointsToChoose(e);l.push(this._toScreenXY(e[0],w)),l.push(this._toScreenXY(e[1],w));for(var x=2;f>x;x++)g=this._toScreenXY(e[x],w),m=l.length,this.areCollinear(l[m-2],l[m-1],g)&&(l.pop(),m=l.length),x===f-1&&this.areCollinear(l[m-1],g,l[0])?this.areCollinear(l[m-1],l[0],l[1])&&l.shift():l.push(g);this.model.set("pathCoordinates",l),d.dispose(),this.eventManager.trigger(c.DRAW_SLICED_SHAPE,a)},map3dTo2d:function(a,b){var c=new THREE.Vector3(0,0,1),d=new THREE.Vector3,e=null,f=null,g=this.createScalingMatrix(),h=null;return d=d.crossVectors(c,b),d.normalize(),e=Math.acos(c.clone().dot(b)),f=this.createRotMatrixFromAxisAngle(d,e),h=a.clone(),h.applyMatrix(f),h.applyMatrix(g),h},createRotMatrixFromAxisAngle:function(a,b){var c=Math.cos(-b),d=Math.sin(-b),e=1-c;return new THREE.Matrix4(e*a.x*a.x+c,e*a.x*a.y-d*a.z,e*a.x*a.z+d*a.y,0,e*a.x*a.y+d*a.z,e*a.y*a.y+c,e*a.y*a.z-d*a.x,0,e*a.x*a.z-d*a.y,e*a.y*a.z+d*a.x,e*a.z*a.z+c,0,0,0,0,1)},createScalingMatrix:function(){var a=b.SCALE_FACTOR_3D_TO_2D;return new THREE.Matrix4(a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1)},_toScreenXY:function(a,b){return[a[b[0]],a[b[1]]]},getPointsToChoose:function(a){for(var b=[],c=a.length,d=0,e=2,f=null,g=null,h=!1,i=!1,j=!1;c>d;d++)if(f=a[d],g=a[(d+1)%c],0===e||h||Math.round(f.x)===Math.round(g.x)||(h=!0,e--,b.push("x")),0===e||i||Math.round(f.y)===Math.round(g.y)||(i=!0,e--,b.push("y")),0===e||j||Math.round(f.z)===Math.round(g.z)||(j=!0,e--,b.push("z")),0===e)return b},areCollinear:function(a,b,c){var d=.01;return Math.abs((a[1]-b[1])*(a[0]-c[0])-(a[1]-c[1])*(a[0]-b[0]))<=d},getMaterialDetails:function(){return b.MATERIAL},getOutlineDetails:function(){return b.OUTLINE},getCrosssectionDetails:function(){return b.CROSSSECTION_DETAILS},setSliceButtonState:function(){var a=this.model.get("shapeNumber"),b=this.shapeViewArr[a],c=this.model.get("noOfSlicedShapes"),e=b.model.get("pointChecker"),f=c<d.MAX_SLICE_SHAPES&&e;return this.model.set("isSliceShapeButtonEnabled",f),e===!1&&this.canvasAcc.model.set("disableSelfFocusOnSpace",!0),f},_setCursor:function(a){this.parent.isRotationDown||(a!==b.CURSOR_TYPE.DEFAULT&&a!==b.CURSOR_TYPE.POINTER&&(a="url('"+this.getImagePath(a)+"'), move"),this.$canvas.css("cursor",a))},filterPoints:function(a,b,c){for(var d,e=a.length,f=null,g=0;e>g;g++)f=b.intersectLine(a[g]),f&&(d=c.vertices.length,d>=2&&this.check3DCollinearity(c.vertices[d-2],c.vertices[d-1],f)&&(c.vertices.pop(),d=c.vertices.length),g===e-1&&this.check3DCollinearity(c.vertices[d-1],f,c.vertices[0])&&c.vertices.shift(),c.vertices.push(f));c.vertices.push(c.vertices[0])},isSame:function(a,b,c){var d=1e-9;return Math.abs(a-b)<=d&&Math.abs(b-c)<=d&&Math.abs(c-a)<=d},check2DCollinearity:function(a,b,c,d){var e=1e-4;return Math.abs(b*c-d*a)<=e},check3DCollinearity:function(a,b,c){var d=this.isSame(a.x,b.x,c.x),e=this.isSame(a.y,b.y,c.y),f=this.isSame(a.z,b.z,c.z),g=Number(d)+Number(e)+Number(f);if(g>1)return!0;var h=1e-4,i=b.x-a.x,j=c.x-a.x,k=b.y-a.y,l=c.y-a.y,m=b.z-a.z,n=c.z-a.z;if(g)return d?this.check2DCollinearity(k,m,l,n):e?this.check2DCollinearity(m,i,n,j):this.check2DCollinearity(i,k,j,l);var o=i/j,p=k/l,q=m/n;return Math.abs(o-p)<=h&&Math.abs(q-o)<=h&&Math.abs(p-q)<=h},disposeObjects:function f(a){a.children.forEach(function(b,c){b.children&&f(b),b.geometry&&b.geometry.dispose(),b.material&&b.material.dispose(),b.dispose&&b.dispose(),a instanceof THREE.Scene&&a.remove(b)})}},{SHAPE_NAMES:{1:["Cube","Tetrahedron","Prism","Cone","Sphere","Cylinder"],2:["Cube","TriangularPrism","Pyramid"]},SPHERE_INDEX:4,MATERIAL:{COLOR:"#818284",OPACITY:.5},CROSSSECTION_DETAILS:{COLOR:"#36c6f4",OPACITY:.5},OUTLINE:{COLOR:"#FFFFFF"},SCALE_FACTOR_3D_TO_2D:.7,SPHERE_COLOR:{SELECTED:3589876,DESELECTED:16777215,SELECTED_HOVER:8708607,DESELECTED_HOVER:9562851},CURSOR_TYPE:{DEFAULT:"default",POINTER:"pointer",OPEN_HAND:"open-hand",CLOSED_HAND:"closed-hand"},CANVAS_SIZE:{WIDTH:432,HEIGHT:353}})}}(window.MathInteractives),function(){"use strict";MathInteractives.Common.Interactivities.ShapeSlicer.Models.Cube||(MathInteractives.Common.Interactivities.ShapeSlicer.Models.Cube=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:function(){return{pointsArr:[],pointChecker:!1,sideLength:220,numberOfClickableSpheres:4,numberOfDummyLines:1e3,numberOfPolygonSides:4,cameraQuaternion:null,cameraPos:null,cameraUp:null,lastHoveredPoint:null,isResetButtonEnable:!1}},initialize:function(){null===this.get("cameraQuaternion")&&this.setCameraInitialValues()},setCameraInitialValues:function(){var a=MathInteractives.Common.Interactivities.ShapeSlicer.Models.Cube;this.set("cameraQuaternion",a.CAMERA_QUATERNION),this.set("cameraPos",a.CAMERA_POSITION),this.set("cameraUp",a.CAMERA_UP)}},{CAMERA_QUATERNION:{w:.9355015435116878,x:-.23995752649986002,y:.2587632626477187,z:.017286720175595963},CAMERA_POSITION:{x:166.54774513082504,y:160.26766476116768,z:262.823370771778},CAMERA_UP:{x:-.15652789358836638,y:.8842431059222783,z:-.4400149408346408}}))}(),function(){"use strict";if(!MathInteractives.Common.Interactivities.ShapeSlicer.Views.Cube){var a=MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer.EVENT_MANAGER_MODEL,b=null;MathInteractives.Common.Interactivities.ShapeSlicer.Views.Cube=MathInteractives.Common.Player.Views.Base.extend({scene:null,frontScene:null,camera:null,mouseVector:null,projector:null,ray:null,controls:null,parent:null,crossSection:null,
outlineMesh:null,name:null,cube:null,cubeSphereGroup:null,cubeLinesGroup:null,cubeSquareGroup:null,selectedSphereGroup:null,squareLines:null,eventManager:null,initialize:function(a){this.parent=a.parent,this.name=a.name,this.eventManager=a.eventManager,b=MathInteractives.Common.Interactivities.ShapeSlicer.Views.Cube,this.parent.initializeThreeJS(this),this.render(),this.attachEventListeners()},render:function(){this._createCube()},attachEventListeners:function(){var b=this;this.model.on("change:pointsArr",$.proxy(b._createCrossSectionForCube,b)),this.eventManager.on(a.CREATE_CROSSSECTION,$.proxy(b._createCrossSectionForCube),b)},_createCube:function(){this.cube=this._generateCube(),this.scene.add(this.cube),this._addLineToCube(),this._addDummyCubeLines()},_generateCube:function(){var a,b,c,d=this.model.get("sideLength"),e=this.parent.getMaterialDetails();return a=new THREE.MeshBasicMaterial({color:e.COLOR,wireframe:!1,transparent:!0,opacity:e.OPACITY,depthWrite:!1}),c=new THREE.CubeGeometry(d,d,d),b=new THREE.Mesh(c,a)},_addLineToCube:function(){var a,c,d,e,f,g,h,i,j,k,l,m,n=this.model.get("numberOfClickableSpheres"),o=this.cube,p=20,q=o.geometry,r=q.vertices,s=r.length,t=b.FACE_TO_VERTEX[0],u=t.length,v=new THREE.Vector3,w=new THREE.Vector3;this.cubeSphereGroup=new THREE.Object3D,this.cubeLinesGroup=new THREE.Object3D,this.selectedSphereGroup=new THREE.Object3D;for(var x=0;s>x;x++)g=r[x],a=this.parent.generateClickableSphere(),a.position.set(g.x,g.y,g.z),a.name="sphere-"+x+"-position-0",this.cubeSphereGroup.add(a);for(var x=0;u>x;x++)c=t[x],d=t[(x+1)%u],e=c+2,f=d+2,g=r[c],h=r[d],this.cubeLinesGroup.add(this.parent.drawLines(g,h)),h=r[e],this.cubeLinesGroup.add(this.parent.drawLines(g,h)),g=r[f],this.cubeLinesGroup.add(this.parent.drawLines(h,g));i=this.cubeLinesGroup.children,j=i.length;for(var x=0;j>x;x++){k=i[x].geometry.vertices,l=k[0],m=k[1],v=v.subVectors(l,m),v.divideScalar(n),w=l.clone();for(var y=1;n>y;y++)w=w.subVectors(w,v),g={x:w.x,y:w.y,z:w.z},a=this.parent.generateClickableSphere(),a.position.set(g.x,g.y,g.z),a.name="sphere-"+(y+p)+"-position-"+(x+1),this.cubeSphereGroup.add(a)}this.cubeSphereGroup.children=this.parent.reOrderSpheres(this.cubeSphereGroup,b.ORDERED_SPHERES),this.scene.add(this.cubeSphereGroup),this.scene.add(this.cubeLinesGroup),this.frontScene.add(this.selectedSphereGroup)},_addDummyCubeLines:function(){var a,c,d,e,f,g,h,i=this.model.get("numberOfDummyLines"),j=this.model.get("sideLength"),k=this.cube,l=k.geometry,m=l.vertices,n=b.FACE_TO_VERTEX[0],o=n.length,p=new THREE.Vector3,q=new THREE.Vector3;this.squareLines=[];for(var r=0;o>r;r++){e=n[r],f=n[(r+1)%o],g=m[e],h=m[f],p=p.subVectors(g,h),p.divideScalar(i),q=g.clone();for(var s=0;i>s;s++)0!==s&&(q=q.subVectors(q,p)),d=new THREE.Vector3(q.x,q.y,q.z),c=new THREE.Vector3(q.x,q.y-j,q.z),a=new THREE.Line3(d,c),this.squareLines.push(a)}},_createCrossSectionForCube:function(){var b,c,d,e=this.model.get("pointsArr"),f=this.parent.model.get("maxPoints"),g=this.parent.getCrosssectionDetails(),h=new THREE.MeshBasicMaterial({color:g.COLOR,side:THREE.DoubleSide,transparent:!0,depthWrite:!1,opacity:g.OPACITY}),i=new THREE.LineBasicMaterial({color:g.COLOR}),j=null,k=this.cubeSphereGroup,l=e.length;if(this.crossSection&&(this.scene.remove(this.crossSection),this.crossSection=null,this.frontScene.remove(this.outlineMesh),this.outlineMesh=null),l===f){b=k.getObjectByName(e[0]),c=k.getObjectByName(e[1]),d=k.getObjectByName(e[2]);var m=null,n=this._checkNonCollinearPoints(e);if(n.result===!0){j=new THREE.Geometry,m=new THREE.Plane,m.setFromCoplanarPoints(b.position,c.position,d.position),this.parent.filterPoints(this.squareLines,m,j);for(var o=j.vertices.length,p=0;o-2>p;p++)j.faces.push(new THREE.Face3(p+1,p+2,0));this.model.set("pointChecker",!0)}else{var q,r=n.points;0!==r.length?(j=new THREE.Geometry,b=k.getObjectByName("sphere-"+r[0]+"-position-"+r[1]).position,c=k.getObjectByName("sphere-"+r[2]+"-position-"+r[3]).position,d=k.getObjectByName("sphere-"+r[4]+"-position-"+r[5]).position,q=k.getObjectByName("sphere-"+r[6]+"-position-"+r[7]).position,j.vertices.push(b),j.vertices.push(c),j.vertices.push(d),j.vertices.push(q),j.vertices.push(b),j.faces.push(new THREE.Face3(0,1,2)),j.faces.push(new THREE.Face3(0,2,3)),this.model.set("pointChecker",!0)):(0===n.errorType?this.eventManager.trigger(a.POINTS_ON_SAME_EDGE):1===n.errorType&&this.eventManager.trigger(a.POINTS_ON_SAME_FACE),this.model.set("pointChecker",!1))}j&&(this.crossSection=new THREE.Mesh(j,h),this.outlineMesh=new THREE.Line(j,i),this.scene.add(this.crossSection),this.frontScene.add(this.outlineMesh))}else this.model.set("pointChecker",!1)},_checkNonCollinearPoints:function(a){var b,c,d,e,f=/\d+/g,g={result:!1,points:[],errorType:0},h=[],i=[];return b=a[0].match(f),h.push(parseInt(b[0])),i.push(parseInt(b[1])),b=a[1].match(f),h.push(parseInt(b[0])),i.push(parseInt(b[1])),b=a[2].match(f),h.push(parseInt(b[0])),i.push(parseInt(b[1])),d=this.parent.sortPoints(_.uniq(i)),e=d.length,c=this.parent.countInstances(0,i),this._isSameLine(h,i)?g:this._isSameFace(h,i)?(g.errorType=1,g):this._isRectangle(c,d,h,i,g)?g:(g.result=!0,g)},_isSameLine:function(a,c){var d,e,f,g=b.VERTEX_TO_LINE;return d=0===c[0]?g[a[0]]:[c[0]],e=0===c[1]?g[a[1]]:[c[1]],f=0===c[2]?g[a[2]]:[c[2]],1===_.intersection(d,e,f).length},_isSameFace:function(a,c){var d,e,f,g=b.VERTEX_TO_FACE,h=b.LINE_TO_FACE;return d=0===c[0]?g[a[0]]:h[c[0]],e=0===c[1]?g[a[1]]:h[c[1]],f=0===c[2]?g[a[2]]:h[c[2]],1===_.intersection(d,e,f).length},_isRectangle:function(a,c,d,e,f){var g,h=b.VERTEX_TO_LINE,i=[],j=b.SUM_OF_INDEX,k=b.LINE_TO_VERTEX,l=null,m=null,n=null,o=b.OPPOSITE_LINES,p=b.VERTEX_TO_FACE,q=b.LINE_TO_FACE,r=b.THIRD_POINT_MAPPING,s=null,t=b.DIRECTION_MAPPING,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=!1,J=null,K=null,L=null,M=null,N=null;if(u=0===e[0]?h[d[0]]:[e[0]],v=0===e[1]?h[d[1]]:[e[1]],w=0===e[2]?h[d[2]]:[e[2]],l=_.intersection(u,v),m=_.intersection(v,w),n=_.intersection(u,w),1===l.length?(y=l,z=2,A=w,I=!0):1===m.length?(y=m,z=0,A=u,I=!0):1===n.length&&(y=n,z=1,A=v,I=!0),I)return g=k[y[0]],i.push(g[0],0),i.push(g[1],0),x=g[1],0===e[z]?(g=k[o[y[0]]],_.intersection(p[g[0]],p[x]).length>0?(i.push(g[0],0),i.push(g[1],0)):(i.push(g[1],0),i.push(g[0],0))):(s=r[A[0]][y[0]],s===A[0]?(g=k[A[0]],_.intersection(p[g[0]],p[x]).length>0?(i.push(g[0],0),i.push(g[1],0)):(i.push(g[1],0),i.push(g[0],0))):s>0?_.intersection(q[A[0]],p[x]).length>0?(i.push(d[z],A[0]),i.push(d[z],s)):(i.push(d[z],s),i.push(d[z],A[0])):_.intersection(q[A[0]],p[x]).length>0?(i.push(d[z],A[0]),i.push(j-d[z],Math.abs(s))):(i.push(j-d[z],Math.abs(s)),i.push(d[z],A[0]))),f.points=i,!0;if(0===a){if(B=u[0],D=v[0],E=w[0],C=t[B],F=C[D],G=C[E],F&&(H=t[B][D],H&&1===H&&d[0]===d[1]||-1===H&&d[0]+d[1]===j))return i.push(d[0],B),i.push(d[1],D),this._getFourthPoint(E,B,D,d,2,i),f.points=i,!0;if(F=!1,G&&(H=t[B][E],H&&1===H&&d[0]===d[2]||-1===H&&d[0]+d[2]===j))return i.push(d[0],B),i.push(d[2],E),this._getFourthPoint(D,B,E,d,1,i),f.points=i,!0;if(G=!1,!F&&!G)return H=t[D][E],H&&1===H&&d[1]===d[2]||-1===H&&d[1]+d[2]===j?(i.push(d[1],D),i.push(d[2],E),this._getFourthPoint(B,D,E,d,0,i),f.points=i,!0):!1}else if(1===a&&(J=e.indexOf(0),K=_.without(e,0),D=K[0],E=K[1],L=_.difference([0,1,2],J),M=L[0],N=L[1],C=t[D][E],C&&1===C&&d[M]===d[N]||-1===C&&d[M]+d[N]===j))return i.push(d[M],D),i.push(d[N],E),this._getFourthPoint(J,D,E,d,null,i,!0),f.points=i,!0;return!1},_getFourthPoint:function(a,c,d,e,f,g,h){var i=b.LINE_TO_FACE,j=b.DIRECTION_MAPPING,k=b.THIRD_POINT_MAPPING,l=b.VERTEX_TO_LINE,m=b.LINE_TO_VERTEX,n=b.VERTEX_TO_FACE,o=null,p=null,q=null,r=null,s=null,t=b.SUM_OF_INDEX,u=h?n[e[a]]:i[a],v=i[c],w=i[d],x=h?!1:k[a][c]===k[a][d],y=null,z=null,A=null;h?(r=l[e[a]],z=Object.keys(k[c]).map(Number),A=Object.keys(k[d]).map(Number),s=_.intersection(_.intersection(z,A),r),y=m[s],_.intersection(n[y[0]],w).length>0?(g.push(y[0],0),g.push(y[1],0)):(g.push(y[1],0),g.push(y[0],0))):x?(y=m[a],_.intersection(n[y[0]],w).length>0?(g.push(y[0],0),g.push(y[1],0)):(g.push(y[1],0),g.push(y[0],0))):_.intersection(u,v).length>0?(o=j[a],r=Object.keys(o),p=_.intersection(w,i[r[0]]).length>0&&parseInt(r[0])!==c?0:1,s=parseInt(r[p]),q=j[a][s],1===q?g.push(e[f],s):g.push(t-e[f],s),g.push(e[f],a)):(o=j[a],r=Object.keys(o),p=_.intersection(v,i[r[0]]).length>0&&2!==_.intersection(w,i[r[0]]).length?0:1,s=parseInt(r[p]),q=j[a][s],g.push(e[f],a),1===q?g.push(e[f],s):g.push(t-e[f],s))},getSphereGroup:function(){return this.cubeSphereGroup},getSelectedSphereGroup:function(){return this.selectedSphereGroup},getLines:function(){return this.squareLines},destroy:function(){this.scene=null,this.frontScene=null,this.camera=null,this.mouseVector=null,this.projector=null,this.ray=null,this.controls=null,this.parent=null,this.crossSection=null,this.outlineMesh=null,this.name=null,this.cube=null,this.cubeSphereGroup=null,this.cubeLinesGroup=null,this.cubeSquareGroup=null,this.squareLines=null,this.eventManager=null}},{VERTEX_TO_FACE:{0:[0,2,3],1:[0,3,4],2:[2,3,5],3:[3,4,5],4:[0,1,4],5:[0,1,2],6:[1,4,5],7:[1,2,5]},FACE_TO_VERTEX:{0:[0,1,4,5],1:[4,5,6,7],2:[0,2,5,7],3:[0,1,2,3],4:[1,3,4,6],5:[2,3,6,7]},FACE_TO_LINE:{0:[1,4,7,10],1:[7,8,9,11],2:[2,10,11,12],3:[1,2,3,5],4:[4,5,6,8],5:[3,6,9,12]},LINE_TO_FACE:{1:[0,3],2:[2,3],3:[3,5],4:[0,4],5:[3,4],6:[4,5],7:[0,1],8:[1,4],9:[1,5],10:[0,2],11:[1,2],12:[2,5]},VERTEX_TO_LINE:{0:[1,2,10],1:[1,4,5],2:[2,3,12],3:[3,5,6],4:[4,7,8],5:[7,10,11],6:[6,8,9],7:[9,11,12]},LINE_TO_VERTEX:{1:[0,1],2:[0,2],3:[2,3],4:[1,4],5:[1,3],6:[3,6],7:[4,5],8:[4,6],9:[6,7],10:[0,5],11:[5,7],12:[2,7]},OPPOSITE_LINES:{1:9,2:8,3:7,4:12,5:11,6:10,7:3,8:2,9:1,10:6,11:5,12:4},THIRD_POINT_MAPPING:{1:{9:1,8:3,11:3,6:-7,12:-7},2:{8:2,4:11,6:11,7:5,9:5},3:{7:3,4:-9,10:-9,11:1,8:1},4:{12:4,2:6,11:6,3:-10,9:-10},5:{11:5,7:2,9:2,10:8,12:8},6:{10:6,2:4,11:4,1:-12,7:-12},7:{3:7,2:9,5:9,6:-1,12:-1},8:{2:8,1:11,3:11,10:5,12:5},9:{1:9,4:-3,10:-3,2:7,5:7},10:{6:10,3:-4,9:-4,5:12,8:12},11:{5:11,4:2,6:2,1:8,3:8},12:{4:12,1:-6,7:-6,5:10,8:10}},DIRECTION_MAPPING:{1:{3:1,7:-1},2:{5:1,11:1},3:{1:1,9:-1},4:{6:1,10:-1},5:{2:1,8:1},6:{4:1,12:-1},7:{1:-1,9:1},8:{5:1,11:1},9:{3:-1,7:1},10:{4:-1,12:1},11:{2:1,8:1},12:{6:-1,10:1}},SUM_OF_INDEX:44,ORDERED_SPHERES:[[5,0],[23,7],[22,7],[21,7],[4,0],[23,4],[22,4],[21,4],[1,0],[23,1],[22,1],[21,1],[0,0],[23,10],[22,10],[21,10],[21,11],[21,8],[21,5],[21,2],[22,11],[22,8],[22,5],[22,2],[23,11],[23,8],[23,5],[23,2],[7,0],[23,9],[22,9],[21,9],[6,0],[23,6],[22,6],[21,6],[3,0],[23,3],[22,3],[21,3],[2,0],[23,12],[22,12],[21,12]]})}}(),function(){"use strict";MathInteractives.Common.Interactivities.ShapeSlicer.Models.Shape2D||(MathInteractives.Common.Interactivities.ShapeSlicer.Models.Shape2D=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:function(){return{player:null,backgroundType:null,shapeColorsToUse:null,shapeColorIndex:-1,shapeData:null,selectedShapeGroupName:"",shapeCounter:-1}},initialize:function(){}}))}(),function(){"use strict";if(!MathInteractives.Common.Interactivities.ShapeSlicer.Views.Shape2D){var a=MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer.EVENT_MANAGER_MODEL,b=MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer,c=MathInteractives.Common.Interactivities.ShapeSlicer.Views.ColorPicker;MathInteractives.Common.Interactivities.ShapeSlicer.Views.Shape2D=MathInteractives.Common.Player.Views.Base.extend({staticDataHolder:null,browserCheck:null,utils:null,mainModel:null,colorPickerView:null,colorPickerBtnView:null,trashBtnView:null,clearBtnView:null,saveImageBtnView:null,viewGalleryBtnView:null,$canvas:null,paperScope:null,allShapesGroup:null,selectedShapeGroup:null,rasterCircleSource:"",rasterCircle:null,rasterSymbol:null,canvasRect:null,isCanvasRectClicked:!1,isMouseDownOnShape:!1,isMouseUpOnTranslateOrRotate:!1,isSelectedShapeDragging:!1,isSelectionEndPointDragging:!1,isShapeScaled:!1,isMouseOverShapeButtons:!1,lastLogicalHoveredShape:null,lastDraggedEndPoint:null,previousDifference:null,whoopsPopup:null,eventManager:null,canvasAcc:null,isFocusOnCanvas:!1,isFirstTab:!0,previousItem:null,boundaryCheck:!0,initialize:function(){this.initializeDefaultProperties(),this.staticDataHolder=MathInteractives.Common.Interactivities.ShapeSlicer.Views.Shape2D,this.browserCheck=MathInteractives.Common.Utilities.Models.BrowserCheck,this.utils=MathInteractives.Common.Utilities.Models.Utils,this.mainModel=this.options.mainModel,this.eventManager=this.mainModel.get("eventManager"),null===this.model.get("shapeColorsToUse")&&this.model.set("shapeColorsToUse",_.shuffle(this.staticDataHolder.SHAPE_COLOR)),this.$canvas=this.$("#"+this.idPrefix+"right-panel-canvas"),this._preloadImage(),this._setUpCanvas(),this.unloadScreen("right-panel-screen"),this.loadScreen("right-panel-screen"),this._loadCanvasForAcc(),this._render(),this._bindEvents(),this.$(".right-panel-canvas-container-modal").off("mousemove").on("mousemove",function(a){a.stopPropagation()}),this.eventManager.off(a.DESELECT_SHAPE,this._handleShapeDeselectEvent).on(a.DESELECT_SHAPE,this._handleShapeDeselectEvent,this)},events:{'click .background-color-selector-container .back-color-selector:not(".selected")':"_onBackColorSelect",'mouseenter .background-color-selector-container .back-color-selector:not(".selected")':"_onBackColorMouseEnter","mouseleave .background-color-selector-container .back-color-selector":"_onBackColorMouseLeave",'mousedown .background-color-selector-container .back-color-selector:not(".selected")':"_onBackColorMouseDown"},_preloadImage:function(){var a=new Image;this.rasterCircleSource="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAABWVBMVEUAAAAAAAAAAAAAAAACAgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADi4uIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD5+fnKysqdnZ03NzcAAAANDQ0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD19fXy8vLp6enl5eXe3t61tbWhoaFycnJjY2NRUVFFRUUsLCwfHx8nJycGBgYYGBgAAAAAAAAAAAAAAAAAAADu7u7Y2NjS0tLPz8++vr66urqSkpJaWlokJCQUFBRMTEwSEhIICAgAAAAAAADW1tbCwsLFxcWnp6eqqqqJiYmHh4d9fX2WlpZra2ttbW06OjoiIiJBQUEoKCgnJycfHx8AAAD////+/v7AY7KLAAAAcXRSTlMAAQIRvSITBwrIQyclDgMWCNZyUTErBId5ST47NBoG+dLCsKOYi31uaGJaBf717NXMyKCclJBrTUYvHv38+vr57+3k4eHg3NrZ1tDGgV5bVvz39/by8urf29nW0cynnff08uzr6urp5eDe3tPS0My6qK3pfE4AAAIESURBVCjPZdJVk+JAFAVg4k4SgiRAgru7u/u476y7Nv//YQNMTU2Y8/rV6eq+t00QrJE8ZnW5rBhOwCZjzARXtyqrSGRFMzhhhqGXKOCscy0XA/lQlGZxUrC/ZISplkP+7O0YLZaVGsZzOj8jVrUUfOLorDlFg5Z11Y3xZOK5bI0VspPPSZCeidS/khxTrHVOMz+pU0aH78D24sd4IoqUPyjHXSyiwU8Y/tUAwHPW9ry9vLqeZf36xRgkcVB35O93D2i0uykPAMlUX0SDkSrGHQ5mKw7f748gmZ7/zFx3QfLyhiqUnaqwr+I2KezPDVrNDLVY5DLvwemYKq5qiHmHBMLS0SL65w59dDjy1EN6e36LLpW6sHsPZCdVq1QOhyMbmo470GwP9GaBqHs3Sr0LE4g+eKf+fJ6pOBb3nZORzyExiGDXUS8LHI4jpJbgbLE33gFIewMWheFJ3fYOwRBkgkg2/uidtDtTqmCp2HDD+qB9U+xth14qb6HrRkTcFnR6MwB9cTQvbZgjdMm5TurL9tOwdRGI2UyG7JpX4KR57tl+y69ZI+oXCtyngJ4PDyVFNWKCd8lopgXA6dwfrSFGhEisEqL6oHHnW9IqcfwXOSZeynW/+kISS8Kmo9jx2mYZDIYlm76X40AEb6Mlycngmul1YAFRMUzlCOhYDmvQCCJh3tl/hUJQfQ0an+wAAAAASUVORK5CYII=",a.src=this.rasterCircleSource},_setUpCanvas:function(){var a=this.model.get("shapeData"),b=MathInteractives.Common.Utilities.Models.Utils,c=this.idPrefix+"right-panel-canvas";if(this.paperScope=new paper.PaperScope,b.EnableTouch("#"+c,{specificEvents:b.SPECIFIC_EVENTS.DRAGGABLE}),this.paperScope.setup(c),this.paperScope.activate(),null===a)this.allShapesGroup=new this.paperScope.Group({name:"all-shapes-group"});else{var d,e=this,f=this.model.get("selectedShapeGroupName");this.paperScope.activate(),this.allShapesGroup=new this.paperScope.Group,this.allShapesGroup.importJSON(a),this.allShapesGroup.children.forEach(function(a){e._bindShapeEvents(a.children.shape)}),""!==f&&(d=this.allShapesGroup.children[f],this._deselectShape(),this._selectShape(d.children.shape,d))}this.model.set("shapeData",this.allShapesGroup),this._drawCanvasRect(),this.paperScope.view.draw()},_bindEvents:function(){this.eventManager.off(a.DRAW_SLICED_SHAPE,this._draw2DShape).off(a.EDIT_IMAGE,this._loadShapesToEdit).off(a.DELETE_IMAGE,this._onDeleteGalleryImage).off(a.CLEAR_ALL_IMAGES,this._onGalleryClear).off(a.SAVE_STATE_START,this._onSaveStateStart).off(a.SAVE_STATE_END,this._onSaveStateEnd),this.mainModel.off("change:galleryImageCount",this._onGalleryObjectsCountChange).off("change:noOfSlicedShapes",this._onShapeCountChange).off("change:isSaveImageButtonEnabled",this._onSaveImageButtonStatusChange),this.eventManager.on(a.DRAW_SLICED_SHAPE,this._draw2DShape,this).on(a.EDIT_IMAGE,this._loadShapesToEdit,this).on(a.DELETE_IMAGE,this._onDeleteGalleryImage,this).on(a.CLEAR_ALL_IMAGES,this._onGalleryClear,this).on(a.SAVE_STATE_START,this._onSaveStateStart,this).on(a.SAVE_STATE_END,this._onSaveStateEnd,this),this.mainModel.on("change:galleryImageCount",this._onGalleryObjectsCountChange,this).on("change:noOfSlicedShapes",this._onShapeCountChange,this).on("change:isSaveImageButtonEnabled",this._onSaveImageButtonStatusChange,this)},_render:function(){var a=this.selectedShapeGroup;this._renderBackColorSelectors(),this._createButtons(),this._bindToolEvents(),null!==a?(this._deselectShape(),this._selectShape(a.children.shape,a),this._showShapeButtons(!0),this._setShapeButtonsPosition()):this._showShapeButtons(!1);var b=this.mainModel.get("noOfSlicedShapes");this._showEmptyCanvasText(0>=b)},_renderBackColorSelectors:function(){var a=$("<div/>").addClass("wrapper-fa-div"),b=$("<span/>").addClass("fa fa-check"),c=this;a.append(b),this.$(".white-color-selector").prepend(a).data({customType:this.staticDataHolder.BACKGROUND_TYPE.WHITE}),this.$(".gray-color-selector").prepend(a.clone()).data({customType:this.staticDataHolder.BACKGROUND_TYPE.GRAY});var d=this.model.get("backgroundType");null===d&&(d=this.staticDataHolder.BACKGROUND_TYPE.WHITE,this.model.set("backgroundType",d)),this._selectBackColorElement(this.$("."+d.TYPE_NAME+"-color-selector")),this.setAccMessage("white-color-selector",this.getAccMessage("white-color-selector",0)),this.setAccMessage("gray-color-selector",this.getAccMessage("gray-color-selector",1)),this.utils.DisableTouch(this.$(".back-color-selector")),this.utils.EnableTouch(this.$(".back-color-selector"),0),this.$(".background-color-label-container,.gray-color-selector").on("focusin.updateRect",function(){c.$(".background-color-label-container,.gray-color-selector").off("focusin.updateRect"),c.updateFocusRect("background-color-label-container"),c.updateFocusRect("white-color-selector"),c.updateFocusRect("gray-color-selector")})},_createButtons:function(){var a={player:this.player,manager:this.manager,path:this.filePath,idPrefix:this.idPrefix,data:{id:this.idPrefix+"clear-button-container",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,baseClass:"shape-slicer-gray-button-base",text:this.getMessage("button-texts","clear-button-text")}};this.clearBtnView=MathInteractives.global.Theme2.Button.generateButton(a),a.data.id=this.idPrefix+"save-image-button-container",a.data.text=this.getMessage("button-texts","save-image-button-text"),a.data.textPadding=10,this.saveImageBtnView=MathInteractives.global.Theme2.Button.generateButton(a),a.data={id:this.idPrefix+"view-gallery-button-container",text:this.getMessage("button-texts","view-gallery-button-text"),type:MathInteractives.global.Theme2.Button.TYPE.FA_ICONTEXT,baseClass:"shape-slicer-gray-button-base",icon:{faClass:this.getFontAwesomeClass("gallery"),fontWeight:"normal",height:14,width:24}},a.data.id=this.idPrefix+"view-gallery-button-container",a.data.text=this.getMessage("button-texts","view-gallery-button-text"),this.viewGalleryBtnView=MathInteractives.global.Theme2.Button.generateButton(a),a.data={id:this.idPrefix+"color-picker-button-container",type:MathInteractives.global.Theme2.Button.TYPE.ICON,width:26,height:26,icon:{iconPath:this.getImagePath("sprites"),height:26,width:26},tooltipText:this.getMessage("button-texts","color-picker-tooltip-text"),tooltipType:MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.LEFT_MIDDLE},this.colorPickerBtnView=MathInteractives.global.Theme2.Button.generateButton(a),this.colorPickerBtnView.$el.css({height:"26px"}),this.colorPickerBtnView.$(".custom-btn-icon").css({"margin-top":"0px"}),a.data={id:this.idPrefix+"trash-button-container",type:MathInteractives.global.Theme2.Button.TYPE.FA_ICON,width:26,height:26,icon:{faClass:this.getFontAwesomeClass("fixed-trash"),fontColor:"#515050",fontWeight:"normal",height:26,width:26},tooltipText:this.getMessage("button-texts","trash-tooltip-text"),tooltipType:MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.LEFT_MIDDLE},this.trashBtnView=MathInteractives.global.Theme2.Button.generateButton(a),this._setButtonPanelWidth(),this._bindButtonEvents()},_bindButtonEvents:function(){this.colorPickerBtnView.$el.off("click.colorPicker").on("click.colorPicker",$.proxy(this._onColorPickerBtnClick,this)),this.trashBtnView.$el.off("click.trash").on("click.trash",$.proxy(this._onTrashBtnClick,this)),this.clearBtnView.$el.off("click.clear").on("click.clear",$.proxy(this._onClearBtnClick,this)),this.saveImageBtnView.$el.off("click.saveImage").on("click.saveImage",$.proxy(this._onSaveImageBtnClick,this)),this.viewGalleryBtnView.$el.off("click.viewGallery").on("click.viewGallery",$.proxy(this._onViewGalleryBtnClick,this)),this.colorPickerBtnView.$el.on({mouseenter:$.proxy(this._onShapeButtonsMouseEnter,this),mouseleave:$.proxy(this._onShapeButtonsMouseLeave,this)}),this.trashBtnView.$el.on({mouseenter:$.proxy(this._onShapeButtonsMouseEnter,this),mouseleave:$.proxy(this._onShapeButtonsMouseLeave,this)})},_onShapeButtonsMouseEnter:function(a){null!==this.lastLogicalHoveredShape&&(this._setCursor(this.staticDataHolder.CURSOR_TYPE.DEFAULT),this.isShapeScaled&&this._antiScaleShape(this.lastLogicalHoveredShape)),this.isMouseOverShapeButtons=!0},_onShapeButtonsMouseLeave:function(a){this.isMouseOverShapeButtons=!1,null===this.lastLogicalHoveredShape||this.player.getModalPresent()||(this._scaleShape(this.lastLogicalHoveredShape),this._setCursor(this.staticDataHolder.CURSOR_TYPE.OPEN_HAND))},_setButtonPanelWidth:function(){var a=this.clearBtnView.$el.outerWidth(!0)+this.saveImageBtnView.$el.outerWidth(!0)+this.viewGalleryBtnView.$el.outerWidth(!0);this.$(".right-part-buttons-panel").css({width:a})},_onBackColorMouseEnter:function(a){$(a.currentTarget).addClass("hover")},_onBackColorMouseLeave:function(a){$(a.currentTarget).removeClass("hover")},_onBackColorMouseDown:function(a){$(a.currentTarget).addClass("down"),$(document).one("mouseup.back-color-selector",function(a){self.$(".back-color-selector.down").removeClass("down")})},_onBackColorSelect:function(b){this.stopReading(),this.eventManager.trigger(a.ENABLE_TRY_ANOTHER),this._selectBackColorElement($(b.currentTarget))},_selectBackColorElement:function(a){a.hasClass("selected")||(this.$(".back-color-selector.selected").removeClass("selected"),this._changeBackground(a.addClass("selected").data().customType))},_changeBackground:function(a){var b=this.model.get("backgroundType"),c=this.mainModel.get("noOfSlicedShapes"),d=this.mainModel.get("isSaveImageButtonEnabled");this.$el.removeClass(b.TYPE_NAME).addClass(a.TYPE_NAME),this.canvasRect.fillColor=a.TYPE_COLOR,this.paperScope.view.draw(),this.model.set("backgroundType",a),!this.mainModel.get("saveStateLoad")&&!d&&c>0&&this.mainModel.set("isSaveImageButtonEnabled",!0),this.setAccMessage(a.TYPE_NAME+"-color-selector",this.getAccMessage(a.TYPE_NAME+"-color-selector",0)),this.setAccMessage(b.TYPE_NAME+"-color-selector",this.getAccMessage(b.TYPE_NAME+"-color-selector",1)),this.updateFocusRect("gray-color-selector"),this.updateFocusRect("white-color-selector"),this.player.$(".temp-focus-div").focus(),this.setFocus(a.TYPE_NAME+"-color-selector")},_onColorPickerBtnClick:function(b){if(this.colorPickerBtnView.getButtonState()!==MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED){this.stopReading();var c=this.selectedShapeGroup.children.shape;this._disableAllHelpElements(),this.eventManager.trigger(a.DISABLE_BUTTON_ON_COLOR_PICKER),this.generateColorPicker(c),this.setFocus("color-picker-container"),this.changeAccMessage("right-panel-canvas-acc-container",11)}},_onTrashBtnClick:function(a){if(this.trashBtnView.getButtonState()!==MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED){this.stopReading();var b=this.mainModel.get("noOfSlicedShapes"),c=this;b-=11===b?2:1,this.mainModel.set("noOfSlicedShapes",b),this.model.set("selectedShapeGroupName",""),this.selectedShapeGroup.remove(),this.selectedShapeGroup=null,this.canvasAcc.updatePaperItems(this.getPaperObjects()),this.paperScope.view.draw(),0===b?this.setAccMessage("right-panel-canvas-acc-container",this.getAccMessage("right-panel-canvas-acc-container",10)+" "+this.getAccMessage("empty-activity-text",0)):this.setAccMessage("right-panel-canvas-acc-container",this.getAccMessage("right-panel-canvas-acc-container",10)+" "+this.getAccMessage("right-panel-canvas-acc-container",0)),this._setFocusOnCanvas(),window.setTimeout(function(){0===b?c.setAccMessage("right-panel-canvas-acc-container",c.getAccMessage("empty-activity-text",0)):c.setAccMessage("right-panel-canvas-acc-container",c.getAccMessage("right-panel-canvas-acc-container",0))},0),this._showShapeButtons(!1)}},_onClearBtnClick:function(a){this.clearBtnView.getButtonState()!==MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED&&(this.stopReading(),this.mainModel.get("isSaveImageButtonEnabled")||this.mainModel.get("showClearPopup")?this._showPopup():this._clearImageCanvas())},_clearImageCanvas:function(){null!==this.selectedShapeGroup&&(this.selectedShapeGroup.remove(),this.selectedShapeGroup=null),this.allShapesGroup.removeChildren(),this.paperScope.view.draw(),this.model.set("selectedShapeGroupName",""),this.model.set("shapeCounter",-1),this.mainModel.set("noOfSlicedShapes",0),this.canvasAcc.updatePaperItems(this.getPaperObjects()),this._showShapeButtons(!1),this.setFocus("explore-tab-right-part-container")},resetView:function(){this._selectBackColorElement(this.$("."+this.staticDataHolder.BACKGROUND_TYPE.WHITE.TYPE_NAME+"-color-selector")),this._clearImageCanvas()},_showPopup:function(){var a,b,c=this;a={title:this.getMessage("reset-popup",4),accTitle:"",text:this.getMessage("reset-popup",5),accText:"",manager:c.manager,player:c.player,path:c.filePath,idPrefix:c.idPrefix,type:MathInteractives.global.Theme2.PopUpBox.CONFIRM,closeCallback:{fnc:function(a){a.isPositive?c._clearImageCanvas():c.setFocus("clear-button-container")},scope:c},buttons:[{id:c.idPrefix+"ok-btn",text:c.getMessage("reset-popup",2),response:{isPositive:!0,buttonClicked:c.idPrefix+"ok-btn"}},{id:c.idPrefix+"cancel-btn",text:c.getMessage("reset-popup",3),response:{isPositive:!1,buttonClicked:c.idPrefix+"cancel-btn"}}]},b=MathInteractives.global.Theme2.PopUpBox.createPopup(a)},_onSaveImageBtnClick:function(c){if(this.saveImageBtnView.getButtonState()!==MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED){this.stopReading();var d,e=(this.$canvas,{}),f=this,g=this.mainModel.get("galleryObject"),h=this.mainModel.get("currentGalleryIndex");this._deselectShape(),this.mainModel.set("isSaveImageButtonEnabled",!1),this._showShapeButtons(!1),this.isShapeScaled&&null!==this.lastLogicalHoveredShape&&this._antiScaleShape(this.lastLogicalHoveredShape),h<b.MAX_GALLERY_LENGTH?(e.backType=this.model.get("backgroundType"),e.shapeData=this.allShapesGroup.toJSON(),g[h]=e,this.mainModel.set("galleryObject",g),this.eventManager.trigger(a.SAVE_IMAGE),d=g.length||g.length+1,this.mainModel.set("currentGalleryIndex",d),this.mainModel.set("showClearPopup",!1),this.setAccMessage("right-panel-canvas-acc-container",this.getAccMessage("right-panel-canvas-acc-container",16,[d])+" "+this.getAccMessage("right-panel-canvas-acc-container",0)),this.setFocus("right-panel-canvas-acc-container"),window.setTimeout(function(){f.setAccMessage("right-panel-canvas-acc-container",f.getAccMessage("right-panel-canvas-acc-container",0))},0)):(this._createWhoopsPopUp(),this.mainModel.set("showClearPopup",!0))}},_onViewGalleryBtnClick:function(a){this.viewGalleryBtnView.getButtonState()!==MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED&&(this.stopReading(),this.player.switchToTab(2))},_enableClearButton:function(a){var b=a?MathInteractives.global.Theme2.Button.BUTTON_STATE_ACTIVE:MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED;this.clearBtnView.setButtonState(b)},_enableSaveImageButton:function(a){var b=a?MathInteractives.global.Theme2.Button.BUTTON_STATE_ACTIVE:MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED;this.saveImageBtnView.setButtonState(b)},_enableViewGalleryButton:function(a){var b=a?MathInteractives.global.Theme2.Button.BUTTON_STATE_ACTIVE:MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED;this.viewGalleryBtnView.setButtonState(b)},_onShapeCountChange:function(){var a=this.mainModel.get("noOfSlicedShapes");this._showEmptyCanvasText(0>=a),this._enableClearButton(a>0),this.mainModel.set("isSaveImageButtonEnabled",a>0)},_onSaveImageButtonStatusChange:function(){this._enableSaveImageButton(this.mainModel.get("isSaveImageButtonEnabled"))},_onGalleryObjectsCountChange:function(){var a=this.mainModel.get("galleryImageCount");this._enableViewGalleryButton(a>0),this.player.enableTab(a>0,2)},_onDeleteGalleryImage:function(){var a=this.mainModel.get("galleryImageCount"),b=this.mainModel.get("noOfSlicedShapes");0===a&&b>0&&this.mainModel.set("isSaveImageButtonEnabled",!0)},_onGalleryClear:function(){var a=this.mainModel.get("noOfSlicedShapes");a>0&&this.mainModel.set("isSaveImageButtonEnabled",!0)},_showEmptyCanvasText:function(a){var b=this.$(".right-part-text-container");a?(b.show(),this.setAccMessage("right-panel-canvas-acc-container",this.getAccMessage("empty-activity-text",0))):(b.hide(),this.changeAccMessage("right-panel-canvas-acc-container",0))},_showShapeButtons:function(a,b){var c=this.$(".color-picker-trash-buttons-container"),d=b?b.isAccessible:!1,e=this;a?this.browserCheck.isMobile?c.show():c.fadeIn(200,function(){!d&&e.isMouseDownOnShape&&""!==e.model.get("selectedShapeGroupName")&&c.hide()}):c.hide()},_setShapeButtonsPosition:function(){var a,b=new this.paperScope.Group([this.selectedShapeGroup.children["selection-group"].children["shape-boundary"].clone()]),c=b.bounds,d=this.$(".color-picker-trash-buttons-container"),e=this.$(".color-picker-button-container").outerWidth(!0),f=this.$(".color-picker-button-container").outerHeight(!0)+this.$(".trash-button-container").outerHeight(!0),g=5,h=20,i=0,j=c.top+(c.height-f)/2;c.right+(h+e)<this.staticDataHolder.CANVAS_AREA.WIDTH?i=c.right+h:c.left-(e+h)>this.staticDataHolder.CANVAS_AREA.X&&(i=c.left-(e+h)),c.y<this.staticDataHolder.CANVAS_AREA.Y?(a=c.height-(this.staticDataHolder.CANVAS_AREA.Y-c.y),j=this.staticDataHolder.CANVAS_AREA.Y+(a-f)/2):c.bottom>this.staticDataHolder.CANVAS_AREA.Y+this.staticDataHolder.CANVAS_AREA.HEIGHT&&(a=c.height-(c.bottom-(this.staticDataHolder.CANVAS_AREA.Y+this.staticDataHolder.CANVAS_AREA.HEIGHT)),j=c.top+(a-f)/2),j<this.staticDataHolder.CANVAS_AREA.Y?j=this.staticDataHolder.CANVAS_AREA.Y+g:j+f>this.staticDataHolder.CANVAS_AREA.Y+this.staticDataHolder.CANVAS_AREA.HEIGHT&&(j=this.staticDataHolder.CANVAS_AREA.HEIGHT-g-f),d.css({left:i+"px",top:j+"px"}),b.remove()},_setCursor:function(a){a!==this.staticDataHolder.CURSOR_TYPE.DEFAULT&&a!==this.staticDataHolder.CURSOR_TYPE.POINTER&&(a="url('"+this.getImagePath(a)+"'), move"),this.$canvas.css({cursor:a})},_generateShapeColor:function(){var a=this.model.get("shapeColorsToUse"),b=this.model.get("shapeColorIndex");return b=(b+1)%a.length,this.model.set("shapeColorIndex",b),a[b]},_drawCanvasRect:function(){var a=this;null!==this.canvasRect&&this.canvasRect.remove(),this.canvasRect=new this.paperScope.Path.Rectangle({from:[this.staticDataHolder.CANVAS_AREA.X,this.staticDataHolder.CANVAS_AREA.Y],to:[this.staticDataHolder.CANVAS_AREA.WIDTH,this.staticDataHolder.CANVAS_AREA.HEIGHT]}),this.canvasRect.sendToBack(),
this.canvasRect.off("click"),this.canvasRect.on("click",function(b){(a.browserCheck.isMobile||1===b.event.which)&&(a._deselectShape(),a._showShapeButtons(!1),a.isCanvasRectClicked=!0)})},_setShapeColor:function(a,b){var c=this.selectedShapeGroup.children.shape,d=this.mainModel.get("isSaveImageButtonEnabled");this.$(".color-picker-button-container").css({"background-color":b.rgba}),c.fillColor=new this.paperScope.Color(b.rgb.r,b.rgb.g,b.rgb.b,b.alpha),this.paperScope.view.draw(),d||this.mainModel.set("isSaveImageButtonEnabled",!0)},_onSaveStateStart:function(){var a=this.model.get("selectedShapeGroupName");""!==a&&(this._deselectShape(),this._showShapeButtons(!1),null!==this.colorPickerView&&this.colorPickerView._removePopup())},_onSaveStateEnd:function(){},_loadShapesToEdit:function(){var a=this,b=this.model.get("selectedShapeGroupName"),c=this.mainModel.get("galleryObject"),d=this.mainModel.get("currentGalleryIndex"),e=c[d].shapeData;this.paperScope.activate(),this.allShapesGroup.remove(),this.allShapesGroup=new this.paperScope.Group,this.allShapesGroup.importJSON(e),this.allShapesGroup.children.forEach(function(b){a._bindShapeEvents(b.children.shape)}),this._selectBackColorElement(this.$("."+c[d].backType.TYPE_NAME+"-color-selector")),this.paperScope.view.draw(),""!==b&&(this.model.set("selectedShapeGroupName",""),this.selectedShapeGroup.remove(),this.selectedShapeGroup=null),this.model.set("shapeData",this.allShapesGroup),this.mainModel.set("noOfSlicedShapes",this.allShapesGroup.children.length),this.mainModel.set("isSaveImageButtonEnabled",!1),this._showShapeButtons(!1),this.canvasAcc.updatePaperItems(this.getPaperObjects())},_draw2DShape:function(a){var b,c,d,e,f=this.mainModel.get("pathCoordinates");c=this._generateShapeColor(),b=new this.paperScope.Path({name:"shape",segments:f,fillColor:c,closed:!0}),b.strokeColor=new this.paperScope.Color(0,0,0,0),b.position=this.paperScope.view.center,this._bindShapeEvents(b),this._deselectShape(),this._showShapeButtons(!1),e=this.model.get("shapeCounter"),this.model.set("shapeCounter",++e),d=new this.paperScope.Group({children:[b],name:"shape-group-"+e}),a.isTrigger||(this.selectedShapeGroup=d,this._selectShape(b,this.selectedShapeGroup),this._showShapeButtons(!0),this._setShapeButtonsPosition()),this.allShapesGroup.addChild(d),this.canvasAcc.updatePaperItems(this.getPaperObjects()),this.paperScope.view.draw()},_bindToolEvents:function(){var a=this.paperScope.tool;a.off("mouseup"),a.on("mouseup",$.proxy(this._onToolMouseUp,this))},_onToolMouseUp:function(b){return this.eventManager.trigger(a.ENABLE_HOVER,b),this.isCanvasRectClicked?void(this.isCanvasRectClicked=!1):(this.isMouseDownOnShape=!1,this.isMouseUpOnTranslateOrRotate||this._setCursor(this.staticDataHolder.CURSOR_TYPE.DEFAULT),(this.isSelectedShapeDragging||this.isSelectionEndPointDragging)&&(this._showShapeButtons(!0,b),this._setShapeButtonsPosition(),this.isSelectionEndPointDragging&&this._hideRotationIcon(this.lastDraggedEndPoint)),this.isMouseUpOnTranslateOrRotate=this.isSelectedShapeDragging=this.isSelectionEndPointDragging=!1,void(this.lastDraggedEndPoint=null))},_bindShapeEvents:function(a){this._unbindShapeEvents(a),a.on({mouseenter:$.proxy(this._onShapeMouseEnter,this),mousedown:$.proxy(this._onShapeMouseDown,this),mousedrag:$.proxy(this._onShapeMouseDrag,this),mouseup:$.proxy(this._onShapeMouseUp,this),mouseleave:$.proxy(this._onShapeMouseLeave,this)})},_unbindShapeEvents:function(a){a.off("mouseenter"),a.off("mousedown"),a.off("mousedrag"),a.off("mouseup"),a.off("mouseleave")},_onShapeMouseEnter:function(a){if(this.player.getModalPresent()!==!0&&(this.lastLogicalHoveredShape=a.target,!this.isMouseOverShapeButtons&&!this.isSelectedShapeDragging)){var b=null===this.selectedShapeGroup?"":this.selectedShapeGroup.name;this.isSelectionEndPointDragging||"shape"!==a.target.name||a.target.parent.name===b||this._scaleShape(a.target),this._setCursor(this.staticDataHolder.CURSOR_TYPE.OPEN_HAND)}},_onShapeMouseDown:function(b){if(3===b.event.which&&"shape"===b.target.name&&this.isShapeScaled&&this._antiScaleShape(b.target),this.browserCheck.isMobile||1===b.event.which){this.stopReading();var c=null===this.selectedShapeGroup?"":this.selectedShapeGroup.name;this._setCursor(this.staticDataHolder.CURSOR_TYPE.CLOSED_HAND),"shape"===b.target.name&&b.target.parent.name!==c&&(this.isShapeScaled&&this._antiScaleShape(b.target),this._deselectShape(this.selectedShapeGroup),this._selectShape(b.target,b.target.parent)),b.currSelector=this.$(".right-panel-canvas-container-modal"),this.eventManager.trigger(a.DISABLE_HOVER,b),b.isAccessible||this._showShapeButtons(!1,b),this.previousDifference=this.getPointDifference(b.point,this.selectedShapeGroup.position),this.isMouseDownOnShape=!0}},_onShapeMouseDrag:function(a){if((this.browserCheck.isMobile||1===a.event.which)&&this.isMouseDownOnShape){var b=this.mainModel.get("isSaveImageButtonEnabled");this._showShapeButtons(!1),this.selectedShapeGroup.position=this.getPointDifference(a.point,this.previousDifference),this.handleShapeOnBoundary(this.selectedShapeGroup,5),this._setCursor(this.staticDataHolder.CURSOR_TYPE.CLOSED_HAND),this.isSelectedShapeDragging=!0,b||this.mainModel.set("isSaveImageButtonEnabled",!0),a.preventDefault()}},_onShapeMouseUp:function(a){(this.browserCheck.isMobile||1===a.event.which)&&this.isMouseDownOnShape&&(this._setCursor(this.staticDataHolder.CURSOR_TYPE.OPEN_HAND),this._showShapeButtons(!0),this._setShapeButtonsPosition(),this.isShapeScaled&&this._antiScaleShape(a.target),this.isMouseUpOnTranslateOrRotate=!0,this.isSelectedShapeDragging=!1,this.isMouseDownOnShape=!1)},_onShapeMouseLeave:function(a){if(this.player.getModalPresent()!==!0&&(this.lastLogicalHoveredShape=null,!this.isMouseOverShapeButtons)){var b=null===this.selectedShapeGroup?"":this.selectedShapeGroup.name;this._setCursor(this.staticDataHolder.CURSOR_TYPE.DEFAULT),this.isSelectedShapeDragging||this.isSelectionEndPointDragging||"shape"!==a.target.name||a.target.parent.name===b||this.isShapeScaled&&this._antiScaleShape(a.target)}},_scaleShape:function(a){a.scale(this.staticDataHolder.SHAPE_HOVER_SCALE),a.strokeWidth=2,a.strokeColor=this.model.get("backgroundType")===this.staticDataHolder.BACKGROUND_TYPE.WHITE?this.staticDataHolder.BACKGROUND_TYPE.GRAY.TYPE_COLOR:this.staticDataHolder.BACKGROUND_TYPE.WHITE.TYPE_COLOR,this.isShapeScaled=!0},_antiScaleShape:function(a){a.scale(1/this.staticDataHolder.SHAPE_HOVER_SCALE),a.strokeWidth=1,a.strokeColor=new this.paperScope.Color(0,0,0,0),this.isShapeScaled=!1},_bindTranslateIconEvents:function(a){this._unbindTranslateIconEvents(a),a.on({mouseenter:$.proxy(this._onShapeMouseEnter,this),mousedown:$.proxy(this._onShapeMouseDown,this),mousedrag:$.proxy(this._onShapeMouseDrag,this),mouseup:$.proxy(this._onShapeMouseUp,this),mouseleave:$.proxy(this._onShapeMouseLeave,this)})},_unbindTranslateIconEvents:function(a){a.off("mouseenter"),a.off("mousedown"),a.off("mousedrag"),a.off("mouseup"),a.off("mouseleave")},_checkLayering:function(){var a,b=this,c=this.mainModel.get("isSaveImageButtonEnabled"),d=this.selectedShapeGroup.children.shape,e=[];d.fillColor.alpha<.75||(this.allShapesGroup.children.forEach(function(c){b.selectedShapeGroup.name!==c.name&&(d=b.selectedShapeGroup.children.shape,a=c.children.shape,b.checkIntersections(d,a)&&Math.abs(d.area)>Math.abs(a.area)&&d.contains(a.position)&&e.push(c))}),e.forEach(function(a){a.bringToFront()}),e.length>0&&!c&&this.mainModel.set("isSaveImageButtonEnabled",!0),this.paperScope.view.draw())},checkIntersections:function(a,b){var c=a.getIntersections(b),d=c.length;a.area;return!d},_deselectShape:function(){null!==this.selectedShapeGroup&&(this._checkLayering(),this.selectedShapeGroup.removeChildren(1),this.selectedShapeGroup=null),this.paperScope.view.draw(),this.model.set("selectedShapeGroupName","")},_selectShape:function(a,b){var c,d,e,f,g=this.mainModel.get("isSaveImageButtonEnabled");f=this._createTranslateIcon(),e=this._drawShapeBoundary(a),d=this._drawShapeSelectionEndPoints(a),f.position=e.position,c=new this.paperScope.Group({children:[f,e,d],name:"selection-group"}),b.addChild(c),this.selectedShapeGroup=b,this.selectedShapeGroup.bringToFront(),this.paperScope.view.draw(),this.$(".color-picker-button-container").css({"background-color":a.fillColor.toCSS()}),this.paperScope.view.draw(),g||this.mainModel.set("isSaveImageButtonEnabled",!0),this.model.set("selectedShapeGroupName",this.selectedShapeGroup.name)},_drawShapeBoundary:function(a){var b=new this.paperScope.Group([a.clone()]),c=new this.paperScope.Path.Rectangle({name:"shape-boundary",point:b.bounds.point,size:b.bounds.size,strokeColor:"#999695",strokeWidth:2,dashArray:[.4,5],strokeCap:"round"});return b.remove(),c},_handleShapeDeselectEvent:function(a){this._deselectShape(),this._showShapeButtons(!1)},_drawShapeSelectionEndPoints:function(a){for(var b,c=new this.paperScope.Group([a.clone()]),d=new this.paperScope.Group({name:"selection-points-group"}),e=new this.paperScope.Group({name:"end-points-group"}),f=[],g=this.staticDataHolder.GRADIENT_COLOR,h=0;4>h;h++)f[h]=new this.paperScope.Path.Circle({name:"end-point-"+h,radius:8,strokeWidth:2,strokeColor:"#FFFFFF",center:new this.paperScope.Point(0,0),shadowColor:new this.paperScope.Color(0,0,0),shadowBlur:3,shadowOffset:new this.paperScope.Point(3,3)}),f[h].shadowColor.alpha=.33,this._changeHoverState(g[0],g[1],f[h]);if(f[0].position=c.bounds.topRight,f[1].position=c.bounds.bottomRight,f[2].position=c.bounds.bottomLeft,f[3].position=c.bounds.topLeft,e.addChildren(f),b=this._createRotationIcons(e),d.addChildren([e,b]),this.browserCheck.isMobile===!0){for(var i=[],j=new this.paperScope.Group({name:"touch-end-points-group"}),h=0;4>h;h++)i[h]=new this.paperScope.Path.Circle({name:"touch-end-point-"+h,radius:20,center:f[h].position,fillColor:"#FFFFFF"});j.addChildren(i),d.addChild(j),j.opacity=0,this._bindSelectionEndPointEvents(j)}else this._bindSelectionEndPointEvents(e);return e.bringToFront(),c.remove(),d},_createTranslateIcon:function(){var a=new this.paperScope.Raster({name:"translate-icon",source:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA+ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxNS0wMi0yM1QxNDoxMTo1NyswNTozMCIgeG1wOk1vZGlmeURhdGU9IjIwMTUtMDItMjNUMTQ6MTI6MzUrMDU6MzAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTUtMDItMjNUMTQ6MTI6MzUrMDU6MzAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkVBN0M2RTIxQkIzNzExRTRCODEzRjdBNTFEODRBRUFBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkVBN0M2RTIyQkIzNzExRTRCODEzRjdBNTFEODRBRUFBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RUE3QzZFMUZCQjM3MTFFNEI4MTNGN0E1MUQ4NEFFQUEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RUE3QzZFMjBCQjM3MTFFNEI4MTNGN0E1MUQ4NEFFQUEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5FnqOiAAAGbElEQVR42sRZW0gcZxTe2dmbl3g33lJj1uyiG6IkijUqlDyI9EVcpX0pFaG6brIIPvRB+qQPgUKeSmnS5k3EazTkoUL6YLWgLUlbihqk8VIpYr00rnfd62y/Y2ZkMp1Zdd3oD4fZ/zLzf3Mu3zn/LBMZGakKY9NBPCe5YXd3N+i85rSIhA2ioqKuoFXOz89PozuF8b/D8cbqcDwE4MzXr1+vHhwctE9OTt7H0G2MFYXj2UwYTGwuKCio7Ovru5uamnqFBjwez358fPxdXpMvzlOD5pKSEivAOQRwB46o00Wsr69/g5+W02ryNACzi4qKqjo6OuwAl/W/aNHpIsMBMlSA2cXFxTUA95kcuHCCDAVgDHzO2t7eXn/p0iXzkbzzBuRDHqThLABa7t27Vw5wpiBrAhKQhidPnlTTvSfdLBQenGpoaBgcGhq6EhEREb2xseHUaDRsZmZmjrBgf39/Z29vb3MHDRHtjo2NTRgZGXmFqaWzopmraWlpH3IcF1hZWZnT6/WXX79+/bVardbwNLN38+bNL0DaswkJCVnoc263m/N6vY9AO4F3rUFqs0tLSw/5334AtWFzD4AePA99P/zOi5/PnE6nYPLAScEdByCpNwKyJjPnE56RlJSkY1lWK/Ztv9+v4kFxCtmHxSUd8wuhAsymaDWbzbHd3d0/oD+qFGgGg0ENrZHGDkAyDKMKoAVJjWxcXFyjw+HIwe/nfMb5Q15F8EEZuVpaWvr5wsLCK9qopaXlPsbSFNaqoUG7y+XaDfANQbKFKHdgjiWcUsG4paurq5PWbm9vr6NfBymSWytHM+bCwkJrb2+vXeC5vLy8dFzilTQC8yI+1KxYqxRAQayjR2QfRGd0dHRcMDKXAjTduHGjksBlZGRkH/oBGr9WWM+In4FNSFP+Q2qAiaFF8j1O5G/ixvl8Pu44GUfsgybkVmtnZ2cj0pdRvGh1dXWTHBpmKAO/TSBa80AbMxhzkyBSvWKfA0A15l3Qqg0bzsHfzLiSj7F8UUsvrZZLi6iCHFirEqoggQdNyK1W5FZbenp6tlTNALC0tra2Cq4jzgggKPTUwMO7JNB2alZWVg6GDkn15cuXL7B+DS97ERTk29ra2gEILcid0l0AUc7l5+ffku5FHEog8XMSIH8nh9Wh2GxeXFycCxzduBPOKa7nyEkVGoBtAtenQpCw5EPQnPE4meeEc4rrGXJUhUYpFBeDECT74+Pjzx8/ftyrdAPM4YOZ3EKW4IU0cODocHivxEwuWkO/cZ/rMDI4zsff6wu219OnTweIG8VB8nNdXZ0KTs3U1NR8LL1pYGCgH3l1LSYmRo/iAAG674MfakBDcfC1Zbyxtq2trVl8D4Kte2Ji4h8qJGCdGID2InD8y8vLO7m5uckVFRW3jEbjtbdCG8BR9QwAy1fo/iolapaitL+/v1fqE0SqRK5E4JBMSAbkPbhGI66pRNR0DhHWI3A2hTme4I2QLLoHchFyraenp0u6D+itG3MlRP4CUYtphkzyS21t7UFHrEnSLO9Ps5I3/o58GNpkxT5FnAhts9D2v3B4v0yqy8RLxYrHcK7psdlsI4RBXFRIc7EU5EcEjMwUpLhl8AIqceYguoHZCaBSIFDpJfhtAO7Q1dTUNCpXjskVC4cgyW/Ky8s/GBsbmye+DhbecG6vEHlkLnCgh3+WbNHb3Nz8I4rY/OHh4TFo7luMjcmVY0rVDD14tL6+3mkymX6bmZmhamZFqbxHFAe0Wq1OFMW76DPQCCMt//mvES6Y+VlZWVkAdeUQ+lOh1oNTADfHpzRFSoNJ1ZTeRLlbn5iYqENaZIV8LANyGiD/wtV32orarXDYSqV9CCAFAvGdULQSQJRqO2/iIYrWarBmVQak712U/GrQgK2xsdE0PT29AVAMcaJYgxTFyO1JycnJTcSRKK10APo9AI2exanO8uDBg9tVVVWVQnDA3yLEmQt9A059X8LE2/QZBBrV4qoGyFmAXH7X52InMsQigSBBuwAtaoQTneTEGEPgKC1aLJaLGIs98W4KZfxRIptx5Boi3CNkCLmS/igJFSB7HJBkfh7cLQhzlgCPBElVC81Jc+tZAgwKktdcqdLJ7rhy2m/Ub+Vuq9VaTcFCid9ut//EJ37uXD8B00d0/tT2fmtr6ycpKSkX7ty580gpt57HN2pxu8x/KvkzXH9D/CfAAG20D/7LQbYhAAAAAElFTkSuQmCC"});return this._bindTranslateIconEvents(a),a},_changeHoverState:function(a,b,c){c.fillColor={gradient:{stops:[a,b]},origin:c.bounds.bottomRight,destination:c.bounds.topLeft}},_createRotationIcons:function(a){var b=[],c=new this.paperScope.Group({name:"rotation-icon-group"});this.rasterCircle=new this.paperScope.Raster({source:this.rasterCircleSource}),this.rasterSymbol=new this.paperScope.Symbol(this.rasterCircle);for(var d=0;4>d;d++)b[d]=this.rasterSymbol.place(),b[d].name="rotation-icon-"+d,b[d].rotate(90*d),b[d].opacity=0,b[d].guide=!0;return b[0].position=a.children[0].bounds.topRight,b[1].position=a.children[1].bounds.bottomRight,b[2].position=a.children[2].bounds.bottomLeft,b[3].position=a.children[3].bounds.topLeft,c.addChildren(b),this.rasterCircle.remove(),c},_removeRotationIcons:function(a){null!==a&&(a.removeChildren(),a=null),this.paperScope.view.draw()},_showRotationIcon:function(a){a.parent.parent.getItems({name:"rotation-icon-group"})[0].children[a.index].opacity=1},_hideRotationIcon:function(a){a.parent.parent.getItems({name:"rotation-icon-group"})[0].children[a.index].opacity=0},_bindSelectionEndPointEvents:function(a){this._unbindSelectionEndPointEvents(a),a.on({mouseenter:$.proxy(this._onSelectionEndPointMouseEnter,this),mousedown:$.proxy(this._onSelectionEndPointMouseDown,this),mousedrag:$.proxy(this._onSelectionEndPointMouseDrag,this),mouseup:$.proxy(this._onSelectionEndPointMouseUp,this),mouseleave:$.proxy(this._onSelectionEndPointMouseLeave,this)})},_unbindSelectionEndPointEvents:function(a){a.off("mouseenter"),a.off("mousedown"),a.off("mousedrag"),a.off("mouseup"),a.off("mouseleave")},_onSelectionEndPointMouseEnter:function(a){if(this.player.getModalPresent()!==!0&&!this.isSelectedShapeDragging&&!this.isSelectionEndPointDragging){var b=this.browserCheck.isMobile===!0?a.target.parent.parent.getItems({name:"end-points-group"})[0].children[a.target.index]:a.target,c=this.staticDataHolder.GRADIENT_COLOR;this._changeHoverState(c[1],c[0],b),this._setCursor(this.staticDataHolder.CURSOR_TYPE.OPEN_HAND),this._showRotationIcon(b)}},_onSelectionEndPointMouseDown:function(b){if(this.browserCheck.isMobile||1===b.event.which){b.currSelector=this.$(".right-panel-canvas-container-modal"),this.eventManager.trigger(a.DISABLE_HOVER,b),this.stopReading(),this._setCursor(this.staticDataHolder.CURSOR_TYPE.CLOSED_HAND),this._showShapeButtons(!1);var c=b.target.parent.children[b.target.index];this._showRotationIcon(c)}},_onSelectionEndPointMouseDrag:function(a){if(this.browserCheck.isMobile||1===a.event.which){var b=this.browserCheck.isMobile===!0?a.target.parent.parent.getItems({name:"end-points-group"})[0].children[a.target.index]:a.target,c=this.selectedShapeGroup.position,d=a.angleOfRotation||this.getRotationAngle(b.position,c,a.point),e=this.mainModel.get("isSaveImageButtonEnabled");this._showShapeButtons(!1),this.selectedShapeGroup.rotate(d,c),this._setCursor(this.staticDataHolder.CURSOR_TYPE.CLOSED_HAND),this.isSelectionEndPointDragging=!0,this.lastDraggedEndPoint=b,e||this.mainModel.set("isSaveImageButtonEnabled",!0),a.preventDefault()}},_onSelectionEndPointMouseUp:function(a){if(this.browserCheck.isMobile||1===a.event.which){this._setCursor(this.staticDataHolder.CURSOR_TYPE.OPEN_HAND),this._showShapeButtons(!0),this.isSelectionEndPointDragging&&this._setShapeButtonsPosition(),this.isMouseUpOnTranslateOrRotate=!0,this.isSelectionEndPointDragging=!1,this.lastDraggedEndPoint=null;var b=a.target.parent.parent.getItems({name:"end-points-group"})[0].children[a.target.index];this._hideRotationIcon(b)}},_onSelectionEndPointMouseLeave:function(a){if(this.player.getModalPresent()!==!0&&!this.isSelectedShapeDragging&&!this.isSelectionEndPointDragging){var b=this.browserCheck.isMobile===!0?a.target.parent.parent.getItems({name:"end-points-group"})[0].children[a.target.index]:a.target,c=this.staticDataHolder.GRADIENT_COLOR;this._changeHoverState(c[0],c[1],b),this._setCursor(this.staticDataHolder.CURSOR_TYPE.DEFAULT),this._hideRotationIcon(b)}},getRotationAngle:function(a,b,c){var d=a.x-b.x,e=c.x-b.x,f=a.y-b.y,g=c.y-b.y,h=Math.atan2(g,e)-Math.atan2(f,d);return h=180*h/Math.PI},getPointDifference:function(a,b){return{x:a.x-b.x,y:a.y-b.y}},isShapeOutOfBounds:function d(a,b){(void 0===b||null===b)&&(b=0);var c=this.staticDataHolder.CANVAS_AREA.X+b,e=this.staticDataHolder.CANVAS_AREA.Y+b,f=this.staticDataHolder.CANVAS_AREA.X+this.staticDataHolder.CANVAS_AREA.WIDTH-b,g=this.staticDataHolder.CANVAS_AREA.Y+this.staticDataHolder.CANVAS_AREA.HEIGHT-b,h=new this.paperScope.Group([a.clone()]),i=h.bounds,d=i.x<c||i.y<e||i.right>f||i.bottom>g;return h.remove(),d},handleShapeOnBoundary:function(a,b){(void 0===b||null===b)&&(b=0);var c,d=!0,e=this.staticDataHolder.CANVAS_AREA.X+b,f=this.staticDataHolder.CANVAS_AREA.Y+b,g=this.staticDataHolder.CANVAS_AREA.X+this.staticDataHolder.CANVAS_AREA.WIDTH-b,h=this.staticDataHolder.CANVAS_AREA.Y+this.staticDataHolder.CANVAS_AREA.HEIGHT-b,i=0,j=0,k=new this.paperScope.Group([a.clone()]);k.bounds;return a.position.x<e?(i=e-a.position.x,d=!1,c=13):a.position.x>g&&(i=g-a.position.x,d=!1,c=12),a.position.y<f?(j=f-a.position.y,d=!1,c=14):a.position.y>h&&(j=h-a.position.y,d=!1,c=15),a.translate(i,j),k.remove(),this.boundaryCheck=d,d||(this.changeAccMessage("right-panel-canvas-acc-container",6,[this.getAccMessage("right-panel-canvas-acc-container",c)]),this._setFocusOnCanvas()),d},generateColorPicker:function(a){var b=a.bounds.left,d=this.player.$(".explore-tab-right-part-container").position().left,e=this.staticDataHolder.COLOR_PICKER.WIDTH,f=this.staticDataHolder.COLOR_PICKER_OFFSET,g={left:d+b-e-f,top:this.staticDataHolder.COLOR_PICKER_FIXED_TOP},h={idPrefix:this.idPrefix,player:this.player,manager:this.manager,filePath:this.filePath,eventManager:this.eventManager,color:a.fillColor.toCSS(),position:g};this.colorPickerView=MathInteractives.Common.Interactivities.ShapeSlicer.Views.ColorPicker.createColorPicker(h),this.colorPickerView.off(c.EVENTS.COLOR_CHANGE,$.proxy(this._setShapeColor)).off(c.EVENTS.ALPHA_CHANGE,$.proxy(this._setShapeColor)).off(c.EVENTS.ENABLE_HELP,$.proxy(this._enableAllHelpElements)).off(c.EVENTS.CLOSE_COLOR_PICKER,$.proxy(this._colorPickerClosed)).on(c.EVENTS.COLOR_CHANGE,$.proxy(this._setShapeColor,this)).on(c.EVENTS.ALPHA_CHANGE,$.proxy(this._setShapeColor,this)).on(c.EVENTS.ENABLE_HELP,$.proxy(this._enableAllHelpElements,this)).on(c.EVENTS.CLOSE_COLOR_PICKER,$.proxy(this._colorPickerClosed,this))},_createWhoopsPopUp:function(){var a={manager:this.manager,path:this.filePath,player:this.player,idPrefix:this.idPrefix,title:this.getMessage("whoops-popup",0),accTitle:this.getAccMessage("whoops-popup",0),text:this.getMessage("whoops-popup",1),accText:this.getAccMessage("whoops-popup",1),type:MathInteractives.global.Theme2.PopUpBox.CONFIRM,buttons:[{id:"view-button",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("popup-button-text",2),response:{isPositive:!0,buttonClicked:"view-button"}},{id:"cancel-button",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,width:148,text:this.getMessage("popup-button-text",1),response:{isPositive:!1,buttonClicked:"cancel-button"}}],closeCallback:{fnc:function(a){a.isPositive?(this.goToGalleryTab(),this.setFocus("gallery-tab-direction-text-container-direction-text-text")):this.setFocus("view-gallery-button-container")},scope:this}};this.whoopsPopup=MathInteractives.global.Theme2.PopUpBox.createPopup(a),this.updateFocusRect("theme2-pop-up-text"),this.setFocus("theme2-pop-up-title-text")},destroy:function(){this.staticDataHolder=null,this.browserCheck=null,this.utils=null,this.mainModel=null,this.colorPickerBtnView=null,this.trashBtnView=null,this.clearBtnView=null,this.saveImageBtnView=null,this.viewGalleryBtnView=null,this.$canvas=null,this.paperScope=null,this.allShapesGroup=null,this.selectedShapeGroup=null,this.rasterCircleSource=null,this.rasterCircle=null,this.rasterSymbol=null,this.canvasRect=null,this.isCanvasRectClicked=null,this.isMouseDownOnShape=null,this.isMouseUpOnTranslateOrRotate=null,this.isSelectedShapeDragging=null,this.isSelectionEndPointDragging=null,this.isShapeScaled=null,this.isMouseOverShapeButtons=null,this.lastLogicalHoveredShape=null,this.lastDraggedEndPoint=null,this.previousDifference=null,this.whoopsPopup=null,this.eventManager=null},_disableAllHelpElements:function(){var a=this.player;a.enableHelpElement("shape-buttons-panel",0,!1),a.enableHelpElement("reset-button-container",0,!1),a.enableHelpElement("rotate-about-y-axis-button-container",0,!1),a.enableHelpElement("left-canvas-container",0,!1),a.enableHelpElement("right-panel-canvas-container",0,!1),a.enableHelpElement("save-image-button-container",0,!1),a.enableHelpElement("clear-button-container",0,!1),a.enableHelpElement("view-gallery-button-container",0,!1),a.enableHelpElement("background-color-selector-container",0,!1),a.enableHelpElement("color-picker-button-container",0,!1),a.enableHelpElement("trash-button-container",0,!1),a.enableHelpElement("explore-tab-direction-text-direction-text-buttonholder",0,!1)},_enableAllHelpElements:function(){var a=this.player;a.enableHelpElement("shape-buttons-panel",0,!0),a.enableHelpElement("reset-button-container",0,!0),a.enableHelpElement("rotate-about-y-axis-button-container",0,!0),a.enableHelpElement("left-canvas-container",0,!0),a.enableHelpElement("right-panel-canvas-container",0,!0),a.enableHelpElement("save-image-button-container",0,!0),a.enableHelpElement("clear-button-container",0,!0),a.enableHelpElement("view-gallery-button-container",0,!0),a.enableHelpElement("background-color-selector-container",0,!0),a.enableHelpElement("color-picker-button-container",0,!0),a.enableHelpElement("trash-button-container",0,!0),a.enableHelpElement("explore-tab-direction-text-direction-text-buttonholder",0,!0)},_colorPickerClosed:function(b){this.eventManager.trigger(a.ENABLE_BUTTON_ON_COLOR_PICKER),this.colorPickerView=null,this.changeAccMessage("right-panel-canvas-acc-container",11,[this.canvasAcc.getCurrentPaperItemIndex()+1]),this.setFocus("right-panel-canvas-acc-container")},goToGalleryTab:function(){this.player.switchToTab(2)},_loadCanvasForAcc:function(){this._initAccessibility(),this._bindAccessibilityListeners()},_initAccessibility:function(){this.canvasAcc&&(this.canvasAcc.unbind(),this.canvasAcc.model.destroy());var a={canvasHolderID:this.idPrefix+"right-panel-canvas-acc-container",paperItems:[],paperScope:this.paperScope,manager:this.manager,player:this.player};this.canvasAcc=MathInteractives.global.CanvasAcc.intializeCanvasAcc(a),this.canvasAcc.updatePaperItems(this.getPaperObjects())},_bindAccessibilityListeners:function(){var a=this,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,c=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS,d=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,e=this.$("#"+this.idPrefix+"right-panel-canvas-acc-container");this._bindSpaceForAccessibility(),e.off(b.TAB).on(b.TAB,function(b,c){a.mainModel.get("noOfSlicedShapes")>0&&(a._tabKeyPressed(b,c),e.off("keyup.shapeButtons").on("keyup.shapeButtons",$.proxy(a._handleKeyUpEvent,a)))}),e.off(d.FOCUS_OUT).on(d.FOCUS_OUT,function(b,c){a._focusOut(b,c),e.off("keyup.shapeButtons")}),e.off(b.ARROW).on(b.ARROW,function(b,d){a.mainModel.get("noOfSlicedShapes")>0&&(a._arrowKeyPressed(b,d),e.off(c.ARROW_KEYUP).on(c.ARROW_KEYUP,function(b,d){a.mainModel.get("noOfSlicedShapes")>0&&(a._handleOnArrowKeyUp(b,d),e.off(c.ARROW_KEYUP))}))}),e.off(b.ROTATE_CLOCKWISE).on(b.ROTATE_CLOCKWISE,function(b,c){a.mainModel.get("noOfSlicedShapes")>0&&(a._rotateShape(b,c,!0),a._bindRotationUp())}),e.off(b.ROTATE_ANTI_CLOCKWISE).on(b.ROTATE_ANTI_CLOCKWISE,function(b,c){a.mainModel.get("noOfSlicedShapes")>0&&(a._rotateShape(b,c,!1),a._bindRotationUp())})},_handleKeyUpEvent:function(a){if(this.mainModel.get("noOfSlicedShapes")>0){var b=this.staticDataHolder.KEY_CODES,c=this.$("#"+this.idPrefix+"right-panel-canvas-acc-container");switch(a.keyCode){case b.C:this._onColorPickerBtnClick(a);break;case b.D:this._onTrashBtnClick(a),c.off("keyup.shapeButtons")}}},_bindRotationUp:function(){var a=this,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS,c=this.$("#"+this.idPrefix+"right-panel-canvas-acc-container");c.off(b.ROTATION_KEYUP).on(b.ROTATION_KEYUP,function(d,e){a._handleOnRotationKeyUp(d,e),c.off(b.ROTATION_KEYUP)})},_unbindSpaceForAccessibility:function(){var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=this.$("#"+this.idPrefix+"right-panel-canvas-acc-container");b.off(a.SPACE)},_bindSpaceForAccessibility:function(){var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=this.$("#"+this.idPrefix+"right-panel-canvas-acc-container"),c=this;b.on(a.SPACE,function(a,b){c._spaceKeyPressed(a,b)})},_tabKeyPressed:function(a,b){var c=this;this.isFirstTab&&(this.isFirstTab=!1,this.isFocusOnCanvas=!0),null!==this.previousItem&&(a.fromTabKey=!0,c.paperScope.tool.trigger("mouseup",a));var c=this;this.previousItem=b.item;var d=c._createEvent(a,b);d.target=this.previousItem,d.isAccessible=!0,b.item.trigger("mousedown",d),this._showShapeButtons(!0,d),this._setShapeButtonsPosition(),this.changeAccMessage("right-panel-canvas-acc-container",11,[this.canvasAcc.getCurrentPaperItemIndex()+1])},_createEvent:function(a,b){return a.point=this.previousItem.position,a.event={which:1},a.isAccessible=!0,a},_rotateShape:function(a,b,c){var d=this.staticDataHolder.ROTATE_ANGLE;a.target=b.item.parent.getItems({name:"end-points-group"})[0],a=this._createEvent(a,b),this.setAccMessage("right-panel-canvas-acc-container",""),c?a.angleOfRotation=d:a.angleOfRotation=-d,a.target.trigger("mousedrag",a)},_spaceKeyPressed:function(a,b){this._unbindSpaceForAccessibility()},_focusOut:function(b,c){this.isFirstTab=!0,this.isFocusOnCanvas=!1,null!==this.previousItem&&(b.fromTabKey=!0,this.paperScope.tool.trigger("mouseup",b)),this.changeAccMessage("right-panel-canvas-acc-container",0),this.eventManager.trigger(a.DESELECT_SHAPE),this._bindSpaceForAccessibility()},_arrowKeyPressed:function(a,b){a.point={x:b.point.x+5*b.directionX,y:b.point.y+5*b.directionY},a.event={which:b.event.which},a.target=b.item,a.isAccessible=!0,this.setAccMessage("right-panel-canvas-acc-container",""),b.item.trigger("mousedrag",a),this.paperScope.view.draw()},_handleOnArrowKeyUp:function(a,b){var c=b.keyCode-this.staticDataHolder.ARROW_KEY_DELTA,d=this;a.target=b.item,a.isAccessible=!0,this.paperScope.tool.trigger("mouseup",a),this.boundaryCheck&&this.changeAccMessage("right-panel-canvas-acc-container",1,[this.getAccMessage("right-panel-canvas-acc-container",c)]),window.setTimeout($.proxy(d._setFocusOnCanvas,d),100),this._selectPreviousItem(a,b)},_selectPreviousItem:function(a,b){if(this.previousItem&&this.isFocusOnCanvas){var c=this;a.target=this.previousItem,a.isAccessible=!0,this.previousItem.trigger("mousedown",c._createEvent(a,b))}},_handleOnRotationKeyUp:function(a,b){var c=null,d=this;a.target=b.item,a.isAccessible=!0,this.paperScope.tool.trigger("mouseup",a),b.keyCode===MathInteractives.global.CanvasAcc.KEYS.ROTATE_CLOCKWISE?c=8:b.keyCode===MathInteractives.global.CanvasAcc.KEYS.ROTATE_ANTI_CLOCKWISE&&(c=9),this.changeAccMessage("right-panel-canvas-acc-container",7,[this.getAccMessage("right-panel-canvas-acc-container",c)]),window.setTimeout($.proxy(d._setFocusOnCanvas,d),100),this._selectPreviousItem(a,b)},_setFocusOnCanvas:function(){this.isFocusOnCanvas&&this.canvasAcc.setSelfFocus()},getPaperObjects:function(){var a=[];return this.allShapesGroup.children.forEach(function(b){a.push(b.children.shape)}),a.reverse()}},{CURSOR_TYPE:{DEFAULT:"default",POINTER:"pointer",OPEN_HAND:"open-hand",CLOSED_HAND:"closed-hand"},BACKGROUND_TYPE:{WHITE:{TYPE_NAME:"white",TYPE_COLOR:"#ffffff"},GRAY:{TYPE_NAME:"gray",TYPE_COLOR:"#2c2c2c"}},SHAPE_COLOR:["#ff980d","#00aeef","#a13922","#edc900","#4c1787","#db490e","#8dc740","#da4398","#46bd9d","#af853b"],CANVAS_AREA:{X:0,Y:0,WIDTH:414,HEIGHT:412},COLOR_PICKER:{WIDTH:291,HEIGHT:329},COLOR_PICKER_OFFSET:20,COLOR_PICKER_FIXED_TOP:155,SHAPE_HOVER_SCALE:1.05,GRADIENT_COLOR:["#0b0d0c","#515050"],ROTATE_ANGLE:5,KEY_CODES:{C:67,D:68},ARROW_KEY_DELTA:35})}}(),function(){"use strict";if(!MathInteractives.Common.Interactivities.ShapeSlicer.Views.EditPopup){var a,b=MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer.EVENT_MANAGER_MODEL,c=MathInteractives.Common.Interactivities.ShapeSlicer.Models.ShapeSlicer,d=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;MathInteractives.Common.Interactivities.ShapeSlicer.Views.EditPopup=MathInteractives.Common.Player.Views.Base.extend({index:null,eventManager:null,paperScope:null,initialize:function(a){this.initializeDefaultProperties(),this.index=a.index,this.eventManager=a.eventManager,this.player.off(MathInteractives.global.PlayerModel.BEFORE_TAB_SWITCH_EVENT).once(MathInteractives.global.PlayerModel.BEFORE_TAB_SWITCH_EVENT,this.closeModal,this),this.render()},render:function(){this.generateEditPopup(),this.bindEvents()},bindEvents:function(){var a=this,c=this.$(".edit-pop-up-modal"),e=this.$(".edit-popup-container");this.$(".gallery-close-button, .edit-button, .delete-button").off(".popup-buttons"),this.$(".gallery-close-button").on("click.popup-buttons",function(c){a.eventManager.trigger(b.SET_FOCUS,a.index),a.closeModal()}),this.$(".edit-button").on("click.popup-buttons",function(b){a._onEditClick()}),this.$(".delete-button").on("click.popup-buttons",function(b){a._onDeleteClick()}),d?(e.off("click.container-click",".edit-image-container, .gallery-close-button, .edit-button, .delete-button").on("click.container-click",".edit-image-container, .gallery-close-button, .edit-button, .delete-button",function(b){a._onContainerClick(b)}),c.off("click.modal-click").on("click.modal-click",function(b){a._onModalClick()})):(e.off("mousedown.container-click",".edit-image-container, .gallery-close-button, .edit-button, .delete-button").on("mousedown.container-click",".edit-image-container, .gallery-close-button, .edit-button, .delete-button",function(b){a._onContainerClick(b)}),c.off("mousedown.modal-click").on("mousedown.modal-click",function(b){1===b.which&&a._onModalClick();
}))},generateEditPopup:function(){var a={idPrefix:this.idPrefix};this.$el.append(MathInteractives.Common.Interactivities.ShapeSlicer.templates.editPopup(a).trim());var b=this.player.$el;b.append(this.el),this._setPaperScope(),this.generateButtons(),this._setBackGround(),this.handleEditPopupAcc()},_setPaperScope:function(){this.paperScope=new paper.PaperScope,this.paperScope.setup(this.idPrefix+"edit-popup-canvas"),this.paperScope.activate()},_setBackGround:function(){var a=this.index,b=this.$("#"+this.idPrefix+"edit-image-container"),c=this.model.get("galleryObject"),d=null;d=c[a].backType.TYPE_NAME,this._loadShapes(a),b.addClass(d)},_loadShapes:function(b){this.paperScope.activate();var c,d=this.model.get("galleryObject"),e=b,f=d[e].shapeData;this.allShapesGroup&&this.allShapesGroup.remove(),this.allShapesGroup=new this.paperScope.Group,this.allShapesGroup.importJSON(f),c=this.allShapesGroup.position,c.x=c.x*a.SCALE_FACTOR,c.y=c.y*a.SCALE_FACTOR,this.allShapesGroup.scale(a.SCALE_FACTOR),this.paperScope.view.draw()},generateButtons:function(){this.closeBtnView=MathInteractives.global.Theme2.ButtonExtended.generateButton({player:this.player,manager:this.manager,path:this.filePath,idPrefix:this.idPrefix,data:{id:this.idPrefix+"gallery-close-button",type:MathInteractives.global.Theme2.Button.TYPE.FA_ICONTEXT,text:this.getMessage("gallery-modal-text",0),icon:{faClass:this.getFontAwesomeClass("close"),fontSize:20,fontColor:"#2D3A3A",height:23,width:14},baseClass:"edit-popup-button shape-slicer-white-button-base"}}),this.editBtnView=MathInteractives.global.Theme2.ButtonExtended.generateButton({player:this.player,manager:this.manager,path:this.filePath,idPrefix:this.idPrefix,data:{id:this.idPrefix+"edit-button",type:MathInteractives.global.Theme2.Button.TYPE.FA_ICONTEXT,text:this.getMessage("gallery-modal-text",1),icon:{faClass:this.getFontAwesomeClass("fixed-edit-pencil"),fontColor:"#2D3A3A",height:24,width:15},baseClass:"edit-popup-button shape-slicer-white-button-base"}}),this.deleteBtnView=MathInteractives.global.Theme2.ButtonExtended.generateButton({player:this.player,manager:this.manager,path:this.filePath,idPrefix:this.idPrefix,data:{id:this.idPrefix+"delete-button",type:MathInteractives.global.Theme2.Button.TYPE.FA_ICONTEXT,text:this.getMessage("gallery-modal-text",2),icon:{faClass:this.getFontAwesomeClass("fixed-delete"),fontColor:"#2D3A3A",height:24,width:14},baseClass:"edit-popup-button shape-slicer-white-button-base"}})},_onDeleteClick:function(){this._deleteCurrentImage()},_deleteCurrentImage:function(){var a,d=this.index,e=this.model.get("galleryObject"),f=e.length;f===c.MAX_GALLERY_LENGTH&&this.model.set("isSaveImageButtonEnabled",!0),e.splice(d,1),this.model.set("galleryObject",e),a=e.length,this.model.set("currentGalleryIndex",a),this.eventManager.trigger(b.DELETE_IMAGE,d),f-1===d?this.eventManager.trigger(b.SET_FOCUS,this.index-1):this.eventManager.trigger(b.SET_FOCUS,this.index),this.closeModal()},_onEditClick:function(){var a=this.model.get("isSaveImageButtonEnabled");a===!0?this._generateEditPopup():this._onEdit()},_onEdit:function(){var a=this.index;this.model.set("currentGalleryIndex",a),this.eventManager.trigger(b.EDIT_IMAGE),this.closeModal()},_generateEditPopup:function(){var a={manager:this.manager,path:this.filePath,player:this.player,idPrefix:this.idPrefix,title:this.getMessage("edit-image-popup",0),accTitle:this.getMessage("edit-popup-title",0),text:this.getMessage("edit-image-popup",1),accText:this.getMessage("edit-image-popup",1),type:MathInteractives.global.Theme2.PopUpBox.CONFIRM,buttons:[{id:"ok-button",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("popup-button-text",0),response:{isPositive:!0,buttonClicked:"ok-button"}},{id:"cancel-button",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("popup-button-text",1),response:{isPositive:!1,buttonClicked:"cancel-button"}}],closeCallback:{fnc:function(a){a.isPositive?this._onEdit():this.setFocus("edit-button")},scope:this}};this.editPopup=MathInteractives.global.Theme2.PopUpBox.createPopup(a)},_generateDeletePopup:function(){var a={manager:this.manager,path:this.filePath,player:this.player,idPrefix:this.idPrefix,title:this.getMessage("delete-image-popup",0),accTitle:this.getMessage("delete-image-popup",0),text:this.getMessage("delete-image-popup",1),accText:this.getMessage("delete-image-popup",1),type:MathInteractives.global.Theme2.PopUpBox.CONFIRM,buttons:[{id:"ok-button",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("popup-button-text",0),response:{isPositive:!0,buttonClicked:"ok-button"}},{id:"cancel-button",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("popup-button-text",1),response:{isPositive:!1,buttonClicked:"cancel-button"}}],closeCallback:{fnc:function(a){a.isPositive&&this._deleteCurrentImage()},scope:this}};this.editPopup=MathInteractives.global.Theme2.PopUpBox.createPopup(a)},_onModalClick:function(a){this.closeModal()},destroy:function(){delete this.index,delete this.eventManager,delete this.paperScope,delete this.manager,delete this.filePath,delete this.idPrefix,delete this.allShapesGroup,delete this.closeBtnView,delete this.deleteBtnView,delete this.editBtnView},closeModal:function(){this.player.off(MathInteractives.global.PlayerModel.BEFORE_TAB_SWITCH_EVENT,this.closeModal),this.unbindEditPopupAcc(),this.player.enableHelpElement("in-out-cards-0-wrapper",0,!0),this.player.enableHelpElement("gallery-tab-back-button",0,!0),this.player.enableHelpElement("gallery-tab-direction-text-container-direction-text-buttonholder",0,!0),this.destroy(),this.remove(),this.unbind(),delete this},_onContainerClick:function(a){a.stopPropagation()},handleEditPopupAcc:function(){var a=this.player.$(".custom-btn-type-save");0===a.length?this.player.$(".custom-btn-type-help").on("keydown.editPopup",$.proxy(this._setFocusToLastBtn,this)):a.on("keydown.editPopup",$.proxy(this._setFocusToLastBtn,this)),this.player.$(".header-subtitle").on("keydown.editPopup",$.proxy(this._setFocusToFirstBtn,this)),this.$(".edit-image-container").on("keydown.editPopup",$.proxy(this._setFocusToHeaderSubtitle,this)),this.$(".delete-button").on("keydown.editPopup",$.proxy(this._setFocusToHeaderBtn,this))},_setFocusToLastBtn:function(a){9===a.keyCode&&a.shiftKey&&(a.preventDefault(),this.setFocus("delete-button"))},_setFocusToFirstBtn:function(a){9!==a.keyCode||a.shiftKey||(a.preventDefault(),this.setFocus("edit-image-container"))},_setFocusToHeaderSubtitle:function(a){9===a.keyCode&&a.shiftKey&&(a.preventDefault(),this.setFocus("header-subtitle"))},_setFocusToHeaderBtn:function(a){if(9===a.keyCode&&!a.shiftKey){a.preventDefault();var b=this.player.$(".custom-btn-type-save");0===b.length?this.setFocus("help-btn"):this.setFocus("save-btn")}},unbindEditPopupAcc:function(){this.player.$(".custom-btn-type-help,.custom-btn-type-save,.header-subtitle,.delete-button,.edit-image-container").off(".editPopup")}},{createEditModal:function(a){var b=a.model,c=a.el,d=a.index,e=new MathInteractives.Common.Interactivities.ShapeSlicer.Views.EditPopup({el:c,model:b,index:d,eventManager:a.eventManager});return e},SCALE_FACTOR:.7,EVENTS:{DELETE:"delete",EDIT:"edit",CLOSE:"close"}}),a=MathInteractives.Common.Interactivities.ShapeSlicer.Views.EditPopup}}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ShapeSlicer.templates=MathInteractives.Common.Interactivities.ShapeSlicer.templates||{};b.exploreShapeSlicer=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-shape-slicer-container" class="explore-shape-slicer-container">\r\n\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-tab-direction-text" class="explore-tab-direction-text"></div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-tab-activity-area" class="explore-tab-activity-area">\r\n	<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'temp-focus-div" class="temp-focus-div"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-tab-left-part-container" class="explore-tab-left-part-container">\r\n\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'shape-buttons-panel" class="shape-buttons-panel"></div>\r\n			 <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'shape-buttons-panel-modal" class="shape-buttons-panel-modal hover-modal"></div>\r\n			 \r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'left-canvas-container" class="left-canvas-container">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'tooltip-display-container" class="tooltip-display-container"></div>\r\n				   <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'canvas-acc-container" class="activity-canvas-wrapper"></div>\r\n                <div id="shape-slicer-activity-canvas-wrapper" class="activity-canvas-wrapper">\r\n                    <div id="shape-slicer-activity-canvas-screenshot-hack" class="activity-canvas-screenshot-hack"></div>\r\n                    <canvas id="shape-slicer-activity-canvas" class="activity-canvas common-browser" width="432" height="353"></canvas>\r\n                </div>\r\n            </div>\r\n			<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'left-canvas-container-modal" class="left-canvas-container left-canvas-container-modal hover-modal"></div>\r\n			\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'reset-rotate-buttons-panel" class="reset-rotate-buttons-panel">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'reset-button-container" class="reset-button-container"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'rotate-label-container" class="rotate-label-container"></div>\r\n\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'rotate-about-x-axis-button-container" class="rotate-about-x-axis-button-container rotate-button x"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'rotate-about-y-axis-button-container" class="rotate-about-y-axis-button-container rotate-button y"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'rotate-about-z-axis-button-container" class="rotate-about-z-axis-button-container rotate-button z"></div>\r\n\r\n            </div>\r\n		<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'reset-rotate-buttons-panel-modal" class="reset-rotate-buttons-panel reset-rotate-buttons-panel-modal hover-modal"></div>\r\n		\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'slice-button-container" class="slice-button-container buttons-to-be-disabled"></div>\r\n		\r\n        </div>\r\n	\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-tab-right-part-container" class="explore-tab-right-part-container">\r\n\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'background-color-selector-container" class="background-color-selector-container">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'background-color-label-container" class="background-color-label-container"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'white-color-selector" class="white-color-selector back-color-selector buttons-to-be-disabled"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'gray-color-selector" class="gray-color-selector back-color-selector buttons-to-be-disabled"></div>\r\n            </div>\r\n			<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'background-color-selector-container-modal" class="background-color-selector-container background-color-selector-container-modal hover-modal"></div>\r\n             <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-panel-canvas-acc-container" class="right-panel-canvas-container"></div>\r\n			<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-panel-canvas-container" class="right-panel-canvas-container">\r\n                <canvas id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-panel-canvas" width="414" height="410"></canvas>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-part-text-container" class="right-part-text-container"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'color-picker-trash-buttons-container" class="color-picker-trash-buttons-container">\r\n                    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'color-picker-button-container" class="color-picker-button-container shape-2d-button"></div>\r\n                    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'trash-button-container" class="trash-button-container shape-2d-button"></div>\r\n                </div>\r\n            </div>\r\n			 <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-panel-canvas-container-modal" class="right-panel-canvas-container-modal hover-modal"></div>\r\n			 \r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-part-buttons-panel" class="right-part-buttons-panel">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'clear-button-container" class="clear-button-container right-part-button buttons-to-be-disabled"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'save-image-button-container" class="save-image-button-container right-part-button buttons-to-be-disabled"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'view-gallery-button-container" class="view-gallery-button-container right-part-button buttons-to-be-disabled"></div>\r\n            </div>\r\n		\r\n        </div>\r\n		<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'bottom-buttons-modal " class="bottom-buttons-modal hover-modal"></div>\r\n    </div>\r\n\r\n</div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ShapeSlicer.templates=MathInteractives.Common.Interactivities.ShapeSlicer.templates||{};b.galleryShapeSlicer=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'gallery-shape-slicer-container" class="gallery-shape-slicer-container">\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'gallery-tab-direction-text-container" class="gallery-tab-direction-text-container">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'gallery-tab-back-button" class="gallery-tab-back-button"></div>\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'gallery-activity-area" class="gallery-activity-area">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'gallery-carousel-container" class="gallery-carousel-container"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'gallery-dot-container" class="gallery-dot-container">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'dot-1" class="dot-1 gallery-dot active"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'dot-2" class="dot-2 gallery-dot"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'dot-3" class="dot-3 gallery-dot"></div>\r\n        </div>\r\n    </div>\r\n</div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ShapeSlicer.templates=MathInteractives.Common.Interactivities.ShapeSlicer.templates||{};b.colorPicker=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'theme2-pop-up-modal-container" class="theme2-pop-up-modal-container"> \r\n<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'theme2-pop-up-modal-top" class="theme2-pop-up-modal theme2-pop-up-modal-',(g=c.type)?f=g.call(b,{hash:{},data:e}):(g=b&&b.type,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' theme2-pop-up-modal-top"> </div>\r\n<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'theme2-pop-up-modal-center-container" class="theme2-pop-up-modal-center-container"> \r\n<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'theme2-pop-up-modal-left" class="theme2-pop-up-modal theme2-pop-up-modal-',(g=c.type)?f=g.call(b,{hash:{},data:e}):(g=b&&b.type,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' theme2-pop-up-modal-left"> </div>\r\n<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'theme2-pop-up-modal-right" class="theme2-pop-up-modal theme2-pop-up-modal-',(g=c.type)?f=g.call(b,{hash:{},data:e}):(g=b&&b.type,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' theme2-pop-up-modal-right"> </div>\r\n</div>\r\n<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'theme2-pop-up-modal-bottom-left" class="theme2-pop-up-modal theme2-pop-up-modal-',(g=c.type)?f=g.call(b,{hash:{},data:e}):(g=b&&b.type,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'  theme2-pop-up-modal-bottom theme2-pop-up-modal-bottom-left"> </div>\r\n   <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'theme2-pop-up-modal-bottom-right" class="theme2-pop-up-modal theme2-pop-up-modal-',(g=c.type)?f=g.call(b,{hash:{},data:e}):(g=b&&b.type,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'  theme2-pop-up-modal-bottom theme2-pop-up-modal-bottom-right"> </div>\r\n   \r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'color-picker-container" class="color-picker-container">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'color-picker-header" class="color-picker-header">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'header-text" class="header-text"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'close-button-holder" class="close-button-holder">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'close-button" class="close-button"></div>\r\n            </div>\r\n        </div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'color-section" class="color-section">\r\n		 <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'color-picker-acc-disk-container" class="color-picker-disk-container"></div>\r\n          <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'color-picker-disk-container" class="color-picker-disk-container">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'disc-holder" class="disk-holder"></div>\r\n                <canvas id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'color-disk" class="color-disc" height="220" width="220"></canvas>            \r\n          </div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'luminance-bar-holder" class="luminance-bar-holder">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'luminance-slider-holder" class="luminance-slider-holder">\r\n                    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'luminance-slider" class="luminance-slider">\r\n                        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'luminance-bar-white" class="luminance-bar-white"></div>\r\n                        <canvas id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'luminance-gradient" class="luminance-gradient" height="230" width="11"></canvas>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'opacity-section" class="opacity-section">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'opacity-bar-holder" class="opacity-bar-holder">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'opacity-slider" class="opacity-slider">\r\n                    <canvas id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'opacity-gradient" height="12" width="230"></canvas>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ShapeSlicer.templates=MathInteractives.Common.Interactivities.ShapeSlicer.templates||{};b.shapeButton=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"shape-button-container-",(g=c.number)?f=g.call(b,{hash:{},data:e}):(g=b&&b.number,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="shape-button-container shape-button-container-',(g=c.number)?f=g.call(b,{hash:{},data:e}):(g=b&&b.number,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'"></div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ShapeSlicer.templates=MathInteractives.Common.Interactivities.ShapeSlicer.templates||{};b.editPopup=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'edit-pop-up-modal" class="edit-pop-up-modal">\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'edit-popup-container" class="edit-popup-container">\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'edit-image-container" class="edit-image-container">\r\n      <canvas id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'edit-popup-canvas" class="edit-popup-canvas" width="295" height="290"></canvas>\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'button-side-bar" class="button-side-bar">\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'gallery-close-button" class="gallery-close-button"></div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'edit-button" class="edit-button"></div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'delete-button" class="delete-button"></div>\r\n    </div>\r\n  </div>\r\n</div>'})}();