!function(){"use strict";MathInteractives.Common.Interactivities.ShapeDecomposition.Views.ExploreClass=MathInteractives.Common.Player.Views.Base.extend({nextButtonView:null,checkButtonView:null,doneButtonView:null,leftPanelView:null,rightPanelView:null,undoButtonView:null,cutButtonView:null,copyButtonView:null,reflectButtonView:null,rotateButtonView:null,cutLineButtonView:null,modelNamespace:MathInteractives.Common.Interactivities.ShapeDecomposition.Models.ShapeDecompositionData,initialize:function(){this.initializeDefaultProperties(),this.bindListener(),this.render(),this.player.bindTabChange(function(){this.stopReading(),"block"===this.directionTextView2.$el.css("display")?this.setFocus("explore-instruction-bar-2-direction-text-text"):"block"===this.directionTextView1.$el.css("display")?this.setFocus("explore-instruction-bar-1-direction-text-text"):"block"===this.directionTextView0.$el.css("display")&&this.setFocus("explore-instruction-bar-0-direction-text-text")},this,1)},render:function(){var a=this.idPrefix+"left-panel-screen";this.$el.css({"background-image":'url("'+this.getImagePath("bg-image")+'")'}),this.loadScreen("explore-screen"),this._initializeDirectionText(),this._createButtons(),this._setHelpElements(),this.leftPanelView=new MathInteractives.Common.Interactivities.ShapeDecomposition.Views.CanvasAccessibility({model:this.model,el:"#"+a}),a=this.idPrefix+"right-panel-screen",this.rightPanelView=new MathInteractives.Common.Interactivities.ShapeDecomposition.Views.RightPanel({model:this.model,el:"#"+a}),1===this.model.get("type")&&this.$("#shape-decomposition-1-explore-instruction-bar-1-direction-text-buttonholder").hide()},bindListener:function(){this.listenTo(this.model,this.modelNamespace.EVENTS.HIDE_BUTTON,this._hideButton),this.listenTo(this.model,this.modelNamespace.EVENTS.DISABLE_BUTTON,this._disableButton),this.listenTo(this.model,this.modelNamespace.EVENTS.CHANGE_DIRECTION_TEXT,this._updateDirectionText)},_initializeDirectionText:function(){var a,b,c;a={buttonTabIndex:2e3,showButton:!0,buttonText:this.getMessage("explore-texts","0"),btnColorType:MathInteractives.global.Theme2.Button.COLORTYPE.BLUE,btnBaseClass:"buttonBaseClass",clickCallback:{fnc:this._generateTryanotherPopup,scope:this}},b={text:this.getMessage("direction-texts","0"),accText:this.getAccMessage("direction-texts","0"),idPrefix:this.idPrefix,containerId:this.idPrefix+"explore-instruction-bar-0",manager:this.manager,player:this.player,path:this.filePath,tabIndex:1200,containmentBGcolor:"rgba(0,0,0,.14) ",ttsBaseClass:"tts-base-class"},this.directionTextView0=MathInteractives.global.Theme2.DirectionText.generateDirectionText(b),b.containerId=this.idPrefix+"explore-instruction-bar-1",b.text=this.getMessage("direction-texts","1"),b.accText=this.getAccMessage("direction-texts","1"),c=b,2===this.model.get("type")&&(c=$.extend(!0,{},b,a)),this.directionTextView1=MathInteractives.global.Theme2.DirectionText.generateDirectionText(c),b.containerId=this.idPrefix+"explore-instruction-bar-2",b.text=this.getMessage("direction-texts","2"),b.accText=this.getAccMessage("direction-texts","2"),c=$.extend(!0,{},b,a),this.directionTextView2=MathInteractives.global.Theme2.DirectionText.generateDirectionText(c),this.directionTextView1.$el.hide(),this.directionTextView2.$el.hide()},_updateDirectionText:function(a){this.$(".explore-instruction-bars").hide(),this.$(".explore-instruction-bar-"+a).show()},_generateTryanotherPopup:function(){this.stopReading();var a=!1;a===!1?MathInteractives.global.Theme2.PopUpBox.createPopup({manager:this.manager,player:this.player,path:this.filePath,idPrefix:this.idPrefix,title:this.getMessage("explore-texts","1"),accTitle:this.getAccMessage("explore-texts","1"),text:this.getMessage("explore-texts","2"),accText:this.getAccMessage("explore-texts","2"),type:MathInteractives.global.Theme2.PopUpBox.CONFIRM,buttons:[{id:"pop-up-yes",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("explore-texts","yes-button-text"),clickCallBack:{fnc:this.onTryAnotherClick,scope:this},response:{isPositive:!0,buttonClicked:"pop-up-yes"}},{id:"pop-up-cancel",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("explore-texts","cancel-button-text"),clickCallBack:{fnc:this.onTryAnotherCancelClick,scope:this},response:{isPositive:!0,buttonClicked:"pop-up-cancel"}}]}):this.onTryAnotherClick()},_createButtons:function(){var a,b,c,d,e=MathInteractives.global.Theme2.Button.TYPE.FA_ICON;a="undo-button-container",b={faClass:this.getFontAwesomeClass("fixed-undo"),fontColor:"#ffffff",width:44},d=this.getMessage("explore-texts","undo-button-text"),this.undoButtonView=this._generateButton(a,e,b,c,d),a="cut-button-container",b={faClass:this.getFontAwesomeClass("fixed-cut"),fontColor:"#ffffff",width:44},d=this.getMessage("explore-texts","cut-button-text"),this.cutButtonView=this._generateButton(a,e,b,c,d),a="cut-line-button",b={faClass:this.getFontAwesomeClass("fixed-cut"),fontColor:"#ffffff",width:44},d=this.getMessage("explore-texts","cut-button-text"),this.cutLineButtonView=this._generateButton(a,e,b,c,d),a="copy-button-container",b={faClass:this.getFontAwesomeClass("fixed-copy"),fontColor:"#ffffff",width:44},d=this.getMessage("explore-texts","copy-button-text"),this.copyButtonView=this._generateButton(a,e,b,c,d),e=MathInteractives.global.Theme2.Button.TYPE.ICON,a="reflect-button-container",b={iconPath:this.getImagePath("reflect"),height:18,width:22},d=this.getMessage("explore-texts","reflect-button-text"),this.reflectButtonView=this._generateButton(a,e,b,c,d),a="rotate-button-container",b={iconPath:this.getImagePath("rotate"),height:18,width:18},d=this.getMessage("explore-texts","rotate-button-text"),this.rotateButtonView=this._generateButton(a,e,b,c,d),e=MathInteractives.global.Theme2.Button.TYPE.TEXT,a="done-button-container",b={},c=this.getMessage("explore-texts","done-button-text"),this.doneButtonView=this._generateButton(a,e,b,c),a="check-button-container",b={},c=this.getMessage("explore-texts","check-button-text"),this.checkButtonView=this._generateButton(a,e,b,c),e=MathInteractives.global.Theme2.Button.TYPE.FA_ICONTEXT,a="next-button-container",c=this.getMessage("explore-texts","next-button-text"),b={faClass:this.getFontAwesomeClass("fixed-next"),fontColor:"#ffffff",width:15,height:15},this.nextButtonView=this._generateButton(a,e,b,c)},_generateButton:function(a,b,c,d,e){var f={id:this.idPrefix+a,type:b,fixedMinWidth:!0,height:38,baseClass:"buttonBaseClass",textColor:"#ffffff"};b===MathInteractives.global.Theme2.Button.TYPE.FA_ICON||b===MathInteractives.global.Theme2.Button.TYPE.ICON?(f.width=44,f.icon=c,f.tooltipText=e,f.tooltipType=MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.RIGHT_MIDDLE):b===MathInteractives.global.Theme2.Button.TYPE.TEXT?f.text=d:(f.width=115,f.icon=c,f.text=d,f.textPosition="left");var g=MathInteractives.global.Theme2.Button.generateButton({data:f,path:this.filePath,player:this.player,manager:this.manager,idPrefix:this.idPrefix});return g},_hideButton:function(a,b){var c=this.modelNamespace.ACTION_ENUM;b?a===c.UNDO?this.undoButtonView.hideButton():a===c.CUT?this.cutButtonView.hideButton():a===c.COPY?this.copyButtonView.hideButton():a===c.REFLECT?this.reflectButtonView.hideButton():a===c.ROTATE?this.rotateButtonView.hideButton():a===c.DONE?this.doneButtonView.hideButton():a===c.NEXT?this.nextButtonView.hideButton():a===c.TRY_ANOTHER?this.directionTextView.tryAnotherView.hideButton():a===c.CUT_LINE?this.cutLineButtonView.hideButton():this.checkButtonView.hideButton():a===c.UNDO?this.undoButtonView.showButton():a===c.CUT?this.cutButtonView.showButton():a===c.COPY?this.copyButtonView.showButton():a===c.REFLECT?this.reflectButtonView.showButton():a===c.ROTATE?this.rotateButtonView.showButton():a===c.DONE?this.doneButtonView.showButton():a===c.NEXT?this.nextButtonView.showButton():a===c.TRY_ANOTHER?this.directionTextView.tryAnotherView.showButton():a===c.CUT_LINE?this.cutLineButtonView.showButton():this.checkButtonView.showButton()},_disableButton:function(a,b){var c,d=this.modelNamespace.ACTION_ENUM;b?(c=MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED,a===d.UNDO?this.undoButtonView.setButtonState(c):a===d.CUT?this.cutButtonView.setButtonState(c):a===d.COPY?this.copyButtonView.setButtonState(c):a===d.REFLECT?this.reflectButtonView.setButtonState(c):a===d.ROTATE?this.rotateButtonView.setButtonState(c):a===d.DONE?this.doneButtonView.setButtonState(c):a===d.NEXT?this.nextButtonView.setButtonState(c):a===d.CUT_LINE?this.cutLineButtonView.setButtonState(c):this.checkButtonView.setButtonState(c)):(c=MathInteractives.global.Theme2.Button.BUTTON_STATE_ACTIVE,a===d.UNDO?this.undoButtonView.setButtonState(c):a===d.CUT?this.cutButtonView.setButtonState(c):a===d.COPY?this.copyButtonView.setButtonState(c):a===d.REFLECT?this.reflectButtonView.setButtonState(c):a===d.ROTATE?this.rotateButtonView.setButtonState(c):a===d.DONE?this.doneButtonView.setButtonState(c):a===d.NEXT?this.nextButtonView.setButtonState(c):a===d.CUT_LINE?this.cutLineButtonView.setButtonState(c):this.checkButtonView.setButtonState(c))},_setHelpElements:function(){this.loadScreen("help-screen");var a=this.model.get("helpElements");0===a.length&&a.push({elementId:"cut-button-container",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:9,positionArray:["right"]},{elementId:"copy-button-container",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:10,positionArray:["right"]},{elementId:"reflect-button-container",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:11,positionArray:["right"]},{elementId:"rotate-button-container",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:12,positionArray:["right"]},{elementId:"undo-button-container",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:13,positionArray:["right"]},{elementId:"actual-shape-table-wrapper",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:3},{elementId:"left-panel-canvas-acc-container",helpId:"explore-help",fromElementCenter:!0,hideArrowDiv:!0,msgId:0,positionArray:["top"]},{elementId:"check-button-container",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:8,positionArray:["top"]},{elementId:"done-button-container",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:5,positionArray:["top"]},{elementId:"next-button-container",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:7,positionArray:["top"]},{elementId:"explore-instruction-bar-1-direction-text-buttonholder",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:6},{elementId:"explore-instruction-bar-2-direction-text-buttonholder",helpId:"explore-help",fromElementCenter:!1,hideArrowDiv:!1,msgId:6})},onTryAnotherCancelClick:function(){this.stopReading(),this.setFocus("explore-instruction-bar-1-direction-text-buttonholder"),this.setFocus("explore-instruction-bar-2-direction-text-buttonholder")},onTryAnotherClick:function(){this.stopReading(),this.model.trigger(this.modelNamespace.EVENTS.TRY_ANOTHER_CLICK)}})}(),function(){"use strict";MathInteractives.Common.Interactivities.ShapeDecomposition.Views.LeftPanel=MathInteractives.Common.Player.Views.Base.extend({gridPoints:null,gridCanvasScope:null,workCanvasScope:null,shapeGroup:null,cutLineHandleGroup:null,screenGroup:null,unitLabelGroup:null,dottedCutLine:null,handleGroup:null,paperTool:null,currentEvent:null,selectedShapeEvent:null,selectedShape:null,mouseDownPoint:null,currentX:null,currentY:null,dependendSegment:null,canvasShapes:null,uniqueNumber:null,isShapeDragged:null,validCutPointsObjects:null,validCutshapes:null,dummyRectangleOfCutButton:null,shapesTooltipViews:null,modelNamespace:MathInteractives.Common.Interactivities.ShapeDecomposition.Models.ShapeDecompositionData,utilityNamespace:MathInteractives.Common.Interactivities.ShapeDecomposition.Views.UtilityFunctions,_shapeLabels:null,_$tempTooltipContentHolder:null,isRemoveLabelRequired:!1,isCurrentShapeIntersecting:null,focusRect:null,initialize:function(){this.initializeDefaultProperties(),this.initializeVariables(),this.loadCanvas(),this.render(),this._bindEvents()},initializeVariables:function(){this.gridPoints=[],this.currentX=[],this.currentY=[],this.dependendSegment=[],this.canvasShapes=[],this.shapesTooltipViews={},this.uniqueNumber=0,this.isShapeDragged=!1,this._shapeLabels={},this._$tempTooltipContentHolder=this.$(".temporary-tooltip-content-holder")},render:function(){var a=this.modelNamespace.GRID_START_X,b=this.modelNamespace.GRID_START_Y,c=this.modelNamespace.GAP_BETWEEN_POINTS,d=this.modelNamespace.NUMBER_OF_X_POINTS,e=this.modelNamespace.NUMBER_OF_Y_POINTS,f=null,g=this.modelNamespace.ACTION_ENUM,h=this.modelNamespace.EVENTS;this.generateGrid(a,b,c,d,e),this.gridCanvasScope.remove(),this.activateWorkCanvasScope(),this.paperTool=new this.workCanvasScope.Tool,this.shapeGroup=new this.workCanvasScope.Group,this.screenGroup=new this.workCanvasScope.Group,this.setDefaultShapeColor(),this.setCopiedShapeColor(),this.drawSelectedShapeWindow(),this._drawUnitScaleLabel(),this.model.trigger(h.HIDE_BUTTON,g.CUT_LINE,!0),2===this.model.get("type")?(this._renderShapes(),this._bindShapeEvent(),this.model.trigger(h.HIDE_BUTTON,g.NEXT,!0)):(f={},f.target={},f.target.shapeUniqueCode=9,this.selectedShapeEvent=f,this.onDoneButtonClick()),this.$(".left-panel-buttons-container").hide(),this.listenTo(this.model,h.TRY_ANOTHER_CLICK,this._resetInteractivity),this.listenTo(this.model,h.DONE_BUTTON_CLICK,this.onDoneButtonClick),this.listenTo(this.model,h.NEXT_BUTTON_CLICK,this.onNextButtonClick),this.listenTo(this.model,h.CHECK_BUTTON_CLICK,this.onCheckButtonClick),this.listenTo(this.model,h.CHANGE_SHAPE_BORDER_COLOR,this._onShapeBorderColorChangeRequired),this.listenTo(this.model,h.ADD_REMOVE_SHAPE_LABEL,this._addRemoveShapeLabel),this.model.trigger(h.DISABLE_BUTTON,g.UNDO,!0),this.model.trigger(h.HIDE_BUTTON,g.CHECK,!0),this.player.enableHelpElement("actual-shape-table-wrapper",3,!1),this.correctLabelIcon=new this.workCanvasScope.Raster(this.modelNamespace.LABEL_URL.CORRECT,{x:-20,y:-20}),this.incorrectLabelIcon=new this.workCanvasScope.Raster(this.modelNamespace.LABEL_URL.INCORRECT,{x:-20,y:-20}),this.loadScreen("buttons-screen"),2===this.model.get("type")&&(this.loadAccessibility(),this.model.trigger(h.DISABLE_BUTTON,g.DONE,!0)),this.focusRect=new this.workCanvasScope.Path.RegularPolygon(new this.workCanvasScope.Point(100,100),4,30),this.focusRect.strokeColor="black",this.focusRect.strokeWidth=1,this.focusRect.dashArray=[2,2],this.focusRect.visible=!1},loadCanvas:function(){paper.install(this);var a=new paper.PaperScope;a.setup(this.$el.find("#"+this.idPrefix+"grid-canvas")[0]),this.gridCanvasScope=a,this.gridCanvasScope.activate();var b=new paper.PaperScope;b.setup(this.$el.find("#"+this.idPrefix+"work-canvas")[0]),this.workCanvasScope=b},activateWorkCanvasScope:function(){this.workCanvasScope&&this.workCanvasScope.activate()},_bindEvents:function(){var a=this;this.$el.on("click",'.cut-button-container:not(".disabled")',function(b){a.cutButtonClick(b)}),this.$el.on("click",'.copy-button-container:not(".disabled")',function(b){a.copyButtonClick(b)}),this.$el.on("click",'.reflect-button-container:not(".disabled")',function(b){a.reflectButtonClick(b)}),this.$el.on("click",'.rotate-button-container:not(".disabled")',function(b){a.rotateButtonClick(b)}),this.$el.on("click",'.undo-button-container:not(".disabled")',function(b){a.undoButtonClick(b)}),this.$el.on("click",'.cut-line-button:not(".disabled")',function(b){a.cutLineButtonClick(b)}),this.$el.on("focusout",'.cut-line-button:not(".disabled")',function(b){a.cutLineButtonFocusOut(b)}),this.$el.on("keydown",'.cut-line-button:not(".disabled")',function(b){a.cutLineButtonKeyDown(b)})},generateGrid:function(a,b,c,d,e){var f,g=a;this.gridCanvasScope.activate();for(var h=0;e>h;h++){a=g;for(var i=0;d>i;i++)f=new this.gridCanvasScope.Point(a,b),this.gridPoints.push(f),a+=c;b+=c}this._drawLines(d,e),this.gridCanvasScope.view.draw()},_drawLines:function(a,b){var c,d=a;for(c=0;a>c;c++)this._makeLine(this.gridPoints[c],this.gridPoints[this.gridPoints.length-(d-c)],"#acacac",1,!1);c=0;do this._makeLine(this.gridPoints[c],this.gridPoints[c+d-1],"#acacac",1,!1),c+=d;while(c<this.gridPoints.length)},_makeLine:function(a,b,c,d,e){this.gridCanvasScope.activate();var f=new this.gridCanvasScope.Path.Line(a,b);return f.strokeColor=c,f},_renderShapes:function(){for(var a,b,c=this.model.getShapesStartIndex("render"),d=0,e=this.modelNamespace.SHAPE_STROKE_COLORS.NORMAL,f=this.getDefaultShapeColor("normal"),g=0;g<c.length;g++){var h=new this.workCanvasScope.Path;d=c[g],h.add(this.gridPoints[d]),b=this.model.getDefaultShapes(g);for(var i=0;i<b.length;i++)d+=b[i],h.add(this.gridPoints[d]);if(g<c.length-2)h.shapeUniqueCode=g,h.isSelected=!1,h.strokeColor=e,h.strokeWidth=2,h.fillColor=f,this.shapeGroup.addChild(h);else if(g===c.length-2)a=h;else{var j=this._createCompoundPath(a,h,f,e,2);j.shapeUniqueCode=g-1,j.isSelected=!1,this.shapeGroup.addChild(j)}}this.workCanvasScope.view.draw()},_createCompoundPath:function(a,b,c,d,e){var f=new this.workCanvasScope.CompoundPath({children:[a,b],fillColor:c,strokeColor:d,strokeWidth:e});return f},drawSelectedShapeWindow:function(){var a,b,c,d,e=this.model.getSelectedShapeWindowCoordinates(),f=new this.workCanvasScope.Color(.25,.25,.25,.4),g={};g.x=this.gridPoints[476].x+12,g.y=this.gridPoints[476].y+12,d=new this.workCanvasScope.Path.RegularPolygon(g,4,16);for(var h=0;h<e.length;h++)if(0===h){a=new this.workCanvasScope.Path;for(var i=0;i<e[h].length;i++)a.add(this.gridPoints[e[h][i]])}else{b=new this.workCanvasScope.Path,c=new this.workCanvasScope.Path,c.strokeColor="#414141",c.strokeWidth=2,c.dashArray=[10,3];for(var i=0;i<e[h].length;i++)b.add(this.gridPoints[e[h][i]]),c.add(this.gridPoints[e[h][i]])}var j=new this.workCanvasScope.CompoundPath({children:[a,b,d],fillColor:f});c.bringToFront(),this.screenGroup.addChild(j),this.screenGroup.addChild(c),this.screenGroup.visible=!1,this.workCanvasScope.view.draw()},_drawUnitScaleLabel:function(){var a,b,c,d={},e={};d.x=this.gridPoints[476].x+12,d.y=this.gridPoints[476].y+12,e.x=this.gridPoints[478].x+12,e.y=this.gridPoints[478].y+12,a=new this.workCanvasScope.Path.RegularPolygon(d,4,16),a.strokeColor="#4a4a4a",a.strokeWidth=2,b=new this.gridCanvasScope.PointText(e),b.font="Montserrat",b.justification="center",b.fillColor="#222222",b.content="= 1 "+this.getMessage("explore-texts","area-unit-text"),b.strokeWidth=1,b.fontSize=14,b.position.y+=4,b.position.x-=7,c=new this.gridCanvasScope.PointText(b.bounds.topRight),c.font="Montserrat",c.justification="center",c.fillColor="#222222",c.strokeWidth=1,c.fontSize=8,c.content="2",c.position.x+=3,c.position.y+=7,this.unitLabelGroup=new this.workCanvasScope.Group,this.unitLabelGroup.addChild(a),this.unitLabelGroup.addChild(b),this.unitLabelGroup.addChild(c),this.unitLabelGroup.visible=!1},drawShape:function(a){var b,c,d=a.target.shapeUniqueCode,e=this.model.getShapesStartIndex("selected")[d],f=this.getDefaultShapeColor("normal"),g=this.modelNamespace.SHAPE_STROKE_COLORS.NORMAL,h=e,i=97,j=1;this.handleGroup=new this.workCanvasScope.Group,c=new this.workCanvasScope.Path,c.add(this.gridPoints[e]),this.drawHandlesOfShape(this.gridPoints[e],i,j),j++,b=this.model.getDefaultShapes(d);for(var k=0;k<b.length;k++)i++,h+=b[k],c.add(this.gridPoints[h]),k<b.length-1&&(this.drawHandlesOfShape(this.gridPoints[h],i,j),j++);if(7===d){var l=new this.workCanvasScope.Path;e=this.model.getShapesStartIndex("selected")[8],h=e,l.add(this.gridPoints[e]),this.drawHandlesOfShape(this.gridPoints[e],i,j),j++,b=this.model.getDefaultShapes(8);for(var k=0;k<b.length;k++)i++,h+=b[k],l.add(this.gridPoints[h]),k<b.length-1&&(this.drawHandlesOfShape(this.gridPoints[h],i,j),j++);this.selectedShape=this._createCompoundPath(c,l,f,g,2)}else c.strokeColor=g,c.strokeWidth=2,c.fillColor=f,this.selectedShape=c;this.selectedShape.shapeUniqueCode=d,this.workCanvasScope.view.draw()},drawHandlesOfShape:function(a,b,c){var d=11,e="normal",f="vertex",g=new this.workCanvasScope.Path.Circle(a,d);g.style=this.getCircleStyle(a,e,f),g.handleCode=String.fromCharCode(b),g.handleNumber=c,this.handleGroup.addChild(g)},getCircleStyle:function(a,b,c){var d,e;d="hover"===b?["#ffffff","#749098"]:["#749098","#ffffff"],"vertex"===c?e="#224c5c":"cutHandle"===c&&(e="#501b83");var f=new this.workCanvasScope.Point(a.x,a.y-9),g=new this.workCanvasScope.Point(a.x,a.y+9),h={strokeColor:e,fillColor:{gradient:{stops:d},origin:g,destination:f},strokeWidth:2,shadowColor:"#000",shadowBlur:6,shadowOffset:{x:1,y:1}};return h},getDefaultShapeColor:function(a){return this.model.get("defaultShapeColors")[a]},setDefaultShapeColor:function(){var a={normal:new this.workCanvasScope.Color(.29,.74,.92,.5),hover:new this.workCanvasScope.Color(.56,.86,.98,.5),selected:new this.workCanvasScope.Color(.29,.92,.54,.5)};this.model.set("defaultShapeColors",a)},getCopiedShapeColor:function(a){return this.model.get("copiedShapeColors")[a]},setCopiedShapeColor:function(){var a={normal:new this.workCanvasScope.Color(.741,.737,.737,.5),hover:new this.workCanvasScope.Color(.886,.886,.886,.5),selected:new this.workCanvasScope.Color(.729,.659,.078,.5)};this.model.set("copiedShapeColors",a)},addPropertiesToShape:function(a,b){a.isOriginal=b,a.currentRotationCount=0,a.miterLimit=1,a.defaultCenter=a.position},fetchShapePaperObject:function(a,b){a=Number(a);var c,d,e,f,g,h;for(f=this.canvasShapes,g=f.length,c={},h=0,d=0;g>d;d++)if(e=f[d],e.shapeUniqueCode===a&&e.isOriginal===b)return e},fetchPaperObjectIndex:function(a){var b,c,d,e,f,g;for(g=[],d=this.canvasShapes,e=d.length,f=0,b=0;e>b;b++)if(c=d[b],c.shapeUniqueCode===a&&(g.push(b),f++,2===f))return g;return g},_resetInteractivity:function(){this.activateWorkCanvasScope(),this._removeAllShapeLabels(!0);var a,b,c=this.modelNamespace,d=c.EVENTS,e=c.ACTION_ENUM;for(this.selectedShapeCode=null,this.currentX=[],this.currentY=[],this.dependendSegment=[],this.currentEvent=null,this.selectedShapeEvent=null,this.mouseDownPoint=null,2===this.model.get("type")?(this.screenGroup.visible=!1,this.shapeGroup.visible=!0):this.screenGroup.visible=!0,this.selectedShape&&this.selectedShape.remove(),this.handleGroup&&(this.unbindPaperEvents(this.handleGroup),this.handleGroup.remove(),this.handleGroup=null),this.removeCutLine(),this.unbindPaperEvents(this.paperTool),2===this.model.get("type")&&(this._bindShapeEvent(),this.unitLabelGroup.visible=!1,this.player.changeHelpElementText("left-panel-canvas-acc-container",0,this.getMessage("canvas-help-texts",0),this.getAccMessage("canvas-help-texts",0))),this.$(".left-panel-buttons-container").hide(),this.model.trigger(d.CHANGE_DIRECTION_TEXT,0),this.model.trigger(d.HIDE_BUTTON,e.NEXT,!0),this.model.trigger(d.HIDE_BUTTON,e.CHECK,!0),this.model.trigger(d.HIDE_BUTTON,e.DONE,!1),this.model.trigger(d.DISABLE_BUTTON,e.DONE,!0),this.model.trigger(d.DISABLE_BUTTON,e.CUT,!1),this.model.set("undoStack",[]),this.model.set("polygonVertexUndoStack",[]),this.model.set("polygonBoundaryPointsUndoStack",[]),b=0;b<this.canvasShapes.length;b++)this.unbindPaperEvents(this.canvasShapes[b]),this.canvasShapes[b].remove();this.canvasShapes=[],this.uniqueNumber=0,this.unBindAccessibilityListeners(),1===this.model.get("type")?(a={},a.target={},a.target.shapeUniqueCode=9,this.selectedShapeEvent=a,this.onDoneButtonClick(),this.player.changeHelpElementText("left-panel-canvas-acc-container",0,this.getMessage("canvas-help-texts",1),this.getAccMessage("canvas-help-texts",1)),this.setFocus("explore-instruction-bar-1-direction-text-text")):(this.bindAccessibilityListenersForSelectShape(),this.changeAccMessage("explore-tab-activity-holder",0),this.changeAccMessage("left-panel-canvas-acc-container",0),this.setFocus("explore-instruction-bar-0-direction-text-text")),this.player.enableHelpElement("actual-shape-table-wrapper",3,!1),this.workCanvasScope.view.draw()},_addRemoveShapeLabel:function(a,b){var c,d=this.modelNamespace.SHAPE_STROKE_COLORS,e=d.CORRECT,f=d.INCORRECT;a&&(c=b.shape,b.correctLabel?c.strokeColor=e:c.strokeColor=f)},_removeAllShapeLabels:function(a){for(var b=this.modelNamespace.SHAPE_STROKE_COLORS,c=b.NORMAL,d=b.COPY,e=(this.modelNamespace.EVENTS,this.modelNamespace.ACTION_ENUM,0);e<this.canvasShapes.length;e++)this.canvasShapes[e].strokeColor=this.canvasShapes[e].isOriginal?c:d},_createLabel:function(a,b){var c,d,e,f;return c=new this.workCanvasScope.PointText({justification:"center",font:"Montserrat",fontSize:14,fillColor:"#222222",content:a+" "+this.getMessage("explore-texts","area-unit-text")}),d=new this.workCanvasScope.PointText({font:"Montserrat",fontSize:8,fillColor:"#222222",point:c.bounds.topRight,content:"2"}),d.translate(0,d.bounds.height/2),e=b?this.correctLabelIcon.clone():this.incorrectLabelIcon.clone(),e.position=d.bounds.bottomRight,e.translate(e.bounds.width/2+5,0),f=new this.workCanvasScope.Group([c,d,e]),f.guide=!0,f},_positionLabel:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this.modelNamespace.GAP_BETWEEN_POINTS,s=(a.bounds.width,b.clone(!1).bounds),t=0,u=MathInteractives.Common.Utilities.Models.Utils,v=this.modelNamespace.GRID_START_X,w=this.modelNamespace.GRID_START_Y;if(g=new this.workCanvasScope.Path.Rectangle(a.bounds),d=this.modelNamespace.calcCenterOfMass(b),e=Math.floor((d.x-v)/r)*r+r/2+v,f=Math.floor((d.y-w)/r)*r+r/2+w,l=this.modelNamespace.positionAndCheckBlock(g,b,e,f,this.workCanvasScope),l.isValidForLabel)return a.position={x:e,y:f},g.remove(),a;if(s.width>r){for(i=s.height/r,j=0,h=0,k=-1;i>j;h++,k*=-1)if(f+=r*h*k,!(f<s.top||f>s.bottom)&&(j++,m=this._checkRow(g,b,f,d))){if(m.validPointForLabel&&(o?(n=u.getPointDistance(d,m.validPointForLabel),p>n&&(o=m.validPointForLabel,p=u.getPointDistance(d,o))):(o=m.validPointForLabel,p=u.getPointDistance(d,o)),t++,3===t))break;m.validPointForIcon&&(q?u.getPointDistance(d,m.validPointForIcon)<u.getPointDistance(d,q)&&(q=m.validPointForIcon):q=m.validPointForIcon)}if(o)return a.position=o,g.remove(),a}return c=a.lastChild,c.guide=!0,a.remove(),this.workCanvasScope.project.activeLayer.addChild(c),q?c.position=q:this._positionLabelIcon(b,c),g.remove(),c.needsTooltip=!0,c},_checkRow:function(a,b,c,d){var e,f,g,h,i=b.clone(!1),j=(i.bounds,this.modelNamespace.GAP_BETWEEN_POINTS),k=new this.workCanvasScope.Point(this.modelNamespace.BOUNDING_BOX_LEFT-this.modelNamespace.GRID_START_X,0),l=new this.workCanvasScope.Point(this.modelNamespace.BOUNDING_BOX_RIGHT+this.modelNamespace.GRID_START_X,0),m=new this.workCanvasScope.Path.Line(k,l),n=new this.workCanvasScope.Path.Line(k,l);MathInteractives.Common.Utilities.Models.Utils;return m.position.y=c-j/2,n.position.y=c+j/2,e=i.getIntersections(m),f=i.getIntersections(n),m.remove(),n.remove(),g=e.length,h=f.length,1===g||1===h?!1:(e.sort(this.modelNamespace.sortHorizontalIntersections),f.sort(this.modelNamespace.sortHorizontalIntersections),this.modelNamespace.handleIntersectionCase({shape:b,topIntersections:e,bottomIntersections:f,labelRect:a,centroid:d,y:c,paperscope:this.workCanvasScope}))},_positionLabelIcon:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(c=a.bounds,d=c.width,e=c.height,f=this.modelNamespace.GAP_BETWEEN_POINTS,g=e/f,h=d/f,k=c.left+f/2,l=c.top+f/2,r=0,p=new this.workCanvasScope.Path.Rectangle(b.bounds),j=0;g>j;j++)for(n=l+j*f,i=0;h>i;i++)m=k+i*f,p.position={x:m,y:n},q=a.intersect(p),q.area>r&&(r=q.area,o={x:m,y:n}),q.remove();p.remove(),b.position=o},generateTooltip:function(a,b){var c=this._generateTooltipContent(b),d=MathInteractives.Common.Components.Views.CanvasTooltip,e=MathInteractives.global.Theme2.Tooltip,f={elementEl:this.idPrefix+"psuedo-element-"+a.shapeUniqueCode+"-"+a.isOriginal,paperObject:a,baseClass:"shape-tooltip",_player:this.player,manager:this.manager,filePath:this.filePath,idPrefix:this.idPrefix,type:e.TYPE.GENERAL,arrowType:e.ARROW_TYPE.BOTTOM_MIDDLE,position:"top-middle",backgroundColor:"#ffffff",dynamicArrowPosition:!0,isTts:!1,padding:10,containerHeight:c.height,containerEleId:"left-panel-canvas-container",text:c.html,containerWidth:c.width,isTooltipPermanent:!1};this.shapesTooltipViews[a.shapeUniqueCode+"|"+a.isOriginal]=d.generateCanvasTooltip(f)},removeTooltip:function(a){var b,c;if(a&&this.shapesTooltipViews[a])b=this.shapesTooltipViews[a],b.removeTooltip(),b.remove(),b.$pseudoElement.remove(),delete this.shapesTooltipViews[a];else for(c in this.shapesTooltipViews)b=this.shapesTooltipViews[c],b.removeTooltip(),b.remove(),b.$pseudoElement.remove(),delete this.shapesTooltipViews[c]},_generateTooltipContent:function(a){var b,c=this.getMessage("explore-texts","area-unit-text"),d={};return a+=" "+c,b=$("<div></div>",{"class":"tooltip-content"}).html(a+"<span>2</span>").appendTo(this._$tempTooltipContentHolder),d={html:b.html(),width:b.width()+10,height:b.height()+10},b.remove(),d},isShiftKeyPress:null,cutLineButtonKeyDown:function(a){this.isShiftKeyPress=a.shiftKey},cutLineButtonFocusOut:function(a){if(this.enableTab("cut-line-button",!1),!this.isCutLineButtonClicked){var b=this.getAccMessage("left-panel-canvas-acc-container","shapeText"),c=this.getAccMessage("left-panel-canvas-acc-container","isText");this.canvasShapes.length>1&&(b=this.getAccMessage("left-panel-canvas-acc-container","shapesText"),c=this.getAccMessage("left-panel-canvas-acc-container","areText")),this.changeAccMessage("left-panel-canvas-acc-container",12,[b,c]),this.isShiftKeyPress&&this.setFocus("left-panel-canvas-acc-container")}this.isCutLineButtonClicked=!1}})}(),function(){"use strict";MathInteractives.Common.Interactivities.ShapeDecomposition.Views.PaperEventFunctions=MathInteractives.Common.Interactivities.ShapeDecomposition.Views.LeftPanel.extend({initialize:function(){this._superwrapper("initialize",[])},_bindShapeEvent:function(){var a=this;this.shapeGroup.on({mousedown:function(b){a.stopReading(),a.player.getModalPresent()||($.support.touch?0:1!==b.event.which)||a.onMouseDownOnDefaultShapes(b)},mouseenter:function(b){a.player.getModalPresent()||a.onMouseEnterOnDefaultShapes(b)},mouseleave:function(b){a.player.getModalPresent()||$.support.touch||a.onMouseLeaveOnDefaultShapes(b)},mouseup:function(b){!a.player.getModalPresent()}}),this.paperTool.on({mouseup:function(b){a.player.getModalPresent()||(null===a.currentEvent&&a.selectedShapeEvent?a.currentEvent=a.selectedShapeEvent:a.deSelectShape())}})},onMouseEnterOnDefaultShapes:function(a){if(!$.support.touch){var b=a.target.shapeUniqueCode+1;if(8===b?b=6:6===b?b=7:7===b&&(b=8),a.target.isSelected)this.changeAccMessage("left-panel-canvas-acc-container",4,[b]);else{this.$(".work-canvas").css({cursor:"pointer"});var c=this.getDefaultShapeColor("hover");a.target.fillColor=c,this.changeAccMessage("left-panel-canvas-acc-container",2,[b])}}},onMouseDownOnDefaultShapes:function(a){if(this.stopReading(),this.activateWorkCanvasScope(),this.selectedShapeEvent&&this.deSelectShape(),!a.target.isSelected){var b=this.getDefaultShapeColor("selected");a.target.fillColor=b,a.target.isSelected=!0,this.selectedShapeEvent=a,this.currentEvent=null,this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.DONE,!1);var c=a.target.shapeUniqueCode+1;8===c?c=6:6===c?c=7:7===c&&(c=8),this.selectedShapeCode=c,this.changeAccMessage("left-panel-canvas-acc-container",3,[c])}},onMouseLeaveOnDefaultShapes:function(a){if(this.$(".work-canvas").css({cursor:"default"}),!a.target.isSelected&&!$.support.touch){var b=this.getDefaultShapeColor("normal");a.target.fillColor=b}},deSelectShape:function(){if(this.selectedShapeEvent){var a=this.selectedShapeEvent.target.isOriginal===!1,b=a?this.getCopiedShapeColor("normal"):this.getDefaultShapeColor("normal");this.selectedShapeEvent.target.fillColor=b,this.selectedShapeEvent.target.isSelected=!1,this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.DONE,!0)}this.selectedShapeEvent=null,this.currentEvent=null},bindSelectedShapeEvent:function(){var a=this,b=!1,c=!1;
this.handleGroup.on({mousedown:function(c){a.stopReading(),a.player.getModalPresent()||($.support.touch?0:1!==c.event.which)||($.support.touch&&a.onMouseEnterOnHandle(c),a.onMouseDownOnHandle(c),b=!1)},mousedrag:function(b){a.player.getModalPresent()||($.support.touch?0:1!==b.event.which)||(a.onMouseDragOnHandle(b),c=!0)},mouseenter:function(c){a.player.getModalPresent()||$.support.touch||(a.onMouseEnterOnHandle(c),a.$(".work-canvas").css({cursor:'url("'+a.filePath.getImagePath("open-hand")+'"), move'}),b=!1)},mouseleave:function(d){a.player.getModalPresent()||$.support.touch||(a.onMouseLeaveOnHandle(d),c||a.$(".work-canvas").css({cursor:"default"}),b=!0)},mouseup:function(b){!a.player.getModalPresent()}}),this.paperTool.on({mouseup:function(d){a.player.getModalPresent()||(b&&a.currentEvent?a.$(".work-canvas").css({cursor:"default"}):!b&&a.currentEvent&&a.$(".work-canvas").css({cursor:'url("'+a.filePath.getImagePath("open-hand")+'"), move'}),a.onMouseUpOnHandle(d),b=!1,c=!1)}})},onMouseEnterOnHandle:function(a){var b="hover",c="vertex";a.target.style=this.getCircleStyle(a.target.position,b,c),this.changeAccMessage("left-panel-canvas-acc-container",6,[a.target.handleNumber])},onMouseDownOnHandle:function(a){this.stopReading(),this.activateWorkCanvasScope(),this.currentEvent=a,this.$(".work-canvas").css({cursor:'url("'+this.filePath.getImagePath("closed-hand")+'"), move'});var b=this.model.getDataOfShape(this.selectedShape.shapeUniqueCode)[a.target.handleCode],c={};c.handleCode=a.target.handleCode,c.segmentNumber=this.getSegmentOfShape(a.target.position),this.dependendSegment.push(c);for(var d=0;d<this.handleGroup.children.length;d++){var e=this.handleGroup.children[d].handleCode;if(-1!==b.horizontal.indexOf(e)){this.currentX.push(this.handleGroup.children[d]);var c={};c.handleCode=e,c.segmentNumber=this.getSegmentOfShape(this.handleGroup.children[d].position),this.dependendSegment.push(c)}else if(-1!==b.vertical.indexOf(e)){this.currentY.push(this.handleGroup.children[d]);var c={};c.handleCode=e,c.segmentNumber=this.getSegmentOfShape(this.handleGroup.children[d].position),this.dependendSegment.push(c)}}this.mouseDownPoint=a.point},onMouseDragOnHandle:function(a){this.activateWorkCanvasScope(),a.preventDefault();var b=a.point,c=b.x-this.mouseDownPoint.x,d=b.y-this.mouseDownPoint.y,e=this.model.getRestrictedPoints(this.selectedShape.shapeUniqueCode);this.mouseDownPoint.x=this.moveHorizontal(a,c,e),this.mouseDownPoint.y=this.moveVertical(a,d,e),this.changeSegmentPosition(),this.$(".work-canvas").css({cursor:'url("'+this.filePath.getImagePath("closed-hand")+'"), move'}),this.workCanvasScope.view.draw()},changeSegmentPosition:function(){if(7===this.selectedShape.shapeUniqueCode)for(var a=this.selectedShape.children[0].segments.length,b=0;b<this.dependendSegment.length;b++)if(this.dependendSegment[b].segmentNumber<a)this.selectedShape.children[0].segments[this.dependendSegment[b].segmentNumber].point=this.getPositionOfHandle(this.dependendSegment[b].handleCode),0===this.dependendSegment[b].segmentNumber&&(this.selectedShape.children[0].segments[a-1].point=this.getPositionOfHandle(this.dependendSegment[b].handleCode));else{var c=this.dependendSegment[b].segmentNumber-a;this.selectedShape.children[1].segments[c].point=this.getPositionOfHandle(this.dependendSegment[b].handleCode),0===c&&(this.selectedShape.children[1].segments[this.selectedShape.children[1].segments.length-1].point=this.getPositionOfHandle(this.dependendSegment[b].handleCode))}else for(var b=0;b<this.dependendSegment.length;b++)this.selectedShape.segments[this.dependendSegment[b].segmentNumber].point=this.getPositionOfHandle(this.dependendSegment[b].handleCode),0===this.dependendSegment[b].segmentNumber&&(this.selectedShape.segments[this.selectedShape.segments.length-1].point=this.getPositionOfHandle(this.dependendSegment[b].handleCode))},moveHorizontal:function(a,b,c){var d=!0,e=a.target.handleCode;if(d=this.checkHorizontal(e,c,a.target.position.x+b,e),!d)return this.changeAccMessage("left-panel-canvas-acc-container",8,[a.target.handleNumber]),this.mouseDownPoint.x;for(var f=0;f<this.currentX.length;f++)if(d=this.checkHorizontal(this.currentX[f].handleCode,c,this.currentX[f].position.x+b,e),!d)return this.changeAccMessage("left-panel-canvas-acc-container",8,[a.target.handleNumber]),this.mouseDownPoint.x;a.target.position.x+=b;for(var f=0;f<this.currentX.length;f++)this.currentX[f].position.x+=b;return a.point.x},checkHorizontal:function(a,b,c,d){for(var e=b[a].restrictX,f=!0,g=!1,h=0;h<this.currentX.length;h++)for(var i=0;i<e[0].length;i++)if(e[0][i]===this.currentX[h].handleCode){g=!0;break}if(e[0].length>0)for(var i=0;i<e[0].length;i++)e[0][i]===d||g||c<this.getPositionOfHandle(e[0][i]).x+this.modelNamespace.GAP_BETWEEN_POINTS&&(f=!1);else c<this.modelNamespace.MIN_X_FOR_RESIZE&&(f=!1);g=!1;for(var h=0;h<this.currentX.length;h++)for(var i=0;i<e[1].length;i++)if(e[1][i]===this.currentX[h].handleCode){g=!0;break}if(e[1].length>0)for(var i=0;i<e[1].length;i++)e[1][i]===d||g||c>this.getPositionOfHandle(e[1][i]).x-this.modelNamespace.GAP_BETWEEN_POINTS&&(f=!1);else c>this.modelNamespace.MAX_X_FOR_RESIZE&&(f=!1);return f},moveVertical:function(a,b,c){var d=!0,e=a.target.handleCode;if(d=this.checkVertical(e,c,a.target.position.y+b,e),!d)return this.changeAccMessage("left-panel-canvas-acc-container",8,[a.target.handleNumber]),this.mouseDownPoint.y;for(var f=0;f<this.currentY.length;f++)if(d=this.checkVertical(this.currentY[f].handleCode,c,this.currentY[f].position.y+b,e),!d)return this.changeAccMessage("left-panel-canvas-acc-container",8,[a.target.handleNumber]),this.mouseDownPoint.y;a.target.position.y+=b;for(var f=0;f<this.currentY.length;f++)this.currentY[f].position.y+=b;return a.point.y},checkVertical:function(a,b,c,d){for(var e=b[a].restrictY,f=!0,g=!1,h=0;h<this.currentY.length;h++)for(var i=0;i<e[0].length;i++)if(e[0][i]===this.currentY[h].handleCode){g=!0;break}if(e[0].length>0)for(var i=0;i<e[0].length;i++)e[0][i]===d||g||c<this.getPositionOfHandle(e[0][i]).y+this.modelNamespace.GAP_BETWEEN_POINTS&&(f=!1);else c<this.modelNamespace.MIN_Y_FOR_RESIZE&&(f=!1);g=!1;for(var h=0;h<this.currentY.length;h++)for(var i=0;i<e[1].length;i++)e[1][i]===this.currentY[h].handleCode&&(g=!0);if(e[1].length>0)for(var i=0;i<e[1].length;i++)e[1][i]===d||g||c>this.getPositionOfHandle(e[1][i]).y-this.modelNamespace.GAP_BETWEEN_POINTS&&(f=!1);else c>this.modelNamespace.MAX_Y_FOR_RESIZE&&(f=!1);return f},getPositionOfHandle:function(a){for(var b=0;b<this.handleGroup.children.length;b++)if(this.handleGroup.children[b].handleCode===a)return this.handleGroup.children[b].position},getSegmentOfShape:function(a){if(7===this.selectedShape.shapeUniqueCode)for(var b=0;b<this.selectedShape.children.length;b++)for(var c=0;c<this.selectedShape.children[b].segments.length;c++){var d=this.selectedShape.children[b].segments[c].point;if(d.x===a.x&&d.y===a.y)return 0===b?c:this.selectedShape.children[0].segments.length+c}else for(var b=0;b<this.selectedShape.segments.length;b++){var d=this.selectedShape.segments[b].point;if(d.x===a.x&&d.y===a.y)return b}},onMouseLeaveOnHandle:function(a){var b="normal",c="vertex";a.target.style=this.getCircleStyle(a.target.position,b,c)},onMouseUpOnHandle:function(a){if(this.activateWorkCanvasScope(),this.currentEvent){var b=this.modelNamespace.getNearestPoint(this.currentEvent.target.position,this.gridPoints);this.currentEvent.target.position=this.gridPoints[b.index];for(var c=0;c<this.currentX.length;c++)b=this.modelNamespace.getNearestPoint(this.currentX[c].position,this.gridPoints),this.currentX[c].position=this.gridPoints[b.index];for(var c=0;c<this.currentY.length;c++)b=this.modelNamespace.getNearestPoint(this.currentY[c].position,this.gridPoints),this.currentY[c].position=this.gridPoints[b.index];this.changeSegmentPosition(),this.currentX=[],this.currentY=[],this.dependendSegment=[],$.support.touch&&this.onMouseLeaveOnHandle(this.currentEvent),this.currentEvent=null}this.workCanvasScope.view.draw()},bindEventsToNewShape:function(a){for(var b=this,c=0;c<a.length;c++)a[c].on("mousedown",function(a){b.onMouseDownOnNewShapes(a,null,this)}),a[c].on("mouseup",function(a){b.onMouseUpOnNewShapes(a,this)}),a[c].on("mousedrag",function(a){b.onMouseDragOnNewShapes(a,this)}),a[c].on("mouseenter",function(a){b.onMouseEnterOnNewShapes(a,this)}),a[c].on("mouseleave",function(a){b.onMouseLeaveOnNewShapes(a,this)})},_cancelMouseUpLabelRemoval:!1,onMouseUpOnNewShapes:function(a,b){if(!this.player.getModalPresent()){if($.support.touch){this._tapNHoldTimer&&window.clearTimeout(this._tapNHoldTimer);var c=b.shapeUniqueCode+"|"+b.isOriginal,d=this.shapesTooltipViews[c];d&&d.hideTooltip()}this._cancelMouseUpLabelRemoval!==!0&&this._removeAllShapeLabels(!1),this._cancelMouseUpLabelRemoval=!1}},onMouseEnterOnNewShapes:function(a,b){if(!this.player.getModalPresent()&&!$.support.touch){var c=b.shapeUniqueCode+"|"+b.isOriginal,d=this.shapesTooltipViews[c];if(d&&(d.setElGeometry(this.cloneHandle),d.showTooltip()),b.isSelected)this.$(".work-canvas").css({cursor:'url("'+this.filePath.getImagePath("open-hand")+'"), move'});else{this.$(".work-canvas").css({cursor:"pointer"});var e=b.isOriginal===!1,f=e?this.getCopiedShapeColor("hover"):this.getDefaultShapeColor("hover");b.fillColor=f,this.workCanvasScope.view.draw()}}},onMouseDownOnNewShapes:function(a,b,c){if(!this.player.getModalPresent()){this.stopReading();var d,e,f,g,h=this.modelNamespace.ACTION_ENUM,i=this.modelNamespace.EVENTS,j=this,k=!0;if(this.activateWorkCanvasScope(),a.target=c,c.bringToFront(),"callFromButtonClick"!==b&&"callFromCopyClick"!==b&&"callFromUndoClick"!==b&&(a.preventDefault(),this.$(".work-canvas").css({cursor:'url("'+this.filePath.getImagePath("closed-hand")+'"), move'})),this.mouseDownPoint=a.point,this.selectedShapeEvent&&this.deSelectNewShape("mouseDown"),$.support.touch&&"callFromButtonClick"!==b&&"callFromCopyClick"!==b&&"callFromUndoClick"!==b){var l=c.shapeUniqueCode+"|"+c.isOriginal,m=this.shapesTooltipViews[l];g=function(){a.preventDefault(),j._cancelMouseUpLabelRemoval=!0,m&&(m.setElGeometry(j.cloneHandle),m.showTooltip())},this._tapNHoldTimer=window.setTimeout(function(){g()},800)}if(this.isCurrentShapeIntersecting=!1,this.dottedCutLine){var n=c.getIntersections(this.dottedCutLine);n.length>0&&(this.isCurrentShapeIntersecting=!0)}if(!c.isSelected){c.bringToFront(),e=c.shapeUniqueCode,this._shapeLabels&&this._shapeLabels[e]&&(d=c.isOriginal?0:1,f=this._shapeLabels[e][d],f&&f.bringToFront());var o=c.isOriginal===!1,p=o?this.getCopiedShapeColor("selected"):this.getDefaultShapeColor("selected");c.fillColor=p,c.isSelected=!0,c.isOddShape&&c.children&&(c.children[0].isSelected=!0,c.children[1].isSelected=!0),this.selectedShapeEvent=a,this.selectedShape=c,this.currentEvent=null,k=c.isOriginal?this.checkForCopyPresent(c.shapeUniqueCode):!0,this.model.trigger(i.DISABLE_BUTTON,h.COPY,k),this.model.trigger(i.DISABLE_BUTTON,h.REFLECT,!1),this.model.trigger(i.DISABLE_BUTTON,h.ROTATE,!1),this.workCanvasScope.view.draw()}}},checkForCopyPresent:function(a){var b,c=this.model.get("undoStack");if(c.length>0){b=c[c.length-1];for(var d=0;d<b.length;d++)if(b[d].shapeUniqueCode===a&&!b[d].isOriginal)return!0}return!1},onMouseDragOnNewShapes:function(a,b){if(!this.player.getModalPresent()){this.activateWorkCanvasScope();var c=!1;if($.support.touch||1!==a.event.which&&(c=!0),a.preventDefault(),!c){if(this.$(".work-canvas").css({cursor:'url("'+this.filePath.getImagePath("closed-hand")+'"), move'}),$.support.touch&&this._tapNHoldTimer&&window.clearTimeout(this._tapNHoldTimer),this.isRemoveLabelRequired&&(this.isRemoveLabelRequired=!1,this._removeAllShapeLabels(!1)),b.isOddShape){if(!b.children)return;if(b.children.length<=0)return}var d=a.point.x-this.mouseDownPoint.x,e=a.point.y-this.mouseDownPoint.y;b.position.x+=d,b.position.y+=e,this.mouseDownPoint=this.checkForBoundaryOfShape(a,d,e,b),this.isShapeDragged=!0,this.isCurrentShapeIntersecting&&this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT_LINE,!0)}}},checkForBoundaryOfShape:function(a,b,c,d){var e=d.clone(),f=e.bounds.getTopLeft(),g=e.bounds.getBottomRight();return f.x<this.modelNamespace.BOUNDING_BOX_LEFT?(d.position.x-=b,a.point.x=this.mouseDownPoint.x,this.changeAccMessage("left-panel-canvas-acc-container",20)):g.x>this.modelNamespace.BOUNDING_BOX_RIGHT&&(d.position.x-=b,a.point.x=this.mouseDownPoint.x,this.changeAccMessage("left-panel-canvas-acc-container",20)),f.y<this.modelNamespace.BOUNDING_BOX_TOP?(d.position.y-=c,a.point.y=this.mouseDownPoint.y,this.changeAccMessage("left-panel-canvas-acc-container",20)):g.y>this.modelNamespace.BOUNDING_BOX_BOTTOM&&(d.position.y-=c,a.point.y=this.mouseDownPoint.y,this.changeAccMessage("left-panel-canvas-acc-container",20)),e.remove(),a.point},onMouseLeaveOnNewShapes:function(a,b){if(!this.player.getModalPresent()&&(this.$(".work-canvas").css({cursor:"default"}),!$.support.touch)){var c=b.shapeUniqueCode+"|"+b.isOriginal,d=this.shapesTooltipViews[c];if(d&&d.hideTooltip(),!b.isSelected){var e=b.isOriginal===!1,f=e?this.getCopiedShapeColor("normal"):this.getDefaultShapeColor("normal");b.fillColor=f}this.workCanvasScope.view.draw()}},deSelectNewShape:function(a){if(!this.player.getModalPresent()){if($.support.touch){var b=null;if(this.currentEvent?b=this.currentEvent:this.selectedShapeEvent&&(b=this.selectedShapeEvent),b){var c=b.target.shapeUniqueCode+"|"+b.target.isOriginal,d=this.shapesTooltipViews[c];d&&d.hideTooltip()}}var e=this.modelNamespace.ACTION_ENUM,f=this.modelNamespace.EVENTS;if(this.isShapeDragged){this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.UNDO,!1),this.changePosition(),this.selectedShape.defaultCenter=this.selectedShape.position,this.selectedShape.currentRotationCount=0;var g=this.model.addEntryToUndoStack(this.canvasShapes);g&&this.addLatticePointsOfSidesOfPolygon(),this.dottedCutLine&&this.checkForIntersection(),this.isShapeDragged=!1}if(null===this.currentEvent&&this.selectedShapeEvent)this.currentEvent=this.selectedShapeEvent,this.$(".work-canvas").css({cursor:'url("'+this.filePath.getImagePath("open-hand")+'"), move'});else{if(this.cutLineHandleGroup&&"mouseDown"!==a&&"cutLine"!==a)return;if(this.selectedShapeEvent){var h=this.selectedShapeEvent.target.isOriginal===!1,i=h?this.getCopiedShapeColor("normal"):this.getDefaultShapeColor("normal");this.selectedShapeEvent.target.fillColor=i,this.selectedShapeEvent.target.isSelected=!1,this.selectedShapeEvent.target.isOddShape&&this.selectedShapeEvent.target.children&&(this.selectedShapeEvent.target.children[0].isSelected=!1,this.selectedShapeEvent.target.children[1].isSelected=!1),this.selectedShape=null,this.model.trigger(f.DISABLE_BUTTON,e.COPY,!0),this.model.trigger(f.DISABLE_BUTTON,e.REFLECT,!0),this.model.trigger(f.DISABLE_BUTTON,e.ROTATE,!0)}this.selectedShapeEvent=null,this.currentEvent=null}this.bringCutLineToFront(),this.workCanvasScope.view.draw()}},bindCutLineHandleEvent:function(){var a,b=this,c=!1,d=!1,e=null;this.cutLineHandleGroup.on({mousedown:function(d){b.stopReading(),b.player.getModalPresent()||($.support.touch?0:1!==d.event.which)||($.support.touch&&b.onMouseEnterOnCutLineHandle(d),b.onMouseDownOnCutLineHandle(d),a=d,e=d.point,b.$(".work-canvas").css({cursor:'url("'+b.filePath.getImagePath("closed-hand")+'"), move'}),c=!1)},mousedrag:function(c){b.player.getModalPresent()||(b.onMouseDragOnCutLineHandle(c,e),e=c.target.position,a=c,d=!0)},mouseenter:function(a){b.player.getModalPresent()||$.support.touch||(b.onMouseEnterOnCutLineHandle(a),b.$(".work-canvas").css({cursor:'url("'+b.filePath.getImagePath("open-hand")+'"), move'}),c=!1)},mouseleave:function(a){b.player.getModalPresent()||$.support.touch||(b.onMouseLeaveOnCutLineHandle(a),b.$(".work-canvas").css({cursor:"default"}),c=!0)},mouseup:function(a){b.player.getModalPresent()||b.$(".work-canvas").css({cursor:'url("'+b.filePath.getImagePath("open-hand")+'"), move'})}}),this.paperTool.on({mouseup:function(e){b.player.getModalPresent()||a&&(d&&b.onMouseUpOnCutLineHandle(a),$.support.touch&&b.onMouseLeaveOnCutLineHandle(a),c=!1,d=!1,a=null)}})},onMouseEnterOnCutLineHandle:function(a){var b="hover",c="cutHandle";a.target.style=this.getCircleStyle(a.target.position,b,c)},onMouseDownOnCutLineHandle:function(a){this.stopReading(),this.activateWorkCanvasScope(),this.repositionLine(a),this.repositionButton()},onMouseDragOnCutLineHandle:function(a,b){this.activateWorkCanvasScope(),a.preventDefault(),this.$(".work-canvas").css({cursor:'url("'+this.filePath.getImagePath("closed-hand")+'"), move'}),this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT_LINE,!0);var c,d=a.target.position.x,e=a.target.position.y,f=a.point.x-b.x,g=a.point.y-b.y;a.target.position.x+=f,c=this.cutLineHandleGroup.children[0].intersect(this.cutLineHandleGroup.children[1]),(a.target.position.x<this.modelNamespace.BOUNDING_BOX_LEFT||a.target.position.x>this.modelNamespace.BOUNDING_BOX_RIGHT||0!==c.area)&&(a.target.position.x=d),c.remove(),a.target.position.y+=g,c=this.cutLineHandleGroup.children[0].intersect(this.cutLineHandleGroup.children[1]),(a.target.position.y<this.modelNamespace.BOUNDING_BOX_TOP||a.target.position.y>this.modelNamespace.BOUNDING_BOX_BOTTOM||0!==c.area)&&(a.target.position.y=e),c.remove(),this.repositionLine(a),this.repositionButton()},repositionButton:function(){var a,b=this.dottedCutLine.length/2,c=this.dottedCutLine.getPointAt(b),d=this.dottedCutLine.getNormalAt(b),e=30,f=!1,g=!1;d.length=e,a=c.add(d),this.dummyRectangleOfCutButton.position=a,this.dummyRectangleOfCutButton.bringToFront(),a.y-19<this.modelNamespace.BOUNDING_BOX_TOP&&(e*=-1,d.length=e,a=c.add(d),f=!0),a.x+22>this.modelNamespace.BOUNDING_BOX_RIGHT?(f===!0?e*=1:(e*=-1,g=!0),d.length=e,a=c.add(d)):a.x-22<this.modelNamespace.BOUNDING_BOX_LEFT&&(f===!0?e*=1:(e*=-1,g=!0),d.length=e,a=c.add(d)),a.y+19>this.modelNamespace.BOUNDING_BOX_BOTTOM+24&&(e*=g?1:-1,d.length=e,a=c.add(d)),this.dummyRectangleOfCutButton.position=a,a.x-=22,a.y-=19,this.dummyRectangleOfCutButton.bringToFront(),this.$(this.$(".cut-line-button")[0]).css({top:a.y+"px",left:a.x+"px"})},onMouseLeaveOnCutLineHandle:function(a){var b="normal",c="cutHandle";a.target.style=this.getCircleStyle(a.target.position,b,c)},onMouseUpOnCutLineHandle:function(a){if(a){var b=this.modelNamespace.getNearestPoint(a.target.position,this.gridPoints);a.target.position=this.gridPoints[b.index],this.repositionLine(a),this.repositionButton(),this.checkForIntersection(),this.bringCutLineToFront(),a.data&&(-1===a.data.directionData.directionX&&13===a.target.position.x&&this.changeAccMessage("left-panel-canvas-acc-container",25),1===a.data.directionData.directionX&&589===a.target.position.x&&this.changeAccMessage("left-panel-canvas-acc-container",25),-1===a.data.directionData.directionY&&13===a.target.position.y&&this.changeAccMessage("left-panel-canvas-acc-container",25),1===a.data.directionData.directionY&&469===a.target.position.y&&this.changeAccMessage("left-panel-canvas-acc-container",25))}},bringCutLineToFront:function(){this.dottedCutLine&&(this.dottedCutLine.bringToFront(),this.cutLineHandleGroup.bringToFront())},repositionLine:function(a){"a"===a.target.handleCode?this.dottedCutLine.segments[0].point=a.target.position:"b"===a.target.handleCode&&(this.dottedCutLine.segments[1].point=a.target.position)},validCutShapeIndex:null,checkForIntersection:function(){var a,b,c=this.cutLineHandleGroup.children[0].position,d=this.cutLineHandleGroup.children[1].position,e=this.model.getIndexOfPoint(c),f=this.model.getIndexOfPoint(d);this.validCutPointsObjects=[],this.validCutshapes=[],this.validCutShapeIndex=[];for(var g=0;g<this.canvasShapes.length;g++)if(a=[],this.canvasShapes[g].isOriginal){this.validCutshapes.push(this.canvasShapes[g]);var h=this.canvasShapes[g].getIntersections(this.dottedCutLine);if(this.checkForHandleOutsideCurrenShape(c,d,e,f,this.canvasShapes[g].shapeUniqueCode)){if(h.length>0&&this.validCutShapeIndex.push(g),h.length>1){for(var i=0;i<h.length;i++){b=h[i].point;var j=this.model.getIndexOfPoint(b);-1!==j&&a.push(j)}if(a.sort(function(a,b){return a-b}),a.length>1)if(this.canvasShapes[g].isOddShape){var k=this.checkForInInvalidPointsForOddShape(a,this.canvasShapes[g].shapeUniqueCode,h.length,this.canvasShapes[g]);k.length>0&&this.validCutPointsObjects.push(k)}else{var k=this.checkForInInvalidPointsForNormalShape(a,this.canvasShapes[g].shapeUniqueCode,this.canvasShapes[g]);k.length>0&&this.validCutPointsObjects.push(k)}}}else h.length>0&&this.validCutShapeIndex.push(g)}var l=this.getAccMessage("left-panel-canvas-acc-container","disabledText");0===this.validCutPointsObjects.length?(this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT_LINE,!0),this.enableTab("cut-line-button",!1)):(this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT_LINE,!1),l=this.getAccMessage("left-panel-canvas-acc-container","enabledText"),this.enableTab("cut-line-button",!0)),this.changeAccMessage("left-panel-canvas-acc-container",14,[l])},checkForHandleOutsideCurrenShape:function(a,b,c,d,e){var f=this.model.getBoundaryPointOfShape(e),g=!1,h=!1;if(-1!==f.indexOf(c)&&(g=!0),-1!==f.indexOf(d)&&(h=!0),!g){var i=this.checkForPointInsideCurrentShape(a,f);i||(g=!0)}if(!h){var i=this.checkForPointInsideCurrentShape(b,f);i||(h=!0)}return g&&h?!0:!1},checkForInInvalidPointsForOddShape:function(a,b,c,d){var e=[],f=3,g=this.model.getBoundaryPointOfShapeObject(b),h=g.boundaryPointArray;if(this.modelNamespace.removeSameNumbersFromArray(a),3===a.length&&4!==c&&a.splice(1,0,a[1]),4===a.length){var i=new this.workCanvasScope.Point((this.gridPoints[a[0]].x+this.gridPoints[a[1]].x)/2,(this.gridPoints[a[0]].y+this.gridPoints[a[1]].y)/2);if(!d.contains(i))return e;var i=new this.workCanvasScope.Point((this.gridPoints[a[2]].x+this.gridPoints[a[3]].x)/2,(this.gridPoints[a[2]].y+this.gridPoints[a[3]].y)/2);if(!d.contains(i))return e;for(var j=0;2>j;j++){var k={};0==j?(k.start=a[j],k.end=a[j+f]):(k.start=a[j],k.end=a[j+f]),k.shapeUniqueCode=b,k.isOddShape=!0,k.isRemovingOddShape=!0,e.push(k),f-=2}}else if(-1!==h.indexOf(a[0])&&-1!==h.indexOf(a[1])){if(4===c)return e;if(2===c){var i=new this.workCanvasScope.Point((this.gridPoints[a[0]].x+this.gridPoints[a[1]].x)/2,(this.gridPoints[a[0]].y+this.gridPoints[a[1]].y)/2);if(!this.modelNamespace.isPointOnPath(i,d)){var k={};k.start=a[0],k.end=a[a.length-1],k.shapeUniqueCode=b,k.isOddShape=!0,k.isRemovingOddShape=!1,e.push(k)}}}return e},checkForInInvalidPointsForNormalShape:function(a,b,c){for(var d=this.model.getBoundaryPointOfShape(b),e=[],f=0;f<a.length-1;f++){var g=d.indexOf(a[f]),h=d.indexOf(a[f+1]);if(g>h){var i=g;g=h,h=i}if(g!==h&&g+1!==h){if(0===g){if(d.length-1===h)continue}else if(g>0&&g-1===h)continue;var j=a[f],k=a[f+1];if(this.checkAllPointsOnCutLine(j,k,c,d)){var l={};l.start=a[f],l.end=a[f+1],l.shapeUniqueCode=b,l.isOddShape=!1,e.push(l)}}}return e},checkAllPointsOnCutLine:function(a,b,c,d){var e=new this.workCanvasScope.Path,f=[];if(e.add(this.gridPoints[a]),e.add(this.gridPoints[b]),f=e.getIntersections(c),e.remove(),f.length>0)for(var g=0;g<f.length-1;g++){var h=new this.workCanvasScope.Point((f[g].point.x+f[g+1].point.x)/2,(f[g].point.y+f[g+1].point.y)/2);if(this.modelNamespace.isPointOnPath(h,c))return!1;if(!this.modelNamespace.isPointInsideShape(c,h,!0))return!1}else{var h=new this.workCanvasScope.Point((this.gridPoints[a].x+this.gridPoints[b].x)/2,(this.gridPoints[a].y+this.gridPoints[b].y)/2);if(this.modelNamespace.isPointOnPath(h,c))return!1;if(!this.modelNamespace.isPointInsideShape(c,h,!0))return!1}return!0},checkForPointInsideCurrentShape:function(a,b){for(var c=!1,d=-1,e=b.length,f=e-1;++d<e;f=d)(this.gridPoints[b[d]].y<=a.y&&a.y<this.gridPoints[b[f]].y||this.gridPoints[b[f]].y<=a.y&&a.y<this.gridPoints[b[d]].y)&&a.x<(this.gridPoints[b[f]].x-this.gridPoints[b[d]].x)*(a.y-this.gridPoints[b[d]].y)/(this.gridPoints[b[f]].y-this.gridPoints[b[d]].y)+this.gridPoints[b[d]].x&&(c=!c);return c},checkForPointInsideCurrentShapeUsingSegments:function(a,b){for(var c=!1,d=-1,e=b.length,f=e-1;++d<e;f=d)(b[d].point.y<=a.y&&a.y<b[f].point.y||b[f].point.y<=a.y&&a.y<b[d].point.y)&&a.x<(b[f].point.x-b[d].point.x)*(a.y-b[d].point.y)/(b[f].point.y-b[d].point.y)+b[d].point.x&&(c=!c);return c},unbindPaperEvents:function(a){a.off("mousedown"),a.off("mouseup"),a.off("mousedrag"),a.off("mouseenter"),a.off("mouseleave")}})}(),function(){"use strict";MathInteractives.Common.Interactivities.ShapeDecomposition.Views.ButtonClicks=MathInteractives.Common.Interactivities.ShapeDecomposition.Views.PaperEventFunctions.extend({initialize:function(){this._superwrapper("initialize",[])},onDoneButtonClick:function(){this.stopReading(),this.activateWorkCanvasScope();var a=this.modelNamespace.ACTION_ENUM,b=this.modelNamespace.EVENTS;2===this.model.get("type")&&(this.selectedShapeEvent.target.fillColor=this.getDefaultShapeColor("normal"),this.selectedShapeEvent.target.isSelected=!1),this.shapeGroup.visible=!1,this.screenGroup.visible=!0,this.drawShape(this.selectedShapeEvent),this.unbindPaperEvents(this.paperTool),this.unbindPaperEvents(this.shapeGroup),this.handleGroup.bringToFront(),this.bindSelectedShapeEvent(),this.currentEvent=null,this.selectedShapeEvent=null,this.unitLabelGroup.visible=!0,this.unitLabelGroup.bringToFront(),this.model.trigger(b.CHANGE_DIRECTION_TEXT,1),this.model.trigger(b.HIDE_BUTTON,a.NEXT,!1),this.model.trigger(b.HIDE_BUTTON,a.DONE,!0),1===this.model.get("type")&&this._initAccessibilityForSelectShape(),2===this.model.get("type")&&this.unBindAccessibilityListeners(),this.bindAccessibilityListenersForShapeResize(),this.player.changeHelpElementText("left-panel-canvas-acc-container",0,this.getMessage("canvas-help-texts",1),this.getAccMessage("canvas-help-texts",1)),this.setFocus("explore-instruction-bar-1-direction-text-text"),this.changeAccMessage("explore-tab-activity-holder",1),this.changeAccMessage("left-panel-canvas-acc-container",5,[this.handleGroup.children.length]),this.workCanvasScope.view.draw()},onNextButtonClick:function(){this.stopReading(),this.activateWorkCanvasScope();var a={},b=this.modelNamespace.ACTION_ENUM,c=this.modelNamespace.EVENTS;7===this.selectedShape.shapeUniqueCode?(this.selectedShape.isOddShape=!0,this.selectedShape.children[0].isOddShape=!0,this.selectedShape.children[1].isOddShape=!0):this.selectedShape.isOddShape=!1,this.$(".left-panel-buttons-container").show(),this.addPropertiesToShape(this.selectedShape,!0),this.selectedShape.shapeUniqueCode=this.uniqueNumber,this.uniqueNumber++,this.screenGroup.visible=!1,this.unbindPaperEvents(this.paperTool),this.unbindPaperEvents(this.handleGroup),this.handleGroup.remove(),this.handleGroup=null,a.target=this.selectedShape,a.target.isSelected=!1,this.onMouseDownOnNewShapes(a,"callFromButtonClick",this.selectedShape),this.currentEvent=a,this.canvasShapes.push(this.selectedShape),this.bindEventsToNewShape(this.canvasShapes),this.addAccNumber(),this.paperTool.on("mouseup",$.proxy(this.deSelectNewShape,this));var d=this.model.addEntryToUndoStack(this.canvasShapes);d&&this.addLatticePointsOfSidesOfPolygon(),this.model.trigger(c.CHANGE_DIRECTION_TEXT,2),this.model.trigger(c.DISABLE_BUTTON,b.COPY,!1),this.model.trigger(c.DISABLE_BUTTON,b.REFLECT,!1),this.model.trigger(c.DISABLE_BUTTON,b.ROTATE,!1),this.model.trigger(c.DISABLE_BUTTON,b.UNDO,!0),this.model.trigger(c.DISABLE_BUTTON,b.CHECK,!0),this.model.trigger(c.TABLE_DATA_EVENT,b.NEXT,{paperItem:this.selectedShape}),this.unBindAccessibilityListeners(),this.changeAccMessage("explore-tab-activity-holder",2);var e=this.getAccMessage("left-panel-canvas-acc-container","shapeText"),f=this.getAccMessage("left-panel-canvas-acc-container","isText");this.changeAccMessage("left-panel-canvas-acc-container",9,[e,f]),this.setFocus("explore-instruction-bar-2-direction-text-text"),this.player.enableHelpElement("actual-shape-table-wrapper",3,!0),this.player.changeHelpElementText("left-panel-canvas-acc-container",0,this.getMessage("canvas-help-texts",2),this.getAccMessage("canvas-help-texts",2)),this.bindAccessibilityListenersForShapeMovement()},addLatticePointsOfSidesOfPolygon:function(){for(var a=[],b=0;b<this.canvasShapes.length;b++){var c,d,e={},f=[],g=[];if(this.canvasShapes[b].isOddShape){for(var h=this.canvasShapes[b].clone(),i=0;i<h.children.length;i++)for(var j=0;j<h.children[i].segments.length;j++)0===i?f.push(this.model.getIndexOfPoint(h.children[i].segments[j].point)):g.push(this.model.getIndexOfPoint(h.children[i].segments[j].point));c=this.getBoundaryPoints(f,h.children[0].segments),d=this.getBoundaryPoints(g,h.children[1].segments),e.shapeUniqueCode=this.canvasShapes[b].shapeUniqueCode,e.boundaryPointArray=c,e.boundaryPointArray2=d,h.remove()}else{for(var h=this.canvasShapes[b].clone(),i=0;i<h.segments.length;i++)f.push(this.model.getIndexOfPoint(h.segments[i].point));c=this.getBoundaryPoints(f,h.segments),e.shapeUniqueCode=this.canvasShapes[b].shapeUniqueCode,e.boundaryPointArray=c,h.remove()}a.push($.extend(!0,{},e))}var k=this.model.get("polygonBoundaryPointsUndoStack");k.push(a)},getBoundaryPoints:function(a,b){for(var c=!1,d=[],e=0;e<this.gridPoints.length;e++)if(c=a.indexOf(e),-1!==c&&d.push(this.gridPoints[e]),-1===c){var f;f=this.modelNamespace.checkForOnLinePoint(this.gridPoints[e].x,this.gridPoints[e].y,b),f.bool===!0&&d.push(this.gridPoints[e])}return d=this.sortSidePoints(b,d),d.pop(),d},sortSidePoints:function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m,n,o,p=!1,q=!1,r=null,s=!1,t=[],u=null,v=null,w=0;w<a.length;w++){c=a[w].point.x,d=a[w].point.y,w+1===a.length?(g=a[0].point.x,h=a[0].point.y):(g=a[w+1].point.x,h=a[w+1].point.y),t.push(a[w].point),m=t.length,u=null,v=null,r=null;for(var x=0;x<b.length;x++)if(e=b[x].x,f=b[x].y,k=e-c,l=f-d,i=l/k,j=(h-f)/(g-e),i===j&&(s=this.modelNamespace.checkForInBetween(c,e,g,d,f,h))){if(t.length>m)for(var y=m;y<t.length;y++)n=t[y].x-c,o=t[y].y-d,k>0?null!==u?n>u&&(p=!0):n>k&&(p=!0):0===k?null!==u?n===u&&(p=!0):0===n&&(p=!0):null!==u?u>n&&(p=!0):k>n&&(p=!0),l>0?null!==v?o>v&&(q=!0):o>l&&(q=!0):0===l?null!==v?o===v&&(q=!0):0===o&&(q=!0):null!==v?v>o&&(q=!0):l>o&&(q=!0),p===!0&&q===!0&&(u=n,v=o,r=y),p=!1,q=!1;s=!1,null!==r?t.splice(r,0,b[x]):t.push(b[x])}}b=[];for(var w=0;w<t.length;w++)b.push(this.model.getIndexOfPoint(t[w]));return b},onCheckButtonClick:function(){this.stopReading(),this.activateWorkCanvasScope();var a=this.modelNamespace,b=a.ACTION_ENUM,c=a.EVENTS;this.deSelectNewShape(),this.removeCutLine(),this.isRemoveLabelRequired=!0,this.model.trigger(c.DISABLE_BUTTON,b.CUT,!1),this.model.trigger(c.TABLE_DATA_EVENT,b.CHECK,{shapes:this.canvasShapes,paperScope:this.workCanvasScope})},copyButtonClick:function(){var a=this;this.stopReading(),this.activateWorkCanvasScope(),this._removeAllShapeLabels(!1);var b=this.selectedShape,c=this._createCopy(b),d=this.modelNamespace.ACTION_ENUM,e=this.modelNamespace.EVENTS,f={},g=this.model.get("undoStack");g.pop(),this.model.set("undoStack",g);var h=this.model.addEntryToUndoStack(this.canvasShapes);this._placeCopy(c,b),this.canvasShapes.push(c),this.bindEventsToNewShape([c]),this.deSelectShape(),f.target=c,this.onMouseDownOnNewShapes(f,"callFromCopyClick",c),this.currentEvent=f;var h=this.model.addEntryToUndoStack(this.canvasShapes);h&&this.addLatticePointsOfSidesOfPolygon(),this.model.trigger(e.DISABLE_BUTTON,d.UNDO,!1),this.addAccNumber(),this.model.trigger(e.TABLE_DATA_EVENT,d.COPY,{paperItem:c}),this.removeCutLine(),this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT,!1),this.workCanvasScope.view.draw(),this.bindAccessibilityListenersForShapeMovement(),this.changeAccMessage("left-panel-canvas-acc-container",17),this.setFocus("left-panel-canvas-acc-container"),this.$el.one("focusout",".left-panel-canvas-acc-container",function(b){a.accContainerFocusOut(b)})},_createCopy:function(a){var b=a.clone();return b.fillColor=this.getCopiedShapeColor("normal"),
b.strokeColor=this.modelNamespace.SHAPE_STROKE_COLORS.COPY,this.addPropertiesToShape(b,!1),b.shapeUniqueCode=a.shapeUniqueCode,a.isOddShape?(b.isOddShape=a.isOddShape,b.children[0].isOddShape=a.isOddShape,b.children[1].isOddShape=a.isOddShape):b.isOddShape=a.isOddShape,b.isSelected=!1,b},_placeCopy:function(a,b){var c=this.modelNamespace,d=c.GAP_BETWEEN_POINTS,e=b.bounds,f=e.bottomRight;f.x+d>c.BOUNDING_BOX_RIGHT&&f.y+d>c.BOUNDING_BOX_BOTTOM?a.translate(-d,-d):(f.x+d<=c.BOUNDING_BOX_RIGHT&&a.translate(d,0),f.y+d<=c.BOUNDING_BOX_BOTTOM&&a.translate(0,d)),a.defaultCenter=a.position},_checkIfIsOverlapping:function(a){var b,c,d,e=this.canvasShapes;for(d in e)if(c=e[d],b=a.intersect(c),b.area>0)return!0;return!1},undoButtonClick:function(a){var b=this;if(this.stopReading(),this.activateWorkCanvasScope(),this._removeAllShapeLabels(!0),this.cutLineHandleGroup)return this.removeCutLine(),this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT,!1),this.workCanvasScope.view.draw(),this.changeAccMessage("left-panel-canvas-acc-container",15),void this.setFocus("left-panel-canvas-acc-container");var c,d,e=this.model.get("undoStack"),f=this.modelNamespace,g=f.EVENTS,h=f.ACTION_ENUM,i=this.model.get("polygonBoundaryPointsUndoStack");i.pop(),d=e.pop(),this.deSelectNewShape(),1===e.length&&this.model.trigger(g.DISABLE_BUTTON,h.UNDO,!0),c=e[e.length-1],this.removeCurrentElements(),this._removeAllShapeLabels(!0),this.addNewElementsOnCanvas(c),this.bindEventsToNewShape(this.canvasShapes),this.addAccNumber(),this.model.trigger(g.TABLE_DATA_EVENT,h.UNDO,{newShapes:this.canvasShapes,undoneStep:d}),this.removeCutLine(),this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT,!1),this.workCanvasScope.view.draw(),this.bindAccessibilityListenersForShapeMovement(),this.changeAccMessage("left-panel-canvas-acc-container",16),this.setFocus("left-panel-canvas-acc-container"),this.$el.one("focusout",".left-panel-canvas-acc-container",function(a){b.accContainerFocusOut(a)})},removeCurrentElements:function(){for(var a=0;a<this.canvasShapes.length;a++)this.unbindPaperEvents(this.canvasShapes[a]),this.canvasShapes[a].remove();this.canvasShapes=[]},addNewElementsOnCanvas:function(a){for(var b,c,d,e,f=this.modelNamespace.SHAPE_STROKE_COLORS,g=f.NORMAL,h=f.COPY,i={},j=0;j<a.length;j++){if(e=a[j].shapePoints,a[j].isOriginal?(c=this.getDefaultShapeColor("normal"),d=g):(c=this.getCopiedShapeColor("normal"),d=h),a[j].isOddShape){for(var k=new this.workCanvasScope.Path,l=new this.workCanvasScope.Path,m=0;m<e[0].length;m++)k.add(this.gridPoints[e[0][m]]);for(var m=0;m<e[1].length;m++)l.add(this.gridPoints[e[1][m]]);b=this._createCompoundPath(k,l,c,d,2),b.isOddShape=!0,b.children[0].isOddShape=!0,b.children[1].isOddShape=!0}else{b=new this.workCanvasScope.Path;for(var m=0;m<e.length;m++)b.add(this.gridPoints[e[m]]);b.strokeColor=d,b.strokeWidth=2,b.fillColor=c,b.isOddShape=!1}this.addPropertiesToShape(b,a[j].isOriginal),b.shapeUniqueCode=a[j].shapeUniqueCode;var n=a[j].isSelected;n?(i.target=b,i.target.isSelected=!1,this.onMouseDownOnNewShapes(i,"callFromUndoClick",b),this.currentEvent=i):b.isSelected=!1,this.canvasShapes.push(b)}},rotateButtonClick:function(a){var b=this;this.stopReading(),this.activateWorkCanvasScope(),this._removeAllShapeLabels(!1);var c=this.modelNamespace,d=c.EVENTS,e=c.ACTION_ENUM,f=this.model.get("undoStack");f.pop(),this.model.set("undoStack",f);var g=this.model.addEntryToUndoStack(this.canvasShapes);this.selectedShape.rotate(90),3===this.selectedShape.currentRotationCount?(this.selectedShape.currentRotationCount=0,this.selectedShape.position=this.selectedShape.defaultCenter):this.selectedShape.currentRotationCount++,this.checkBoundsOfShape(),this.changePosition();var g=this.model.addEntryToUndoStack(this.canvasShapes);g&&this.addLatticePointsOfSidesOfPolygon(),this.model.trigger(d.DISABLE_BUTTON,e.UNDO,!1),this.model.trigger(d.TABLE_DATA_EVENT,e.ROTATE,{paperItem:this.selectedShape}),this.removeCutLine(),this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT,!1),this.workCanvasScope.view.draw(),this.changeAccMessage("left-panel-canvas-acc-container",19),this.setFocus("left-panel-canvas-acc-container"),this.$el.one("focusout",".left-panel-canvas-acc-container",function(a){b.accContainerFocusOut(a)})},checkBoundsOfShape:function(){var a=this.selectedShape.clone(),b=a.bounds.getTopLeft(),c=a.bounds.getBottomRight(),d=0,e=0;b.x<this.modelNamespace.BOUNDING_BOX_LEFT?d=this.modelNamespace.BOUNDING_BOX_LEFT-b.x:c.x>this.modelNamespace.BOUNDING_BOX_RIGHT&&(d=this.modelNamespace.BOUNDING_BOX_RIGHT-c.x),b.y<this.modelNamespace.BOUNDING_BOX_TOP?e=this.modelNamespace.BOUNDING_BOX_TOP-b.y:c.y>this.modelNamespace.BOUNDING_BOX_BOTTOM&&(e=this.modelNamespace.BOUNDING_BOX_BOTTOM-c.y),a.remove(),this.selectedShape.position.x+=d,this.selectedShape.position.y+=e},changePosition:function(){var a,b,c=0,d=0,e=1;if(this.selectedShape){if(this.selectedShape.isOddShape){a=this.gridPoints[this.modelNamespace.getNearestPoint(this.selectedShape.children[0].segments[0].point,this.gridPoints).index],c=a.x-Math.round(this.selectedShape.children[0].segments[0].point.x),d=a.y-Math.round(this.selectedShape.children[0].segments[0].point.y),this.selectedShape.children[0].segments[0].point=a;for(var f=0;f<this.selectedShape.children.length;f++){1===f&&(e=0);for(var g=e;g<this.selectedShape.children[f].segments.length;g++)this.selectedShape.children[f].segments[g].point.x+=c,this.selectedShape.children[f].segments[g].point.y+=d,b=this.modelNamespace.getNearestPoint(this.selectedShape.children[f].segments[g].point,this.gridPoints),this.selectedShape.children[f].segments[g].point=this.gridPoints[b.index]}}else{a=this.gridPoints[this.modelNamespace.getNearestPoint(this.selectedShape.segments[0].point,this.gridPoints).index],c=a.x-Math.round(this.selectedShape.segments[0].point.x),d=a.y-Math.round(this.selectedShape.segments[0].point.y),this.selectedShape.segments[0].point=a;for(var f=1;f<this.selectedShape.segments.length;f++)this.selectedShape.segments[f].point.x+=c,this.selectedShape.segments[f].point.y+=d,b=this.modelNamespace.getNearestPoint(this.selectedShape.segments[f].point,this.gridPoints),this.selectedShape.segments[f].point=this.gridPoints[b.index]}var h=this.modelNamespace,i=h.EVENTS,j=h.ACTION_ENUM;this.model.trigger(i.TABLE_DATA_EVENT,j.TRANSLATE),this.workCanvasScope.view.draw()}},reflectButtonClick:function(a){var b=this;this.stopReading(),this.activateWorkCanvasScope(),this._removeAllShapeLabels(!1);var c=this.modelNamespace,d=c.EVENTS,e=c.ACTION_ENUM,f=this.model.get("undoStack");f.pop(),this.model.set("undoStack",f);var g=this.model.addEntryToUndoStack(this.canvasShapes);this.selectedShape.currentRotationCount=0,this.selectedShape.defaultCenter=this.selectedShape.position,this.selectedShape.scale(-1,1),this.changePosition();var g=this.model.addEntryToUndoStack(this.canvasShapes);g&&this.addLatticePointsOfSidesOfPolygon(),this.model.trigger(d.DISABLE_BUTTON,e.UNDO,!1),this.model.trigger(d.TABLE_DATA_EVENT,e.REFLECT,{paperItem:this.selectedShape}),this.removeCutLine(),this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT,!1),this.workCanvasScope.view.draw(),this.changeAccMessage("left-panel-canvas-acc-container",18),this.setFocus("left-panel-canvas-acc-container"),this.$el.one("focusout",".left-panel-canvas-acc-container",function(a){b.accContainerFocusOut(a)})},cutButtonClick:function(a){this.stopReading(),this.activateWorkCanvasScope();var b,c=11,d="normal",e="cutHandle",f=this.gridPoints[257],g=this.gridPoints[267],h=this.modelNamespace.EVENTS,i=this.modelNamespace.ACTION_ENUM;this._removeAllShapeLabels(!1),this.cutLineHandleGroup=new this.workCanvasScope.Group,this.dottedCutLine=new this.workCanvasScope.Path.Line(f,g),this.dottedCutLine.strokeColor="#224c5c",this.dottedCutLine.strokeWidth=3,this.dottedCutLine.dashArray=[2,2],b=new this.workCanvasScope.Path.Circle(f,c),b.style=this.getCircleStyle(f,d,e),b.handleCode="a",this.cutLineHandleGroup.addChild(b),b=new this.workCanvasScope.Path.Circle(g,c),b.style=this.getCircleStyle(g,d,e),b.handleCode="b",this.cutLineHandleGroup.addChild(b),this.dummyRectangleOfCutButton=new this.workCanvasScope.Path.RegularPolygon(f,4,28),this.dummyRectangleOfCutButton.fillColor="white",this.dummyRectangleOfCutButton.opacity=.01,this.repositionButton(),this.cutLineHandleGroup.bringToFront(),this.bindCutLineHandleEvent(),this.model.trigger(h.HIDE_BUTTON,i.CUT_LINE,!1),this.model.trigger(h.DISABLE_BUTTON,i.CUT,!0),this.model.trigger(h.DISABLE_BUTTON,i.UNDO,!1),this.checkForIntersection(),this.bindAccessibilityListenersForCutLine();var j=this.getAccMessage("left-panel-canvas-acc-container","shapeText"),k=this.getAccMessage("left-panel-canvas-acc-container","isText");this.canvasShapes.length>1&&(j=this.getAccMessage("left-panel-canvas-acc-container","shapesText"),k=this.getAccMessage("left-panel-canvas-acc-container","areText")),this.changeAccMessage("left-panel-canvas-acc-container",12,[j,k]),this.setFocus("left-panel-canvas-acc-container"),this.enableTab("cut-line-button",!1),this.workCanvasScope.view.draw()},addAccNumber:function(){for(var a=[],b=0;b<this.canvasShapes.length;b++)this.canvasShapes[b].isOriginal?this.canvasShapes[b].accNumber=b+1:a.push(b);for(var b=0;b<a.length;b++){var c=this.canvasShapes[a[b]];c.isOriginal||(c.accNumber=this.findAccOfOriginal(c.shapeUniqueCode))}},findAccOfOriginal:function(a){for(var b=0;b<this.canvasShapes.length;b++)if(this.canvasShapes[b].isOriginal&&this.canvasShapes[b].shapeUniqueCode===a)return this.canvasShapes[b].accNumber},isCutLineButtonClicked:!1,cutLineButtonClick:function(){var a=this;this.stopReading(),this.activateWorkCanvasScope();var b,c=[],d=[],e=this.checkForOverlappingOfshapes(),f=this.model.get("undoStack"),a=this;this.isCutLineButtonClicked=!0,f.pop(),this.model.set("undoStack",f),this.model.addEntryToUndoStack(this.canvasShapes);var g=!1;if(this.selectedShape)for(var h=0;h<this.validCutPointsObjects.length;h++)if(this.validCutPointsObjects[h][0].shapeUniqueCode===this.selectedShape.shapeUniqueCode){g=!0;break}if(g&&this.deSelectNewShape("cutLine"),e){var i=this.getAccMessage("left-panel-canvas-acc-container","shapeText"),j=this.getAccMessage("left-panel-canvas-acc-container","isText");this.canvasShapes.length>1&&(i=this.getAccMessage("left-panel-canvas-acc-container","shapesText"),j=this.getAccMessage("left-panel-canvas-acc-container","areText")),this.changeAccMessage("left-panel-canvas-acc-container",12,[i,j]),this._generateOverlapPopup()}else{this._removeAllShapeLabels(!1);for(var h=0;h<this.validCutPointsObjects.length;h++){var k,b=this.validCutPointsObjects[h];b[0].isOddShape?(k=this.divideOddShape(b),c=c.concat(this._createNewCutShapes(k[0],k[1]))):(k=this.divideNormalShape(b),c=c.concat(this._createNewCutShapes(k,[]))),d.push(b[0].shapeUniqueCode),this.removeSpecifiedElement(b[0].shapeUniqueCode)}this.addNewCutShapes(c),this.addAccNumber(),this.model.trigger(this.modelNamespace.EVENTS.TABLE_DATA_EVENT,this.modelNamespace.ACTION_ENUM.CUT,{removedShapesCodes:d,newShapes:c,allShapes:a.canvasShapes}),this.removeCutLine(),this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT,!1),this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.UNDO,!1),this.workCanvasScope.view.draw(),this.bindAccessibilityListenersForShapeMovement(),this.changeAccMessage("left-panel-canvas-acc-container",24),this.setFocus("left-panel-canvas-acc-container"),this.$el.one("focusout",".left-panel-canvas-acc-container",function(b){a.accContainerFocusOut(b)})}},checkForOverlappingOfshapes:function(){if(this.validCutShapeIndex.length<=1)return!1;for(var a,b,c,d=[],e=0;e<this.validCutShapeIndex.length-1;e++){a=this.canvasShapes[this.validCutShapeIndex[e]].clone(),this.canvasShapes[this.validCutShapeIndex[e]].isOddShape?(a=this.roundUpPositionValueOfSegment(a,!0),a=this.getCloneOfShape(a,!0),this.changeCommonSegment(a.children[0].segments),this.changeCommonSegment(a.children[1].segments)):(a=this.roundUpPositionValueOfSegment(a,!1),a=this.getCloneOfShape(a,!1),this.changeCommonSegment(a.segments)),a.closed=!0;for(var f=e+1;f<this.validCutShapeIndex.length;f++){if(d=[],b=this.canvasShapes[this.validCutShapeIndex[f]].clone(),this.canvasShapes[this.validCutShapeIndex[f]].isOddShape?(b=this.roundUpPositionValueOfSegment(b,!0),b=this.getCloneOfShape(b,!0),this.changeCommonSegment(b.children[0].segments),this.changeCommonSegment(b.children[1].segments)):(b=this.roundUpPositionValueOfSegment(b,!1),b=this.getCloneOfShape(b,!1),this.changeCommonSegment(b.segments)),b.closed=!0,c=a.intersect(b),0!==c.area&&(d=c.getIntersections(this.dottedCutLine)),d.length>1){d.sort(this.modelNamespace.sortHorizontalIntersections);for(var g=0;g<d.length-1;g++){var h=new this.workCanvasScope.Point((d[g].point.x+d[g+1].point.x)/2,(d[g].point.y+d[g+1].point.y)/2),i=!1;if(this.canvasShapes[this.validCutShapeIndex[e]].isOddShape){for(var j=!1,k=0;k<a.children.length;k++)if(this.checkForVertex(h,a.children[k].segments))i=!0;else{i=!1;var l=this.modelNamespace.checkForOnLinePoint(h.x,h.y,a.children[k].segments);if(l.bool){a.remove(),b.remove(),c.remove(),j=!0;break}}if(j)continue}else if(this.checkForVertex(h,a.segments))i=!0;else{var l=this.modelNamespace.checkForOnLinePoint(h.x,h.y,a.segments);if(l.bool){a.remove(),b.remove(),c.remove();continue}}if(this.canvasShapes[this.validCutShapeIndex[f]].isOddShape){for(var j=!1,k=0;k<b.children.length;k++)if(i=!1,this.checkForVertex(h,b.children[k].segments))i=!0;else{var l=this.modelNamespace.checkForOnLinePoint(h.x,h.y,b.children[k].segments);if(l.bool){a.remove(),b.remove(),c.remove(),j=!0;break}}if(j)continue}else if(!i)if(this.checkForVertex(h,b.segments))i=!0;else{var l=this.modelNamespace.checkForOnLinePoint(h.x,h.y,b.segments);if(l.bool){a.remove(),b.remove(),c.remove();continue}}if(!i&&this.modelNamespace.isPointInsideShape(c,h,!0)){var m=!1;if(a.position.x===b.position.x&&a.position.y===b.position.y&&Math.abs(a.area)===Math.abs(b.area)&&(m=!0),!m){var n=this.verifyOverlap(a,b);if(a.remove(),b.remove(),c.remove(),!n)continue}return!0}}}else{var o=this.cutLineHandleGroup.children[0],p=this.cutLineHandleGroup.children[1];if(1===d.length&&!(d[0].point.x===o.position.x&&d[0].point.y===o.position.y||d[0].point.x===p.position.x&&d[0].point.y===p.position.y)){if(c.children&&0===c.children.length){c.remove(),b.remove();continue}if(this.modelNamespace.isPointInsideShape(c,o.position,!0)||this.modelNamespace.isPointInsideShape(c,p.position,!0)){var m=!1;if(a.position.x===b.position.x&&a.position.y===b.position.y&&Math.abs(a.area)===Math.abs(b.area)&&(m=!0),!m){var n=this.verifyOverlap(a,b);if(a.remove(),b.remove(),c.remove(),!n)continue}return!0}}}c.remove(),b.remove()}a.remove()}return!1},getCloneOfShape:function(a,b){if(b){for(var c=this.getVertexOfShapes($.extend([],!0,a.children[0].segments)),d=new this.workCanvasScope.Path,e=new this.workCanvasScope.Path,f=0;f<c.length;f++)d.add(c[f]);for(var g=this.getVertexOfShapes($.extend([],!0,a.children[1].segments)),e=new this.workCanvasScope.Path,f=0;f<g.length;f++)e.add(g[f]);d.closed=!0,e.closed=!0;var h=new this.workCanvasScope.CompoundPath({children:[d,e]});return a.remove(),h}for(var i=this.getVertexOfShapes($.extend([],!0,a.segments)),d=new this.workCanvasScope.Path,f=0;f<i.length;f++)d.add(i[f]);return a.remove(),d},getVertexOfShapes:function(a){a[0].point.x===a[a.length-1].point.x&&a[0].point.y===a[a.length-1].point.y&&a.pop();var b,c=[],d=0,e=a.length,f=!1;for(c.push(a[0].point);d<a.length-2;){for(b=d+1;b<a.length-1;b++){var g=a[d].point.x,h=a[d].point.y,i=a[b].point.x,j=a[b].point.y,k=a[b+1].point.x,l=a[b+1].point.y,m=(j-h)/(i-g),n=(l-j)/(k-i);if(m!==n){d=b,c.push(a[d].point),f=!0;break}}f?f=!1:d++}d=e-2,b=d+1;var g=a[d].point.x,h=a[d].point.y,i=a[b].point.x,j=a[b].point.y,k=a[0].point.x,l=a[0].point.y,m=(j-h)/(i-g),n=(l-j)/(k-i);m!==n&&(d=b,c.push(a[d].point));var g=a[d].point.x,h=a[d].point.y,i=a[0].point.x,j=a[0].point.y,k=a[1].point.x,l=a[1].point.y,m=(j-h)/(i-g),n=(l-j)/(k-i);return m===n&&c.splice(0,1),c},verifyOverlap:function(a,b){if(this.checkIsInside(a.position,b))return!0;if(this.checkIsInside(b.position,a))return!0;if(this.checkVertexPresentInOtherShape(a,b))return!0;if(this.checkVertexPresentInOtherShape(b,a))return!0;if(a.children){if(this.checkOverlapUsingIntersectPoint(b,a))return!0}else if(a.area<b.area){if(this.checkOverlapUsingIntersectPoint(a,b))return!0}else if(this.checkOverlapUsingIntersectPoint(b,a))return!0;return!1},checkVertexPresentInOtherShape:function(a,b){if(a.children)for(var c=0;c<a.children.length;c++)for(var d=0;d<a.children[c].segments.length;d++){var e=a.children[c].segments[d].point;if(this.checkIsInside(e,b))return!0}else for(var d=0;d<a.segments.length;d++){var e=a.segments[d].point;if(this.checkIsInside(e,b))return!0}return!1},checkIsInside:function(a,b){return!this.modelNamespace.isPointOnPath(a,b)&&this.modelNamespace.isPointInsideShape(b,a,!0)?!0:!1},checkOverlapUsingIntersectPoint:function(a,b){for(var c=0;c<a.segments.length-1;c++){var d=this.workCanvasScope.Path.Line(a.segments[c].point,a.segments[c+1].point),e=d.getIntersections(b);if(e.length>1)for(var f=0;f<e.length-1;f++){var g=e[f].point,h=e[f+1].point,i=new this.workCanvasScope.Point((g.x+h.x)/2,(g.y+h.y)/2);if(this.checkIsInside(i,b))return d.remove(),!0}else if(1===e.length){var i=new this.workCanvasScope.Point((a.segments[c].point.x+a.segments[c+1].point.x)/2,(a.segments[c].point.y+a.segments[c+1].point.y)/2);if(this.checkIsInside(i,b))return d.remove(),!0}d.remove()}return!1},roundUpPositionValueOfSegment:function(a,b){if(b)for(var c=0;c<a.children.length;c++)for(var d=0;d<a.children[c].segments.length;d++){var e=a.children[c].segments[d].point;a.children[c].segments[d].point.x=Math.round(e.x),a.children[c].segments[d].point.y=Math.round(e.y)}else for(var c=0;c<a.segments.length;c++){var e=a.segments[c].point;a.segments[c].point.x=Math.round(e.x),a.segments[c].point.y=Math.round(e.y)}return a},changeCommonSegment:function(a){for(var b=0;b<a.length;b++)for(var c=b+1;c<a.length;c++)if(a[b].point.x==a[c].point.x&&a[b].point.y==a[c].point.y){a[b].point.x+=.1,a[b].point.y+=.1;break}},checkForVertex:function(a,b){for(var c=0;c<b.length;c++)if(b[c].point.x===a.x&&b[c].point.y===a.y)return!0;return!1},_generateOverlapPopup:function(){this.stopReading();var a,b=this.getMessage("explore-texts",3),c=(this.getAccMessage("explore-texts",3),this.getMessage("explore-texts",4)),d=this.getAccMessage("explore-texts",4),e=[],f={id:"ok-win-button",type:MathInteractives.global.Theme2.Button.TYPE.TEXT,text:this.getMessage("explore-texts","ok-button-text"),baseClass:"popupButtonBaseClass",textColor:"#222222",clickCallBack:{fnc:this._onOkButtonClick,scope:this},response:{isPositive:!0,buttonClicked:"ok-win-button"}};e.push(f),a={title:b,accTitle:b,text:c,accText:d,manager:this.manager,player:this.player,path:this.filePath,idPrefix:this.idPrefix,containsTts:!0,buttons:e,width:422,height:269,bodyTextColorClass:"popup-body-text-class",titleTextColorClass:"popup-title-text-class"},this.popupView=MathInteractives.global.Theme2.PopUpBox.createPopup(a),this.popupView.$(".theme2-pop-up-dialogue").css("background-color","rgba( 0, 0, 0, 0.85 )")},_onOkButtonClick:function(){this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT_LINE,!0),this.setFocus("undo-button-container")},divideOddShape:function(a){var b=this.model.getBoundaryPointOfShapeObject(a[0].shapeUniqueCode),c=b.boundaryPointArray,d=b.boundaryPointArray2,e=[],f=[];if(a[0].isRemovingOddShape){var g=c.indexOf(a[0].start),h=c.indexOf(a[0].end),i=[],j=[],k=[],l=[],m=!1;if(g>h){var n=g;g=h,h=n}for(var o=g;h>=o;o++)i.push(c[o]);for(var o=h;o<c.length;o++)j.push(c[o]);for(var o=0;g>=o;o++)j.push(c[o]);if(g=d.indexOf(a[1].start),a[1].start===a[1].end?m=!0:h=d.indexOf(a[1].end),m){for(var o=g;o<d.length;o++)k.push(d[o]);for(var o=0;g>=o;o++)k.push(d[o]);l.push(d[g])}else{if(g>h){var n=g;g=h,h=n}for(var o=g;h>=o;o++)k.push(d[o]);for(var o=h;o<d.length;o++)l.push(d[o]);for(var o=0;g>=o;o++)l.push(d[o])}var p,q,r=this.cutLineHandleGroup.children[0].position.x,s=this.cutLineHandleGroup.children[0].position.y,t=this.cutLineHandleGroup.children[1].position.x,u=this.cutLineHandleGroup.children[1].position.y,v=r-t,w=s-u,x=this.modelNamespace.getOnlinePoint(r,p,t,s,q,u,v,w,this.gridPoints);-1===x.indexOf(k[1])?this.checkForPointInsideCurrentShape(this.gridPoints[k[1]],i)?(i=i.concat(k),j=j.concat(l)):(i=i.concat(l),j=j.concat(k)):-1===x.indexOf(l[1])&&(this.checkForPointInsideCurrentShape(this.gridPoints[l[1]],i)?(i=i.concat(l),j=j.concat(k)):(i=i.concat(k),j=j.concat(l))),e.push(i),e.push(j)}else{var g=c.indexOf(a[0].start),h=c.indexOf(a[0].end),i=[],j=[],y=!1;if(g>h){var n=g;g=h,h=n}for(var o=g;h>=o;o++)i.push(c[o]);for(var o=h;o<c.length;o++)j.push(c[o]);for(var o=0;g>=o;o++)j.push(c[o]);this.checkForPointInsideCurrentShape(this.gridPoints[d[0]],i)&&(y=!0),y?(e.push(j),f.push(i)):(e.push(i),f.push(j)),f.push(d)}return[e,f]},divideNormalShape:function(a){for(var b=[],c=0;c<a.length;c++){var d,e,f,g=a[c],h=[];if(0===c)d=this.model.getBoundaryPointOfShape(g.shapeUniqueCode),e=d.indexOf(g.start),f=d.indexOf(g.end);else for(var i=0;i<b.length;i++)if(e=b[i].indexOf(g.start),f=b[i].indexOf(g.end),-1!==e&&-1!==f){d=b[i],b.splice(i,1);break}if(e>f){var j=e;e=f,f=j}for(var i=e;f>=i;i++)h.push(d[i]);b.push(h);for(var h=[],i=f;i<d.length;i++)h.push(d[i]);for(var i=0;e>=i;i++)h.push(d[i]);b.push(h)}return b},_createNewCutShapes:function(a,b){for(var c=[],d=this.getDefaultShapeColor("normal"),e=this.modelNamespace.SHAPE_STROKE_COLORS.NORMAL,f=0;f<a.length;f++){for(var g=new this.workCanvasScope.Path,h=0;h<a[f].length;h++)g.add(this.gridPoints[a[f][h]]);g.add(this.gridPoints[a[f][0]]),g.strokeColor=e,g.fillColor=d,g.strokeWidth=2,g.isOddShape=!1,g.isSelected=!1,this.addPropertiesToShape(g,!0),g.shapeUniqueCode=this.uniqueNumber,this.uniqueNumber++,c.push(g)}if(b.length>0){for(var i=new this.workCanvasScope.Path,j=new this.workCanvasScope.Path,h=0;h<b[0].length;h++)i.add(this.gridPoints[b[0][h]]);i.add(this.gridPoints[b[0][0]]);for(var h=0;h<b[1].length;h++)j.add(this.gridPoints[b[1][h]]);j.add(this.gridPoints[b[1][0]]);var k=new this.workCanvasScope.CompoundPath({children:[i,j],fillColor:d,strokeColor:e,strokeWidth:2});k.isOddShape=!0,k.children[0].isOddShape=!0,k.children[1].isOddShape=!0,k.isSelected=!1,this.addPropertiesToShape(k,!0),k.shapeUniqueCode=this.uniqueNumber,this.uniqueNumber++,c.push(k)}return c=this.repositionShapesAfterCut(c)},repositionShapesAfterCut:function(a){var b,c,d,e,f,g,h,i;return c=this.dottedCutLine.segments[0].point.subtract(this.dottedCutLine.segments[1].point),b=c.angle+180,g=-1*this.modelNamespace.GAP_BETWEEN_POINTS,f=this.seperateShapes(a,b),h=f.isVertical,d=f.shapeIndex1,e=f.shapeIndex2,i=this.moveShapes(a,d,g,h),i||this.moveShapes(a,e,-1*g,h),a},seperateShapes:function(a,b){var c,d,e,f,g,h,i=!1,j=[],k=[],l={},m=!1;(b>=315&&360>=b||b>=0&&45>=b||b>=135&&225>=b)&&(i=!0);for(var n=0;n<a.length;n++){if(m=!1,g=a[n],f=g.getIntersections(this.dottedCutLine),f.length>1){i?f.sort(this.modelNamespace.sortHorizontalIntersections):f.sort(this.modelNamespace.sortVerticalIntersections);for(var o=0;o<f.length-1;o++){c=new this.workCanvasScope.Point((f[o].point.x+f[o+1].point.x)/2,(f[o].point.y+f[o+1].point.y)/2),d=$.extend({},!0,c),e=$.extend({},!0,c),i?d.y=c.y-1:d.x=c.x-1,i?e.y=c.y+1:e.x=c.x+1,h=g.isOddShape?g.children[0].segments:g.segments;var p=this.modelNamespace.isPointInsideShape(g,d,!0),q=this.modelNamespace.isPointInsideShape(g,e,!0);if(!(p&&q||!p&&!q)){if(p){m=!0;break}if(q){m=!1;break}if(this.modelNamespace.isPointOnPath(d,g)){m=!0;break}if(this.modelNamespace.isPointOnPath(e,g)){m=!1;break}}}}else if(1===f.length){c=$.extend({},!0,f[0].point),i?c.y-=1:c.x-=1,h=g.isOddShape?g.children[0].segments:g.segments;var r=g.contains(c);r?m=!0:this.modelNamespace.isPointOnPath(c,g)?m=!0:(c=f[0].point,d=this.cutLineHandleGroup.children[0].position,e=this.cutLineHandleGroup.children[1].position,!this.modelNamespace.isPointOnPath(d,g)||d.x===c.x&&d.y===c.y?d=c:e=c,c=new this.workCanvasScope.Point((d.x+e.x)/2,(d.y+e.y)/2),i?c.y-=1:c.x-=1,g.contains(c)?m=!0:this.modelNamespace.isPointOnPath(c,g)&&(m=!0))}m?j.push(n):k.push(n)}return l.isVertical=i,l.shapeIndex1=j,l.shapeIndex2=k,l},moveShapes:function(a,b,c,d){for(var e,f=!1,g=this.selectedShape,h=0;h<b.length;h++)if(d?a[b[h]].position.y+=c:a[b[h]].position.x+=c,!this.isShapeInsideBoundaryOfcanvas(a[b[h]])){e=h,f=!0;break}if(f){c*=-1;for(var h=0;e>=h;h++)d?a[b[h]].position.y+=c:a[b[h]].position.x+=c}for(var h=0;h<b.length;h++)this.selectedShape=a[b[h]],this.changePosition(),this.selectedShape=null;return this.selectedShape=g,!f},isShapeInsideBoundaryOfcanvas:function(a){var b=a.clone(),c=b.bounds;return c.left>=this.modelNamespace.BOUNDING_BOX_LEFT&&c.top>=this.modelNamespace.BOUNDING_BOX_TOP&&c.right<=this.modelNamespace.BOUNDING_BOX_RIGHT&&c.bottom<=this.modelNamespace.BOUNDING_BOX_BOTTOM?(b.remove(),!0):(b.remove(),!1)},addNewCutShapes:function(a){this.bindEventsToNewShape(a),this.canvasShapes=this.canvasShapes.concat(a);var b=this.model.addEntryToUndoStack(this.canvasShapes);b&&this.addLatticePointsOfSidesOfPolygon(),this.workCanvasScope.view.draw()},removeSpecifiedElement:function(a){var b=this.fetchPaperObjectIndex(a);b.sort(function(a,b){return b-a});for(var c=0;c<b.length;c++){var d=this.canvasShapes.splice(b[c],1);this.unbindPaperEvents(d[0]),d[0].remove()}},removeCutLine:function(){if(this.activateWorkCanvasScope(),this.cutLineHandleGroup){this.bindAccessibilityListenersForShapeMovement(),this.unbindPaperEvents(this.cutLineHandleGroup),this.cutLineHandleGroup.remove(),this.cutLineHandleGroup=null,this.dottedCutLine.remove(),this.dottedCutLine=null,this.dummyRectangleOfCutButton.remove(),this.dummyRectangleOfCutButton=null,this.model.trigger(this.modelNamespace.EVENTS.HIDE_BUTTON,this.modelNamespace.ACTION_ENUM.CUT_LINE,!0);var a=this.model.get("undoStack");1===a.length&&this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.UNDO,!0)}},_onShapeBorderColorChangeRequired:function(a,b,c){var d=this.fetchShapePaperObject(a,b),e=this.modelNamespace.SHAPE_STROKE_COLORS;d&&(c?(d.strokeColor=e.SELECTED,this.deSelectNewShape(),d.bringToFront()):d.strokeColor=b?e.NORMAL:e.COPY,this.workCanvasScope.view.draw())},accContainerFocusOut:function(){var a=this.getAccMessage("left-panel-canvas-acc-container","shapeText"),b=this.getAccMessage("left-panel-canvas-acc-container","isText");this.canvasShapes.length>1&&(a=this.getAccMessage("left-panel-canvas-acc-container","shapesText"),b=this.getAccMessage("left-panel-canvas-acc-container","areText")),this.changeAccMessage("left-panel-canvas-acc-container",9,[a,b])}})}(),function(){"use strict";MathInteractives.Common.Interactivities.ShapeDecomposition.Views.RightPanel=MathInteractives.Common.Interactivities.ShapeDecomposition.Views.ExploreClass.extend({modelNamespace:MathInteractives.Common.Interactivities.ShapeDecomposition.Models.ShapeDecompositionData,_$actualTable:null,_$duplicatesTable:null,actualShapeInputBoxes:null,duplicateShapeInputBoxes:null,_inputBoxesToCheck:null,_checkAll:!1,_$totalArea:null,_$totalBadge:null,actualTextboxTabIndex:null,duplicateTextboxTabIndex:null,screenObj:null,initialize:function(){this.actualTextboxTabIndex=1350,this.duplicateTextboxTabIndex=1600,this.screenObj={},this.screenObj.id="text-box-screen",this.screenObj.name="text-box-screen",this.screenObj.elements=[],this.initializeDefaultProperties(),this.initializeVariables(),this._bindEvents(),this.loadScreen("right-panel-screen"),this._$tablesContainer.addClass("invisible")},initializeVariables:function(){var a,b=this.modelNamespace.SHAPE_TYPES;this._$tablesContainer=this.$(".right-panel-table-container"),this._$actualTable=this.$("."+b.ACTUAL+"-shape-table"),this._$duplicatesTable=this.$("."+b.DUPLICATE+"-shape-table"),this.actualShapeInputBoxes={},this.duplicateShapeInputBoxes={},this._inputBoxesToCheck=[],a=this.$(".actual-shape-table-footer"),a.find(".total-text").text(this.getMessage("explore-texts","total-text")),a.find(".unit-text").text(this.getMessage("explore-texts","area-unit-text")),this._$totalArea=a.find(".total-area-box"),this._$totalBadge=a.find(".footer-cell-1")},_bindEvents:function(){var a=this,b=this.modelNamespace.EVENTS;this.$el.on("click",'.done-button-container:not(".disabled")',function(b){a._onDoneClick(b)}),this.$el.on("click",'.next-button-container:not(".disabled")',function(b){a._onNextClick(b)}),this.$el.on("click",'.check-button-container:not(".disabled")',function(b){a._onCheckClick(b)}),this.listenTo(this.model,b.TABLE_DATA_EVENT,this._onTableDataEvent),this.listenTo(this.model,b.TRY_ANOTHER_CLICK,this._resetRightPanel)},_onDoneClick:function(){this.model.trigger(this.modelNamespace.EVENTS.DONE_BUTTON_CLICK)},_onNextClick:function(){this.model.trigger(this.modelNamespace.EVENTS.NEXT_BUTTON_CLICK)},_onCheckClick:function(a,b){b&&b.inputEle.blur(),this.model.trigger(this.modelNamespace.EVENTS.CHECK_BUTTON_CLICK)},_resetRightPanel:function(){this.showTables(!1),this._emptyTable(),this.actualTextboxTabIndex=1350,this.duplicateTextboxTabIndex=1600,this.screenObj.elements=[]},_onTableDataEvent:function(a,b){var c=this.modelNamespace.ACTION_ENUM;switch(a){case c.NEXT:this._render(b.paperItem);break;case c.COPY:this._addEntryInTable(b.paperItem),this._createAccesibilityOfTextbox([b.paperItem]);break;case c.ROTATE:case c.REFLECT:this._updateImageForShape(b.paperItem),this._storeInputBoxValuesInUndoStack();break;case c.TRANSLATE:this._storeInputBoxValuesInUndoStack();break;case c.UNDO:this.actualTextboxTabIndex=1350,this.duplicateTextboxTabIndex=1600,this.screenObj.elements=[],this._updateTableOnUndo(b.newShapes,b.undoneStep),this._createAccesibilityOfTextbox(b.newShapes),this._changeTextOfFieldTextboxes(b.newShapes),this._enableDisableCheckBtn();break;case c.CHECK:this._checkInputBoxValues(b.shapes,b.paperScope);break;case c.CUT:this._removeEntriesForShapes(b.removedShapesCodes),this._addEntriesForShapes(b.newShapes),this.actualTextboxTabIndex=1350,this.duplicateTextboxTabIndex=1600,this.screenObj.elements=[],this._createAccesibilityOfTextbox(b.allShapes),this._changeTextOfFieldTextboxes(b.allShapes),this._$totalBadge.css("background-image","none"),this._$totalBadge.removeClass("correct incorrect");break;case c.REMOVE_ALL_BADGES:this._removeAllInputBoxBadges(b.shapes)}},_render:function(a){this.model.trigger(this.modelNamespace.EVENTS.HIDE_BUTTON,this.modelNamespace.ACTION_ENUM.NEXT,!0),this.model.trigger(this.modelNamespace.EVENTS.HIDE_BUTTON,this.modelNamespace.ACTION_ENUM.CHECK,!1),this.showTables(!0),this.actualTextboxTabIndex=1350,this.duplicateTextboxTabIndex=1600,this._addEntryInTable(a),this.unloadScreen("right-panel-screen"),this.loadScreen("right-panel-screen"),this.changeAccMessage("actual-shape-table-footer-cell-1",0,[0]),this._createAccesibilityOfTextbox([a],"renderCall")},showTables:function(a){a===!1?this._$tablesContainer.addClass("invisible"):this._$tablesContainer.removeClass("invisible")},_addEntriesForShapes:function(a){for(var b in a)this._addEntryInTable(a[b])},_createAccesibilityOfTextbox:function(a,b){var c,d,e,f,g;for(var h in a)e=a[h].shapeUniqueCode,a[h].isOriginal?(c="actual",d=this.actualTextboxTabIndex,this.actualTextboxTabIndex++,f=c+"-shape-input-box-"+e):(c="duplicate",d=this.duplicateTextboxTabIndex,this.duplicateTextboxTabIndex++,f=c+"-shape-input-box-"+e),g=this._createScreenForTextBoxes(f,d,c,a[h].accNumber),this.screenObj.elements.push(g);"renderCall"!==b&&this.unloadScreen("text-box-screen"),this.manager.model.parse([this.screenObj]),this.loadScreen("text-box-screen")},_changeTextOfFieldTextboxes:function(a){var b,c,d,e,f,g,h;for(var i in a)b=a[i],
g=b.shapeUniqueCode,c=b.isOriginal,d=c?this.actualShapeInputBoxes[g]:this.duplicateShapeInputBoxes[g],e=d.getCurrentInputValue(),f=d.$el.children()[0].id.replace(this.idPrefix,""),h=d.$el.parents(".input-box-container"),h.hasClass("correct")?this.changeAccMessage(f,2,[Number(e),b.accNumber,"correct"]):h.hasClass("incorrect")?this.changeAccMessage(f,2,[Number(e),b.accNumber,"incorrect"]):null!==e?this.changeAccMessage(f,1):this.changeAccMessage(f,0)},_addEntryInTable:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(q=this.modelNamespace,r=q.SHAPE_TYPES,h=q.MINI_SHAPE_MAX_IMAGE_HEIGHT,c=this._getScaledImageOfPaperItem(a,h,q.MINI_SHAPE_MAX_IMAGE_WIDTH),g=Math.ceil(c.height),i=Math.floor((h-g)/2)+"px auto",d=a.shapeUniqueCode,e=a.isOriginal?r.ACTUAL:r.DUPLICATE,f=MathInteractives.Common.Interactivities.ShapeDecomposition.templates.tableRow({idPrefix:this.idPrefix,actualOrDuplicate:e,shapeCode:d,imageURL:c.url,imageWidth:Math.ceil(c.width)+"px",imageHeight:g+"px",margin:i,unitText:this.getMessage("explore-texts","area-unit-text")}).trim(),l=this.model.get("undoStack"),m=l[l.length-1],n=m.length,k=0;n>k;k++)if(o=m[k],o.shapeUniqueCode===d&&o.isOriginal===a.isOriginal){j=o.userInput;break}null===b||"undefined"==typeof b?a.isOriginal?this._$actualTable.append(f):(this._$duplicatesTable.parent().parent().show(),this._$duplicatesTable.append(f)):(a.isOriginal?p=this._$actualTable:(this._$duplicatesTable.parent().parent().show(),p=this._$duplicatesTable),-1===b?p.prepend(f):$(f).insertAfter(p.find(".shape-table-row-"+b))),this._addInputBoxInRow(d,e,j),this.$(".actual-shape-table-conatiner").scrollTop(12e3),this.$(".duplicate-shape-table-conatiner").scrollTop(12e3)},_addInputBoxInRow:function(a,b,c){var d,e,f,g,h=b+"-shape-input-box-"+a;d=this,e={filePath:this.filePath,idPrefix:this.idPrefix,containerId:this.idPrefix+h,inputType:MathInteractives.Common.Components.Theme2.Views.InputBox.INPUT_TYPE_CUSTOM,maxCharLength:5,player:this.player,manager:this.manager,allowNegative:!1,width:"67",height:"35",precision:2,previousValue:0,regexString:/^(\d{0,3}|\d{0,2}\.\d{1,2}|\d{0,3}\.\d{0,1})$/,defaultInput:"",defaultTextOnEmptyInputBox:"",defaultValue:""},f=MathInteractives.global.Theme2.InputBox,g=f.createInputBox(e),this.listenTo(g,g.containerId+f.ENTER_PRESS_EVENT_NAME,function(a){null!==g.getCurrentInputValue()&&d._onCheckClick(a,g)}),this.listenTo(g,f.INPUT_TYPE_BLUR_EVENT,function(a,b,c){d._onInputBoxBlur(b,g)}),this.listenTo(g,f.INPUT_TYPE_FOCUS_EVENT,function(a){d._onInputBoxFocus(a,g)}),this.listenTo(g,e.containerId+f.KEYUP_EVENT_NAME,function(a,b,c,e){var f=g.model.getPreviousValue(),h=g.getCurrentInputValue();null===h&&(h=""),null===f&&(f=""),f!==h&&d._onInputChange(a,g)}),g.setCurrentInputValue(c),b===this.modelNamespace.SHAPE_TYPES.ACTUAL?this.actualShapeInputBoxes[a]=g:this.duplicateShapeInputBoxes[a]=g},_createScreenForTextBoxes:function(a,b,c,d){var e={accId:a+"textbox",id:a+"textbox",type:"text",tabIndex:b,messages:[]};return"actual"===c?e.messages.push({id:0,isAccTextSame:!1,message:{loc:"",acc:this.getAccMessage("textbox-texts",0,[d,d])}},{id:1,isAccTextSame:!1,message:{loc:"",acc:this.getAccMessage("textbox-texts",2,[d,d])}},{id:2,isAccTextSame:!1,message:{loc:"",acc:this.getAccMessage("textbox-texts",4)}}):e.messages.push({id:0,isAccTextSame:!1,message:{loc:"",acc:this.getAccMessage("textbox-texts",1,[d,d])}},{id:1,isAccTextSame:!1,message:{loc:"",acc:this.getAccMessage("textbox-texts",3,[d,d])}},{id:2,isAccTextSame:!1,message:{loc:"",acc:this.getAccMessage("textbox-texts",4)}}),e},_onInputBoxBlur:function(a,b){var c,d,e,f,g,h=this.$(a.target).parent()[0].id.replace(this.idPrefix,"");c=b.getCurrentInputValue(),null!==c?(c=Number(c),isNaN(c)&&(c=0),b.setCurrentInputValue(c.toString()),this.changeAccMessage(h,1)):this.changeAccMessage(h,0),this._storeInputBoxValuesInUndoStack(),d=$(a.target).parents(".shape-table-row"),d.removeClass("editing"),e=d[0].id,f=e.slice(e.lastIndexOf("-")+1),g=-1!==a.target.id.indexOf("actual"),this.model.trigger(this.modelNamespace.EVENTS.CHANGE_SHAPE_BORDER_COLOR,f,g,!1)},_onInputBoxFocus:function(a,b){this.stopReading(),-1===this._inputBoxesToCheck.indexOf(b.cid)&&this._inputBoxesToCheck.push(b.cid);var c,d,e,f,g,h,i=this.modelNamespace.EVENTS;c=b.$el.parents(".shape-table-row"),d=c.find(".input-box-container"),e=d.find(".input-box-badge"),c.addClass("editing"),d.removeClass("correct incorrect"),f=b.el.id,g=f.slice(f.lastIndexOf("-")+1),h=-1!==f.indexOf("actual"),h&&this._$totalBadge.removeClass("correct incorrect"),this.model.trigger(i.ADD_REMOVE_SHAPE_LABEL,!1,{shapeCode:g,isOriginal:h}),this.model.trigger(i.CHANGE_SHAPE_BORDER_COLOR,g,h,!0)},_onInputChange:function(a,b){this._updateTotal(),-1===this._inputBoxesToCheck.indexOf(b.cid)&&this._inputBoxesToCheck.push(b.cid),null===b.getCurrentInputValue()&&this._inputBoxesToCheck.splice(this._inputBoxesToCheck.indexOf(b.cid),1),this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CHECK,0===this._inputBoxesToCheck.length)},_updateTotal:function(){var a,b,c=0,d=!0,e=this.actualShapeInputBoxes;for(a in e)b=e[a].getCurrentInputValue(),null!==b&&(d=!1),b=+b,isNaN(b)||(c+=b);d?(c="",this.changeAccMessage("actual-shape-table-footer-cell-1",0,[0]),this.$(".footer-cell-1").removeClass("correct incorrect")):(c=+c.toFixed(2),this.changeAccMessage("actual-shape-table-footer-cell-1",0,[c])),this._$totalArea.text(c),this._$tablesContainer.find(".footer-cell-0").width(this.$(".actual-shape-table-wrapper").width()-this._$tablesContainer.find(".footer-cell-1").width()-this._$tablesContainer.find(".footer-cell-2").outerWidth(!0))},_storeInputBoxValuesInUndoStack:function(){var a,b,c,d,e,f,g,h,i,j;for(b=this.actualShapeInputBoxes,c=this.duplicateShapeInputBoxes,f=this.model.get("undoStack"),g=f[f.length-1],h=g.length,a=0;h>a;a++)i=g[a],j=i.shapeUniqueCode,d=i.isOriginal?b[j]:c[j],e=d.getCurrentInputValue(),i.userInput=e},_updateTableOnUndo:function(a,b){var c,d,e,f,g,h,i,j=a.length,k=this.model.get("undoStack"),l=k[k.length-1],m=this,n=-1,o=-1;for(h=_.keys(this.actualShapeInputBoxes),i=_.keys(this.duplicateShapeInputBoxes),g=function(a,c,e,f){if(-1!==e.indexOf(a)){var g,h,i,j;for(i=0;i<b.length;i++)if(g=b[i],g.shapeUniqueCode.toString()===a&&g.isOriginal===c){for(j=0;j<l.length;j++)if(l[j].shapeUniqueCode.toString()===a&&l[j].isOriginal===c){h=l[j].userInput;break}b.splice(i,1);break}m._updateEntry(d,h)}else m._addEntryInTable(d,f)},c=0;j>c;c++)d=a[c],e=d.shapeUniqueCode.toString(),f=d.isOriginal,f?(g(e,f,h,n),n=e):(g(e,f,i,o),o=e);for(c=0;c<b.length;c++)this._removeEntryFromTable(b[c].shapeUniqueCode,b[c].isOriginal);this._updateTotal()},_emptyTable:function(){var a,b=this.actualShapeInputBoxes;for(a in b)this._removeEntryFromTable(a);this._updateTotal()},_removeEntriesForShapes:function(a){for(var b in a)this._removeEntryFromTable(a[b]);this._updateTotal()},_removeEntryFromTable:function(a,b){var c,d=null===b||"undefined"==typeof b;this.$el;(d||b===!0)&&(c=this.actualShapeInputBoxes[a],c&&(c.remove(),delete this.actualShapeInputBoxes[a]),this._$actualTable.find(".shape-table-row-"+a).remove()),(d||b===!1)&&(c=this.duplicateShapeInputBoxes[a],c&&(c.remove(),delete this.duplicateShapeInputBoxes[a]),this._$duplicatesTable.find(".shape-table-row-"+a).remove(),0===this._$duplicatesTable.find(".shape-table-row").length&&this._$duplicatesTable.parent().parent().hide()),this._inputBoxesToCheck.length&&(this._inputBoxesToCheck=[])},_updateEntry:function(a,b){this._updateImageForShape(a),a.isOriginal?(this.actualShapeInputBoxes[a.shapeUniqueCode].setCurrentInputValue(b),(null===b||"undefined"==typeof b)&&this.actualShapeInputBoxes[a.shapeUniqueCode].$el.parent().removeClass("incorrect correct")):(this.duplicateShapeInputBoxes[a.shapeUniqueCode].setCurrentInputValue(b),(null===b||"undefined"==typeof b)&&this.duplicateShapeInputBoxes[a.shapeUniqueCode].$el.parent().removeClass("incorrect correct"))},_updateImageForShape:function(a){var b=a.shapeUniqueCode,c=this.modelNamespace,d=(c.SHAPE_TYPES,a.isOriginal),e=d?this._$actualTable:this._$duplicatesTable,f=e.find(".shape-table-row-"+b),g=f.find(".shape-miniature"),h=(f.find(".shape-miniature-during-edit"),c.MINI_SHAPE_MAX_IMAGE_HEIGHT),i=this._getScaledImageOfPaperItem(a,h,c.MINI_SHAPE_MAX_IMAGE_WIDTH),j=i.height,k=Math.floor((h-j)/2)+"px auto";g.css({"background-image":"url("+i.url+")",width:i.width,height:j,margin:k})},_getScaledImageOfPaperItem:function(a,b,c){var d,e,f,g,h,i,j=a.isOriginal,k=j?this.model.get("defaultShapeColors").normal:this.model.get("copiedShapeColors").normal;return d=a.getStrokeBounds(),e=d.height,f=d.width,b=b||e,c=c||f,b=b||e,c=c||f,g=Math.min(b/e,c/f),h=a.clone(!1),h.fillColor=k,h.applyMatrix(!1),h.scale(g),h=h.rasterize(),i=h.toDataURL(),h.remove(),{url:i,height:e*g,width:f*g}},_checkInputBoxValues:function(a,b){if(!this.$el.find(".check-button-container").hasClass("disabled")){this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CHECK,!0);var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this.modelNamespace,s=r.SHAPE_STROKE_COLORS,t=(s.CORRECT,s.INCORRECT),u=!0,v=!1;for(d=a.length,h=r.GAP_BETWEEN_POINTS,i=1/(h*h),q="url("+r.LABEL_URL.CORRECT+")",c=0;d>c;c++)e=a[c],k=e.shapeUniqueCode,j=e.isOriginal,l=j?this.actualShapeInputBoxes[k]:this.duplicateShapeInputBoxes[k],g=l.getCurrentInputValue(),o=l.$el.children()[0].id.replace(this.idPrefix,""),0===c&&(p=o),null!==g&&0!==g.length?(g=Number(g),isNaN(g)&&(g=0),l.setCurrentInputValue(g.toString()),f=Math.abs(e.area)*i,j&&!v&&(v=!0),this._checkAll===!1&&-1===this._inputBoxesToCheck.indexOf(l.cid)&&j&&g!==f&&(u=!1),m=l.$el.parents(".input-box-container"),n=m.find(".input-box-badge"),g===f?(this.model.trigger(r.EVENTS.ADD_REMOVE_SHAPE_LABEL,!0,{shape:e,inputValue:g,correctLabel:!0}),m.addClass("correct").removeClass("incorrect"),this.changeAccMessage(o,2,[g,e.accNumber,"correct"]),n.css("background-image",q)):(j&&(u=!1),e.strokeColor=t,this.model.trigger(r.EVENTS.ADD_REMOVE_SHAPE_LABEL,!0,{shape:e,inputValue:g,correctLabel:!1}),m.addClass("incorrect").removeClass("correct"),this.changeAccMessage(o,2,[g,e.accNumber,"incorrect"]))):j&&(u=!1);v&&(u?(this._$totalBadge.addClass("correct").removeClass("incorrect"),this.changeAccMessage("actual-shape-table-footer-cell-1",1,[Number(this._$totalArea.text()),"correct"])):(this._$totalBadge.addClass("incorrect").removeClass("correct"),this.changeAccMessage("actual-shape-table-footer-cell-1",1,[Number(this._$totalArea.text()),"incorrect"]))),this.setFocus(p),this._inputBoxesToCheck=[],this._checkAll=!1,b.view.draw()}},_enableDisableCheckBtn:function(){var a,b,c,d=!0;for(b=this._$tablesContainer.find("input"),a=b.length-1;a>=0;a--)if(c=b[a].value,""!==c&&null!==c){d=!1;break}this.model.trigger(this.modelNamespace.EVENTS.DISABLE_BUTTON,this.modelNamespace.ACTION_ENUM.CHECK,d)},_removeAllInputBoxBadges:function(a){var b,c,d,e,f,g,h,i,j=this.modelNamespace.SHAPE_STROKE_COLORS,k=j.NORMAL,l=j.COPY;for(b in a)c=a[b],f=c.shapeUniqueCode,e=c.isOriginal,e?(g=k,d=this.actualShapeInputBoxes[f]):(g=l,d=this.duplicateShapeInputBoxes[f]),h=d.$el.parents(".input-box-container"),i=h.find(".input-box-badge"),h.removeClass("correct incorrect"),c.strokeColor=g;this._$totalBadge.removeClass("correct incorrect"),this._checkAll=!0,this._enableDisableCheckBtn()}})}(),function(){"use strict";MathInteractives.Common.Interactivities.ShapeDecomposition.Views.CanvasAccessibility=MathInteractives.Common.Interactivities.ShapeDecomposition.Views.ButtonClicks.extend({canvasAcc:null,prevDataItemEvent:null,prevCoordinate:null,leftPos:0,topPos:0,selectedShapeCode:null,initialize:function(){this._superwrapper("initialize",this)},loadAccessibility:function(){this._initAccessibilityForSelectShape(),this.bindAccessibilityListenersForSelectShape()},_initAccessibilityForSelectShape:function(){if(null===this.canvasAcc){var a={canvasHolderID:this.idPrefix+"left-panel-canvas-acc-container",paperItems:[],type:MathInteractives.Common.Player.Models.CanvasAcc.TYPE.NAVIGATE_LINE,paperScope:this.workCanvasScope,manager:this.manager,player:this.player};this.canvasAcc=MathInteractives.global.CanvasAcc.intializeCanvasAcc(a)}},bindAccessibilityListenersForSelectShape:function(){this.canvasAcc.updatePaperItems(this.getPaperObjectsForSelectShape());var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,c=$("#"+this.idPrefix+"left-panel-canvas-acc-container");c.off(a.TAB).on(a.TAB,$.proxy(this.tabClickForSelectShape,this)),c.off(a.SPACE).on(a.SPACE,$.proxy(this.spaceClickForSelectShape,this)),c.off(b.FOCUS_OUT).on(b.FOCUS_OUT,$.proxy(this.focusOutForSelectShape,this))},getPaperObjectsForSelectShape:function(){for(var a=[],b=0;5>b;b++)a.push(this.shapeGroup.children[b]);return a.push(this.shapeGroup.children[7]),a.push(this.shapeGroup.children[5]),a.push(this.shapeGroup.children[6]),a},spaceClickForSelectShape:function(a,b){a.target=b.item,this.onMouseDownOnDefaultShapes(a)},tabClickForSelectShape:function(a,b){this.prevDataItemEvent&&(this.onMouseLeaveOnDefaultShapes(this.prevDataItemEvent),this.prevDataItemEvent=null),a.target=b.item,this.prevDataItemEvent=a,this.onMouseEnterOnDefaultShapes(a)},focusOutForSelectShape:function(a,b){this.prevDataItemEvent&&(this.onMouseLeaveOnDefaultShapes(this.prevDataItemEvent),this.selectedShapeCode?this.changeAccMessage("left-panel-canvas-acc-container",1,[this.selectedShapeCode]):this.changeAccMessage("left-panel-canvas-acc-container",0),this.prevDataItemEvent=null,this.workCanvasScope.view.draw())},unBindAccessibilityListeners:function(){var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,c=$("#"+this.idPrefix+"left-panel-canvas-acc-container");c.off(a.TAB),c.off(a.SPACE),c.off(b.FOCUS_OUT),c.off(a.ARROW),this.prevDataItemEvent=null},bindAccessibilityListenersForShapeResize:function(){this.unBindAccessibilityListeners(),this.canvasAcc.updatePaperItems(this.getPaperObjectsForShapeResize());var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,c=$("#"+this.idPrefix+"left-panel-canvas-acc-container");c.off(a.TAB).on(a.TAB,$.proxy(this.tabClickForShapeResize,this)),c.off(b.FOCUS_OUT).on(b.FOCUS_OUT,$.proxy(this.focusOutForShapeResize,this)),c.off(a.ARROW).on(a.ARROW,$.proxy(this.arrowKeyPressedForShapeResize,this))},getPaperObjectsForShapeResize:function(){for(var a=[],b=0;b<this.handleGroup.children.length;b++)a.push(this.handleGroup.children[b]);return a},tabClickForShapeResize:function(a,b){this.prevDataItemEvent&&(this.onMouseLeaveOnHandle(this.prevDataItemEvent),this.prevDataItemEvent.point=this.prevDataItemEvent.target.position.clone(),this.onMouseUpOnHandle(this.prevDataItemEvent),this.prevDataItemEvent=null),a.target=b.item,a.point=a.target.position.clone(),this.onMouseDownOnHandle(a),this.prevDataItemEvent=a,this.onMouseEnterOnHandle(a),this.focusRect.position=a.target.position,this.focusRect.visible=!0,this.workCanvasScope.view.draw()},focusOutForShapeResize:function(a,b){this.prevDataItemEvent&&(this.onMouseLeaveOnHandle(this.prevDataItemEvent),this.prevDataItemEvent.point=this.prevDataItemEvent.target.position.clone(),this.onMouseUpOnHandle(this.prevDataItemEvent),this.prevDataItemEvent=null,this.focusRect.visible=!1,this.workCanvasScope.view.draw(),this.changeAccMessage("left-panel-canvas-acc-container",5,[this.handleGroup.children.length]))},arrowKeyPressedForShapeResize:function(a,b){a=$.extend(!0,{},this.prevDataItemEvent),a.point=a.target.position.clone(),-1===b.directionX&&(a.point.x-=24,this.changeAccMessage("left-panel-canvas-acc-container",7,[a.target.handleNumber,this.getAccMessage("left-panel-canvas-acc-container","vertexText")+" "+this.getAccMessage("left-panel-canvas-acc-container","leftText")])),1===b.directionX&&(a.point.x+=24,this.changeAccMessage("left-panel-canvas-acc-container",7,[a.target.handleNumber,this.getAccMessage("left-panel-canvas-acc-container","vertexText")+" "+this.getAccMessage("left-panel-canvas-acc-container","rightText")])),-1===b.directionY&&(a.point.y-=24,this.changeAccMessage("left-panel-canvas-acc-container",7,[a.target.handleNumber,this.getAccMessage("left-panel-canvas-acc-container","upText")])),1===b.directionY&&(a.point.y+=24,this.changeAccMessage("left-panel-canvas-acc-container",7,[a.target.handleNumber,this.getAccMessage("left-panel-canvas-acc-container","downText")])),this.onMouseDragOnHandle(a),this.focusRect.position=a.target.position,this.workCanvasScope.view.draw()},bindAccessibilityListenersForShapeMovement:function(){this.unBindAccessibilityListeners(),this.canvasAcc.updatePaperItems(this.getPaperObjectsForShapeMovement());var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,c=$("#"+this.idPrefix+"left-panel-canvas-acc-container");c.off(a.TAB).on(a.TAB,$.proxy(this.tabClickForShapeMovement,this)),c.off(a.SPACE).on(a.SPACE,$.proxy(this.spaceClickForShapeMovement,this)),c.off(b.FOCUS_OUT).on(b.FOCUS_OUT,$.proxy(this.focusOutForShapeMovement,this)),c.off(a.ARROW).on(a.ARROW,$.proxy(this.arrowKeyPressedForShapeMovement,this))},getPaperObjectsForShapeMovement:function(a){for(var b=[],c=0;c<this.canvasShapes.length;c++)b.push(this.canvasShapes[c]);return b},tabClickForShapeMovement:function(a,b){this.prevDataItemEvent&&(this.onMouseLeaveOnNewShapes(this.prevDataItemEvent,this.prevDataItemEvent.target),this.prevDataItemEvent.point=this.prevDataItemEvent.target.position.clone(),this.prevDataItemEvent=null),a.target=b.item,a.point=a.target.position.clone(),this.prevDataItemEvent=a;var c=this;this.onMouseEnterOnNewShapes(a,a.target),a.target.isOriginal?setTimeout(function(){a.target.isSelected?c.changeAccMessage("left-panel-canvas-acc-container",11,[a.target.accNumber]):c.changeAccMessage("left-panel-canvas-acc-container",10,[a.target.accNumber])},0):setTimeout(function(){a.target.isSelected?c.changeAccMessage("left-panel-canvas-acc-container",23,[a.target.accNumber]):c.changeAccMessage("left-panel-canvas-acc-container",22,[a.target.accNumber])},0)},spaceClickForShapeMovement:function(a,b){this.prevDataItemEvent&&this.deSelectNewShape(),a.target=b.item,a.point=a.target.position.clone(),this.onMouseDownOnNewShapes(a,null,a.target),a.target.isOriginal?a.target.isSelected?this.changeAccMessage("left-panel-canvas-acc-container",11,[a.target.accNumber]):this.changeAccMessage("left-panel-canvas-acc-container",10,[a.target.accNumber]):a.target.isSelected?this.changeAccMessage("left-panel-canvas-acc-container",23,[a.target.accNumber]):this.changeAccMessage("left-panel-canvas-acc-container",22,[a.target.accNumber])},focusOutForShapeMovement:function(a,b){this.prevDataItemEvent&&(this.onMouseLeaveOnNewShapes(this.prevDataItemEvent,this.prevDataItemEvent.target),this.prevDataItemEvent.point=this.prevDataItemEvent.target.position.clone(),this.prevDataItemEvent=null,this.workCanvasScope.view.draw());var c=this.getAccMessage("left-panel-canvas-acc-container","shapeText"),d=this.getAccMessage("left-panel-canvas-acc-container","isText");this.canvasShapes.length>1&&(c=this.getAccMessage("left-panel-canvas-acc-container","shapesText"),d=this.getAccMessage("left-panel-canvas-acc-container","areText")),this.changeAccMessage("left-panel-canvas-acc-container",9,[c,d])},arrowKeyPressedForShapeMovement:function(a,b){var c;a=$.extend(!0,{},this.prevDataItemEvent),a.point=a.target.position.clone(),c=a.target.position.clone(),a.event={},a.event.which=1,this.currentEvent=this.selectedShapeEvent,this.onMouseDownOnNewShapes(a,null,this.prevDataItemEvent.target),-1===b.directionX&&(c.x-=18,this.changeAccMessage("left-panel-canvas-acc-container",21,[this.getAccMessage("left-panel-canvas-acc-container","leftText")])),1===b.directionX&&(c.x+=18,this.changeAccMessage("left-panel-canvas-acc-container",21,[this.getAccMessage("left-panel-canvas-acc-container","rightText")])),-1===b.directionY&&(c.y-=24,this.changeAccMessage("left-panel-canvas-acc-container",21,[this.getAccMessage("left-panel-canvas-acc-container","upText")])),1===b.directionY&&(c.y+=24,this.changeAccMessage("left-panel-canvas-acc-container",21,[this.getAccMessage("left-panel-canvas-acc-container","downText")])),a.point=c,this.onMouseDragOnNewShapes(a,a.target),this.currentEvent=null,this.deSelectNewShape()},bindAccessibilityListenersForCutLine:function(){this.unBindAccessibilityListeners(),this.canvasAcc.updatePaperItems(this.getPaperObjectsForCutLine());var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,c=$("#"+this.idPrefix+"left-panel-canvas-acc-container");c.off(a.TAB).on(a.TAB,$.proxy(this.tabClickForCutLine,this)),c.off(b.FOCUS_OUT).on(b.FOCUS_OUT,$.proxy(this.focusOutForCutLine,this)),c.off(a.ARROW).on(a.ARROW,$.proxy(this.arrowKeyPressedForCutLine,this))},getPaperObjectsForCutLine:function(){for(var a=[],b=0;b<this.cutLineHandleGroup.children.length;b++)a.push(this.cutLineHandleGroup.children[b]);return a},tabClickForCutLine:function(a,b){this.prevDataItemEvent&&(this.onMouseLeaveOnCutLineHandle(this.prevDataItemEvent),this.prevDataItemEvent.point=this.prevDataItemEvent.target.position.clone(),this.prevDataItemEvent=null),a.target=b.item,a.point=a.target.position.clone(),this.prevDataItemEvent=a,this.onMouseEnterOnCutLineHandle(a),this.focusRect.position=a.target.position,this.focusRect.visible=!0,this.workCanvasScope.view.draw();var c=this.getAccMessage("left-panel-canvas-acc-container","firstText");"b"===a.target.handleCode&&(c=this.getAccMessage("left-panel-canvas-acc-container","secondText")),this.changeAccMessage("left-panel-canvas-acc-container",13,[c])},focusOutForCutLine:function(a,b){this.prevDataItemEvent&&(this.onMouseLeaveOnCutLineHandle(this.prevDataItemEvent),this.prevDataItemEvent.point=this.prevDataItemEvent.target.position.clone(),this.prevDataItemEvent=null,this.workCanvasScope.view.draw(),this.selectedShape?this.setFocus("rotate-button-container"):this.setFocus("left-panel-canvas-acc-container"),this.focusRect.visible=!1,this.workCanvasScope.view.draw()),this.validCutPointsObjects&&(0===this.validCutPointsObjects.length?this.enableTab("cut-line-button",!1):this.enableTab("cut-line-button",!0))},arrowKeyPressedForCutLine:function(a,b){a=$.extend(!0,{},this.prevDataItemEvent),a.point=a.target.position.clone(),-1===b.directionX&&(a.point.x-=24),1===b.directionX&&(a.point.x+=24),-1===b.directionY&&(a.point.y-=24),1===b.directionY&&(a.point.y+=24),a.data={},a.data.directionData=b,this.onMouseDragOnCutLineHandle(a,this.prevDataItemEvent.target.position.clone()),this.onMouseUpOnCutLineHandle(a),this.focusRect.position=a.target.position,this.workCanvasScope.view.draw()}},{})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ShapeDecomposition.templates=MathInteractives.Common.Interactivities.ShapeDecomposition.templates||{};b.explore=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-tab-holder" class="explore-tab-holder">\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-instruction-bar-0" class="explore-instruction-bars explore-instruction-bar-0"></div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-instruction-bar-1" class="explore-instruction-bars explore-instruction-bar-1"></div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-instruction-bar-2" class="explore-instruction-bars explore-instruction-bar-2"></div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'explore-tab-activity-holder" class="explore-tab-activity-holder">\r\n\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-panel-screen" class="right-panel-screen">\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-panel-table-container" class="right-panel-table-container">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'actual-shape-table-wrapper" class="actual-shape-table-wrapper">\r\n          <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'actual-shape-table-container" class="actual-shape-table-conatiner shape-table-conatiner">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'actual-shape-table" class="actual-shape-table shape-table"></div>\r\n          </div>\r\n          <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'actual-shape-table-footer" class="actual-shape-table-footer">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'actual-shape-table-footer-cell-2" class="footer-cell-2 footer-cells unit-cell">\r\n              <div class="unit-cell-content">\r\n                <div class="unit-text">',(g=c.unitText)?f=g.call(b,{hash:{},data:e}):(g=b&&b.unitText,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'</div>\r\n                <div class="superscript">2</div>\r\n              </div>\r\n            </div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'actual-shape-table-footer-cell-1" class="footer-cell-1 footer-cells">\r\n              <div class="total-area-box input-box-lookalike"></div>\r\n            </div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'actual-shape-table-footer-cell-0" class="footer-cell-0 footer-cells">\r\n              <div class="total-text"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'duplicate-shape-table-wrapper" class="duplicate-shape-table-wrapper">\r\n          <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'duplicate-shape-table-container" class="duplicate-shape-table-conatiner shape-table-conatiner">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'duplicate-shape-table" class="duplicate-shape-table shape-table"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-panel-button-container" class="right-panel-button-container">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'done-button-container" class="done-button-container"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'next-button-container" class="next-button-container"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'check-button-container" class="check-button-container"></div>\r\n      </div>\r\n    </div>\r\n\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'left-panel-screen" class="left-panel-screen">\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'left-panel-buttons-container" class="left-panel-buttons-container">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'cut-button-container" class="cut-button-container icon-button-common-class"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'copy-button-container" class="copy-button-container icon-button-common-class"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'reflect-button-container" class="reflect-button-container icon-button-common-class"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'rotate-button-container" class="rotate-button-container icon-button-common-class"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'undo-button-container" class="undo-button-container icon-button-common-class"></div>\r\n      </div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'left-panel-canvas-acc-container" class="left-panel-canvas-acc-container"></div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'left-panel-canvas-container" class="left-panel-canvas-container">\r\n        <canvas id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'grid-canvas" width="605" height="506" class="grid-canvas"></canvas>\r\n        <canvas id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'work-canvas" width="605" height="506" class="work-canvas"></canvas>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'cut-line-button" class="cut-line-button"></div>\r\n      </div>\r\n      <div class="temporary-tooltip-content-holder"></div>\r\n    </div>\r\n  </div>\r\n</div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ShapeDecomposition.templates=MathInteractives.Common.Interactivities.ShapeDecomposition.templates||{};b.tableRow=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-table-row-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="shape-table-row-',(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' shape-table-row">\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e
}):g),h+=j(f)+"-shape-miniature-container-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="',(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-miniature-container-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' shape-miniature-container">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-miniature-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="',(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-miniature-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' shape-miniature" style="background-image: url(\'',(g=c.imageURL)?f=g.call(b,{hash:{},data:e}):(g=b&&b.imageURL,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"'); width: ",(g=c.imageWidth)?f=g.call(b,{hash:{},data:e}):(g=b&&b.imageWidth,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"; height: ",(g=c.imageHeight)?f=g.call(b,{hash:{},data:e}):(g=b&&b.imageHeight,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"; margin: ",(g=c.margin)?f=g.call(b,{hash:{},data:e}):(g=b&&b.margin,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+';"></div>\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-input-box-cell-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="',(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-input-box-cell-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' input-box-cell">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-input-box-container-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="',(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-input-box-container-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' input-box-container">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-input-box-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="',(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-input-box-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' input-box"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-input-box-badge-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="',(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-input-box-badge-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' input-box-badge"></div>\r\n        </div>\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-unit-cell-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="',(g=c.actualOrDuplicate)?f=g.call(b,{hash:{},data:e}):(g=b&&b.actualOrDuplicate,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-shape-unit-cell-",(g=c.shapeCode)?f=g.call(b,{hash:{},data:e}):(g=b&&b.shapeCode,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+' unit-cell">\r\n        <div class="unit-text">',(g=c.unitText)?f=g.call(b,{hash:{},data:e}):(g=b&&b.unitText,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'</div>\r\n        <div class="superscript">2</div>\r\n    </div>\r\n</div>\r\n'})}();