!function(a){"use strict";"undefined"==typeof a.Common.Interactivities.ConicExplorer&&(a.Common.Interactivities.ConicExplorer={},a.Common.Interactivities.ConicExplorer.Views={},a.Common.Interactivities.ConicExplorer.Models={}),a.Common.Interactivities.ConicExplorer.Views.ConicPlotter=a.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,player:null,paperScope:null,currentTool:null,dummyTackPath1:null,dummyTackPath2:null,origin:null,pointsRange:null,areaDimension:[149,102,914,523],thumbTackPosition1:null,isFirstRun:!0,thumbTackPosition2:null,isVertical:!1,focusRect:null,fociCoordinateAfterAnimation:null,isCursorDefault:!1,initialize:function(){var b=this.model,c=this;this.idPrefix=b.get("idPrefix"),this.manager=b.get("manager"),this.filePath=b.get("filePath"),this.player=b.get("player"),this.viewStaticData=a.Common.Interactivities.ConicExplorer.Views.ConicPlotter,this.pointsRange=1800,this.isFirstRun=!0,this._renderGraph(),this.rasterPattern={},this._appendDrawingLayer(),this.hitOptions={segments:!0,stroke:!0,fill:!0,tolerance:3},this.paperScope2.activate(),this.paperScope.view.draw(),this._prepareColorStringRasters(),this.on(this.viewStaticData.CUSTOM_EVENTS.initializationDone,function(){c._setInitialAnimationPosition()}),this.thumbTackRaster=this.getSpritePartBase64URL("explore-shapes",92,54,19,39),this.focusRect=new this.paperScope2.Path.RegularPolygon(new this.paperScope2.Point(0,0),4,30),this.focusRect.style={strokeColor:"#aaaaaa",dashArray:[2,2],strokeWidth:2},this.focusRect.opacity=0,this.loadScreen("conic-shape-acc-screen")},_appendDrawingLayer:function(){this.$("canvas").css({position:"absolute",top:"0px",left:"0px"}),this.$el.find(".canvas-holder").css("position","relative").append('<canvas class = "canvas-element" style="position:absolute;" id = "'+this.idPrefix+'graph-holder-canvas-element-extended" height="599" width="928"> '),this.paperScope2=new paper.PaperScope,this.paperScope2.setup(this.idPrefix+"graph-holder-canvas-element-extended"),this.currentTool=new this.paperScope2.Tool,this.paperScope2.activate()},_resumeInitialization:function(){var a=this.model,b=null,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null;this._render(),this.paperScope.view.draw(),this.paperScope2.activate(),this._snapAll(),b=a.get("foci1"),c=a.get("foci2"),f=a.get("thumbTack1"),p=a.get("thumbTack2"),n=a.get("dummyThumbTack1"),o=a.get("dummyThumbTack2"),k=a.get("vertex1"),l=a.get("vertex2"),m=a.get("shapeCenter"),this.entireGroup=new this.paperScope2.Group,this._generateString("purple",d,b.position,f.position,!1),g=a.get("purple"),g.moveAbove(a.get("thumbTack1")),this._generateString("red",e,c.position,f.position,!1),h=a.get("red"),h.moveAbove(a.get("thumbTack1")),this._generateString("red",d,b.position,p.position,!1),i=a.get("red"),i.moveAbove(a.get("thumbTack2")),this._generateString("purple",e,c.position,p.position,!1),j=a.get("purple"),j.moveAbove(a.get("thumbTack2")),g.name="purple-line1",h.name="red-line1",i.name="purple-line2",j.name="red-line2",this.entireGroup.addChildren([b,c,f,p,n,o,k,l,m,g,h,i,j]),this._generateBar(),this.paperScope2.view.draw(),this._handleInitialAnimationStart(),this.trigger(this.viewStaticData.CUSTOM_EVENTS.initializationDone)},_setInitialAnimationPosition:function(){var a=this.model,b=a.get("thumbTack1"),c=a.get("thumbTack2"),d=a.get("foci1"),e=a.get("foci2"),f=a.get("vertex1"),g=a.get("vertex2"),h=a.get("dummyThumbTack1"),i=a.get("dummyThumbTack2"),j=a.get("shapeCenter"),k=8*a.get("gridSizeXAxis"),l=j.position.x,m=j.position.y;this.paperScope2.activate(),b.position.x=l,b.position.y=m,c.position.x=l,c.position.y=m,f.position.x=l,f.position.y=m,g.position.x=l,g.position.y=m,h.position.x=l,h.position.y=m,i.position.x=l,i.position.y=m,a.set("thumbTack1",b),a.set("thumbTack2",c),a.set("shapeCenter",j),d.position.x=l,d.position.y=m-k/2,e.position.x=l,e.position.y=m+k/2,this._snapAll(),this._redrawStringsAndUpdateGroup(),this.paperScope2.view.draw()},_renderGraph:function(){this._appendCanvas(),this._setPaperScope(),this._setCanvasStyle(),this._drawGrid()},_render:function(){this.paperScope2.activate();var a=this.model,b=null,c=null,d=a.getOriginPosition(),e=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",0,54,36,36)),f=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",46,54,36,36)),g=null,h=null,i=null,j=null,k=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",80,34,19,28)),l=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",80,34,19,28)),m=null,n=null,o=null,p=null;this.paperScope2;this._getRandomMajorAxisAndFoci(),a.set("foci1",e),a.set("foci2",f),a.set("center",d),b=a.get("majorAxis"),c=a.get("minorAxis");var q={strokeColor:"#555555",fillColor:{gradient:{stops:["#ffffff","#bcb5c5"]},origin:new this.paperScope2.Point(d.x-b-7,d.y-7),destination:new this.paperScope2.Point(d.x-b+7,d.y+7)},strokeWidth:2};g=new this.paperScope2.Path.Circle(new this.paperScope2.Point(d.x-b,d.y),7),g.style=q,h=new this.paperScope2.Path.Circle(new this.paperScope2.Point(d.x+b,d.y),7),i=q,h.style={strokeColor:"#555555",fillColor:{gradient:{stops:["#ffffff","#bcb5c5"]},origin:new this.paperScope2.Point(d.x+b-7,d.y-7),destination:new this.paperScope2.Point(d.x+b+7,d.y+7)},strokeWidth:2},g.name="vertex1",h.name="vertex2",n=g.clone(),o=h.clone(),n.opacity=0,o.opacity=0,$.support.touch?(o.bounds.width=40,o.bounds.height=40,n.bounds.width=40,n.bounds.height=40):(o.bounds.width=20,o.bounds.height=20,n.bounds.width=20,n.bounds.height=20),n.name="vertex1",o.name="vertex2",a.set("dummyVertex1",n),a.set("dummyVertex2",o),this._setInitialPosition(),a.set("vertex1",g),this._calculateMajorAxisAndMinorAxis(),b=this.model.get("majorAxis"),c=this.model.get("minorAxis"),j=this.returnHyperBolaPoints(d,b,c,this.pointsRange),this.model.set("points",j),m=new this.paperScope2.Raster(this.thumbTackRaster),p=new this.paperScope2.Raster(this.thumbTackRaster);for(var r,s,t=0;t<this.pointsRange;t++)parseInt(j.rightWing[t].y)===parseInt(d.y-200)&&(m.position=j.rightWing[t],r=t),parseInt(j.leftWing[t].y)===parseInt(d.y+200)&&(p.position=j.leftWing[t],s=t);k.position=m.position,l.position=p.position,k.opacity=0,l.opacity=0,m.name="thumbTack1",p.name="thumbTack2",k.name="thumbTack1",l.name="thumbTack2",a.set("thumbTack1",m),a.set("thumbTack2",p),a.set("dummyThumbTack1",k),a.set("dummyThumbTack2",l),a.set("vertex1",g),a.set("vertex2",h),this._drawDummyTackPath(),this.model.getShowBubbles()&&(this._setBoundsForBubbles(),this.generateBubbles(),this._setAnimateBubblesRaster()),this._addEquationHolderTemplate(),this._showHideEquation(!1)},_loadCanvasAcc:function(){this._initAccessibility(),this._bindAccessibilityListeners()},_appendCanvas:function(){var b=this.$el,c=this.el.id,d=this.model,e=d.getCanvasHeight(),f=d.getCanvasWidth(),g=a.Common.Interactivities.ConicExplorer.templates.conicExplorerGraph({idPrefix:this.idPrefix,height:e,width:f}).trim();b.html("").append(g),b.find(".canvas-holder").attr("id",c+"-canvas-holder"),b.find(".canvas-element").attr("id",c+"-canvas-element"),b.find(".canvas-tooltip").attr("id",c+"-canvas-tooltip"),b.find(".conic-graph-acc-container").attr("id",c+"-conic-graph-acc-container")},_setPaperScope:function(){var a=this.paperScope=new paper.PaperScope;a.setup(this.el.id+"-canvas-element"),a.activate()},_setCanvasStyle:function(){var a=this.$el,b=this.el.id,c=a.find("#"+b+"-canvas-holder"),d=this.model,e=d.getCanvasParentHeight(),f=d.getCanvasParentWidth();c.css({height:e,width:f})},_setInitialPosition:function(a){var b=this.model,c=b.get("foci1"),d=b.get("foci2"),e=b.get("center"),f=b.get("shapeCenter"),g=b.get("foci"),h=b.get("dummyShapeCenter");a?(c.position.y=e.y-g,c.position.x=e.x,d.position.y=e.y+g,d.position.x=e.x):(c.position.x=e.x-g,c.position.y=e.y,d.position.x=e.x+g,d.position.y=e.y),f=this.rasterPattern.arrowCenter,f.position=e,f.opacity=1,h=f.clone(),h.name="shape-center",h.opacity=0,$.support.touch&&(h.bounds.height=30,h.bounds.width=30),f.name="shape-center",c.name="foci1",d.name="foci2",b.set("foci1",c),b.set("foci2",d),b.set("shapeCenter",f),b.set("dummyShapeCenter",h)},_handleInitialAnimationStart:function(){this.isAnimating=!0,this.player.enableAllHeaderButtons(!1);var a=this.$("#"+this.idPrefix+"graph-holder-canvas-element-extended");a.css({cursor:"default"})},_drawGrid:function(){this._drawCenterPostionGrid()},_drawCenterPostionGrid:function(){var a=this.model,b=this.paperScope,c=a.getCanvasHeight(),d=a.getCanvasWidth(),e=a.getGridSizeXAxis(),f=a.getGridSizeYAxis(),g=a.getXAxisLength(),h=a.getYAxisLength(),i=a.getOriginPosition(),j=(d-g)/2,k=(c-h)/2,l=j+g,m=k+h,n=null,o=null,p=0,q=0,r=null,s=null,t=[2,1],u=i.x,v=i.y,w=a.getXAxisColor(),x=a.getYAxisColor(),y=a.getXAxisGridColor(),z=a.getYAxisGridColor(),A=a.isToggleGridColor(),B=a.getSecondXAxisGridColor(),C=a.getSecondYAxisGridColor();for(this.origin=i,s=y,p=v+f,q=v-f;m>p||q>k;)A===!0?(A=!1,s=y,t=[3,1]):A===!1&&(A=!0,s=B,t=[4,1]),m>p&&(r=new b.Path({segments:[[j,p],[l,p]],strokeColor:s,strokeWidth:1}),r.dashArray=t),q>k&&(r=new b.Path({segments:[[j,q],[l,q]],strokeColor:s,strokeWidth:1}),r.dashArray=t),p+=f,q-=f;for(p=u+e,q=u-e,A=a.isToggleGridColor(),s=z;l>p||q>j;)A===!0?(A=!1,s=z,t=[3,1]):A===!1&&(A=!0,s=C,t=[4,1]),l>p&&(r=new b.Path({segments:[[p,k],[p,m]],strokeColor:s,strokeWidth:1}),r.dashArray=t),q>j&&(r=new b.Path.Line({segments:[[q,k],[q,m]],strokeColor:s,strokeWidth:1}),r.dashArray=t),p+=e,q-=e,n=new b.Path({segments:[[j,v],[l,v]],strokeColor:w,strokeWidth:1}),o=new b.Path({segments:[[u,k],[u,m]],strokeColor:x,strokeWidth:.2})},generateBubbles:function(){this.paperScope2.activate(),this.isAnimating=!0;var a=this.model,b=this.viewStaticData,c=b.RADIUS_OF_BUBBLES,d=[],e=null,f=a.get("generateNewBubbles"),g=this.paperScope2,h=!1,i=a.get("largeBubbleGroup"),j=null,k=new g.Group,l=null,m=null,n=null,o=null,p=a.get("populateBubble"),q=null;if(this._showHideEquation(!1),e=c.largeBubbleRadius,null!==i&&(h=!0,a.set("intersectBubblesArray",null),this._clearBubbles(),a.set("largeBubbleGroup",null),a.set("middleBubbleGroup",null),a.set("smallBubbleGroup",null),a.set("dummyBubblePath",[])),f){for(o=a.setPositionsOfBubbles(),q=o.length,m=Math.floor(q/3),d=[],n=0;m>n;n++)l=a.generateRandomNumber(0,o.length-2),d.push(o[l]),o.splice(l,1);a.set("currentLargeBubblesPosition",d)}else d=a.get("currentLargeBubblesPosition");if(j=this._drawBubble(this.rasterPattern.largeBubble,d,e),k.addChild(j),a.set("largeBubbleGroup",j),e=c.middleBubbleRadius,f){for(d=[],n=0;m>n;n++)l=a.generateRandomNumber(0,o.length-2),d.push(o[l]),o.splice(l,1);a.set("currentMiddleBubblesPosition",d)}else d=a.get("currentMiddleBubblesPosition");j=this._drawBubble(this.rasterPattern.middleBubble,d,e),k.addChild(j),a.set("middleBubbleGroup",j),e=c.smallBubbleRadius,f?(d=o,a.set("currentSmallBubblesPosition",d)):d=a.get("currentSmallBubblesPosition"),j=this._drawBubble(this.rasterPattern.smallBubble,d,e,!0),a.set("smallBubbleGroup",j),k.addChild(j),a.set("allBubbleGroup",k),a.get("allBubbleGroup").sendToBack(),p&&(this._unbindEvents(),this.populateBubble())},_clearBubbles:function(){var a=this.model,b=a.get("allBubbleGroup");b.remove(),a.set("allBubbleGroup",null)},_drawBubble:function(a,b,c,d){var e=this.viewStaticData,f=this.paperScope2,g=null,h=null,i=null,j=null,k=(this.model.get("populateBubble"),null),l=e.RADIUS_OF_BUBBLES,m=l.largeBubbleRadius,n=l.smallBubbleRadius,o=(l.middleBubbleRadius,new f.Group),p=null,q=b.length;for(c=c||m,k=a,i=0;q>i;i++)g=b[i][0],h=b[i][1],p=c===m?new f.Path.Circle({radius:c,center:[g-5,h-5]}):c===n?new f.Path.Circle({radius:c,center:[g-3,h-3]}):new f.Path.Circle({radius:c,center:[g-2,h-2]}),j=k.clone(),j.opacity=1,j.position=[g,h],o.addChild(new f.Group(p,j));return o},populateBubble:function(){var a=this.model,b=this,c=null,d=null,e=a.get("allBubbleGroup"),f=null,g=!0,h=this.paperScope2,i=h.view,j=e.children.length,k=!0,l=!0,m=!0,n=!0,o=!0,p=e.children[2],q=p.children[0].children[1].bounds,r=q.width,s=e.children[1],t=s.children[0].children[1].bounds,u=t.width,v=e.children[0],w=v.children[0].children[1].bounds,x=w.width;for(d=0;j>d;d++)for(f=e.children[d].children.length,c=0;f>c;c++)e.children[d].children[c].children[1].scale(.3);var y=setInterval(function(){if(p.children[0].children[1].bounds.width<=r&&g)for(d=0;d<p.children.length;d++)p.children[d].children[1].scale(1.12);else if(g=!1,p.children[0].children[1].bounds.width>=4*r/10&&k)for(d=0;d<p.children.length;d++)p.children[d].children[1].scale(.88);else g=!0,k=!1;if(v.children[0].children[1].bounds.width<=x&&n)for(d=0;d<v.children.length;d++)v.children[d].children[1].scale(1.1);else if(n=!1,v.children[0].children[1].bounds.width>=6*x/10&&o)for(d=0;d<v.children.length;d++)v.children[d].children[1].scale(.9);else n=!0,o=!1;if(s.children[0].children[1].bounds.width<=u&&l)for(d=0;d<s.children.length;d++)s.children[d].children[1].scale(1.09);else if(l=!1,m||(a.set("populateBubble",!1),a.set("generateNewBubbles",!1),b.generateBubbles(),b.player.enableAllHeaderButtons(!0),b._initialAniamtion(),clearInterval(y)),s.children[0].children[1].bounds.width>=6*u/10&&m)for(d=0;d<s.children.length;d++)s.children[d].children[1].scale(.91);else l=!0,m=!1;i.draw()},30)},_initialAniamtion:function(){var a=this.model,b=null;return this.isFirstRun?(this._snapAll(),this._handleInitialAnimationStart(),this.fociCoordinateAfterAnimation=a.generateRandomNumber(this.viewStaticData.INITIAL_FOCI_MIN_LIMIT,this.viewStaticData.INITIAL_FOCI_MAX_LIMIT),b=(this.fociCoordinateAfterAnimation+this.viewStaticData.INITIAL_Y_START_COORDINATE)*a.get("gridSizeXAxis")/this.viewStaticData.ANIMATION_SPEED_FACTOR,void this._initialFociAnimation(b)):(this.trigger(this.viewStaticData.CUSTOM_EVENTS.bubblePopulationAnimationEnd),this._handleInitialAnimationEnd(),!1)},_initialFociAnimation:function(a){var b=this.model,c=b.get("foci1"),d=b.get("foci2"),e=this,f=e.viewStaticData.ANIMATION_SPEED_FACTOR,g=null,h=!0,i=null;i=setInterval(function(){e.paperScope2.activate(),h&&c.position.x===d.position.x?(c.position.y+=f,d.position.y-=f):(c.position.x-=f,d.position.x+=f),e._redrawStringsAndUpdateGroup(),c.position.x===d.position.x&&c.position.y===d.position.y&&(h=!1),0>=a&&(e.model.set("showGraph",!0),e._snapAll(),clearInterval(i),g=b.generateRandomNumber(e.viewStaticData.INITIAL_VERTEX_MIN_LIMIT,e.fociCoordinateAfterAnimation-1),e._initialVertexAnimation(g*b.get("gridSizeXAxis")/f)),a--,e.paperScope2.view.draw()},1)},_initialVertexAnimation:function(a){var b=this.model,c=b.get("thumbTack1"),d=b.get("thumbTack2"),e=b.get("vertex1"),f=b.get("vertex2"),g=this,h=g.viewStaticData.ANIMATION_SPEED_FACTOR,i=b.get("dummyVertex1"),j=b.get("dummyVertex2"),k=setInterval(function(){g.paperScope2.activate(),e.position.x-=h,f.position.x+=h,c.position.x=e.position.x,d.position.x=f.position.x,g._redrawStringsAndUpdateGroup(),0>=a&&(g.model.set("showGraph",!0),g._snapAll(),clearInterval(k),g._initialThumbTackAnimation(b.generateRandomNumber(g.viewStaticData.INITIAL_THUMBTACK_MIN_LIMIT/h,g.viewStaticData.INITIAL_THUMBTACK_MAX_LIMIT/h)),i.position=e.position,j.position=f.position),a--,g.paperScope2.view.draw()},1)},_initialThumbTackAnimation:function(a){var b,c,d,e,f,g,h,i,j,k,l=this.model,m=l.get("thumbTack1"),n=l.get("thumbTack2"),o=l.get("dummyThumbTack2"),p=l.get("dummyThumbTack1"),q=null,r=null,s=null,t=null,u=null,v=null,w=this,x=w.viewStaticData.ANIMATION_SPEED_FACTOR,y=!0,z=l.get("shapeCenter");this._calculateMajorAxisAndMinorAxis(),c=this.model.get("majorAxis"),d=this.model.get("minorAxis"),e=w.returnHyperBolaPoints(z.position,c,d,w.pointsRange),l.set("points",e),f=e.rightWing,g=e.leftWing,h=w._getNearestPoint(m.position,f,m),i=w._getNearestPoint(n.position,g,n),j=f.indexOf(h),k=g.indexOf(i),u=g[k],v=f[j],this.paperScope2.activate(),b=setInterval(function(){w.paperScope2.activate(),m.position.y=f[j].y,m.position.x=f[j].x,n.position.y=g[k].y,n.position.x=g[k].x,w._redrawStringsAndUpdateGroup(),0>=a&&(l.set("thumbTack1",m),l.set("thumbTack2",n),clearInterval(b),w._snapAll(),w._redrawStringsAndUpdateGroup(),w.trigger(w.viewStaticData.CUSTOM_EVENTS.bubblePopulationAnimationEnd),w._handleInitialAnimationEnd(),p.position=m.position,o.position=n.position,l.set("dummyThumbTack2",o),l.set("dummyThumbTack1",p)),s=u.subtract(g[k]).angle,t=v.subtract(f[j]).angle,(q||r)&&(m.rotate(t-r),n.rotate(s-q),y&&(m.rotate(180),y=!1)),u=g[k],v=f[j],q=s,r=t,a--,j-=x,k+=x,w.paperScope2.view.draw()},1)},_handleInitialAnimationEnd:function(){this.isFirstRun=!1,this.player.enableAllHeaderButtons(!0),this._bindEvents(),$.support.touch||setTimeout($.proxy(this._simplifyPaths,this),200)},_getInterSectingBubbles:function(){var a=this.model,b=null,c=[],d=0,e=0,f=null,g=null,h=[],i=a.get("allBubbleGroup");for(d=0;d<i.children.length;d++)for(f=i.children[d],e=0;e<f.children.length;e++)g=f.children[e].children[0],g.bringToFront(),b=g.getIntersections(this.dummyLeftPath),b.length>0&&-1===c.indexOf(g)&&(c.push(g),h.push(g)),b=g.getIntersections(this.dummyRightPath),b.length>0&&-1===c.indexOf(g)&&(c.push(g),h.push(g));if(a.get("showPoppedBubbles"))for(d=0;d<h.length;d++)h[d].parent.remove();a.set("intersectBubblesArray",c),a.set("noOfBubblesToPop",c.length)},_setBoundsForBubbles:function(){var a=this.model,b=a.getStartPointBubble(),c=a.getEndPointBubble(),d=b.xCoordinate,e=b.yCoordinate,f=c.xCoordinate,g=c.yCoordinate,h=15,i={};this.minXBubbleBound=d+h,this.minYBubbleBound=e+h,this.maxXBubblebound=f-h,this.maxYBubbleBound=g-h,i.x=(f-d)/2+d,i.y=(g-e)/2+e,this.bubblesBoundsCenter=i,a.set("bubblesBoundsCenter",i)},_setAnimateBubblesRaster:function(){var a=[];a.push(this.rasterPattern.animateMiddleBubble1),a.push(this.rasterPattern.animateMiddleBubble2),a.push(this.rasterPattern.animateMiddleBubble3),this.middleAnimateBubblesRasters=a,a=[],a.push(this.rasterPattern.animateSmallBubble1),a.push(this.rasterPattern.animateSmallBubble2),a.push(this.rasterPattern.animateSmallBubble3),this.smallAnimateBubblesRasters=a,a=[],a.push(this.rasterPattern.animateLargeBubble1),a.push(this.rasterPattern.animateLargeBubble2),a.push(this.rasterPattern.animateLargeBubble3),this.largeAnimateBubblesRasters=a},_drawDummyTackPath:function(){var a=this.model.get("thumbTack1"),b=this.model.get("thumbTack2"),c=a.position,d=b.position,e=this.dummyTackPath1,f=this.dummyTackPath2,g=this.paperScope2;null!==e&&e.remove(),null!==f&&f.remove(),this.dummyTackPath1=new g.Path.Rectangle({from:[c.x-13,c.y-11],to:[c.x+1,c.y+9]}),this.dummyTackPath2=new g.Path.Rectangle({from:[d.x-13,d.y-11],to:[d.x+1,d.y+9]})},_setTackPosition:function(a,b){var c=this.model.get("thumbTack1"),d=this.model.get("thumbTack2"),e=a||c.position,f=b||d.position;this.dummyTackPath1.position=[e.x-6,e.y],this.dummyTackPath1.sendToBack(),this.dummyTackPath2.position=[f.x-6,f.y],this.dummyTackPath2.sendToBack()},_popOutInterSectingBubbles:function(){var a=this.model,b=a.get("intersectBubblesArray")||[],c=null,d=null,e=this.viewStaticData.RADIUS_OF_BUBBLES,f=null,g=[],h=null;for(f in b)d=b[f],(d.getIntersections(this.dummyTackPath1).length>0||d.getIntersections(this.dummyTackPath2).length>0)&&(c=this._getBubbleRadius(d),g=c===e.largeBubbleRadius?this.largeAnimateBubblesRasters:c===e.middleBubbleRadius?this.middleAnimateBubblesRasters:this.smallAnimateBubblesRasters,b.splice(f,1),a.set("intersectBubblesArray",b),this.intersectBubblesArray=b,h=d.position,this._popBubble(h,g,d.parent.children[0]))},_popBubble:function(a,b,c){var d=this,e=null,f=!0,g=!0,h=c.bounds.width;$.support.touch?(setTimeout(function(){c.scale(.8)},1),setTimeout(function(){c.scale(1.2)},150),setTimeout(function(){c.scale(.8)},250),setTimeout(function(){c.parent.remove()},400)):e=setInterval(function(){c.bounds.width>8*h/10&&g?c.scale(.8):(g=!1,f||(c.parent.remove(),clearInterval(e)),c.bounds.width<h&&f?c.scale(1.2):(f=!1,g=!0)),d.paperScope2.view.draw()},30),this.trigger(this.viewStaticData.CUSTOM_EVENTS.bubblePopAnimationStart)},_getBubbleRadius:function(a){return a.bounds.height/2},_prepareColorStringRasters:function(){for(var a,b,c=["red","purple","Barpurple","Barred","black","largeBubble","smallBubble","middleBubble","animateLargeBubble1","animateLargeBubble2","animateLargeBubble3","animateSmallBubble1","animateSmallBubble2","animateSmallBubble3","animateMiddleBubble1","animateMiddleBubble2","animateMiddleBubble3","arrowCenter"],d=c.length,e=d,f=this,g=0;d>g;g++){var h=c[g];a=this.getImageURLFromSprite(h),null!==a?(b=new this.paperScope2.Raster(a),b.onLoad=function(){e--,0===e&&f._resumeInitialization()},this.rasterPattern[h]=b,this.rasterPattern[h].opacity=0):(e--,0===e&&f._resumeInitialization())}},getImageURLFromSprite:function(a){switch(a){case"red":return this.getSpritePartBase64URL("hyperbola-images",0,15,1100,5);case"purple":return this.getSpritePartBase64URL("hyperbola-images",0,0,1100,5);case"Barpurple":return this.getSpritePartBase64URL("hyperbola-images",0,30,1500,10);case"Barred":return this.getSpritePartBase64URL("hyperbola-images",0,50,1856,10);case"black":return this.getSpritePartBase64URL("circle-explorer",0,0,1100,5);case"largeBubble":return this.getSpritePartBase64URL("explore-shapes",0,0,44,44);case"smallBubble":return this.getSpritePartBase64URL("explore-shapes",96,0,24,24);case"middleBubble":return this.getSpritePartBase64URL("explore-shapes",54,0,32,32);case"animateLargeBubble1":return this.getSpritePartBase64URL("explore-shapes",130,0,44,44);case"animateLargeBubble2":return this.getSpritePartBase64URL("explore-shapes",184,0,44,44);case"animateLargeBubble3":return this.getSpritePartBase64URL("explore-shapes",238,0,44,44);case"animateSmallBubble1":return this.getSpritePartBase64URL("explore-shapes",130,96,24,24);case"animateSmallBubble2":return this.getSpritePartBase64URL("explore-shapes",164,96,24,24);case"animateSmallBubble3":return this.getSpritePartBase64URL("explore-shapes",198,96,24,24);case"animateMiddleBubble1":return this.getSpritePartBase64URL("explore-shapes",130,54,32,32);case"animateMiddleBubble2":return this.getSpritePartBase64URL("explore-shapes",172,54,32,32);case"animateMiddleBubble3":return this.getSpritePartBase64URL("explore-shapes",214,54,32,32);case"arrowCenter":return this.getSpritePartBase64URL("explore-shapes",232,96,21,21);default:return null}},_getRandomMajorAxisAndFoci:function(){var a=this.model,b=Math.floor(3*Math.random()+3),c=null,d=Math.floor(3*Math.random()+4);b===d&&b--,b>d&&(b-=2),b*=a.getGridSizeXAxis(),d*=a.getGridSizeXAxis(),c=Math.sqrt(d*d-b*b)*a.getGridSizeXAxis(),a.set("majorAxis",b),a.set("foci",d),a.set("minorAxis",c)},_calculateMajorAxisAndMinorAxis:function(){var a=this.model,b=a.get("shapeCenter"),c=a.get("foci1"),d=a.get("vertex1"),e=null,f=null,g=null;f=this._getDistanceBetweenPoints(b,d),e=this._getDistanceBetweenPoints(b,c),g=Math.sqrt(e*e-f*f),a.set("majorAxis",f),a.set("minorAxis",g)},returnHyperBolaPoints:function(a,b,c,d){var e=this.paperScope2,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null;this.rightPath&&(this.rightPath.remove(),this.leftPath.remove(),this.dummyRightPath.remove(),this.dummyLeftPath.remove(),this.dummyRightPathArray=[],this.dummyLeftPathArray=[]),this.rightPath=new e.Path,this.rightPath.dashArray=[7,8],this.rightPath.strokeWidth=2,this.leftPath=new e.Path,this.leftPath.dashArray=[7,8],this.leftPath.strokeWidth=2,this.dummyRightPath=new e.Path,this.dummyLeftPath=new e.Path;var p=[],q=[],r=c*c,s=b*b;this.dummyRightPathArray=[],this.dummyLeftPathArray=[],0===c?(j=c,k=s,l=this.isVertical?this.returnHyperBolaPointsHelper1:this.returnHyperBolaPointsHelper2):(j=b,k=r,l=this.isVertical?this.returnHyperBolaPointsHelper3:this.returnHyperBolaPointsHelper4);for(var t=-d/2;d/2>t;t++)m=l(a,j,t,k),f=m.rightX,g=m.rightY,h=m.leftX,i=m.leftY,n=new this.paperScope2.Point(f,g),o=new this.paperScope2.Point(h,i),p.push(n),this.rightPath.add(n),q.push(o),this.leftPath.add(o),this._checkCurrentPointBounds(f,g)&&(this.dummyRightPath.add(n),this.dummyRightPathArray.push(n)),this._checkCurrentPointBounds(h,i)&&(this.dummyLeftPath.add(o),this.dummyLeftPathArray.push(o));return this.rightPath.sendToBack(),this.leftPath.sendToBack(),e.view.draw(),{rightWing:p,leftWing:q}},returnHyperBolaPointsHelper1:function(a,b,c,d){var e=b*Math.sqrt(1+c*c/d),f=e,g=c,h=f+a.x,i=g+a.y,j=-f+a.x,k=i;return{rightX:h,rightY:i,leftX:j,leftY:k}},returnHyperBolaPointsHelper2:function(a,b,c,d){var e=b*Math.sqrt(1+c*c/d),f=c,g=e,h=f+a.x,i=g+a.y,j=h,k=-g+a.y;return{rightX:h,rightY:i,leftX:j,leftY:k}},returnHyperBolaPointsHelper3:function(a,b,c,d){var e=b*Math.sqrt(1+c*c/d),f=c,g=e,h=f+a.x,i=g+a.y,j=h,k=-g+a.y;return{rightX:h,rightY:i,leftX:j,leftY:k}},returnHyperBolaPointsHelper4:function(a,b,c,d){var e=b*Math.sqrt(1+c*c/d),f=e,g=c,h=f+a.x,i=g+a.y,j=-f+a.x,k=i;return{rightX:h,rightY:i,leftX:j,leftY:k}},_returnCorrespondingPoint:function(a,b,c,d){var e=this.model.get("shapeCenter").position,f=this.commonFunction(e,a,b,c),g=null,h=null;return d?(g=f.rightX,h=f.rightY):(g=f.leftX,h=f.leftY),new this.paperScope2.Point(g,h)},_simplifyPaths:function(){this.rightPath.simplify(),this.leftPath.simplify()},_setSnappedpoints:function(a){var b=this.model,c=a.point.x,d=a.point.y,e=b.get("originPosition"),f=e.x,g=e.y,h=null,i=null,j=null,k=null,l=b.getGridSizeXAxis(),m=b.getGridSizeYAxis(),n=b.getXUnitsPerGrid(),o=b.getYUnitsPerGrid(),p=null;p=c-f,h=Math.round(Math.abs(p)/l)*n,j=f+h*l,f>c&&(j=f-h*l,h=-h),p=d-g,i=Math.round(Math.abs(p)/m)*o,k=g-i*m,d>g&&(k=g+i*m,i=-i),this.snappedX=h,this.snappedY=i,this.actualSnappedPointX=j,this.actualSnappedPointY=k,b.set("snappedX",h),b.set("snappedY",h),b.set("actualSnappedPointX",j),b.set("actualSnappedPointY",k)},_snapAll:function(){this.paperScope2.activate();var a=this.model,b=a.get("foci1"),c=a.get("foci2"),d={},e=a.get("vertex1"),f=a.get("vertex2"),g=a.get("dummyVertex2"),h=a.get("dummyVertex1");d.point=b.position,this._setSnappedpoints(d),b.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},d.point=c.position,this._setSnappedpoints(d),c.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},d.point=e.position,this._setSnappedpoints(d),e.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},d.point=f.position,this._setSnappedpoints(d),f.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},g.position=f.position,h.position=e.position,a.set("foci1",b),a.set("foci2",c),a.set("vertex1",e),a.set("vertex2",f),a.set("dummyVertex1",h),a.set("dummyVertex2",g),this.paperScope2.view.draw()},_generateString:function(a,b,c,d,e){var f,g,h=this._getStringAngle(c,d),i=[{raster:b,startingPoint:c,endingPoint:d,width:5,height:5,angle:h,isRatioBar:e,lineColor:a}];"purple"==a?(f=this._drawLine(i),this.model.set("purple",f)):"red"==a&&(g=this._drawLine(i),this.model.set("red",g))},_getStringAngle:function(a,b){var c=b.subtract(a);return c.angle},renderImagePattern:function(a,b,c,d){if("undefined"==typeof this.rasterPattern[c]){var e=this.getImageURLFromSprite(c);this.rasterPattern[c]=new this.paperScope2.Raster(e),this.rasterPattern[c].opacity=0}var f=new this.paperScope2.Path({strokeColor:"red"}),g={x:a.x,y:a.y+d},h={x:b.x,y:b.y+d},i=this.rasterPattern[c].clone();f.add(a),f.add(b),f.add(h),f.add(g),f.closed=!0,i.opacity=1,i.position=a,i.position.y=a.y+d/2,i.position.x=a.x+this.viewStaticData.ADD_X_POSITION[c];var j=new this.paperScope2.Group([f,i]);return j.clipped=!0,j.position=i.position,j.position.y-=d/2,j},_drawLine:function(a){var b,c,d,e,f,g=this.paperScope2,h=0,i=a[0].startingPoint.x,j=a[0].startingPoint.y,k=a[0].startingPoint.subtract(a[0].endingPoint),l=a[0].height,m=null,n=a[0].isRatioBar,o=Math.floor(k.length);if(n===!0){h=i+o,m=this.renderImagePattern({x:i,y:j},{x:h,y:j},"Bar"+a[0].lineColor,10);var p,q,r,s,t=null;b=a[0].ratioBar1Height,c=a[0].ratioBar2Height,d=a[0].ratioBar1Width,e=a[0].ratioBar2Width,a[0].isRatioBar1===!0?(t=new this.paperScope2.Group,f=(b-l)/2+l/2,p=new g.Point(i-d,j-f),q=new g.Point(i-d,j-f+b),r=new g.Path.Line(p,q),r.strokeColor="black",r.strokeWidth=d,t.addChild(r),t.moveAbove(m),m=new this.paperScope2.Group([m,t])):(t=new this.paperScope2.Group,f=(c-l)/2+l/2,p=new g.Point(i,j-f),q=new g.Point(i,j-f+c),s=new g.Path.Line(p,q),s.strokeColor="black",s.strokeWidth=d,t.addChild(s),t.moveAbove(m),m=new this.paperScope2.Group([m,t])),a[0].isRatioBar2===!0&&(t=new this.paperScope2.Group,f=(c-l)/2+l/2,p=new g.Point(h,j-f),q=new g.Point(h,j-f+c),s=new g.Path.Line(p,q),s.strokeColor="black",s.strokeWidth=e,t.addChild(s),t.moveAbove(m),m=new this.paperScope2.Group([m,t]))}else m=this.renderImagePattern({x:i,y:j},{x:i+o,y:j},a[0].lineColor,6);return m.rotate(a[0].angle,new g.Point(i,j)),m},_bindEvents:function(){if(null!==this.entireGroup&&"undefined"!=typeof this.entireGroup){var b=this,c=b.$("#"+b.idPrefix+"graph-holder-canvas-element-extended");this.entireGroup.onMouseDown=function(d){if(1===d.event.which||$.support.touch){if(!d.target.name)return;if(b.model.get("draggingDisabled")&&"thumbTack1"!==d.target.name&&"thumbTack2"!==d.target.name)return;b.entireGroup.currentItem=d.target.name,a.global.SpeechStream.stopReading(),$.support.touch||c.css({cursor:"url('"+b.filePath.getImagePath("closed-hand")+"'), move"})}},this.entireGroup.onMouseUp=function(d){if(1===d.event.which){if(!d.target.name)return;if(b.model.get("draggingDisabled")&&"thumbTack1"!==d.target.name&&"thumbTack2"!==d.target.name)return;b._fixOverlappingElements(),a.global.SpeechStream.stopReading(),b.isElementDragging=!1,$.support.touch||c.css({cursor:"url('"+b.filePath.getImagePath("open-hand")+"'), move"}),b.isCursorDefault=!0}},this.currentTool.onMouseDrag=function(a){(1===a.event.which||$.support.touch)&&b.entireGroup.currentItem&&b.dragHandler(a)},this.currentTool.onMouseUp=function(a){(1===a.event.which||$.support.touch)&&($.support.touch||b.isCursorDefault===!0||c.css({cursor:"default"}),b.isCursorDefault!==!0||$.support.touch||(b.isCursorDefault=!1),b.entireGroup.currentItem&&(b._setSnappedpointsOnMouseUp(a),"thumbTack1"!==b.entireGroup.currentItem&&"thumbTack2"!==b.entireGroup.currentItem&&setTimeout($.proxy(b._simplifyPaths,b),200)),b.entireGroup.currentItem=null,b.isElementDragging=!1)},$.support.touch||(this.entireGroup.onMouseEnter=function(a){a.target.name&&(b.model.get("draggingDisabled")&&"thumbTack1"!==a.target.name&&"thumbTack2"!==a.target.name||$.support.touch||b.isElementDragging===!0||c.css({cursor:"url('"+b.filePath.getImagePath("open-hand")+"'), move"}))},this.entireGroup.onMouseDrag=function(c){if(1===c.event.which){if(!c.target.name)return;if(b.model.get("draggingDisabled")&&"thumbTack1"!==c.target.name&&"thumbTack2"!==c.target.name)return;a.global.SpeechStream.stopReading(),b.isElementDragging=!0}},this.entireGroup.onMouseLeave=function(a){a.target.name&&(b.model.get("draggingDisabled")&&"thumbTack1"!==a.target.name&&"thumbTack2"!==a.target.name||b.isElementDragging!==!0&&c.css({cursor:"default"}))})}},_unbindEvents:function(){null!==this.entireGroup&&"undefined"!=typeof this.entireGroup&&($.support.touch||(this.entireGroup.detach("mouseenter"),this.entireGroup.detach("mousedrag"),this.entireGroup.detach("mouseleave")),this.entireGroup.detach("mouseup"),this.entireGroup.detach("mousedown"),this.currentTool.detach("mousedrag"),this.currentTool.detach("mouseup"))},_setSnappedpointsOnMouseUp:function(a){if("thumbTack1"!==this.entireGroup.currentItem&&"thumbTack2"!==this.entireGroup.currentItem){var b=this.model,c=b.get("vertex1"),d=b.get("vertex2"),e=b.get("foci1"),f=b.get("foci2"),g=null,h=null,i=b.get("thumbTack1"),j=b.get("thumbTack2"),k=b.get("shapeCenter"),l=b.get("dummyVertex1"),m=b.get("dummyVertex2"),n=b.get("dummyShapeCenter"),o={};"shape-center"===this.entireGroup.currentItem?(o.point=k.position,this._setSnappedpoints(o),k.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},n.position=k.position,this.model.set("shapeCenter",k),this.model.set("center",k.position),
this.model.set("dummyShapeCenter",n),g=o.point.x-this.model.get("actualSnappedPointX"),h=o.point.y-this.model.get("actualSnappedPointY"),i.position.x=i.position.x-g,i.position.y=i.position.y-h,j.position.x=j.position.x-g,j.position.y=j.position.y-h,this._snapAll(),this._calculateMinorAxisAndUpdateHyperbolaPoints(!0,!0)):"vertex1"===this.entireGroup.currentItem||"vertex2"===this.entireGroup.currentItem?(o.point=c.position,this._setSnappedpoints(o),c.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},o.point=d.position,this._setSnappedpoints(o),d.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},l.position=c.position,m.position=d.position,this.model.set("vertex1",c),this.model.set("vertex2",d),this.model.set("dummyVertex1",l),this.model.set("dummyVertex2",m),this._calculateMinorAxisAndUpdateHyperbolaPoints(!0)):("foci1"===this.entireGroup.currentItem||"foci2"===this.entireGroup.currentItem)&&(o.point=e.position,this._setSnappedpoints(o),e.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},o.point=f.position,this._setSnappedpoints(o),f.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},this.model.set("foci1",e),this.model.set("foci2",f),this._calculateMinorAxisAndUpdateHyperbolaPoints(!0))}},downHandler:function(a){},dragHandler:function(a){var b=this.entireGroup.currentItem,c=this.model,d=c.get("thumbTack1"),e=c.get("thumbTack2");if(this.model.set("showPopupOnTryAnother",!0),"thumbTack1"===b||"thumbTack2"===b)return"thumbTack1"===b?this._checkCurrentPointBounds(d.position.x,d.position.y)&&this.adjustThumbTackPosition(a):this._checkCurrentPointBounds(e.position.x,e.position.y)&&this.adjustThumbTackPosition(a),void("thumbTack1"===b?this.focusRect.position=c.get("thumbTack1").position:this.focusRect.position=c.get("thumbTack2").position);if(!this.model.get("draggingDisabled")){a.point=this.adjustCurrentPointBounds(a.point);var f=a.point.x,g=a.point.y;if(this._checkCurrentPointBounds(f,g)){switch(b){case"foci1":case"foci2":this.adjustFociPosition(a),"foci1"===b?this.focusRect.position=c.get("foci1").position:this.focusRect.position=c.get("foci2").position;break;case"vertex1":case"vertex2":this.adjustVertexPosition(a),"vertex1"===b?this.focusRect.position=c.get("vertex1").position:this.focusRect.position=c.get("vertex2").position;break;case"shape-center":this.adjustEntireGroupPosition(a),this.focusRect.position=c.get("shapeCenter").position}this.firstRotate=!1}}},_checkCurrentPointBounds:function(a,b){return a>=this.areaDimension[0]&&a<=this.areaDimension[2]&&b>=this.areaDimension[1]&&b<=this.areaDimension[3]?!0:!1},adjustCurrentPointBounds:function(a){var b=a.x,c=a.y,d=!1;return b<this.areaDimension[0]?(a.x=this.areaDimension[0],d=!0):b>this.areaDimension[2]&&(a.x=this.areaDimension[2],d=!0),c<this.areaDimension[1]?(a.y=this.areaDimension[1],d=!0):c>this.areaDimension[3]&&(a.y=this.areaDimension[3],d=!0),d===!0?this.model.set("fociOutOfBounds",!0):this.model.set("fociOutOfBounds",!1),a},adjustEntireGroupPosition:function(a){var b=this.model,c=b.get("shapeCenter"),d=b.get("foci1"),e=b.get("foci2"),f=null,g=null,h=0,i=0,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=!1,r=null;if(this._setSnappedpoints(a),f=a.point.x-c.position.x,g=a.point.y-c.position.y,n=d.position.x+f,o=d.position.y+g,p=e.position.x+f,r=e.position.y+g,n<this.areaDimension[0]||n>this.areaDimension[2]||o<this.areaDimension[1]||o>this.areaDimension[3]?(n<this.areaDimension[0]?(h=this.areaDimension[0]-n,q=!0):n>this.areaDimension[2]&&(h=this.areaDimension[2]-n,q=!0),o<this.areaDimension[1]?(i=this.areaDimension[1]-o,q=!0):o>this.areaDimension[3]&&(i=this.areaDimension[3]-o,q=!0)):n>=this.areaDimension[0]&&n<=this.areaDimension[2]&&(p<this.areaDimension[0]||p>this.areaDimension[2]||r<this.areaDimension[1]||r>this.areaDimension[3])&&(p<this.areaDimension[0]?(h=this.areaDimension[0]-p,q=!0):p>this.areaDimension[2]&&(h=this.areaDimension[2]-p,q=!0),r<this.areaDimension[1]?(i=this.areaDimension[1]-r,q=!0):r>this.areaDimension[3]&&(i=this.areaDimension[3]-r,q=!0)),q===!0?this.model.set("isCenterOutOfBounds",!0):this.model.set("isCenterOutOfBounds",!1),j=d.position.x+h+f,k=d.position.y+i+g,l=e.position.x+h+f,m=e.position.y+i+g,this._checkCurrentPointBounds(j,k)&&this._checkCurrentPointBounds(l,m)){var s=b.get("thumbTack1"),t=b.get("thumbTack2"),u=b.get("dummyThumbTack1"),v=b.get("dummyThumbTack2"),w=b.get("vertex1"),x=b.get("vertex2"),y=b.get("dummyVertex1"),z=b.get("dummyVertex2"),A=b.get("dummyShapeCenter");c.position={x:a.point.x+h,y:a.point.y+i},A.position=c.position,b.set("shapeCenter",c),b.set("dummyShapeCenter",A),d.position.x=j,d.position.y=k,e.position.x=l,e.position.y=m,w.position.x=w.position.x+f+h,w.position.y=w.position.y+g+i,x.position.x=x.position.x+f+h,x.position.y=x.position.y+g+i,y.position=w.position,z.position=x.position,s.position.x=s.position.x+f+h,s.position.y=s.position.y+g+i,t.position.x=t.position.x+f+h,t.position.y=t.position.y+g+i,u.position=s.position,v.position=t.position,b.set("foci1",d),b.set("foci2",e),b.set("thumbTack1",s),b.set("thumbTack2",t),b.set("dummyThumbTack1",u),b.set("dummyThumbTack2",v),b.set("vertex1",w),b.set("vertex2",x),b.set("dummyVertex1",y),b.set("dummyVertex2",z),this._redrawStringsAndUpdateGroup(),b.set("center",c.position)}},adjustThumbTackPosition:function(a){var b=null,c=null,d=null,e=null,f=null,g=this.model.get("points"),h=this.model.get("thumbTack1"),i=this.model.get("thumbTack2"),j=this.model.get("dummyThumbTack2"),k=this.model.get("dummyThumbTack1"),l=null,m=null,n=null,o=null,p=this.model.get("minorAxis"),q=null,r=null,s=null;"thumbTack1"===this.entireGroup.currentItem?(c=h,d=i,e=g.rightWing,f=g.leftWing,l=k,m=j):(c=i,d=h,e=g.leftWing,f=g.rightWing,l=j,m=k);var t=this._getNearestPointWithIndex(a.point,e);if(b=t.point,null!==b&&this._checkCurrentPointBounds(b.x,b.y)){n=h.position,o=i.position,h.remove(),i.remove(),h=new this.paperScope2.Raster(this.thumbTackRaster),i=new this.paperScope2.Raster(this.thumbTackRaster),h.position=n,i.position=o,h.name="thumbTack1",i.name="thumbTack2",this.model.set("thumbTack1",h),this.model.set("thumbTack2",i),"thumbTack1"===this.entireGroup.currentItem?(c=h,d=i,r=!0):(c=i,d=h,r=!1),c.position=b;var u=f[this.pointsRange-t.index];d.position=u,l.position=c.position,m.position=d.position;var v=t.index,w=this.pointsRange-t.index;r?(q=b.subtract(e[v-1]).angle,s=f[w+1].subtract(u).angle):(s=e[v+1].subtract(b).angle,q=u.subtract(f[w-1]).angle),i.rotate(s),h.rotate(q),this.isVertical?(0===q?h.rotate(90):90===q?h.rotate(-90):h.rotate(90),0===s?i.rotate(-90):90===s?i.rotate(90):i.rotate(-90)):(q?h.rotate(90):0===q&&h.rotate(-90),s?i.rotate(-90):0===s&&i.rotate(90)),this.firstRotate===!0&&0===p&&(h.rotate(180),i.rotate(180)),this.model.set("isThumbTackOutOfBounds",!1)}else this.model.set("isThumbTackOutOfBounds",!0);this._redrawStringsAndUpdateGroup()},redrawShapeCenter:function(){var a=this.model.get("shapeCenter"),b=this.model.get("shapeCenterCircle"),c=this.model.get("asymptote1"),d=this.model.get("asymptote2"),e=this.model.get("thumbTack1"),f=this.model.get("thumbTack2"),g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null;b.opacity=0,this.model.set("shapeCenterCircle",null),a.opacity=1,this.leftPath&&(this.leftPath.remove(),this.rightPath.remove()),c&&(c.remove(),d.remove()),i=this.model.get("center"),j=this.model.get("majorAxis"),k=this.model.get("minorAxis"),l=this.returnHyperBolaPoints(i,j,k,this.pointsRange),m=this._getNearestPoint(e.position,l.rightWing,f),n=l.rightWing.indexOf(m),o=l.rightWing[n].subtract(l.rightWing[n-1]).angle,m=this._getNearestPoint(f.position,l.leftWing,f),n=l.leftWing.indexOf(m),p=l.leftWing[n+1].subtract(l.leftWing[n]).angle,g=e.position,h=f.position,e.remove(),f.remove(),e=new this.paperScope2.Raster(this.thumbTackRaster),f=new this.paperScope2.Raster(this.thumbTackRaster),e.position=g,f.position=h,e.name="thumbTack1",f.name="thumbTack2",this.model.set("thumbTack1",e),this.model.set("thumbTack2",f),this._redrawStringsAndUpdateGroup(),e.rotate(o,e.position),f.rotate(p,f.position),this.isVertical?(0===o?e.rotate(90):90===o?e.rotate(-90):e.rotate(90),0===p?f.rotate(-90):90===p?f.rotate(90):f.rotate(-90)):(o?e.rotate(90):0===o&&e.rotate(-90),p?f.rotate(-90):0===p&&f.rotate(90)),this.firstRotate=!1},_fixOverlappingElements:function(){var a=this.model,b=a.get("thumbTack1"),c=a.get("thumbTack2"),d=a.get("dummyThumbTack1"),e=a.get("dummyThumbTack2"),f=a.get("foci1"),g=a.get("foci2"),h=a.get("vertex1"),i=a.get("vertex2"),j=a.get("dummyVertex1"),k=a.get("dummyVertex2"),l=a.get("dummyShapeCenter"),m=a.get("shapeCenter"),n=a.get("shapeCenterCircle");this.paperScope2.activate(),m.bringToFront(),l.bringToFront(),h.bringToFront(),i.bringToFront(),j.bringToFront(),k.bringToFront(),f.bringToFront(),g.bringToFront(),this.entireGroup._namedChildren.shapeCenterCircle&&n.bringToFront(),this.entireGroup._namedChildren.thumbTack1&&(b.bringToFront(),c.bringToFront(),d.bringToFront(),e.bringToFront()),this.paperScope2.view.draw()},_onPopUpClick:function(){var b=this.model,c=b.get("points"),d=b.get("center"),e=null,f=null,g=null,h=c.leftWing,i=c.rightWing,j=b.get("thumbTack1"),k=b.get("thumbTack2"),l=b.get("dummyThumbTack1"),m=b.get("dummyThumbTack2"),n=b.get("shapeCenterCircle"),o=null,p=null,q=b.get("shapeCenter"),r=null,s=this,t=s.viewStaticData.ANIMATION_SPEED_FACTOR,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=b.get("minorAxis");b.set("showPopupOnTryAnother",!0),r=new s.paperScope2.Point(q.position.x,q.position.y),n&&n.remove(),n=new s.paperScope2.Path.Circle({center:r,radius:4,strokeColor:"#555555",fillColor:"#555555"}),n.name="shapeCenterCircle",b.set("shapeCenterCircle",n),n.opacity=1,q.opacity=0,s._drawAsymptotes(),s.rightPath.strokeWidth=0,s.leftPath.strokeWidth=0,o=b.get("asymptote2"),p=b.get("asymptote1"),p.strokeColor="#a4a19d",o.strokeColor="#a4a19d",b.set("draggingDisabled",!0),s._unbindEvents(),s.firstRotate=!0,b.set("thumbTack1BeforePop",j.position),b.set("thumbTack2BeforePop",k.position),s._getInterSectingBubbles(),s.isVertical===!0?(h.reverse(),0===H?(w=d.y-s.dummyLeftPathArray[0].y,x=s.dummyLeftPathArray[s.dummyLeftPathArray.length-1].y-d.y,w>x?(u=s.dummyRightPathArray[0],u=s._getNearestPoint(u,i,k),g=i.indexOf(u),C=this.pointsRange-g):(u=s.dummyLeftPathArray[s.dummyLeftPathArray.length-1],u=s._getNearestPoint(u,h,k),g=h.indexOf(u),C=this.pointsRange-g)):(w=d.x-s.dummyLeftPathArray[0].x,x=d.x-s.dummyRightPathArray[0].x,y=s.dummyLeftPathArray[s.dummyLeftPathArray.length-1].x-d.x,z=s.dummyRightPathArray[s.dummyRightPathArray.length-1].x-d.x,x>=y?(u=s.dummyRightPathArray[0],u=s._getNearestPoint(u,i,k),g=i.indexOf(u)):(E=s.dummyLeftPathArray[s.dummyLeftPathArray.length-1],E=s._getNearestPoint(E,h,j),g=h.indexOf(E)),w>=z?(v=s.dummyLeftPathArray[0],v=s._getNearestPoint(v,h,j),C=h.indexOf(v)):(D=s.dummyRightPathArray[s.dummyRightPathArray.length-1],D=s._getNearestPoint(D,i,k),C=i.indexOf(D)))):(h.reverse(),0===H?(w=d.x-s.dummyLeftPathArray[0].x,x=s.dummyLeftPathArray[s.dummyLeftPathArray.length-1].x-d.x,w>x?(u=s.dummyRightPathArray[0],u=s._getNearestPoint(u,i,k),g=i.indexOf(u),C=this.pointsRange-g):(u=s.dummyLeftPathArray[s.dummyLeftPathArray.length-1],u=s._getNearestPoint(u,h,k),g=h.indexOf(u),C=this.pointsRange-g)):(w=d.y-s.dummyLeftPathArray[0].y,x=s.dummyLeftPathArray[s.dummyLeftPathArray.length-1].y-d.y,y=d.y-s.dummyRightPathArray[0].y,z=s.dummyRightPathArray[s.dummyRightPathArray.length-1].y-d.y,x>=y?(u=s.dummyLeftPathArray[s.dummyLeftPathArray.length-1],u=s._getNearestPoint(u,h,k),g=h.indexOf(u)):(E=s.dummyRightPathArray[0],E=s._getNearestPoint(E,i,j),g=i.indexOf(E)),w>=z?(v=s.dummyLeftPathArray[0],v=s._getNearestPoint(v,h,k),C=h.indexOf(v)):(D=s.dummyRightPathArray[s.dummyRightPathArray.length-1],D=s._getNearestPoint(D,i,k),C=i.indexOf(D)))),A=j.position,B=k.position,j.remove(),k.remove(),j=new s.paperScope2.Raster(s.getSpritePartBase64URL("explore-shapes",92,54,19,39)),k=new s.paperScope2.Raster(s.getSpritePartBase64URL("explore-shapes",92,54,19,39)),j.position=A,k.position=B,j.name="thumbTack1",k.name="thumbTack2",b.set("thumbTack1",j),b.set("thumbTack2",k),s._redrawStringsAndUpdateGroup(),j.position=i[g],G=i[g],k.position=h[g],F=h[g],g++,s._redrawStringsAndUpdateGroup(),s.paperScope2.view.draw();var I,J,K,L,M=setInterval(function(){K=F.subtract(h[g]).angle,L=G.subtract(i[g]).angle,I||J?(j.rotate(L-J),k.rotate(K-I)):(j.rotate(L-90),k.rotate(90+K),k.rotate(180)),j.position=i[g],k.position=h[g],F=h[g],G=i[g],I=K,J=L,s._redrawStringsAndUpdateGroup(),s._setTackPosition(i[g-2],h[g-2]),s._popOutInterSectingBubbles(),s.paperScope2.view.draw(),g+=t,f+=t,e+=t,g>C&&(s.paperScope2.activate(),s.rightPath.strokeColor="#555555",s.leftPath.strokeColor="#555555",s.rightPath.strokeWidth=2,s.leftPath.strokeWidth=2,s.model.set("finalThumbTack1Position",j.position),s.model.set("finalThumbTack2Position",k.position),s.trigger(a.Common.Interactivities.ConicExplorer.Views.ConicPlotter.CUSTOM_EVENTS.animationComplete),s._fixOverlappingElements(),s._showHideEquation(!0),s.drawLabel(),h.reverse(),clearInterval(M),l.position=j.position,m.position=k.position,s.paperScope2.view.draw(),s._bindEvents())},1)},adjustVertexPosition:function(a){var b=null,c=null,d=this.model,e=d.get("foci1"),f=d.get("foci2"),g=d.get("vertex1"),h=d.get("vertex2"),i=d.get("shapeCenter"),j=d.get("dummyVertex1"),k=d.get("dummyVertex2"),l=null,m=1,n=null,o=null,p=null,q=null,r=!0,s=null,t=null,u=null,v=null,w=null;"vertex1"===this.entireGroup.currentItem?(l=g,o=h,n=e,w=f,p="vertex1",q="vertex2",s=j,t=k,u="dummyVertex1",v="dummyVertex2"):(l=h,o=g,n=f,w=e,p="vertex2",q="vertex1",s=k,t=j,u="dummyVertex2",v="dummyVertex1"),b=a.point.x-l.position.x,c=a.point.y-l.position.y,m=-1,this.isVertical?(l.position.y=a.point.y,o.position.y=o.position.y+m*c,"vertex1"===this.entireGroup.currentItem?e.position.y>=a.point.y?(l.position.y=n.position.y,o.position.y=w.position.y):a.point.y>=i.position.y&&(l.position.y=i.position.y,o.position.y=i.position.y):f.position.y<=a.point.y?(l.position.y=n.position.y,o.position.y=w.position.y):a.point.y<=i.position.y&&(l.position.y=i.position.y,o.position.y=i.position.y)):(l.position.x=a.point.x,o.position.x=o.position.x+m*b,"vertex1"===this.entireGroup.currentItem?e.position.x>=a.point.x?(l.position.x=n.position.x,o.position.x=w.position.x):a.point.x>=i.position.x&&(l.position.x=i.position.x,o.position.x=i.position.x):f.position.x<=a.point.x?(l.position.x=n.position.x,o.position.x=w.position.x):a.point.x<=i.position.x&&(l.position.x=i.position.x,o.position.x=i.position.x)),s.position=l.position,t.position=o.position,d.set(p,l),d.set(q,o),d.set(u,s),d.set(v,t),r?this._calculateMinorAxisAndUpdateHyperbolaPoints():this._updateGroup()},_calculateMinorAxisAndUpdateHyperbolaPoints:function(a,b){this._calculateMajorAxisAndMinorAxis();var c=this.model.get("majorAxis"),d=this.model.get("minorAxis"),e=c*c,f=d*d;if(0===d&&0===c)return this._updateGroup(),void this.trigger(this.viewStaticData.CUSTOM_EVENTS.hideHyderbola);var g=this.model.get("center"),h=this.model.get("shapeCenter"),i=this.model.get("vertex1"),j=this.model.get("foci1"),k=(this.model.get("foci2"),this.model.get("thumbTack1")),l=this.model.get("thumbTack2"),m=this.model.get("dummyThumbTack1"),n=this.model.get("dummyThumbTack2"),o=null,p=null,q=null,r=null,s=null,t=!1,u=null,v=null,w=null,x=null,y=null,z=null,A=null;if(q=k.position,r=l.position,k.remove(),l.remove(),k=new this.paperScope2.Raster(this.thumbTackRaster),l=new this.paperScope2.Raster(this.thumbTackRaster),k.position=q,l.position=r,k.name="thumbTack1",l.name="thumbTack2",a&&(o=this.returnHyperBolaPoints(g,c,d,this.pointsRange),this.model.set("points",o)),0===d?(y=d,z=e,x=this.isVertical?this.returnHyperBolaPointsHelper1:this.returnHyperBolaPointsHelper2):(y=c,z=f,x=this.isVertical?this.returnHyperBolaPointsHelper3:this.returnHyperBolaPointsHelper4),this.commonFunction=x,this.entireGroup._namedChildren.thumbTack1||(k.position=this._returnCorrespondingPoint(y,-200,z,!0),l.position=this._returnCorrespondingPoint(y,200,z,!1),w=this._returnCorrespondingPoint(y,-201,z,!0),A=this._returnCorrespondingPoint(y,201,z,!1),m.position=k.position,n.position=l.position,m.opacity=0,n.opacity=0),this.isVertical===!0){if(parseInt(j.position.y)===parseInt(i.position.y)&&parseInt(j.position.x)===parseInt(i.position.x)?(k.position=this._returnCorrespondingPoint(y,k.position.y-g.y,z,!0),l.position=this._returnCorrespondingPoint(y,l.position.y-g.y,z,!1),w=this._returnCorrespondingPoint(y,k.position.y-g.y-1,z,!0),A=this._returnCorrespondingPoint(y,l.position.y-g.y+1,z,!1),t=!0):parseInt(h.position.x)!==parseInt(k.position.x)&&parseInt(h.position.x)!==parseInt(l.position.x)||b?(k.position=this._returnCorrespondingPoint(y,k.position.x-g.x,z,!0),l.position=this._returnCorrespondingPoint(y,l.position.x-g.x,z,!1),w=this._returnCorrespondingPoint(y,k.position.x-g.x-1,z,!0),A=this._returnCorrespondingPoint(y,l.position.x-g.x+1,z,!1),t=!0):(k.position=this._returnCorrespondingPoint(y,-200,z,!0),l.position=this._returnCorrespondingPoint(y,200,z,!1),w=this._returnCorrespondingPoint(y,-201,z,!0),A=this._returnCorrespondingPoint(y,201,z,!1),t=!0),t){if(this._checkIfPointOutOfBounds(k.position)&&this._checkIfPointOutOfBounds(l.position)){a||(o=this.returnHyperBolaPoints(g,c,d,this.pointsRange),this.model.set("points",o)),p=this._getNearestPointWithIndex(k.position,this.dummyRightPathArray).point;var B=this._getNearestPointWithIndex(p,o.rightWing);s=B.index,k.position=o.rightWing[s],l.position=o.leftWing[o.leftWing.length-s],w=o.rightWing[s-1],A=o.leftWing[o.leftWing.length-s+1]}u=k.position.subtract(w).angle,k.rotate(u),v=A.subtract(l.position).angle,l.rotate(v),0===u?k.rotate(90,k.position):90===u?k.rotate(-90,k.position):k.rotate(90,k.position),0===v?l.rotate(-90,l.position):90===v?l.rotate(90,l.position):l.rotate(-90,l.position)}}else if(parseInt(j.position.y)===parseInt(i.position.y)&&parseInt(j.position.x)===parseInt(i.position.x)?(k.position=this._returnCorrespondingPoint(y,k.position.x-g.x,z,!0),l.position=this._returnCorrespondingPoint(y,l.position.x-g.x,z,!1),w=this._returnCorrespondingPoint(y,k.position.x-g.x-1,z,!0),A=this._returnCorrespondingPoint(y,l.position.x-g.x+1,z,!1),t=!0):parseInt(h.position.y)!==parseInt(k.position.y)&&parseInt(h.position.y)!==parseInt(l.position.y)||b?(k.position=this._returnCorrespondingPoint(y,k.position.y-g.y,z,!0),l.position=this._returnCorrespondingPoint(y,l.position.y-g.y,z,!1),w=this._returnCorrespondingPoint(y,k.position.y-g.y-1,z,!0),A=this._returnCorrespondingPoint(y,l.position.y-g.y+1,z,!1),t=!0):(k.position=this._returnCorrespondingPoint(y,-200,z,!0),l.position=this._returnCorrespondingPoint(y,200,z,!1),w=this._returnCorrespondingPoint(y,-201,z,!0),A=this._returnCorrespondingPoint(y,201,z,!1),t=!0),t){if(this._checkIfPointOutOfBounds(k.position)&&this._checkIfPointOutOfBounds(l.position)){a||(o=this.returnHyperBolaPoints(g,c,d,this.pointsRange),this.model.set("points",o)),p=this._getNearestPointWithIndex(k.position,this.dummyRightPathArray).point;var B=this._getNearestPointWithIndex(p,o.rightWing);s=B.index,k.position=o.rightWing[s],l.position=o.leftWing[o.leftWing.length-s],w=o.rightWing[s-1],A=o.leftWing[o.leftWing.length-s+1]}u=k.position.subtract(w).angle,k.rotate(u),v=A.subtract(l.position).angle,l.rotate(v),u?k.rotate(90,k.position):0===u&&k.rotate(-90,k.position),v?l.rotate(-90,l.position):0===v&&l.rotate(90,l.position)}m.position=k.position,n.position=l.position,this.model.set("thumbTack1",k),this.model.set("thumbTack2",l),this.model.set("dummyThumbTack1",m),this.model.set("dummyThumbTack2",n),this._redrawStringsAndUpdateGroup()},_checkIfPointOutOfBounds:function(a){return a.x<this.areaDimension[0]||a.x>this.areaDimension[2]||a.y<this.areaDimension[1]||a.y>this.areaDimension[3]?!0:!1},_getDistanceBetweenPoints:function(a,b){var c=a.position.x,d=a.position.y,e=b.position.x,f=b.position.y,g=c-e,h=d-f,i=null;return i=Math.sqrt(g*g+h*h)},adjustFociPosition:function(a){var b=null,c=null,d=null,e=null,f=this.model,g=this.model.get("foci1"),h=this.model.get("foci2"),i=this.model.get("vertex1"),j=this.model.get("vertex2"),k=null,l=1,m=f.get("shapeCenter"),n=null,o=null,p=null,q=null,r=!0,s=null,t=null,u=null,v=this.entireGroup.currentItem;if("foci1"===v?(k=g,s=h,n=i,o=j,p="foci1",q="foci2"):(k=h,s=g,n=j,o=i,p="foci2",q="foci1"),b=a.point.x-k.position.x,c=a.point.y-k.position.y,l=-1,d=a.point.x-n.position.x,e=a.point.y-n.position.y,t=s.position.x+l*b,t<this.areaDimension[0]||t>this.areaDimension[2])return void this.model.set("fociOutOfBounds",!0);var w=Math.round(m.position.x),x=Math.round(m.position.y),y=Math.round(k.position.x),z=Math.round(k.position.y);if(this.isVertical||(k.position.x=a.point.x,s.position.x=s.position.x+l*b,this.isVertical=!1,this.model.set("isVertical",!1),("foci1"===v&&d>=0||"foci2"===v&&0>=d)&&(k.position.x=n.position.x,s.position.x=o.position.x)),w===y&&x===z&&this._updateGroup(),this.isVertical){if(u=s.position.y+l*c,u<this.areaDimension[1]||u>this.areaDimension[3])return void this.model.set("fociOutOfBounds",!0);k.position.y=a.point.y,s.position.y=s.position.y+l*c,this.isVertical=!0,this.model.set("isVertical",!0),("foci1"===v&&e>=0||"foci2"===v&&0>=e)&&(k.position.y=n.position.y,s.position.y=o.position.y)}w===y&&x===z&&(r=!1),f.set(p,k),f.set(q,s),r?(this._calculateMinorAxisAndUpdateHyperbolaPoints(),this.trigger(this.viewStaticData.CUSTOM_EVENTS.showHyderbola)):(this._updateGroup(),this.trigger(this.viewStaticData.CUSTOM_EVENTS.hideHyderbola))},_updateGroup:function(){var a=this.model,b=a.get("foci1"),c=a.get("foci2"),d=a.get("vertex1"),e=a.get("vertex2"),f=a.get("shapeCenter"),g=a.get("thumbTack1"),h=a.get("thumbTack2"),i=a.get("purpleBar1"),j=a.get("redBar1"),k=a.get("redBar2"),l=a.get("purpleBar2"),m=a.get("dummyVertex1"),n=a.get("dummyVertex2"),o=a.get("dummyShapeCenter");this.thumbTackPosition1=g.position,this.thumbTackPosition2=h.position,this.entireGroup.removeChildren(),this.entireGroup.addChildren([b,c,d,e,f,o,n,m]),this._fixOverlappingElements(),i&&i.remove(),j&&j.remove(),l&&l.remove(),k&&k.remove()},_redrawStringsAndUpdateGroup:function(){var a=this.model,b=this.model.get("foci1"),c=this.model.get("foci2"),d=this.model.get("thumbTack1"),e=this.model.get("thumbTack2"),f=this.model.get("dummyThumbTack1"),g=this.model.get("dummyThumbTack2"),h=this.model.get("vertex1"),i=this.model.get("vertex2"),j=this.model.get("dummyVertex1"),k=this.model.get("dummyVertex2"),l=null,m=a.get("shapeCenter"),n=a.get("dummyShapeCenter"),o=a.get("shapeCenterCircle"),p=null;this.entireGroup.removeChildren(),this._generateString("purple",p,b.position,d.position,!1);var q=a.get("purple");q.moveAbove(a.get("thumbTack1")),this._generateString("red",l,c.position,d.position,!1);var r=a.get("red");r.moveAbove(a.get("thumbTack1")),this._generateString("red",p,b.position,e.position,!1);var s=a.get("red");s.moveAbove(a.get("thumbTack2")),this._generateString("purple",l,c.position,e.position,!1);var t=a.get("purple");t.moveAbove(a.get("thumbTack2")),q.name="purple-line1",r.name="red-line1",s.name="purple-line2",t.name="red-line2",this._generateBar();var u=[b,c,d,e,f,g,h,i,m,q,r,s,t,j,k,n];o&&u.push(o),this.entireGroup.addChildren(u),this._fixOverlappingElements()},_getNearestPoint:function(a,b,c){for(var d=(this.model,0),e=null,f=null,g=1e4;d<this.pointsRange;d++)if(f=a.subtract(b[d]).length,g>f&&(g=f,e=b[d]),0===f)return e;return e},_getNearestPointWithIndex:function(a,b){for(var c=null,d=null,e=0,f=b.length/2|0,g=(e+f)/2|0,h=f,i=b.length-1,j=(h+i)/2|0;f-e!==1&&i-h!==1;)c=b[g],d=b[j],a.subtract(c).length<a.subtract(d).length?(i=f,e=e,f=g,h=f,g=(e+f)/2|0,j=(h+i)/2|0):(e=h,i=i,f=j,h=j,g=(e+f)/2|0,j=(h+i)/2|0);var k=a.subtract(b[e]).length,l=a.subtract(b[f]).length,m=a.subtract(b[i]).length;return l>k&&m>k?{point:b[e],index:e}:m>l?{point:b[f],index:f}:{point:b[i],index:i}},_drawAsymptotes:function(){var a=this.model,b=a.get("center"),c=a.get("majorAxis"),d=a.get("minorAxis"),e=a.get("asymptote2"),f=a.get("asymptote1"),g=this._returnAsymptotesPoints(b,c,d);this.paperScope2.activate(),f&&(f.remove(),e.remove()),f=new this.paperScope2.Path,f.add(g.leftAsymptotesPoints[0]),f.add(g.leftAsymptotesPoints[1]),f.strokeWidth=1,f.dashArray=[8,8],a.set("asymptote1",f),e=new this.paperScope2.Path,e.add(g.rightAsymptotesPoints[0]),e.add(g.rightAsymptotesPoints[1]),e.strokeWidth=1,e.dashArray=[8,8],a.set("asymptote2",e),f.sendToBack(),e.sendToBack()},_returnAsymptotesPoints:function(a,b,c){var d,e=[],f=[],g=null;return this.isVertical&&(g=b,b=c,c=g),d=c/b*900,e.push(new this.paperScope2.Point(900+a.x,d+a.y)),f.push(new this.paperScope2.Point(900+a.x,-d+a.y)),d=c/b*-900,e.push(new this.paperScope2.Point(-900+a.x,d+a.y)),f.push(new this.paperScope2.Point(-900+a.x,-d+a.y)),{leftAsymptotesPoints:e,rightAsymptotesPoints:f}},_generateBar:function(){this.paperScope2.activate();var a,b,c,d,e,f=this.paperScope2,g=548,h=this.model,i=h.get("purpleBar1"),j=null,k=null,l=h.get("redBar1"),m=h.get("purpleBar2"),n=h.get("redBar2"),o=this.model.get("thumbTack1"),p=(this.model.get("thumbTack2"),this.model.get("foci1")),q=this.model.get("foci2"),r=6,s=null,t=null,u=null,v=null,w=null;i&&i.remove(),l&&l.remove(),m&&m.remove(),n&&n.remove(),t=Math.floor(this._getDistanceBetweenPoints(o,p)),u=Math.floor(this._getDistanceBetweenPoints(o,q)),w=u,v=t,b=h.getOriginPosition(),s=t-u,d=Math.floor(b.x-s/2),a=Math.floor(d-u),c=[{raster:k,startingPoint:new f.Point(a,g),endingPoint:new f.Point(d,g),width:r,height:10,angle:0,isRatioBar:!0,isRatioBar1:!1,isRatioBar2:!0,ratioBar2Height:23,ratioBar2Width:3,ratioBar1Height:23,ratioBar1Width:1,lineColor:"red"}],l=this._drawLine(c),h.set("redBar1",l),e=d+t,c=[{raster:j,startingPoint:new f.Point(d,g),endingPoint:new f.Point(e,g),width:r,height:10,angle:0,isRatioBar:!0,isRatioBar1:!0,isRatioBar2:!0,ratioBar1Height:23,ratioBar1Width:1,ratioBar2Height:23,ratioBar2Width:1,lineColor:"purple"}],i=this._drawLine(c),h.set("purpleBar1",i),g=567,s=w-v,d=Math.floor(b.x-s/2),a=Math.floor(d-v),c=[{raster:j,startingPoint:new f.Point(a,g),endingPoint:new f.Point(d,g),width:r,height:10,angle:0,isRatioBar:!0,isRatioBar1:!1,isRatioBar2:!0,ratioBar2Height:23,ratioBar2Width:3,ratioBar1Height:23,ratioBar1Width:1,lineColor:"purple"}],m=this._drawLine(c),h.set("purpleBar2",m),e=d+w,c=[{raster:k,startingPoint:new f.Point(d,g),endingPoint:new f.Point(e,g),width:r,height:10,angle:0,isRatioBar:!0,isRatioBar1:!0,isRatioBar2:!0,ratioBar1Height:23,ratioBar1Width:1,ratioBar2Height:23,ratioBar2Width:1,lineColor:"red"}],n=this._drawLine(c),h.set("redBar2",n)},setPreviousPositionToThumbTack:function(a,b){var c=this.model,d=c.get("thumbTack1"),e=c.get("dummyThumbTack1"),f=c.get("thumbTack2"),g=c.get("dummyThumbTack2");this.previousThumbTack1=d.position,this.previousThumbTack2=f.position,a&&(d.position=a,e.position=a,this.model.set("thumbTack1",d),this.model.set("dummyThumbTack1",e)),b&&(f.position=b,g.position=b,this.model.set("thumbTack2",f),this.model.set("dummyThumbTack2",g)),this._redrawStringsAndUpdateGroup()},tryAnother:function(){this.paperScope2.activate();var a,b,c,d=this.model,e=d.get("center"),f=d.get("thumbTack1"),g=d.get("thumbTack2"),h=d.get("dummyThumbTack1"),i=d.get("dummyThumbTack2"),j=d.get("vertex1"),k=d.get("vertex2"),l=(d.get("dummyVertex2"),d.get("dummyVertex1"),null),m=null,n=d.get("dummyShapeCenter"),o=this.model.get("shapeCenter"),p=this.model.get("shapeCenterCircle"),q=this.model.get("asymptote1"),r=this.model.get("asymptote2");p&&(p.opacity=0,d.set("shapeCenterCircle",null)),o.opacity=1,this.leftPath&&(this.leftPath.remove(),this.rightPath.remove()),q&&(q.remove(),r.remove()),this._getRandomMajorAxisAndFoci(),a=d.get("majorAxis"),b=d.get("minorAxis"),e=d.getOriginPosition(),o=d.get("shapeCenter"),d.set("center",e),o.position=e,n.position=o.position,j.position=new this.paperScope2.Point(e.x-a,e.y),k.position=new this.paperScope2.Point(e.x+a,e.y),this._setInitialPosition(),this._snapAll(),this._calculateMajorAxisAndMinorAxis(),a=this.model.get("majorAxis"),b=this.model.get("minorAxis"),this.isVertical=!1,this.model.set("isVertical",!1),c=this.returnHyperBolaPoints(e,a,b,this.pointsRange),this.model.set("points",c);for(var s,t,u=0;u<this.pointsRange;u++)parseInt(c.rightWing[u].y)===parseInt(e.y-200)&&(f.position=c.rightWing[u],s=u),parseInt(c.leftWing[u].y)===parseInt(e.y+200)&&(g.position=c.leftWing[u],t=u);l=f.position,m=g.position,f.remove(),g.remove(),f=new this.paperScope2.Raster(this.thumbTackRaster),g=new this.paperScope2.Raster(this.thumbTackRaster),f.position=l,g.position=m,f.name="thumbTack1",g.name="thumbTack2",this.model.set("thumbTack1",f),this.model.set("thumbTack2",g),this.model.set("dummyThumbTack1",h),this.model.set("dummyThumbTack2",i),this._redrawStringsAndUpdateGroup(),h.position=f.position,i.position=g.position,h.opacity=0,i.opacity=0;var v=c.rightWing[s].subtract(c.rightWing[s-1]).angle;f.rotate(v),f.rotate(90);var w=c.leftWing[t+1].subtract(c.leftWing[t]).angle;g.rotate(w),g.rotate(-90),this._redrawStringsAndUpdateGroup(),d.set("thumbTack1",f),d.set("thumbTack2",g),d.set("dummyThumbTack1",h),d.set("dummyThumbTack2",i),d.set("vertex1",j),d.set("vertex2",k),this._drawDummyTackPath(),d.set("showPopupOnTryAnother",!1)},changeToHorizontalOrVertical:function(a){this.paperScope2.activate();var b,c,d,e,f=this.model,g=f.get("center"),h=f.get("thumbTack1"),i=f.get("thumbTack2"),j=f.get("dummyThumbTack1"),k=f.get("dummyThumbTack2"),l=f.get("vertex1"),m=f.get("vertex2"),n=(f.get("dummyVertex2"),f.get("dummyVertex1"),f.getGridSizeXAxis()),o=null,p=null,q=f.get("dummyShapeCenter"),r=this.model.get("shapeCenter"),s=this.model.get("shapeCenterCircle"),t=this.model.get("asymptote1"),u=this.model.get("asymptote2");s&&(s.opacity=0),r.opacity=1,this.leftPath&&(this.leftPath.remove(),this.rightPath.remove()),t&&(t.remove(),u.remove()),b=this.viewStaticData.MAJOR_AXIS_DEFAULT*n,c=this.viewStaticData.MINOR_AXIS_DEFAULT*n,e=this.viewStaticData.FOCI_DEFAULT*n,f.set("majorAxis",b),f.set("foci",e),f.set("minorAxis",c),g=f.getOriginPosition(),r=f.get("shapeCenter"),f.set("center",g),r.position=g,q.position=r.position,a?(l.position=new this.paperScope2.Point(g.x,g.y-b),m.position=new this.paperScope2.Point(g.x,g.y+b),this._setInitialPosition(!0),this.isVertical=!0,this.model.set("isVertical",!0)):(l.position=new this.paperScope2.Point(g.x-b,g.y),m.position=new this.paperScope2.Point(g.x+b,g.y),this._setInitialPosition(),this.isVertical=!1,this.model.set("isVertical",!1)),this._snapAll(),this._calculateMajorAxisAndMinorAxis(),b=this.model.get("majorAxis"),c=this.model.get("minorAxis"),d=this.returnHyperBolaPoints(g,b,c,this.pointsRange),this.model.set("points",d);var v,w;if(a)for(var x=0;x<this.pointsRange;x++)parseInt(d.rightWing[x].x)===parseInt(g.x-200)&&(h.position=d.rightWing[x],v=x),parseInt(d.leftWing[x].x)===parseInt(g.x+200)&&(i.position=d.leftWing[x],w=x);else for(var x=0;x<this.pointsRange;x++)parseInt(d.rightWing[x].y)===parseInt(g.y-200)&&(h.position=d.rightWing[x],v=x),parseInt(d.leftWing[x].y)===parseInt(g.y+200)&&(i.position=d.leftWing[x],w=x);o=h.position,p=i.position,h.remove(),i.remove(),h=new this.paperScope2.Raster(this.thumbTackRaster),i=new this.paperScope2.Raster(this.thumbTackRaster),h.position=o,i.position=p,h.name="thumbTack1",i.name="thumbTack2",this.model.set("thumbTack1",h),this.model.set("thumbTack2",i),this.model.set("dummyThumbTack1",j),this.model.set("dummyThumbTack2",k),this._redrawStringsAndUpdateGroup(),j.position=h.position,k.position=i.position,j.opacity=0,k.opacity=0;var y=d.rightWing[v].subtract(d.rightWing[v-1]).angle;h.rotate(y),h.rotate(90);var z=d.leftWing[w+1].subtract(d.leftWing[w]).angle;i.rotate(z),i.rotate(-90),this._redrawStringsAndUpdateGroup(),f.set("thumbTack1",h),f.set("thumbTack2",i),f.set("dummyThumbTack1",j),f.set("dummyThumbTack2",k),f.set("vertex1",l),f.set("vertex2",m),
this._drawDummyTackPath(),f.set("showPopupOnTryAnother",!1)},_addEquationHolderTemplate:function(){var b=a.Common.Interactivities.ConicExplorer.templates.equationHolder({idPrefix:this.idPrefix}).trim();this.$el.append(b)},_showHideEquation:function(a){if(a===!0){var b,c,d,e,f=this.model,g=this.$el,h=this.idPrefix,i=f.get("majorAxis"),j=f.get("minorAxis"),k=null,l=f.get("gridSizeXAxis"),m=null,n=f.get("shapeCenter"),o=f.getOriginPosition(),p=null,q=f.get("vertex1"),r=f.get("vertex2"),s=f.get("foci1");i=(i/l).toFixed(2),j=(j/l).toFixed(2),k=Math.round((n.position.x-o.x)/l),m=Math.round((o.y-n.position.y)/l),q.position.x!==r.position.x||q.position.y!==r.position.y||0!==Math.round(j)&&0!==Number(i)?s.position.x!==q.position.x||0!==Math.round(j)&&0!==Number(i)?(b=0>k?"(<em>x</em> &minus; ( &minus;"+Math.abs(k)+"))<sup>2</sup>":"(<em>x</em> &minus; "+k+")<sup>2</sup>",c=0>m?"(<em>y</em> &minus; (&minus;"+Math.abs(m)+"))<sup>2</sup>":"(<em>y</em> &minus; "+m+")<sup>2</sup>",d=i+"<sup>2</sup>",e=j+"<sup>2</sup>",this.isVertical?(g.find("#"+h+"graph-first-numerator").html(c),g.find("#"+h+"graph-second-numerator").html(b)):(g.find("#"+h+"graph-first-numerator").html(b),g.find("#"+h+"graph-second-numerator").html(c)),g.find("#"+h+"graph-first-denominator").html(d),g.find("#"+h+"graph-second-denominator").html(e),g.find("#"+this.idPrefix+"graph-normal-formula").show(),g.find("#"+this.idPrefix+"degenerated-formula").hide()):(0>k&&(k="&minus;"+Math.abs(k)),0>m&&(m="&minus;"+Math.abs(m)),p=40,this.isVertical===!1?(g.find("#"+h+"degenerated-x").html("y"),g.find("#"+h+"degenerated-y").html(m)):(g.find("#"+h+"degenerated-x").html("x"),g.find("#"+h+"degenerated-y").html(k)),g.find("#"+this.idPrefix+"graph-normal-formula").hide(),g.find("#"+this.idPrefix+"degenerated-formula").show()):(0>k&&(k="&minus;"+Math.abs(k)),0>m&&(m="&minus;"+Math.abs(m)),p=40,this.isVertical===!1?(g.find("#"+h+"degenerated-x").html("x"),g.find("#"+h+"degenerated-y").html(k)):(g.find("#"+h+"degenerated-x").html("y"),g.find("#"+h+"degenerated-y").html(m)),g.find("#"+this.idPrefix+"graph-normal-formula").hide(),g.find("#"+this.idPrefix+"degenerated-formula").show()),this._setEquationPosition(p),g.find("#"+this.idPrefix+"graph-formula").show(),f.set("equationEllipseB",j),f.set("equationEllipseA",i)}else this.$el.find("#"+this.idPrefix+"graph-formula").hide()},_setEquationPosition:function(a){var b=this.model,c=b.get("shapeCenter").position,d=c.x,e=c.y,f=b.get("activityAreaStartPoint"),g=f.xCoordinate,h=f.yCoordinate,i=a||75,j=this.$("#"+this.idPrefix+"graph-formula"),k=j.width(),l=j.height(),m=b.get("minorAxis"),n=b.get("majorAxis"),o=b.get("foci1").position.x,p=b.get("foci2").position.x,q=null,r=this.dummyLeftPath,s=null,t=null,u=null,v=null,w=null,x=b.get("activityAreaEndPoint"),y=x.xCoordinate,z=x.yCoordinate,A=y>=d+k/2,B=z>=e+l/2,C=d-k/2>=g,D=e-l/2>=h,E=30;o===p&&(w=n,n=m,m=w),z>=e+m/2+i+l&&A&&C?j.css({top:e+m/2+i,left:d-k/2}):(t=e+E+l,q=new this.paperScope2.Path.Line({from:[d,t],to:[-500,t]}),u=r.getIntersections(q),u.length>0?(v=u[0].point.x,s=d-v):s=k/2-1,m/2>l+i&&s>=k/2&&A&&B&&C&&D&&z>=l+i+e?j.css({top:e+E,left:d-k/2}):e-m/2-i-l>=h&&A&&C?j.css({top:e-(m/2+i+l),left:d-k/2}):d-n/2-i-k>=g&&B&&D?j.css({top:e-l/2,left:d-n/2-(i+k)}):y>=d+n/2+i+k&&B&&D?j.css({top:e-l/2,left:d+n/2+i}):d-(i+k+n)>=g&&e-(i+l+m)>=h?j.css({top:e-(i+m/2+l/2),left:d-(i+n/3+k/2)}):d-(i+k+n)>=g&&z>=e+(i+l+m)?j.css({top:e+(i+m+l/4),left:d-(i+n/2+k/4)}):y>=d+(i+k+n)&&z>=e+(i+l+m)?j.css({top:e+(i+m+l/4),left:d+(i+n/2+k/4)}):y>=d+(i+k+n)&&e-(i+l+m)>=h?j.css({top:e-(i+m+l/4),left:d+(i+n/2+k/4)}):j.css({top:b.getOriginPosition().y-l/2,left:b.getOriginPosition().x-k/2}))},drawLabel:function(){var a,b,c=this.model,d=c.get("foci1"),e=c.get("foci2"),f=c.getOriginPosition(),g=c.get("shapeCenter"),h=c.get("gridSizeXAxis"),i=this.paperScope2,j=null,k=null,l=null,m=null,n=null;m=Math.round((g.position.x-f.x)/h),n=Math.round((f.y-g.position.y)/h),a=new i.Point(g.position.x,g.position.y),b=new i.Point(a.x-15,a.y+25),j=this.renderString(m,n,b,0),m=Math.round((d.position.x-f.x)/h),n=Math.round((f.y-d.position.y)/h),a=new i.Point(d.position.x,d.position.y),b=new i.Point(a.x-15,a.y+25),k=this.renderString(m,n,b,0),m=Math.round((e.position.x-f.x)/h),n=Math.round((f.y-e.position.y)/h),a=new i.Point(e.position.x,e.position.y),b=new i.Point(a.x-15,a.y+25),l=this.renderString(m,n,b,0),c.set("centerCoordinate",j),c.set("foci1Cordinate",k),c.set("foci2Coordinate",l)},renderString:function(a,b,c,d){var e;return e=new this.paperScope2.PointText({position:{x:c.x,y:c.y}}),0>a&&(a="−"+Math.abs(a)),0>b&&(b="−"+Math.abs(b)),e.content="("+a+", "+b+")",e.strokeColor="#555555",e.strokeWidth=1,e.style={font:"verdana",fontSize:12,fillColor:"#555555"},e.rotate(d),e},clearElementsOnCanvas:function(){var a=this.model,b=a.get("centerCoordinate"),c=a.get("foci1Cordinate"),d=a.get("foci2Coordinate");b&&b.remove(),c&&c.remove(),d&&d.remove()},loadRequiredState:function(a){var b=this.model,c=b.get("shapeCenter"),d=b.get("shapeCenterCircle"),e=b.get("vertex1"),f=b.get("vertex2"),g=b.get("foci1"),h=b.get("foci2"),i=b.get("thumbTack1"),j=b.get("thumbTack2"),k=null,l=null,m=null,n=b.get("dummyThumbTack1"),o=b.get("dummyThumbTack2"),p=null,q=null,r=null,s=b.get("dummyVertex2"),t=b.get("dummyVertex1"),u=null,v=b.get("dummyShapeCenter");c.position=a.shapeCenter,d.position=a.shapeCenter,v.position=a.position,e.position=a.vertex1,f.position=a.vertex2,s.position=f.position,t.position=e.position,g.position=a.foci1,h.position=a.foci2,i.position=a.finalThumbTack1Position,j.position=a.finalThumbTack2Position,n.position=a.finalThumbTack1Position,o.position=a.finalThumbTack2Position,this.isVertical=a.isVertical,b.set("shapeCenter",c),b.set("dummyShapeCenter",v),b.set("vertex1",e),b.set("foci1",g),this._calculateMajorAxisAndMinorAxis(),k=this.model.get("majorAxis"),l=this.model.get("minorAxis"),m=this.returnHyperBolaPoints(a.shapeCenter,k,l,this.pointsRange),b.set("points",m),b.set("center",a.shapeCenter),this._drawAsymptotes(),p=b.get("asymptote2"),q=b.get("asymptote1"),b.set("shapeCenter",c),b.set("vertex1",e),b.set("vertex2",f),b.set("foci1",g),b.set("foci2",h),b.set("thumbTack1",i),b.set("thumbTack2",j),b.set("dummyVertex2",s),b.set("dummyVertex1",t),this._redrawStringsAndUpdateGroup(),this.rightPath.strokeColor="#555555",this.leftPath.strokeColor="#555555",q.strokeColor="#a4a19d",p.strokeColor="#a4a19d",this.drawLabel(),this.generateBubbles(),this._showHideEquation(!0),this._getInterSectingBubbles();var w={};i.position.x>=this.areaDimension[0]&&i.position.x<=this.areaDimension[2]&&i.position.y>=this.areaDimension[1]&&i.position.y<=this.areaDimension[3]?(r=i,u="thumbTack1"):(r=j,u="thumbTack2"),w.point=r.position,this.entireGroup.currentItem=u,this.adjustThumbTackPosition(w),this.entireGroup.currentItem=null},_initAccessibility:function(){var b={canvasHolderID:this.el.id+"-conic-graph-acc-container",paperItems:[],paperScope:this.paperScope2,manager:this.manager,player:this.player};this.canvasAcc=a.global.CanvasAcc.intializeCanvasAcc(b),this.updateCanvasElement(!0)},updateCanvasElement:function(a){this.canvasAcc&&(a?this.canvasAcc.updatePaperItems(this.getPaperObjects()):this.canvasAcc.updatePaperItems(),this.currentIndex=null)},getPaperObjects:function(){var a=this.model,b=a.get("shapeCenter"),c=a.get("vertex1"),d=a.get("vertex2"),e=a.get("foci1"),f=a.get("foci2"),g=a.get("thumbTack1"),h=a.get("thumbTack2"),i=a.get("draggingDisabled"),j=[];return i||j.push(b,e,f,c,d),j.push(g,h),j},_bindAccessibilityListeners:function(){var b=a.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,c=a.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,d=$("#"+this.el.id+"-conic-graph-acc-container"),e=this,f=null,g=null;d.on(b.TAB,function(a,b){g=null,f=b.item,"thumbTack1"===f.name?b.item=e.model.get("thumbTack1"):"thumbTack2"===f.name&&(b.item=e.model.get("thumbTack2")),f=b.item,g=[a,b],e.currentItem=f,e.previousItem&&(e.previousItem.fire("mouseleave",a),e.previousItem.fire("mouseup",a)),e.entireGroup._namedChildren.thumbTack1||"thumbTack1"!==f.name&&"thumbTack2"!==f.name?(e.previousItem=f,e.focusRect.position=f.position,e.focusRect.visible=!0,e.focusRect.opacity=1,e.trigger(e.viewStaticData.CUSTOM_EVENTS.tabKeyPressed,g)):(e.previousItem=null,e.focusRect.visible=!1,e.focusRect.opacity=0,e.trigger(e.viewStaticData.CUSTOM_EVENTS.focusOut,g),e.paperScope2.view.draw(),e.canvasAcc.canvasFocusOut())}),d.on(b.SPACE,function(a,b){g=null,g=[a,b],f=b.item,"thumbTack1"===f.name?b.item=e.model.get("thumbTack1"):"thumbTack2"===f.name&&(b.item=e.model.get("thumbTack2")),f=b.item,g=[a,b],e.currentItem=f,e.previousItem=f,e.focusRect.position=f.position,e.focusRect.visible=!0,e.focusRect.opacity=1,e.trigger(e.viewStaticData.CUSTOM_EVENTS.spaceKeyPressed,g)}),d.on(c.FOCUS_OUT,function(a,b){g=null,g=[a,b],f=b.item,e.previousItem&&(e.previousItem.fire("mouseleave",a),e.previousItem.fire("mouseup",a)),e.previousItem=null,e.focusRect.visible=!1,e.focusRect.opacity=0,e.trigger(e.viewStaticData.CUSTOM_EVENTS.focusOut,g),e.paperScope2.view.draw()}),d.on("focusin",function(a,b){e.trigger(e.viewStaticData.CUSTOM_EVENTS.focusIn,g),e.paperScope2.view.draw()}),d.off(b.ARROW).on(b.ARROW,$.proxy(this.arrowKeyPressed,this))},arrowKeyPressed:function(a,b){var c=null,d=b.item;"thumbTack1"===d.name?b.item=this.model.get("thumbTack1"):"thumbTack2"===d.name&&(b.item=this.model.get("thumbTack2")),c=[a,b],this.draggableElement=d,this.trigger(this.viewStaticData.CUSTOM_EVENTS.arrowKeyPressed,c),this.paperScope2.view.draw()}},{ADD_X_POSITION:{red:500,purple:500,Barred:900,Barpurple:700,black:400},CUSTOM_EVENTS:{animationComplete:"animationComplete",bubblePopAnimationStart:"bubblePopAnimationStart",bubblePopAnimationEnd:"bubblePopAnimationEnd",bubblePopulationAnimationEnd:"bubblePopulationAnimationEnd",bubblePopulationAnimationStart:"bubblePopulationAnimationStart",initializationDone:"initializationDone",hideHyderbola:"hideHyderbola",showHyderbola:"showHyderbola",arrowKeyPressed:"arrowKeyPressed",tabKeyPressed:"tabKeyPressed",spaceKeyPressed:"spaceKeyPressed",focusOut:"focusOut",focusIn:"focusIn"},RADIUS_OF_BUBBLES:{largeBubbleRadius:20,smallBubbleRadius:11,middleBubbleRadius:15},ANIMATION_SPEED_FACTOR:5,INITIAL_FOCI_MIN_LIMIT:4,INITIAL_FOCI_MAX_LIMIT:6,INITIAL_VERTEX_MIN_LIMIT:3,INITIAL_VERTEX_MAX_LIMIT:5,INITIAL_Y_START_COORDINATE:4,INITIAL_THUMBTACK_MIN_LIMIT:60,INITIAL_THUMBTACK_MAX_LIMIT:200,MINOR_AXIS_DEFAULT:4,MAJOR_AXIS_DEFAULT:3,FOCI_DEFAULT:5,createExplorerShapeView:function(b){var c=b.model,d="#"+b.contanierId,e=new a.Common.Interactivities.ConicExplorer.Views.ConicPlotter({el:d,model:c});return e}})}(window.MathInteractives),function(){"use strict";MathInteractives.Common.Interactivities.ConicExplorer.Views.DataTab=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,filePath:null,manager:null,player:null,tableModel:null,tableView:null,viewBtn1:null,viewBtn2:null,viewBtn3:null,firstTimeFocus:!0,initialize:function(){this.player=this.options.player,this.filePath=this.player.getPath(),this.manager=this.player.getManager(),this.idPrefix=this.player.getIDPrefix(),this.render()},render:function(){var a=MathInteractives.Common.Interactivities.ConicExplorer.templates,b=this.filePath.getImagePath(this.options.imageID);this.$el.append(a.dataTab({idPrefix:this.idPrefix}).trim()),this.$(".horizontal-diagram-image").css({"background-image":"url("+b+")"}),this.$(".vertical-diagram-image").css({"background-image":"url("+b+")"}),this.$(".horizontal-equation-text").html(this.options.horizontalEquationText),this.$(".vertical-equation-text").html(this.options.verticalEquationText),this.loadScreen(this.options.screenID),this._createTable(),this.renderButton()},renderButton:function(){this.backBtnView=MathInteractives.global.Theme2.Button.generateButton({path:this.filePath,player:this.player,idPrefix:this.idPrefix,manager:this.manager,data:{id:this.idPrefix+"go-back-btn",text:this.getMessage("go-back-btn-text",0),type:MathInteractives.global.Theme2.Button.TYPE.FA_ICONTEXT,colorType:MathInteractives.global.Theme2.Button.COLORTYPE.GREEN,icon:{faClass:"fa fa-arrow-left",height:18,width:28,fontColor:"#036f8a",fontSize:18},textPosition:"right",width:125,height:38,textColor:"#036f8a"}}),this.loadScreen("data-tab-button-screen")},_createTable:function(){var a=MathInteractives.global.Theme2DataTable.Model.Events,b={idPrefix:this.idPrefix,manager:this.manager,player:this.player,filePath:this.filePath,defaultRowCount:3,defaultColumnCount:this.options.defaultColumnCount,showCurrentRowColor:!1,enableTableSorting:!0,headerRowCustomClass:"conic-header-row",dataRowCustomClass:"conic-data-row",tableBorderClass:"conic-table-border",tableData:this.options.tableData,hasInputBoxInTable:!0,classForCustomSort:"center-sort",columnsForCustomSort:this.options.columnsForCoordinateSort,tabIndex:1605};this.tableModel=new MathInteractives.global.Theme2DataTable.Model(b),this.tableView=new MathInteractives.global.Theme2DataTable.View({model:this.tableModel,el:"#"+this.idPrefix+"record-data-table-container"}),this.tableModel.enableDisableTableHeaderClicks(!0),this.tableModel.enableDisableSortingOnColumn(!1,this.options.disabledColumns),this.tableModel.setNextAccElement("tbl-sort-notation-0"),this.tableModel.setPreviousAccElement("data-tab-acc-holder"),this.listenTo(this.tableModel,a.TABLE_SORT_COMPLETE,this._onTableSortComplete),this._setSortNotationIndex()},_setSortNotationIndex:function(){var a,b,c=2,d=this;for(b=0;5>b;b++)a={elementId:"tbl-sort-notation-"+b,tabIndex:1605+c,offsetTop:1,offsetLeft:2,acc:this.getMessage("sort-notaion-acc-text",0,[this.getAccMessage("data-table-header-text",b),this.getMessage("sort-notaion-acc-text",1)])},this.createAccDiv(a);this.focusOut("tbl-sort-notation-0",function(){d.fousOnsort()}),this.focusOut("tbl-sort-notation-1",function(){d.fousOnsort()}),this.focusOut("tbl-sort-notation-2",function(){d.fousOnsort()}),this.focusOut("tbl-sort-notation-3",function(){d.fousOnsort()}),this.focusOut("tbl-sort-notation-4",function(){d.fousOnsort()})},fousOnsort:function(){var a=this;a.focusInSort("tbl-sort-notation-0"),a.focusInSort("tbl-sort-notation-1"),a.focusInSort("tbl-sort-notation-2"),a.focusInSort("tbl-sort-notation-3"),a.focusInSort("tbl-sort-notation-4")},focusInSort:function(a){var b=parseInt(a.substr(a.length-1,1)),c=null,d=null,e=null;switch(b){case 0:c=this.getAccMessage("data-table-header-text",0);break;case 1:c=this.getAccMessage("data-table-header-text",1);break;case 2:c=this.getAccMessage("data-table-header-text",2);break;case 3:c=this.getAccMessage("data-table-header-text",3);break;case 4:c=this.getAccMessage("data-table-header-text",4)}this.$("#"+this.idPrefix+a).parent().parent().hasClass("sorting-enabled tbl-sort-asc")?(d=this.getMessage("sort-notaion-acc-text",2),e=this.getMessage("sort-notaion-acc-text",0,[c,d]),this.setAccMessage(a,e)):(d=this.getMessage("sort-notaion-acc-text",1),e=this.getMessage("sort-notaion-acc-text",0,[c,d]),this.setAccMessage(a,e))},_onTableSortComplete:function(){var a,b=null;this.player;3===this.$(".record-view-button").length&&(b=this.tableView.$("tr[rownumber*='1']").find(".record-view-button").attr("id").length,a=this.tableView.$("tr[rownumber*='1']").find(".record-view-button").attr("id").substring(b-1),this.setTabIndex("view-button-"+a,1630),a=this.tableView.$("tr[rownumber*='2']").find(".record-view-button").attr("id").substring(b-1),this.setTabIndex("view-button-"+a,1645),a=this.tableView.$("tr[rownumber*='3']").find(".record-view-button").attr("id").substring(b-1),this.setTabIndex("view-button-"+a,1660))},modifyTableRow:function(a,b){var c=this.tableModel.get("lastSortedColumn"),d=c.get("columnNumber"),e=c.get("sortingOrder");null!==e&&void 0!==e?(this.tableModel.sortColumn(0,0),this.tableModel.modifyTableRow(a,b),this.tableModel.sortColumn(d,e)):this.tableModel.modifyTableRow(a,b)},clearTableData:function(){var a,b,c,d=this.options.defaultColumnCount;for(null!==this.viewBtn1&&(this.viewBtn1.remove(),this.viewBtn2.remove(),this.viewBtn3.remove(),this.viewBtn1=null,this.viewBtn2=null,this.viewBtn3=null),this.tableModel.clearDataFromTable(),this.tableModel.enableDisableTableHeaderClicks(!0),this.tableModel.enableDisableSortingOnColumn(!1,this.options.disabledColumns),a=1;3>=a;a++){for(b={isHeaderRow:!1,rowData:[{text:a}]},c=1;d>c;c++)b.rowData.push({text:""});this.tableModel.addRow(b)}this._setSortNotationIndex()},generateViewButtons:function(){var a={idPrefix:this.idPrefix,player:this.player,manager:this.manager,path:this.filePath,data:{id:this.idPrefix+"view-button-1",text:this.getMessage("view-button-text",0),type:MathInteractives.global.Theme2.Button.TYPE.TEXT,colorType:MathInteractives.global.Theme2.Button.COLORTYPE.GREEN,height:22,width:74}};this.viewBtn1=new MathInteractives.global.Theme2.Button.generateButton(a),a.data.id=this.idPrefix+"view-button-2",this.viewBtn2=new MathInteractives.global.Theme2.Button.generateButton(a),a.data.id=this.idPrefix+"view-button-3",this.viewBtn3=new MathInteractives.global.Theme2.Button.generateButton(a),this.$(".attempt-number").addClass("added-buttons"),this.loadScreen("data-tab-table-button-screen")}})}(window.MathInteractives),function(){"use strict";MathInteractives.Common.Interactivities.ConicExplorer.Models.ConicPlotter=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:function(){return{showBubbles:!0,showGraph:!0,minBubbleLimit:10,maxBubbleLimit:30,currentSmallBubblesPosition:null,currentMiddleBubblesPosition:null,currentLargeBubblesPosition:null,smallBubbleGroup:null,middleBubbleGroup:null,largeBubbleGroup:null,showPopupOnTryAnother:!1,populateBubble:!0,noOfBubblesToPop:0,activityAreaStartPoint:{xCoordinate:143,yCoordinate:87},activityAreaEndPoint:{xCoordinate:915,yCoordinate:530},startPointBubble:{xCoordinate:158,yCoordinate:102},endPointBubble:{xCoordinate:896,yCoordinate:525},generateNewBubbles:!0,showEquation:!0,dummyBubblePath:new Array,intersectBubblesArray:new Array,shape:"conic",foci1:null,foci2:null,center:null,shapeCenter:null,majorAxis:60,minorAxis:30,tackToFoci1:null,tackToFoci2:null,thumbTack:null,circumferencePath:null,prevAngle:null,currentPointIndex:null,positionCounter:null,purple:null,red:null,black:null,purpleBar:null,redBar:null,purpleStringRaster:null,redStringRaster:null,blackStringRaster:null,purpleStringBarRaster:null,redStringBarRaster:null,fociCenterDist:null,fociDist:null,lastIndex:null,restrictMovementAlongCircumference:!1,isFociMovable:!0,isCenterMovable:!0,isThumbTackMovable:!0,animationStarted:!1,lableA:null,lableB:null,lineA:null,lineB:null,dashedShape:null,deletaXLine:null,deletaXLineLabel:null,deltaYLine:null,deletaYLineLabel:null,shapeCenterSnapX:0,shapeCenterSnapY:0,equationEllipseB:null,equationEllipseA:null,ellipseCenterCoordinate:null,showPoppedBubbles:!1,circlePoint:null,centerCoordinate:null,circlePointCoordinate:null,thumbTackCoordinate:null,radiusString:null,bubblesBoundsCenter:null,circleDeltaX:null,draggingDisabled:!1,circleDeltaY:null,circleRadius:null,allBubbleGroup:null,shapeCenterCircle:null,isReplay:!1,isVertical:!1}},initialize:function(){this.set("dummyBubblePath",[]),this.set("intersectBubblesArray",[])},getMinBubbleLimit:function(){return this.get("minBubbleLimit")},setMinBubbleLimit:function(a){this.set("minBubbleLimit",a)},getMaxBubbleLimit:function(){return this.get("maxBubbleLimit")},setMaxBubbleLimit:function(a){this.set("maxBubbleLimit",a)},getShowGraph:function(){return this.get("showGraph")},setShowGraph:function(a){this.set("showGraph",a)},getShowBubbles:function(){return this.get("showBubbles")},setShowBubbles:function(a){this.set("showBubbles",a)},getStartPointBubble:function(){return this.get("startPointBubble")},setStartPoint:function(a,b){var c=this.getStartPointBubble();c.xCoordinate=a,c.yCoordinate=b},getEndPointBubble:function(){return this.get("endPointBubble")},setEndPoint:function(a,b){var c=this.getEndPointBubble();c.xCoordinate=a,c.yCoordinate=b},getSmallerBubbleRadius:function(){return this.get("smallerBubbleRadius")},getMiddleBubbleRadius:function(){return this.get("middleBubbleRadius")},getLargerBubbleRadius:function(){return this.get("largerBubbleRadius")},setSmallerBubbleRadius:function(a){this.set("smallerBubbleRadius",a)},setLargerBubbleRadius:function(a){this.set("largerBubbleRadius",a)},setMiddleBubbleRadius:function(a){this.set("middleBubbleRadius",a)},generateRandomNumber:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},isPointValid:function(a){var b=!1,c=this.get("activityAreaStartPoint"),d=this.get("activityAreaEndPoint"),e=this.get("foci1").position,f=this.get("foci2").position,g=this.get("thumbTack").position,h=this.get("shapeCenter").position;return a.x>c.xCoordinate&&a.x<d.xCoordinate&&a.y>c.yCoordinate&&a.y<d.yCoordinate&&e.x>c.xCoordinate&&e.x<d.xCoordinate&&e.y>c.yCoordinate&&e.y<d.yCoordinate&&f.x>c.xCoordinate&&f.x<d.xCoordinate&&f.y>c.yCoordinate&&f.y<d.yCoordinate&&g.x>c.xCoordinate&&g.x<d.xCoordinate&&g.y>c.yCoordinate&&g.y<d.yCoordinate&&h.x>c.xCoordinate&&h.x<d.xCoordinate&&h.y>c.yCoordinate&&h.y<d.yCoordinate&&(b=!0),b},setPositionsOfBubbles:function(){var a=this.get("startPointBubble"),b=this.get("endPointBubble"),c=15,d=a.xCoordinate+c,e=a.yCoordinate+c,f=b.xCoordinate-c,g=b.yCoordinate-c,h=this.get("bubblesBoundsCenter"),i=h.x,j=h.y,k=30,l=55,m=new Array,n=null,o=null,p=null;for(n=this.generateRandomNumber(k,l),o=Math.ceil(n/4),p=0;o>p;p++)this.setCurrentArrayValue(m,d,i,e,j),this.setCurrentArrayValue(m,i,f,e,j),this.setCurrentArrayValue(m,d,i,j,g);for(4*o>n&&(o=n-m.length),p=0;o>p;p++)this.setCurrentArrayValue(m,i,f,j,g);return m},setCurrentArrayValue:function(a,b,c,d,e){var f=this,g=null,h=null,i=a.length,j=null,k=MathInteractives.Common.Components.Models.ExplorerShape.MIN_DIST_TWO_POINTS,l=null,m=[],n=null;do for(n=!1,g=f.generateRandomNumber(b,c),h=f.generateRandomNumber(d,e),m[0]=g,m[1]=h,l=0;i>l;l++)j=f.getDistance(m,a[l]),k>j&&(n=!0);while(n);a.push(m)},getDistance:function(a,b){var c=Math.pow(Math.abs(a[0]-b[0]),2),d=Math.pow(Math.abs(a[1]-b[1]),2);return Math.sqrt(c+d)},setDummyBubblePath:function(a){var b=this.get("dummyBubblePath");b.push(a)}},{MIN_DIST_TWO_POINTS:34,createExplorerShapeModel:function(a){return new MathInteractives.Common.Components.Models.ExplorerShape(a)}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ConicExplorer.templates=MathInteractives.Common.Interactivities.ConicExplorer.templates||{};b.conicExplorerGraph=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='\ufeff<div class="conic-graph-acc-container"></div>\r\n<div class="canvas-holder">\r\n  <canvas class="canvas-element" height="',(f=c.height)?f=f.call(b,{hash:{},data:e}):(f=b.height,f=typeof f===h?f.apply(b):f),g+=i(f)+'" width="',(f=c.width)?f=f.call(b,{hash:{},data:e}):(f=b.width,f=typeof f===h?f.apply(b):f),g+=i(f)+'"></canvas>\r\n</div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ConicExplorer.templates=MathInteractives.Common.Interactivities.ConicExplorer.templates||{};b.dataTab=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='\ufeff<div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'your-data-label" class="your-data-label"></div>\r\n<div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'dummy-view-button-1" class="dummy-view-button-1"></div>\r\n<div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'record-data-table-container" class="record-data-table-container"></div>\r\n<div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'horizontal-diagram-container" class="horizontal-diagram-container">\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'horizontal-equation-container" class="equation-container">\r\n        <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'horizontal-equation-label" class="horizontal-equation-label"></div>\r\n        <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'horizontal-equation-text" class="horizontal-equation-text"></div>\r\n    </div>\r\n    <div class="horizontal-separator"></div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'horizontal-diagram-image" class="horizontal-diagram-image"></div>\r\n</div>\r\n<div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'vertical-separator" class="vertical-separator"></div>\r\n<div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'vertical-diagram-container" class="vertical-diagram-container">\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'vertical-equation-container" class="equation-container">\r\n        <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'vertical-equation-label" class="vertical-equation-label"></div>\r\n        <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'vertical-equation-text" class="vertical-equation-text"></div>\r\n    </div>\r\n    <div class="horizontal-separator"></div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'vertical-diagram-image" class="vertical-diagram-image"></div>\r\n</div>\r\n<div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'go-back-btn" class="go-back-btn"></div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ConicExplorer.templates=MathInteractives.Common.Interactivities.ConicExplorer.templates||{};b.equationHolder=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='\ufeff<div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-formula" class="graph-formula">\r\n  <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-normal-formula">\r\n  <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-first-equation" class="graph-first-equation">\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-first-numerator" class="graph-first-numerator">\r\n    <sup>2</sup>\r\n    </div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-bar" class="graph-bar"></div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-first-denominator" class="graph-first-denominator">\r\n  <sup>2</sup>\r\n    </div>\r\n  </div>\r\n  <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-plus" class="graph-plus"> &minus; </div>\r\n  <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-second-equation" class="graph-second-equation">\r\n\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-second-numerator" class="graph-second-numerator">\r\n\r\n  <sup>2</sup>\r\n    </div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-bar" class="graph-bar"></div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-second-denominator" class="graph-second-denominator">\r\n   <sup>2</sup>\r\n    </div>\r\n  </div>\r\n  <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-equal-to-row" class="graph-equal-to">=</div>\r\n  <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'graph-one-row" class="graph-one">1</div>\r\n  </div>\r\n  <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'degenerated-formula" class="degenerated-formula">\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'degenerated-x" class="degenerated-x"></div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'degenerated-equal-to-row" class="degenerated-equal-to-row">=</div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'degenerated-y" class="degenerated-y"></div>\r\n  </div>\r\n  </div>\r\n</div>\r\n'})}();