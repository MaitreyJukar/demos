!function(){"use strict";var a=null;"undefined"==typeof MathInteractives.Interactivities.ArchaeologicalDig&&(MathInteractives.Common.Interactivities.ArchaeologicalDig={},MathInteractives.Common.Interactivities.ArchaeologicalDig.Views={},MathInteractives.Common.Interactivities.ArchaeologicalDig.Models={}),MathInteractives.Common.Interactivities.ArchaeologicalDig.Models.ArchaeologicalDig=MathInteractives.Common.Player.Models.Base.extend({defaults:{currentTab:1,state:null,currentArtifact:null,nextArtifactIndex:null,artifactParts:[],junks:[],villain:{},steperStatus:{},currentElementFound:null,availableJunksForVillain:null,upperLimit:null,emptyPlacesAvailable:[],emptyPlacesFound:[],helpElements:[],interacivityType:null},junkPickUpIndex:0,allFoundPlaces:[],hasvillainPlaceUsed:!1,initialize:function(){var a=this.get("interacivityType");this._attachEvents(),null===a||a!==this.get("type")?(this.setUpNewGame("initialize"),this.set("interacivityType",this.get("type"))):this._populateAllFoundPlaces()},_populateAllFoundPlaces:function(){var a=this.get("artifactParts"),b=this.get("junks"),c=this.get("emptyPlacesFound");this.allFoundPlaces.length>0&&(this.allFoundPlaces=[]);for(var d=0;3>d;d++)a[d].isFound===!0&&this.allFoundPlaces.push(a[d].x+"_"+a[d].y);for(var d=0;5>d;d++)for(var e=0;e<b[d].positionDetails.length;e++)b[d].positionDetails[e].isFound===!0&&this.allFoundPlaces.push(b[d].positionDetails[e].x+"_"+b[d].positionDetails[e].y);for(var d=0;d<c.length;d++)this.allFoundPlaces.push(c[d])},getState:function(){return this.get("state")},setState:function(a){this.set("state",a)},getUpperLimit:function(){return this.get("upperLimit")},setUpperLimit:function(a){this.set("upperLimit",a)},getEmptyPlacesAvailable:function(){return this.get("emptyPlacesAvailable")},setEmptyPlacesAvailable:function(a){this.set("emptyPlacesAvailable",a)},getEmptyPlacesFound:function(){return this.get("emptyPlacesFound")},setEmptyPlacesFound:function(a){this.set("emptyPlacesFound",a)},_attachEvents:function(){this.on("artifactPartFound",this._artifactPartFoundHandler),this.on("junkFound",this._junkFoundHandler),this.on("villainFound",this._villainFoundHandler),this.on("emptyPalceFound",this._emptyPlaceFoundHandler)},setUpNewGame:function(a){"tryAnother"===a&&this.set("currentArtifact",null),this._setUpperLimit(),this.initializeJsonStructure(a),this._initializeEmptyPalceArray(),this._placeCharacters();for(var b=0;3>b;b++);},_setUpperLimit:function(){1==this.get("type")?this.setUpperLimit(5):2==this.get("type")&&this.setUpperLimit(6)},_initializeEmptyPalceArray:function(){for(var a=this.getUpperLimit(),b=[],c=null,d=0;a>=d;d++)for(var e=0;a>=e;e++)c=d+"_"+e,b.push(c);this.setEmptyPlacesAvailable(b)},_placeCharacters:function(){this._placeArtifacts(),this.placeVillain()},_placeArtifacts:function(){for(var a=this.get("artifactParts"),b=0;3>b;b++){var c=this._getEmptyPlace();a[b].x=parseInt(c[0]),a[b].y=parseInt(c[1]),this._setJunksParameter(a[b].x,a[b].y)}},_getEmptyPlace:function(){var a=this.getEmptyPlacesAvailable(),b=null,c=null;return a.length>0?(b=Math.floor(Math.random()*a.length),c=a.splice(b,1)[0].split("_")):c="full",c},_setJunksParameter:function(a,b){var c=this.getUpperLimit(),d={};c>=b+1&&(d.x=a,d.y=b+1,d.emptyPosition=a+"_"+(b+1),this._placeJunk(d)),c>=a+1&&(d.x=a+1,d.y=b,d.emptyPosition=a+1+"_"+b,this._placeJunk(d)),b-1>=0&&(d.x=a,d.y=b-1,d.emptyPosition=a+"_"+(b-1),this._placeJunk(d)),a-1>=0&&(d.x=a-1,d.y=b,d.emptyPosition=a-1+"_"+b,this._placeJunk(d))},_placeJunk:function(a){var b=this.get("junks"),c=null,d={},e=!1,f=this.getEmptyPlacesAvailable(),g=this.get("villain");c=$.inArray(a.emptyPosition,f),c>-1?(f.splice(c,1),e=!0):a.x===g.x&&a.y===g.y&&(e=!0,this.hasvillainPlaceUsed=!0),e&&(d.x=a.x,d.y=a.y,d.isFound=!1,b[this.junkPickUpIndex].positionDetails.push(d),4===this.junkPickUpIndex?this.junkPickUpIndex=0:this.junkPickUpIndex++)},_updateAvailableJunksForVillain:function(a){var b=this.get("availableJunksForVillain");"+"===a?b++:b--,this.set("availableJunksForVillain",b)},placeVillain:function(){var a,b=this.get("villain"),c=null,d=null,e=this.getEmptyPlacesAvailable();c=this._getEmptyPlace(),"full"===c?this._NoEmptyPalceConditionHandler("villain"):(a=b.x,d=b.y,b.x=parseInt(c[0]),b.y=parseInt(c[1]),b.villainStateType=null,null!==a&&null!==d&&this.hasvillainPlaceUsed===!1&&(e.push(a+"_"+d),this.setEmptyPlacesAvailable(e))),this.hasvillainPlaceUsed=!1},rehideArtifactsParts:function(a){for(var b,c=this.get("artifactParts"),d=null,e=null,f=this.getEmptyPlacesAvailable(),g=null,h=0;h<a.length-1;h++){if(d=this._getFeasibleEmptyPlace(),"full"===d)return this._NoEmptyPalceConditionHandler("artifactsParts",a),!0;b=c[a[h]].x,e=c[a[h]].y,c[a[h]].x=parseInt(d[0]),c[a[h]].y=parseInt(d[1]),c[a[h]].isFound=!1,f.push(b+"_"+e),g=this.allFoundPlaces.indexOf(b+"_"+e),g>-1&&this.allFoundPlaces.splice(g,1),this.setEmptyPlacesAvailable(f),this._setJunksParameter(c[a[h]].x,c[a[h]].y)}return!1},_getFeasibleEmptyPlace:function(){var a=this.getEmptyPlacesAvailable(),b=null,c=[],d=[],e=[],f=[],g=[],h=null,i=null,j=[];if(0===a.length)return b="full";for(var k=0;k<a.length;k++)switch(h=this._getSidesCount(a[k])){case 4:c.push(a[k]);break;case 3:d.push(a[k]);break;case 2:e.push(a[k]);break;case 1:f.push(a[k]);break;case 0:g.push(a[k])}return j=g,c.length>0?j=c:d.length>0?j=d:e.length>0?j=e:f.length>0&&(j=f),i=Math.floor(Math.random()*j.length),b=j.splice(i,1)[0],i=a.indexOf(b),b=a.splice(i,1)[0].split("_")},_getSidesCount:function(a){var b=null,c=null,d=null,e=null,f=null,g=0,h=this.getUpperLimit(),i=this.get("junks"),j=[];b=parseInt(a.split("_")[0]),c=parseInt(a.split("_")[1]);for(var k=0;k<i.length;k++)for(var l=0;l<i[k].positionDetails.length;l++)j.push(i[k].positionDetails[l].x+"_"+i[k].positionDetails[l].y);return h>=c+1&&(d=b+"_"+(c+1),e=this.allFoundPlaces.indexOf(d),f=j.indexOf(d),(-1===e||f>-1)&&g++),h>=b+1&&(d=b+1+"_"+c,e=this.allFoundPlaces.indexOf(d),f=j.indexOf(d),(-1===e||f>-1)&&g++),c-1>=0&&(d=b+"_"+(c-1),e=this.allFoundPlaces.indexOf(d),f=j.indexOf(d),(-1===e||f>-1)&&g++),b-1>=0&&(d=b-1+"_"+c,e=this.allFoundPlaces.indexOf(d),f=j.indexOf(d),(-1===e||f>-1)&&g++),g},_NoEmptyPalceConditionHandler:function(a,b){var c=this.get("villain"),d=this.get("artifactParts"),e=null,f=null,g={};switch(a){case"villain":return void(c.villainStateType=null);case"artifactsParts":b.length-1===1?e=d[b[0]]:b.length-1===2&&(e=d[b[0]],f=d[b[1]])}null===f?(g.x=c.x,g.y=c.y,c.x=e.x,c.y=e.y,e.x=g.x,e.y=g.y,c.villainStateType=null,e.isFound=!1):null!==f&&(g.x=c.x,g.y=c.y,c.x=e.x,c.y=e.y,e.x=f.x,e.y=f.y,f.x=g.x,f.y=g.y,c.villainStateType=null,e.isFound=!1,f.isFound=!1)},_artifactPartFoundHandler:function(a,b){b||(a.isFound=!0,this.trigger("display-Artifact-Part",a),this.allFoundPlaces.push(a.x+"_"+a.y))},_junkFoundHandler:function(a,b,c){c||(a.positionDetails[b].isFound=!0,this.trigger("display-Junk",a,b),this.allFoundPlaces.push(a.positionDetails[b].x+"_"+a.positionDetails[b].y),this._updateAvailableJunksForVillain("+"))},_villainFoundHandler:function(a){for(var b=this.get("artifactParts"),c=this.get("availableJunksForVillain"),d=0,e=0;3>e;e++)b[e].isFound===!0&&d++;d+c>=1?a.villainStateType="payUp":a.villainStateType="warrning"},_emptyPlaceFoundHandler:function(a,b,c){if(!c){var d=this.getEmptyPlacesFound(),e=b.splice(a,1)[0];d.push(e),this.allFoundPlaces.push(e),this.trigger("display-Empty-Place")}},initializeJsonStructure:function(b){var c=0,d=3,e=[],f={},g=this.get("nextArtifactIndex");if(null===this.get("currentArtifact")||"initialize"===b){this.setState(null),c="tryAnother"===b?3===g?0:g:Math.floor(Math.random()*d),this.set("currentArtifact",a.CURRENT_ARTIFACT[c].id),this.set("nextArtifactIndex",c+1);for(var h=0;3>h;h++)f={},f.id=a.ARTIFACT_PARTS[c][h].name,f.x=null,f.y=null,f.isFound=!1,e.push(f);this.set("artifactParts",e),e=[];for(var h=0;5>h;h++)f={},f.id=a.JUNKS[h].id,f.positionDetails=[],e.push(f);this.set("junks",e),f={},f.x=null,f.y=null,f.villainStateType=null,this.set("villain",f),this.set("availableJunksForVillain",0),f={},f.x=0,f.y=0,f.isDigEnable=!0,this.set("steperStatus",f),this.set("currentElementFound",null),this.set("emptyPlacesAvailable",[]),this.set("emptyPlacesFound",[])}},getCurrentStateData:function(){var a=JSON.stringify(this,this.getJSONAttributes);return a},getJSONAttributes:function(a,b){var c=b;switch(a){case"path":case"manager":case"player":case"idPrefix":case"jsonData":case"helpElements":c=void 0}return c}},{CURRENT_ARTIFACT:[{id:"duck"},{id:"jester"},{id:"brush"}],ARTIFACT_PARTS:[[{name:"body"},{name:"sceptre"},{name:"crown"}],[{name:"box"},{name:"jack"},{name:"crank"}],[{name:"handle"},{name:"brush-head"},{name:"jewel"}]],JUNKS:[{id:"battery"},{id:"tin"},{id:"pin"},{id:"bolt"},{id:"cassete"}]}),a=MathInteractives.Common.Interactivities.ArchaeologicalDig.Models.ArchaeologicalDig}(),function(){"use strict";MathInteractives.Common.Interactivities.ArchaeologicalDig.Views.Overview=MathInteractives.Common.Player.Views.Base.extend({filePath:null,manager:null,player:null,idPrefix:null,initialize:function(){this.initializeDefaultProperties(),this.idPrefix=this.player.getIDPrefix(),this.loadScreen("overview-tab"),this.loadScreen("archaeological-dig")}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Interactivities.ArchaeologicalDig.templates=MathInteractives.Common.Interactivities.ArchaeologicalDig.templates||{};b.overview=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'overview-tab" class="overview-tab-main-container">\r\n\r\n</div>'})}();