!function(){"use strict";MathInteractives.Common.Components.Views.Button=MathInteractives.Common.Player.Views.Base.extend({player:null,idPrefix:null,manager:null,isLeftDown:!1,$btn:null,_isCustomButton:null,btnTooltipView:null,_height:32,_padding:10,_backgroundPositions:null,_heightChanged:!1,filePath:null,_btnType:null,_btnImgSlice:null,_btnContentPadding:10,btnWidthGroup:null,_isLegendDown:!1,_touchStartTimer:null,initialize:function(){this.player=this.model.get("player"),this.idPrefix=this.model.get("idPrefix"),this.manager=this.model.get("manager"),this._btnType=this.model.get("type"),this.filePath=this.model.get("path");var a=this.model.get("height");this._btnType.height?this._height=this._btnType.height:null!==a&&a!==this._height&&(this._height=a);var b=this.model.get("padding");null!==b&&(this._padding=b),this._btnType===MathInteractives.Common.Components.Views.Button.TYPE.CUSTOM&&(this._isCustomButton=!0),this.render(),this._attachEvents(),this._attachTooltip(),(this._btnType.isDraggable||this.model.get("isDraggable"))&&this._addDraggableIcon()},render:function(){this.$btn=this.$el;var a=this.model.get("text"),b=this.model.get("icon"),c=this.model.get("imagePathIds"),d=this.model.get("width"),e=this.model.get("displayType");if(e=e||null,0===this.el.id.length&&(this.$btn=$("#"+this.model.get("id"))),this._isCustomButton?c&&(1===c.length?this._btnImgSlice=MathInteractives.Common.Components.Views.Button.IMAGESLICE.SINGLE:2===c.length&&(this._btnImgSlice=MathInteractives.Common.Components.Views.Button.IMAGESLICE.THREE)):(this._btnImgSlice=this._btnType.slice,this._btnType.icon&&"both"!==e?(b=this._btnType.icon,this.model.set("icon",b)):this._btnType.hasText&&(this.loadScreen("common-button-text"),a=this.getMessage("common-button-text",this._btnType.id+"-button"),this.model.set("text",a),"both"===e&&(b=this._btnType.icon,this.model.set("icon",b)))),b&&(b.pathId||(b.pathId="buttons-icons"),b.iconClass||(b.iconClass=""),this.model.set("icon",b)),this._btnImgSlice===MathInteractives.Common.Components.Views.Button.IMAGESLICE.THREE)this._isCustomButton||this._getImageHeightWidth(this._btnType.category+"-button").width,this._generateButton();else if(this._btnImgSlice===MathInteractives.Common.Components.Views.Button.IMAGESLICE.SINGLE){if(this._isCustomButton)this.$btn.css({"background-image":'url("'+this.filePath.getImagePath(c[0])+'")'});else{var f=this._btnType.category+"-button";this.$btn.css({"background-image":'url("'+this.filePath.getImagePath(this._btnType.category+"-button")+'")'}).addClass(f),this.model.set("baseClass",f),this._height=this.$btn.height(),d=this.$btn.width()}if(null!==b){var g=$("<div>",{"class":"button-icon button-content"}).css({height:b.height,width:b.width,"margin-top":this._height/2-b.height/2,"margin-left":d/2-b.width/2,"background-image":'url("'+this.filePath.getImagePath(b.pathId)+'")'}).addClass(b.iconClass);this.$btn.append(g)}else if(null!==a){var h=this._getTextHeightWidth(a,this._btnType.category+"-button-text",this._btnType.category+"-button"),i=$("<div>",{"class":this._btnType.category+"-button-text button-content",text:a}).css({"margin-top":this._height/2-h.height/2,"margin-left":d/2-h.width/2});this.$btn.append(i)}this.$btn.css({height:this._height,width:d}).addClass(this._btnType.category+"-button click-enabled")}this._resizeGrpBtnWidth(),this.model.get("isLegend")===!0&&(this.$btn.off("click.graphlegend"),this.$btn.on("click.graphlegend",$.proxy(this._legendClick,this)))},_resizeGrpBtnWidth:function(){this.btnWidthGroup=this.model.get("btnWidthGroup");var a,b,c,d,e,f,g=this.btnWidthGroup;if(void 0!=g){this.$el.addClass(g),a=$("."+g),c=this.$el.find(".mid-child").width(),f=this.$el.find(this.$el.children()[0]).width(),d=c+2*f;for(var h=0;h<a.length;h++)b=a[h],e=$("#"+b.id).width(),e>d&&(d=e,c=d-2*f);for(h=0;h<a.length;h++)b=$(a[h]),b.css("width",d),b.find(".mid-child").css("width",c),b.find(".button-content").css({width:c+2*f,"margin-left":"auto","margin-right":"auto"})}},_generateButton:function(){var a,b,c,d,e,f=(this.model.get("imagePathIds"),this.model.get("width")),g=this.model.get("text"),h=this.model.get("icon"),i=this.model.get("displayType")||null,j=this.model.get("iConPosition")||"right",k=null,l=null,m=null,n=null,o=null,p=null,q=this.$btn,r=null,s=null;if(b=$("<div>",{"class":this._btnType.category+"-button-first-child"}),c=$("<div>",{"class":this._btnType.category+"-button-mid-child mid-child"}),d=$("<div>",{"class":this._btnType.category+"-button-third-child"}),this.$btn.html("").append(b).append(c).append(d).addClass(this._btnType.category+"-button button-common click-enabled"),"both"!==i)if(null!==h)f?this._btnContentPadding=(f-h.width)/2:f=h.width+2*this._btnContentPadding,e=$("<div>",{"class":"button-icon button-content"}).css({height:h.height,width:h.width,"margin-top":this._height/2-h.height/2,"margin-left":this._btnContentPadding,"background-image":'url("'+this.filePath.getImagePath(h.pathId)+'")'}).addClass(h.iconClass),this.$btn.append(e);else{e=$("<div>",{"class":this._btnType.category+"-button-text button-content"}),this.$btn.append(e),e.html(this.model.get("text"));var t=this._getTextHeightWidth(g,this._btnType.category+"-button-text",this._btnType.category+"-button"),u=t.width,v=t.height;f?this._btnContentPadding=(f-u)/2:f=u+2*this._btnContentPadding,this.model.get("fixedMinWidth")===!0&&(this._btnType.category===MathInteractives.Common.Components.Views.Button.TYPE.GENERAL.category||this._btnType.category===MathInteractives.Common.Components.Views.Button.TYPE.ACTION.category)&&f<MathInteractives.Common.Components.Views.Button.BUTTON_MIN_WIDTH&&(f=MathInteractives.Common.Components.Views.Button.BUTTON_MIN_WIDTH),this._btnContentPadding=(f-u)/2,e.css({"margin-top":Math.ceil((this._height-v)/2),"margin-left":this._btnContentPadding})}else r=h.width,s=this._getTextHeightWidth(g,this._btnType.category+"-button-text",this._btnType.category+"-button").width,k=document.createElement("div"),m=document.createElement("div"),o=document.createElement("div"),l=$(k).addClass(this._btnType.category+"-button"),n=$(m),p=$(o).addClass(this._btnType.category+"-button-text"),f=r+s+5,q.append(l).css({width:f}),c.css({width:f-14}),n=$("<div>",{"class":"button-icon button-content"}).css({height:h.height,width:h.width,"background-image":'url("'+this.filePath.getImagePath(h.pathId)+'")',position:"relative","float":"left"}).addClass(h.iconClass),p.html(g).css({"line-height":q.height()+"px",width:s,position:"relative","float":"left"}),l.css({position:"absolute"}),"left"===j?(l.append(n).append(p),p.css({}),n.css({})):"right"===j&&(l.append(p).append(n),p.css({"margin-left":"5px"}));this.$btn.css({width:f}),this._height&&this.$btn.css({height:this._height});var w=b.width();if(a=f-2*w,this._isCustomButton){var x=this.model.get("cornerSliceImgWidth");x&&(b.css({width:x}),d.css({width:x}),a=f-2*x)}c.css({width:a}),this._isCustomButton?(this._changeImage(),null!==h?this._changeHeight(e,!0):this._changeHeight(e,!1)):(b.css({"background-image":'url("'+this.filePath.getImagePath(this._btnType.category+"-button")+'")'}),c.css({"background-image":'url("'+this.filePath.getImagePath(this._btnType.category+"-button-mid")+'")'}),d.css({"background-image":'url("'+this.filePath.getImagePath(this._btnType.category+"-button")+'")'}))},_getTextHeightWidth:function(a,b,c){if(this.player)return this.player.getTextHeightWidth(a,b,null,c);var d={height:0,width:0},e=this.$el.parents(".de-mathematics-interactive").find("#text-dimentions-hack-holder-wrapper").addClass(c),f=e.find("#text-dimentions-hack-holder").addClass(b).html(a);return a&&""!==a&&(d.height=f.getTextHeight(),d.width=f.getTextWidth()),e.removeClass(c),f.removeClass(b).html(""),d},_getImageHeightWidth:function(a){var b={height:0,width:0},c=$("<img>",{src:this.filePath.getImagePath(a)});return $("body").append(c),b.height=c.height(),b.width=c.width(),c.hide(),c.remove(),b},_getButtonHeight:function(a){var b,c=a.clone().removeAttr("id").appendTo($("body")).addClass("de-mathematics-interactive").css({"font-size":a.css("font-size"),"font-weight":a.css("font-weight"),height:a.css("height"),"text-align":a.css("text-align")});return b=c.getTextHeight(),c.hide(),c.remove(),b},_changeImage:function(){var a=this.model.get("imagePathIds"),b=this;if(null!==a){var c=this._btnType.category;this.$btn.find("div").each(function(d){$(this).hasClass(c+"-button-first-child")||$(this).hasClass(c+"-button-third-child")?$(this).css({"background-image":'url("'+b.filePath.getImagePath(a[0])+'")'}):$(this).hasClass(c+"-button-mid-child")&&$(this).css({"background-image":'url("'+b.filePath.getImagePath(a[1])+'")'})})}},_changeHeight:function(a,b){var c=this._height;if(this.$btn.find("div").each(function(a){(0===a||1===a||2===a)&&$(this).css({height:c})}),this.$btn.css({height:c}),b){var d=this.model.get("icon");a.css({"margin-top":c/2-d.height/2})}else{var e=this._getTextHeightWidth(this.model.get("text"),this._btnType.category+"-button-text",this._btnType.category+"-button");a.css({"margin-top":(c-e.height)/2})}this._generateBackgroundPosition()},_generateBackgroundPosition:function(){var a={active:{},hover:{},down:{},disabled:{},selected:{}},b=this._height,c=this._padding,d=b+c,e=0,f=2*d,g=4*d,h=6*d,i=8*d;a.active[0]=e,a.hover[0]=f,a.down[0]=g,a.disabled[0]=h,a.selected[0]=i,a.active[1]=0,a.hover[1]=d,a.down[1]=2*d,a.disabled[1]=3*d,a.selected[1]=4*d,a.active[2]=e+d,a.hover[2]=f+d,a.down[2]=g+d,a.disabled[2]=h+d,a.selected[2]=i+d,this._backgroundPositions=a,this._applyNewPosition("active")},_applyNewPosition:function(a){var b=this._backgroundPositions[a],c=(this.$btn.find("div"),this._btnType.category),d=this.model.get("imagePositions")||[0,0,0];this.$btn.find("div").each(function(a){$(this).hasClass(c+"-button-first-child")?$(this).css({"background-position":"0px -"+(b[0]+d[0])+"px"}):$(this).hasClass(c+"-button-mid-child")?$(this).css({"background-position":"0px -"+(b[1]+d[1])+"px"}):$(this).hasClass(c+"-button-third-child")&&$(this).css({"background-position":"0px -"+(b[2]+d[2])+"px"})})},_attachEvents:function(){var a=this.$btn;a.on("mouseover",$.proxy(this._onMouseOver,this)),a.on("mouseout",$.proxy(this._onMouseOut,this)),a.on("mousedown",$.proxy(this._onMouseDown,this)),a.on("mouseup",$.proxy(this._removeTooltip,this)),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(a),a.on("click",$.proxy(this._onToggle,this))},setButtonState:function(a){var b=MathInteractives.Common.Components.Views.Button,c=this.model.get("baseClass"),d=null,e=null,f="disabled",g="down",h="selected",i="hover",j=this.manager,k=this._btnImgSlice===MathInteractives.Common.Components.Views.Button.IMAGESLICE.THREE?!0:!1;switch(this.$btn.find("div").removeClass(f+" "+g+" "+h+" "+i),k||(f=c+"-disabled",g=c+"-down",h=c+"-selected",i=c+"-hover",this.$btn.removeClass(f+" "+g+" "+h+" "+i)),a){case b.BUTTON_STATE_ACTIVE:e=b.BUTTON_STATE_ACTIVE,d=k?"active":c,this.$btn.addClass("click-enabled"),j&&j.enableTab(this.$btn.attr("id"),!0);break;case b.BUTTON_STATE_SELECTED:e=b.BUTTON_STATE_SELECTED,d=k?"selected":c+"-selected";var l=this.$btn,m=this;setTimeout(function(){m.getButtonState()===MathInteractives.Common.Components.Views.Button.BUTTON_STATE_DISABLED&&(l.removeClass("click-enabled"),j&&j.enableTab(l.attr("id"),!1))},1);break;case b.BUTTON_STATE_DISABLED:e=b.BUTTON_STATE_DISABLED,d=k?"disabled":c+"-disabled";var l=this.$btn,m=this;setTimeout(function(){m.getButtonState()===MathInteractives.Common.Components.Views.Button.BUTTON_STATE_DISABLED&&(l.removeClass("click-enabled"),j&&j.enableTab(l.attr("id"),!1))},1)}k?(this.$btn.find("div").addClass(d),this._isCustomButton&&this._applyNewPosition(d)):(this.$btn.addClass(d),this.$btn.find("div").addClass(e)),this.model.currentState=e},getButtonState:function(){return this.model.currentState},_isBtnActive:function(){var a=!1;return this.model.currentState===MathInteractives.Common.Components.Views.Button.BUTTON_STATE_ACTIVE&&(a=!0),a},_onMouseOver:function(a){var b=this.model.get("toggleButton"),c=this.getButtonState(),d=MathInteractives.Common.Components.Views.Button.BUTTON_STATE_DISABLED;if(!b&&!this._isBtnActive()||b&&c===d)return this.$btn.data("isPushButton")&&c!==d||this.$btn.children().each(function(){$(this).css("cursor","default")}),void(this.btnTooltipView&&(this.btnTooltipView.updateElementPos(this.$btn.offset()),this.btnTooltipView.showTooltip()));if(b&&c===MathInteractives.Common.Components.Views.Button.BUTTON_STATE_SELECTED)return this.$btn.children().each(function(){$(this).css("cursor","pointer")}),void(this.btnTooltipView&&(this.btnTooltipView.updateElementPos(this.$btn.offset()),this.btnTooltipView.showTooltip()));var e=this.getBaseClass();this._btnImgSlice===MathInteractives.Common.Components.Views.Button.IMAGESLICE.THREE?this.$btn.find("div").hasClass("down")||(this.$btn.find("div").addClass("hover"),this._isCustomButton&&this._applyNewPosition("hover")):this.$btn.addClass(e+"-hover"),this.$btn.children().each(function(){$(this).css("cursor","pointer")}),this.btnTooltipView&&(this.btnTooltipView.updateElementPos(this.$btn.offset()),this.btnTooltipView.showTooltip())},_onMouseOut:function(a){var b=this.model.get("toggleButton"),c=this.getButtonState(),d=MathInteractives.Common.Components.Views.Button.BUTTON_STATE_DISABLED;if(!b&&!this._isBtnActive()||b&&c===d)return this.$btn.data("isPushButton")&&c!==d||this.$btn.children().each(function(){$(this).css("cursor","default")}),void this._removeTooltip();var e=this.getBaseClass();this._btnImgSlice===MathInteractives.Common.Components.Views.Button.IMAGESLICE.THREE?(this.$btn.find("div").removeClass("hover"),this._isCustomButton&&(this.$btn.find("div").hasClass("down")?this._applyNewPosition("down"):this._applyNewPosition("active"))):this.$btn.removeClass(e+"-hover"),this._removeTooltip()},_onMouseDown:function(a){if(this._isBtnActive()){if($(document).one({mouseup:$.proxy(this._onMouseup,this)}),1!==a.which)return void((this.$btn.find("div").hasClass("down")||this.$btn.hasClass(this.getBaseClass()+"-down"))&&$(document).on("contextmenu",this.returnFalse));var b=this.getBaseClass();this._btnImgSlice===MathInteractives.Common.Components.Views.Button.IMAGESLICE.THREE?(this.$btn.find("div").addClass("down"),this._isCustomButton&&this._applyNewPosition("down")):this.$btn.addClass(b+"-down"),(this.$btn.find("div").hasClass("down")||this.$btn.hasClass(this.getBaseClass()+"-down"))&&$(document).on("contextmenu",this.returnFalse)}},_onMouseup:function(a){$(document).off("contextmenu",this.returnFalse);var b=this.model.get("toggleButton"),c=this._isBtnActive();if(b||c){var d=this.getBaseClass();this._btnImgSlice===MathInteractives.Common.Components.Views.Button.IMAGESLICE.THREE?this.getButtonState()!==MathInteractives.Common.Components.Views.Button.BUTTON_STATE_SELECTED&&(this.$btn.find("div").removeClass("down"),this._isCustomButton&&this._applyNewPosition("active")):this.$btn.removeClass(d+"-down")}},_onToggle:function(a){1===a.which&&this.model.get("toggleButton")&&this.getButtonState()!==MathInteractives.Common.Components.Views.Button.BUTTON_STATE_DISABLED&&(this._isBtnActive()?(this._btnImgSlice===MathInteractives.Common.Components.Views.Button.IMAGESLICE.THREE?(this.$btn.find("div").addClass("down"),this._isCustomButton&&this._applyNewPosition("down")):this.$btn.addClass(this.getBaseClass()+"-down"),this.setButtonState(MathInteractives.Common.Components.Views.Button.BUTTON_STATE_SELECTED)):this.setButtonState(MathInteractives.Common.Components.Views.Button.BUTTON_STATE_ACTIVE))},setDraggableIcon:function(a){a?(this.model.set("isDraggable",!0),this._addDraggableIcon()):(this.model.set("isDraggable",!1),this._removeDraggableIcon())},_addDraggableIcon:function(){var a=this.$el.find(".button-content"),b=$("<div>",{"class":"draggable-icon-div"}).css({"background-image":'url("'+this.filePath.getImagePath("buttons-icons")+'")'}).addClass("draggable-icon");this.$el.append(b);var c=a.height(),d=b.height(),e=this._height-(c+d),f=e/5*2;a.css({"margin-top":f}),b.css({"margin-top":this._height-(d+7),"margin-left":(this.$el.width()-b.width())/2})},_removeDraggableIcon:function(){this.$el.find(".draggable-icon-div").remove()},showButton:function(){this.$btn.show()},hideButton:function(){this.$btn.hide()},changeText:function(a){this.$("."+this._btnType.category+"-button-text.button-content").text(a),this.model.set("text",a)},changeTooltipText:function(a){this.btnTooltipView.changeTooltipText(a)},changeBaseClass:function(a){this.model.set("baseClass",a)},_removeTooltip:function(){this.$btn.children().removeClass("down"),this.btnTooltipView&&this.btnTooltipView.hideTooltip()},hideTooltip:function(){this._removeTooltip()},_attachTooltip:function(){var a=this.model.get("tooltipText");if(a&&0!==a.length){var b=this.$btn,c=new MathInteractives.Common.Components.Models.Tooltip({id:this.model.get("id")+"tooltip",text:a,elementOffsetPosition:b.offset(),elementDimensions:{width:b.width(),height:b.height()},tooltipPosition:this.model.get("tooltipPosition"),path:this.filePath,player:this.model.get("player")});this.btnTooltipView=new MathInteractives.Common.Components.Views.Tooltip({model:c})}},returnFalse:function(a){return a.preventDefault(),!1},getBaseClass:function(){var a=this.model.get("baseClass");return a},_legendClick:function(a){if(a.preventDefault(),a.stopPropagation(),this.model.get("customEvent")===!0)return this._isLegendDown===!0?(this._isLegendDown=!1,this.$el.children().removeClass("down")):this._isLegendDown===!1&&(this._isLegendDown=!0,this.$el.children().addClass("down")),void this.$el.trigger("legend_click");var b={chart:$("#"+this.model.get("chartConianerID")).highcharts(),seriesID:this.model.get("seriesID"),callbackFnc:this.model.get("callbackFnc")},c=b.chart.get(b.seriesID);c.visible===!0?(c.hide(),this.$el.children().removeClass("down")):(c.show(),this.$el.children().addClass("down"))}},{BUTTON_MIN_WIDTH:92,BUTTON_STATE_ACTIVE:"active",BUTTON_STATE_SELECTED:"selected",BUTTON_STATE_DISABLED:"disabled",IMAGESLICE:{SINGLE:"single",THREE:"three"},TYPE:{CUSTOM:{id:"custom",category:"custom",slice:""},GENERAL:{id:"general",category:"general",slice:"three"},ACTION:{id:"action",category:"action",slice:"three"},MULTIPLE_TOGGLE_BLACK:{id:"multi-toggle-black",category:"multi-toggle-black",slice:"three",height:39},ACTION_MOVE:{id:"action-move",category:"action",slice:"three",icon:{iconClass:"move-icon",height:30,width:30}},ACTION_DRAW_LINE:{id:"action-draw-line",category:"action",slice:"three",icon:{iconClass:"draw-line-icon",height:30,width:30}},ACTION_ZOOM_IN:{id:"action-zoom-in",category:"action",slice:"three",icon:{iconClass:"zoom-in-icon",height:20,width:20}},ACTION_ZOOM_OUT:{id:"action-zoom-out",category:"action",slice:"three",icon:{iconClass:"zoom-out-icon",height:20,width:20}},ACTION_FIT_TO_SCREEN:{id:"action-fit-to-screen",category:"action",slice:"three",icon:{iconClass:"fit-to-screen-icon",height:26,width:26}},ACTION_RESET:{id:"action-reset",category:"action",slice:"three",icon:{iconClass:"action-reset-icon",height:26,width:26}},CLOSE_ORANGE:{id:"close-orange",category:"close-orange",slice:"single"},CLOSE_ORANGE_CROSS:{id:"close-orange-cross",category:"close-orange-cross",slice:"single"},CLOSE_PURPLE_CROSS:{id:"close-purple-cross",category:"close-purple-cross",slice:"single"},TTS_PLAY:{id:"tts-play",category:"tts-play",slice:"single"},TTS_PAUSE:{id:"tts-pause",category:"tts-pause",slice:"single"},TTS_SOUND:{id:"tts-sound",category:"tts-sound",slice:"single"},HINT:{id:"hint",category:"hint",slice:"single",icon:{iconClass:"hint-icon",height:30,width:28}},CAMERA:{id:"camera",category:"header",slice:"single",icon:{iconClass:"camera-icon",height:32,width:42}},FULL_SCREEN:{id:"full-screen",category:"header",slice:"single",icon:{iconClass:"full-screen-icon",height:32,width:32}},HELP:{id:"help",category:"header",slice:"single",icon:{iconClass:"help-icon",height:32,width:42}},SAVE:{id:"save",category:"save",slice:"three",icon:{iconClass:"save-icon",height:30,width:33},hasText:!0},ON:{id:"on",category:"on",slice:"three",hasText:!0,height:30},OFF:{id:"off",category:"off",slice:"three",hasText:!0,height:30},DRAGGABLE_BLUE:{id:"draggable-blue",category:"draggable-blue",slice:"three",isDraggable:!0,height:46},DRAGGABLE_GREEN:{id:"draggable-green",category:"draggable-green",slice:"three",isDraggable:!0,height:46},DRAGGABLE_RED:{id:"draggable-red",category:"draggable-red",slice:"three",isDraggable:!0,height:46},DRAGGABLE_BLUE_SMALL:{id:"draggable-blue-small",category:"draggable-blue-small",slice:"three",isDraggable:!0,height:40}},toggleButtonHandler:function(a){var b=a.buttonObjects,c=a.isPushButtons,d=a.isPushAndToggleButtons;if(b)for(var e=b.length,f=0;e>f;f++){var g=b[f];d?$(g.el).unbind("click.pushHandler").bind("click.pushHandler",$.proxy(function(a){this._handlePushAndToggleState(a,b)},this)).data("isPushButton",!0):c?$(g.el).unbind("click.pushHandler").bind("click.pushHandler",$.proxy(function(a){this._handlePushState(a,b)},this)).data("isPushButton",!0):$(g.el).unbind("click.toggleHandler").bind("click.toggleHandler",$.proxy(function(a){this._handleToggleState(a,b)},this))}},_handleToggleState:function(a,b){for(var c=b.length,d=0;c>d;d++){var e=b[d];if(e.el==a.currentTarget&&e.getButtonState()===this.BUTTON_STATE_DISABLED)return}for(var d=0;c>d;d++){var e=b[d],f=$(e.el);if(e.getButtonState()!==this.BUTTON_STATE_DISABLED&&(e.setButtonState(this.BUTTON_STATE_ACTIVE),f.unbind("click.toggleHandler").bind("click.toggleHandler",$.proxy(function(a){this._handleToggleState(a,b)},this)),e.el==a.currentTarget)){e.setButtonState(this.BUTTON_STATE_SELECTED);var g=f;setTimeout(function(){g.unbind("click.toggleHandler"),g.removeClass("click-enabled")},1)}}},_handlePushState:function(a,b){for(var c=b.length,d=0;c>d;d++){var e=b[d];if(e.el==a.currentTarget&&e.getButtonState()===this.BUTTON_STATE_DISABLED)return}for(var d=0;c>d;d++){var e=b[d];if(e.el==a.currentTarget){var f=e.getButtonState();if(f===this.BUTTON_STATE_SELECTED)e.setButtonState(this.BUTTON_STATE_ACTIVE);else if(f===this.BUTTON_STATE_ACTIVE){e.setButtonState(this.BUTTON_STATE_SELECTED);var g=$(e.el);g.removeClass("click-enabled").addClass("click-enabled"),g.children().each(function(){$(this).css({cursor:"pointer"})})}break}}},_handlePushAndToggleState:function(a,b){for(var c=b.length,d=0;c>d;d++){var e=b[d];if(e.el==a.currentTarget&&e.getButtonState()===this.BUTTON_STATE_DISABLED)return}for(var d=0;c>d;d++){var e=b[d];if(e.el==a.currentTarget){var f=e.getButtonState();if(f===this.BUTTON_STATE_SELECTED)e.setButtonState(this.BUTTON_STATE_ACTIVE);else if(f===this.BUTTON_STATE_ACTIVE){e.setButtonState(this.BUTTON_STATE_SELECTED);var g=$(e.el);g.removeClass("click-enabled").addClass("click-enabled"),g.children().each(function(){$(this).css({cursor:"pointer"})})}}else{if(e.getButtonState()===this.BUTTON_STATE_DISABLED)continue;e.setButtonState(this.BUTTON_STATE_ACTIVE)}}},generateButton:function(a){var b;if(a){b="#"+a.id;var c=new MathInteractives.Common.Components.Models.Button(a),d=new MathInteractives.Common.Components.Views.Button({el:b,model:c});return d}},generateLegend:function(a){var b,c={type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION,baseClass:"graphLegends",width:51,height:33,padding:5,imagePathIds:[],isDraggable:!1,cornerSliceImgWidth:5,text:"",isLegend:!0,customEvent:!1};if(a=$.extend(c,a)){b="#"+a.id;var d=new MathInteractives.Common.Components.Models.Button(a),e=new MathInteractives.Common.Components.Views.Button({el:b,model:d}),f=e.$el.find(".button-icon"),g=parseInt((e.$el.width()-a.icon.width)/2)+2;return null!==f&&"undefined"!=typeof f&&f.css({"background-image":"url("+a.path.getImagePath(a.icon.pathId)+")","margin-left":g,width:a.icon.width}),e.$el.children().addClass("down"),e._isLegendDown=!0,e}}}),MathInteractives.global.Button=MathInteractives.Common.Components.Views.Button}(),function(){"use strict";MathInteractives.Common.Components.Models.Button=Backbone.Model.extend({defaults:function(){return{id:"",baseClass:"",text:null,icon:null,tooltipText:"",tooltipPosition:null,toggleButton:!1,width:null,height:null,padding:null,imagePathIds:null,cornerSliceImgWidth:null,type:MathInteractives.Common.Components.Views.Button.TYPE.GENERAL,isDraggable:!1,btnWidthGroup:null,isLegend:!1,chartConianerID:null,seriesID:null,callbackFnc:null,customEvent:!1,fixedMinWidth:!1,imagePositions:null}},currentState:MathInteractives.Common.Components.Views.Button.BUTTON_STATE_ACTIVE})}(),function(){"use strict";MathInteractives.Common.Components.Views.Tooltip=Backbone.View.extend({$tooltip:null,path:null,initialize:function(){this.path=this.model.get("path"),this.render()},render:function(){var a=this.model,b=(a.get("text"),{id:a.get("id"),content:""});this._toolTipHTML=MathInteractives.Common.Components.templates.tooltip(b).trim()},showTooltip:function(){var a=this.model,b=a.get("tooltipPosition"),c=0;$(".de-mathematics-interactive-tooltip").remove(),$("body").append(this._toolTipHTML),$(".de-mathematics-interactive-tooltip.tooltip-left, .de-mathematics-interactive-tooltip.tooltip-right, .de-mathematics-interactive-tooltip.tooltip-arrow").css({"background-image":'url("'+this.path.getImagePath("player-lr")+'")'}).each(function(){c+=$(this).width()}),$(".de-mathematics-interactive-tooltip.tooltip-mid").css({"background-image":'url("'+this.path.getImagePath("player-m")+'")'}).html(a.get("text")).each(function(){c+=$(this).width()}),this.$tooltip=$("#"+a.get("id")),null===b&&(b=this._getTooltipPosition()),this.$tooltip.css({top:b.top,left:b.left,"min-width":c})},hideTooltip:function(){null!==this.$tooltip&&this.$tooltip.remove()},changeTooltipText:function(a){this.model.set("text",a),this.$tooltip&&this.$tooltip.find(".tooltip-mid").html(a)},_getTooltipPosition:function(){var a=this.model,b=a.get("elementOffsetPosition"),c=a.get("elementDimensions"),d={},e=this.$tooltip,f=e.outerWidth(),g=e.outerHeight(),h=MathInteractives.Common.Components.Views.Tooltip,i=a.get("player").$el,j=i.offset(),k=(i.width(),h.INVERTED_TOOLTIP_PADDING);return d.top=b.top-g,d.left=b.left+c.width/2-f/2,d.top<j.top&&(d.top=c.height+k+b.top,this.$tooltip.find(".tooltip-arrow").addClass("inverted-tootlip")),d},updateElementPos:function(a){this.model.set("elementOffsetPosition",a)}},{INVERTED_TOOLTIP_PADDING:6,generateTooltip:function(a){if(a){var b=new MathInteractives.Common.Components.Models.Tooltip(a),c=new MathInteractives.Common.Components.Views.Tooltip({model:b});return c}}}),MathInteractives.global.Tooltip=MathInteractives.Common.Components.Views.Tooltip}(),function(){"use strict";MathInteractives.Common.Components.Models.Tooltip=Backbone.Model.extend({defaults:function(){return{id:"",text:null,tooltipPosition:null,elementOffsetPosition:null,elementDimensions:null,imagePathClasses:null}}})}(),function(){"use strict";MathInteractives.Common.Player.Models.DefinitionBox=Backbone.Model.extend({defaults:function(){return{title:"Title",accTitle:null,content:"Default content",accContent:null,audioFilePath:"path to audio file",eventTarget:null,closeCallback:null}}},{})}(),function(){MathInteractives.Common.Player.Views.DefinitionBox||(MathInteractives.Common.Player.Views.DefinitionBox=Backbone.View.extend({_closeCallback:null,_showCallback:null,_manager:null,_player:null,_idPrefix:null,path:null,initialize:function(){this.path=this.model.get("path"),this._player=this.model.get("player");var a=this._player.$el;this._idPrefix=this._player.getIDPrefix(),this.render(),this._closeCallback=this.model.get("closeCallback"),this._showCallback=this.model.get("showCallback"),this._manager=this.model.get("manager");var b=this.model.get("accTitle"),c=this.model.get("accContent");this.$el.off("mousedown.definitionBox touchstart.definitionBox").on("mousedown.definitionBox touchstart.definitionBox",function(a){a.stopPropagation()}),a.off("mousedown.definitionBox touchstart.definitionBox").on("mousedown.definitionBox touchstart.definitionBox",$.proxy(this._closeDefinitionBox,this)),this._showCallback&&this._showCallback.fnc.apply(this._showCallback.scope||this);var d={id:this._idPrefix+"hint-box-close-button",text:'CLOSE<span class="text">X</span>',isCustomButton:!0,imagePathIds:["purple-button-definition-box","purple-button-definition-box-mid"],width:88,height:33,path:this.path},d=(MathInteractives.global.Button.generateButton(d),{containerId:this._idPrefix+"hint-box-tts-container",messagesToPlay:[this._idPrefix+"hint-box-content"],path:this.path,player:this._player,idPrefix:this._idPrefix,manager:this._manager}),e=(MathInteractives.global.PlayerTTS.generateTTS(d),$(this.$el.children()[0]).width()-15-this.$el.find(".hint-box-close-button").width()),f=this.model.attributes.eventTarget.id;this.$("#"+this._player.getIDPrefix()+"hint-box-title").bind("keydown",$.proxy(function(a){9===a.keyCode&&a.shiftKey&&(a.preventDefault(),$(".hint-box-close-button").trigger("click"),this._manager.setFocus(f))},this)),this.$("#"+this._player.getIDPrefix()+"hint-box-close-button").bind("keydown",$.proxy(function(a){return a.target.parentNode!==a.currentTarget?!0:void(9!==a.keyCode||a.shiftKey||(a.stopPropagation(),a.preventDefault(),$(".hint-box-close-button").trigger("click"),this._manager.setFocus(f)))},this)),a.find(".hint-box-text-container").css("width",$(this.$el.children()[0]).width()-30+"px"),a.find(".hint-box-header-buttons").css("left",e-49+"px"),this._manager.loadScreen("definition-pop-up",this._idPrefix),this._manager.restrictAccDivSize(this._idPrefix+"hint-box-close-button"),this._manager.restrictAccDivSize(this._idPrefix+"hint-box-tts-container"),b&&this._manager.setAccMessage(this._idPrefix+"hint-box-title",b),c&&this._manager.setAccMessage(this._idPrefix+"hint-box-content",c),this._manager.setFocus(this._idPrefix+"hint-box-title")},events:{"click .hint-box-close-button":"_closeDefinitionBox"},render:function(){var a=this.model.get("title"),b=this.model.get("content"),c=this.model.get("width"),d=this._player.$el;return this.$el.append(MathInteractives.Common.Player.templates.definitionBox({definitionBoxTitle:a,definitionBoxContent:b,idPrefix:this._idPrefix}).trim()),d.find(".hint-box-container").remove(),d.append(this.el),this.$el.attr("id",this._idPrefix+"hint-box-container").addClass("hint-box-outer-container"),this.$el.css("width",c+"px"),$(this.$el.children()[0]).css("width",c+"px"),this._positionElement(),this},_positionElement:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=$(this.model.get("eventTarget"));n=o.offset(),j=n.top,k=n.left,l=o.height(),m=o.width(),i=this.$el.children().outerHeight(),h=this.$el.children().outerWidth(),d=this._player.$el,g=d.offset(),f=g.top,e=g.left,c=d.height()-i,b=d.width(),a={top:0,left:0},a.top=j+l/2-i/2,a.top<f?a.top=j:a.top+i>f+c&&(a.top=j+l-i),a.left=k+m+5,k+m+h+10>e+b?a.left=k-h-5:e>k-h-10&&(a.left=k+m+5),this.$el.css({position:"absolute"}),this.$el.offset(a)},_closeDefinitionBox:function(){var a=this._player.$el;a.off("mousedown.definitionBox touchstart.definitionBox"),MathInteractives.global.SpeechStream.stopReading();var b=a.find("#"+this._idPrefix+"hint-box-container");b.length>0&&a.find("#"+this._idPrefix+"hint-box-container").remove();var c=this.model.get("eventTarget").id;this._manager.setFocus(c),this._closeCallback&&this._closeCallback.fnc.apply(this._closeCallback.scope||this,[])}},{createDefinitionBox:function(a){if(a){var b=new MathInteractives.Common.Player.Models.DefinitionBox(a),c=new MathInteractives.global.PlayerDefinitionBox({model:b});return c}}}),MathInteractives.global.PlayerDefinitionBox=MathInteractives.Common.Player.Views.DefinitionBox)}(),function(){"use strict";MathInteractives.Common.Player.Models.PopUp=Backbone.Model.extend({defaults:function(){return{width:null,type:MathInteractives.Common.Player.Models.PopUp.TYPE.ALERT,title:null,accTitle:null,titleIcon:null,hasCloseBtn:!1,text:null,accText:null,closeCallback:null,buttons:[],customBtnAccScreenId:null,showCallback:null}}},{TYPE:{ALERT:{id:"alert",titleIcon:{iconClass:"alert-symbol",width:34,height:29},buttons:[{id:"pop-up-ok-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.GENERAL,
response:{isPositive:!0,buttonClicked:"pop-up-ok-btn"}}]},CONFIRM:{id:"confirm",titleIcon:{iconClass:"alert-symbol",width:34,height:29},buttons:[{id:"pop-up-yes-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.GENERAL,response:{isPositive:!0,buttonClicked:"pop-up-yes-btn"}},{id:"pop-up-no-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.GENERAL,response:{isPositive:!1,buttonClicked:"pop-up-no-btn"}}]},CUSTOM:{id:"custom",titleIcon:{iconClass:"alert-symbol",width:34,height:29}}}})}(),function(){MathInteractives.Common.Player.Views.PopUp||(MathInteractives.Common.Player.Views.PopUp=MathInteractives.Common.Player.Views.Base.extend({manager:null,player:null,_path:null,initialize:function(){if(this.manager=this.model.get("manager"),this.player=this.model.get("player"),this.idPrefix=this.player.getIDPrefix(),this._path=this.model.get("path"),!this.player.getModalPresent()||!this._isSamePopupPresent()){this.render(),this.attachEvents();var a=this.model.get("showCallback");a&&a.fnc.apply(a.scope||this)}},_isSamePopupPresent:function(){for(var a,b=(this.model.get("title"),this.player.$el.find(".pop-up-modal")),c=0;c<b.length;c++)if(a=b[0].id,a===this.idPrefix+"pop-up-modal")return!0;return!1},render:function(){var a=this.type=this.model.get("type"),b=this.model,c=this.player.$el,d=b.get("text"),e=b.get("accText"),f=this;f.keyDown={},this.generatePopUp(c,d,e,g,a),this.player.setModalPresent(!0),this.loadScreen("player"),this.loadScreen("pop-up-box"),this.$el.off("keydown.popupAccessibility").on("keydown.popupAccessibility",function(a){f.keyDown=a}),this._setFocusToPopupTitleOnShiftTab=function(){f.keyDown.shiftKey===!0&&f.setFocus("pop-up-title-text")},this._setFocusToPopupTextOnTab=function(){f.keyDown.shiftKey===!1&&f.setFocus("pop-up-text")},this.focusOut("pop-up-text",this._setFocusToPopupTitleOnShiftTab,1,!1),this.focusOut("pop-up-text",this._setFocusToPopupTitleOnShiftTab,1),this.focusOut("pop-up-title-text",this._setFocusToPopupTextOnTab,1,!1),this.focusOut("pop-up-title-text",this._setFocusToPopupTextOnTab,1);var g=b.get("title"),h=b.get("accTitle");g=g||"custom"===a.id?g:this.getMessage("pop-up-title-text",a.id),h=h||"custom"===a.id?h:this.getAccMessage("pop-up-title-text",a.id),h=h+" "+this.getAccMessage("text-append-to-pop-up-title",0);var i=b.get("titleIcon");i=i?i:a.titleIcon,e&&this.manager.setAccMessage(this.idPrefix+"pop-up-text",e),g&&this.manager.setMessage(this.idPrefix+"pop-up-title-text",g),h&&this.manager.setAccMessage(this.idPrefix+"pop-up-title-text",h),this.generateButtons(),this.setDimensions(c,a,i),this.manager.setFocus(this.idPrefix+"pop-up-title-text")},events:{},generatePopUp:function(a,b,c,d,e){""===d&&this.$(".pop-up-title-text").remove(),this.$el.append(MathInteractives.Common.Player.templates.popUp({popupTitle:d,popupText:b,idPrefix:this.idPrefix}).trim()),a.append(this.el)},generateButtons:function(){var a=null,b=5;if(this.model.get("hasCloseBtn")){var c={id:this.idPrefix+"pop-up-close-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.CLOSE_ORANGE,path:this._path};MathInteractives.global.Button.generateButton(c)}else this.$el.find(".pop-up-close-btn").remove();var c={containerId:this.idPrefix+"pop-up-tts-container",messagesToPlay:[this.idPrefix+"pop-up-text"],path:this._path,player:this.player,idPrefix:this.idPrefix,manager:this.manager},d=this.getTabIndex("pop-up-text")+b,e=MathInteractives.global.PlayerTTS.generateTTS(c);e.renderTTSAccessibility(d);var f=(this.model.get("type"),this.$("#"+this.idPrefix+"pop-up-btns-container")),g=this.model.get("buttons");g=g.length>0?g:this.type.buttons;for(var h=g.length,i=0;h>i;i++){var j=$("<div>",{id:this.idPrefix+g[i].id,"class":"pop-up-bottom-btn"});f.append(j),a={elementId:g[i].id,tabIndex:d+b,role:"button",acc:g[i].text?g[i].text:this.getMessage(g[i].id+"-text","0")},b+=5;var c={id:this.idPrefix+g[i].id,type:MathInteractives.Common.Components.Views.Button.TYPE.GENERAL,width:g[i].width?g[i].width:null,text:g[i].text?g[i].text:this.getMessage(g[i].id+"-text","0"),path:this._path,btnWidthGroup:"pop-up-buttons",fixedMinWidth:!0};MathInteractives.global.Button.generateButton(c),this.createAccDiv(a),j.on("click",{currentButton:g[i]},$.proxy(this._bottomBtnClickHandler,this))}},_bottomBtnClickHandler:function(a){var b=a.data.currentButton;MathInteractives.global.SpeechStream.stopReading(),b.clickCallBack&&b.clickCallBack.fnc.apply(b.clickCallBack.scope||this,[a]);var c={isPositive:!1,buttonClicked:b.id};b.response&&(c.isPositive=b.response.isPositive,c.buttonClicked=b.response.buttonClicked),this._triggerCallback(c.isPositive,c.buttonClicked)},setDimensions:function(a,b,c){var d=this.model.get("width");null!==d&&this.$el.find(".pop-up-dialogue").css({width:d});var e=this.$el.find(".pop-up-title-bar-left"),f=this.$el.find(".pop-up-title-bar-right"),g=this.$el.find(".pop-up-title-bar-mid");e.css({"background-image":'url("'+this._path.getImagePath("player-lr")+'")'}),f.css({"background-image":'url("'+this._path.getImagePath("player-lr")+'")'}),g.css({"background-image":'url("'+this._path.getImagePath("player-m")+'")'});var h=e.width()+f.width(),i=this.$el.find(".pop-up-dialogue").width();g.width(i-h),c&&this.$el.find("#"+this.idPrefix+"pop-up-title-image").css({"background-image":'url("'+this._path.getImagePath("buttons-icons")+'")',width:c.width,height:c.height}).addClass(c.iconClass);var j=a.height(),k=a.width(),l=this.$(".pop-up-dialogue");a.find(".pop-up-modal").css("height",j),l.css({"margin-top":(j-l.height())/2,"margin-left":(k-l.width())/2});var m,n,o,p,q,r;m=this.$(".pop-up-title-image"),n=this.$(".pop-up-title-text"),o=this.$(".pop-up-tts-container"),p=this.$(".pop-up-close-btn-old"),q=this.$(".pop-up-title"),r=this.$(".pop-up-header-btns-cont"),m.css({"margin-top":(q.height()-m.height())/2}),n.css({"margin-top":(q.height()-n.height())/2}),o.css({"margin-top":(r.height()-o.height())/2}),p.css({"margin-top":(r.height()-p.height())/2}),this.updateFocusRect("pop-up-text")},attachEvents:function(){this.$(".pop-up-close-btn").on("click",$.proxy(this._closeClicked,this))},_closeClicked:function(){MathInteractives.global.SpeechStream.stopReading(),this._triggerCallback(!1,"pop-up-close-btn")},_triggerCallback:function(a,b){MathInteractives.global.SpeechStream.stopReading(),this._removePopup();var c=this.model.get("closeCallback"),d={};d.isPositive=a,d.buttonClicked=b,c&&c.fnc.apply(c.scope||this,[d])},_removePopup:function(){this.$el.off("keydown.popupAccessibility"),this.remove(),this.player.setModalPresent(!1)}},{createPopup:function(a){if(a){var b=new MathInteractives.Common.Player.Models.PopUp(a),c=new MathInteractives.Common.Player.Views.PopUp({model:b});return c}}}),MathInteractives.global.PlayerPopup=MathInteractives.Common.Player.Views.PopUp)}(),function(){"use strict";MathInteractives.Common.Player.Models.CanvasItem=Backbone.Model.extend({defaults:function(){return{tabindex:null,paperItem:null}},initialize:function(a){this.set("canvasAccId",a)}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Player.templates=MathInteractives.Common.Player.templates||{};b.popUp=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='\ufeff<div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-modal" class="pop-up-modal">\r\n\r\n  <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-dialogue" class="pop-up-dialogue">\r\n\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-title-bar" class="pop-up-title-bar">\r\n      <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-title-bar-left" class="pop-up-title-bar-left">\r\n      </div>\r\n      <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-title-bar-mid" class="pop-up-title-bar-mid">\r\n        <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-title" class="pop-up-title">\r\n          <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-title-image" class="pop-up-title-image"></div>\r\n          <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-title-text" class="pop-up-title-text">',(f=c.popupTitle)?f=f.call(b,{hash:{},data:e}):(f=b.popupTitle,f=typeof f===h?f.apply(b):f),(f||0===f)&&(g+=f),g+='</div>\r\n        </div>\r\n\r\n        <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-header-btns" class="pop-up-header-btns-cont">\r\n          <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-tts-container" class="pop-up-tts-container tts-container"></div>\r\n          <div class="pop-up-close-btn" id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-close-btn"></div>\r\n        </div>\r\n      </div>\r\n      <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-title-bar-right" class="pop-up-title-bar-right">\r\n      </div>\r\n    </div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-body" class="pop-up-body">\r\n      <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-text" class="pop-up-text">\r\n        ',(f=c.popupText)?f=f.call(b,{hash:{},data:e}):(f=b.popupText,f=typeof f===h?f.apply(b):f),(f||0===f)&&(g+=f),g+='\r\n      </div>\r\n\r\n      <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-btns-container" class="pop-up-btns-container"></div>\r\n      <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'pop-up-text-ie9-focusout-fix" class="pop-up-text-ie9-focusout-fix"></div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Player.templates=MathInteractives.Common.Player.templates||{};b.definitionBox=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='\ufeff<div class="hint-box-container">\r\n  <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'hint-box-header" class="hint-box-header">\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'hint-box-title" class="hint-box-title">\r\n      ',(f=c.definitionBoxTitle)?f=f.call(b,{hash:{},data:e}):(f=b.definitionBoxTitle,f=typeof f===h?f.apply(b):f),(f||0===f)&&(g+=f),g+='\r\n    </div>\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'hint-box-header-buttons" class="hint-box-header-buttons">\r\n      <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'hint-box-tts-container" class="hint-box-tts-container"></div>\r\n      <!--<div id="hint-box-pause-container" class="hint-box-pause-container pause-tts-container">\r\n      <div id="hint-box-pause-tts" class="pause-tts"></div>\r\n    </div>\r\n    <div id="hint-box-tts-container" class="tts-container">\r\n      <div class="hint-box-audio-button-holder tts"></div>\r\n    </div>-->\r\n      <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'hint-box-close-button" class="hint-box-close-button"></div>\r\n    </div>\r\n  </div>\r\n  <div class="hint-box-text-container">\r\n    <div id="',(f=c.idPrefix)?f=f.call(b,{hash:{},data:e}):(f=b.idPrefix,f=typeof f===h?f.apply(b):f),g+=i(f)+'hint-box-content" class="hint-box-content">\r\n      ',(f=c.definitionBoxContent)?f=f.call(b,{hash:{},data:e}):(f=b.definitionBoxContent,f=typeof f===h?f.apply(b):f),(f||0===f)&&(g+=f),g+="\r\n    </div>\r\n  </div>\r\n</div>"})}(),function(){"use strict";MathInteractives.Common.Components.Models.LegendButton=Backbone.Model.extend({defaults:function(){return{chartContainerID:null,seriesID:null,customEvent:!1}}})}(),function(){"use strict";MathInteractives.Common.Components.Models.Pan=Backbone.Model.extend({defaults:function(){return{id:null,rows:null,columns:null,height:null,width:null,positionClass:null,droppedElements:[]}}})}(),function(){"use strict";MathInteractives.Common.Components.Models.PanBalanceEquation=Backbone.Model.extend({defaults:function(){return{coefficient:null,variable:"x",constantA:null,constantB:null}},getEquationString:function(){var a="",b=this.get("coefficient"),c=this.get("variable"),d=this.get("constantA"),e=this.get("constantB");return 0===b?null:(a+=1===b?c:b+c,0!==d&&(a+=0>d?" - "+d:" + "+d),a+=" = "+e)},getVariableValue:function(){var a=(this.get("constantB")-this.get("constantA"))/this.get("coefficient");return a}})}(),function(){"use strict";MathInteractives.Common.Components.Models.PanBalance=Backbone.Model.extend({defaults:function(){return{equationData:{a:4,b:11,c:-1},isDraggable:!1,enableDispenser:!1,isFilled:!0,dispenserData:[],leftPanWeight:0,rightPanWeight:0,currentPansData:null,showX:!1,xValue:0,prependID:"",isAnimation:!1,stepRotateObject:{rotate:0}}},xValue:null,initialize:function(){var a=this.getEquationData(),b={left:{a:a.a,b:a.b,c:0},right:{a:0,b:0,c:a.c}};null===this.getCurrentPansData()&&this.setCurrentPansData(b),this.on("change:xValue",$.proxy(this._xValueChange,this))},getEquationData:function(){return this.get("equationData")},setEquationData:function(a){this.set("equationData",a)},getXValue:function(){return this.get("showX")?this.get("xValue"):"<i>x</i>"},getShowX:function(){return this.get("showX")},setShowX:function(a){this.set("showX",a),this.trigger("pan-showX-change")},setXValue:function(a){this.set("xValue",a)},getLeftPanWeight:function(){return this.get("leftPanWeight")},setLeftPanWeight:function(a){var b=a.a*this.get("xValue")+a.b;this.set("leftPanWeight",b)},getRightPanWeight:function(){return this.get("rightPanWeight")},setRightPanWeight:function(a){var b=a.a*this.get("xValue")+a.b+a.c;this.set("rightPanWeight",b)},getCurrentPansData:function(){return this.get("currentPansData")},setCurrentPansData:function(a){this.set("currentPansData",a),this.setLeftPanWeight(a.left),this.setRightPanWeight(a.right),this.trigger("pan-data-change")},getHeavierPan:function(){var a="RIGHT";return this.getLeftPanWeight()>this.getRightPanWeight()?a="LEFT":this.getLeftPanWeight()===this.getRightPanWeight()&&(a="CENTRE"),this.get("showX")||(a="CENTRE"),a},_xValueChange:function(){this.setCurrentPansData(this.getCurrentPansData())}})}(),function(){"use strict";MathInteractives.Common.Components.Views.PanBalance=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,isDraggable:!1,isFilled:!0,currentAngle:0,xAddedTill_R:{row:3,col:0},startOthertilesFrom_R:{row:0,col:0},xAddedTill_L:{row:3,col:0},startOthertilesFrom_L:{row:0,col:0},enableDispenser:!1,isAnimation:!1,droppedTileId:0,stepRotateObject:{rotate:0},trashCanID:null,containmentID:null,isPanDisabled:!1,prependID:null,initialize:function(){this.prependID=this.model.get("prependID"),this.idPrefix=this.model.get("idPrefix"),this.idPrefix=this.idPrefix+this.prependID,this.manager=this.model.get("manager"),this.filePath=this.model.get("path"),this.isDraggable=this.model.get("isDraggable"),this.dispenserData=this.model.get("dispenserData"),this.isFilled=this.model.get("isFilled"),this.enableDispenser=this.model.get("enableDispenser"),this.defaultData=this.model.get("defaultData"),this.trashCanID=this.model.get("trashCanID"),this.containmentID=this.model.get("containmentID"),this.render()},render:function(){var a={idPrefix:this.idPrefix},b=MathInteractives.Common.Components.templates.panBalance(a).trim();this.$el.append(b),this._setBackgroundImage(".left-pan,.right-pan,.small-rod,.base,.center-rod"),this._attachEvents(),this.renderDispenser(),this.model.get("isDraggable")&&(this._initializeDroppableContainers(),this.defaultData&&this._renderDefaultTiles(this.defaultData)),this._activateTrashCan(this.trashCanID)},_resetData:function(a,b){this.xAddedTill_R={row:3,col:0},this.startOthertilesFrom_R={row:b.rowCount-1,col:0},this.xAddedTill_L={row:3,col:0},this.startOthertilesFrom_L={row:a.rowCount-1,col:0}},_attachEvents:function(){this.model.on("pan-data-change",$.proxy(this.eventHandlers._panDataChangeEvent,this)),this.model.on("pan-showX-change",$.proxy(this.eventHandlers._panShowXChangeEvent,this))},_setBackgroundImage:function(a){if(a){var b=this.filePath.getImagePath("pan-balance");this.$(a).css({"background-image":"url("+b+")"})}},animatePanBalance:function(a){var b=0;switch(a){case"LEFT":b=-5;break;case"RIGHT":b=5}var c=1e3,d=this,e=parseInt(this.$(".center-rod").css("width").split("px")[0]),f=e/2,g=d.$(".center-rod"),h=d.$(".left-pan-wrapper"),i=d.$(".right-pan-wrapper"),j=null,k=null,l=[];this.model.set("isAnimation",!0),this.model.set("stepRotateObject",$.extend({},{rotate:this.currentAngle})),$(this.model.get("stepRotateObject")).stop().animate({rotate:b},{step:function(a){j=Math.sin(Math.PI/180*a)*f,h.css("top",-j+"px"),i.css("top",j+"px"),g.css({"-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)",transform:"rotate("+a+"deg)"}),k=$("<span></span>"),$("body").append(k),l.push(k.get(0)),d.currentAngle=a},complete:function(){d.model.set("isAnimation",!1),$(l).remove()},duration:c})},renderPan:function(){if(!this.enableDispenser){var a,b,c,d=this.model.getCurrentPansData(),e=d.left,f=d.right,g=this.$(".left-tile-container .static-container"),h=this.$(".right-tile-container .static-container");!this.isDraggable&&this.isFilled&&(b=this._calculateRowsCols(Math.abs(e.a),Math.abs(e.b)+Math.abs(e.c)),c=this._calculateRowsCols(Math.abs(f.a),Math.abs(f.b)+Math.abs(f.c)),this._resetData(b,c),a=this._createTilesContainer(b),this.addElementsToPan(a,e.a,b,!0,"LEFT"),this.addElementsToPan(a,e.b,b,!1,"LEFT"),this.addElementsToPan(a,e.c,b,!1,"LEFT"),g.show().html(a),a=this._createTilesContainer(c),this.addElementsToPan(a,f.a,c,!0,"RIGHT"),this.addElementsToPan(a,f.b,c,!1,"RIGHT"),this.addElementsToPan(a,f.c,c,!1,"RIGHT"),h.show().html(a),this._adjustTablePosition(),this._displayEquation())}},_createTilesContainer:function(a){var b,c,d,e,f=a,g=f.rowCount,h=f.colCount,i=$("<div>",{"class":"pan-table"});for(d=0;g>d;d++)for(b=$("<div>",{"class":"pan-row row-"+d}),i.append(b),e=0;h>e;e++)c=$("<div>",{"class":"pan-cell cell-"+e}),b.append(c);return i},_calculateRowsCols:function(a,b){var c,d,e,f=3;return e=a>b?a:b,c=e>3?f:e,d=Math.ceil(a/c)+Math.ceil(b/c),d>5&&(d=5),{colCount:d,rowCount:c}},addElementsToPan:function(a,b,c,d,e){var f,g,h="coefficients",i=0,j=1,k=c.rowCount;c.colCount;if(d&&(h="coefficients-x",j=this.model.getXValue()),0>b&&(j=0===j?0:"string"==typeof j?"-"+j:-1*j,b=Math.abs(b)),d&&0!==b){for(var l=0,m=k-1;b>i;i++){0>m&&(l++,m=k-1);var n=$("<div>",{"class":h+" xCoefficient"});n.html(j),a.find(".row-"+m+" .cell-"+l).append(n),m--}"LEFT"===e?(this.xAddedTill_L={row:m+1,col:l},this.startOthertilesFrom_L={row:k-1,col:l+1}):(this.xAddedTill_R={row:m+1,col:l},this.startOthertilesFrom_R={row:k-1,col:l+1})}else{"LEFT"===e?(f=this.xAddedTill_L.row-1,g=this.xAddedTill_L.col):(f=this.xAddedTill_R.row-1,g=this.xAddedTill_R.col);for(var l="LEFT"===e?this.startOthertilesFrom_L.col:this.startOthertilesFrom_R.col,m="LEFT"===e?this.startOthertilesFrom_L.row:this.startOthertilesFrom_R.row;b>i;i++){0>m&&(l++,m=k-1);var n=$("<div>",{"class":h});n.html(j),l>4?(a.find(".row-"+f+" .cell-"+g).append(n),f--):a.find(".row-"+m+" .cell-"+l).append(n),m--}"LEFT"===e?this.startOthertilesFrom_L={row:m,col:l}:this.startOthertilesFrom_R={row:m,col:l}}},_adjustTablePosition:function(){var a=this.$(".left-tile-container .static-container"),b=this.$(".right-tile-container .static-container"),c=b.find(".pan-table"),d=a.find(".pan-table");c.css({top:b.height()-c.height()}),d.css({top:a.height()-d.height()})},_displayEquation:function(){var a=this.model.getCurrentPansData(),b=a.left,c=a.right,d=this.$(".left-pan .pan-data"),e=this.$(".right-pan .pan-data"),f="",g="";f=0===b.a?"":b.a+"<i>x</i>",1===Math.abs(b.a)&&(f="<i>x</i>",b.a<0&&(f="-<i>x</i>")),f+=0===b.b?"":b.b>0?" + "+b.b:" - "+Math.abs(b.b),f+=0===b.c?"":b.c>0?" + "+b.c:" - "+Math.abs(b.c),g=0===c.a?"":c.a+"<i>x</i>",1===Math.abs(c.a)&&(g="<i>x</i>",c.a<0&&(g="-<i>x</i>")),g+=0===c.b?"":c.b>0?" + "+c.b:" - "+Math.abs(c.b),g+=0===c.c?"":c.c>0?" + "+c.c:" - "+Math.abs(c.c),0===c.a&&0===c.b&&(g=Number(g.replace(/\s/g,""))),0===b.a&&0===b.b&&(f=Number(f.replace(/\s/g,""))),d.html(f),e.html(g)},setPansData:function(a){var b={left:{},right:{}};b.left.a=a.left.a||0,b.left.b=a.left.b||0,b.left.c=a.left.c||0,b.right.a=a.right.a||0,b.right.b=a.right.b||0,b.right.c=a.right.c||0,this.model.setCurrentPansData(b)},setXValue:function(a){this.model.setXValue(a)},showX:function(a){this.model.setShowX(a)},isAnimationOn:function(){return this.model.get("isAnimation")},eventHandlers:{_panDataChangeEvent:function(){this.renderPan(),this.model.getShowX()||(this.currentAngle=0),this.animatePanBalance(this.model.getHeavierPan())},_panShowXChangeEvent:function(){var a=this.model.getXValue(),b=this.model.getCurrentPansData();a=b.left.a>0?a:"string"==typeof a?"-"+a:-1*a,this.$(".left-tile-container .xCoefficient").html(a),a=b.right.a>0?a:"string"==typeof a?"-"+a:-1*a,this.$(".right-tile-container .xCoefficient").html(a),this.animatePanBalance(this.model.getHeavierPan())}},renderDispenser:function(a){if(this.enableDispenser){var b,c=this,d=MathInteractives.Common.Components.Views.PanBalance,e=a?a:this.dispenserData,f=e.length,g=0,h=(this.$(".dispenser-container").show(),this.$(".dispenser-row-1")),i=this.$(".dispenser-row-2"),j={revert:"invalid",zIndex:999,helper:"clone",start:function(a,b){c.trigger(d.TILE_DRAG)},containment:c._getContainmentSelector()},k=null;for(this.$(".dynamic-container");f>g;g++)b="Num"===e[g].type&&e[g].value>1?i:h,k=this._createDraggableTiles(b,e[g],this.idPrefix+"dispenser-tile-",g,!0),$.fn.EnableTouch(".pan-draggable-dispenser-tile"),k.draggable(j)}},_createDraggableTiles:function(a,b,c,d,e){var f=e?e:!1,g=b.isDisabled?b.isDisabled:this._getIsDisabled(),h=b.isVarNegative?b.isVarNegative:!1,i=MathInteractives.Common.Components.Views.PanBalance,j=b.text,k=b.type,l=b.value,m=MathInteractives.Common.Components.Views.Button.TYPE.DRAGGABLE_BLUE,n=46,o=n,p=this.filePath,q=c,r=null;"undefined"!=typeof d&&(q+=d),r=c+" pan-draggable-dispenser-tile draggable-tile"+k;var s=$("<div>",{id:q,"class":r}),t=null;o="Num"===k?n*Math.abs(l):54,f&&-1===j.indexOf(i.NEGATIVE_TILE_INDICATOR)&&("Var"===k&&(h&&(j=i.NEGATIVE_TILE_INDICATOR+j),j="<i>"+j+"</i>"),"Num"===k&&h&&(j=i.NEGATIVE_TILE_INDICATOR+j)),t={id:q,type:m,path:p,text:j,width:o,isDisabled:g},a.append(s);this._generateTileButton(t);return s.data({value:l,type:k,text:j,isVarNegative:h,isDisabled:g})},_generateTileButton:function(a){var b=MathInteractives.global.Button.generateButton(a);return a.isDisabled&&(b.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),b.setDraggableIcon(!a.isDisabled)),b},_initializeDroppableContainers:function(){var a=this,b=this.$(".dynamic-container"),c=null,d=MathInteractives.Common.Components.Views.PanBalance;c=this._createTilesContainer({rowCount:3,colCount:0}),b.find(".dynamic-wrapper").append(c),b.show().droppable({drop:function(b,c){var e=$(this).find(".dynamic-wrapper"),f=e.data().pos,g=c.draggable.data(),h={value:g.value,type:g.type,text:g.text,isVarNegative:g.isVarNegative},i=c.helper.clone(),j=null,k=!0;if(i.removeClass("ui-draggable-dragging").data(h),j=a._handleTilesPositionInContainer(e,i),j&&!e.parents(".pan-wrapper").hasClass(i.attr("panContainer")+"-pan-wrapper")){c.helper.hasClass("pan-dropped")&&c.draggable.remove(),a._makeTileDraggableAfterDrop(j);var l=c.helper.remove(),m=a.$("."+l.attr("panContainer")+"-pan-wrapper").find(".dynamic-wrapper"),n=Number(l.attr("rowNo"));a.animateDynamicPan(),l.attr("panContainer")&&a._arrangeTilesInPan(m,n)}else $(j).remove(),c.draggable.draggable("option","revert",!0),k=!1;k&&("right"===f?a.trigger(d.RIGHT_PAN_DROP,h):a.trigger(d.LEFT_PAN_DROP,h),a.trigger(d.PAN_DROP,h))}})},_handleTilesPositionInContainer:function(a,b,c){var d=c?c:!1,e=MathInteractives.Common.Components.Views.PanBalance.CONSTANT_PADDING_VALUE,f=this,g=(a.find(".pan-draggable-dispenser-tile"),2),h=null,i=null,j=b.data().isDisabled?b.data().isDisabled:this._getIsDisabled(),k=b.data().value,l=b.data().type,m=b.data().text,n=b.data().isVarNegative,o=this._getDroppedTileId(),p=this.idPrefix+"dropped-tile-"+o,q={type:l,text:m,value:k,isVarNegative:n,isDisabled:j},r=null,s=null;for("Var"===b.data().type&&(k=1);g>=0;g--)if(h=a.find(".row-"+g),r=f._isRowFull(h,k),i=r.isRowFull,!i)return s=f._createDraggableTiles(h,q,p,"",d),s.addClass("pan-draggable-dispenser-tile pan-dropped").attr({colNo:r.colNo,rowNo:g,panContainer:a.data().pos}),"Num"===l&&s.css({"margin-left":e*Math.abs(k)+"px","margin-right":e*Math.abs(k)+"px"}),f._incrementDroppedTileId(),j===!1&&s.on("dblclick",function(){f._doubleClickOnTileHandler($(this))}),s},_doubleClickOnTileHandler:function(a){if(!this._getIsDisabled()){var b=a.data().type,c=a.data().value,d=a.data().text,e=a.data().isVarNegative,f=a.data().isDisabled,g={value:c,type:b,text:d,isVarNegative:e,isDisabled:f},h=MathInteractives.Common.Components.Views.PanBalance;if("Num"===b&&c>1){var i=this,d=a.data().text,j=null,k=null,l={type:b,text:"1",value:1},m=a.attr("panContainer"),n=i.$("."+m+"-pan-wrapper").find(".dynamic-wrapper");for(a.remove(),j=0;c>j;j++){var o=$("<div>");o.data(l),k=i._handleTilesPositionInContainer(n,o),i._makeTileDraggableAfterDrop(k)}}this.trigger(h.DOUBLE_CLICK_TILE,g)}},_makeTileDraggableAfterDrop:function(a,b){var c=b?b:!1,d=this,e=MathInteractives.Common.Components.Views.PanBalance,f={revert:"invalid",zIndex:999,helper:"clone",start:function(a,b){$(this).css({visibility:"hidden"}),d.trigger(e.TILE_DRAG)},stop:function(a,b){$(this).css({visibility:"visible"})},containment:d._getContainmentSelector()};return $.fn.EnableTouch(".pan-draggable-dispenser-tile"),a.draggable(f),c?a.draggable("disable"):void 0},_isRowFull:function(a,b){var c=5,d=0,e=!1,f=a.find(".pan-draggable-dispenser-tile"),g=null;return f.each(function(){g=$(this);var a=Math.abs(g.data().value);"Var"===g.data().type&&(a=1),g.hasClass("ui-draggable-dragging")||(d+=a)}),d+=Math.abs(b),d>c&&(e=!0),{isRowFull:e,colNo:d}},_incrementDroppedTileId:function(){this.droppedTileId++},_getDroppedTileId:function(){return this.droppedTileId},_toggleDisableTiles:function(a,b,c){if("undefined"!=typeof a){var d=c?c:!1,e=this,f=b?b:this._getIsDisabled(),g=a,h=a.leftPan?a.leftPan:[],i=h.length,j=a.rightPan?a.rightPan:[],k=j.length,l=null,m=null,n=this.$(".left-pan-wrapper").find(".dynamic-container"),o=this.$(".right-pan-wrapper").find(".dynamic-container");for(l=0;i>l;l++){var p=$("<div>");h[l].isDisabled=f,p.data(h[l]),m=e._handleTilesPositionInContainer(n,p,d),m.attr("panContainer","left"),m=e._makeTileDraggableAfterDrop(m,f)}for(l=0;k>l;l++){var p=$("<div>");j[l].isDisabled=f,p.data(j[l]),m=e._handleTilesPositionInContainer(o,p,d),m.attr("panContainer","right"),m=e._makeTileDraggableAfterDrop(m,f)}g.position?e.animatePanBalance(g.position):e.animateDynamicPan()}},_renderDefaultTiles:function(a){var b=null;b="undefined"==typeof a.isDisabled?this._getIsDisabled():a.isDisabled;var c=this;c.clearPans(),c._toggleDisableTiles(a,b,!0)},_activateTrashCan:function(a){var b=this;$("#"+a).off("drop").on("drop",function(a,c){if(!c.draggable.hasClass("pan-dropped"))return void c.draggable.draggable("option","revert",!0);c.helper.hasClass("pan-dropped")&&c.draggable.remove();var d=MathInteractives.Common.Components.Views.PanBalance,e=c.draggable.data(),f={value:e.value,type:e.type,text:e.text,isVarNegative:e.isVarNegative},g=c.helper.remove(),h=b.$("."+g.attr("panContainer")+"-pan-wrapper").find(".dynamic-wrapper"),i=Number(g.attr("rowNo"));b.animateDynamicPan(),b._arrangeTilesInPan(h,i),b.trigger(d.TRASH_DROP,f)})},_getEquation:function(a,b){if("undefined"!=typeof a){var c=b?b:!1,d=MathInteractives.Common.Components.Views.PanBalance.VARIABLE_LABEL,e=this.$("."+a+"-pan-wrapper").find(".dynamic-container"),f=e.find(".pan-draggable-dispenser-tile"),g=[],h=null,i=0,j=0,k=null,l=null,m=null,n="",o=!0;if(f.each(function(){k=$(this),l=k.data(),m={value:l.value,type:l.type,text:l.text,isVarNegative:l.isVarNegative},"Num"===m.type&&(l.isVarNegative&&(m.value=-1*m.value),g.push(m.value))}),h=$(g),h.each(function(a,b){i+=b}),0>i&&(o=!1),j=this.getVariableCount(a),c){var p={constant:i,variable:j};return p}return 0===j?n=i.toString():0===i?(1===j?j="":-1===j&&(j="-"),n=j+'<span class="italic">'+d+"</span>"):(1===j?j="":-1===j&&(j="-"),n=o?j+'<span class="italic">'+d+"</span> + "+i:j+'<span class="italic">'+d+"</span> - "+Math.abs(i)),n}},_getContainmentSelector:function(){var a=this.containmentID;return"string"==typeof a?a="#"+a:"object"==typeof a&&(a=a),a},_arrangeTilesInPan:function(a,b,c){var d=this,e=c?c:this._getIsDisabled(),f=b,g=a,h=null,i=null,j=null,k=null;for(k=--f;k>-1;k--){var l=g.find(".row-"+k).children();l.each(function(){i=$(this),h={type:i.data().type,text:i.data().text,value:i.data().value,isVarNegative:i.data().isVarNegative,isDisabled:e},i.remove(),j=d._handleTilesPositionInContainer(g,i.data(h)),d._makeTileDraggableAfterDrop(j)})}},_getTileDataForPan:function(a){var b=this.$("."+a+"-pan-wrapper").find(".dynamic-container"),c=(b.find(".pan-row"),[]),d=MathInteractives.Common.Components.Views.PanBalance,e=null,f=null,g=null,h=null;return $(b.find(".pan-row").get().reverse()).each(function(){f=$(this).find(".pan-draggable-dispenser-tile"),f.each(function(){e=$(this),g=e.data(),"Var"===g.type&&(g.text=$(g.text).html()?$(g.text).html():g.text),h={type:g.type,text:g.text.toString().replace(d.NEGATIVE_TILE_INDICATOR,""),value:g.value,isVarNegative:g.isVarNegative,isDisabled:g.isDisabled},c.push(h)})}),c},_setIsDisabled:function(a){a?this.isPanDisabled=a:this.isPanDisabled=!1},_getIsDisabled:function(){return this.isPanDisabled},_getSpecificTypeTileCount:function(a,b,c){if("undefined"!=typeof b&&"undefined"!=typeof a){var d=this.getSaveState(),e=d[a+"Pan"],f=e.length,g=null,h=null,i=0,j=!1,k=c?c:!1;for(g=0;f>g;g++)h=e[g],k||(j=h.isVarNegative?h.isVarNegative:!1),h.type===b&&(j?i--:i++);return i}},renderDefaultTiles:function(a){a&&this._renderDefaultTiles(a)},disableDraggable:function(){this.$(".ui-draggable").draggable("disable"),this._setIsDisabled(!0);var a=this.getSaveState();this._renderDefaultTiles(a)},enableDraggable:function(){this.$(".ui-draggable").draggable("enable"),this._setIsDisabled(!1);var a=this.getSaveState();this._renderDefaultTiles(a)},showPanLabel:function(a,b){if("undefined"!=typeof a){var c=this.$("."+a+"-pan-wrapper").find(".pan-label"),d=null;d="undefined"==typeof b?this._getEquation(a):b,c.show().html(d)}},hidePanLabel:function(){this.$(".pan-label").hide()},showDispenser:function(){this.$(".dispenser-container").show()},hideDispenser:function(){this.$(".dispenser-container").hide()},isPanEmpty:function a(b){var c=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),d=c.find(".pan-draggable-dispenser-tile"),a=!1;return 0===d.length&&(a=!0),a},getPanWeight:function(a){var b=this.$("."+a+"-pan-wrapper").find(".dynamic-container"),c=b.find(".pan-draggable-dispenser-tile"),d=0,e=null,f=null;return c.each(function(){e=$(this);var a=1;e.data().isVarNegative&&(a=-1),
e.hasClass("ui-draggable-dragging")||(f=e.data().value,d+=f*a)}),d},animateDynamicPan:function(){var a="LEFT",b=this.getPanWeight("left"),c=this.getPanWeight("right");c>b&&(a="RIGHT"),b===c&&(a="CENTER"),this.animatePanBalance(a)},clearPans:function(){this.$(".dynamic-wrapper").find(".pan-draggable-dispenser-tile").remove(),this.animateDynamicPan()},getVariableCount:function(a){return this._getSpecificTypeTileCount(a,"Var")},getAbsoluteVariableCount:function(a){return this._getSpecificTypeTileCount(a,"Var",!0)},getConstantsCount:function(a){return this._getSpecificTypeTileCount(a,"Num")},getEquationCoefficients:function(a){return this._getEquation(a,!0)},modifyDispenser:function(a){var b=this.$(".dispenser-container").find(".pan-draggable-dispenser-tile");b.remove(),this.renderDispenser(a)},getSaveState:function(){var a=this,b=null;return b={leftPan:a._getTileDataForPan("left"),rightPan:a._getTileDataForPan("right"),isDisabled:a._getIsDisabled()}}},{LEFT_PAN_DROP:"left_pan_drop",RIGHT_PAN_DROP:"right_pan_drop",PAN_DROP:"pan_drop",TRASH_DROP:"trash_drop",DOUBLE_CLICK_TILE:"double_click_tile",TILE_DRAG:"tile_drag",NEGATIVE_TILE_INDICATOR:"",VARIABLE_LABEL:"x",CONSTANT_PADDING_VALUE:4,createPanBalance:function(a){var b;if(a){b="#"+a.containerId;var c=new MathInteractives.Common.Components.Models.PanBalance(a),d=new MathInteractives.Common.Components.Views.PanBalance({el:b,model:c});return d}},Position:{LEFT:0,CENTRE:1,RIGHT:2}}),MathInteractives.global.PanBalance=MathInteractives.Common.Components.Views.PanBalance}(),function(){"use strict";var a=null;MathInteractives.Common.Components.Views.PanBalanceDraggableTile=MathInteractives.Common.Player.Views.Base.extend({_backgroundPositions:null,isSelected:!1,initialize:function(a){this.filePath=a.filePath,this.tileData=a.buttonData,this.viewClassName=a.viewClassName,this.dataType=a.dataType,this.dataText=a.dataText,this.dataValue=a.dataValue,this._generateBackgroundPosition(),this.render(),a.buttonData.isDisabled?this.disableTile():this.enableTile()},render:function(){var a=this.tileData,b=this.viewClassName,c=this,d=c.$el,e=MathInteractives.Common.Components.templates.panBalanceDraggableTile({idPrefix:a.id}).trim();d.append(e),d.find(".pan-balance-draggable-tile-wrapper").css({width:a.width+"px",height:a.height+"px"}),82===a.width?(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER).addClass("text-var-container"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART).addClass("text-var"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW).addClass("var-tile-right-shadow"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW).addClass("var-tile-bottom-shadow")):(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER).removeClass("text-var-container"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART).removeClass("text-var"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW).removeClass("var-tile-right-shadow"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW).removeClass("var-tile-bottom-shadow"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW).addClass("num-tile-right-shadow"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW).addClass("num-tile-bottom-shadow")),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_LEFT_SHADOW).css({"background-image":'url("'+c.filePath.getImagePath("shadow-left")+'")',"background-position":"-17px -1058px"}),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW).css({"background-image":'url("'+c.filePath.getImagePath("shadow-right")+'") ',"background-position":"-593px -383px"}),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW).css({"background-image":'url("'+c.filePath.getImagePath("shadow-middle")+'")',"background-position":"0px -3901px"}),a.dataIsVarNegative===!0?(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_LEFT_PART).addClass("red-tiles-left"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_RIGHT_PART).addClass("red-tiles-right"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART).addClass("red-tiles-middle"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER).addClass("red-tile")):(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_LEFT_PART).addClass("green-tiles-left"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_RIGHT_PART).addClass("green-tiles-right"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART).addClass("green-tiles-middle"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER).addClass("green-tile")),d.find(".red-tiles-left").css({"background-image":'url("'+c.filePath.getImagePath("red-tile-left-right")+'")',"background-position":"0px -3647px"}),d.find(".red-tiles-right").css({"background-image":'url("'+c.filePath.getImagePath("red-tile-left-right")+'")',"background-position":"-50px -1085px"}),d.find(".red-tiles-middle").css({"background-image":'url("'+c.filePath.getImagePath("red-tile-middle")+'")',"background-position":"0px -3647px"}),d.find(".green-tiles-left").css({"background-image":'url("'+c.filePath.getImagePath("green-tile-left-right")+'")',"background-position":"0 -814px"}),d.find(".green-tiles-right").css({"background-image":'url("'+c.filePath.getImagePath("green-tile-left-right")+'")',"background-position":"0 -814px"}),d.find(".green-tiles-middle").css({"background-image":'url("'+c.filePath.getImagePath("green-tile-middle")+'")',"background-position":"0px -1462px"}),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_DOTS).css({background:'url("'+c.filePath.getImagePath("buttons-icons")+'")',"background-position":"-258px -399px"}),this._applyBackgroundPosition("active"),"Var"===this.dataType?a.dataIsVarNegative?(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT).addClass("negative-var"),d.find(".negative-var").html(a.text)):(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT).addClass("positive-var"),d.find(".positive-var").html(a.text)):a.dataIsVarNegative?(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT).addClass("positive-num"),d.find(".positive-num").text(a.text)):(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT).addClass("negative-num"),d.find(".negative-num").text(a.text))},attachEvents:function(){var a=$("#"+this.tileData.id),b=MathInteractives.Common.Utilities.Models.Utils;a.off("mouseover.tile").on("mouseover.tile",$.proxy(this._onMouseOver,this)),a.off("mouseout.tile").on("mouseout.tile",$.proxy(this._onMouseOut,this)),b.EnableTouch(a,{specificEvents:b.SpecificEvents.DRAGGABLE})},detachEvents:function(){var a=$("#"+this.tileData.id);a.off("mouseover.tile"),a.off("mouseout.tile"),MathInteractives.Common.Utilities.Models.Utils.DisableTouch(a)},_generateBackgroundPosition:function(){var a={active:{},hover:{},down:{}};a.active[0]=0,a.hover[0]=94,a.down[0]=94,a.active[1]=0,a.hover[1]=47,a.down[1]=47,a.active[2]=47,a.hover[2]=141,a.down[2]=141,this._backgroundPositions=a},_applyBackgroundPosition:function(a){var b=this._backgroundPositions[a],c=$("#"+this.tileData.id);c.find(".red-tiles-left").css("background-position","-50px -"+(b[0]+1085)+"px"),c.find(".red-tiles-middle").css("background-position","0px -"+(b[1]+3647)+"px"),c.find(".red-tiles-right").css("background-position","-50px -"+(b[2]+1085)+"px"),c.find(".green-tiles-left").css("background-position","0px -"+(b[0]+814)+"px"),c.find(".green-tiles-middle").css("background-position","0px -"+(b[1]+1462)+"px"),c.find(".green-tiles-right").css("background-position","0px -"+(b[2]+814)+"px")},_onMouseOver:function(a){var b=$(a.target);b.hasClass("pan-balance-draggable-tile-right-shadow")||b.hasClass("pan-balance-draggable-tile-bottom-shadow")||(this._applyBackgroundPosition("hover"),this.$el.find("div").addClass("hover"))},_onMouseOut:function(){this._applyBackgroundPosition("active"),this.$el.find("div").removeClass("hover")},_onMouseDown:function(){this._applyBackgroundPosition("down")},disableTile:function(){this.hideDraggableTileShadow(),this.hideDraggableTileDots(),this.detachEvents()},enableTile:function(){this.showDraggableTileDots(),this.showDraggableTileShadow(),this.attachEvents()},hideDraggableTileShadow:function(){var a=this.$el;a.find(".shadow").hide()},showDraggableTileShadow:function(){var a=this.$el;a.find(".shadow").show()},hideDraggableTileDots:function(){var a=this.tileData;$("#"+a.id).find(".pan-balance-draggable-tile-dots").hide(),"Var"===this.dataType?this.$el.find(".pan-balance-draggable-tile-text").css({height:"37px","line-height":"35px"}):this.$el.find(".pan-balance-draggable-tile-text").css({height:"37px","line-height":"37px"})},showDraggableTileDots:function(){var a=this.tileData;$("#"+a.id).find(".pan-balance-draggable-tile-dots").show(),this.$el.find(".pan-balance-draggable-tile-text").css({height:"25px","line-height":"25px"})},showBorder:function(a,b){var c=this.tileData,d=c.dataIsVarNegative,e=this.$(".pan-balance-draggable-tile-text-container"),f=null,g=MathInteractives.Common.Utilities.Models.BrowserCheck;return f=d?"red-tile-border":"green-tile-border",g.isFirefox&&(f=d?"red-tile-border-shadow":"green-tile-border-shadow"),e.hasClass(f)?(e.removeClass(f),this.isSelected=!1):(e.addClass(f),this.isSelected=!0),this.isSelected},removeBorder:function(a,b){var c=this.tileData,d=c.dataIsVarNegative,e=this.$(".pan-balance-draggable-tile-text-container"),f=d?"red-tile-border":"green-tile-border",g=MathInteractives.Common.Utilities.Models.BrowserCheck;return g.isFirefox&&(f=d?"red-tile-border-shadow":"green-tile-border-shadow"),e.removeClass(f),this.isSelected=!1,!1},addBorder:function(a){var b=this.tileData,c=b.dataIsVarNegative,d=this.$(".pan-balance-draggable-tile-text-container"),e=c?"red-tile-border":"green-tile-border",f=MathInteractives.Common.Utilities.Models.BrowserCheck;f.isFirefox&&(e=c?"red-tile-border-shadow":"green-tile-border-shadow"),d.addClass(e);var g=this.$el;g.find(".shadow").show(),this.isSelected=!0}},{hideDraggableTileShadow:function(a){a.find(".shadow").hide()},showDraggableTileShadow:function(a){a.find(".shadow").show()},setPulseEffect:function(a,b,c){var d=b,e=c;e?d.css({"box-shadow":"0px 0.732px 5px 1.5px rgba(31, 135, 99,"+a+")","-moz-box-shadow":"0px 0.732px 5px 1.5px rgba(31, 135, 99,"+a+")","-webkit-box-shadow":"0px 0.732px 5px 1.5px rgba(31, 135, 99,"+a+")"}):d.css({"box-shadow":"0px 0.732px 5px 1.5px rgba(152,0, 78,"+a+")","-moz-box-shadow":"0px 0.732px 5px 1.5px rgba(152,0, 78,"+a+")","-webkit-box-shadow":"0px 0.732px 5px 1.5px rgba(152,0, 78,"+a+")"})},showPulse:function(b,c,d){var e=c,d=d,f=b.find(".pan-balance-draggable-tile-text-container");a.hideDraggableTileShadow(b),$({step:.3}).animate({step:1},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){$({step:1}).animate({step:.3},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){$({step:.3}).animate({step:1},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){$({step:1}).animate({step:.3},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){$({step:.3}).animate({step:1},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){d&&d()},duration:500})},duration:500})},duration:500})},duration:500})},duration:500})},hidePulse:function(a){var b=a.find(".pan-balance-draggable-tile-text-container");b.css({"box-shadow":"none","-moz-box-shadow":"none","-webkit-box-shadow":"none"})},showHighlightedPulse:function(a,b){var c=a.find(".pan-balance-draggable-tile-text-container"),d=b;d?c.css({"box-shadow":"0px 0.732px 5px 1.5px rgb(31, 135, 99)","-moz-box-shadow":"0px 0.732px 5px 1.5px rgb(31, 135, 99)","-webkit-box-shadow":"0px 0.732px 5px 1.5px rgb(31, 135, 99)"}):c.css({"box-shadow":"0px 0.732px 5px 1.5px rgb(152,0, 78)","-moz-box-shadow":"0px 0.732px 5px 1.5px rgb(152,0, 78)","-webkit-box-shadow":"0px 0.732px 5px 1.5px rgb(152,0, 78)"})}}),a=MathInteractives.Common.Components.Views.PanBalanceDraggableTile}(),function(){"use strict";MathInteractives.Common.Components.Models.PanBalanceStructured=Backbone.Model.extend({defaults:function(){return{equationData:{a:4,b:11,c:-1},isDraggable:!1,enableDispenser:!1,isFilled:!0,dispenserData:[{type:"Var",text:"x",value:1,isVarNegative:!0},{type:"Num",text:"1",value:1,isVarNegative:!0},{type:"Var",text:"x",value:0},{type:"Num",text:"1",value:1}],leftPanWeight:0,rightPanWeight:0,currentPansData:null,showX:!1,xValue:0,prependID:"",forceAnimate:!1,isAnimation:!1,stepRotateObject:{rotate:0},draggableVariableValue:1,tabIndex:null,panTilesTabIndexes:new Object,equationToModel:null,negativeTiles:!0}},xValue:null,initialize:function(){var a=this.getEquationData(),b={left:{a:a.a,b:a.b,c:0},right:{a:0,b:0,c:a.c}};null===this.getCurrentPansData()&&this.setCurrentPansData(b),this.on("change:xValue",$.proxy(this._xValueChange,this))},getEquationData:function(){return this.get("equationData")},setEquationData:function(a){this.set("equationData",a)},getXValue:function(){return this.get("showX")?this.get("xValue"):"<i>x</i>"},getShowX:function(){return this.get("showX")},setShowX:function(a){this.set("showX",a),this.trigger("pan-showX-change")},setXValue:function(a){this.set("xValue",a)},getLeftPanWeight:function(){return this.get("leftPanWeight")},setLeftPanWeight:function(a){var b=a.a*this.get("xValue")+a.b;this.set("leftPanWeight",b)},getRightPanWeight:function(){return this.get("rightPanWeight")},setRightPanWeight:function(a){var b=a.a*this.get("xValue")+a.b+a.c;this.set("rightPanWeight",b)},getCurrentPansData:function(){return this.get("currentPansData")},setCurrentPansData:function(a){this.set("currentPansData",a),this.setLeftPanWeight(a.left),this.setRightPanWeight(a.right),this.trigger("pan-data-change")},getHeavierPan:function(a){var b=a?a:this.get("showX"),c="RIGHT";return this.getLeftPanWeight()>this.getRightPanWeight()?c="LEFT":this.getLeftPanWeight()===this.getRightPanWeight()&&(c="CENTRE"),this.getIsForceAnimation()||b||(c="CENTRE"),c},_xValueChange:function(){this.setCurrentPansData(this.getCurrentPansData())},setForceAnimate:function(a){return"undefined"==typeof a?void this.set("forceAnimate",!1):void this.set("forceAnimate",a)},getIsForceAnimation:function(){return this.get("forceAnimate")},setPanTilesTabIndexes:function(a){var b=$.extend(!0,{},a);this.set("panTilesTabIndexes",b)},getPanTilesTabIndexes:function(){return this.get("panTilesTabIndexes")}})}(),function(){"use strict";var a=null;MathInteractives.Common.Components.Views.PanBalanceStructured=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,isDraggable:!1,isFilled:!0,currentAngle:0,xAddedTill_R:{row:3,col:0},startOthertilesFrom_R:{row:0,col:0},xAddedTill_L:{row:3,col:0},startOthertilesFrom_L:{row:0,col:0},enableDispenser:!1,isAnimation:!1,droppedTileId:0,staticTileId:0,stepRotateObject:{rotate:0},trashCanID:null,containmentID:null,isPanDisabled:!1,prependID:null,forceAnimate:null,isFading:!1,draggableVariableValue:1,dispenserTiles:[],marqueeView:null,marqueeDragStartPoint:null,tabIndex:null,tileContainer:[],panTabIndexes:null,panPosition:null,currentDroppedTileSelected:null,currentSelectedDispenserTile:null,tilesToNullify:0,marqueeMoveOut:!1,initialize:function(){var a=this.model;this.prependID=a.get("prependID"),this.idPrefix=a.get("idPrefix"),this.idPrefix=this.idPrefix+this.prependID,this.manager=a.get("manager"),this.filePath=a.get("path"),this.player=a.get("player"),this.isDraggable=a.get("isDraggable"),this.dispenserData=a.get("dispenserData"),this.isFilled=a.get("isFilled"),this.enableDispenser=a.get("enableDispenser"),this.defaultData=a.get("defaultData"),this.trashCanID=a.get("trashCanID"),this.containmentID=a.get("containmentID"),this.marqueeContainer=a.get("marqueeContainer")?a.get("marqueeContainer"):this.$el,this.forceAnimate=a.get("forceAnimate"),this._setDraggableVariableValue(a.get("draggableVariableValue")),this.tabIndex=a.get("tabIndex"),this.panTabIndexes={leftPanVariable:{row3:this.tabIndex+25,row2:this.tabIndex+30,row1:this.tabIndex+35,row0:this.tabIndex+40},leftPanNumber:{row3:this.tabIndex+45,row2:this.tabIndex+65,row1:this.tabIndex+85,row0:this.tabIndex+115},rightPanVariable:{row3:this.tabIndex+137,row2:this.tabIndex+140,row1:this.tabIndex+145,row0:this.tabIndex+150},rightPanNumber:{row3:this.tabIndex+155,row2:this.tabIndex+175,row1:this.tabIndex+195,row0:this.tabIndex+215},leftTemporaryBin:{row2:this.tabIndex+255,row1:this.tabIndex+295,row0:this.tabIndex+335},rightTemporaryBin:{row2:this.tabIndex+375,row1:this.tabIndex+415,row0:this.tabIndex+455}},a.setPanTilesTabIndexes(this.panTabIndexes),this.render(),this.marqueeView=this._generateMarquee(),this.$(".pan-balance-draggable-tile-text-container").on("focusout",$.proxy(this.setDefaultTileAccText,this))},render:function(){var a={idPrefix:this.idPrefix},b=MathInteractives.Common.Components.templates.panBalanceStructured(a).trim();this.$el.append(b),this._setBackgroundImage(".left-pan,.right-pan,.small-rod,.base,.center-rod"),this._attachEvents(),this._createHackScreenForDispenser(),this.renderDispenser(),this.model.get("isDraggable")&&(this._initializeDroppableContainers(),this.defaultData&&this._renderDefaultTiles(this.defaultData),this._renderTemporaryTrashCan()),this._activateTrashCan(this.trashCanID)},setDefaultTileAccText:function(a){var b=this,c=null,d=b.dispenserTiles,e=!1,f=d.length,g=null,h=null,i=null;for(c=0;f>c;c++)g=d[c].$el.find(".pan-balance-draggable-tile-text-container").attr("id"),g=g.slice(b.idPrefix.length),e=d[c].isSelected,h=d[c].tileData.dataIsVarNegative?b.getAccMessage("negative",0)+" ":"",i=h+("Var"===d[c].dataType?"x":1),i+=" "+this.getAccMessage("tile",0),e&&(i+=" "+this.getAccMessage("tile",1)),this.setAccMessage(g,i)},_resetData:function(a,b){this.xAddedTill_R={row:3,col:0},this.startOthertilesFrom_R={row:b.rowCount-1,col:0},this.xAddedTill_L={row:3,col:0},this.startOthertilesFrom_L={row:a.rowCount-1,col:0}},_attachEvents:function(){this.model.on("pan-data-change",$.proxy(this.eventHandlers._panDataChangeEvent,this)),this.model.on("pan-showX-change",$.proxy(this.eventHandlers._panShowXChangeEvent,this)),this.model.on("pan-forceAnimate-change",$.proxy(this.eventHandlers._panForceAnimateChangeEvent,this))},_setBackgroundImage:function(a){if(a){var b=this.filePath.getImagePath("pan-balance");this.$(a).css({"background-image":"url("+b+")"})}},animatePanBalance:function(a){if(!this._skipAnimation){this.marqueeView&&this.marqueeView.disableMarquee();var b=0;switch(a){case"LEFT":b=-5;break;case"RIGHT":b=5}var c=1e3,d=this,e=parseInt(this.$(".center-rod").css("width").split("px")[0]),f=e/2,g=d.$(".center-rod"),h=d.$(".left-pan-wrapper"),i=d.$(".right-pan-wrapper"),j=null,k=null,l=[],m=!1;this.model.set("stepRotateObject",$.extend({},{rotate:this.currentAngle})),d.currentAngle===b?(this.isAnimationOn()===!0?m=!0:d.model.set("isAnimation",!1),d._getIsDisabled()||d.marqueeView&&d.marqueeView.enableMarquee()):m=!0,m&&(this.model.set("isAnimation",!0),$(this.model.get("stepRotateObject")).stop().animate({rotate:b},{step:function(a){j=Math.sin(Math.PI/180*a)*f,h.css("top",-j+"px"),i.css("top",j+"px"),g.css({"-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)",transform:"rotate("+a+"deg)"}),k=$("<span></span>"),$("body").append(k),l.push(k.get(0)),d.currentAngle=a},complete:function(){d.model.set("isAnimation",!1),$(l).remove(),d._getIsDisabled()||d.marqueeView&&d.marqueeView.enableMarquee()},duration:c}))}},renderPan:function(){if(!this.enableDispenser){var a,b,c,d,e=this,f=this.model.getCurrentPansData(),g=f.left,h=f.right,i=this.$(".left-tile-container .static-container"),j=this.$(".right-tile-container .static-container"),k=4;!this.isDraggable&&this.isFilled&&(c=this._calculateRowsCols(Math.abs(g.a),Math.abs(g.b)+Math.abs(g.c)),d=this._calculateRowsCols(Math.abs(h.a),Math.abs(h.b)+Math.abs(h.c)),this._resetData(c,d),a=this._createTilesContainer(c),g.a=g.a>k?k:g.a,i.show().empty().append(a),e.addElementsToPan(a,g.a,c,!0,"LEFT"),e.addElementsToPan(a,g.b,c,!1,"LEFT"),e.addElementsToPan(a,g.c,c,!1,"LEFT"),b=this._createTilesContainer(d),h.a=h.a>k?k:h.a,j.show().empty().append(b),e.addElementsToPan(b,h.a,d,!0,"RIGHT"),e.addElementsToPan(b,h.b,d,!1,"RIGHT"),e.addElementsToPan(b,h.c,d,!1,"RIGHT"),e._adjustTablePosition(),e._displayEquation())}},_createTilesContainer:function(a,b){var c,d,e,f,g=a,h=g.rowCount,i=g.colCount,j=b?b:$("<div>",{"class":"pan-table"});for(e=0;h>e;e++)for(c=$("<div>",{"class":"pan-row row-"+e}),j.append(c),f=0;i>f;f++)d=$("<div>",{"class":"pan-cell cell-"+f}),c.append(d);return j},_createStaticTileSlices:function(a){if(a){var b,c,d=3,e=a;for(c=0;d>c;c++)b=$("<div>",{"class":"static-tile static-cell-"+c}),e.append(b);return e}},_calculateRowsCols:function(a,b){var c,d,e,f=4;return e=a>b?a:b,c=e>3?f:e,d=Math.ceil(a/c)+Math.ceil(b/c),d>5&&(d=5),{colCount:d,rowCount:c}},addElementsToPan:function(a,b,c,d,e){var f,g,h=b,i=this,j="coefficients",k=0,l=1,m=c.rowCount;c.colCount,MathInteractives.Common.Components.Views.Button.TYPE.CUSTOM;if(d&&(j="coefficients-x",l=this.model.getXValue()),0>b&&(l=0===l?0:"string"==typeof l?"-"+l:-1*l,b=Math.abs(b)),d&&0!==b){for(var n=0,o=m-1;b>k;k++){0>o&&(n++,o=m-1);var p=({id:"static-"+i._getStaticTileId(),imagePathIds:["pan-balance-green-right","pan-balance-green-mid","pan-balance-green-left"]},$("<div>",{"class":j+" xCoefficient"})),q=0>h?"-":"+";a.find(".row-"+o+" .cell-"+n).append(p),i._createStaticTileButton(l,p,q),o--}"LEFT"===e?(this.xAddedTill_L={row:o+1,col:n},this.startOthertilesFrom_L={row:m-1,col:n+1}):(this.xAddedTill_R={row:o+1,col:n},this.startOthertilesFrom_R={row:m-1,col:n+1})}else{"LEFT"===e?(f=this.xAddedTill_L.row-1,g=this.xAddedTill_L.col):(f=this.xAddedTill_R.row-1,g=this.xAddedTill_R.col);for(var n="LEFT"===e?this.startOthertilesFrom_L.col:this.startOthertilesFrom_R.col,o="LEFT"===e?this.startOthertilesFrom_L.row:this.startOthertilesFrom_R.row;b>k;k++){0>o&&(n++,o=m-1);var p=$("<div>",{"class":j});if(4>=n){var q=0>l?"-":"+";a.find(".row-"+o+" .cell-"+n).append(p),i._createStaticTileButton(l,p,q)}o--}"LEFT"===e?this.startOthertilesFrom_L={row:o,col:n}:this.startOthertilesFrom_R={row:o,col:n}}},_adjustTablePosition:function(){var a=this.$(".left-tile-container .static-container"),b=this.$(".right-tile-container .static-container"),c=b.find(".pan-table"),d=a.find(".pan-table");c.css({top:b.height()-c.height()}),d.css({top:a.height()-d.height()})},_displayEquation:function(){var a=this.model.getCurrentPansData(),b=a.left,c=a.right,d=this.$(".left-pan .pan-data"),e=this.$(".right-pan .pan-data"),f="",g="",h=4;b.a=b.a>h?h:b.a,c.a=c.a>h?h:c.a,f=0===b.a?"":b.a+"<i>x</i>",1===Math.abs(b.a)&&(f="<i>x</i>",b.a<0&&(f="-<i>x</i>")),f+=0===b.b?"":b.b>0?" + "+b.b:" - "+Math.abs(b.b),f+=0===b.c?"":b.c>0?" + "+b.c:" - "+Math.abs(b.c),g=0===c.a?"":c.a+"<i>x</i>",1===Math.abs(c.a)&&(g="<i>x</i>",c.a<0&&(g="-<i>x</i>")),g+=0===c.b?"":c.b>0?" + "+c.b:" - "+Math.abs(c.b),g+=0===c.c?"":c.c>0?" + "+c.c:" - "+Math.abs(c.c),0===c.a&&0===c.b&&(g=Number(g.replace(/\s/g,""))),0===b.a&&0===b.b&&(f=Number(f.replace(/\s/g,""))),d.html(f),e.html(g)},setPansData:function(a){var b={left:{},right:{}};b.left.a=a.left.a||0,b.left.b=a.left.b||0,b.left.c=a.left.c||0,b.right.a=a.right.a||0,b.right.b=a.right.b||0,b.right.c=a.right.c||0,this.model.setCurrentPansData(b)},setXValue:function(a){this.model.setXValue(a)},showX:function(a){this.model.setShowX(a)},isAnimationOn:function(){return this.model.get("isAnimation")},forceAnimatePanBalance:function(){this.model.setForceAnimate(!0)},eventHandlers:{_panDataChangeEvent:function(){this.renderPan(),this.model.getIsForceAnimation()||this.model.getShowX()||(this.currentAngle=0),this.animatePanBalance(this.model.getHeavierPan())},_panShowXChangeEvent:function(){var a=this.model.getXValue(),b=this.model.getCurrentPansData();(b.left.a<0||b.right.a<0)&&0>a&&(a="(-"+Math.abs(a)+")"),a=b.left.a>0?a:"string"==typeof a?"-"+a:-1*a,this.$(".left-tile-container .xCoefficient .static-cell-1").html(a),a=b.right.a>0?a:"string"==typeof a?"-"+a:-1*a,this.$(".right-tile-container .xCoefficient .static-cell-1").html(a),this.animatePanBalance(this.model.getHeavierPan())}},_createStaticTileButton:function(a,b,c){if("undefined"!=typeof a&&b){var d=this,e="-"===c?"red":"green",f=d._createStaticTileSlices(b);return f.find(".static-cell-0").css({"background-image":'url("'+d.filePath.getImagePath("pan-balance-"+e+"-left-right")+'")'}),f.find(".static-cell-1").css({"background-image":'url("'+d.filePath.getImagePath("pan-balance-"+e+"-mid")+'")'}).html(a),void f.find(".static-cell-2").css({"background-image":'url("'+d.filePath.getImagePath("pan-balance-"+e+"-left-right")+'")'})}},_createHackScreenForDispenser:function(){var a,b=this,c=this.model.get("negativeTiles")===!1?1:0;this.loadScreen("pan-balance"),a={elementId:"-dispenser-container",tabIndex:b.tabIndex,acc:b.getAccMessage("dispenser",c)},this.createAccDiv(a)},renderDispenser:function(a){if(this.enableDispenser){this.dispenserTiles=[];var b,c=this,d=MathInteractives.Common.Components.Views.PanBalanceStructured,e=a?a:this.dispenserData,f=e.length,g=this.model.get("negativeTiles")===!1?2:0,h=(this.$(".dispenser-container").show(),this.$(".dispenser-row-1")),i=this.$(".dispenser-row-2"),j={revert:"invalid",zIndex:999,helper:"clone",start:function(a,b){var e=MathInteractives.Common.Utilities.Models.BrowserCheck;e.isFirefox?(b.helper.children().find(".green-tile-border-shadow").removeClass("green-tile-border-shadow"),b.helper.children().find(".red-tile-border-shadow").removeClass("red-tile-border-shadow")):(b.helper.children().find(".green-tile-border").removeClass("green-tile-border"),b.helper.children().find(".red-tile-border").removeClass("red-tile-border")),c._removeMarqueeOnTileDrag(),c.trigger(d.TILE_DRAG),$(this).draggable("option","revert","invalid"),b.helper.find(".green-tile-border").removeClass("green-tile-border"),b.helper.find(".red-tile-border").removeClass("red-tile-border")},cancel:".var-tile-right-shadow,.num-tile-right-shadow,.var-tile-bottom-shadow,.num-tile-bottom-shadow",containment:c._getContainmentSelector(),appendTo:c._getContainmentSelector()},k=null;for(this.$(".dynamic-container");f>g;g++)b=e[g].isVarNegative?h:i,this.model.get("negativeTiles")===!1&&this.$(h).remove(),k=this._createDraggableTiles(b,e[g],this.idPrefix+"dispenser-tile-",g,!0,!0),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$("."+d.TILE_CLASS),{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE|MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.STOP_PROPAGATION}),k.draggable(j),k.off("touchmove.forStopPropogation").on("touchmove.forStopPropogation",function(a){a.stopPropagation()}),c._makeContextMenuForDraggable(k,"dispenser",!1)}},_makeContextMenuForDraggable:function(a,b,c){var d,e=this,f={el:e.player.$el,prefix:e.idPrefix,contextMenuCount:5,manager:e.manager,thisView:e,nestedMenuData:{},elements:[a],screenId:"pan-balance-context-menu"},g="dispenser"===b;d=MathInteractives.global.ContextMenu.initContextMenu(f);var h=e._getIgnoreOptionsForTile(a,b,c);d.editContextMenu(h,!0),a.data({contextMenu:d}),a.on(MathInteractives.global.ContextMenu.CONTEXTMENU_SELECT,$.proxy(this._onContextMenuSelect,this,a,g)),a.on(MathInteractives.global.ContextMenu.CONTEXTMENU_HIDE,$.proxy(this._onContextMenuHide,this,a)),a.off("keyup.deleteFromPan").on("keyup.deleteFromPan",function(b){b=b?b:window.event;var c=b.keyCode?b.keyCode:b.which;68===c&&e._throwAwayTile(a)})},_onContextMenuHide:function(a,b,c){var d=a[0].id.slice(this.idPrefix.length)+"-draggable-tile-text-container";this.setFocus(d)},_onContextMenuSelect:function(a,b,c,d){var e,f=d.currentTarget.id,g=f.charAt(f.length-1),h=b===!0,i=!1;switch(g){case"0":e=this.$("#"+this.idPrefix+"-left-dynamic-wrapper");break;case"1":e=this.$("#"+this.idPrefix+"-right-dynamic-wrapper");break;case"2":e=null;break;case"3":e=this.$("#"+this.idPrefix+"-left-temporary-bin"),i=!0;break;case"4":e=this.$("#"+this.idPrefix+"-right-temporary-bin"),i=!0}e?(this._addTileInContainer(a,e,h,i),"3"===g?this.setFocus("-left-temporary-bin"):"4"===g&&this.setFocus("-right-temporary-bin")):this._throwAwayTile(a)},_createDraggableTiles:function(b,c,d,e,f,g){var h=f?f:!1,i=c.isDisabled?c.isDisabled:this._getIsDisabled(),j=c.isVarNegative?c.isVarNegative:!1,k=c.text,l=c.type,m="Var"===c.type?this.draggableVariableValue:c.value,n=MathInteractives.Common.Components.Views.Button.TYPE.CUSTOM,o=j?["pan-balance-red-draggable-left-right","pan-balance-red-draggable-mid"]:["pan-balance-green-draggable-left-right","pan-balance-green-draggable-mid"],p=41,q=82,r=this.filePath,s=d,t=null,u=null,r=this.filePath,v=null,w=this;"undefined"!=typeof e&&(s+=e),t=d+" "+a.TILE_CLASS+" draggable-tile"+l,t=g?t+" dispenser-tile":t,u=$("<div>",{id:s,"class":t}),"Num"===l&&(q=41),h&&-1===k.indexOf(a.NEGATIVE_TILE_INDICATOR)&&("Var"===l&&(j&&(k=a.NEGATIVE_TILE_INDICATOR+k),k="<i>"+k+"</i>"),"Num"===l&&j&&(k=a.NEGATIVE_TILE_INDICATOR+k)),v={id:s,type:n,path:r,text:k,width:q,imagePathIds:o,height:p,isDraggable:!0,isDisabled:i,dataIsVarNegative:j},b.append(u);var x=new MathInteractives.Common.Components.Views.PanBalanceDraggableTile({el:u,buttonData:v,filePath:r,viewClassName:a,dataType:l,dataText:k,dataValue:m});return g&&(this._createHackScreenForDispenserTiles({$draggableTile:u,dataText:c.text,tileNegative:v.dataIsVarNegative}),this.dispenserTiles.push(x),u.on("click",function(){if(!w._getIsDisabled()){var b,c=null,d=w.dispenserTiles,e=d.length,f=w.$(this).find(".pan-balance-draggable-tile-text-container").attr("id"),g=$(this).data("isVarNegative")?w.getAccMessage("negative",0)+" ":"",h=g+("Var"===$(this).data("type")?"x":1);for(f=f.slice(w.idPrefix.length),w.$("#"+w.idPrefix+f+"-acc-elem").blur(),c=0;e>c;c++)d[c]!==x&&(d[c].removeBorder(),w._changeDispenserTileAccMsg(d[c].$el,!1));b=x.showBorder(),w._changeDispenserTileAccMsg(x.$el,b),w._removeMarqueeOnTileDrag(),w.setFocus(f),w._setPanAccText(h),w._setTempBinAccText(),w.trigger(a.DISPENSER_TILE_CLICKED,{newTile:x}),w.currentSelectedDispenserTile=x}})),this._handleMarqueeShowHide(x.$el),u.data({value:m,type:l,text:k,isVarNegative:j,isDisabled:i})},_changeDispenserTileAccMsg:function(a,b){var c=a.find(".pan-balance-draggable-tile-text-container").attr("id"),d=a.data("isVarNegative")?this.getAccMessage("negative",0)+" ":"";c=c.slice(this.idPrefix.length),d+="Var"===a.data("type")?"x":1,d+=" "+this.getAccMessage("tile",0),d+=b?" "+this.getAccMessage("tile",1):" "+this.getAccMessage("tile",2),this.setAccMessage(c,d)},changeDispenserTileAccMsg:function(a,b){this._changeDispenserTileAccMsg(a,b)},_setPanAccText:function(a,b){var c,d,e,f,g,h,i=this,j=null,k=null,l=i._getCurrentSelectedDispenserTile(),m=i.getTileCountInPan("left"),n=i.getTileCountInPan("right");null===l?(i._enableDisableDroppedTile(!0),0===m&&!b||0===m&&b?j=i.getAccMessage("left-dynamic-pan",0):(j=i.getAccMessage("left-dynamic-pan",2),e=i._getAccTextForEquation("left"),b||(j=i.getAccMessage("pan-state","current-equation",[e])+" "+j)),0===n&&!b||0===n&&b?k=i.getAccMessage("right-dynamic-pan",0):(k=i.getAccMessage("right-dynamic-pan",2),f=i._getAccTextForEquation("right"),b||(k=i.getAccMessage("pan-state","current-equation",[f])+" "+k))):(i._enableDisableDroppedTile(!1),a||(d=l.data("isVarNegative")?i.getAccMessage("negative",0)+" ":"",a=d+("Var"===l.data("type")?"x":"1")),0===m&&!b||1===m&&b?j=i.getAccMessage("left-dynamic-pan",1,[a]):(c=i._getAccTextForEquation("left"),j=i.getAccMessage("left-dynamic-pan",3,[c,a])),0===n&&!b||1===n&&b?k=i.getAccMessage("right-dynamic-pan",1,[a]):(c=i._getAccTextForEquation("right"),k=i.getAccMessage("right-dynamic-pan",3,[c,a]))),b&&(g=void 0===e?i.getAccMessage("tile-delete-text",1,[b]):i.getAccMessage("tile-delete-text",0,[b,e]),j=g+j,h=void 0===f?i.getAccMessage("tile-delete-text",1,[b]):i.getAccMessage("tile-delete-text",0,[b,f]),k=h+k),i.setAccMessage("-left-dynamic-wrapper",j),i.setAccMessage("-right-dynamic-wrapper",k)},_getAccTextForEquation:function(a){var b,c,d,e,f=this.getEquationCoefficients(a);return 0===f.constant?b=1===f.variable?"x":-1===f.variable?this.getMessage("pan-equation-text","minus")+" x":this.getMessage("pan-equation-text",0,[f.variable]):0===f.variable?b=f.constant:(c=1===f.variable?"":-1===f.variable?this.getMessage("pan-equation-text","minus"):f.variable,
f.constant<0?(e=this.getMessage("pan-equation-text","minus"),d=Math.abs(f.constant)):(e=this.getMessage("pan-equation-text","plus"),d=f.constant),b=this.getMessage("pan-equation-text",1,[c,e,d])),b},_enableDisableDroppedTile:function(a){var b=this;b.$(".pan-dropped").each(function(){var c=$(this).find(".pan-balance-draggable-tile-text-container").attr("id").slice(b.idPrefix.length);c&&(b.enableTab(c,a),a===!0&&(b._reassignTabIndexesToPanTiles(0,"left"),b._reassignTabIndexesToPanTiles(0,"right")))})},_createHackScreenForDispenserTiles:function(a){var b=a.$draggableTile.find(".pan-balance-draggable-tile-text-container").attr("id"),c=a.tileNegative?this.getAccMessage("negative",0)+" ":"";b=b.slice(this.idPrefix.length),c+="1"===a.dataText?"1":a.dataText,this.tabIndex+=2;var d={elementId:b,tabIndex:this.tabIndex,acc:c+" "+this.getAccMessage("tile",0)};this.createAccDiv(d)},_createHackScreenForPanTiles:function(a){var b,c=a.newTile.find(".pan-balance-draggable-tile-text-container").attr("id"),d=a.panPosition,e=a.newTile.data().type,f="Var"===e?"x":"1",g=a.newTile.attr("rowNo"),h=a.newTile.attr("colNo");a.newTile.data().isVarNegative&&(f=this.getAccMessage("negative",0)+" "+f),c=c.slice(this.idPrefix.length),b="left"===d?"Var"===e?this._getTabIndexForVar(g,"leftPanVariable"):this._getTabIndexForNum(g,h,"leftPanNumber",d):"Var"===e?this._getTabIndexForVar(g,"rightPanVariable"):this._getTabIndexForNum(g,h,"rightPanNumber",d);var i={elementId:c,tabIndex:b,acc:f+" "+this.getAccMessage("tile",0)};this.createAccDiv(i),null!==this._getCurrentSelectedDispenserTile()&&this.enableTab(c,!1)},_getTabIndexForVar:function(a,b){var c;switch(parseInt(a)){case 3:c=this.panTabIndexes[b].row3;break;case 2:c=this.panTabIndexes[b].row2;break;case 1:c=this.panTabIndexes[b].row1;break;case 0:c=this.panTabIndexes[b].row0}return c},_getTabIndexForNum:function(a,b,c,d){var e,f,g,h=0,i=this,j=i._getCurrentSelectedDispenserTile();if(null===j){i._reassignTabIndexesToPanTiles(parseInt(a)+1,d),h=0,f=this.$("."+d+"-tile-container").find(".Num-table").find(".row-"+a).children().length;for(var k=0;f-1>k;k++){var l=$(this.$("."+d+"-tile-container").find(".Num-table").find(".row-"+a).children()[k]);g=l.find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),this.setTabIndex(g,this.panTabIndexes[c]["row"+a]+h),h+=5}}switch(parseInt(a)){case 3:e=this._getTabIndexForNumAccordingToRowLen("row3",f,c);break;case 2:e=this._getTabIndexForNumAccordingToRowLen("row2",f,c);break;case 1:e=this._getTabIndexForNumAccordingToRowLen("row1",f,c);break;case 0:e=this._getTabIndexForNumAccordingToRowLen("row0",f,c)}return e},_getTabIndexForNumAccordingToRowLen:function(a,b,c){var d;switch(parseInt(b)){case 1:d=this.panTabIndexes[c][a];break;case 2:d=this.panTabIndexes[c][a]+5;break;case 3:d=this.panTabIndexes[c][a]+10;break;case 4:d=this.panTabIndexes[c][a]+15}return d},_reassignTabIndexesToPanTiles:function(a,b){for(var c,d,e,f=this,g=a;3>=g;g++){c=0,d=this.$("."+b+"-tile-container").find(".Num-table").find(".row-"+g).children().length;for(var h=0;d>h;h++){var i=$(this.$("."+b+"-tile-container").find(".Num-table").find(".row-"+g).children()[h]);e=i.find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),f.setTabIndex(e,f.panTabIndexes[b+"PanNumber"]["row"+g]+c),c+=5}}},_createHackScreenForTemporaryBinTiles:function(a){if(!this.isMarqueeDrop){var b,c,d,e=a.attr("panContainer"),f=a.attr("rowNo"),g="Var"===a.data().type?"x":"1",h=a.parent().children().length;a.data().isVarNegative&&(g=this.getAccMessage("negative",0)+" "+g),b="left"===e?"leftTemporaryBin":"rightTemporaryBin";for(var i=0;h>i;i++){c=$(a.parent().children()[i]).find(".pan-balance-draggable-tile-text-container").attr("id"),c=c.slice(this.idPrefix.length),d=this.panTabIndexes[b]["row"+f]+5*i;var j={elementId:c,tabIndex:d,acc:this.getAccMessage("temporaryTrashCanTile",0)+" "+g};this.createAccDiv(j)}}},_initializeDroppableContainers:function(){var b=this,c=this.$(".dynamic-container"),d=null,e=null,f=a.MAX_ROWS;a.MAX_COLS;d=this._createTilesContainer({rowCount:f,colCount:0}).addClass("Num-table"),e=this._createTilesContainer({rowCount:f,colCount:0}).addClass("Var-table"),c.find(".dynamic-wrapper").append(e).append(d),b._attachHandlerForClickAndClick(),c.show().droppable({drop:function(a,c){b._panDropHandler(a,c,$(this).find(".dynamic-wrapper"))}});var g=this.$(".left-tile-container"),h=this.$(".right-tile-container");this._createHackScreenForLeftDynamicPan(g),this._createHackScreenForRightDynamicPan(h),this._createHackScreenForAccessibilityPans(g),this._createHackScreenForAccessibilityPans(h),b._attachHandlersForAccessibilityHelperPans()},_attachHandlersForAccessibilityHelperPans:function(){var a=this,b=null,c="-left-accessibility-dynamic-wrapper",d="-right-accessibility-dynamic-wrapper",e="-left-accessibility-temporary-bin",f="-right-accessibility-temporary-bin",g=this.$("#"+this.idPrefix+c),h=this.$("#"+this.idPrefix+d),i=this.$("#"+this.idPrefix+e),j=this.$("#"+this.idPrefix+f),k="-left-dynamic-wrapper",l="-right-dynamic-wrapper",m="-left-temporary-bin",n="-right-temporary-bin",o=this.$("#"+this.idPrefix+k),p=this.$("#"+this.idPrefix+l),q=this.$("#"+this.idPrefix+m),r=this.$("#"+this.idPrefix+n);g.off("click").on("click",function(c){b=a.currentDroppedTileSelected,a._addTileInContainer(b,o,!1,!1),a._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin")}),h.off("click").on("click",function(c){b=a.currentDroppedTileSelected,a._addTileInContainer(b,p,!1,!1),a._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin")}),i.off("click").on("click",function(c){b=a.currentDroppedTileSelected,a._addTileInContainer(b,q,!1,!0),a.setFocus("-left-temporary-bin"),a._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin")}),j.off("click").on("click",function(c){b=a.currentDroppedTileSelected,a._addTileInContainer(b,r,!1,!0),a.setFocus("-right-temporary-bin"),a._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin")}),a.$("#"+a.idPrefix+k+"-acc-elem").off("keydown.pan-balance").on("keydown.pan-balance",$.proxy(a._setPanAccTextOnTab,a)),a.$("#"+a.idPrefix+l+"-acc-elem").off("keydown.pan-balance").on("keydown.pan-balance",$.proxy(a._setPanAccTextOnTab,a)),a.focusOut(k,function(){a._setPanAccText()}),a.focusOut(l,function(){a._setPanAccText()})},_setPanAccTextOnTab:function(a){a=a?a:window.event;var b=a.keyCode?a.keyCode:a.which;9===b&&this._setPanAccText()},_attachHandlerForClickAndClick:function(){var a=this,b=this.$(".dynamic-container");b.off("click").on("click",function(b){var c=a._getCurrentSelectedDispenserTile();c&&!a.isFading&&a._addTileInContainer(c,$(this).find(".dynamic-wrapper"),!0,!1)})},_detachHandlerForClickAndClick:function(){var a=this.$(".dynamic-container");a.off("click")},_addTileInContainer:function(a,b,c,d,e){var f=this,g={draggable:a,helper:a},h=d?f._onTemporaryBinDrop:f._panDropHandler;h.call(f,null,g,b,c,e)},_panDropHandler:function(b,c,d,e,f){if(c.draggable.hasClass("marquee-div"))return void this._marqueeDrop(b,c,d);var g,h=this,i="temporary-dropped",j=c.helper,k=c.draggable,l=d,m=l.data().pos,n=k.data(),o={value:n.value,type:n.type,text:n.text,isVarNegative:n.isVarNegative},p=c.helper.clone(),q=p.attr("panContainer"),r=Number(p.attr("rowNo")),s=q+"-pan-wrapper",t="ui-draggable-dragging",u=h.$("."+q+"-temporary-bin"),v=null,w=!0;h.panPosition=m,p.removeClass(t).data(o);var x=d.attr("id").slice(h.idPrefix.length),y=!1;if(k.hasClass(i))k.attr("pancontainer")===m?(v=h._handleTilesPositionInContainer(l,p),v?(h._createHackScreenForPanTiles({newTile:v,panPosition:v.attr("panContainer")}),h._makeTileDraggableAfterDrop(v),h._makeContextMenuForDraggable(v,v.attr("panContainer"),!0),h.animateDynamicPan(),k.remove(),y=h._nullifyTileAfterDrop(l,v),setTimeout(function(){h._arrangeTilesInTemporaryTrashCans(u,3)},1)):k.draggable("option","revert",!0)):k.draggable("option","revert",!0);else{if(v=h._handleTilesPositionInContainer(l,p),v&&!l.parents(".pan-wrapper").hasClass(s)){h._createHackScreenForPanTiles({newTile:v,panPosition:v.attr("panContainer")}),g="left"===m?this.$(".left-temporary-bin"):this.$(".right-temporary-bin");h.isTemporaryBinFull(g,v);if(q){var z=h.$("."+s).find(".dynamic-wrapper");z.find("#"+k[0].id).remove(),h._arrangeTilesInPan(z,r,!1,z.find("."+n.type+"-table"))}h._makeTileDraggableAfterDrop(v);var A="block"===this.$("#"+this.idPrefix+"-left-temporary-bin").css("display");h._makeContextMenuForDraggable(v,v.attr("panContainer"),A)}else{h.$("#"+h.idPrefix+x+"-acc-elem").blur();var B,C,D,E,F=n.isVarNegative?h.getAccMessage("negative",0)+" ":"",G=this.getEquationCoefficients(m),H=G.constant,I=G.variable;F+="Num"==n.type?"1":"x",D=h._getAccTextForEquation(m),E=h.getAccMessage("pan-state","current-equation",[D]),"right"===m?(B=h.getAccMessage("right",0),I>=a.MAX_VARIABLE&&H>=a.MAX_CONSTANT?C=h.getAccMessage("pan-state","full",[B,D]):I>=a.MAX_VARIABLE?C=h.getAccMessage("pan-state","variable-full")+" "+E:H>=a.MAX_CONSTANT&&(C=h.getAccMessage("pan-state","constant-full")+" "+E),h.setAccMessage("-right-dynamic-wrapper",C)):(B=h.getAccMessage("left",0),I>=a.MAX_VARIABLE&&H>=a.MAX_CONSTANT?C=h.getAccMessage("pan-state","full",[B,D]):I>=a.MAX_VARIABLE?C=h.getAccMessage("pan-state","variable-full")+" "+E:H>=a.MAX_CONSTANT&&(C=h.getAccMessage("pan-state","constant-full")+" "+E),h.setAccMessage("-left-dynamic-wrapper",C)),h.setFocus(x),$(v).remove(),v=null,k.draggable("option","revert",!0),w=!1}v&&(k.draggable(),k.draggable("option","revert",!0),y=h._nullifyTileAfterDrop(l,v,k.hasClass("dispenser-tile")),y!==a.TILE_NOT_NULLIFIED&&y!==a.TILE_NULLIFIED||e?e||y!==a.PAN_FULL||(v.remove(),k.draggable("option","revert",!0),j.hasClass("pan-dropped")&&k.remove()):(j.remove(),j.hasClass("pan-dropped")&&k.remove()),this._updateEquationForDynamicPanBalance(),this.animateDynamicPan())}if(w&&!f){var J,K,L,M,N,O,P=n.isVarNegative?h.getAccMessage("negative",0)+" ":"",F="",Q=h._getAccTextForEquation(m),R=h.getPanWeight("left"),S=h.getPanWeight("right"),T=h.getAccMessage("left",0),U=h.getAccMessage("right",0),V="",W=!1;R>S?(J=U,K=T,V=h.getAccMessage("balance",0,[K,J])):S>R?(J=T,K=U,V=h.getAccMessage("balance",0,[K,J])):(L=h.getEquationCoefficients("left"),M=h.getEquationCoefficients("right"),N=h.getEquationToModel(),0===M.variable&&M.constant===N.c&&L.variable===N.a&&L.constant===N.b&&"block"!=h.$("#"+h.idPrefix+"-left-temporary-bin").css("display")&&(W=!0),V=h.getAccMessage("balance",1)),F="Num"==n.type?"1":"x","right"===m?(W||(h.$("#"+h.idPrefix+x+"-acc-elem").blur(),O=h.getAccMessage("right-dynamic-pan",4,[P+F,Q]),y&&(O=h.getAccMessage("right-dynamic-pan",5,[F,F,Q])),O=O+" "+V,h.setAccMessage(x,O),h.setFocus(x)),h.trigger(a.RIGHT_PAN_DROP,o)):(W||(h.$("#"+h.idPrefix+x+"-acc-elem").blur(),O=h.getAccMessage("left-dynamic-pan",4,[P+F,Q]),y&&(O=h.getAccMessage("left-dynamic-pan",5,[F,F,Q])),O=O+" "+V,h.setAccMessage(x,O),h.setFocus(x)),h.trigger(a.LEFT_PAN_DROP,o)),h.trigger(a.PAN_DROP,o)}},_getTileBinTilesValue:function(b){for(var c=b.find("."+a.TILE_CLASS),d=c.length,e=null,f=null,g=0;d>g;g++)switch(f=$(c[g]).data().type){case"Var":e+=2;break;case"Num":e++}return e},_marqueeDrop:function(b,c,d){this.isOnDroppable=!0;var e=this,f=c.draggable.find("."+a.TILE_CLASS),g=d.data().pos,h=0,i=0,j=Math.abs(e.getVariableCount(g)),k=Math.abs(e.getConstantsCount(g)),l=null,m=d.hasClass("temporary-bin"),n=f.attr("pancontainer"),o=f.hasClass("temporary-dropped"),p=this.$("."+g+"-temporary-bin"),q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=this._getTileBinTilesValue(p),z=null,A=d.find("."+a.TILE_CLASS),B=(p.find("."+a.TILE_CLASS),a.BIN_CAPACITY);if(this.isMarqueeDrop=!0,f.each(function(){l=$(this),z=l.data(),"Var"===z.type?(h++,z.isVarNegative?x++:w++):(i++,z.isVarNegative?v++:u++)}),A.each(function(){l=$(this),z=l.data(),"Var"===z.type?z.isVarNegative?t++:s++:z.isVarNegative?r++:q++}),m&&n!==g||!m&&(i+k>16||h+j>4||n===g&&!o)||m&&o||o&&n!==g||y===B-1&&(x>0&&s>0||t>0&&w>0)||B/2-Math.round(y/2)<Math.min(x,s)||B/2-Math.round(y/2)<Math.min(t,w)||B-y<Math.min(v,q)||B-y<Math.min(r,u)||m&&!o&&y+v+u+2*(x+w)>24)c.draggable.draggable("option","revert",function(a){var b=$(this),c=b.offset(),d=c.left,f=c.top;$({left:d,top:f}).animate(e.marqueeView.getOriginalOffset(),{step:function(a,c){"top"===c.prop?f=a:d=a,b.offset({left:d,top:f})},duration:500})}),e.trigger(a.MARQUEE_DROP,!1);else{this.tilesToNullify=0,c.draggable.draggable("option","revert","invalid");for(var C=f.length,D=0;C-1>D;D++)e._addTileInContainer($(f[D]),d,!1,m,!0);e._addTileInContainer($(f[D]),d,!1,m,!1),e._updateEquationForDynamicPanBalance(),e.marqueeView&&(e.marqueeView.collapseMarquee(),e.marqueeView.breakGroup()),e.trigger(a.MARQUEE_DROP,!0)}},_removeMarqueeOnTileDrag:function(){this.marqueeView&&(this.marqueeView.collapseMarquee(),this.marqueeView.breakGroup())},_getCurrentSelectedDispenserTile:function(a){var b=this.dispenserTiles,c=b.length,d=null;for(d=0;c>d;d++)if(b[d].isSelected===!0)return a?b[d]:b[d].$el;return null},_createHackScreenForLeftDynamicPan:function(a){if(!this.isMarqueeDrop){var b=a.find(".dynamic-wrapper").attr("id");b=b.slice(this.idPrefix.length);var c={elementId:b,tabIndex:this.tabIndex+12,acc:this.getAccMessage("left-dynamic-pan",0)};this.createAccDiv(c)}},enableDisableFocusOnPansAndTempBins:function(a){var b=this.$(".left-tile-container"),c=this.$(".right-tile-container"),d=b.find(".dynamic-wrapper").attr("id").slice(this.idPrefix.length),e=c.find(".dynamic-wrapper").attr("id").slice(this.idPrefix.length),f="-left-temporary-bin",g="-right-temporary-bin";this.enableTab(d,a),this.enableTab(e,a),this.enableTab(f,a),this.enableTab(g,a)},_createHackScreenForRightDynamicPan:function(a){if(!this.isMarqueeDrop){var b=a.find(".dynamic-wrapper").attr("id");b=b.slice(this.idPrefix.length);var c={elementId:b,tabIndex:this.tabIndex+128,acc:this.getAccMessage("right-dynamic-pan",0)};this.createAccDiv(c)}},_createHackScreenForAccessibilityPans:function(a){var b=a.find(".accessibility-dynamic-wrapper").show().attr("id");b=b.slice(this.idPrefix.length);var c={elementId:b,tabIndex:-1,acc:"Acc temp bin"};this.createAccDiv(c),this.enableTab(b,!1),a.find(".accessibility-dynamic-wrapper").hide()},_createHackScreenForAccessibilityTemporaryPans:function(a){var b="-"+a+"-accessibility-temporary-bin",c={elementId:b,tabIndex:-1,acc:"Temp Acc trash can"};this.createAccDiv(c),this.enableTab(b,!1)},createHackScreenForDynamicPans:function(){var a=this,b=this.$(".left-tile-container"),c=this.$(".right-tile-container");a._createHackScreenForLeftDynamicPan(b),a._createHackScreenForRightDynamicPan(c),a._createHackScreenForAccessibilityPans(b),a._createHackScreenForAccessibilityPans(c),a._attachHandlersForAccessibilityHelperPans()},_$currentBin:null,_$tileToNullify:null,_$tilesToNullify:[],_nullifyTileAfterDrop:function(b,c,d){var e=this,f=b.data().pos,g=a.MAX_ROWS,h=c.data().type,i=c.data().isVarNegative,j=Number(c.attr("rowNo")),k=b.find("."+h+"-table"),l=null,m=null,n=null,o=null;switch(h){case"Var":m=k.find("."+a.TILE_CLASS),m.each(function(a,b){var c=$(this),d=c.data().isVarNegative;return i!==d&&c.data().isFading!==!0?(l=c,e.tilesToNullify++,!1):void 0});break;case"Num":var p=!1;for(o=j;g>o;o++){var q=k.find(".row-"+o).children();if(p)break;$(q.get().reverse()).each(function(){var a=$(this),b=a.data().isVarNegative;return i!==b&&a.data().isFading!==!0?(l=a,p=!0,e.tilesToNullify++,!1):void 0})}break;default:return!1}return n="left"===f?this.$(".left-temporary-bin"):this.$(".right-temporary-bin"),e._$currentBin=n,l&&e._$tilesToNullify.push(l.clone(!0)),l&&l.length>0?(c.draggable("option","revert",!0),e.isTemporaryBinFull(e._$currentBin,e._$tilesToNullify[e._$tilesToNullify.length-1])?(e._$tilesToNullify.splice(0,1),c.remove(),a.PAN_FULL):(e._fadeAndRemoveTiles(l,c,function(){e.tilesToNullify--,0===e.tilesToNullify&&e._arrangeTilesInPan(b,3);for(var a=e._$tilesToNullify.length,c=0;a>c;c++)"block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display")&&e._addTileInContainer(e._$tilesToNullify[c],e._$currentBin,!1,!0),e._$tilesToNullify.splice(c,1),a=e._$tilesToNullify.length}),a.TILE_NULLIFIED)):a.TILE_NOT_NULLIFIED},_fadeAndRemoveTiles:function(b,c,d){var e=null,f=1,g=.1;b.data().isFading=!0,c.data().isFading=!0,b.draggable(),b.draggable("option","disable",!0),c.draggable(),c.draggable("option","disable",!0),this.isFading=!0,e=setInterval($.proxy(function(){b.css({opacity:f}),c.css({opacity:f}),0>=f&&(clearInterval(e),this.isFading=!1,b.remove(),c.remove(),this._updateEquationForDynamicPanBalance(),this.animateDynamicPan(),d&&d(),this.trigger(a.TILE_FADEOUT)),f-=g},this),a.FADE_TILES_DURATION)},_renderTemporaryTrashCan:function(){var b=a.MAX_ROWS-1,c=null,d=this.$(".temporary-bin"),e={rowCount:b,colCount:0},f="-left-temporary-bin",g="-right-temporary-bin",h=this;d.css({"background-image":'url("'+this.filePath.getImagePath("temporary-bin")+'")'}),c=this._createTilesContainer(e),d.append(c),this._makeTemporaryTrashCansDroppable(),this._createHackScreenForTemporaryTrashCans("left"),this._createHackScreenForTemporaryTrashCans("right"),this._createHackScreenForAccessibilityTemporaryPans("left"),this._createHackScreenForAccessibilityTemporaryPans("right"),h.$("#"+h.idPrefix+f+"-acc-elem").off("keydown.pan-balance").on("keydown.pan-balance",$.proxy(h._setPanAccTextOnTab,h)),h.$("#"+h.idPrefix+g+"-acc-elem").off("keydown.pan-balance").on("keydown.pan-balance",$.proxy(h._setPanAccTextOnTab,h)),h.focusOut(f,function(){h._setTempBinAccText()}),h.focusOut(g,function(){h._setTempBinAccText()})},_makeTemporaryTrashCansDroppable:function(){var a=this,b=this.$(".temporary-bin"),c={drop:function(b,c){a._onTemporaryBinDrop(b,c,$(this))}};b.droppable(c)},_onTemporaryBinDrop:function(b,c,d,e){if(c.draggable.hasClass("marquee-div"))return void this._marqueeDrop(b,c,d);var f,g,h,i=this,j="temporary-dropped",k=(this.$(".temporary-bin"),null),l=null,m=null,n=null,o=!1,p=null;if(l=c.draggable,p=l.data(),m=d,n=l.attr("pancontainer"),h=i.$("."+n+"-pan-wrapper").find(".dynamic-container"),l.hasClass(j))l.draggable("option","revert",!0);else{if(m.data().pos!==n)return void l.draggable("option","revert",!0);k=i._temporaryBinDropHandler(m,l),k?(l.hasClass("pan-dropped")&&l.remove(),h.find(".dynamic-wrapper #"+l[0].id).remove(),setTimeout(function(){i._arrangeTilesInPan(h.find(".dynamic-wrapper"),Number(l.attr("rowNo")))},1),i._createHackScreenForTemporaryBinTiles(k),i._makeTileDraggableAfterDrop(k),i.animateDynamicPan(),i._makeContextMenuForDraggable(k,k.attr("panContainer"),!0),i._addHoverEffectToNewTileInTemporaryTrashCan(k),l.draggable(),l.draggable("option","revert","invalid"),o=!0):l.draggable("option","revert",!0),o&&!e&&(f=k.data("isVarNegative")?i.getAccMessage("negative",0)+" ":"",g=f+("Var"===k.data("type")?"x":1),i._setTempBinAccText(g,null,k.attr("panContainer")),i.trigger(a.TRASH_DROP,p))}},_createHackScreenForTemporaryTrashCans:function(a){var b="-"+a+"-temporary-bin",c="left"===a?this.tabIndex+242:this.tabIndex+367,d="left"===a?this.getAccMessage("left",0):this.getAccMessage("right",0),e={elementId:b,tabIndex:c,acc:this.getAccMessage("temporary-trash-can",0,[d])};this.createAccDiv(e)},_temporaryBinDropHandler:function(b,c){var d=this,e=a.MAX_ROWS-2,f=null,g=null,h=c.data().isDisabled?c.data().isDisabled:this._getIsDisabled(),i=c.data().value,j=c.data().type,k=c.data().text,l=c.data().isVarNegative,m=this._getDroppedTileId(),n=this.idPrefix+"dropped-tile-"+m,o={type:j,text:k,value:i,isVarNegative:l,isDisabled:h},p=b,q=null,r=null;for("Var"===c.data().type&&(i=2);e>=0;e--)if(f=p.find(".row-"+e),q=d._isRowFull(f,i,j,!0),g=q.isRowFull,!g)return r=d._createDraggableTiles(f,o,n,"",!0),r.addClass(a.TILE_CLASS+" temporary-hover pan-dropped temporary-dropped dropped-in-bin").attr({colNo:q.colNo,rowNo:e,panContainer:b.data().pos}),d._incrementDroppedTileId(),r;0>e&&c.draggable("option","revert",!0)},_addHoverEffectToNewTileInTemporaryTrashCan:function(a){if(a){var b="temporary-hover",c=MathInteractives.Common.Utilities.Models.BrowserCheck;c.isIOS||c.isAndroid?(a.on("touchend",function(){$(this).addClass(b)}),a.on("touchstart",function(a){var c=$(a.target);c.hasClass("pan-balance-draggable-tile-right-shadow")||c.hasClass("pan-balance-draggable-tile-bottom-shadow")||$(this).removeClass(b)})):(a.on("mouseover",function(a){var c=$(a.target);c.hasClass("pan-balance-draggable-tile-right-shadow")||c.hasClass("pan-balance-draggable-tile-bottom-shadow")||$(this).removeClass(b)}),a.on("mouseout",function(){$(this).addClass(b)}))}},_arrangeTilesInTemporaryTrashCans:function(a,b,c,d){var e=this,f=c?c:this._getIsDisabled(),g=b,h=a,i=null,j=null,k=null,l=null;for(l=--g;l>-1;l--){var m=d?d.find(".row-"+l).children():h.find(".row-"+l).children();m.each(function(){j=$(this),i={type:j.data().type,text:j.data().text,value:j.data().value,isVarNegative:j.data().isVarNegative,isDisabled:f},j.remove(),k=e._temporaryBinDropHandler(h,j.data(i)),e._createHackScreenForTemporaryBinTiles(k),e._makeTileDraggableAfterDrop(k),e._makeContextMenuForDraggable(k,k.attr("panContainer"),!0),e._addHoverEffectToNewTileInTemporaryTrashCan(k)})}},_handleTilesPositionInContainer:function(b,c,d){var e=d?d:!1,f=4,g=this,h=a.MAX_ROWS-1,i=null,j=null,k=c.data().isDisabled?c.data().isDisabled:this._getIsDisabled(),l=c.data().value,m=c.data().type,n=c.data().text,o=c.data().isVarNegative,p=this._getDroppedTileId(),q=this.idPrefix+"dropped-tile-"+p,r={type:m,text:n,value:l,isVarNegative:o,isDisabled:k},s=b.find("."+m+"-table"),t=null,u=null;for("Var"===c.data().type&&(l=1,f=1);h>=0;h--)if(i=s.find(".row-"+h),t=g._isRowFull(i,l,m),j=t.isRowFull,!j)return u=g._createDraggableTiles(i,r,q,"",e),u.addClass(a.TILE_CLASS+" pan-dropped").attr({colNo:t.colNo,rowNo:h,panContainer:b.data().pos}),g._incrementDroppedTileId(),u},_doubleClickOnTileHandler:function(b){if(!this._getIsDisabled()){var c=b.data().type,d=b.data().value,e=b.data().text,f=b.data().isVarNegative,g=b.data().isDisabled,h={value:d,type:c,text:e,isVarNegative:f,isDisabled:g};if("Num"===c&&d>1){var i=this,e=b.data().text,j=null,k=null,l={type:c,text:"1",value:1},m=b.attr("panContainer"),n=i.$("."+m+"-pan-wrapper").find(".dynamic-wrapper");for(b.remove(),j=0;d>j;j++){var o=$("<div>");o.data(l),k=i._handleTilesPositionInContainer(n,o),i._makeTileDraggableAfterDrop(k),i._makeContextMenuForDraggable(k,"_doubleClickOnTileHandler")}}this.trigger(a.DOUBLE_CLICK_TILE,h)}},_makeTileDraggableAfterDrop:function(b,c){var d=c?c:!1,e=this,f="temporary-dropped",g=null,h=null;return g={revert:function(){e.$(".ui-draggable-dragging").remove(),e._deleteOnRevertHandler($(this)),e._attachHandlerForClickAndClick()},zIndex:9999,helper:"clone",start:function(b,c){e._removeMarqueeOnTileDrag(),e.trigger(a.TILE_DRAG),$(this).css({visibility:"hidden"}),e._detachHandlerForClickAndClick()},stop:function(a,b){var c=$(this);c.css({visibility:"visible"}),c.draggable(),c.draggable("option","revert",function(){e._deleteOnRevertHandler($(this))}),e._attachHandlerForClickAndClick()},cancel:".var-tile-right-shadow,.num-tile-right-shadow,.var-tile-bottom-shadow,.num-tile-bottom-shadow",containment:e._getContainmentSelector(),appendTo:e._getContainmentSelector()},b.hasClass(f)||(h={greedy:!0,drop:function(b,c){if(c.draggable.hasClass("marquee-div")){var d=$(this),f=d.attr("pancontainer"),g=d.parents(),h=null;return void g.each(function(){$(this).attr("data-pos")===f&&(h=$(this),e._marqueeDrop(null,c,h))})}var i,j=c.draggable,k=j.data(),l=j.attr("panContainer"),h=$(this),m=h.data(),n=h.attr("panContainer"),o=e.$("."+n+"-pan-wrapper").find(".dynamic-container"),p=Number(j.attr("rowno")),q=Number(h.attr("rowno")),r=c.helper,s=null;if(j.hasClass("temporary-dropped")){if(l!==n)return void j.draggable("option","revert",!0);if(k.type===m.type&&m.isVarNegative!==k.isVarNegative){var t=c.draggable.hasClass("pan-dropped")?c.draggable:c.helper;e._$tileToNullify=h.clone(!0),e._$currentBin="right"===n?e.$(".right-temporary-bin"):e.$(".left-temporary-bin"),e.isTemporaryBinFull(e._$currentBin,e._$tileToNullify)?c.draggable.draggable("option","revert",!0):(e._fadeAndRemoveTiles(h,t,function(){e._arrangeTilesInPan(o.find(".dynamic-wrapper"),q),e._arrangeTilesInTemporaryTrashCans(e.$("."+l+"-temporary-bin"),p),e._updateEquationForDynamicPanBalance(),e.animateDynamicPan(),"block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display")&&(e._addTileInContainer(e._$tileToNullify,e._$currentBin,!1,!0),e._$tileToNullify=null),"right"===n?e.trigger(a.RIGHT_PAN_DROP,t.data()):e.trigger(a.LEFT_PAN_DROP,t.data()),e.trigger(a.PAN_DROP,t.data())}),c.draggable.draggable("option","revert",""))}else s=e._handleTilesPositionInContainer(o,j),s?(s.attr("panContainer",n),e._createHackScreenForPanTiles({newTile:s,panPosition:s.attr("panContainer")}),j.remove(),e._arrangeTilesInTemporaryTrashCans(e.$("."+l+"-temporary-bin"),p),s=e._makeTileDraggableAfterDrop(s),e._makeContextMenuForDraggable(s,"_makeTileDraggableAfterDrop"),e._updateEquationForDynamicPanBalance(),e._nullifyTileAfterDrop(o,s),j.draggable(),j.draggable("option","revert","invalid"),e.animateDynamicPan(),"right"===n?e.trigger(a.RIGHT_PAN_DROP,j.data()):e.trigger(a.LEFT_PAN_DROP,j.data()),e.trigger(a.PAN_DROP,j.data())):j.draggable("option","revert",!0)}else if(j.hasClass("pan-dropped")){if(l===n)return void j.draggable("option","revert",!0);if(k.type===m.type&&m.isVarNegative!==k.isVarNegative){var t=c.draggable.hasClass("pan-dropped")?c.draggable:c.helper;e._$tileToNullify=h.clone(!0),e._$currentBin="right"===n?e.$(".right-temporary-bin"):e.$(".left-temporary-bin"),c.draggable.draggable("option","revert",!1),e.isTemporaryBinFull(e._$currentBin,e._$tileToNullify)?c.draggable.draggable("option","revert",!0):(e._fadeAndRemoveTiles(h,t,function(){e._arrangeTilesInPan(o.find(".dynamic-wrapper"),q),e._arrangeTilesInPan(e.$("."+l+"-pan-wrapper").find(".dynamic-wrapper"),p),e._updateEquationForDynamicPanBalance(),e.animateDynamicPan(),"block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display")&&(e._addTileInContainer(e._$tileToNullify,e._$currentBin,!1,!0),e._$tileToNullify=null),"right"===n?e.trigger(a.RIGHT_PAN_DROP,t.data()):e.trigger(a.LEFT_PAN_DROP,t.data()),e.trigger(a.PAN_DROP,t.data())}),c.draggable.draggable("option","revert",!1))}else{if(s=e._handleTilesPositionInContainer(o,j),!s)return void j.draggable("option","revert",!0);s.attr("panContainer",n),e._createHackScreenForPanTiles({newTile:s,panPosition:s.attr("panContainer")}),j.remove(),e._arrangeTilesInPan(e.$("."+l+"-pan-wrapper").find(".dynamic-wrapper"),p),s=e._makeTileDraggableAfterDrop(s),e._makeContextMenuForDraggable(s,"_makeTileDraggableAfterDrop"),e._updateEquationForDynamicPanBalance(),i=e._nullifyTileAfterDrop(o,s),j.draggable(),j.draggable("option","revert","invalid"),e.animateDynamicPan(),"right"===n?e.trigger(a.RIGHT_PAN_DROP,j.data()):e.trigger(a.LEFT_PAN_DROP,j.data()),e.trigger(a.PAN_DROP,j.data())}}else if(k.type===m.type&&m.isVarNegative!==k.isVarNegative){var t=c.draggable.hasClass("pan-dropped")?c.draggable:c.helper;c.draggable.draggable("option","revert",!1),e._$tileToNullify=h.clone(!0),e._$currentBin="right"===n?e.$(".right-temporary-bin"):e.$(".left-temporary-bin"),e.isTemporaryBinFull(e._$currentBin,e._$tileToNullify)?c.draggable.draggable("option","revert",!0):e._fadeAndRemoveTiles(h,t,function(){e._arrangeTilesInPan(o.find(".dynamic-wrapper"),p>q?p:q),e._updateEquationForDynamicPanBalance(),e.animateDynamicPan(),"block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display")&&(e._addTileInContainer(e._$tileToNullify,e._$currentBin,!1,!0),e._$tileToNullify=null),"right"===n?e.trigger(a.RIGHT_PAN_DROP,t.data()):e.trigger(a.LEFT_PAN_DROP,t.data()),e.trigger(a.PAN_DROP,t.data())})}else s=e._handleTilesPositionInContainer(o,j),s?(s.attr("panContainer",n),e._createHackScreenForPanTiles({newTile:s,panPosition:s.attr("panContainer")}),s=e._makeTileDraggableAfterDrop(s),e._makeContextMenuForDraggable(s,"_makeTileDraggableAfterDrop"),e._updateEquationForDynamicPanBalance(),i=e._nullifyTileAfterDrop(o,s),i===a.PAN_FULL&&(s.remove(),j.draggable("option","revert",!0),r.hasClass("pan-dropped")&&j.remove()),e.animateDynamicPan(),"right"===n?e.trigger(a.RIGHT_PAN_DROP,j.data()):e.trigger(a.LEFT_PAN_DROP,j.data()),e.trigger(a.PAN_DROP,j.data())):j.draggable("option","revert",!0)}},b.droppable(h)),b.draggable(g),b.off("click").on("click",$.proxy(e._tileClickHandler,e,b)),b.off("touchmove.forStopPropogation").on("touchmove.forStopPropogation",function(a){a.stopPropagation()}),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$("."+a.TILE_CLASS),{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE|MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.STOP_PROPAGATION}),d&&b.draggable("disable"),b},isTemporaryBinFull:function(b,c){for(var d,e,f,g=a.MAX_ROWS-2,h=this,i=c.data().value,j=c.data().type;g>=0;g--)if(e=b.find(".row-"+g),i="Var"===j?2:1,f=h._isRowFull(e,i,j,!0),d=f.isRowFull,!d)return d;return!0},_tileClickHandler:function(a,b){var c,d,e,f,g,h=this,i=h._getTileContainer(a),j=i.attr("data-pos");this._removeMarqueeOnTileDrag(),this.trigger("tile_click"),c=a.data("isVarNegative")?h.getAccMessage("negative",0)+" ":"",d=c+("Var"===a.data("type")?"x":"1"),h.currentDroppedTileSelected=a,i.hasClass("temporary-bin")?"left"===j?(this.$("#"+this.idPrefix+"-left-accessibility-dynamic-wrapper").show(),f=$(a).find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),g=this.getTabIndex(f),h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null,g),h._setAccTextForAccDynamicWrapper("left",d),this.focusIn("-left-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null,g),h.player._refreshDOM()}),this.focusOut("-left-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null)}),this.setFocus("-left-accessibility-dynamic-wrapper")):(this.$("#"+this.idPrefix+"-right-accessibility-dynamic-wrapper").show(),f=$(a).find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),g=this.getTabIndex(f),h._setAccTextForAccDynamicWrapper("right",d),h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null,g),this.focusIn("-right-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null,g),h.player._refreshDOM()}),this.focusOut("-right-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null)}),this.setFocus("-right-accessibility-dynamic-wrapper")):(e=h.getAccMessage(j,0),"left"===j?(this.$("#"+this.idPrefix+"-right-accessibility-dynamic-wrapper").show(),f=$(a).find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),g=this.getTabIndex(f),"block"===this.$("#"+this.idPrefix+"-left-temporary-bin").css("display")?(this.$("#"+this.idPrefix+"-left-accessibility-temporary-bin").show(),h.setAccMessage("-left-accessibility-temporary-bin",h.getAccMessage("temporary-trash-can",2,[d,e])),h._setAccTextForAccDynamicWrapper("right",d),h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin",g),this.focusIn("-right-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin",g),h.player._refreshDOM()}),this.focusOut("-right-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin")}),this.focusIn("-left-accessibility-temporary-bin",function(){h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin",g),
h.player._refreshDOM()}),this.focusOut("-left-accessibility-temporary-bin",function(){h._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin")})):(h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null,g),h._setAccTextForAccDynamicWrapper("right",d),this.focusIn("-right-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null,g),h.player._refreshDOM()}),this.focusOut("-right-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null)})),this.setFocus("-right-accessibility-dynamic-wrapper")):(this.$("#"+this.idPrefix+"-left-accessibility-dynamic-wrapper").show(),f=$(a).find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),g=this.getTabIndex(f),"block"===this.$("#"+this.idPrefix+"-right-temporary-bin").css("display")?(this.$("#"+this.idPrefix+"-right-accessibility-temporary-bin").show(),h.setAccMessage("-right-accessibility-temporary-bin",h.getAccMessage("temporary-trash-can",2,[d,e])),h._setAccTextForAccDynamicWrapper("left",d),h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin",g),this.focusIn("-left-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin",g),h.player._refreshDOM()}),this.focusOut("-left-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin")}),this.focusIn("-right-accessibility-temporary-bin",function(){h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin",g),h.player._refreshDOM()}),this.focusOut("-right-accessibility-temporary-bin",function(){h._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin")})):(h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null,g),h._setAccTextForAccDynamicWrapper("left",d),this.focusIn("-left-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null,g),h.player._refreshDOM()}),this.focusOut("-left-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null)})),this.setFocus("-left-accessibility-dynamic-wrapper")))},_setAccTextForAccDynamicWrapper:function(a,b){var c,d=this;switch(a){case"left":0===d.getPanWeight("left")?d.setAccMessage("-left-accessibility-dynamic-wrapper",d.getAccMessage("left-dynamic-pan",1),[b]):(c=d._getAccTextForEquation("left"),d.setAccMessage("-left-accessibility-dynamic-wrapper",d.getAccMessage("left-dynamic-pan",3),[c,b]));break;case"right":0===d.getPanWeight("right")?d.setAccMessage("-right-accessibility-dynamic-wrapper",d.getAccMessage("right-dynamic-pan",1),[b]):(c=d._getAccTextForEquation("right"),d.setAccMessage("-right-accessibility-dynamic-wrapper",d.getAccMessage("right-dynamic-pan",3),[c,b]))}},_setTabIndexToTempAccessibilityDivs:function(a,b,c){a&&this.setTabIndex(a,c+1),b&&this.setTabIndex(b,c+2)},_disableTempAccessibilityDivs:function(a,b){a&&this.enableTab(a,!1),b&&this.enableTab(b,!1)},hideTempAccessibilityDivs:function(){this.$("#"+this.idPrefix+"-left-accessibility-dynamic-wrapper").hide(),this.$("#"+this.idPrefix+"-right-accessibility-dynamic-wrapper").hide(),this.$("#"+this.idPrefix+"-left-accessibility-temporary-bin").hide(),this.$("#"+this.idPrefix+"-right-accessibility-temporary-bin").hide()},_enableDisablePanDroppedTiles:function(a,b){var c=this,d=c.idPrefix+"-"+a+"-dynamic-wrapper";c.$("#"+d).find(".pan-balance-draggable-tile-text-container").each(function(){var a=$(this).attr("id").slice(c.idPrefix.length);a&&c.enableTab(a,b)})},_enableDisableTemporaryBinDroppedTiles:function(a,b){var c=this,d=c.idPrefix+"-"+a+"-temporary-bin";c.$("#"+d).find(".pan-balance-draggable-tile-text-container").each(function(){var a=$(this).attr("id").slice(c.idPrefix.length);a&&c.enableTab(a,b)})},_handleMarqueeShowHide:function(a){var b=this;a.on("mousedown",function(a){a.stopPropagation(),b._removeMarqueeOnTileDrag(),b.trigger("tile_click")})},_deleteOnRevertHandler:function(b){if(b&&0!==$("#"+b[0].id).length){var c=b.attr("panContainer"),d=Number(b.attr("rowno")),e=this.$("."+c+"-pan-wrapper").find(".dynamic-container"),f=b.data(),g=f.value,h=f.type,i=f.text,j=f.isVarNegative,k=f.isDisabled,l={value:g?g:1,type:h?h:"Num",text:i?i:"2",isVarNegative:j?j:!1,isDisabled:k?k:!1},m=!1;b.remove();var n=this;n.marqueeMoveOut||(m=!0),m&&!n.marqueeMoveOut&&(setTimeout(function(){n._arrangeTilesInPan(e.find(".dynamic-wrapper"),d)},1),b.hasClass("temporary-dropped")&&setTimeout(function(){n._arrangeTilesInTemporaryTrashCans(n.$("."+c+"-temporary-bin"),d)},1),this._updateEquationForDynamicPanBalance(),this.animateDynamicPan(),this.trigger(a.TRASH_DROP,l))}},_isRowFull:function(b,c,d,e){var f=e?8:4,g=0,h=!1,i=b.find("."+a.TILE_CLASS),j=null;return e||"Var"===d&&(f=1),i.each(function(){j=$(this);var a=Math.abs(j.data().value);"Var"===j.data().type&&(a=e?2:1),j.hasClass("ui-draggable-dragging")||(g+=a)}),g+=Math.abs(c),g>f&&(h=!0),{isRowFull:h,colNo:g}},_incrementDroppedTileId:function(){this.droppedTileId++},_getDroppedTileId:function(){return this.droppedTileId},_incrementStaticTileId:function(){this.staticTileId++},_getStaticTileId:function(){return this.staticTileId},_toggleDisableTiles:function(a,b,c){if("undefined"!=typeof a){var d=c?c:!1,e=this,f=b?b:this._getIsDisabled(),g=a,h=a.leftPan?a.leftPan:[],i=h.length,j=a.rightPan?a.rightPan:[],k=j.length,l=a.leftTemporaryBin?a.leftTemporaryBin:[],m=l.length,n=a.rightTemporaryBin?a.rightTemporaryBin:[],o=n.length,p=null,q=null,r=this.$(".left-pan-wrapper").find(".dynamic-container"),s=this.$(".right-pan-wrapper").find(".dynamic-container"),t=this.$(".left-temporary-bin"),u=this.$(".right-temporary-bin");for(this.panTabIndexes=$.extend(!0,{},this.model.getPanTilesTabIndexes()),p=0;i>p;p++){var v=$("<div>");h[p].isDisabled=f,v.data(h[p]),q=e._handleTilesPositionInContainer(r,v,d),q.attr("panContainer","left"),f||e._createHackScreenForPanTiles({newTile:q,panPosition:q.attr("panContainer")}),q=e._makeTileDraggableAfterDrop(q,f),e._makeContextMenuForDraggable(q,q.attr("panContainer"),!0)}for(p=0;k>p;p++){var v=$("<div>");j[p].isDisabled=f,v.data(j[p]),q=e._handleTilesPositionInContainer(s,v,d),q.attr("panContainer","right"),f||e._createHackScreenForPanTiles({newTile:q,panPosition:q.attr("panContainer")}),q=e._makeTileDraggableAfterDrop(q,f),e._makeContextMenuForDraggable(q,q.attr("panContainer"),!0)}for(e._setPanAccText(),p=0;m>p;p++){var v=$("<div>");l[p].isDisabled=f,v.data(l[p]),q=e._temporaryBinDropHandler(t,v),e._makeTileDraggableAfterDrop(q,f),e._makeContextMenuForDraggable(q,"_toggleDisableTiles leftTemporaryBinDataArrayLength"),f||(e._addHoverEffectToNewTileInTemporaryTrashCan(q),e._createHackScreenForTemporaryBinTiles(q)),q.attr("panContainer","left")}for(p=0;o>p;p++){var v=$("<div>");n[p].isDisabled=f,v.data(n[p]),q=e._temporaryBinDropHandler(u,v),e._makeTileDraggableAfterDrop(q,f),e._makeContextMenuForDraggable(q,"_toggleDisableTiles rightTemporaryBinDataArrayLength"),f||(e._addHoverEffectToNewTileInTemporaryTrashCan(q),e._createHackScreenForTemporaryBinTiles(q)),q.attr("panContainer","right")}g.position?e.animatePanBalance(g.position):e.animateDynamicPan()}},_renderDefaultTiles:function(a){var b=null;b="undefined"==typeof a.isDisabled?this._getIsDisabled():a.isDisabled;var c=this;c.clearPans(),c._toggleDisableTiles(a,b,!0)},_activateTrashCan:function(a){var b=this;$("#"+a).off("drop").on("drop",function(a,c){b._onDropInTrashCan(a,c)})},_throwAwayTile:function(a){var b,c={draggable:a,helper:a},d=a.data("isVarNegative")?this.getAccMessage("negative",0)+" ":"",e=d+("Var"===a.data("type")?"x":"1");this._onDropInTrashCan(null,c),a.hasClass("dropped-in-bin")?(this._setTempBinAccText(null,e,a.attr("pancontainer")),b="left"===a.attr("pancontainer")?"-left-temporary-bin":"-right-temporary-bin",this.setFocus(b)):(this._setPanAccText(null,e,a.attr("pancontainer")),b="left"===a.attr("pancontainer")?"-left-dynamic-wrapper":"-right-dynamic-wrapper",this.setFocus(b))},_onDropInTrashCan:function(b,c){var d=this;if(c.draggable.hasClass("pan-dropped")){c.helper.hasClass("pan-dropped")&&c.draggable.remove();var e=c.draggable.data(),f={value:e.value,type:e.type,text:e.text,isVarNegative:e.isVarNegative},g=c.helper.remove(),h=d.$("."+g.attr("panContainer")+"-pan-wrapper").find(".dynamic-wrapper"),i=Number(g.attr("rowNo"));if(d.animateDynamicPan(),d._arrangeTilesInPan(h,i),c.draggable.hasClass("temporary-dropped")){var j=d.$("."+c.draggable.attr("panContainer")+"-temporary-bin"),k=Number(c.draggable.attr("rowNo"));d._arrangeTilesInTemporaryTrashCans(j,k)}d.trigger(a.TRASH_DROP,f)}},_getEquation:function(b,c){if("undefined"!=typeof b){var d=c?c:!1,e=a.VARIABLE_LABEL,f=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),g=f.find("."+a.TILE_CLASS),h=[],i=null,j=0,k=0,l=null,m=null,n=null,o="",p=!0;if(g.each(function(){l=$(this),l.hasClass("ui-draggable-dragging")||(m=l.data(),n={value:m.value,type:m.type,text:m.text,isVarNegative:m.isVarNegative},"Num"===n.type&&(m.isVarNegative&&(n.value=-1*n.value),h.push(n.value)))}),i=$(h),i.each(function(a,b){j+=b}),0>j&&(p=!1),k=this.getVariableCount(b),d){var q={constant:j,variable:k};return q}return 0===k?o=j.toString():0===j?(1===k?k="":-1===k&&(k="-"),o=k+'<span class="italic">'+e+"</span>"):(1===k?k="":-1===k&&(k="-"),o=p?k+'<span class="italic">'+e+"</span> + "+j:k+'<span class="italic">'+e+"</span> - "+Math.abs(j)),o}},_getContainmentSelector:function(){var a=this.containmentID;return"string"==typeof a?a="#"+a:"object"==typeof a&&(a=a),a},_arrangeTilesInPan:function(a,b,c,d){var e=this,f=c?c:this._getIsDisabled(),g=b,h=a,i=null,j=null,k=null,l=null,m=h.attr("data-pos");for(l=--g;l>-1;l--){var n=d?d.find(".row-"+l).children():h.find(".row-"+l).children();n.each(function(){j=$(this),i={type:j.data().type,text:j.data().text,value:j.data().value,isVarNegative:j.data().isVarNegative,isDisabled:f},j.remove(),k=e._handleTilesPositionInContainer(h,j.data(i)),e._createHackScreenForPanTiles({newTile:k,panPosition:k.attr("panContainer")}),e._makeTileDraggableAfterDrop(k);var a="block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display");e._makeContextMenuForDraggable(k,k.attr("panContainer"),a)})}var o=e._getCurrentSelectedDispenserTile();null===o&&e._reassignTabIndexesToPanTiles(0,m)},_getTileDataForPan:function(b){var c=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),d=c.find(".pan-row"),e=[],f=null,g=null,h=null,i=null;return $(d.get().reverse()).each(function(){g=$(this).find("."+a.TILE_CLASS),g.each(function(){f=$(this),f.hasClass("ui-draggable-dragging")||(h=f.data(),"Var"===h.type&&(h.text=$(h.text).html()?$(h.text).html():h.text),i={type:h.type,text:h.text.toString().replace(a.NEGATIVE_TILE_INDICATOR,""),value:h.value,isVarNegative:h.isVarNegative,isDisabled:h.isDisabled},e.push(i))})}),e},_getTileDataForTemporaryBin:function(b){var c=this.$(".temporary-bins-container").find("."+b+"-temporary-bin"),d=c.find(".pan-row"),e=[],f=null,g=null,h=null,i=null;return $(d.get().reverse()).each(function(){g=$(this).find("."+a.TILE_CLASS),g.each(function(){f=$(this),f.hasClass("ui-draggable-dragging")||(h=f.data(),"Var"===h.type&&(h.text=$(h.text).html()?$(h.text).html():h.text),i={type:h.type,text:h.text.toString().replace(a.NEGATIVE_TILE_INDICATOR,""),value:h.value,isVarNegative:h.isVarNegative,isDisabled:h.isDisabled},e.push(i))})}),e},_setIsDisabled:function(a){a?this.isPanDisabled=a:this.isPanDisabled=!1},_getIsDisabled:function(){return this.isPanDisabled},_getSpecificTypeTileCount:function(a,b,c){if("undefined"!=typeof b&&"undefined"!=typeof a){var d=this.getSaveState(),e=d[a+"Pan"],f=e.length,g=null,h=null,i=0,j=!1,k=c?c:!1;for(g=0;f>g;g++)h=e[g],k||(j=h.isVarNegative?h.isVarNegative:!1),h.type===b&&(j?i--:i++);return i}},_updateEquationForDynamicPanBalance:function(a){var b=null,c=null;"undefined"==typeof a?(b=this.$(".left-pan-wrapper").find(".pan-label"),c=this._getEquation("left"),b.html(c),b=this.$(".right-pan-wrapper").find(".pan-label"),c=this._getEquation("right"),b.html(c)):(b=this.$("."+a+"-pan-wrapper").find(".pan-label"),c=this._getEquation(a),b.html(c))},_setDraggableVariableValue:function(a){a&&(this.draggableVariableValue=a)},_getDraggableVariableValue:function(){return this.draggableVariableValue},_generateMarquee:function(){if(this.player){var b=MathInteractives.global.Marquee.createMarquee({idPrefix:this.idPrefix,manager:this.manager,filePath:this.filePath,player:this.player,marqueeContainer:this.marqueeContainer,selectorClass:a.TILE_CLASS,ignoreClass:"dispenser-tile"});return b.on(MathInteractives.global.Marquee.EVENTS.resize,$.proxy(this._marqueeResizeHandler,this)),b.on(MathInteractives.global.Marquee.EVENTS.start,$.proxy(this._marqueeStartHandler,this)),b.on(MathInteractives.global.Marquee.EVENTS.end,$.proxy(function(){setTimeout($.proxy(this._attachHandlerForClickAndClick,this),1)},this)),b.on(MathInteractives.global.Marquee.EVENTS.move,$.proxy(function(){this._detachHandlerForClickAndClick()},this)),b}},_marqueeResizeHandler:function(b){this.trigger(a.MARQUEE_RESIZE,b)},_marqueeStartHandler:function(b){var c=b.originalEvent,d={x:c.pageX,y:c.pageY};this.marqueeDragStartPoint=d,this.trigger(a.MARQUEE_START,b)},_getTileContainer:function(a){var b=null,c=null;return b=a.parents(".temporary-bin"),b.length?b:c=a.parents(".dynamic-wrapper")},getCurrentSelectedDispenserTileView:function(){return this._getCurrentSelectedDispenserTile(!0)},setDispenserTileSelected:function(a){return null===a.tileType?void(this.currentSelectedDispenserTile&&this.currentSelectedDispenserTile.removeBorder()):void this.$(".dispenser-wrapper").find(".dispenser-tile").each(function(){var b=$(this).data().type,c=$(this).data().isVarNegative;b===a.tileType&&c===a.isVarNegative&&$(this).trigger("click")})},highlightTiles:function(b,c,d,e){var f=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),g=f.find("."+c+"-table"),h=g.find("."+a.TILE_CLASS),i=null,d=d,j=h.length,k=!0;h[0]&&(k=$(h[0]).data().isVarNegative?!1:!0),h.each(function(a){i=$(this),a===j-1?e?(MathInteractives.Common.Components.Views.PanBalanceDraggableTile.showHighlightedPulse(i,k),d()):MathInteractives.Common.Components.Views.PanBalanceDraggableTile.showPulse(i,k,d):e?MathInteractives.Common.Components.Views.PanBalanceDraggableTile.showHighlightedPulse(i,k):MathInteractives.Common.Components.Views.PanBalanceDraggableTile.showPulse(i,k)})},hideHighlightOfTiles:function(b,c){var d=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),e=d.find("."+c+"-table"),f=e.find("."+a.TILE_CLASS),g=null;f.each(function(){g=$(this),MathInteractives.Common.Components.Views.PanBalanceDraggableTile.hidePulse(g)})},customFitMarqueeToBounds:function(a,b){return this.marqueeView?this.marqueeView.customFitMarqueeToBounds(a,b):void 0},setDraggableVariableValue:function(a){this._setDraggableVariableValue(a)},renderDefaultTiles:function(a){a&&this._renderDefaultTiles(a)},_skipAnimation:!1,disableDraggable:function(){var a=this;this.$(".ui-draggable").draggable("disable"),this._setIsDisabled(!0);var b=this.getSaveState();this._skipAnimation=!0,this._renderDefaultTiles(b),this._updateEquationForDynamicPanBalance(),this._skipAnimation=!1;var c=this.dispenserTiles.length;this.currentSelectedDispenserTile&&this.currentSelectedDispenserTile.removeBorder(),this.$(".dispenser-wrapper").find(".pan-balance-draggable-tile-text-container").each(function(){var b=$(this).attr("id").slice(a.idPrefix.length);a.enableTab(b,!1)});var d=this.$(".dispenser-container"),e=d.attr("id").slice(this.idPrefix.length);this.enableTab(e,!1),this.enableDisableFocusOnPansAndTempBins(!1);for(var f=0;c>f;f++)this.dispenserTiles[f].disableTile()},enableDraggable:function(){var a=this;this.$(".ui-draggable").draggable("enable"),this._setIsDisabled(!1);var b=this.getSaveState();this._renderDefaultTiles(b),this._updateEquationForDynamicPanBalance();var c=this.dispenserTiles.length;this.$(".dispenser-wrapper").find(".pan-balance-draggable-tile-text-container").each(function(){var b=$(this).attr("id").slice(a.idPrefix.length);a.enableTab(b,!0)});var d=this.$(".dispenser-container"),e=d.attr("id").slice(this.idPrefix.length);this.enableTab(e,!0),this.enableDisableFocusOnPansAndTempBins(!0);for(var f=0;c>f;f++)this.dispenserTiles[f].enableTile()},showPanLabel:function(a,b){if("undefined"!=typeof a){var c=this.$("."+a+"-pan-wrapper").find(".pan-label"),d=null;d="undefined"==typeof b?this._getEquation(a):b,c.show().html(d)}},hidePanLabel:function(){this.$(".pan-label").hide()},showDispenser:function(){this.$(".dispenser-container").css({top:"-120px"}).show()},hideDispenser:function(){this.$(".dispenser-container").hide()},animateDispenser:function(a,b){this.$(".dispenser-container").show().animate({top:"-45px"},{duration:"number"==typeof b?b:500,complete:function(){"function"==typeof a&&a()}})},showTemporaryTrashCans:function(){var a=this.$(".temporary-bin");a.fadeIn(),this._updateContextMenus(!0)},hideTemporaryTrashCans:function(){var a=this.$(".temporary-bin");a.hide(),this._updateContextMenus(!1)},_updateContextMenus:function(a){var b,c,d,e=this.$(".pan-dropped"),f=(e.length,this.idPrefix+"pan-balance-context-menu-"),g=[],h=[];for(b=0;5>b;b++)g.push(f+b);for(b=0;b<e.length;b++)c=$(e[b]),-1!==c[0].id.search(this.idPrefix)&&(d=c.data("contextMenu"),d.editContextMenu(g,!1),h=this._getIgnoreOptionsForTile(c,c.attr("pancontainer"),a),d.editContextMenu(h,!0))},_getIgnoreOptionsForTile:function(a,b,c){var d=this.idPrefix+"pan-balance-context-menu",e=[];switch(b){case"dispenser":e=[d+"-2",d+"-3",d+"-4"];break;case"left":e=[d+"-0",d+"-3",d+"-4"],c&&(e=[d+"-0",d+"-4"],a.hasClass("temporary-dropped")&&(e=[d+"-1",d+"-3",d+"-4"]));break;case"right":e=[d+"-1",d+"-3",d+"-4"],c&&(e=[d+"-1",d+"-3"],a.hasClass("temporary-dropped")&&(e=[d+"-0",d+"-3",d+"-4"]))}return e},isPanEmpty:function b(c){var d=this.$("."+c+"-pan-wrapper").find(".dynamic-container"),e=d.find("."+a.TILE_CLASS),b=!1;return 0===e.length&&(b=!0),b},getPanWeight:function(b){var c=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),d=c.find("."+a.TILE_CLASS),e=0,f=null,g=null;return d.each(function(){f=$(this);var a=1;f.data().isVarNegative&&(a=-1),f.hasClass("ui-draggable-dragging")||(g=f.data().value,e+=g*a)}),e},getTileCountInPan:function(b){var c=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),d=c.find("."+a.TILE_CLASS);return d.length},getTileCountInTempBin:function(b){var c=this.$("."+b+"-temporary-bin"),d=c.find("."+a.TILE_CLASS);return d.length},_setTempBinAccText:function(a,b,c){var d=this,e="",f=null,g=null,h=null,i=d.getAccMessage("left",0),j=d.getAccMessage("right",0),k=d.getTileCountInTempBin("left"),l=d.getTileCountInTempBin("right");h=this._getCurrentSelectedDispenserTile(),h?(f=d.getAccMessage("temporary-trash-can",1,[i]),g=d.getAccMessage("temporary-trash-can",1,[j])):(f=k&&!b||b&&k>1?d.getAccMessage("temporary-trash-can",3,[i]):d.getAccMessage("temporary-trash-can",0,[i]),g=l&&!b||b&&l>1?d.getAccMessage("temporary-trash-can",3,[j]):d.getAccMessage("temporary-trash-can",0,[j])),b&&(e=d.getAccMessage("tile-delete-text",1,[b])),a&&(e=d.getAccMessage("temporary-trash-can",4,[a])),f=e+f,g=e+g,"left"===c?d.setAccMessage("-left-temporary-bin",f):"right"===c?d.setAccMessage("-right-temporary-bin",g):(d.setAccMessage("-left-temporary-bin",f),d.setAccMessage("-right-temporary-bin",g))},animateDynamicPan:function(){var a="LEFT",b=this.getPanWeight("left"),c=this.getPanWeight("right");c>b&&(a="RIGHT"),b===c&&(a="CENTER"),this.animatePanBalance(a)},clearPans:function(){this.$(".dynamic-wrapper").find("."+a.TILE_CLASS).remove(),this.$(".temporary-bins-container").find("."+a.TILE_CLASS).remove(),this._updateEquationForDynamicPanBalance(),this._setPanAccText(),this.animateDynamicPan()},getVariableCount:function(a){return this._getSpecificTypeTileCount(a,"Var")},getAbsoluteVariableCount:function(a){return this._getSpecificTypeTileCount(a,"Var",!0)},getConstantsCount:function(a){return this._getSpecificTypeTileCount(a,"Num")},getEquationCoefficients:function(a){return this._getEquation(a,!0)},modifyDispenser:function(b){var c=this.$(".dispenser-container").find("."+a.TILE_CLASS);c.remove(),this.renderDispenser(b)},getSaveState:function(){var a=this,b=null;return b={leftPan:a._getTileDataForPan("left"),rightPan:a._getTileDataForPan("right"),leftTemporaryBin:a._getTileDataForTemporaryBin("left"),rightTemporaryBin:a._getTileDataForTemporaryBin("right"),isDisabled:a._getIsDisabled()}},highlightTile:function(){},getEquationToModel:function(){return this.model.get("equationToModel")},setEquationToModel:function(a){this.model.set("equationToModel",a)},marqueeMovedOut:function(a){var b=a.length;this.marqueeMoveOut=!0;for(var c=0;b-1>c;c++)this._deleteOnRevertHandler(a[c]);this.marqueeMoveOut=!1,this._deleteOnRevertHandler(a[c]),this._removeMarqueeOnTileDrag()}},{LEFT_PAN_DROP:"left_pan_drop",RIGHT_PAN_DROP:"right_pan_drop",PAN_DROP:"pan_drop",TRASH_DROP:"trash_drop",DOUBLE_CLICK_TILE:"double_click_tile",TILE_DRAG:"tile_drag",TILE_FADEOUT:"tile_fadeout",MARQUEE_RESIZE:"pan_marquee_resize",MARQUEE_START:"pan_marquee_start",MARQUEE_DROP:"pan_marquee_drop",PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER:"pan-balance-draggable-tile-text-container",PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_LEFT_PART:"pan-balance-draggable-tile-text-container-left-part",PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART:"pan-balance-draggable-tile-text-container-middle-part",PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_RIGHT_PART:"pan-balance-draggable-tile-text-container-right-part",PAN_BALANCE_DRAGGABLE_TILE_TEXT:"pan-balance-draggable-tile-text",PAN_BALANCE_DRAGGABLE_TILE_DOTS:"pan-balance-draggable-tile-dots",PAN_BALANCE_DRAGGABLE_TILE_LEFT_SHADOW:"pan-balance-draggable-tile-left-shadow",PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW:"pan-balance-draggable-tile-right-shadow",PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW:"pan-balance-draggable-tile-bottom-shadow",TILE_CLASS:"pan-draggable-dispenser-tile",RED_TILE:"red-tile",GREEN_TILE:"green-tile",DISPENSER_TILE_CLICKED:"dispenser-tile-clicked",NEGATIVE_TILE_INDICATOR:"-",VARIABLE_LABEL:"x",CONSTANT_PADDING_VALUE:4,TILE_TYPE:{VAR:"Var",NUM:"Num"},MAX_ROWS:4,MAX_COLS:5,MAX_VARIABLE:4,MAX_CONSTANT:4,TILE_NOT_NULLIFIED:0,PAN_FULL:1,TILE_NULLIFIED:2,FADE_TILES_DURATION:17,BIN_CAPACITY:24,createPanBalance:function(a){var b;if(a){b="#"+a.containerId;var c=new MathInteractives.Common.Components.Models.PanBalanceStructured(a),d=new MathInteractives.Common.Components.Views.PanBalanceStructured({el:b,model:c});return d}},Position:{LEFT:0,CENTRE:1,RIGHT:2}}),MathInteractives.global.PanBalanceStructured=MathInteractives.Common.Components.Views.PanBalanceStructured,a=MathInteractives.Common.Components.Views.PanBalanceStructured}(),function(a){var b=null;a.Common.Components.Models.DragSelect=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:function(){return{idPrefix:null,manager:null,filePath:null,player:null,marqueeContainer:null,selectorClass:null,ignoreClass:null,tolerance:.5,zIndex:10,marqueeDefaultOffset:{top:0,left:0},itemsDefaultOffset:{top:0,left:0},isForCanvas:!1,paperObjects:[],padding:5}}},{MARQUEE_STYLE_DRAGGING:{outline:"rgb(141, 141, 141) dashed 1px","background-color":"rgba(206, 206, 206, 0.4)"},MARQUEE_STYLE_AFTER_RELEASE:{outline:"rgb(141, 141, 141) dashed 1px","background-color":"rgb(206, 206, 206)"}}),b=a.Common.Components.Models.DragSelect}(MathInteractives),function(a){"use strict";var b=null;a.Common.Components.Views.DragSelect=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,$marqueeContainer:null,namespace:null,$marqueeDiv:null,_marqueeOriginalPosition:null,initialize:function(){var a=this.model,b=a.get("marqueeContainer"),c=null;this.idPrefix=a.get("idPrefix"),this.manager=a.get("manager"),this.filePath=a.get("filePath"),c="string"==typeof b?this.$(b):b,this.marqueeContainerSelector=""===c[0].id?Math.random().toPrecision(1):c[0].id,this.namespace=this.idPrefix+this.marqueeContainerSelector,this.$marqueeContainer=c,this.$marqueeDiv=this.createMarqueeDiv(),this._attachListenersOnMarqueeContainment()},createMarqueeDiv:function(){var b=this.namespace,c=this.$marqueeContainer,d=this.model.get("zIndex"),e=$("<div>",{"class":b+"marquee-div marquee-div"});return e.css({position:"absolute","z-index":d}),e.css(a.Common.Components.Models.DragSelect.MARQUEE_STYLE_DRAGGING),c.append(e),e},_attachListenersOnMarqueeContainment:function(){var a=this,b=MathInteractives.Common.Utilities.Models.Utils,c=this.namespace,d=this.$marqueeDiv,e=this.$marqueeContainer;MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;e.off("mousedown."+c).on("mousedown."+c,function(b){a.marqueeMouseDownHandler(b)}),d.off("mousedown."+c).on("mousedown."+c,function(b){a.marqueeMouseDownHandler(b)}),e.off("mouseup."+c).on("mouseup."+c,function(b){var c;c=a.model.get("isForCanvas")?a.marqueeCanvasMouseUpHandler(b,!0):a.marqueeMouseUpHandler(b,!0,!1)}),d.off("mouseup."+c).on("mouseup."+c,function(b){var c;c=a.model.get("isForCanvas")?a.marqueeCanvasMouseUpHandler(b,!0):a.marqueeMouseUpHandler(b,!0,!1)}),b.EnableTouch(d,{specificEvents:b.SpecificEvents.MOUSEMOVE|b.SpecificEvents.STOP_PROPAGATION}),b.EnableTouch(e,{specificEvents:b.SpecificEvents.MOUSEMOVE|b.SpecificEvents.STOP_PROPAGATION})},_detachListenersOnMarqueeContainment:function(){var a=this.namespace,b=null,c=null;b=this.$marqueeDiv,c=this.$marqueeContainer,c.off("mousedown."+a),b.off("mousedown."+a),c.off("mouseup."+a),b.off("mouseup."+a),c.off("touchstart."+a),b.off("touchstart."+a),c.off("touchend."+a),b.off("touchend."+a)},_getPoint:function(a){var b={x:a.pageX,y:a.pageY};return b},marqueeMouseDownHandler:function(a){var c,d,e=this.namespace,f=this;MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;if(!$(a.target).hasClass("selected-elements-cover")){for(c=this.$marqueeDiv,this.collapseMarquee();c[0].hasChildNodes();)c[0].removeChild(c[0].lastChild);c.show(),d=this.$marqueeContainer,this.dragging=!0,this.startPoint=this._getPoint(a),d.on("mousemove."+e,function(a){f.marqueeMouseMoveHandler(a)}),c.on("mousemove."+e,function(a){f.marqueeMouseMoveHandler(a)}),$(document).off("mouseup."+e).on("mouseup."+e,function(a){var b;b=f.model.get("isForCanvas")?f.marqueeCanvasMouseUpHandler(a,!0):f.marqueeMouseUpHandler(a,!0,!1)}),f.trigger(b.EVENTS.start,b.createCustomEventObject(a))}},marqueeMouseMoveHandler:function(c){var d,e,f,g,h,i=(this.idPrefix,this._getPoint(c)),j=i.x,k=i.y,l=this.startPoint,m=l.x,n=l.y,o=Math.abs(j-m),p=Math.abs(k-n);d=this.$marqueeDiv,g=this.$marqueeContainer,h=g.offset(),f=m>j?m-o:m,e=n>k?n-p:n,d.css({width:Math.round(o),height:Math.round(p),top:Math.round(e-h.top)+1+"px",left:Math.round(f-h.left)+1+"px"}),d.css(a.Common.Components.Models.DragSelect.MARQUEE_STYLE_DRAGGING),this.trigger(b.EVENTS.move,b.createCustomEventObject(c))},marqueeMouseUpHandler:function(a,c,d){if((d||this.dragging)&&!this.model.get("isForCanvas")){var e=this.namespace,f=this.$marqueeContainer,g=f.offset(),h=this.$marqueeDiv;this.dragging&&(f.off("mousemove."+e),f.off("mousemove"),h.off("mousemove."+e),h.off("mousemove"),this.dragging=!1,$(document).off("mouseup."+e));var i=this,j=[],e=this.namespace,k=i.model.get("selectorClass"),l=i.model.get("ignoreClass"),m=i.model.get("tolerance"),n="string"==typeof k?$("."+k):k,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w={top:0,left:0,height:0,width:0},x=!0,y=null;n.each(function(a){o=$(this),o.hasClass(l)||(p=o.offset(),q=p.top,r=p.left,s=o.outerHeight(),t=o.outerWidth(),u={top:q,left:r,height:s,width:t},v=i._checkIsInsideMarquee(u,m),o.data().isInsideMarquee=v,x&&v?(w.top=q,w.left=r,w.height=s,w.width=t,x=!1,j.push(o)):v&&(j.push(o),w=i._adjustMarqueeBounds(w,u)))}),w.top=w.top-g.top,w.left=w.left-g.left;var z=this._getMarqueeData();return c&&i.trigger(b.EVENTS.end,b.createCustomEventObject(a,j,{marqueeData:z})),y=i._resizeMarquee(w,j,c),d?y:void 0}},marqueeCanvasMouseUpHandler:function(a,c,d){if(d||this.dragging){var e=this.namespace,f=this.$marqueeContainer,g=f.offset(),h=this.$marqueeDiv;this.dragging&&(f.off("mousemove."+e),h.off("mousemove."+e),this.dragging=!1);for(var i=this,j=this.model,k=j.get("paperObjects"),l=k.length,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=j.get("tolerance"),u=j.get("itemsDefaultOffset"),v={top:0,left:0,height:0,width:0},w=!0,x=null,y=[],z=0;l>z;z++)x=k[z],r=x.bounds,m=g.top+r.y+u.top,n=g.left+r.x+u.left,o=r.height,p=r.width,q={top:m,left:n,height:o,width:p},s=i._checkIsInsideMarquee(q,t),w&&s?(v.top=m,v.left=n,v.height=o,v.width=p,w=!1,y.push(x)):s&&(v=i._adjustMarqueeBounds(v,q),y.push(x));v.top=v.top-g.top,v.left=v.left-g.left;var A=this._getMarqueeData();c&&i.trigger(b.EVENTS.end,b.createCustomEventObject(a,y,{marqueeData:A}));var B=i._resizeMarquee(v,y,c);return d?B:void 0}},_getMarqueeData:function(){var a=this.$marqueeDiv,b={height:a.outerHeight(),width:a.outerWidth(),position:a.position(),offset:a.offset()};return b},_adjustMarqueeBounds:function(a,b){var c=b.top,d=b.left,e=b.height,f=b.width;return c>=a.top&&d>=a.left?(a.height=c+e>a.top+a.height?c+e-a.top:a.height,a.width=d+f>a.left+a.width?d+f-a.left:a.width):(c<=a.top&&d<=a.left&&(a.height=a.top+a.height-c,a.width=a.left+a.width-d,a.top=c,a.left=d),c>=a.top&&d<=a.left&&(a.height=a.top+a.height<c+e?c+e-a.top:a.height,a.width=a.left+a.width-d,a.left=d),c<=a.top&&d>=a.left&&(a.height=a.top+a.height-c,a.width=a.left+a.width<d+f?d+f-a.left:a.width,a.top=c)),a},_checkIsInsideMarquee:function(a,b){if(a){var c=!1,b=b,d=this.$marqueeDiv,e=d.offset(),f=e.top,g=e.left,h=d.outerHeight(),i=d.outerWidth(),j=e.top+h,k=e.left+i,l=a.top,m=a.left,n=a.height,o=a.width,p=n*o,q=l+n,r=m+o,s=0,t=0,u={height:0,width:0},v=0;return s=Math.max(Math.min(j,q)-Math.max(f,l),0),t=Math.max(Math.min(k,r)-Math.max(g,m),0),u.height=s,u.width=t,v=u.height*u.width,r>g&&k>m&&q>f&&j>l&&v/p>b&&(c=!0),c}},_resizeMarquee:function(a,c,d){if(a){var e=this,f=null,g=this.$marqueeDiv,h=this.model.get("padding"),i=this.model.get("marqueeDefaultOffset"),j=null;g.css({top:Math.round(a.top-h+i.top),left:Math.round(a.left-h+i.left),height:Math.round(a.height?a.height+2*h:1),width:Math.round(a.width?a.width+2*h:1)}),(1===a.height||1===a.width)&&g.css({outline:"none"});var k=this._getMarqueeData(),l=[],j=null,m=null;if(!this.model.get("isForCanvas")){m=c.length;for(var n=0;m>n;n++)l.push(this._getElementData(c[n]))}j=b.createCustomEventObject(f,c,{marqueeData:k,elementPositions:l}),d&&e.trigger(b.EVENTS.resize,j)}return j},_getElementData:function(a){var b=a.offset(),c=this.$marqueeDiv.offset(),d={relativeTop:b.top-c.top,relativeLeft:b.left-c.left};return d},disableMarquee:function(){this.hideMarquee(),this._detachListenersOnMarqueeContainment()},enableMarquee:function(){this.showMarquee(),this._attachListenersOnMarqueeContainment()},hideMarquee:function(){this.$marqueeDiv.hide()},showMarquee:function(){this.$marqueeDiv.show()},collapseMarquee:function(){this._resizeMarquee({top:0,left:0,width:0,height:0},!1)},customFitMarqueeToBounds:function(a,b){return this._resizeMarquee(a,b,!1),this.model.get("isForCanvas")?this.marqueeCanvasMouseUpHandler(null,null,!0):this.marqueeMouseUpHandler(null,null,!0)},updatePaperObjects:function(a){this.model.set("paperObjects",a)},groupSelectedElements:function(b){var c=this.$marqueeDiv,d=$("<div/>");c.append(b),c.append(d),d.attr("class","selected-elements-cover").css({position:"absolute",height:c.outerHeight(),width:c.outerWidth(),top:0,left:0,"z-index":2,cursor:function(){return MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?"none":"pointer"}}),c.css(a.Common.Components.Models.DragSelect.MARQUEE_STYLE_AFTER_RELEASE);
},makeGroupDraggable:function(){var a=this;this.$marqueeDiv.draggable({containment:this.$marqueeContainer,start:function(b,c){a._marqueeOriginalPosition=$(this).offset()}})},breakGroup:function(){for(var a=this.$marqueeDiv[0];a.hasChildNodes();)a.removeChild(a.lastChild)},getOriginalOffset:function(){return this._marqueeOriginalPosition}},{createMarquee:function(a){if(a){var b=MathInteractives.Common.Components,c=new b.Models.DragSelect(a),d=new b.Views.DragSelect({model:c,el:a.player.$el});return d}},EVENTS:{resize:"marquee-resize",move:"marquee-move",start:"marquee-select-start",end:"marquee-end"},createCustomEventObject:function(a,b,c){return{originalEvent:a,selectedItems:b,optionalParams:c}}}),b=a.Common.Components.Views.DragSelect,a.global.Marquee=b}(MathInteractives),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.panBalance=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div class="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'pan-balance-wrapper pan-balance-wrapper-main">\r\n\r\n    <div class="pan-wrapper left-pan-wrapper">\r\n        <div class="left-tile-container tile-container">\r\n            <div class="static-container"></div>\r\n            <div class="dynamic-container">\r\n                <div class="dynamic-wrapper" data-pos="left"></div>\r\n            </div>\r\n        </div>\r\n        <div class="pan left-pan">\r\n            <div class="pan-data typography-label">\r\n                <span class="pan-label"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="pan-wrapper right-pan-wrapper">\r\n        <div class="right-tile-container tile-container">\r\n            <div class="static-container"></div>\r\n            <div class="dynamic-container">\r\n            <div class="dynamic-wrapper" data-pos="right"></div>\r\n            </div>\r\n        </div>\r\n        <div class="pan right-pan">\r\n            <div class="pan-data typography-label">\r\n                <span class="pan-label"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="dispenser-container">\r\n        <div class="dispenser-wrapper">\r\n            <div class="dispenser-row-1"></div>\r\n            <div class="dispenser-row-2"></div>\r\n        </div>\r\n    </div>\r\n\r\n    \r\n    <div class="center-rod"></div>\r\n    <div class="base"></div>\r\n    <div class="small-rod left-small-rod"></div>\r\n    <div class="small-rod right-small-rod"></div>\r\n\r\n</div>\r\n'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.panBalanceStructured=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div class="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'pan-balance-structured-wrapper pan-balance-structured-wrapper-main">\r\n\r\n    <div class="pan-wrapper left-pan-wrapper">\r\n        <div class="left-tile-container tile-container">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-static-container" class="static-container"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-dynamic-container" class="dynamic-container">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-accessibility-dynamic-wrapper" class="accessibility-dynamic-wrapper" data-pos="left"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-dynamic-wrapper" class="dynamic-wrapper" data-pos="left"></div>\r\n            </div>\r\n        </div>\r\n        <div class="pan left-pan">\r\n            <div class="pan-data typography-label">\r\n                <span class="pan-label"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="pan-wrapper right-pan-wrapper">\r\n        <div class="right-tile-container tile-container">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-static-container" class="static-container"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-dynamic-container" class="dynamic-container">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-accessibility-dynamic-wrapper" class="accessibility-dynamic-wrapper" data-pos="right"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-dynamic-wrapper" class="dynamic-wrapper" data-pos="right"></div>\r\n            </div>\r\n        </div>\r\n        <div class="pan right-pan">\r\n            <div class="pan-data typography-label">\r\n                <span class="pan-label"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="dispenser-container" id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-dispenser-container">\r\n        <div class="dispenser-wrapper">\r\n            <div class="dispenser-row-1"></div>\r\n            <div class="dispenser-row-2"></div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n    <div class="center-rod"></div>\r\n    <div class="base"></div>\r\n    <div class="small-rod left-small-rod"></div>\r\n    <div class="small-rod right-small-rod"></div>\r\n\r\n    <div class="temporary-bins-container">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-accessibility-temporary-bin" class="accessibility-temporary-bin" data-pos="left"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-temporary-bin" class="left-temporary-bin temporary-bin" data-pos="left"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-accessibility-temporary-bin" class="right-accessibility-temporary-bin accessibility-temporary-bin" data-pos="right"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-temporary-bin" class="right-temporary-bin temporary-bin" data-pos="right"></div>\r\n    </div>\r\n</div>\r\n'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.panBalanceDraggableTile=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div class="pan-balance-draggable-tile-wrapper">\r\n    <div class="pan-balance-draggable-tile-top-container">\r\n        <div class="pan-balance-draggable-tile-left-shadow shadow">\r\n        </div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-draggable-tile-text-container" class="pan-balance-draggable-tile-text-container">\r\n            <div class="pan-balance-draggable-tile-text-container-left-part">\r\n            </div>\r\n            <div class="pan-balance-draggable-tile-text-container-middle-part">\r\n                <div class="pan-balance-draggable-tile-text">\r\n                </div>\r\n                <div class="pan-balance-draggable-tile-dots">\r\n                </div>\r\n            </div>\r\n            <div class="pan-balance-draggable-tile-text-container-right-part">\r\n            </div>\r\n        </div>\r\n        <div class="pan-balance-draggable-tile-right-shadow shadow">\r\n        </div>\r\n    </div>\r\n    <div class="pan-balance-draggable-tile-bottom-shadow shadow">\r\n    </div>\r\n</div>\r\n'})}(),function(){"use strict";MathInteractives.Common.Components.Views.InputBox=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,player:null,inputEle:null,inputType:null,maxValue:null,precision:null,defaultValue:null,maxCharLength:null,keyCodeArray:null,regexString:null,allowNegative:null,resultantString:null,isValidInput:null,containerId:null,keyDownCase:!1,defaultTextOnEmptyInputBox:null,isMaxValueExceeded:!1,_customClass:null,enterFiredOnInputParent:!1,isTouchDevice:!1,initialize:function(){var a=MathInteractives.Common.Utilities.Models.BrowserCheck;this.isTouchDevice=a.isMobile,this.idPrefix=this.model.get("idPrefix"),this.manager=this.model.get("manager"),this.filePath=this.model.get("path"),this.player=this.model.get("player"),this.inputType=this.model.get("inputType"),this.maxValue=this.model.getMaxValue(),this.maxCharLength=this.model.get("maxCharLength"),this.precision=this.model.get("precision"),this.defaultValue=this.model.get("defaultValue"),this.keyCodeArray=this.model.get("keyCodeArray"),this.regex=this.model.get("regexString"),this.allowNegative=this.model.get("allowNegative"),this.regexString=this.model.get("regexString"),this.containerId=this.model.get("containerId"),this.defaultTextOnEmptyInputBox=this.model.getDefaultTextOnEmptyInputBox(),this._customClass=this.model.getCustomClass(),this._addJqueryFunction(),this._addStringFunction(),this._render(),this._bindEvents(),this.model.setRegexForCurrentType(),this.staticDataHolder=MathInteractives.global.InputBox},_render:function(){this.inputEle=$("<input></input>"),this.inputEle.attr("id",this.containerId+"-input-box"),this.model.getDefaultTabIndexToInputBox()&&this.isAccessible()&&this.inputEle.removeAttr("tabindex"),this._addCustomClass(),this.inputEle.addClass("input-box-common-component"),this.inputEle.val(this.defaultValue),this.$el.html(this.inputEle)},enableInputBox:function(){"#"+this.containerId+"-input-box",this.manager;this.inputEle.removeAttr("disabled")},disableInputBox:function(){this.inputEle.attr("disabled","disabled")},hideInputBox:function(){this.inputEle.hide()},showInputBox:function(){this.inputEle.show()},clearInputBox:function(){this.inputEle.val(""),this.model.setPreviousValue("")},_enableInputTab:function(a){if(this.manager.model.get("isAccessible")===!0){var b=this,c=this.$el,d=this.player.model.get("startTabindex"),e="#"+this.containerId+"-input-box",f=c.find(e),g=b.containerId.split(b.idPrefix)[1],h=b.getTabIndex(g);a===!0?(b.enableTab(g,!1),f.attr("tabindex",d+h)):(b.enableTab(g,!0),f.removeAttr("tabindex",-1))}},_bindEvents:function(){var a="#"+this.containerId+"-input-box",b=this,c=null,d=this.$el,e=d.find(a),f=(this.manager,null),g=MathInteractives.Common.Components.Views.InputBox,h=null,i=b.containerId,j=b.defaultTextOnEmptyInputBox;d.off("click").on("click",function(a){"disabled"!==e.attr("disabled")&&e.focus()}),d.off("keydown").on("keydown",function(a){f=a.keyCode,32===f&&"disabled"!==e.attr("disabled")?(b._enableInputTab(!0),e.focus(),a.stopPropagation()):13===f&&(b.enterFiredOnInputParent=!0)}),e.on("focus.input-box-focus",function(a){"disabled"!==e.attr("disabled")&&e.hasClass("focused")===!1&&(b._isValidated=!1,b.model.setAndroidDevicePreviousValue(e.val()))}),e.off("blur").on("blur",function(a){var c=e.val()||null;null===c&&(c=j),b._enableInputTab(!1),b.trigger(g.INPUT_TYPE_BLUR_EVENT,c,a,b.isValidInput)}),this.$el.find(a).off("keydown").on("keydown",function(a){b.enterFiredOnInputParent=!1,a=a?a:window.event;var c=a.keyCode?a.keyCode:a.which;return c===g.CHAR_CODE_ENUM.SINGLEQUOTE?(b.keyDownCase=!0,!1):(b.keyDownCase=!1,c===g.CHAR_CODE_ENUM.BACKSPACE||c===g.CHAR_CODE_ENUM.DELETE?b._checkForValidInput(a):void 0)}),e.off("paste").on("paste",function(a){var c=a.originalEvent.clipboardData,d="",f=e.prop("selectionStart")||null,h=e.prop("selectionEnd")||null;"undefined"!=typeof c&&(c=c.getData("text/plain"),d=e.val().inputBoxCommonComponentInsert(f,h,c)),b._checkForValidInput(a,d)===!1||MathInteractives.Common.Utilities.Models.BrowserCheck.isAndroid?a.preventDefault():b.trigger(i+g.CUSTOM_CHANGE_EVENT_NAME,a,b.charCode,b.isValidInput,b.model.getPreviousValue())}),MathInteractives.Common.Utilities.Models.BrowserCheck.isAndroid?(b.enterFiredOnInputParent=!1,e.off("keydown").on("keydown",function(a){b._setValuesOnKeyDown(a)})):e.off("keypress").on("keypress",function(a){return b.isTouchDevice===!0?!0:void(b.enterFiredOnInputParent=!1)}),this.$el.find(a).off("keyup").on("keyup",function(a){var c=MathInteractives.Common.Components.Views.InputBox,d=e.val();a=a?a:window.event;var f=a.keyCode?a.keyCode:a.which;return b.isTouchDevice?(h=b.model.getAndroidDevicePreviousValue(),null!==b.maxValue&&Number(h)>b.maxValue&&(b.trigger(b.containerId+c.GREATER_VALUE_ENTERED),e.val(b.model.getMaxValue()),h=e.val()),b.model.setAndroidDevicePreviousValue(h),b.trigger(c.ANDROID_KEYUP_EVENT,a,h),b.trigger(i+c.KEYUP_EVENT_NAME,a,f,b.isValidInput,h),f==c.CHAR_CODE_ENUM.ENTER&&b.trigger(i+c.ENTER_PRESS_EVENT_NAME,a,f,b.isValidInput,h),void 0):(f===c.CHAR_CODE_ENUM.BACKSPACE&&(b.isValidInput=!0),b.enterFiredOnInputParent||b.trigger(b.containerId+c.KEYUP_EVENT_NAME,a,f,b.isValidInput,b.resultantString),f==c.CHAR_CODE_ENUM.ENTER&&b.trigger(b.containerId+c.ENTER_PRESS_EVENT_NAME,a,f,b.isValidInput,b.resultantString),null!==b.maxValue&&Number(d)>b.maxValue&&(b.trigger(b.containerId+c.GREATER_VALUE_ENTERED),e.val(b.model.getMaxValue()),d=e.val()),b.model.getPreviousValue()!==d&&b.trigger(b.containerId+c.CUSTOM_CHANGE_EVENT_NAME,a,b.charCode,b.isValidInput,b.model.getPreviousValue()),b.model.setPreviousValue(d),b._keyPressEventHandle(a))}),this.$el.find(a).off("input").on("input",function(a){a=a?a:window.event;var d,f,h=a.keyCode?a.keyCode:a.which;$(a.target);c="input",b._isValidated!==!0&&(b.resultantString=e.val().toString(),b._checkForSpecialCharInAndroid(a,c)),f=e.val().length,b.allowNegative&&0===b.resultantString.indexOf("-")&&(f-=1),f<=b.maxCharLength?b.trigger(b.containerId+g.INPUT_EVENT_NAME,a,h,b.isValidInput,b.resultantString):(d=e.val().substring(0,b.maxCharLength),b._checkForValidInput(a,d)===!0&&(e.val(d),b.trigger(b.containerId+g.INPUT_EVENT_NAME,a,h,b.isValidInput,b.resultantString)),a.preventDefault())})},_addJqueryFunction:function(){$.fn.inputBoxCommonComponenetgetCursorPosition||($.fn.inputBoxCommonComponenetgetCursorPosition=function(){var a=this.get(0);if(a){if("selectionStart"in a)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange(),c=document.selection.createRange().text.length;return b.moveStart("character",-a.value.length),b.text.length-c}}})},_addStringFunction:function(){String.prototype.inputBoxCommonComponentInsert||(String.prototype.inputBoxCommonComponentInsert=function(a,b,c){return this.substring(0,a)+c+this.substring(b,this.length)}),String.prototype.inputBoxCommonComponentDelete||(String.prototype.inputBoxCommonComponentDelete=function(a,b,c){return a!==b?this.substring(0,a)+this.substring(b,this.length):c?this.substring(0,a)+this.substring(b+1,this.length):this.substring(0,a-1)+this.substring(b,this.length)})},_checkForSpecialCharInAndroid:function(a,b){var c=this,d=(this.staticData,this.staticDataHolder),e=(c.inputType,c.model),f=$(a.target),g=f.val(),h=e.getAndroidDevicePreviousValue()||"",i=new RegExp(e.getCurrentRegex());return i.test(g)&&g.length<=c.maxCharLength?(e.setAndroidDevicePreviousValue(g),c.isValidInput=!0,g!==h&&c.trigger(c.containerId+d.CUSTOM_CHANGE_EVENT_NAME,a,c.charCode,c.isValidInput,h),!0):(c.isValidInput=!1,f.val(h),!1)},_keyPressEventHandle:function(a){var b=$(a.target),c=b.prop("selectionStart")||null,d=b.prop("selectionEnd")||null,e="#"+this.containerId+"-input-box",f=(this.$el.find(e),MathInteractives.Common.Utilities.Models.BrowserCheck),g=new RegExp(/[$%(&]/);if(f.isFirefox&&this._checkSpecialKeys(a))return!0;if(this.keyDownCase)return this.isValidInput=!1,this.isValidInput;var h=(this.inputType,MathInteractives.Common.Components.Views.InputBox),i=null,a=(this.inputEle.val(),$(this.inputEle).inputBoxCommonComponenetgetCursorPosition(),a?a:window.event),j=a.keyCode?a.keyCode:a.which;this.charCode=j,i=this._checkForValidInput(a);var k=this.resultantString.length;if(this.allowNegative&&0===this.resultantString.indexOf("-")&&(k-=1),k-=d-c,k>this.maxCharLength){if(g.test(this.resultantString))return!1;j!=h.CHAR_CODE_ENUM.BACKSPACE&&j!=h.CHAR_CODE_ENUM.ENTER&&j!=h.CHAR_CODE_ENUM.LEFTARROW&&j!=h.CHAR_CODE_ENUM.TOPARROW&&j!=h.CHAR_CODE_ENUM.RIGHTARROW&&j!=h.CHAR_CODE_ENUM.BOTTOMARROW||a.shiftKey?this.isValidInput=!1:this.isValidInput=!0}else this.isValidInput=i;return this.trigger(this.containerId+h.KEYPRESS_EVENT_NAME,a,this.charCode,this.isValidInput,this.resultantString),this.isValidInput},_checkForValidInput:function(a,b){var c=this.inputType,d=MathInteractives.Common.Components.Views.InputBox,e=null,f=this.inputEle.val(),a=a?a:window.event,g=a.type,h=null,i=$(a.target),j=i.prop("selectionStart"),k=i.prop("selectionEnd"),l=a.keyCode?a.keyCode:a.which;switch(h=b&&""!==b.trim()?b:"keydown"===g?l===d.CHAR_CODE_ENUM.DELETE?f.inputBoxCommonComponentDelete(j,k,!0):f.inputBoxCommonComponentDelete(j,k,!1):f.inputBoxCommonComponentInsert(j,k,String.fromCharCode(l)),c){case d.INPUT_TYPE_INTEGER:e=this._isValidInteger(f,a,l,h);break;case d.INPUT_TYPE_FLOATING:e=this._isValidFloat(f,a,l,h);break;case d.INPUT_TYPE_ALPHANUMERIC:e=this._isValidAlphanumeric(f,a,l,h);break;case d.INPUT_TYPE_CURRENCY:e=this._isValidCurrency(f,a,l,h);break;case d.INPUT_TYPE_CUSTOM:e=this._isValidCustom(f,a,l,h)}return e},_checkSpecialKeys:function(a){var b=a.keyCode,c=MathInteractives.Common.Components.Views.InputBox;return b==c.CHAR_CODE_ENUM.BACKSPACE||b==c.CHAR_CODE_ENUM.TAB||b==c.CHAR_CODE_ENUM.DELETE||b==c.CHAR_CODE_ENUM.LEFTARROW||b==c.CHAR_CODE_ENUM.TOPARROW||b==c.CHAR_CODE_ENUM.RIGHTARROW||b==c.CHAR_CODE_ENUM.BOTTOMARROW?!0:!1},_isValidInteger:function(a,b,c,d){var e=new RegExp(/^\-{0,1}\d*$/),f=new RegExp(/[$%(&]/),g=$(b.target),h=g.prop("selectionStart"),i=g.prop("selectionEnd"),j=e.test(d),k=MathInteractives.Common.Components.Views.InputBox,l=b.keyCode;return this.resultantString=d,this.keyCodeArray.indexOf(c)>=0?!0:b.shiftKey?!1:f.test(d)?!1:c===k.CHAR_CODE_ENUM.SINGLEQUOTE?!1:MathInteractives.Common.Utilities.Models.BrowserCheck.isFirefox&&l===k.CHAR_CODE_ENUM.DELETE?!0:c==k.CHAR_CODE_ENUM.BACKSPACE||c==k.CHAR_CODE_ENUM.ENTER||c==k.CHAR_CODE_ENUM.LEFTARROW||c==k.CHAR_CODE_ENUM.TOPARROW||c==k.CHAR_CODE_ENUM.RIGHTARROW||c==k.CHAR_CODE_ENUM.BOTTOMARROW?!0:-1!==d.substring(h+1,i+1).indexOf("-")&&l>=48&&57>=l?!0:this.allowNegative&&i-h===a.length&&c===k.CHAR_CODE_ENUM.MINUS_KEY_KEYCODE?!0:(j||(this.allowNegative?g.val(a.replace(/[^-0-9]/g,"")):g.val(a.replace(/[^0-9]/g,""))),this.allowNegative?j:d.indexOf("-")>=0?(g.val(a.replace(/[^0-9]/g,"")),!1):j)},_isValidFloat:function(a,b,c,d){var e=this.precision,f=$(b.target),g=f.val(),h=f.prop("selectionStart"),i=f.prop("selectionEnd"),j=new RegExp("^\\-{0,1}\\d*(?:\\.\\d{0,"+e+"})?$"),k=new RegExp(/[$%(&]/),l=j.test(d),m=MathInteractives.Common.Components.Views.InputBox,n=this.model,o=b.keyCode,p=this.maxCharLength,q=(n.getLastInputValue()||null,this.allowNegative);if(this.resultantString=d,this.keyCodeArray.indexOf(c)>=0)return!0;if(b.shiftKey)return!1;if(c===m.CHAR_CODE_ENUM.SINGLEQUOTE)return!1;if(MathInteractives.Common.Utilities.Models.BrowserCheck.isIOS&&k.test(d))return!1;if(MathInteractives.Common.Utilities.Models.BrowserCheck.isFirefox&&o===m.CHAR_CODE_ENUM.DELETE)return!0;if(c==m.CHAR_CODE_ENUM.BACKSPACE||c==m.CHAR_CODE_ENUM.ENTER||c==m.CHAR_CODE_ENUM.LEFTARROW||c==m.CHAR_CODE_ENUM.TOPARROW||c==m.CHAR_CODE_ENUM.RIGHTARROW||c==m.CHAR_CODE_ENUM.BOTTOMARROW)return!0;if(-1!==d.substring(h+1,i+1).indexOf("-")&&(o>=48&&57>=o||110===o||45===c)){if(q===!0&&45===c)return!0;if(q===!1)return!0}return-1!==d.substring(h+1,i+1).indexOf("-")&&o>=48&&57>=o?!0:(l||(a.length<=p&&a.split(".").length<3?q?f.val(a.replace(/[^-0-9.]/g,"")):f.val(a.replace(/[^0-9.]/g,"")):(null===g&&(g=""),f.val(g))),n.setLastInputValue(f.val()),q?l:d.indexOf("-")>=0?(a.length<=p&&a.split(".").length<3?q?f.val(a.replace(/[^-0-9.]/g,"")):f.val(a.replace(/[^0-9.]/g,"")):(null===g&&(g=""),f.val(g)),n.setLastInputValue(f.val()),!1):l)},_isValidAlphanumeric:function(a,b,c,d){var e=MathInteractives.Common.Components.Views.InputBox,f=new RegExp(/^\w*$/),g=f.test(d);return this.keyCodeArray.indexOf(c)>=0?!0:c==e.CHAR_CODE_ENUM.BACKSPACE||c==e.CHAR_CODE_ENUM.ENTER||c==e.CHAR_CODE_ENUM.LEFTARROW||c==e.CHAR_CODE_ENUM.TOPARROW||c==e.CHAR_CODE_ENUM.RIGHTARROW||c==e.CHAR_CODE_ENUM.BOTTOMARROW?!0:(this.resultantString=d,g)},_isValidCurrency:function(a,b,c,d){var e=new RegExp(/^-?(?:0|[1-9]\d{0,2}(?:,?\d{3})*)(?:\.\d+)?$/),f=$(b.target),g=f.prop("selectionStart"),h=f.prop("selectionEnd"),i=e.test(d),j=b.keyCode;return-1!==d.substring(g+1,h+1).indexOf("-")&&(j>=48&&57>=j||188===j)?!0:(i||(this.allowNegative?f.val(a.replace(/[^-0-9.]/g,"")):f.val(a.replace(/[^0-9.]/g,""))),this.resultantString=d,i)},_isValidCustom:function(a,b,c,d){var e,f=$(b.target),g=f.val(),h=f.prop("selectionStart"),i=f.prop("selectionEnd"),j=g.length,k=new RegExp(this.regexString),l=String.fromCharCode(c);return this.keyCodeArray.indexOf(c)>=0?!0:j-(i-h)===0&&0!==j&&(e=k.test(l))?(this.resultantString=l,e):(e=k.test(d),this.resultantString=d,e)},_setValuesOnKeyDown:function(a){this.charCode=a.charCode||a.which,this.trigger(this.staticDataHolder.ANDROID_KEYDOWN_EVENT,a)},_addCustomClass:function(){null!==this._customClass&&null!==this.inputEle&&this.inputEle.addClass(this._customClass)},getCurrentInputValue:function(){return this.$el.find("input").val()||null}},{INPUT_TYPE_BLUR_EVENT:"input-blur",CHAR_CODE_ENUM:{BACKSPACE:8,ENTER:13,LEFTARROW:37,TOPARROW:38,RIGHTARROW:39,BOTTOMARROW:40,SINGLEQUOTE:222,DELETE:46,TAB:9,MINUS_KEY_KEYCODE:45},INPUT_TYPE_INTEGER:"integer",INPUT_TYPE_FLOATING:"floating",INPUT_TYPE_ALPHANUMERIC:"alphanumeric",INPUT_TYPE_CURRENCY:"currency",INPUT_TYPE_CUSTOM:"custom",ANDROID_KEYUP_EVENT:"android-keyup-event",ANDROID_KEYDOWN_EVENT:"android-input-keydown",KEYPRESS_EVENT_NAME:"input-box-keypress",KEYUP_EVENT_NAME:"input-box-keyup",ENTER_PRESS_EVENT_NAME:"input-box-enterpress",INPUT_EVENT_NAME:"input-box-input-event",CUSTOM_CHANGE_EVENT_NAME:"input-box-value-changed",GREATER_VALUE_ENTERED:"value-greater-than-maximum",createInputBox:function(a){if(null!==a.containerId){var b,c,d="#"+a.containerId;return b=new MathInteractives.Common.Components.Models.InputBox(a),c=new MathInteractives.Common.Components.Views.InputBox({el:d,model:b})}}}),MathInteractives.global.InputBox=MathInteractives.Common.Components.Views.InputBox}(),function(){"use strict";MathInteractives.Common.Components.Models.InputBox=Backbone.Model.extend({defaults:{maxCharLength:10,maxValue:null,previousValue:"",precision:2,defaultValue:"",keyCodeArray:[],regexString:null,allowNegative:!0,inputType:null,defaultTextOnEmptyInputBox:null,lastInputValue:null,defaultTabIndexToInputBox:!0,customClass:null,currentRegex:null,androidDevicePreviousValue:null},_initialize:function(){},getDefaultTextOnEmptyInputBox:function(){return this.get("defaultTextOnEmptyInputBox")},getPreviousValue:function(){return this.get("previousValue")},setPreviousValue:function(a){this.set("previousValue",a)},getLastInputValue:function(){return this.get("lastInputValue")},getMaxValue:function(){return this.get("maxValue")},setMaxValue:function(a){this.set("maxValue",a)},setLastInputValue:function(a){this.set("lastInputValue",a)},setDefaultTextOnEmptyInputBox:function(a){this.set("defaultTextOnEmptyInputBox",a)},setMaxCharLength:function(a){this.set("maxCharLenght",a)},getMaxCharLength:function(){return this.get("maxCharLenght")},setPrecision:function(a){this.set("precision",a)},getPrecision:function(){return this.get("precision")},setDefaultValue:function(a){this.set("defaultValue",a)},getDefaultValue:function(){return this.get("defaultValue")},setKeyCodeArray:function(a){this.set("keyCodeArray",a)},getKeyCodeArray:function(){return this.get("keyCodeArray")},setregexString:function(a){this.set("regexString",a)},getregexString:function(){return this.get("regexString")},getCustomClass:function(){return this.get("customClass")},setCustomClass:function(a){this.set("customClass",a)},getCurrentRegex:function(){return this.get("currentRegex")},setCurrentRegex:function(a){this.set("currentRegex",a)},getAndroidDevicePreviousValue:function(){return this.get("androidDevicePreviousValue")},setAndroidDevicePreviousValue:function(a){this.set("androidDevicePreviousValue",a)},setRegexForCurrentType:function(){var a=this.get("inputType"),b=this.get("allowNegative"),c=null,d=this.get("precision"),e=this.get("maxCharLength"),f=MathInteractives.global.InputBox;switch(a){case f.INPUT_TYPE_INTEGER:c=b?new RegExp("^\\-?\\d{0,"+e+"}$"):new RegExp("^\\d{0,"+e+"}$");break;case f.INPUT_TYPE_FLOATING:c=b?new RegExp("^\\-?\\d{0,"+e+"}\\.\\d{0,"+d+"}$|^\\-?\\d{0,"+e+"}$"):new RegExp("^\\d{0,"+e+"}\\.\\d{0,"+d+"}$|^\\d{0,"+e+"}$");break;case f.INPUT_TYPE_ALPHANUMERIC:c=new RegExp("^[a-zA-Z0-9_]*$");break;case f.INPUT_TYPE_CUSTOM:c=this.get("regexString")}this.set("currentRegex",c)},getDefaultTabIndexToInputBox:function(){return this.get("defaultTabIndexToInputBox")}})}(window.MathInteractives),function(){"use strict";MathInteractives.Common.Components.Views.HintFeedback=MathInteractives.Common.Player.Views.Base.extend({_type:null,_title:null,manager:null,_locText:null,_accText:null,_screenId:null,_width:null,_crossButton:null,_tabIndex:null,_containerId:null,_buttons:null,_path:null,idPrefix:null,_isContainerWidthMore:!1,keyDown:{},initialize:function(){this._type=this.model.getType(),this._title=this.model.getTitle(),this.idPrefix=this.model.getIdPrefix(),this._containerId=this.model.getContainerId(),this._locText=this.model.getLocText(),this._buttons=this.model.getButtons(),this._path=this.model.getPath(),this._player=this.model.getPlayer(),this.manager=this.model.getManager(),this._HINTFEEDBACK_TYPE=this.model.getHintFeedbackType(),this.$el.data("baseclass",this.$el.attr("class")),this.loadScreen("hint-feedback-component"),this.render()},render:function(){this.$el.show(),this._addPanelClassToContainer(),this._setWidthHeightOfContainer(),this._insertTopButtons(),this._addTitle(),this._insertText()},_addPanelClassToContainer:function(){switch(this._type){case this._HINTFEEDBACK_TYPE.HINT:this.$el.addClass("hint-panel");break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_RIGHT_PADDING:this.$el.addClass("feedback-panel feedback-panel-right-padding");break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_TOP_PADDING:this.$el.addClass("feedback-panel feedback-panel-top-padding")}},_addTitle:function(){if("undefined"!=typeof this._title)switch(this._type){case this._HINTFEEDBACK_TYPE.HINT:this.$el.find(".hintfeedback-header").append('<div id="'+this._containerId+'-title-panel" class="inner-title-panel">'+this._title+"</div>");break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_RIGHT_PADDING:break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_TOP_PADDING:}},_updateLocAccText:function(){var a=this._containerId.split(this.idPrefix)[1],b=this.model,c=b.getMessageID(),d=b.getArrParams();this.changeMessage(a+"-text-panel",c,d),this.changeAccMessage(a+"-acc-panel",c,d)},_insertText:function(){var a=this.$el,b="undefined"!=typeof this._buttons?!0:!1,c=this.model.getHeight();switch(b===!0&&this._checkButtons(),this._type){case this._HINTFEEDBACK_TYPE.HINT:a.find(".inner-text-panel").html(this._locText),b===!0||"undefined"!=typeof c&&a.find(".feedback-scroll-panel").css("height",c-(a.find(".inner-title-panel").height()+15)+"px"),this._createHackScreenForHint(),window.setTimeout($.proxy(this._hideHintOnClickingPlayer,this),0);break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_RIGHT_PADDING:this.loadScreen(this.model.getScreenId()),this._updateLocAccText(),b===!0?"undefined"!=typeof c&&a.find(".feedback-scroll-panel").css("height",c-(a.find(".panel-button-container").height()+28)+"px"):"undefined"!=typeof c&&a.find(".feedback-scroll-panel").css("height",c-26+"px"),this._setAccessibilityForFeedback();break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_TOP_PADDING:this.loadScreen(this.model.getScreenId()),this._updateLocAccText(),b===!0?"undefined"!=typeof c&&a.find(".feedback-scroll-panel").css("height",c-(a.find(".hintfeedback-header").height()+a.find(".panel-button-container").height()+17)+"px"):"undefined"!=typeof c&&a.find(".feedback-scroll-panel").css("height",c-(a.find(".hintfeedback-header").height()+15)+"px"),this._setAccessibilityForFeedback()}},_hideHintOnClickingPlayer:function(){var a=this,b=this._containerId+"close-hint-feedback",c=this._containerId.split(this.idPrefix)[1],d=MathInteractives.Common.Components.Views.HintFeedback.HINT_FEEDBACK_CROSS_BTN_CALLBACK,e=MathInteractives.Common.Components.Views.HintFeedback.IS_SHIFT_PRESSED,f={};this.$el.off("mousedown."+b).on("mousedown."+b,$.proxy(function(a){return a.preventdefault&&a.preventdefault(),!1},this)),this._player.$el.off("mousedown."+b).one("mousedown."+b,function(b){a.$el.trigger(d),a.closeHintFeedBackPanel()}),this.$el.off("keydown.hideHintOnFocusOut").on("keydown.hideHintOnFocusOut",function(b){a.keyDown=b||window.event}),this.focusOut(c+"-close-button-panel",function(){var b=a.keyDown,c=b.keyCode?b.keyCode:b.which;b.shiftKey===!1&&32!==c&&(f[e]=!1,a.$el.trigger(d,f),a.closeHintFeedBackPanel())},1),this._focusOutHidePanel=function(){a.keyDown.shiftKey===!0&&(f[e]=!0,a.$el.trigger(d,f),a.closeHintFeedBackPanel())},this.focusOut(c,this._focusOutHidePanel,1,!1),this.focusOut(c,this._focusOutHidePanel,1)},_createHackScreenForHint:function(){var a=this.model.getTabIndex(),b=this._containerId.split(this.idPrefix)[1];this.Hint_HackScreenProp={elementId:b,tabIndex:a,acc:this.model.getAccText()},this.Close_HackScreenProp={elementId:b+"-close-button-panel",tabIndex:a+10,role:"button",acc:this.getAccMessage("close-btn",0)},this.createAccDiv(this.Hint_HackScreenProp),this.createAccDiv(this.Close_HackScreenProp)},_setAccessibilityForFeedback:function(){var a=this,b=this._player.getCurrentActiveTab(),c=(this.$("#"+this._containerId+"-scroll-panel"),this.model.getTabIndex()),d=c+5,e=this._containerId.split(this.idPrefix)[1],f=this.$el.hasClass("feedback-with-modal")===!0,g=this.model.get("isTabsCovered"),h=this._player.$el.find("#"+this.idPrefix+"player-tab-"+(b+1)).length>0?!0:!1;f===!0&&(g===!1?h===!0?(c=this.getTabIndex("player-tab-"+b)+5,d=this.getTabIndex("player-tab-"+(b+1))-100):(c=b>0||h===!0?this.getTabIndex("player-tab-"+b)+5:this.getTabIndex("heading")+5,d=MathInteractives.Common.Components.Views.HintFeedback.FEEDBACK_WITH_MODAL_TAB_INDEX_TABS_NOT_COVERED_NO_TABS):(d=5,d=MathInteractives.Common.Components.Views.HintFeedback.FEEDBACK_WITH_MODAL_TAB_INDEX_TABS_COVERED)),this.updateFeedbackFocusRect(),this.setTabIndex(e+"-acc-panel",c),this.restrictAccDivSize(e+"-acc-panel"),this.ttsView.renderTTSAccessibility(d),c=d,"undefined"!=typeof this._buttons&&$(this._buttons).each(function(b){c+=5;var d={elementId:e+"-panel-button-"+b,tabIndex:c,role:"button",acc:this};a.createAccDiv(d)}),this.$el.hasClass("has-close-button")&&(this.Close_HackScreenProp={elementId:e+"-close-button-panel",tabIndex:c+5,role:"button",acc:this.getAccMessage("close-btn",0)},this.createAccDiv(this.Close_HackScreenProp)),
f===!0&&this._setAccessibilityEventsForFeedback(e)},updateFeedbackFocusRect:function(){var a=this.$("#"+this._containerId+"-scroll-panel"),b=this._containerId.split(this.idPrefix)[1],c=b+"-acc-panel",d=this.$("#"+this.idPrefix+c),e=this.getTabIndex(c);d.css({position:"absolute",width:a.width(),height:a.height()}),e>-1&&this.updateFocusRect(c)},_setAccessibilityEventsForFeedback:function(a){var b=this;this.$el.off("keydown.setFocusforFeedbackModal").on("keydown.setFocusforFeedbackModal",function(a){b.keyDown=a}),this._setFocusToAccFeedbackOnShiftTab=function(){b.keyDown.shiftKey===!0&&b.setFocus(a+"-acc-panel")},this._setFocusToFeedbackTTSOnTab=function(){if(b.keyDown.shiftKey===!1){var a=b.$el.find(".tts-button-panel > .click-enabled:visible").attr("id").trim().split(b.idPrefix)[1];b.setFocus(a)}},this.focusOut(a+"-tts-button-panel-play-btn",this._setFocusToAccFeedbackOnShiftTab,1,!1),this.focusOut(a+"-tts-button-panel-play-btn",this._setFocusToAccFeedbackOnShiftTab,1),this.focusOut(a+"-tts-button-panel-pause-btn",this._setFocusToAccFeedbackOnShiftTab,1,!1),this.focusOut(a+"-tts-button-panel-pause-btn",this._setFocusToAccFeedbackOnShiftTab,1),this.focusOut(a+"-acc-panel",this._setFocusToFeedbackTTSOnTab,1,!1),this.focusOut(a+"-acc-panel",this._setFocusToFeedbackTTSOnTab,1)},enableHintFeedbackTab:function(a){var b=this._containerId.split(this.idPrefix)[1],c=b+"-close-button-panel";switch(this._type){case this._HINTFEEDBACK_TYPE.HINT:this.enableTab(b,a);break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_RIGHT_PADDING:case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_TOP_PADDING:if(this.enableTab(b+"-acc-panel",a),this.ttsView.enableTTSBtnTab(a),this._buttons)for(var d=0,e=this._buttons.length;e>d;d++)this.enableTab(b+"-panel-button-"+d,a)}this.enableTab(c,a)},_setWidthHeightOfContainer:function(){var a=this.$el,b=this.model;"undefined"!=typeof b.getWidth()&&a.css({width:b.getWidth()+"px"}),"undefined"!=typeof b.getHeight()&&a.css({height:b.getHeight()+"px"})},_insertTopButtons:function(){var a,b,c,d=(this._type,"undefined"!=typeof this._buttons?!0:!1),e=this.model.getModalDisplayStatus()===!1?!1:this.model.getModalDisplayStatus(),f="undefined"==typeof this.model.getCrossButton()?"undefined":this.model.getCrossButton(),g=$("<div/>").append(MathInteractives.Common.Components.templates.hintFeedback({"container-id":this._containerId}).trim()).children().children();this.$el.append(g);var h=this.$el.find(".hintfeedback-button-panel");switch(this._type){case this._HINTFEEDBACK_TYPE.HINT:a=MathInteractives.Common.Components.Views.Button.TYPE.CLOSE_PURPLE_CROSS;break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_RIGHT_PADDING:a=MathInteractives.Common.Components.Views.Button.TYPE.CLOSE_ORANGE_CROSS,this.$el.addClass("has-tts-button"),d===!0&&this.$el.addClass("feedback-with-buttons"),(d===!0&&e!==!1||e===!0)&&this._showFeedBackModal(),h.append('<div id="'+this._containerId+'-tts-button-panel" class="tts-button-panel inner-top-button-panel"></div>'),b=[this._containerId+"-text-panel"],c={containerId:this._containerId+"-tts-button-panel",messagesToPlay:b,path:this._path,player:this._player,idPrefix:this.idPrefix,manager:this.manager},this.ttsView=MathInteractives.global.PlayerTTS.generateTTS(c);break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_TOP_PADDING:a=MathInteractives.Common.Components.Views.Button.TYPE.CLOSE_ORANGE_CROSS,this.$el.addClass("has-tts-button"),d===!0&&this.$el.addClass("feedback-with-buttons"),(d===!0&&e!==!1||e===!0)&&this._showFeedBackModal(),h.append('<div id="'+this._containerId+'-tts-button-panel" class="tts-button-panel inner-top-button-panel"></div>'),b=[this._containerId+"-text-panel"],c={containerId:this._containerId+"-tts-button-panel",messagesToPlay:b,path:this._path,player:this._player,idPrefix:this.idPrefix,manager:this.manager},this.ttsView=MathInteractives.global.PlayerTTS.generateTTS(c)}if(f||!d&&"undefined"!==f){h.append('<div id="'+this._containerId+'-close-button-panel" class="close-button-panel inner-top-button-panel"></div>'),this.$el.addClass("has-close-button"),this.$el.find(".tts-button-panel").addClass("tts-button-panel-without-button");var i={id:this._containerId+"-close-button-panel",tooltipText:this.getMessage("close-btn-tooltip-text","0"),type:a,path:this._path,player:this.model.get("player")},j=this;j.closePanelButton=MathInteractives.global.Button.generateButton(i),j.closePanelButton.$el.off("click").on("click",function(a){MathInteractives.global.SpeechStream.stopReading(),j.$el.trigger(MathInteractives.Common.Components.Views.HintFeedback.HINT_FEEDBACK_CROSS_BTN_CALLBACK),j.closeHintFeedBackPanel(),j.removeFeedBackModal(),j._player.$el.off("mousedown."+j._containerId+"close-hint-feedback")})}var k=this._player.$(".feedback-modal");k.css({height:k.parent().height()})},_checkButtons:function(){if("undefined"!=typeof this._buttons){this.$el.find(".hintfeedback-content").append('<div id="'+this._containerId+'panel-button-container" class="panel-button-container"></div>');for(var a=0;a<this._buttons.length;a++){var b=0;b=parseInt(a),this.$el.find(".panel-button-container").append('<div id="'+this._containerId+"-panel-button-"+a+'" class="panel-button"></div>');var c={id:this._containerId+"-panel-button-"+a,text:this._buttons[a],type:MathInteractives.Common.Components.Views.Button.TYPE.GENERAL,path:this._path,fixedMinWidth:!0,btnWidthGroup:"feedback-buttons"};MathInteractives.global.Button.generateButton(c);this.$("#"+this._containerId+"-panel-button-"+a).off("click").on("click",$.proxy(function(b){MathInteractives.global.SpeechStream.stopReading(),this.$el.trigger(this._containerId+"-feedback-panel-button"+a),this.closeHintFeedBackPanel()},this))}}},closeHintFeedBackPanel:function(a){var b=this.$el;switch(b.hasClass("feedback-with-modal")===!0&&this.removeFeedBackModal(a),b.html("").hide().removeAttr("style").attr("class",this.$el.data("baseclass")),this._type){case this._HINTFEEDBACK_TYPE.HINT:b.removeClass("hint-panel");break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_RIGHT_PADDING:b.removeClass("feedback-panel");break;case this._HINTFEEDBACK_TYPE.FEEDBACK_WITH_TOP_PADDING:b.removeClass("feedback-panel")}},removeFeedBackModal:function(a){var b,c=(this.model.get("isTabsCovered"),this.model.get("player"));return"undefined"!=typeof a&&isNaN(a)===!0?void this.log("currentTab is invalid"):(b=a||c.getCurrentActiveTab(),this.model.get("isTabsCovered")===!0?c.$el.find(".feedback-modal").remove():$(c.$el.find("#"+this.idPrefix+"activity-area-"+b)).find(".feedback-modal").remove(),void c.setModalPresent(!1))},_showFeedBackModal:function(){var a,b,c=this.model.get("isTabsCovered"),d=this.model.get("player");b=d.getCurrentActiveTab(),a=c===!1?$(d.$el.find("#"+this.idPrefix+"activity-area-"+b)):d.$el,this.$el.addClass("feedback-with-modal"),d.setModalPresent(!0),c===!0?(a=d.$el,0===a.find(".feedback-modal").length&&a.append('<div class="feedback-modal CoverTabs"></div>')):(a=$(d.$el.find("#"+this.idPrefix+"activity-area-"+b)),0===a.find(".feedback-modal").length&&a.append('<div class="feedback-modal"></div>'))}},{IS_SHIFT_PRESSED:"isShiftPressed",HINT_FEEDBACK_CROSS_BTN_CALLBACK:"cross-button-hint-feedback",FEEDBACK_WITH_MODAL_TAB_INDEX_TABS_NOT_COVERED_NO_TABS:4705,FEEDBACK_WITH_MODAL_TAB_INDEX_TABS_COVERED:4905,generateHintFeedbackPanel:function(a){var b=new MathInteractives.Common.Components.Models.HintFeedback(a),c=new MathInteractives.Common.Components.Views.HintFeedback({el:$("#"+a.containerId),model:b});return c}}),MathInteractives.global.HintFeedback=MathInteractives.Common.Components.Views.HintFeedback}(),function(){"use strict";MathInteractives.Common.Components.Models.HintFeedback=Backbone.Model.extend({defaults:function(){return{type:"2",title:"",locText:null,accText:null,width:void 0,height:void 0,crossButton:void 0,tabIndex:null,containerId:null,buttons:void 0,screenId:null,manager:null,path:null,idPrefix:null,player:null,isTabsCovered:!1,messageId:"0",arrParams:[],showModal:void 0}},initialize:function(){"undefined"!=typeof this.get("buttons")&&"undefined"==typeof this.get("crossButton")&&this.setCrossButton(!1)},getContainerId:function(){return this.get("containerId")},getType:function(){return this.get("type")},getTitle:function(){return this.get("title")},getLocText:function(){return this.get("locText")},getAccText:function(){return this.get("accText")},getWidth:function(){return this.get("width")},getHeight:function(){return this.get("height")},getCrossButton:function(){return this.get("crossButton")},getTabIndex:function(){return this.get("tabIndex")},getButtons:function(){return this.get("buttons")},getScreenId:function(){return this.get("screenId")},getManager:function(){return this.get("manager")},getIdPrefix:function(){return this.get("idPrefix")},getPath:function(){return this.get("path")},getPlayer:function(){return this.get("player")},getHintFeedbackType:function(a){return MathInteractives.Common.Components.Models.HintFeedback.HINT_FEEDBACK_TYPE},getMessageID:function(){return this.get("messageId")},getArrParams:function(){return this.get("arrParams")},getModalDisplayStatus:function(){return this.get("showModal")},setContainerId:function(a){this.set("containerId",a)},setType:function(a){this.set("type",a)},setTitle:function(a){this.set("title",a)},setLocText:function(a){this.set("locText",a)},setAccText:function(a){this.set("accText",a)},setWidth:function(a){this.set("width",a)},setHeight:function(a){this.set("height",a)},setCrossButton:function(a){this.set("crossButton",a)},setTabindex:function(a){this.set("tabindex",a)},setButtons:function(a){this.set("buttons",a)},setScreenId:function(a){this.set("screenId",a)},setManager:function(a){this.set("manager",a)},setPath:function(a){this.set("path",a)},setIdPrefix:function(a){this.set("idPrefix",a)},setPlayer:function(a){this.set("player",a)}},{HINT_FEEDBACK_TYPE:{HINT:"1",FEEDBACK_WITH_RIGHT_PADDING:"2",FEEDBACK_WITH_TOP_PADDING:"3"}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.hintFeedback=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div>\r\n  <div class="hintfeedback-header">\r\n    <div class="hintfeedback-button-panel"></div>\r\n  </div>\r\n  <div class="hintfeedback-content">\r\n    <div id ="',(g=c["container-id"])?f=g.call(b,{hash:{},data:e}):(g=b&&b["container-id"],f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-acc-panel" class="feedback-acc-panel"></div>\r\n    <div id ="',(g=c["container-id"])?f=g.call(b,{hash:{},data:e}):(g=b&&b["container-id"],f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-scroll-panel" class="feedback-scroll-panel">\r\n      <div id="',(g=c["container-id"])?f=g.call(b,{hash:{},data:e}):(g=b&&b["container-id"],f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-text-panel" class="inner-text-panel"></div>\r\n    </div>\r\n  </div>\r\n</div>'})}(),function(){"use strict";MathInteractives.Common.Components.Models.RatioBar=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:{defaultColorOfRatioBar:"#A9A9A9",leftSideRatioCount:0,rightSideRatioCount:0,leftSideColor:"#0086A7",rightSideColor:"#CB3E87",widthOfRatioBar:270,heightOfRatioBar:15,ratioSeparatorLineWidth:3,ratioSeperatorLineColor:"#222",colorQuantLineWidth:1,colorQuantLineColor:"#222",ratioValue:null,leftSideWidth:null},getDefaultColorOfRatioBar:function(){return this.get("defaultColorOfRatioBar")},setDefaultColorOfRatioBar:function(a){this.set("defaultColorOfRatioBar",a)},getLeftSideColor:function(){return this.get("leftSideColor")},setLeftSideColor:function(a){this.set("leftSideColor",a)},getRightSideColor:function(){return this.get("rightSideColor")},setRightSideColor:function(a){this.set("rightSideColor",a)},getRatioSeperatorLineColor:function(){return this.get("ratioSeperatorLineColor")},setRatioSeperatorLineColor:function(a){this.set("ratioSeperatorLineColor",a)},getColorQuantLineColor:function(){return this.get("colorQuantLineColor")},setColorQuantLineColor:function(a){this.set("colorQuantLineColor",a)},getLeftSideRatioCount:function(){return this.get("leftSideRatioCount")},setLeftSideRatioCount:function(a){this.set("leftSideRatioCount",Number(a))},getRightSideRatioCount:function(){return this.get("rightSideRatioCount")},setRightSideRatioCount:function(a){this.set("rightSideRatioCount",Number(a))},getWidthOfRatioBar:function(){return this.get("widthOfRatioBar")},setWidthOfRatioBar:function(a){this.set("WidthOfRatioBar",Number(a))},getHeightOfRatioBar:function(){return this.get("heightOfRatioBar")},setHeightOfRatioBar:function(a){this.set("heightOfRatioBar",Number(a))},getRatioSeparatorLineWidth:function(){return this.get("ratioSeparatorLineWidth")},setRatioSeparatorLineWidth:function(a){this.set("ratioSeparatorLineWidth",Number(a))},getColorQuantLineWidth:function(){return this.get("colorQuantLineWidth")},setColorQuantLineWidth:function(a){this.set("colorQuantLineWidth",Number(a))},getRatioValue:function(){return this.get("ratioValue")},setRatioValue:function(a){this.set("ratioValue",Number(a))},getLeftSideWidth:function(){return this.get("leftSideWidth")},setLeftSideWidth:function(a){this.set("leftSideWidth",Number(a))},getBarType:function(){var a,b,c;return a=this.getLeftSideRatioCount(),b=this.getRightSideRatioCount(),c=MathInteractives.Common.Components.Models.RatioBar,a&&b?c.ratioBarTypes.twoRatioBar:a?c.ratioBarTypes.onlyLeftRatioBar:b?c.ratioBarTypes.onlyRightRatioBar:c.ratioBarTypes.defaultBar}},{ratioBarTypes:{defaultBar:"00",twoRatioBar:"11",onlyLeftRatioBar:"10",onlyRightRatioBar:"01"}})}(),function(){"use strict";MathInteractives.Common.Components.Views.RatioBar=MathInteractives.Common.Player.Views.Base.extend({colorSeparatorPosition:0,initialize:function(){this._attachEvents(),this._render()},_attachEvents:function(){var a=this.model;this.listenTo(a,"change",this._render)},_render:function(){if(this.$el){this.$(".ratio-bar-antecedent-divs").remove(),this.$(".ratio-bar-consequent-divs").remove(),this.$(".ratio-bar-separator").remove();var a=this.model,b=a.getWidthOfRatioBar(),c=a.getHeightOfRatioBar();this.$el.css({width:b,height:c}),this._createRatioBar(a.getBarType())}},_createRatioBar:function(a){var b,c,d,e,f,g,h,i=this.model,j=MathInteractives.Common.Components.Models.RatioBar,k=i.getDefaultColorOfRatioBar(),l=i.getLeftSideColor(),m=i.getRightSideColor(),n=i.getRatioSeperatorLineColor(),o=i.getColorQuantLineColor(),p=i.getLeftSideRatioCount(),q=i.getRightSideRatioCount(),r=i.getWidthOfRatioBar(),s=(i.getHeightOfRatioBar(),i.getRatioSeparatorLineWidth()),t=i.getColorQuantLineWidth();switch(a){case j.ratioBarTypes.defaultBar:this.$el.css({"background-color":k}),this.colorSeparatorPosition=0;break;case j.ratioBarTypes.onlyLeftRatioBar:for(b=r-t*(p-1),c=b%p,f=Math.floor(b/p),g=f+1,d=0;p>d;d++)h=d>p-c-1?g:f,e=$("<div></div>").addClass("ratio-bar-antecedent-divs").css({width:h,"border-right-width":t,"border-color":o,"background-color":l}).appendTo(this.$el),d===p-1&&e.css({"border-width":0});this.colorSeparatorPosition=r;break;case j.ratioBarTypes.onlyRightRatioBar:for(b=r-t*(q-1),c=b%q,f=Math.floor(b/q),g=f+1,d=0;q>d;d++)h=d>q-c-1?g:f,e=$("<div></div>").addClass("ratio-bar-consequent-divs").css({width:h,"border-right-width":t,"border-color":o,"background-color":m}).appendTo(this.$el),d===q-1&&e.css({"border-width":0});this.colorSeparatorPosition=0;break;case j.ratioBarTypes.twoRatioBar:var u,v=1,w=0,x=0,y=0,z=0,A=0,B=null,C=0,D=0,E=0,F=0;if(b=r-s,u=(p/q).toFixed(3),w=u*v,A=Math.floor(b/(w+v)*v),z=b-A,"undefined"!=typeof this.options.regulationModel){var G=this.options.regulationModel.getRatioValue(),H=this.options.regulationModel.getLeftSideWidth();H===z&&(u>G?A-=1:G>u&&(A+=1),z=b-A)}for(i.set("ratioValue",u,{silent:!0}),i.set("leftSideWidth",z,{silent:!0}),x=z%p,y=A%q,C=Math.floor(z/p),D=C+1,E=Math.floor(A/q),F=E+1,d=0;p>d;d++)h=d>p-x-1?D:C,B=0!==t&&d!==p-1?h-1:h,e=$("<div></div>").addClass("ratio-bar-antecedent-divs").css({width:B,"border-right-width":t,"border-color":o,"background-color":l}).appendTo(this.$el),d===p-1&&e.css({"border-width":0});for($("<div></div>").addClass("ratio-bar-separator").css({width:s,"background-color":n}).appendTo(this.$el),d=0;q>d;d++)h=d>q-y-1?F:E,B=0!==t&&d!==q-1?h-1:h,e=$("<div></div>").addClass("ratio-bar-consequent-divs").css({width:B,"border-right-width":t,"border-color":o,"background-color":m}).appendTo(this.$el),d===q-1&&e.css({"border-width":0});this.colorSeparatorPosition=z}},getPositionOfColorSeparator:function(){return this.colorSeparatorPosition}})}(),function(){MathInteractives.Common.Components.Models.GridArea=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:{countArray:null,tileCollection:[],tileWidth:null,tileHeight:null,images:[],hoverImages:[],canvasType:null,selectedTilesArray:null,currentTilePosition:null},initialize:function(){this.set("tileCollection",new MathInteractives.Common.Components.Models.GridArea.TileCollection(this.get("tileCollection"))),this.get("countArray")||this.set("countArray",new Array),this.on("change:countArray",$.proxy(this._fireCountUpdateEvent,this))},_fireCountUpdateEvent:function(){this.trigger(MathInteractives.Common.Components.Models.GridArea.EVENTS.COUNT_UPDATE_EVENT)},setCountArray:function(a){this.set("countArray",a)},setCanvasType:function(a){this.set("canvasType",a)},populateImages:function(a,b){this.set("images",a),this.set("hoverImages",b);var c=[];if(0===this.get("countArray").length){for(var d=0;d<this.get("images").length;d++)c[d]=0;this.set("countArray",c)}}},{EVENTS:{COUNT_UPDATE_EVENT:"countUpdate"},getTileId:function(a,b){return a.toString()+"-"+b.toString()},Tile:Backbone.Model.extend({defaults:{id:null,tileRow:null,tileCol:null,imageIndex:null}}),TileCollection:Backbone.Collection.extend({initialize:function(a){model=this.Tile},add:function(a){for(a=_.isArray(a)?a.slice():[a],d=0,length=a.length;d<length;d++){var b=a[d]instanceof this.model?a[d]:new this.model(a[d]),c=this.where({id:b.get("id")});if(c.length>0){for(var d=0;d<c.length;d++)c[d].set("imageIndex",b.get("imageIndex"));return!1}Backbone.Collection.prototype.add.call(this,b)}},addTiles:function(a,b){for(var c=MathInteractives.Common.Components.Models.GridArea,d=0;d<a.length;d++){var e=new MathInteractives.Common.Components.Models.GridArea.Tile({id:c.getTileId(a[d].tileRow,a[d].tileCol),tileRow:a[d].tileRow,tileCol:a[d].tileCol,imageIndex:b});this.add(e)}},resetCollection:function(){for(var a=this.length,b=0;a>b;b++)this.remove(this.models[b]),a--,b--},removeTile:function(a,b){for(var c=MathInteractives.Common.Components.Models.GridArea,d=c.getTileId(a,b),e=0;e<this.models.length;e++)if(d===this.models[e].id){this.remove(this.models[e]);break}},getTileCount:function(a){var b=this.where({imageIndex:a});return b.length}})})}(),function(){"use strict";MathInteractives.Common.Components.Views.GridArea=MathInteractives.Common.Player.Views.Base.extend({manager:null,filePath:null,player:null,model:null,collection:null,tilesHorizontal:null,tilesVertical:null,images:null,prevIndex:null,hoverImages:null,drawingCanvasTool:null,startPoint:null,endPoint:null,drawingCanvasScope:null,currentArray:[],selectedTilesArray:[],drawnTilesArray:[],startArray:[],currentIndex:-1,canvasWidth:null,canvasHeight:null,numberOfImages:null,showCountInId:null,countArray:[],canvasBgColor:null,hoveredTile:{},interactivityName:null,indexOfDraggedImage:null,isDragging:!1,isDropped:!1,gridImagePath:null,containmentDivId:null,drawStarted:!1,tileWidth:null,tileHeight:null,navigatePoint:null,tileToReplace:null,isNotErasable:null,showHalfImage:null,canvasType:null,events:{"mousemove .canvas-grid":"onCanvasGridMove","mousedown .canvas-grid":"onCanvasGridClick","mouseleave .hoverImage":"mouseLeaveFromHoverImage","mouseenter .hoverImage":"onMouseEnterHoverImage"},initialize:function(a){var b=this;b.model=a.model,b.player=a.player,b.manager=a.manager,b.filePath=a.path,b.idPrefix=b.player.getIDPrefix(),b.tileWidth=b.model.get("tileWidth"),b.tileHeight=b.model.get("tileHeight"),b.collection=b.model.get("tileCollection"),b.images=b.model.get("images"),b.hoverImages=b.model.get("hoverImages"),b.numberOfImages=b.images.length,b.countArray=b.model.get("countArray"),b.canvasType=b.model.get("canvasType"),null===b.canvasType&&(b.canvasType=a.canvasType,b.model.setCanvasType(a.canvasType)),b.tilesHorizontal=a.tilesHorizontal,b.tilesVertical=a.tilesVertical,b.showCountInId=a.showCountInId,b.canvasBgColor=a.canvasColor,b.interactivityName=a.interactivityName,b.containmentDivId=a.containmentDivId,b.isNotErasable=a.isNotErasable||!1,b.showHalfImage=a.showHalfImage||!1,b.manager.loadScreen("grid-area"),b.render(),b.attachEvents()},render:function(){var a=this,b=$("<canvas>",{id:a.interactivityName+"gridCanvas","class":"gridCanvas"}),c=$("<canvas>",{id:a.interactivityName+"drawingCanvas","class":"drawingCanvas"}),d=$("<div>",{id:a.interactivityName+"canvas-grid","class":"canvas-grid"}),e=$("<div>",{id:a.interactivityName+"hover-image","class":"hoverImage"}),f=(a.collection,MathInteractives.Common.Utilities.Models.Utils);a.$el.append(b),a.$el.append(c),a.$el.append(d),a.$el.append(e),f.EnableTouch(this.$(".hoverImage")),a.setStylesToCanvasHolderElements(),a.drawingCanvasScope=new paper.PaperScope,a.drawingCanvasScope.setup(a.interactivityName+"drawingCanvas"),a.$(".drawingCanvas")[0].width=a.canvasWidth,a.$(".drawingCanvas")[0].height=a.canvasHeight,a.drawingCanvasTool=new a.drawingCanvasScope.Tool,a._canvasAcc=MathInteractives.global.CanvasAcc.intializeCanvasAcc({type:a.canvasType,canvasHolderID:a.el.id,manager:a.manager,player:a.player,paperScope:a.drawingCanvasScope,gridCell:{size:{width:a.tileWidth,height:a.tileHeight},origin:{x:a.tileWidth/2,y:a.tileHeight/2}},gridContainment:{minX:a.tileWidth/2,maxX:a.tileWidth*a.tilesHorizontal,minY:a.tileHeight/2,maxY:a.tileHeight*a.tilesVertical},focusRectSize:{width:a.tileWidth-4,height:a.tileHeight-4}}),a.$el.on(MathInteractives.Common.Player.Models.CanvasAcc.DRAW_AND_EXPAND_EVENTS.SPACE,$.proxy(a.accSpaceHandler,a)),a.$el.on(MathInteractives.Common.Player.Models.CanvasAcc.DRAW_AND_EXPAND_EVENTS.FOCUS_OUT,$.proxy(a.accFocusHandler,a)),a.$el.on(MathInteractives.Common.Player.Models.CanvasAcc.DRAW_AND_EXPAND_EVENTS.ARROW,$.proxy(a.accArrowHandler,a)),a.$el.on(MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.FOCUS_OUT,$.proxy(a.accFocusOutInDragHandler,a)),a.$el.on(MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.TAB,$.proxy(a.accTabInDragHandler,a)),a.$el.on(MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.SPACE,$.proxy(a.accSpaceInDragHandler,a)),a.$el.on(MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.ARROW,$.proxy(a.accArrowInDragHandler,a)),a.renderGrid(),a.showCount(a.countArray)},setStylesToCanvasHolderElements:function(){var a=this,b=a.$(".hoverImage"),c=a.$(".gridCanvas"),d=a.$(".drawingCanvas"),e=a.$(".canvas-grid"),f=MathInteractives.Common.Utilities.Models.Utils;b.css({position:"absolute",width:a.tileWidth+"px",height:a.tileHeight+"px",cursor:"move","z-index":"0"}).draggable({start:function(){a.isDragging=!0,a.isDropped=!1,a.removeTileFromCanvas()},stop:function(){a.isDragging=!1,a.isDropped||a.repaintDraggedTile()},containment:"#"+a.containmentDivId,revert:"invalid"}).hide(),a.canvasWidth=a.tileWidth*a.tilesHorizontal,a.canvasHeight=a.tileHeight*a.tilesVertical,c[0].width=a.canvasWidth,c[0].height=a.canvasHeight,c.css({position:"absolute","background-color":a.canvasBgColor}),d[0].width=a.canvasWidth,d[0].height=a.canvasHeight,d.css({position:"absolute"}),e.css({position:"absolute",width:a.canvasWidth+1+"px",height:a.canvasHeight+1+"px",top:"0px",left:"0px"}),f.EnableTouch(this.$(".canvas-grid"),{specificEvents:f.SpecificEvents.DRAGGABLE}),d.droppable({drop:function(b,c){a.replaceCurrentTileWithDraggedTile(b,c),a.copyTilesFromDrawingCanvasToGridCanvas(),a.dropEvent=b}})},removeTileFromCanvas:function(a,b){var c,d,e=this,f=document.getElementById(e.interactivityName+"gridCanvas"),g=f.getContext("2d"),h=document.getElementById(e.interactivityName+"drawingCanvas"),i=h.getContext("2d");"undefined"==typeof a&&(a=e.hoveredTile.col),"undefined"==typeof b&&(b=e.hoveredTile.row),c=(a-1)*e.tileHeight,d=(b-1)*e.tileWidth,i.clearRect(c,d,e.tileWidth,e.tileHeight),g.clearRect(c,d,e.tileWidth,e.tileHeight)},repaintDraggedTile:function(){var a=this,b={},c=[],d=a.drawingCanvasScope.project.activeLayer.children,e=d.length;b.tileRow=a.hoveredTile.row,b.tileCol=a.hoveredTile.col,c[0]=b,a.paintTemporaryTiles(c,a.images[a.indexOfDraggedImage]),a.$(".hoverImage").css("z-index","0").hide();for(var f=0;e>f;f++)(void 0===d[f]._custom_prop_id||-1!==d[f]._custom_prop_id.indexOf("null_")||null===d[f]._row_no||null===d[f]._col_no)&&(d.splice(f,1),e--,f--)},paintTemporaryTiles:function(a,b){for(var c=this,d=c.drawingCanvasScope.project.activeLayer.children,e=d.length,f=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile,g=0;g<a.length;g++){for(var h=a[g].tileCol*c.tileWidth-c.tileWidth/2,i=a[g].tileRow*c.tileHeight-c.tileHeight/2,j=0;e>j;j++)d[j]._row_no===a[g].tileRow&&d[j]._col_no===a[g].tileCol&&(d[j]._custom_prop_id="null_"+d[j]._custom_prop_id);c.drawingCanvasScope.activate();var k=new c.drawingCanvasScope.Raster(b);k._row_no=a[g].tileRow,k._col_no=a[g].tileCol,-1!==c.currentIndex?k._custom_prop_id=c.images[c.currentIndex]:f?k._custom_prop_id="null":k._custom_prop_id=c.images[c.indexOfDraggedImage],a[g].raster=k,k.position.x=h,k.position.y=i}c.getCount()},getCount:function(){for(var a,b=this,c=[],d=0;d<b.numberOfImages;d++)c[d]=0;if(-1!==b.currentIndex){var e=b.drawingCanvasScope.project.activeLayer.children;a=e.length;for(var f=0;a>f;f++)if(e[f].hasOwnProperty("_custom_prop_id"))for(var d=0;d<b.numberOfImages;d++)if(e[f]._custom_prop_id===b.images[d]){c[d]+=1;break}}else for(var g=b.collection,d=0;d<b.numberOfImages;d++){var h=g.where({imageIndex:d});c[d]=h.length}b.countArray=c,b.showCount(b.countArray),b.model.setCountArray(b.countArray)},showCount:function(a){var b=this;b.model.setCountArray(a)},replaceCurrentTileWithDraggedTile:function(a,b){var c=this,d={},e=[],f=c.drawingCanvasScope.project.activeLayer.children,g=f.length,h=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;d.tileRow=Math.round(b.position.top/c.tileHeight)+1,d.tileCol=Math.round(b.position.left/c.tileWidth)+1,e[0]=d,c.$(".hoverImage").css("z-index","0").hide();for(var i=0;g>i;i++)f[i]._row_no===c.hoveredTile.row&&f[i]._col_no===c.hoveredTile.col&&(f.splice(i,1),g--,i--);if(h){var j,k=$(b.draggable).attr("row"),l=$(b.draggable).attr("col"),m=parseFloat($(b.draggable).attr("index"));j=parseInt(k)===d.tileRow&&parseInt(l)===d.tileCol?null:$(".tileDragImage.ui-draggable[row='"+d.tileRow.toString()+"'][col='"+d.tileCol.toString()+"']")[0],null!==j&&$(j).remove(),c.$(b.draggable).attr("row",d.tileRow),c.$(b.draggable).attr("col",d.tileCol),c.$(b.draggable).css("left",(d.tileCol-1)*c.tileWidth+1+"px"),c.$(b.draggable).css("top",(d.tileRow-1)*c.tileHeight+1+"px"),c.collection.removeTile(k,l),c.collection.addTiles(e,m),c.$(b.draggable).css("background-image",'url("'+c.images[m]+'")'),c.getCount()}else{c.collection.removeTile(c.hoveredTile.row,c.hoveredTile.col),c.collection.addTiles(e,c.indexOfDraggedImage),c.paintTemporaryTiles(e,c.images[c.indexOfDraggedImage]),g=c.drawingCanvasScope.project.activeLayer.children.length;for(var i=0;g>i;i++)(void 0===f[i]._custom_prop_id||-1!==f[i]._custom_prop_id.indexOf("null_")||null===f[i]._row_no||null===f[i]._col_no)&&(f.splice(i,1),g--,i--)}c.isDropped=!0},copyTilesFromDrawingCanvasToGridCanvas:function(){var a=this,b=document.getElementById(a.interactivityName+"drawingCanvas"),c=b.getContext("2d"),d=document.getElementById(a.interactivityName+"gridCanvas"),e=d.getContext("2d"),f=c.getImageData(0,0,a.canvasWidth,a.canvasHeight);e.putImageData(f,0,0),c.clearRect(0,0,a.canvasWidth,a.canvasHeight)},renderGrid:function(){var a=this;a.drawingCanvasScope.project.activeLayer.removeChildren();for(var b=0;b<a.collection.length;b++)a.renderTile(a.collection.models[b]);a.updatePaperItems()},renderTile:function(a){this.drawingCanvasScope.activate();var b=this,c=a.get("imageIndex"),d=new b.drawingCanvasScope.Raster(b.images[c]);b.raster=d,d._row_no=a.get("tileRow"),d._col_no=a.get("tileCol"),d._custom_prop_id=b.images[c],d.position.x=a.get("tileCol")*b.tileWidth-b.tileWidth/2,d.position.y=a.get("tileRow")*b.tileHeight-b.tileHeight/2},setCurrentCanvasPaperScope:function(){this.drawingCanvasScope.activate()},attachEvents:function(){var a=this;$("#"+a.containmentDivId).off("mousemove").on("mousemove",$.proxy(a.onGridAreaParentMouseMove,a)),a.drawingCanvasTool.onMouseDrag=function(b){a.startPoint=b.point,a.drawRasterOnMouseDrag()},a.$el.on("keyup",function(b){var c=b.which||b.keyCode;9===c&&a.setCurrentCanvasPaperScope()})},attachMouseupEvent:function(){var a=this;$(window).off("mouseup.grid-area-window").on("mouseup.grid-area-window",$.proxy(a.populateCollectionOnMouseUp,a))},detachMouseupEvent:function(){$(window).off("mouseup.grid-area-window")},populateCollectionOnMouseUp:function(a){if(this.detachMouseupEvent(),-1!==this.currentIndex&&this.drawStarted&&("undefined"==typeof a||1===a.which)){var b=this,c=document.getElementById(b.interactivityName+"drawingCanvas"),d=c.getContext("2d"),e=document.getElementById(b.interactivityName+"gridCanvas"),f=e.getContext("2d"),g=d.getImageData(0,0,b.canvasWidth,b.canvasHeight),h=b.drawingCanvasScope.project.activeLayer.children,i=h.length;f.putImageData(g,0,0);for(var j=0;i>j;j++)(void 0===h[j]._custom_prop_id||-1!==h[j]._custom_prop_id.indexOf("null_"))&&(h.splice(j,1),i--,j--);b.collection.addTiles(b.selectedTilesArray,b.currentIndex),b.updatePaperItems(),d.clearRect(0,0,b.canvasWidth,b.canvasHeight),b.drawStarted=!1}},countCollections:function(a){this.renderTile(a)},removeTiles:function(a){},onGridAreaParentMouseMove:function(a){var b=this;if(b.currentIndex&&!b.isDragging){var c=document.elementFromPoint(a.clientX,a.clientY),d=$(c).parent();d&&d[0]!==this.$el[0]&&b.mouseLeaveFromHoverImage()}},setGridImage:function(a){this.$(".canvas-grid").css("background-image",'url("'+a+'")')},onCanvasGridClick:function(a){var b=this,c=a.target||a.srcElement,d=c.getBoundingClientRect(),e=a.clientX-d.left,f=a.clientY-d.top;b.attachMouseupEvent(),1===a.which&&(-1===b.currentIndex||b.startRasterDraw(e,f))},onCanvasGridMove:function(a){var b=this,c=a.target||a.srcElement,d=c.getBoundingClientRect(),e=a.clientX-d.left,f=a.clientY-d.top,g=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;b.startPoint={x:e,y:f},-1===b.currentIndex?g||b.showRasterHoverImage(e,f):b.drawRasterOnMouseDrag()},onCanvasGridMouseUp:function(){this.populateCollectionOnMouseUp()},repaintDraggedTile1:function(a){var b=this,c=[],d=$("#"+a.currentTarget.id).attr("row"),e=$("#"+a.currentTarget.id).attr("col"),f=MathInteractives.Common.Components.Models.GridArea.getTileId(d,e);tileModel=b.collection.get(f),tileModel&&(index=tileModel.get("imageIndex")),c[0]={tileRow:d,tileCol:e}},removeTileFromCanvas1:function(a,b){var c=this,d=document.getElementById(c.interactivityName+"gridCanvas"),e=d.getContext("2d"),f=document.getElementById(c.interactivityName+"drawingCanvas"),g=f.getContext("2d"),h=$("#"+a.currentTarget.id).attr("row"),i=$("#"+a.currentTarget.id).attr("col"),j=(i-1)*c.tileWidth,k=(h-1)*c.tileHeight;g.clearRect(j,k,c.tileWidth,c.tileHeight),e.clearRect(j,k,c.tileWidth,c.tileHeight)},showRasterHoverImage:function(a,b){var c,d,e=this;-1===e.currentIndex&&(e.isDragging||(c=Math.ceil(b/e.tileWidth),d=Math.ceil(a/e.tileWidth),e.showImageOnTile(c,d)))},showImageOnTile:function(a,b){var c,d=this,e=d.getIndexOfImageArray(a,b),f=MathInteractives.Common.Utilities.Models.Utils;if(d.indexOfDraggedImage=e,-1!==e){if(a===d.hoveredTile.row&&b===d.hoveredTile.col)return;d.hoveredTile.row=a,d.hoveredTile.col=b,c=d.hoverImages[e],
d.$(".hoverImage").css("background-image",'url("'+c+'")'),d.$(".hoverImage").css("left",d.tileWidth*(b-1)+"px"),d.$(".hoverImage").css("top",d.tileHeight*(a-1)+"px"),d.$(".hoverImage").show().css("z-index","1"),f.EnableTouch(this.$(".hoverImage"))}else d.hoveredTile.row=null,d.hoveredTile.col=null,d.$(".hoverImage").css("background-image",""),d.$(".hoverImage").css("z-index","0").hide()},getIndexOfImageArray:function(a,b){var c=this,d=MathInteractives.Common.Components.Models.GridArea.getTileId(a,b),e=-1,f=c.collection.get(d);return f&&(e=f.get("imageIndex")),e},mouseLeaveFromHoverImage:function(){var a=this;a.isDragging||(a.hoveredTile.row=null,a.hoveredTile.col=null,a.$(".hoverImage").css("z-index","0").hide(),a.$(".hoverImage").css("background-image",""))},onMouseEnterHoverImage:function(){this.$(".hoverImage").css("cursor","move")},calculate:function(){var a=this,b=a.getTilePosition(a.startPoint).col,c=a.getTilePosition(a.startPoint).row,d=a.getTilePosition(a.endPoint).col,e=a.getTilePosition(a.endPoint).row;if(c>e){var f=e;e=c,c=f}if(b>d){var f=d;d=b,b=f}},startRasterDraw:function(a,b){if(-1!==this.currentIndex){var c=this,d=c.images[c.currentIndex],e={};c.currentArray=[],c.startArray=[],c.selectedTilesArray=[],c.drawnTilesArray=[];var f=Math.ceil(b/c.tileHeight),g=Math.ceil(a/c.tileWidth);c.showHalfImage||f>c.canvasHeight/c.tileHeight&&(f=c.canvasHeight/c.tileHeight),1>f&&(f=1),c.showHalfImage||g>c.canvasWidth/c.tileWidth&&(g=c.canvasWidth/c.tileWidth),1>g&&(g=1),e.tileRow=f,e.tileCol=g,c.currentArray[0]=e,c.startArray[0]=e,c.selectedTilesArray[0]=e,this.model.set("selectedTilesArray",c.selectedTilesArray),c.drawnTilesArray[0]=e,c.paintTemporaryTiles(c.startArray,d),c.collection.addTiles(c.selectedTilesArray,c.currentIndex),c.drawStarted=!0}},drawRasterOnMouseDrag:function(){if(-1!==this.currentIndex&&this.drawStarted){var a,b=this,c=MathInteractives.Common.Components.Views.GridArea,d=b.images[b.currentIndex],e={},f=(this.model,b.startArray[0].tileRow),g=b.startArray[0].tileCol,h=b.getTilePosition(b.startPoint).row,i=b.getTilePosition(b.startPoint).col;if(b.showHalfImage||h>b.canvasHeight/b.tileHeight&&(h=b.canvasHeight/b.tileHeight),1>h&&(h=1),b.showHalfImage||i>b.canvasWidth/b.tileWidth&&(i=b.canvasWidth/b.tileWidth),1>i&&(i=1),h===b.currentArray[0].tileRow&&i===b.currentArray[0].tileCol)return void(1===i?(a="left",this.setCanvasText("reach-extreme-text","left"),1===h?a="top left":h===b.canvasHeight/b.tileHeight&&(a="bottom left")):i===b.canvasWidth/b.tileWidth?(a="right",this.setCanvasText("reach-extreme-text","right"),1===h?a="top right":h===b.canvasHeight/b.tileHeight&&(a="bottom right")):1===h?a="top":h===b.canvasHeight/b.tileHeight&&(a="bottom"));if(e.tileRow=h,e.tileCol=i,b.currentArray=[],b.currentArray[0]=e,b.startArray[0].tileRow>h){var j=f;f=h,h=j}if(b.startArray[0].tileCol>i){var j=g;g=i,i=j}b.selectedTilesArray=[];for(var k=0,l=f;h>=l;l++)for(var m=g;i>=m;m++)e={},e.tileRow=l,e.tileCol=m,b.selectedTilesArray.push(e),b.isNotErasable&&b.collection.addTiles([e],b.currentIndex),this.model.set("selectedTilesArray",b.selectedTilesArray),k++;f=b.startArray[0].tileRow,g=b.startArray[0].tileCol;var n=c.getDiffArray(b.drawnTilesArray,b.selectedTilesArray);if(!b.isNotErasable)var o=c.getDiffArray(b.selectedTilesArray,b.drawnTilesArray);n.length>0&&(b.paintTemporaryTiles(n,d),b.drawnTilesArray=b.drawnTilesArray.concat(n)),b.isNotErasable||o.length>0&&(b.removeTemporaryTiles(o,d),b.drawnTilesArray=c.getDiffArray(o,b.drawnTilesArray)),b.drawingCanvasScope.view.draw()}},removeTemporaryTiles:function(a,b){for(var c=this.drawingCanvasScope.project.activeLayer.children,d=0;d<a.length;d++){a[d].raster.remove();for(var e in c)if(c[e]._row_no===a[d].tileRow&&c[e]._col_no===a[d].tileCol&&-1!==c[e]._custom_prop_id.indexOf("null_")){var f=c[e]._custom_prop_id;f=f.replace("null_",""),c[e]._custom_prop_id=f}}this.getCount()},setCurrentIndex:function(a){var b=this,c=(b.images[b.currentIndex],MathInteractives.Common.Utilities.Models.Utils),d=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;if(b.prevIndex=b.currentIndex,b.currentIndex=a,-1===b.currentIndex){if(d){for(var e=0;e<b.collection.length;e++){var f=b.collection.models[e].get("tileRow"),g=b.collection.models[e].get("tileCol"),h=b.collection.models[e].get("imageIndex"),i=(g-1)*b.tileWidth,j=(f-1)*b.tileHeight,k=$("<div>",{id:"tileImage"+e,"class":"tileDragImage",row:f,col:g});this.$el.append(k),b.$("#tileImage"+e).attr("index",h),b.$("#tileImage"+e).css({position:"absolute",width:b.tileWidth-1+"px",height:b.tileHeight-1+"px",left:i+1+"px",top:j+1+"px","background-image":'url("'+b.images[h]+'")',"background-position":"-1px -1px"})}b.$(".tileDragImage").css("z-index","1"),c.EnableTouch(this.$(".tileDragImage"),{specificEvents:c.SpecificEvents.DRAGGABLE}),b.$(".tileDragImage").draggable({start:function(a,c){var d=b.$("#"+a.currentTarget.id).attr("index");b.isDragging=!0,b.isDropped=!1,b.$("#"+a.currentTarget.id).css("background-image",'url("'+b.hoverImages[d]+'")'),b.removeTileFromCanvas1(a,c)},stop:function(a,c){b.isDragging=!1;var d=b.$(c.helper).attr("index");b.$(c.helper).css("background-image",'url("'+b.images[d]+'")'),!b.isDropped},zIndex:2,containment:"#"+b.containmentDivId,revert:"invalid"})}}else if(d){b.$(".tileDragImage").remove();var l=document.getElementById(b.interactivityName+"drawingCanvas"),m=l.getContext("2d");m.clearRect(0,0,b.canvasWidth,b.canvasHeight),b.renderGrid()}},getCountArray:function(){return this.countArray},clearCanvasAndResetCounts:function(){for(var a=this,b=document.getElementById(a.interactivityName+"gridCanvas"),c=b.getContext("2d"),d=document.getElementById(a.interactivityName+"drawingCanvas"),e=d.getContext("2d"),f=1;f<=a.numberOfImages;f++)a.countArray[f-1]=0,$("."+a.showCountInId+f).text(a.countArray[f-1]);a.$(".tileDragImage").remove(),a.model.setCountArray(a.countArray),a.drawingCanvasScope.project.activeLayer.removeChildren(),a.collection.resetCollection(),a.hoverCanvasRaster=null,c.clearRect(0,0,a.canvasWidth,a.canvasHeight),e.clearRect(0,0,a.canvasWidth,a.canvasHeight)},deleteDraggedTile:function(a,b){for(var c=this,d=c.drawingCanvasScope.project.activeLayer.children,e=d.length,f=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile,g=0;e>g;g++)d[g]._row_no===c.hoveredTile.row&&d[g]._col_no===c.hoveredTile.col&&(d.splice(g,1),e--,g--);if(f){var h=$(b.draggable).attr("row"),i=$(b.draggable).attr("col"),j=parseFloat(c.$(b.draggable).attr("index"));c.collection.removeTile(h,i),c.$(b.draggable).remove(),c.countArray[j]--,$("."+c.showCountInId+(j+1)).text(c.countArray[j])}else c.$(".hoverImage").css("z-index","0").hide(),c.collection.removeTile(c.hoveredTile.row,c.hoveredTile.col),c.countArray[c.indexOfDraggedImage]--,$("."+c.showCountInId+(c.indexOfDraggedImage+1)).text(c.countArray[c.indexOfDraggedImage]);c.isDropped=!0},clearDrawingCanvas:function(){var a=this,b=document.getElementById(a.interactivityName+"drawingCanvas"),c=b.getContext("2d");c.clearRect(0,0,a.canvasWidth,a.canvasHeight)},getTilePosition:function(a){var b=Math.ceil(a.y/this.tileHeight),c=Math.ceil(a.x/this.tileWidth);return{row:b,col:c}},setCanvasText:function(a,b,c){var d=this.el.id;c=c||null,"undefined"!=typeof a&&(null!==c?(d=d.replace(this.idPrefix,""),this.setAccMessage(d,this.getAccMessage(a,c,b))):this.manager.setAccMessage(d,this.manager.getMessage(a,0,b)))},changeCanvasType:function(a){var b=this.drawingCanvasScope.project.activeLayer.children,c=b.length;"undefined"!=typeof a&&(this._canvasAcc.changeCanvasAccType(a),this.model.setCanvasType(a),this.canvasType=a),this.canvasType===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP&&0===c&&this.trigger(MathInteractives.Common.Components.Views.GridArea.ON_CANVAS_NO_ELEMENT_TO_DRAG)},accSpaceHandler:function(a,b){var c=this,d=b.point.x,e=b.point.y,f=MathInteractives.Common.Components.Views.GridArea;b.isExpand===!0?(c.startPoint={x:d,y:e},c.startRasterDraw(d,e),c.setCanvasText("selection-started"),c._canvasAcc.getFocusRect().bringToFront(),c.trigger(f.SELECTION_START_ON_SPACEBAR,c.selectedTilesArray)):(c.populateCollectionOnMouseUp(),c.setCanvasText("selection-ended"),c.trigger(f.SELECTION_END_ON_SPACEBAR,c.selectedTilesArray))},accFocusHandler:function(a,b){var c=MathInteractives.Common.Components.Views.GridArea;this.populateCollectionOnMouseUp(),this.setCanvasText(c.CANVAS_TO_DRAW_TEXT),this.trigger(c.FOCUS_OUT_OF_CANVAS)},accArrowHandler:function(a,b){var c=this,d=b.point,e=c.getTilePosition(d),f=d.x,g=d.y;this.model.set("currentTilePosition",e),b.isExpand===!0?(c.startPoint={x:f,y:g},c.setCanvasText("selection-extended-text",[e.col,e.row]),c.drawRasterOnMouseDrag(),c.trigger(MathInteractives.Common.Components.Views.GridArea.DRAW_IMAGE_ON_ARROW)):(c.setCanvasText("select-to-start-draw-text",[e.col,e.row]),c.trigger(MathInteractives.Common.Components.Views.GridArea.SPACEBAR_AND_ARROW_KEY_EVENT)),c._canvasAcc.getFocusRect().bringToFront()},accSpaceInDragHandler:function(a,b){if(!b.isDrag){var c,d,e,f=b.item._row_no,g=b.item._col_no,h=this.drawingCanvasScope.project.activeLayer.children,i=h.length,j=this.getTilePosition(this.navigatePoint).row,k=this.getTilePosition(this.navigatePoint).col;this.removeTileFromCanvas(g,f),this.$(".hoverImage").css("z-index","0").hide();for(var l=0;i>l;l++)h[l]._row_no===f&&h[l]._col_no===g&&(h.splice(l,1),i--,l--);e=this.getIndexOfImageArray(f,g),this.trigger(MathInteractives.Common.Components.Views.GridArea.ON_CANVAS_ELEMENT_DROP,e,this.tileToReplace),this.collection.removeTile(f,g),this.paintTemporaryTiles([{tileRow:j,tileCol:k}],this.images[this.indexOfDraggedImage]),this.collection.addTiles([{tileRow:j,tileCol:k}],this.indexOfDraggedImage),this.copyTilesFromDrawingCanvasToGridCanvas(),this.updatePaperItems(),this.getCount(),c=this._canvasAcc.getCurrentPaperItem()._row_no,d=this._canvasAcc.getCurrentPaperItem()._col_no,this.showImageOnTile(c,d),this.trigger(MathInteractives.Common.Components.Views.GridArea.ELEMENT_TO_START_DRAG,f,g,e)}},accFocusOutInDragHandler:function(a,b){this.$(".hoverImage").css("z-index","0").hide(),this.hoveredTile.row=null,this.hoveredTile.col=null,this.setCanvasText(MathInteractives.Common.Components.Views.GridArea.CANVAS_TO_DRAG_TEXT)},accArrowInDragHandler:function(a,b){var c,d=this.getTilePosition(b.point).row,e=this.getTilePosition(b.point).col;this.navigatePoint=b.point,c=this.getIndexOfImageArray(d,e),this.setCanvasText("navigate-to-drop-text",[d,e]),-1!==c?(this.trigger(MathInteractives.Common.Components.Views.GridArea.ELEMENT_PRESENT_ON_CANVAS_DRAG,d,e,c),this.tileToReplace=c):this.tileToReplace=null},accTabInDragHandler:function(a,b){var c=b.item._row_no,d=b.item._col_no,e=this.getIndexOfImageArray(c,d);this.showImageOnTile(c,d),this.trigger(MathInteractives.Common.Components.Views.GridArea.ELEMENT_TO_START_DRAG,c,d,e)},updatePaperItems:function(a,b){var c=this.drawingCanvasScope.project.activeLayer.children,d=c.length,e=[];if("undefined"!=typeof this._canvasAcc){for(var f=0;d>f;f++)"undefined"!=typeof c[f]._custom_prop_id&&-1===c[f]._custom_prop_id.indexOf("null_")&&e.push(c[f]);this._canvasAcc.updatePaperItems(e)}}},{getDiffArray:function(a,b){for(var c,d=[],e=0;e<b.length;e++){c=0;for(var f=0;f<a.length;f++)(b[e].tileRow!==a[f].tileRow||b[e].tileCol!==a[f].tileCol)&&c++;c===a.length&&d.push(b[e])}return d},CANVAS_TO_DRAG_TEXT:"canvas-to-drag-text",CANVAS_TO_DRAW_TEXT:"canvas-to-draw-text",ON_CANVAS_ELEMENT_DROP:"canvas-element-dropped",ELEMENT_PRESENT_ON_CANVAS_DRAG:"canvas-element-present",TILE_ADDED_TEXT:"tile-added-text",TILE_REPLACED_TEXT:"tile-replaced-text",TILE_ALREADY_PRESENT_TEXT:"tile-present-text",TILE_TO_DRAG_TEXT:"tile-to-drag-text",ON_CANVAS_NO_ELEMENT_TO_DRAG:"no-element-to-drag-text",ELEMENT_TO_START_DRAG:"element-to-start-drag-text",SELECTION_START_ON_SPACEBAR:"selection-start-on-space-click",SELECTION_END_ON_SPACEBAR:"selection-end-on-space-click",DRAW_IMAGE_ON_ARROW:"image-is-draw-on-arrow",SPACEBAR_AND_ARROW_KEY_EVENT:"spacebar-on-parent-of-canvas",FOCUS_OUT_OF_CANVAS:"focus-out-from-canvas"})}(),function(){"use strict";MathInteractives.Common.Components.Views.ScoreMeter=Backbone.View.extend({initialize:function(a){var b='<div class="de-mathematics-interactive-score-meter"><div class="score-meter-base"></div><div class="score-meter-value"></div><div class="score-meter-grids-mask"></div></div>';this.$el.html(b);for(var c="",d=0;10>d;d++)c+='<div class="score-box"></div>';var e=this.$el.find(".score-meter-grids-mask");e.append(c);var f=this.$el.find(".score-box"),g=parseFloat(f.css("border-left-width"))+parseFloat(f.css("border-right-width"))+parseFloat(f.css("margin-right"))+parseFloat(f.css("margin-left"));f.width(e.width()/10-g)},loadScore:function(a){var b=this.$el.find(".score-box"),c=10*b.width()*a;this.$el.find(".score-meter-value").width(c+"px");var d=this.$el.find(".score-meter-value").width();if(d>b.width()){var e=d/b.width(),f=parseFloat(b.css("border-left-width"))+parseFloat(b.css("border-right-width"))+parseFloat(b.css("margin-right"))+parseFloat(b.css("margin-left"));d+=f*Math.floor(e),this.$el.find(".score-meter-value").width(d+"px"),this.$el.find(".score-meter-value").width()>=this.$el.width()&&this.$el.find(".score-meter-value").width(d-f+"px")}}},{}),MathInteractives.global.ScoreMeter=MathInteractives.Common.Components.Views.ScoreMeter}(),function(){"use strict";MathInteractives.Common.Components.Views.LocalInstruction=MathInteractives.Common.Player.Views.Base.extend({$localInstruction:null,filePath:null,idPrefix:null,initialize:function(){this.filePath=this.model.get("path"),this.idPrefix=this.model.get("idPrefix"),this.manager=this.model.get("manager"),this.player=this.model.get("player"),this.render()},render:function(){var a,b,c,d,e;d=this.model.getId(),this.$localInstruction=this.$el.addClass("local-instructions"),a=$("<div>",{"class":"local-instruction-left"}).appendTo(this.$el).css({"background-image":'url("'+this.filePath.getImagePath("player-lr")+'")'}),b=$("<div>",{"class":"local-instruction-mid"}).appendTo(this.$el).css({"background-image":'url("'+this.filePath.getImagePath("player-m")+'")'}),c=$("<div>",{"class":"local-instruction-right"}).appendTo(this.$el).css({"background-image":'url("'+this.filePath.getImagePath("player-lr")+'")'}),$("<div>",{id:d+"-instruction","class":"text-div"}).appendTo(this.$el),$("<div>",{id:d+"-tts-div"}).appendTo(this.$el).css({position:"absolute",right:"10px"}).addClass("instruction-bar-tts-div"),e={idPrefix:this.idPrefix,manager:this.manager,containerId:d+"-tts-div",messagesToPlay:[d+"-instruction"],path:this.filePath,player:this.player},this.ttsView=MathInteractives.global.PlayerTTS.generateTTS(e),this.showLocalInstruction()},showLocalInstruction:function(){this.$localInstruction.show(),this.loadScreen(this.model.getScreenId());var a=this.model.getId()+"-instruction",b=a.slice(this.idPrefix.length,a.length),c=this.model.getId()+"-tts-div";c.slice(this.idPrefix.length,c.length);this.ttsView.renderTTSAccessibility(this.getTabIndex(b)+2)},hideLocalInstruction:function(){MathInteractives.global.SpeechStream.stopReading(),this.unloadScreen(this.model.getScreenId()),this.$localInstruction.hide()}},{generateLocalInstruction:function(a){if(a){var b,c,d;return b="#"+a.id,c=new MathInteractives.Common.Components.Models.LocalInstruction(a),d=new MathInteractives.Common.Components.Views.LocalInstruction({el:b,model:c})}}}),MathInteractives.global.LocalInstruction=MathInteractives.Common.Components.Views.LocalInstruction}(),function(){"use strict";MathInteractives.Common.Components.Models.LocalInstruction=Backbone.Model.extend({defaults:function(){return{id:"",screenId:null}},getId:function(){return this.get("id")},setId:function(a){this.set("id",a)},getScreenId:function(){return this.get("screenId")},setScreenId:function(a){this.get("screenId",a)}})}(),function(){"use strict";MathInteractives.Common.Components.Views.CustomSpinner=MathInteractives.Common.Player.Views.Base.extend({manager:null,spinBoxId:null,_path:null,screenId:null,idPrefix:null,player:null,minValue:null,maxValue:null,stepValue:null,spinValue:null,spinnerHeight:null,spinnerWidth:null,spinSign:!1,upBtn:null,downBtn:null,disableSpin:!1,previousValue:"",currentValue:"",isEditable:!1,alignType:!1,inputType:null,inputPrecision:null,maxCharLength:null,inputRegEx:null,spinnerTextbox:null,emptySpinnerPlaceHolderValues:null,defaultAllPlaceHolderValues:null,minLimitAllPlaceHolderValues:null,maxLimitAllPlaceHolderValues:null,onDecreaseAllPlaceHolderValues:null,onIncreaseAllPlaceHolderValues:null,btnInterval:null,isFocusedPress:!1,initialize:function(){var a=this.model;this.manager=a.getManager(),this.player=a.getPlayer(),this.idPrefix=a.getIdPrefix(),this.spinBoxId=a.getSpinId(),this.minValue=a.getMinValue(),this.maxValue=a.getMaxValue(),this.stepValue=a.getStepValue(),this.spinValue=a.getValue(),this.spinnerHeight=a.getHeight(),this.spinnerWidth=a.getWidth(),this.spinSign=a.getShowSign(),this.screenId=a.getScreenId(),this._path=a.getPath(),this.alignType=a.getAlignType(),this.isEditable=a.getIsEditable(),this.inputType=a.getInputType(),this.inputPrecision=a.getInputPrecision(),this.maxCharLength=a.getMaxCharLength(),this.inputRegEx=a.getInputRegEx(),this.currentValue=this.spinValue,this.previousValue=this.currentValue,this.loadScreen("spinner-acc-text-screen"),"%@$%"===a.getEmptySpinnerAccText()&&this.setEmptySpinnerAcc(this.getAccMessage("empty-spinner-acc-text",0)),this.emptySpinnerPlaceHolderValues=[],this.defaultAllPlaceHolderValues=[],this.minLimitAllPlaceHolderValues=[],this.maxLimitAllPlaceHolderValues=[],this.onDecreaseAllPlaceHolderValues=[],this.onIncreaseAllPlaceHolderValues=[],this._setPlaceHolderValues(a.getEmptySpinnerPlaceHolders(),this.emptySpinnerPlaceHolderValues),this._setPlaceHolderValues(a.getDefaultPlaceHolders(),this.defaultAllPlaceHolderValues),this._setPlaceHolderValues(a.getMinLimitPlaceHolders(),this.minLimitAllPlaceHolderValues),this._setPlaceHolderValues(a.getMaxLimitPlaceHolders(),this.maxLimitAllPlaceHolderValues),this._setPlaceHolderValues(a.getOnDecreasePlaceHolders(),this.onDecreaseAllPlaceHolderValues),this._setPlaceHolderValues(a.getOnIncreasePlaceHolders(),this.onIncreaseAllPlaceHolderValues),null===this.alignType&&(this.alignType=MathInteractives.global.CustomSpinner.CENTER_ALIGN);var b={spinBoxId:this.spinBoxId},c=MathInteractives.Common.Components.templates.customSpin(b);this._render(c),this._setAlignments()},_render:function(a){var b,c=(this.$(".spin-down-arrow"),this);this.$el.append(a.trim()),this.isEditable&&(b={containerId:this.spinBoxId+"-text",filePath:this._path,manager:this.manager,player:this.player,idPrefix:this.idPrefix,inputType:this.inputType,customClass:"spinner-input-box",precision:this.inputPrecision,maxCharLength:this.maxCharLength},this.inputType===MathInteractives.global.InputBox.INPUT_TYPE_CUSTOM&&(b.regexString=this.inputRegEx),this.spinnerTextbox=MathInteractives.global.InputBox.createInputBox(b),this.$(".spin-textbox,.spin-down-arrow,.spin-up-arrow").addClass("editable-textbox"),this.spinnerTextbox.on(this.spinBoxId+"-text"+MathInteractives.Common.Components.Views.InputBox.CUSTOM_CHANGE_EVENT_NAME,$.proxy(c._spinBoxInputKeyPress,c))),this.$(".spinbox,.spin-textbox,.spin-down-arrow,.spin-up-arrow").addClass(this.alignType+"-aligned"),this.alignType===MathInteractives.global.CustomSpinner.TOP_ALIGN?($(this.$(".spin-down-arrow").parent()).append(this.$(".spin-down-arrow")),$(this.$(".spin-up-arrow").parent()).append(this.$(".spin-up-arrow"))):this.alignType===MathInteractives.global.CustomSpinner.LEFT_ALIGN&&$(this.$(".spin-down-arrow").parent()).append(this.$(".spin-down-arrow")),this.createAccDiv(this.model.getTextAccObj()),this.setAccMessage(this.model.getTextAccId(),this.model.getDefaultAccText(),this.defaultAllPlaceHolderValues),this.focusOut(this.model.getTextAccId(),function(){c.isEditable||c.setAccMessage(c.model.getTextAccId(),c.model.getDefaultAccText(),c.defaultAllPlaceHolderValues)})},_setPlaceHolderValues:function(a,b){this._setPlaceHolderValue(a,MathInteractives.global.CustomSpinner.PREV_VAL,b,Number(this.previousValue)),this._setPlaceHolderValue(a,MathInteractives.global.CustomSpinner.CURR_VAL,b,Number(this.currentValue)),this._setPlaceHolderValue(a,MathInteractives.global.CustomSpinner.MIN_VAL,b,Number(this.minValue)),this._setPlaceHolderValue(a,MathInteractives.global.CustomSpinner.MAX_VAL,b,Number(this.maxValue)),this.isEditable&&this._setPlaceHolderValue(a,MathInteractives.global.CustomSpinner.CURR_VAL,b,Number(this.$(".spinbox .spinner-input-box").val()))},_setPlaceHolderValue:function(a,b,c,d){var e=a.indexOf(b);e>=0&&(c[e]=d)},_setAlignments:function(){var a=this,b=this.$el.find(".spin-up-arrow"),c=this.$el.find(".spin-down-arrow");this._generateButtons(),this.setSpinBoxValue(this.spinValue),null===this.spinValue&&this.$(".spinner-input-box").val(MathInteractives.global.CustomSpinner.DEFAULT_VALUE);var d=0,e=0;clearInterval(d),clearInterval(e),c.mousedown(function(){clearInterval(a.btnInterval),a.downBtn.getButtonState()!=MathInteractives.global.Button.BUTTON_STATE_DISABLED?(a.$el.find(".spin-down-arrow").unbind("click"),(void 0!==event&&"undefined"!=typeof event.which&&1===event.which||MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile)&&(a.btnInterval=setInterval($.proxy(a.spinDownArrowClick,a),500))):a.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(a.spinDownArrowClick,a))}).on("touchstart",function(){clearInterval(a.btnInterval),a.downBtn.getButtonState()!=MathInteractives.global.Button.BUTTON_STATE_DISABLED?(a.$el.find(".spin-down-arrow").unbind("click"),a.btnInterval=setInterval($.proxy(a.spinDownArrowClick,a),500)):a.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(a.spinDownArrowClick,a))}).mouseup(function(){clearInterval(a.btnInterval),a.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(a.spinDownArrowClick,a))}).mouseout(function(){clearInterval(a.btnInterval),a.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(a.spinDownArrowClick,a))}).on("touchend",function(){clearInterval(a.btnInterval),a.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(a.spinDownArrowClick,a))}),b.mousedown(function(){clearInterval(a.btnInterval),a.upBtn.getButtonState()!=MathInteractives.global.Button.BUTTON_STATE_DISABLED?(a.$el.find(".spin-up-arrow").unbind("click"),a.btnInterval=setInterval($.proxy(a.spinUpArrowClick,a),500)):a.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(a.spinUpArrowClick,a))}).on("touchstart",function(){clearInterval(a.btnInterval),a.upBtn.getButtonState()!=MathInteractives.global.Button.BUTTON_STATE_DISABLED?(a.$el.find(".spin-up-arrow").unbind("click"),a.btnInterval=setInterval($.proxy(a.spinUpArrowClick,a),500)):a.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(a.spinUpArrowClick,a))}).mouseup(function(){clearInterval(a.btnInterval),a.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(a.spinUpArrowClick,a))}).mouseout(function(){clearInterval(a.btnInterval),a.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(a.spinUpArrowClick,a))}).on("touchend",function(){clearInterval(a.btnInterval),a.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(a.spinUpArrowClick,a))})},_generateButtons:function(){var a=this.model,b=a.getUpArrowAccText(),c=a.getDownArrowAccText();b=null!==b?b:this.getAccMessage("up-arrow-acc-text",0),c=null!==c?c:this.getAccMessage("down-arrow-acc-text",0),a.setUpArrowAccText(b),a.setDownArrowAccText(c);var d={id:this.spinBoxId+"-up-arrow",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION_ZOOM_IN,width:32,path:this._path};this.upBtn=MathInteractives.global.Button.generateButton(d);var e={id:this.spinBoxId+"-down-arrow",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION_ZOOM_OUT,width:32,path:this._path};this.downBtn=MathInteractives.global.Button.generateButton(e),this.$(".spin-down-arrow .button-icon").addClass("spinner-minus-btn"),this.$(".spin-up-arrow .button-icon").addClass("spinner-plus-btn"),a.setButtonAccText(),this.createAccDiv(a.getUpArrowAccObj()),this.createAccDiv(a.getDownArrowAccObj())},setSpinBoxValue:function(a){var b=this,c=b.minValue,d=b.maxValue;b.spinSign,this.spinBoxId;a>=c&&d>=a&&!this.disableSpin&&(this.currentValue=this.spinSign?b.getSpinBoxSignValue(a):a,this.isEditable?null===this.currentValue?(this.$(".spinner-input-box").val(MathInteractives.global.CustomSpinner.DEFAULT_VALUE),this.setAccMessage(this.model.getTextAccId(),this.model.getEmptySpinnerAccText(),this.emptySpinnerPlaceHolderValues)):this.$(".spinner-input-box").val(this.currentValue):this.setMessage(this.screenId+"-text",this.currentValue),c==a?(this.upBtn.getButtonState()!==MathInteractives.global.Button.BUTTON_STATE_ACTIVE&&this._enableBtn(this.upBtn,this.model.getUpArrowAccId()),this._disableBtn(this.downBtn,this.model.getDownArrowAccId()),this.$el.find(".spin-down-arrow").unbind("click"),this.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(this.spinUpArrowClick,this))):d==a?(this._disableBtn(this.upBtn,this.model.getUpArrowAccId()),this.downBtn.getButtonState()!==MathInteractives.global.Button.BUTTON_STATE_ACTIVE&&this._enableBtn(this.downBtn,this.model.getDownArrowAccId()),this.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(this.spinDownArrowClick,this)),this.$el.find(".spin-up-arrow").unbind("click")):(this.upBtn.getButtonState()!==MathInteractives.global.Button.BUTTON_STATE_ACTIVE&&this._enableBtn(this.upBtn,this.model.getUpArrowAccId()),this.downBtn.getButtonState()!==MathInteractives.global.Button.BUTTON_STATE_ACTIVE&&this._enableBtn(this.downBtn,this.model.getDownArrowAccId()),this.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(this.spinDownArrowClick,this)),this.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(this.spinUpArrowClick,this))))},getSpinBoxValue:function(){var a=this.currentValue;return null!=a&&void 0!=a?Number(a):null},enableSpinBox:function(){var a=(this.$el.find(".spin-textbox"),this.$el.find(".spin-up-arrow"),this.$el.find(".spin-down-arrow"),this.getSpinBoxValue()),b=this.minValue,c=this.maxValue;Number(this.currentValue);this.$el.removeClass("disabled"),this.$(".spin-textbox").removeClass("disabled-spin-box"),this.isEditable&&this.$(".spinner-input-box").removeAttr("disabled"),a>b&&this._enableBtn(this.downBtn,this.model.getDownArrowAccId()),c>a&&this._enableBtn(this.upBtn,this.model.getUpArrowAccId()),this.disableSpin=!1,this.enableTab(this.model.getTextAccId(),!0),this.setSpinBoxValue(this.currentValue),MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile&&(this.$el.find(".spin-down-arrow-touch").unbind("click").bind("click",function(){this.$el.find(".spin-down-arrow").trigger("click")}),this.$el.find(".spin-up-arrow-touch").unbind("click").bind("click",function(){this.$el.find(".spin-up-arrow").trigger("click")}))},disableSpinBox:function(){this.$el.addClass("disabled"),this.disableSpin=!0,this._disableBtn(this.upBtn,this.model.getUpArrowAccId()),this._disableBtn(this.downBtn,this.model.getDownArrowAccId()),this.$(".spin-textbox").addClass("disabled-spin-box"),this.isEditable&&this.$(".spinner-input-box").attr("disabled","disabled"),this.enableTab(this.model.getTextAccId(),!1),MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile&&(this.$el.find(".spin-down-arrow-touch").unbind("click"),this.$el.find(".spin-up-arrow-touch").unbind("click"))},getSpinBoxSignValue:function(a){return a>=0?"+"+a:a},spinUpArrowClick:function(){if("disabled"!==this.upBtn.getButtonState()){var a,b=this.maxValue,c=this.stepValue,d=Number(this.currentValue),e=this.spinSign;if(MathInteractives.global.SpeechStream.stopReading(),this.isEditable&&(this.validateInputValue(this.$(".spinner-input-box").val()),d=Number(this.currentValue)),d>b&&(d=b-1),this._enableBtn(this.downBtn,this.model.getDownArrowAccId()),b>d){var f=Number(d)+Number(c);null!==this.inputPrecision&&(f=f.toFixed(this.inputPrecision),a=String(f).split("."),0===Number(a[1])&&(f=parseInt(f))),this.previousValue=this.currentValue,this.currentValue=e?this.getSpinBoxSignValue(f):f,this.validateInputValue(this.currentValue),this.isEditable&&this.$(".spinner-input-box").val(this.currentValue)}this._setPlaceHolderValue(this.model.getDefaultPlaceHolders(),MathInteractives.global.CustomSpinner.PREV_VAL,this.defaultAllPlaceHolderValues,Number(this.previousValue)),this._setPlaceHolderValue(this.model.getDefaultPlaceHolders(),MathInteractives.global.CustomSpinner.CURR_VAL,this.defaultAllPlaceHolderValues,Number(this.currentValue)),this._setPlaceHolderValue(this.model.getOnIncreasePlaceHolders(),MathInteractives.global.CustomSpinner.PREV_VAL,this.onIncreaseAllPlaceHolderValues,Number(this.previousValue)),this._setPlaceHolderValue(this.model.getOnIncreasePlaceHolders(),MathInteractives.global.CustomSpinner.CURR_VAL,this.onIncreaseAllPlaceHolderValues,Number(this.currentValue)),this.setAccMessage(this.model.getTextAccId(),this.model.getOnIncreaseAccText(),this.onIncreaseAllPlaceHolderValues),d==b-1&&(this._disableBtn(this.upBtn,this.model.getUpArrowAccId()),clearInterval(this.btnInterval),this.$el.find(".spin-up-arrow").unbind("click"),this.setAccMessage(this.model.getTextAccId(),this.model.getMaxLimitAccText(),this.maxLimitAllPlaceHolderValues)),this.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(this.spinDownArrowClick,this)),this.trigger(MathInteractives.global.CustomSpinner.VALUE_CHANGED,{actionPerformed:MathInteractives.global.CustomSpinner.BUTTON_CLICK}),this.model.setButtonState("active"),this.setFocus(this.screenId+"-text")}},spinDownArrowClick:function(){if("disabled"!==this.downBtn.getButtonState()){var a,b=this.minValue,c=this.stepValue,d=Number(this.currentValue),e=this.spinSign;MathInteractives.global.SpeechStream.stopReading(),this.isEditable&&(this.validateInputValue(this.$(".spinner-input-box").val()),d=Number(this.currentValue)),b>d&&(d=b+1),this._enableBtn(this.upBtn,this.model.getUpArrowAccId()),d>b&&(this.previousValue=this.currentValue,this.currentValue=e?this.getSpinBoxSignValue(d-c):d-c,null!==this.inputPrecision&&(this.currentValue=this.currentValue.toFixed(this.inputPrecision),a=String(this.currentValue).split("."),0===parseInt(a[1])&&(this.currentValue=parseInt(this.currentValue))),this.validateInputValue(this.currentValue),this.isEditable?this.$(".spinner-input-box").val(this.currentValue):this.setMessage(this.screenId+"-text",this.currentValue)),this._setPlaceHolderValue(this.model.getDefaultPlaceHolders(),MathInteractives.global.CustomSpinner.PREV_VAL,this.defaultAllPlaceHolderValues,Number(this.previousValue)),this._setPlaceHolderValue(this.model.getDefaultPlaceHolders(),MathInteractives.global.CustomSpinner.CURR_VAL,this.defaultAllPlaceHolderValues,Number(this.currentValue)),this._setPlaceHolderValue(this.model.getOnDecreasePlaceHolders(),MathInteractives.global.CustomSpinner.PREV_VAL,this.onDecreaseAllPlaceHolderValues,Number(this.previousValue)),this._setPlaceHolderValue(this.model.getOnDecreasePlaceHolders(),MathInteractives.global.CustomSpinner.CURR_VAL,this.onDecreaseAllPlaceHolderValues,Number(this.currentValue)),this.setAccMessage(this.model.getTextAccId(),this.model.getOnDecreaseAccText(),this.onDecreaseAllPlaceHolderValues),d===b+1&&(this._disableBtn(this.downBtn,this.model.getDownArrowAccId()),clearInterval(this.btnInterval),this.$el.find(".spin-down-arrow").unbind("click"),this.setAccMessage(this.model.getTextAccId(),this.model.getMinLimitAccText(),this.minLimitAllPlaceHolderValues)),this.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(this.spinUpArrowClick,this)),this.trigger(MathInteractives.global.CustomSpinner.VALUE_CHANGED,{actionPerformed:MathInteractives.global.CustomSpinner.BUTTON_CLICK}),this.model.setButtonState("active"),this.setFocus(this.screenId+"-text")}},_enableBtn:function(a,b){a.setButtonState(MathInteractives.global.Button.BUTTON_STATE_ACTIVE),
null!==b&&"undefined"!==b&&this.enableTab(b,!0)},_disableBtn:function(a,b){a.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),null!==b&&"undefined"!==b&&this.enableTab(b,!1)},events:{"focusout .spinbox .spinner-input-box":"_spinBoxInputFocusOut","focusin .spinbox .spinner-input-box":"_spinBoxInputFocusIn"},_spinBoxInputFocusOut:function(){var a,b=this.$(".spinner-input-box");a=b.val(),""!==a?(a=Number(a),this.spinValue=a,isNaN(a)?this.setAccMessage(this.model.getTextAccId(),this.model.getEmptySpinnerAccText(),this.emptySpinnerPlaceHolderValues):(this._setPlaceHolderValues(this.model.getDefaultPlaceHolders(),this.defaultAllPlaceHolderValues),this.setAccMessage(this.model.getTextAccId(),this.model.getDefaultAccText(),this.defaultAllPlaceHolderValues))):(this.spinValue=null,a=this.spinValue,this.validateInputValue(a),this.setAccMessage(this.model.getTextAccId(),this.model.getEmptySpinnerAccText(),this.emptySpinnerPlaceHolderValues)),this.trigger(MathInteractives.global.CustomSpinner.VALUE_CHANGED,{actionPerformed:MathInteractives.global.CustomSpinner.FOCUS_OUT})},_spinBoxInputFocusIn:function(a){var b=(a.which||a.keyCode,this.$("#"+a.currentTarget.id));this.isFocusedPress=!0,b.val()===MathInteractives.global.CustomSpinner.DEFAULT_VALUE&&b.val("")},_spinBoxInputKeyPress:function(a){var b=a.which||a.keyCode,c=this.$("#"+a.currentTarget.id),d=c.val();d<=this.minValue?(this._enableBtn(this.upBtn,this.model.getUpArrowAccId()),this.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(this.spinUpArrowClick,this)),this._disableBtn(this.downBtn,this.model.getDownArrowAccId()),this.$el.find(".spin-down-arrow").unbind("click")):d>=this.maxValue?(this._disableBtn(this.upBtn,this.model.getUpArrowAccId()),this.$el.find(".spin-up-arrow").unbind("click"),this._enableBtn(this.downBtn,this.model.getDownArrowAccId()),this.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(this.spinDownArrowClick,this))):(this._enableBtn(this.upBtn,this.model.getUpArrowAccId()),this.$el.find(".spin-up-arrow").unbind("click").bind("click",$.proxy(this.spinUpArrowClick,this)),this._enableBtn(this.downBtn,this.model.getDownArrowAccId()),this.$el.find(".spin-down-arrow").unbind("click").bind("click",$.proxy(this.spinDownArrowClick,this))),this.isFocusedPress&&(this.isFocusedPress=!1,b===$.ui.keyCode.ENTER)||this.trigger(MathInteractives.global.CustomSpinner.VALUE_CHANGED,{actionPerformed:MathInteractives.global.CustomSpinner.KEY_PRESS,keyCode:b})},validateInputValue:function(a){var b;null!==this.minValue&&null!==this.maxValue?b=a<this.minValue?this.minValue:a>this.maxValue?this.maxValue:a:null!==this.minValue?b=a<this.minValue?this.minValue:a:null!==this.maxValue&&(b=a>this.maxValue?this.maxValue:a),this.setSpinBoxValue(b)},setFocusOnSpinner:function(){this.setFocus(this.model.getTextAccId(),10)},setEmptySpinnerAcc:function(a,b){null!==a&&"undefined"!=typeof a&&this.model.setEmptySpinnerAccText(a),null!==b&&"undefined"!=typeof b&&this.model.setEmptySpinnerPlaceHolders(b)},getUpButtonState:function(){return this.upBtn.getButtonState()},getDownButtonState:function(){return this.downBtn.getButtonState()},getModel:function(){return this.model},setDefaultAcc:function(a,b){null!==a&&"undefined"!=typeof a&&this.model.setDefaultAccText(a),null!==b&&"undefined"!=typeof b&&this.model.setDefaultPlaceHolders(b)},setMinLimitAcc:function(a,b){null!==a&&"undefined"!=typeof a&&this.model.setMinLimitAccText(a),null!==b&&"undefined"!=typeof b&&this.model.setMinLimitPlaceHolders(b)},setMaxLimitAcc:function(a,b){null!==a&&"undefined"!=typeof a&&this.model.setMaxLimitAccText(a),null!==b&&"undefined"!=typeof b&&this.model.setMaxLimitPlaceHolders(b)},setOnDecreaseAcc:function(a,b){null!==a&&"undefined"!=typeof a&&this.model.setOnDecreaseAccText(a),null!==b&&"undefined"!=typeof b&&this.model.setOnDecreasePlaceHolders(b)},setOnIncreaseAcc:function(a,b){null!==a&&"undefined"!=typeof a&&this.model.setOnIncreaseAccText(a),null!==b&&"undefined"!=typeof b&&this.model.setOnIncreasePlaceHolders(b)},setUpArrowAccText:function(a){null!==a&&"undefined"!=typeof a&&this.model.setUpArrowAccText(a)},setDownArrowAccText:function(a){null!==a&&"undefined"!=typeof a&&this.model.setDownArrowAccText(a)}},{generateCustomSpinner:function(a){if(a){var b=new MathInteractives.Common.Components.Models.CustomSpinner(a),c=new MathInteractives.Common.Components.Views.CustomSpinner({model:b,el:"#"+a.spinId});return c}},VALUE_CHANGED:"value-changed",BUTTON_CLICK:"button-click",FOCUS_OUT:"focus-out",KEY_PRESS:"key-press",DEFAULT_VALUE:"---",CENTER_ALIGN:"center",TOP_ALIGN:"top",LEFT_ALIGN:"left",PREV_VAL:"prev_val",CURR_VAL:"curr_val",MIN_VAL:"min_val",MAX_VAL:"max_val"}),MathInteractives.global.CustomSpinner=MathInteractives.Common.Components.Views.CustomSpinner}(),function(){"use strict";MathInteractives.Common.Components.Models.CustomSpinner=Backbone.Model.extend({defaults:function(){return{spinId:null,manager:null,path:null,screenId:null,idPrefix:null,height:35,width:50,minValue:-10,maxValue:10,value:null,step:1,showSign:!1,buttonState:"disabled",isEditable:!1,inputPrecision:null,maxCharLength:4,alignType:null,inputType:null,inputRegEx:null,emptySpinnerAccText:null,defaultAccText:null,minLimitAccText:null,maxLimitAccText:null,onIncreaseAccText:null,onDecreaseAccText:null,emptySpinnerPlaceHolders:null,defaultPlaceHolders:null,minLimitPlaceHolders:null,maxLimitPlaceHolders:null,onIncreasePlaceHolders:null,onDecreasePlaceHolders:null,upArrowAccText:null,downArrowAccText:null,textAccId:null,upArrowAccId:null,downArrowAccId:null,tabIndex:0,upArrowTabIndex:2,downArrowTabIndex:4,textAccObj:null,upArrowAccObj:null,downArrowAccObj:null}},initialize:function(){var a=null;null===this.get("emptySpinnerAccText")&&this.setEmptySpinnerAccText("%@$%"),null===this.get("defaultAccText")&&this.setDefaultAccText("%@$%"),null===this.get("minLimitAccText")&&this.setMinLimitAccText("%@$%"),null===this.get("maxLimitAccText")&&this.setMaxLimitAccText("%@$%"),null===this.get("onIncreaseAccText")&&this.setOnIncreaseAccText("%@$%"),null===this.get("onDecreaseAccText")&&this.setOnDecreaseAccText("%@$%"),null===this.get("emptySpinnerPlaceHolders")&&this.setEmptySpinnerPlaceHolders([MathInteractives.global.CustomSpinner.MIN_VAL,MathInteractives.global.CustomSpinner.MAX_VAL]),null===this.get("defaultPlaceHolders")&&this.setDefaultPlaceHolders([MathInteractives.global.CustomSpinner.CURR_VAL]),null===this.get("minLimitPlaceHolders")&&this.setMinLimitPlaceHolders([MathInteractives.global.CustomSpinner.MIN_VAL]),null===this.get("maxLimitPlaceHolders")&&this.setMaxLimitPlaceHolders([MathInteractives.global.CustomSpinner.MAX_VAL]),null===this.get("onIncreasePlaceHolders")&&this.setOnIncreasePlaceHolders([MathInteractives.global.CustomSpinner.CURR_VAL]),null===this.get("onDecreasePlaceHolders")&&this.setOnDecreasePlaceHolders([MathInteractives.global.CustomSpinner.CURR_VAL]),this.setScreenId(this.getSpinId().replace(this.getIdPrefix(),"")),this._setTextAccId(this.getScreenId()+"-text"),this._setTabIndex(this.getTabIndex()),a={elementId:this.getTextAccId(),tabIndex:this.getTabIndex(),acc:this.getDefaultAccText()},this._setTextAccObj(a)},setButtonAccText:function(){var a=null,b=null;this._setUpArrowAccId(this.getScreenId()+"-up-arrow"),this._setDownArrowAccId(this.getScreenId()+"-down-arrow"),this._setUpArrowTabIndex(this.getTabIndex()+2),this._setDownArrowTabIndex(this.getUpArrowTabIndex()+2),a={elementId:this.getUpArrowAccId(),tabIndex:this.getUpArrowTabIndex(),acc:this.getUpArrowAccText(),role:"button"},b={elementId:this.getDownArrowAccId(),tabIndex:this.getDownArrowTabIndex(),acc:this.getDownArrowAccText(),role:"button"},this._setUpArrowAccObj(a),this._setDownArrowAccObj(b)},getSpinId:function(){return this.get("spinId")},setSpinId:function(a){this.set("spinId",a)},getIdPrefix:function(){return this.get("idPrefix")},setIdPrefix:function(a){this.set("idPrefix",a)},getPath:function(){return this.get("path")},setPath:function(a){this.set("path",a)},getManager:function(){return this.get("manager")},setManager:function(a){this.set("manager",a)},getPlayer:function(){return this.get("player")},getHeight:function(){return this.get("height")},setHeight:function(a){this.set("height",a)},getWidth:function(){return this.get("width")},setWidth:function(a){this.set("width",a)},getMinValue:function(){return this.get("minValue")},setMinValue:function(a){this.set("minValue",a)},getMaxValue:function(){return this.get("maxValue")},setMaxValue:function(a){this.set("maxValue",a)},getValue:function(){return this.get("value")},setValue:function(a){this.set("value",a)},getStepValue:function(){return this.get("step")},setStepValue:function(a){this.set("step",a)},getShowSign:function(){return this.get("showSign")},setShowSign:function(a){this.set("showSign",a)},getScreenId:function(){return this.get("screenId")},setScreenId:function(a){this.set("screenId",a)},getButtonState:function(){return this.get("buttonState")},setButtonState:function(a){this.set("buttonState",a)},getIsEditable:function(){return this.get("isEditable")},setIsEditable:function(a){this.set("isEditable",a)},getAlignType:function(){return this.get("alignType")},setIsBottomAligned:function(a){this.set("isBottomAligned",a)},getInputType:function(){return this.get("inputType")},getInputPrecision:function(){return this.get("inputPrecision")},getMaxCharLength:function(){return this.get("maxCharLength")},getInputRegEx:function(){return this.get("inputRegEx")},setEmptySpinnerAccText:function(a){var b=this.getTextAccObj();this.set("emptySpinnerAccText",a),null===b||null===a&&void 0===a||(b.acc=a,this._setTextAccObj(b))},getEmptySpinnerAccText:function(){return this.get("emptySpinnerAccText")},setEmptySpinnerPlaceHolders:function(a){this.set("emptySpinnerPlaceHolders",a)},getEmptySpinnerPlaceHolders:function(){return this.get("emptySpinnerPlaceHolders")},setDefaultAccText:function(a){var b=this.getTextAccObj(),c=this.getEmptySpinnerAccText();this.set("defaultAccText",a),null===b||null!==c&&void 0!==c||(b.acc=a,this._setTextAccObj(b))},getDefaultAccText:function(){return this.get("defaultAccText")},setDefaultPlaceHolders:function(a){this.set("defaultPlaceHolders",a)},getDefaultPlaceHolders:function(){return this.get("defaultPlaceHolders")},setMinLimitAccText:function(a){this.set("minLimitAccText",a)},getMinLimitAccText:function(){return this.get("minLimitAccText")},setMinLimitPlaceHolders:function(a){this.set("minLimitPlaceHolders",a)},getMinLimitPlaceHolders:function(){return this.get("minLimitPlaceHolders")},setMaxLimitAccText:function(a){this.set("maxLimitAccText",a)},getMaxLimitAccText:function(){return this.get("maxLimitAccText")},setMaxLimitPlaceHolders:function(a){this.set("maxLimitPlaceHolders",a)},getMaxLimitPlaceHolders:function(){return this.get("maxLimitPlaceHolders")},setOnIncreaseAccText:function(a){this.set("onIncreaseAccText",a)},getOnIncreaseAccText:function(){return this.get("onIncreaseAccText")},setOnIncreasePlaceHolders:function(a){this.set("onIncreasePlaceHolders",a)},getOnIncreasePlaceHolders:function(){return this.get("onIncreasePlaceHolders")},setOnDecreaseAccText:function(a){this.set("onDecreaseAccText",a)},getOnDecreaseAccText:function(){return this.get("onDecreaseAccText")},setOnDecreasePlaceHolders:function(a){this.set("onDecreasePlaceHolders",a)},getOnDecreasePlaceHolders:function(){return this.get("onDecreasePlaceHolders")},setUpArrowAccText:function(a){this.set("upArrowAccText",a);var b=this.getUpArrowAccObj();null!==b&&(b.acc=a,this._setTextAccObj(b))},getUpArrowAccText:function(){return this.get("upArrowAccText")},setDownArrowAccText:function(a){this.set("downArrowAccText",a);var b=this.getDownArrowAccObj();null!==b&&(b.acc=a,this._setDownArrowAccObj(b))},getDownArrowAccText:function(){return this.get("downArrowAccText")},_setTextAccId:function(a){this.set("textAccId",a);var b=this.getTextAccObj();null!==b&&(b.elementId=a,this._setTextAccObj(b))},getTextAccId:function(){return this.get("textAccId")},_setUpArrowAccId:function(a){this.set("upArrowAccId",a);var b=this.getUpArrowAccObj();null!==b&&(b.elementId=a,this._setTextAccObj(b))},getUpArrowAccId:function(){return this.get("upArrowAccId")},_setDownArrowAccId:function(a){this.set("downArrowAccId",a);var b=this.getDownArrowAccObj();null!==b&&(b.elementId=a,this._setDownArrowAccObj(b))},getDownArrowAccId:function(){return this.get("downArrowAccId")},_setTabIndex:function(a){this.set("tabIndex",parseInt(a));var b=this.getTextAccObj();null!==b&&(b.tabIndex=a,this._setTextAccObj(b))},getTabIndex:function(){return this.get("tabIndex")},_setUpArrowTabIndex:function(a){this.set("upArrowTabIndex",parseInt(a));var b=this.getUpArrowAccObj();null!==b&&(b.tabIndex=a,this._setTextAccObj(b))},getUpArrowTabIndex:function(){return this.get("upArrowTabIndex")},_setDownArrowTabIndex:function(a){this.set("downArrowTabIndex",parseInt(a));var b=this.getDownArrowAccObj();null!==b&&(b.tabIndex=a,this._setDownArrowAccObj(b))},getDownArrowTabIndex:function(){return this.get("downArrowTabIndex")},_setTextAccObj:function(a){this.set("textAccObj",a)},getTextAccObj:function(){return this.get("textAccObj")},_setUpArrowAccObj:function(a){this.set("upArrowAccObj",a)},getUpArrowAccObj:function(){return this.get("upArrowAccObj")},_setDownArrowAccObj:function(a){this.set("downArrowAccObj",a)},getDownArrowAccObj:function(){return this.get("downArrowAccObj")}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.customSpin=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.spinBoxId)?f=g.call(b,{hash:{},data:e}):(g=b&&b.spinBoxId,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-content-holder" class="spinbox">\r\n  <div id ="',(g=c.spinBoxId)?f=g.call(b,{hash:{},data:e}):(g=b&&b.spinBoxId,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-down-arrow\" class='spin-down-arrow arrowbutton'></div>\r\n  <div id=\"",(g=c.spinBoxId)?f=g.call(b,{hash:{},data:e}):(g=b&&b.spinBoxId,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-text"  class="spin-textbox"></div>\r\n  <div id="',(g=c.spinBoxId)?f=g.call(b,{hash:{},data:e}):(g=b&&b.spinBoxId,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"-up-arrow\" class='spin-up-arrow arrowbutton'></div>\r\n</div>"})}(),function(){"use strict";MathInteractives.Common.Components.Views.NumberLine=MathInteractives.Common.Player.Views.Base.extend({manager:null,idPrefix:null,filePath:null,_player:null,lineMin:null,lineMax:null,tabName:"",lineWidth:400,tickHeight:11,centerTickHeight:21,currentDroppableItem:"",clickableElements:!1,slider:!1,$sliderView:null,sliderValue:1,isDragStart:!1,_$dragDropPanBalView:{},equation:null,dragDrop:null,tabIndexMargin:400,tabIndexSliderHandle:0,prevFocusOnSliderHandle:!1,setFocusHandle:!1,initialize:function(){this.idPrefix=this.model.get("idPrefix"),this.filePath=this.model.getPath(),this.lineMin=this.model.get("lineMinValue"),this.lineMax=this.model.get("lineMaxValue"),this.lineWidth=this.model.get("lineWidth"),this.tickHeight=this.model.get("tickHeight"),this.centerTickHeight=this.model.get("centerTickHeight"),this.slider=this.model.get("slider"),this.manager=this.model.get("manager"),this._player=this.model.get("player"),this.tabName=this.model.get("tabName"),this.equation=this.model.get("equation"),this.dragDrop=this.model.get("dragDrop"),this.tabIndexMargin=this.model.get("tabIndexMargin"),this.render()},render:function(){for(var a=this,b=11,c=21,d=this.lineMax-this.lineMin+1,e=[],f=this.lineMin,g=0;d>g;g++)e[g]=f++;this.model.setCurrentDotItemType("filled");var h={range:e,idPrefix:this.idPrefix,tabName:this.tabName};this.$el.html(MathInteractives.Common.Components.templates.numberLine(h).trim());var i=this.$el.find(".point-container"),j=parseInt(this.lineWidth/d,10)-3;i.css({"margin-left":j+"px","margin-right":"0px",width:0}),$(i[i.length-1]).css("margin-right",0);var k=this.$el.find(".graph-pane-middle-line");k.css("width",j*d+(j+3)+"px"),this.$(".graph-pane-middle-graph-points").css({left:this.$el.find(".graph-pane-left-arrow").width()});var l=parseInt(i.css("width").replace("px",""),10);if(this.$el.find(".graph-pane-right-arrow-line").css("width",.5*l+j+1+"px").hide().remove(),this.$el.find(".graph-pane-left-arrow-line").css({width:.5*l+j+1+"px","margin-left":"12px"}).hide().remove(),this.$el.find(".graph-pane-left-arrow").css({"background-image":'url("'+this.filePath.getImagePath("left-arrow")+'")'}),this.$el.find(".graph-pane-right-arrow").css({"background-image":'url("'+this.filePath.getImagePath("right-arrow")+'")'}),this.tickHeight!=b){var m=(b-this.tickHeight)/2;this.$el.find(".point-box").css({height:this.tickHeight+"px","margin-top":m+"px"})}if(this.tickHeight!=c&&this.lineMax>=0&&this.lineMin<=0){var m=(this.tickHeight-this.centerTickHeight)/2;this.$el.find(".point-number").css("margin-top",-m+4+"px"),this.$el.find("#"+this.idPrefix+this.tabName+"graph-pane-0-point").css({"margin-top":m+"px",height:this.centerTickHeight+"px"}),this.$el.find("#"+this.idPrefix+this.tabName+"graph-pane-0-number").css({"margin-top":"4px"})}if(this.slider){var n=this.model.get("equation"),o=this.model.get("sliderValue"),p=Number(this.lineWidth)-25;n.a<0?this.slideHandleType=1:this.slideHandleType=2,this.model.get("sliderHandleOnArrowHead")===!0&&(o=this.lineMax+1);var h={containerId:this.tabName+"graph-pane-slider-box",sliderId:this.tabName+"graph-pane-slider",manager:this.manager,player:this._player,idPrefix:this.idPrefix,width:p,height:10,minValue:this.lineMin-1,maxValue:this.lineMax+1,selectedValue:o,step:1,tabIndex:this.tabIndexMargin,appendLabel:!1,isBackgroundImage:!1,smoothSliding:!0,filePath:this.filePath,onStart:$.proxy(this._sliderStart,this),onStop:$.proxy(this._sliderStop,this),onChange:$.proxy(this._sliderClickChange,this),onSlide:$.proxy(this._sliderDragChange,this),sliderHandleType:this.slideHandleType,points:this.caluculatePointsOnSlider(1)};this.$sliderView=MathInteractives.global.Slider.generateSlider(h),this.loadScreen("number-line-slider-handle"),this.tabIndexSliderHandle=this.getTabIndex(this.tabName+"graph-pane-slider-handle"),this.$sliderView.off("onSlideHandleClick").on("onSlideHandleClick",function(){a._onSliderHandleClick()}),this.$el.find(".point-number").off("click").on("click",function(b){a.$sliderView.setSelectedValue(parseInt($(b.target).text(),10)),a._sliderClickChange(),a._sliderStop(),a._showHideDragDrop(),a.trigger("numberLineSliderOnSlide")}).css("cursor","pointer"),this.model.get("sliderHandleOnArrowHead")!==!0&&a._setSliderHandlePosition(o),a.$sliderView.setSelectedValue(o),a.setFocusHandle=!0,this.$el.find("#"+this.idPrefix+this.tabName+"graph-pane-slider-box").css({width:Number(this.lineWidth)+"px"}),this.$el.find("#"+this.idPrefix+this.tabName+"graph-pane-slider").css({"margin-left":"4px"}),this.updateFocusRect(a.tabName+"graph-pane-slider-box"),this.setAccMessage(this.tabName+"graph-pane-slider-handle",this.getMessage("number-line-slider-handle-acc-text",14)),this.$sliderView.off("onSlideHandleKeyDown").on("onSlideHandleKeyDown",function(){null!==a.dragDrop&&(a._setDefaultImage(),a._showHideDragDrop()),a.updateFocusRect(a.tabName+"graph-pane-slider-handle")}),this.$sliderView.off("onSlideHandleKeyUp").on("onSlideHandleKeyUp",function(){if(null!==a.dragDrop){var b=a.$sliderView.getSelectedValue();a.model.get("sliderHandleOnArrowHead")===!0&&(b>a.lineMax||b<a.lineMin)||a._setSliderHandleImage(),a._showHideDragDrop(),a.model.get("sliderHandleOnArrowHead")!==!0&&a._setSliderHandlePosition(o)}a.updateFocusRect(a.tabName+"graph-pane-slider-handle")}),null!==a.dragDrop&&(this.focusIn(this.tabName+"graph-pane-slider-handle",$.proxy(this.onFocusSlideHandle,this),20),this.focusOut(this.tabName+"graph-pane-slider-handle",$.proxy(this.onFocusOutSlideHandle,this),20),this.focusOut(this.tabName+"-hack-div",$.proxy(this.onFocusOutHackDiv,this),50))}},onCorrectItemDrop:function(a){this.$sliderView.disableSlider(),this.$el.find(".point-number").off("click").css("cursor","default"),this.$sliderView.off("onSlideHandleClick"),this.$sliderView.$el.find(".graph-pane-slider").css("cursor","default"),this.trigger("activityComplete"),this.enableTab(this.tabName+"arrow-indicator",!1),this.enableTab(this.tabName+"dotted-box",!1),this.enableTab(this.tabName+"graph-pane-slider-handle",!1),this.setFocus("reset-button")},onContextMenuSelect:function(a,b){var c=this.$("#"+this.idPrefix+this.tabName+"graph-pane-"+this.model.get("equation").x),d=c.offset().left,e="",f=null,g=c.offset().top;e=b.currentTarget.id===this.idPrefix+"dragitems-contextmenu-0"?1:2,f=this._$dragDropPanBalView.dropUsingKeys(d,g,e),f.expectedCircle!==f.droppedCircle?(this.setAccMessage(this.tabName+"dotted-box",this.getMessage("number-line-slider-handle-acc-text",7)+" "+this.getMessage("number-line-slider-handle-acc-text",9)),this.setFocus(this.tabName+"dotted-box")):f.expectedArrow!==f.droppedArrow?(this.setAccMessage(this.tabName+"dotted-box",this.getMessage("number-line-slider-handle-acc-text",8)+" "+this.getMessage("number-line-slider-handle-acc-text",9)),this.setFocus(this.tabName+"dotted-box")):(this.enableTab("tab-container",!0),this.setAccMessage("tab-container",this.getMessage("number-line-slider-handle-acc-text",13)),this.setFocus("tab-container"))},onFocusOutHackDiv:function(){this._resetTabIndexes("numberLineHackDiv")},onFocusOutSlideHandle:function(){this.prevFocusOnSliderHandle=!1},onFocusSlideHandle:function(){var a=this.$sliderView.getSelectedValue();null!==this.dragDrop&&(this.setTabIndex(this.tabName+"graph-pane-slider-handle",this.tabIndexSliderHandle),this.dragDrop.xPoint===a&&this.prevFocusOnSliderHandle===!1&&("filled"===this.model.getCurrentDotItemType()?this.setAccMessage(this.tabName+"graph-pane-slider-handle",this.getMessage("number-line-slider-handle-acc-text",6)):this.setAccMessage(this.tabName+"graph-pane-slider-handle",this.getMessage("number-line-slider-handle-acc-text",5)))),this.prevFocusOnSliderHandle=!0},caluculatePointsOnSlider:function(a){for(var b=[],c=this.lineMax,d=this.lineMin;c>=d;d+=a)b.push(d);return b},twinDotItem:function(){var a=this.$sliderView.$(".slider-handle");a.addClass("slider-handle-dropped"),"filled"===this.model.getCurrentDotItemType()?(this.model.setCurrentDotItemType("unfilled"),this.setAccMessage(this.tabName+"graph-pane-slider-handle",this.getMessage("number-line-slider-handle-acc-text",3)),this.setFocus(this.tabName+"graph-pane-slider-handle"),a.css({"background-image":'url("'+this.filePath.getImagePath("purple-dot-outline-pan")+'")',"background-position":"-196px -977px"})):(this.model.setCurrentDotItemType("filled"),this.setAccMessage(this.tabName+"graph-pane-slider-handle",this.getMessage("number-line-slider-handle-acc-text",4)),this.setFocus(this.tabName+"graph-pane-slider-handle"),a.css({"background-image":'url("'+this.filePath.getImagePath("purple-dot-pan")+'")',"background-position":"-52px -1264px"}))},_sliderStart:function(a){this.trigger("numberLineSliderOnStart")},_sliderClickChange:function(a){var b=this.$sliderView.getSelectedValue(),c="",d="",e=this;if(this.sliderValue!==b&&(this.sliderValue=b,this.model.setSliderValue(b)),null!==this.dragDrop){if(this.dragDrop.xPoint===b){var f={idPrefix:this.idPrefix,player:this._player,manager:this.manager,containerId:this.idPrefix+""+this.tabName+"-drag-drop-container",minPoint:this.model.get("lineMinValue"),maxPoint:this.model.get("lineMaxValue"),sign:this.dragDrop.sign,xPoint:this.dragDrop.xPoint,tickinterval:this.tickinterval,numberLineView:this,tabName:this.tabName,path:this.filePath,equation:this.equation,droppedCircleItem:this.model.getCurrentDotItemType()};this._$dragDropPanBalView=MathInteractives.global.DragDropPan.generateDragDropPanBalance(f),this._$dragDropPanBalView.model.on("change:correctEleDrop",$.proxy(this.onCorrectItemDrop,this)),this.trigger("drag-drop-shown"),this._$dragDropPanBalView.$el.find(".draggable-items").off("keydown.adv-num-line").on("keydown.adv-num-line",$.proxy(this.onClickKeyEvent,this));var f={el:e._player.$el,prefix:e.idPrefix,elements:[e.$el.find("#"+e.idPrefix+e.tabName+"arrow-indicator")],contextMenuCount:2,manager:e.manager,thisView:e,nestedMenuData:{},screenId:"dragitems-contextmenu"};this.contextMenuView=MathInteractives.global.ContextMenu.initContextMenu(f),this.$("#"+e.idPrefix+e.tabName+"arrow-indicator").on(MathInteractives.global.ContextMenu.CONTEXTMENU_SELECT,$.proxy(this.onContextMenuSelect,this)),this.$("#"+e.idPrefix+e.tabName+"arrow-indicator").on(MathInteractives.global.ContextMenu.CONTEXTMENU_OPEN,$.proxy(function(){this.changeMessage("dragitems-contextmenu-0",0,[this.dragDrop.xPoint]),this.changeMessage("dragitems-contextmenu-1",0,[this.dragDrop.xPoint]),this.changeAccMessage("dragitems-contextmenu-0",0,[this.dragDrop.xPoint]),this.changeAccMessage("dragitems-contextmenu-1",0,[this.dragDrop.xPoint]),this.setFocus("dragitems-contextmenu-0")},this)),this.$("#"+e.idPrefix+e.tabName+"arrow-indicator").on(MathInteractives.global.ContextMenu.CONTEXTMENU_HIDE,function(){var a=this.id.replace(e.idPrefix,"");e.setFocus(a)}),this._$dragDropPanBalView.off("disableSlider").on("disableSlider",$.proxy(this._disableSlider,this)),this._$dragDropPanBalView.off("enableSlider").on("enableSlider",$.proxy(this._enableSlider,this))}this._showHideDragDrop(),this._generateTabIndexes("draggableContainer"),this._generateTabIndexes("draggableItemsScreen")}d=this.equation.a*b+this.equation.b,this.lineMin<=b&&this.lineMax>=b&&(d<this.equation.c?c=b+" , "+this.getMessage("number-line-slider-handle-acc-text",0):d>this.equation.c?c=b+" , "+this.getMessage("number-line-slider-handle-acc-text",1):d===this.equation.c&&(c=b+" , "+this.getMessage("number-line-slider-handle-acc-text",2)),this.setFocusHandle&&(this.setFocus("tab-container"),this.setAccMessage(e.tabName+"graph-pane-slider-handle",c),this.setFocus(e.tabName+"graph-pane-slider-handle"))),this.trigger("numberLineSliderOnChange",a,{value:b})},_disableSlider:function(){this.$sliderView.disableSlider()},_enableSlider:function(){this.$sliderView.enableSlider()},_onSliderHandleClick:function(){var a=this.$sliderView.getSelectedValue();return this.slideHandleClick===!1?void(this.slideHandleClick=!0):void(null!==this.dragDrop&&this.model.get("equation").x===a?(this.setFocus("reset-button"),this.twinDotItem()):null!==this.dragDrop&&this.model.get("equation").x!==a&&(this.setAccMessage(this.tabName+"graph-pane-slider-handle",this.getMessage("number-line-slider-handle-acc-text",10)),this.setFocus("reset-button"),this.setFocus(this.tabName+"graph-pane-slider-handle")))},_setSliderHandleImage:function(){var a=this.$sliderView.$(".slider-handle");a.addClass("slider-handle-dropped"),"filled"===this.model.getCurrentDotItemType()?a.css({"background-image":'url("'+this.filePath.getImagePath("purple-dot-pan")+'")',"background-position":"-52px -1264px"}):a.css({"background-image":'url("'+this.filePath.getImagePath("purple-dot-outline-pan")+'")',"background-position":"-196px -977px"})},_setDefaultImage:function(a){this.$sliderView.$(".slider-handle").removeClass("slider-handle-dropped"),this.$sliderView.setSliderHandleImage()},_sliderStop:function(a,b){var c=this.$sliderView.getSelectedValue();this.isDragStart=!1,this.trigger("numberLineSliderOnStop",a,{value:c}),null!==this.dragDrop&&c<=this.lineMax&&(this._setSliderHandleImage(),this._showHideDragDrop()),this._setSliderHandlePosition()},_setSliderHandlePosition:function(a){return},_sliderDragChange:function(a){var b=this.$sliderView.getSelectedValue();this.sliderValue!==b&&this.model.setSliderValue(b),this.isDragStart&&null!==this.dragDrop&&(this.slideHandleClick=!1,this._setDefaultImage()),this.isDragStart=!0,this._showHideDragDrop(),this.trigger("numberLineSliderOnSlide")},_showHideDragDrop:function(){if(null!=this.model.get("dragDrop")){var a=this.$sliderView.getSelectedValue(),b=this.model.get("equation"),c=null;c=a===b.x?!0:!1,c===!1?(this._$dragDropPanBalView=null,this.$el.find("#"+this.idPrefix+this.tabName+"-drag-drop-container").html(""),this.trigger("drag-drop-hide")):this.trigger("drag-drop-show")}},onClickKeyEvent:function(a){a=a?a:window.event;var b=a.keyCode?a.keyCode:a.which,c=this.$("#"+this.idPrefix+this.tabName+"graph-pane-"+this.model.get("equation").x),d=this.$("#"+this.idPrefix+this.tabName+"graph-pane-left-arrow-container");this.$("#"+this.idPrefix+this.tabName+"graph-pane-right-arrow-container");(13===b||32===b)&&(this.$("#"+this.idPrefix+this.tabName+"-hack-div-slot").css({width:c.offset().left-d.offset().left-5,"margin-left":"0px"}),this._generateTabIndexes("numberLineHackDiv"),this.updateFocusRect(this.tabName+"-hack-div-slot"),this.currentDroppableItem=1,this.setAccMessage(this.tabName+"-hack-div-slot",this.getMessage("number-line-slider-handle-acc-text",12)+" "+this.model.get("equation").x),this.setFocus(this.tabName+"-hack-div-slot"),this.$("#"+this.idPrefix+this.tabName+"-hack-div-slot","#"+this.idPrefix+this.tabName+"-hack-div-slot-right").off("keydown.adv-num-line").on("keydown.adv-num-line",$.proxy(this.onDropSlotHackEvent,this)))},onDropSlotHackEvent:function(a){a=a?a:window.event;var b=a.keyCode?a.keyCode:a.which,c=c||this.currentDroppableItem,d=this.$("#"+this.idPrefix+this.tabName+"graph-pane-"+this.model.get("equation").x),e=this.$("#"+this.idPrefix+this.tabName+"graph-pane-left-arrow-container"),f=this.$("#"+this.idPrefix+this.tabName+"graph-pane-right-arrow-container");if(a.preventDefault(),9==a.which&&a.shiftKey)return this._resetTabIndexes("numberLineHackDiv"),void this.setFocus(this.tabName+"arrow-indicator");switch(b){case 13:case 32:var g=d.offset().left,h=d.offset().top,i=this._$dragDropPanBalView.dropUsingKeys(g,h,this.currentDroppableItem);i.expectedCircle!==i.droppedCircle?(this.setAccMessage(this.tabName+"dotted-box",this.getMessage("number-line-slider-handle-acc-text",7)+" "+this.getMessage("number-line-slider-handle-acc-text",9)),this.setFocus(this.tabName+"dotted-box")):i.expectedArrow!==i.droppedArrow?(this.setAccMessage(this.tabName+"dotted-box",this.getMessage("number-line-slider-handle-acc-text",8)+" "+this.getMessage("number-line-slider-handle-acc-text",9)),this.setFocus(this.tabName+"dotted-box")):(this.enableTab("tab-container",!0),this.setAccMessage("tab-container",this.getMessage("number-line-slider-handle-acc-text",13)),this.setFocus("tab-container")),this._resetTabIndexes("numberLineHackDiv");break;case 37:c>1&&($(a.target).parent().css({width:d.offset().left-e.offset().left-5,"margin-left":"0px"}),this.updateFocusRect(this.tabName+"-hack-div-slot"),this.currentDroppableItem=1,this.setFocus("temp-focus-div"),this.setAccMessage(this.tabName+"-hack-div-slot",this.getMessage("number-line-slider-handle-acc-text",12)+" "+this.model.get("equation").x),this.setFocus(this.tabName+"-hack-div-slot"));break;case 39:2>c&&($(a.target).parent().css({width:f.offset().left-d.offset().left,"margin-left":d.offset().left-e.offset().left+10}),this.updateFocusRect(this.tabName+"-hack-div-slot"),this.currentDroppableItem=2,this.setFocus("temp-focus-div"),this.setAccMessage(this.tabName+"-hack-div-slot",this.getMessage("number-line-slider-handle-acc-text",11)+" "+this.model.get("equation").x),this.setFocus(this.tabName+"-hack-div-slot"));break;case 9:this._resetTabIndexes("numberLineHackDiv"),this.setFocus(this.tabName+"arrow-indicator")}},_generateTabIndexes:function(a){switch(this.loadScreen(this.tabName+a),a){case"numberLineHackDiv":this.setTabIndex(this.tabName+"-hack-div-slot",this.tabIndexMargin+this.getTabIndex(this.tabName+"-hack-div-slot"));break;case"numberLineContainer":this.setTabIndex(this.tabName+"graph-pane",this.tabIndexMargin+this.getTabIndex(this.tabName+"graph-pane"));break;case"draggableItemsScreen":this.setTabIndex(this.tabName+"arrow-indicator",this.tabIndexMargin+this.getTabIndex(this.tabName+"arrow-indicator"));break;case"draggableContainer":this.setTabIndex(this.tabName+"dotted-box",this.tabIndexMargin+this.getTabIndex(this.tabName+"dotted-box"));
}},_resetTabIndexes:function(a){switch(a){case"numberLineHackDiv":this.setTabIndex(this.tabName+"-hack-div-slot",this.getTabIndex(this.tabName+"-hack-div-slot")-this.tabIndexMargin);break;case"numberLineContainer":this.setTabIndex(this.tabName+"graph-pane",this.getTabIndex(this.tabName+"graph-pane")-this.tabIndexMargin);break;case"draggableItemsScreen":this.setTabIndex(this.tabName+"arrow-indicator",this.getTabIndex(this.tabName+"arrow-indicator")-this.tabIndexMargin);break;case"draggableContainer":this.setTabIndex(this.tabName+"dotted-box",this.getTabIndex(this.tabName+"dotted-box")-this.tabIndexMargin)}this.unloadScreen(this.tabName+a)}},{generateNumberLine:function(a){if(a){var b=new MathInteractives.Common.Components.Models.NumberLine(a),c=new MathInteractives.Common.Components.Views.NumberLine({model:b,el:$("#"+a.containerId)});return c}}}),MathInteractives.global.NumberLine=MathInteractives.Common.Components.Views.NumberLine}(),function(){MathInteractives.Common.Components.Models.NumberLine=MathInteractives.Common.Player.Models.Base.extend({defaults:{manager:null,player:null,containerId:"",lineMinValue:-10,lineMaxValue:10,lineWidth:400,path:null,idPrefix:"",tickHeight:11,centerTickHeight:21,tabName:"",clickableElements:!1,sliderHandleOnArrowHead:!1,slider:!1,sliderValue:1,dragDrop:null,equation:null,currentDotItemType:"",tabIndexMargin:400},getPath:function(){return this.get("path")},getSliderValue:function(){return this.get("sliderValue")},setSliderValue:function(a){this.set("sliderValue",a)},getCurrentDotItemType:function(){return this.get("currentDotItemType")},setCurrentDotItemType:function(a){this.set("currentDotItemType",a)}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.numberLine=a(function(a,b,c,d,e){function f(a,b,c){var d,e="";return e+='\r\n      <div id="'+k((d=c&&c.idPrefix,typeof d===j?d.apply(a):d))+k((d=c&&c.tabName,typeof d===j?d.apply(a):d))+"graph-pane-"+k(typeof a===j?a.apply(a):a)+'" class="point-container">\r\n        <div id="'+k((d=c&&c.idPrefix,typeof d===j?d.apply(a):d))+k((d=c&&c.tabName,typeof d===j?d.apply(a):d))+"graph-pane-"+k(typeof a===j?a.apply(a):a)+'-point" class="point-box">\r\n          <div class="graph-pane-divider-tick"></div>\r\n        </div>\r\n        <div id="'+k((d=c&&c.idPrefix,typeof d===j?d.apply(a):d))+k((d=c&&c.tabName,typeof d===j?d.apply(a):d))+"graph-pane-"+k(typeof a===j?a.apply(a):a)+'-number" class="point-number">'+k(typeof a===j?a.apply(a):a)+"</div>\r\n      </div>\r\n      "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this;return i+='\ufeff<div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-drag-drop-numberline">\r\n  <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-drag-drop-container" class="drag-drop-containers"></div>\r\n\r\n\r\n  <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane" class="graph-pane">\r\n\r\n    <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-left-arrow-container" class="graph-pane-left-arrow-container">\r\n      <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-left-arrow" class="graph-pane-left-arrow"></div>\r\n      <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-left-arrow-line" class="graph-pane-left-arrow-line"></div>\r\n    </div>\r\n\r\n    <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-middle-line" class="graph-pane-middle-line"></div>\r\n\r\n   \r\n\r\n    <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-middle-graph-points" class="graph-pane-middle-graph-points">\r\n\r\n      ',g=c.each.call(b,b&&b.range,{hash:{},inverse:l.noop,fn:l.programWithDepth(1,f,e,b),data:e}),(g||0===g)&&(i+=g),i+='\r\n\r\n    </div>\r\n    <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-slider-box" class="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-slider-box graph-pane-slider-box">\r\n      <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-slider" class="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-slider graph-pane-slider"></div>\r\n    </div>\r\n    <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-right-arrow-container" class="graph-pane-right-arrow-container">\r\n      <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-right-arrow-line" class="graph-pane-right-arrow-line"></div>\r\n      <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'graph-pane-right-arrow" class="graph-pane-right-arrow"></div>\r\n    </div>\r\n\r\n    <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-hack-div-slot" class="hack-div-slot"></div>\r\n    \r\n  </div>\r\n\r\n</div>   '})}(),function(){"use strict";MathInteractives.Common.Components.Views.AdvanceNumberLine=MathInteractives.Common.Player.Views.Base.extend({manager:null,idPrefix:null,filePath:null,player:null,lineMin:null,lineMax:null,lineWidth:400,tickHeight:11,centerTickHeight:21,dragDrop:null,_$dragDropView:null,tickinterval:1,tabName:"",selectedDraggable:null,currentDroppableItem:"",startTabIndex:400,draggableItems:["filled-dot","unfilled-dot","left-indicator","right-indicator"],draggableItemsTabIndex:[],tabIndexNumberLineBox:0,initialize:function(){this.manager=this.model.get("manager"),this.player=this.model.get("player"),this.idPrefix=this.model.get("idPrefix"),this.filePath=this.model.getPath(),this.lineMin=this.model.get("lineMinValue"),this.lineMax=this.model.get("lineMaxValue"),this.lineWidth=this.model.get("lineWidth"),this.tickHeight=this.model.get("tickHeight"),this.centerTickHeight=this.model.get("centerTickHeight"),this.dragDrop=this.model.get("dragDrop"),this.tabName=this.model.get("tabName"),this.tickinterval=this.model.get("tickinterval"),this.startTabIndex=this.model.get("startTabIndex"),this.render()},render:function(){for(var a=this.tickHeight,b=this.centerTickHeight,c=21,d=500,e=null,f=this.lineMax-this.lineMin+1,g=[],h=this.lineMin,i=0;f>i;i++)g[i]=h++;var j={range:g,idPrefix:this.idPrefix,tabName:this.tabName};this.$el.html(MathInteractives.Common.Components.templates.numberLineAdvance(j).trim());var k=this.$el.find(".graph-pane-left-arrow").width()-1,l=this.$el.find(".point-container"),m=(this.lineWidth-k)/(f-1+2*this.tickinterval);if(e=this.$el.find(".graph-pane-middle-line"),e.css("width",this.lineWidth+"px"),l.css({"margin-left":m+"px","margin-right":"0px",width:0}),$(l[0]).css("margin-left",m*this.tickinterval+k/2+"px"),$(l[l.length-1]).css("margin-right","0px"),this.$(".graph-pane-middle-graph-points").css({left:k}),d=parseInt(l.css("width").replace("px",""),10),this.$el.find(".graph-pane-right-arrow-line").css("width",.5*d+m+1+"px").hide().remove(),this.$el.find(".graph-pane-left-arrow-line").css({width:.5*d+m+1+"px","margin-left":"12px"}).hide().remove(),this.$el.find(".graph-pane-left-arrow").css({"background-image":'url("'+this.filePath.getImagePath("left-arrow")+'")'}),this.$el.find(".graph-pane-right-arrow").css({"background-image":'url("'+this.filePath.getImagePath("right-arrow")+'")'}),this.tickHeight!=a){var n=(a-this.tickHeight)/2;this.$el.find(".point-box").css({height:this.tickHeight+"px","margin-top":n+"px"})}if(this.tickHeight!=b&&this.lineMax>=0&&this.lineMin<=0){var n=(this.tickHeight-this.centerTickHeight)/2;this.$el.find(".point-number").css("margin-top",-n+4+"px"),this.$el.find("#"+this.idPrefix+this.tabName+"-graph-pane-0-point").css({"margin-top":n+"px",height:this.centerTickHeight+"px"}),this.$el.find("#"+this.idPrefix+this.tabName+"-graph-pane-0-number").css({"margin-top":"4px"}),this.$el.find("#"+this.idPrefix+this.tabName+"-graph-pane").css({height:$("#"+this.idPrefix+this.tabName+"-graph-pane").height()+8+"px"})}if(this.tickinterval>1){this.$el.find(".graph-pane-divider-tick").hide();for(var i=this.lineMin;i<=this.lineMax;i+=this.tickinterval)this.$el.find("#"+this.idPrefix+this.tabName+"-graph-pane-"+i+"-point").find(".graph-pane-divider-tick").show()}this.$el.find(".point-number").hide();var o,p=Math.ceil(f/this.tickinterval);o=p>c?Math.ceil(p/c)*this.tickinterval:this.tickinterval;for(var i=this.lineMin;i<=this.lineMax;i+=o)this.$el.find("#"+this.idPrefix+this.tabName+"-graph-pane-"+i+"-point").show(),this.$el.find("#"+this.idPrefix+this.tabName+"-graph-pane-"+i+"-number").show();if(null!==this.dragDrop){var j={idPrefix:this.idPrefix,manager:this.manager,player:this.player,containerId:this.idPrefix+""+this.tabName+"-drag-drop-container",minPoint:this.model.get("lineMinValue"),maxPoint:this.model.get("lineMaxValue"),sign:this.model.get("dragDrop").sign,xPoint:this.model.get("dragDrop").xPoint,tickinterval:this.tickinterval,numberLineView:this,tabName:this.tabName,path:this.filePath};this._$dragDropView=MathInteractives.global.DragDropNumberLine.generateDragDrop(j),this._$dragDropView.on("number-line-drag-start",$.proxy(function(a,b){this.trigger("number-line-drag-start",a,b)},this)),this._$dragDropView.$el.find(".draggable-items").off("keydown.adv-num-line").on("keydown.adv-num-line",$.proxy(this.onDraggableItemsKeyEvent,this)),this._generateTabIndexes("draggableContainer"),this._generateTabIndexes("draggableItemsScreen"),this._generateTabIndexes("numberLineContainer"),this.tabIndexNumberLineBox=this.getTabIndex(this.tabName+"-graph-pane"),this.loadScreen("advance-number-line-container");var q=this,j={el:q.player.$el,prefix:q.idPrefix,elements:[q.$el.find("#"+q.idPrefix+q.tabName+"filled-dot"),q.$el.find("#"+q.idPrefix+q.tabName+"unfilled-dot"),q.$el.find("#"+q.idPrefix+q.tabName+"right-indicator"),q.$el.find("#"+q.idPrefix+q.tabName+"left-indicator")],contextMenuCount:201,manager:q.manager,thisView:q,maxItemCount:10,nestedMenuData:{},screenId:"dragitems-type1-contextmenu"};this.contextMenuView=MathInteractives.global.ContextMenu.initContextMenu(j);for(var r=[],s=[],i=0;200>=i;i++)i>=this.lineMin+100&&i<=this.lineMax+100?r.push(q.idPrefix+"dragitems-type1-contextmenu-"+i):s.push(q.idPrefix+"dragitems-type1-contextmenu-"+i);this.contextMenuView.editContextMenu(r,!1),this.contextMenuView.editContextMenu(s,!0);var t="#"+q.idPrefix+q.tabName+"right-indicator,#"+q.idPrefix+q.tabName+"left-indicator,#"+q.idPrefix+q.tabName+"unfilled-dot,#"+q.idPrefix+q.tabName+"filled-dot";this.$(t).on(MathInteractives.global.ContextMenu.CONTEXTMENU_SELECT,$.proxy(this.onContextMenuSelect,this)).on(MathInteractives.global.ContextMenu.CONTEXTMENU_OPEN,$.proxy(function(){for(var a=parseInt($("#"+q.idPrefix+"dragitems-type1-contextmenu-"+(this.lineMin+100)).text(),10),b="",c=this.lineMin+100;c<=this.lineMax+100;c++)b=0>a?"negative "+Math.abs(a):Math.abs(a),this.setAccMessage("dragitems-type1-contextmenu-"+c,b),a++;this.setFocus("dragitems-type1-contextmenu-0")},this)).on(MathInteractives.global.ContextMenu.CONTEXTMENU_HIDE,function(){var a=this.id.replace(q.idPrefix,"");q.setFocus(a)})}},onDraggableItemsKeyEvent:function(a){a=a?a:window.event;var b=a.keyCode?a.keyCode:a.which;if(this.selectedDraggable=a.currentTarget.id,this.currentDroppableItem=this.model.get("lineMinValue"),this.$el.find("#"+this.idPrefix+this.tabName+"-graph-pane-acc-elem").css({width:Number(this.lineWidth)+10}),13===b||32===b){this._generateTabIndexes("numberLineHackDiv"),this.$("#"+this.idPrefix+this.tabName+"-hack-div-slot").css({"margin-left":this.$("#"+this.idPrefix+this.tabName+"-graph-pane-"+this.currentDroppableItem).offset().left-this.$("#"+this.idPrefix+this.tabName+"-graph-pane-left-arrow-container").offset().left-5});var c=this.currentDroppableItem;parseInt(c,10)<0&&(c="minus "+Math.abs(parseInt(c,10))),this.setAccMessage(this.tabName+"-hack-div-slot",c),this.setFocus(this.tabName+"-hack-div-slot"),this.$("#"+this.idPrefix+this.tabName+"-hack-div-slot").off("keydown.adv-num-line").on("keydown.adv-num-line",$.proxy(this.onDropSlotHackEvent,this))}},onDropSlotHackEvent:function(a){a=a?a:window.event;var b,c,d,e,f=a.keyCode?a.keyCode:a.which;if(b=b||this.currentDroppableItem,c=this.model.get("lineMinValue"),d=this.model.get("lineMaxValue"),e=1,a.preventDefault(),9==a.which&&a.shiftKey)return this.setFocus(this.tabName+this.selectedDraggable.split(this.tabName)[1]),void(this.selectedDraggable=null);switch(f){case 13:case 32:var g=$("#"+this.idPrefix+this.tabName+"-graph-pane-"+this.currentDroppableItem).offset().left,h=$("#"+this.idPrefix+this.tabName+"-graph-pane-"+this.currentDroppableItem).offset().top;this.onDragItemDrop(g,h,this.currentDroppableItem),this._resetTabIndexes("numberLineHackDiv");break;case 37:b>c&&(b-=e,$(a.target).parent().css({"margin-left":this.$("#"+this.idPrefix+this.tabName+"-graph-pane-"+b).offset().left-this.$("#"+this.idPrefix+this.tabName+"-graph-pane-left-arrow-container").offset().left-5}),this.currentDroppableItem=b,parseInt(b,10)<0&&(b="minus "+Math.abs(parseInt(b,10))),this.setFocus(this.tabName+"dotted-box"),this.setAccMessage(this.tabName+"-hack-div-slot",b),this.setFocus(this.tabName+"-hack-div-slot"));break;case 39:d>b&&(b+=e,$(a.target).parent().css({"margin-left":this.$("#"+this.idPrefix+this.tabName+"-graph-pane-"+b).offset().left-this.$("#"+this.idPrefix+this.tabName+"-graph-pane-left-arrow-container").offset().left-5}),this.currentDroppableItem=b,parseInt(b,10)<0&&(b="minus "+Math.abs(parseInt(b,10))),this.setFocus(this.tabName+"dotted-box"),this.setAccMessage(this.tabName+"-hack-div-slot",b),this.setFocus(this.tabName+"-hack-div-slot"));break;case 9:if(this._resetTabIndexes("numberLineHackDiv"),!this.selectedDraggable)return void this.setFocus(this.tabName+this.draggableItems[0]);switch(this.selectedDraggable.split(this.tabName)[1]){case"filled-dot":this.setFocus(this.tabName+"unfilled-dot");break;case"unfilled-dot":this.setFocus(this.tabName+"left-indicator");break;case"left-indicator":this.setFocus(this.tabName+"right-indicator");break;case"right-indicator":this.setFocus(this.tabName+"filled-dot")}this.selectedDraggable=null}},onDragItemDrop:function(a,b,c){var d=0,e=this.selectedDraggable.replace(this.idPrefix+this.tabName,"");switch(e){case"filled-dot":""===this._$dragDropView.droppedCircleItem||"filled"===this._$dragDropView.droppedCircleItem?this.setAccMessage(this.tabName+"-graph-pane",this.getMessage("advance-number-line-container-acc-text",1),[c]):this.setAccMessage(this.tabName+"-graph-pane",this.getMessage("advance-number-line-container-acc-text",5),["hollow",c,"filled"]);break;case"unfilled-dot":""===this._$dragDropView.droppedCircleItem||"unfilled"===this._$dragDropView.droppedCircleItem?this.setAccMessage(this.tabName+"-graph-pane",this.getMessage("advance-number-line-container-acc-text",2),[c]):this.setAccMessage(this.tabName+"-graph-pane",this.getMessage("advance-number-line-container-acc-text",5),["filled","hollow",c]);break;case"left-indicator":""===this._$dragDropView.droppedIndicatorItem||"left"===this._$dragDropView.droppedIndicatorItem?this.setAccMessage(this.tabName+"-graph-pane",this.getMessage("advance-number-line-container-acc-text",3),[c]):this.setAccMessage(this.tabName+"-graph-pane",this.getMessage("advance-number-line-container-acc-text",6),["right","left",c]);break;case"right-indicator":""===this._$dragDropView.droppedIndicatorItem||"right"===this._$dragDropView.droppedIndicatorItem?this.setAccMessage(this.tabName+"-graph-pane",this.getMessage("advance-number-line-container-acc-text",4),[c]):this.setAccMessage(this.tabName+"-graph-pane",this.getMessage("advance-number-line-container-acc-text",6),["left",c,"right"])}if(this._$dragDropView.dropUsingKeys(a,b,this.selectedDraggable),this.setFocus(this.tabName+"-graph-pane"),d=this.getTabIndex(this.selectedDraggable.replace(this.idPrefix,"")),null!==this.selectedDraggable&&d<=this.startTabIndex+this.draggableItemsTabIndex[this.draggableItems.indexOf(this.selectedDraggable.split(this.tabName)[1])]&&this.setTabIndex(this.selectedDraggable.replace(this.idPrefix,""),d+80),""===this._$dragDropView.droppedCircleItem||""===this._$dragDropView.droppedIndicatorItem){var f=this.draggableItems.indexOf(this.selectedDraggable.split(this.tabName)[1])%4;this.setTabIndex(this.tabName+"-graph-pane",this.startTabIndex+this.draggableItemsTabIndex[f+1]-2)}else this.setTabIndex(this.tabName+"-graph-pane",this.tabIndexNumberLineBox);this.selectedDraggable=null},onContextMenuSelect:function(a,b){this.selectedDraggable=a.currentTarget.id;var c=$(b.target).text().replace("negative ","-"),d=this.$el.find("#"+this.idPrefix+this.tabName+"-graph-pane-"+c).offset().left,e=this.$el.find("#"+this.idPrefix+this.tabName+"-graph-pane-"+c).offset().top;this.onDragItemDrop(d,e,c)},checkDragDrop:function(){return this._$dragDropView.identifyCheck()},_generateTabIndexes:function(a){switch(this.loadScreen(this.tabName+a),a){case"numberLineHackDiv":this.setTabIndex(this.tabName+"-hack-div-slot",this.startTabIndex+this.getTabIndex(this.tabName+"-hack-div-slot"));break;case"numberLineTempFocusDiv":this.setTabIndex(this.tabName+"-hack-div-set-focus",this.startTabIndex+this.getTabIndex(this.tabName+"-hack-div-set-focus"));break;case"numberLineContainer":this.setTabIndex(this.tabName+"-graph-pane",this.startTabIndex+this.getTabIndex(this.tabName+"-graph-pane"));break;case"draggableItemsScreen":this.draggableItemsTabIndex.push(this.getTabIndex(this.tabName+"filled-dot")),this.draggableItemsTabIndex.push(this.getTabIndex(this.tabName+"unfilled-dot")),this.draggableItemsTabIndex.push(this.getTabIndex(this.tabName+"left-indicator")),this.draggableItemsTabIndex.push(this.getTabIndex(this.tabName+"right-indicator")),this.setTabIndex(this.tabName+""+this.draggableItems[0],this.startTabIndex+this.draggableItemsTabIndex[0]),this.setTabIndex(this.tabName+""+this.draggableItems[1],this.startTabIndex+this.draggableItemsTabIndex[1]),this.setTabIndex(this.tabName+""+this.draggableItems[2],this.startTabIndex+this.draggableItemsTabIndex[2]),this.setTabIndex(this.tabName+""+this.draggableItems[3],this.startTabIndex+this.draggableItemsTabIndex[3]);break;case"draggableContainer":this.setTabIndex(this.tabName+"dotted-box",this.startTabIndex+this.getTabIndex(this.tabName+"dotted-box"))}},resetDragDropTabIndex:function(a){this.setTabIndex(this.tabName+a,this.getTabIndex(this.tabName+a)-80)},setFocusOnDragItem:function(a){for(var b=this.draggableItems[0],c=this.draggableItems[0],d=1;4>d;d++)this.getTabIndex(this.tabName+this.draggableItems[d])<this.getTabIndex(this.tabName+b)&&(b=this.draggableItems[d]),this.getTabIndex(this.tabName+this.draggableItems[d])>this.getTabIndex(this.tabName+c)&&(c=this.draggableItems[d]);switch(a){case"first":this.setFocus(this.tabName+b);break;case"last":this.setFocus(this.tabName+c)}},_resetTabIndexes:function(a){switch(a){case"numberLineHackDiv":this.setTabIndex(this.tabName+"-hack-div-slot",this.getTabIndex(this.tabName+"-hack-div-slot")-this.startTabIndex);break;case"numberLineTempFocusDiv":this.setTabIndex(this.tabName+"-hack-div-set-focus",this.getTabIndex(this.tabName+"-hack-div-set-focus")-this.startTabIndex);break;case"numberLineContainer":this.setTabIndex(this.tabName+"-graph-pane",this.getTabIndex(this.tabName+"-graph-pane")-this.startTabIndex);break;case"draggableItemsScreen":this.setTabIndex(this.tabName+"filled-dot",this.getTabIndex(this.tabName+"filled-dot")-this.startTabIndex),this.setTabIndex(this.tabName+"unfilled-dot",this.getTabIndex(this.tabName+"unfilled-dot")-this.startTabIndex),this.setTabIndex(this.tabName+"left-indicator",this.getTabIndex(this.tabName+"left-indicator")-this.startTabIndex),this.setTabIndex(this.tabName+"right-indicator",this.getTabIndex(this.tabName+"right-indicator")-this.startTabIndex);break;case"draggableContainer":this.setTabIndex(this.tabName+"dotted-box",this.getTabIndex(this.tabName+"dotted-box")-this.startTabIndex)}this.unloadScreen(this.tabName+a)}},{generateAdvanceNumberLine:function(a){if(a){var b=new MathInteractives.Common.Components.Models.AdvanceNumberLine(a),c=new MathInteractives.Common.Components.Views.AdvanceNumberLine({model:b,el:$("#"+a.containerId)});return c}}}),MathInteractives.global.AdvanceNumberLine=MathInteractives.Common.Components.Views.AdvanceNumberLine}(),function(){MathInteractives.Common.Components.Models.AdvanceNumberLine=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:{manager:null,player:null,containerId:"",lineMinValue:-10,lineMaxValue:10,lineWidth:400,path:null,idPrefix:"",tickHeight:11,centerTickHeight:21,dragDrop:null,tickinterval:1,tabName:"",markingRange:null,startTabIndex:400},getPath:function(){return this.get("path")}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.numberLineAdvance=a(function(a,b,c,d,e){function f(a,b,c){var d,e="";return e+='\r\n            <div id="'+k((d=c&&c.idPrefix,typeof d===j?d.apply(a):d))+k((d=c&&c.tabName,typeof d===j?d.apply(a):d))+"-graph-pane-"+k(typeof a===j?a.apply(a):a)+'" class="point-container">\r\n              <div id="'+k((d=c&&c.idPrefix,typeof d===j?d.apply(a):d))+k((d=c&&c.tabName,typeof d===j?d.apply(a):d))+"-graph-pane-"+k(typeof a===j?a.apply(a):a)+'-point" class="point-box"><div class="graph-pane-divider-tick"></div></div>\r\n              <div id="'+k((d=c&&c.idPrefix,typeof d===j?d.apply(a):d))+k((d=c&&c.tabName,typeof d===j?d.apply(a):d))+"-graph-pane-"+k(typeof a===j?a.apply(a):a)+'-number" class="point-number">'+k(typeof a===j?a.apply(a):a)+"</div>\r\n            </div>\r\n          "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this;return i+='\ufeff<div class="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-drag-drop-numberline">\r\n<div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-drag-drop-container" class="drag-drop-containers"></div>\r\n\r\n<div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-graph-pane" class="graph-pane">\r\n\r\n        <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-graph-pane-left-arrow-container" class="graph-pane-left-arrow-container">\r\n          <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-graph-pane-left-arrow" class="graph-pane-left-arrow"></div>\r\n        </div>\r\n        \r\n        <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-graph-pane-middle-line" class="graph-pane-middle-line"></div>\r\n        <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-graph-pane-middle-graph-points" class="graph-pane-middle-graph-points">\r\n\r\n          ',g=c.each.call(b,b&&b.range,{hash:{},inverse:l.noop,fn:l.programWithDepth(1,f,e,b),data:e}),(g||0===g)&&(i+=g),i+='\r\n\r\n        </div>\r\n\r\n       \r\n        <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-graph-pane-right-arrow-container" class="graph-pane-right-arrow-container">\r\n        <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-graph-pane-right-arrow" class="graph-pane-right-arrow"></div>\r\n        </div>\r\n\r\n        <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-hack-div-slot" class="hack-div-slot"></div>\r\n        <div id="',(h=c.idPrefix)?g=h.call(b,{hash:{},data:e}):(h=b&&b.idPrefix,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g),(h=c.tabName)?g=h.call(b,{hash:{},data:e}):(h=b&&b.tabName,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'-hack-div-set-focus" class="hack-div-set-focus"></div>\r\n</div>\r\n</div>\r\n    '})}(),function(){"use strict";MathInteractives.Common.Components.Views.DragDropNumberLine=MathInteractives.Common.Player.Views.Base.extend({filePath:null,manager:null,player:null,idPrefix:null,xPoint:null,basePointOffset:0,basePoint:-10,maxPoint:10,marginInPoints:0,droppedCircleItem:"",droppedIndicatorItem:"",checkBtnView:null,sign:">",arrowWidth:27,basePosition:{filledDot:{left:"350",top:"180"},unfilledDot:{left:"410",top:"180"},rightArrow:{left:"538",top:"180"},leftArrow:{left:"475",top:"180"},widthArrowLine:27},screenDisable:!1,leftIndicatorCursorAtLeft:35,containerId:null,$numberLineView:null,tabName:"",tickinterval:1,initialize:function(){this.manager=this.model.get("manager"),this.player=this.model.getPlayer(),this.idPrefix=this.model.get("idPrefix"),this.filePath=this.model.get("path"),this.$numberLineView=this.model.get("numberLineView"),this.xPoint=this.model.get("xPoint"),this.sign=this.model.get("sign"),this.basePoint=this.model.get("minPoint"),this.maxPoint=this.model.get("maxPoint"),this.tabName=this.model.get("tabName"),this.render(),this._attachEvents(),this.setBasePosition()},_attachEvents:function(){var a=MathInteractives.Common.Utilities.Models.Utils,b=this.$el.find(".draggable-items"),c=b.length,d=0;for(b.off("mouseover").on("mouseover",$.proxy(this._mouseoverDragItems,this)),b.off("mouseout").on("mouseout",$.proxy(this._mouseoutDragItems,this)),d=0;c>d;d++)a.EnableTouch(b[d],{specificEvents:a.SpecificEvents.DRAGGABLE})},render:function(){var a=this,b={idPrefix:this.idPrefix,tabName:this.tabName};this.$el.html(MathInteractives.Common.Components.templates.dragDrop(b).trim()),this.$el.find(".drag-arrow-width").css({"background-image":'url("'+this.filePath.getImagePath("arrow-line")+'")',"background-position":"0px -4108px"}),this.$el.find("#"+this.idPrefix+this.tabName+"left-indicator .drag-arrow-image").css({"background-image":'url("'+this.filePath.getImagePath("purple-left-arrow-head")+'")',"background-position":"-18px -1470px"}),this.$el.find("#"+this.idPrefix+this.tabName+"right-indicator .drag-arrow-image").css({"background-image":'url("'+this.filePath.getImagePath("purple-right-arrow-head")+'")',"background-position":"-31px -1470px"}),this.$el.find("#"+this.idPrefix+this.tabName+"filled-dot").css({"background-image":'url("'+this.filePath.getImagePath("purple-dot")+'")',"background-position":"-453px -750px"}),this.$el.find("#"+this.idPrefix+this.tabName+"unfilled-dot").css({"background-image":'url("'+this.filePath.getImagePath("purple-dot-outline")+'")',"background-position":"-657px -643px"}),this.$el.find(".helper-image").css({"background-image":'url("'+this.filePath.getImagePath("dot-helper")+'")',"background-position":"0 -1470px"});this.$el.find("#"+this.idPrefix+this.tabName+"filled-dot").draggable({start:function(b,c){MathInteractives.global.SpeechStream.stopReading(),a.$el.find(this).hasClass("itemDropped")&&a.$el.find("#"+a.idPrefix+a.tabName+"filled-helper").show()},stop:function(b,c){a.$el.find(this).css({"z-index":"2"}),a.$el.find(this).hasClass("itemDropped")||a.$el.find(this).animate({position:"absolute",left:a.basePosition.filledDot.left+"px",top:a.basePosition.filledDot.top+"px"},500)},drag:function(b,c){a.$el.find(this).css("z-index","10")},containment:"document"}),this.$el.find("#"+this.idPrefix+this.tabName+"unfilled-dot").draggable({start:function(b,c){MathInteractives.global.SpeechStream.stopReading(),a.$el.find(this).hasClass("itemDropped")&&a.$el.find("#"+a.idPrefix+a.tabName+"unfilled-helper").show()},stop:function(b,c){a.$el.find(this).css({"z-index":"2"}),a.$el.find(this).hasClass("itemDropped")||a.$el.find(this).animate({position:"absolute",left:a.basePosition.unfilledDot.left+"px",top:a.basePosition.unfilledDot.top+"px"},500)},drag:function(b,c){a.$el.find(this).css("z-index","10")},containment:"document"}),this.$el.find("#"+this.idPrefix+this.tabName+"left-indicator").draggable({start:function(b,c){
MathInteractives.global.SpeechStream.stopReading();var d=this;""===d.id&&(d=d.parentNode),a.$el.find(d).hasClass("itemDropped")&&(a.$el.find(d).find(".drag-arrow-width").css("width","27px"),a.$el.find(d).css({"margin-left":"0px"}),a.$el.find("#"+a.idPrefix+a.tabName+"left-helper").show(),a.$el.find(d).css({width:"45px"}))},stop:function(b,c){a.$el.find(this).css({"z-index":"1"}),a.$el.find(this).hasClass("itemDropped")?setTimeout(function(){a.leftIndicatorCursorAtLeft=a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").width()-10,a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").draggable("option","cursorAt",{left:a.leftIndicatorCursorAtLeft})},600):a.$el.find(this).animate({position:"absolute",left:a.basePosition.leftArrow.left+"px",top:a.basePosition.leftArrow.top+"px","margin-left":"0px"},500,function(){a.leftIndicatorCursorAtLeft=35,a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").draggable("option","cursorAt",{left:a.leftIndicatorCursorAtLeft})})},drag:function(b,c){a.$el.find(this).css("z-index","10")},containment:"document"}),this.$el.find("#"+this.idPrefix+this.tabName+"right-indicator").draggable({start:function(b,c){MathInteractives.global.SpeechStream.stopReading();var d=this;""===d.id&&(d=d.parentNode),a.$el.find(d).hasClass("itemDropped")&&(a.$el.find(d).find(".drag-arrow-width").css("width",a.basePosition.widthArrowLine+"px"),a.$el.find(d).css({width:"46px"}),a.$el.find("#"+a.idPrefix+a.tabName+"right-helper").show())},stop:function(b,c){a.$el.find(this).css({"z-index":"1"}),a.$el.find(this).hasClass("itemDropped")?setTimeout(function(){a.$el.find("#"+a.idPrefix+a.tabName+"right-indicator").draggable("option","cursorAt",{left:0})},600):a.$el.find(this).animate({position:"absolute",left:a.basePosition.rightArrow.left+"px",top:a.basePosition.rightArrow.top+"px"},500,function(){a.$el.find("#"+a.idPrefix+a.tabName+"right-indicator").draggable("option","cursorAt",{left:0})})},drag:function(b,c){a.$el.find(this).css("z-index","10")},containment:"document"});this.$(".draggable-items").on("dragstart",$.proxy(function(a,b){this.trigger("number-line-drag-start",a,b)},this));var c,d,e=(a.$el.find(".graph-droppable").droppable({accept:a.$(".ui-draggable"),drop:function(b,c){var d=c.draggable[0];(""===d.id||void 0===d.id||null===d.id)&&(d=d.parentNode);var e=a.$el.find(d).offset().left;(d.id===a.idPrefix+""+a.tabName+"filled-dot"||d.id===a.idPrefix+""+a.tabName+"unfilled-dot")&&(e=a.$el.find(d).offset().left+a.$el.find(d).width()/2),d.id===a.idPrefix+""+a.tabName+"left-indicator"&&(e=a.$el.find(d).offset().left+a.$el.find(d).width()-7);var f=(a.$el.find(d).offset().top,a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"-graph-pane-"+a.basePoint).offset().left);a.basePointOffset=f;var g=a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"-graph-pane-"+a.maxPoint).offset().left,h=a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"-graph-pane-"+a.basePoint).offset().top,i=a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"-graph-pane-"+a.basePoint).offset().left-a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"-graph-pane-"+(a.basePoint+a.tickinterval)).offset().left;if(a.marginInPoints=i,e>=f&&g>=e){var j=(e-f)/i,k=parseInt(j,10);(j-k>.5||-.5>j-k)&&(k-=1);var l=f+k*i;if(d.id===a.idPrefix+""+a.tabName+"left-indicator")var l=f+k*i-a.$el.find(d).width()+7;h-=3,(d.id===a.idPrefix+""+a.tabName+"filled-dot"||d.id===a.idPrefix+""+a.tabName+"unfilled-dot")&&(h-=4,l-=12),a.$el.find(d).offset({left:l,top:h}).addClass("itemDropped")}else{var l=0;f>=e?(h-=3,d.id===a.idPrefix+""+a.tabName+"filled-dot"||d.id===a.idPrefix+""+a.tabName+"unfilled-dot"?(h-=4,l=f-12,a.$el.find(d).offset({left:l,top:h}).addClass("itemDropped")):l=d.id===a.idPrefix+""+a.tabName+"left-indicator"?f-a.$el.find(d).width()+7:f,a.$el.find(d).offset({left:l,top:h}).addClass("itemDropped")):(h-=3,d.id===a.idPrefix+""+a.tabName+"filled-dot"||d.id===a.idPrefix+""+a.tabName+"unfilled-dot"?(h-=4,l=g-12):l=d.id===a.idPrefix+""+a.tabName+"left-indicator"?g-a.$el.find(d).width()+7:g,a.$el.find(d).offset({left:l,top:h}).addClass("itemDropped"))}if(d.id===a.idPrefix+""+a.tabName+"filled-dot")"unfilled"===a.droppedCircleItem&&(a.$el.find("#"+a.idPrefix+a.tabName+"unfilled-dot").removeClass("itemDropped").animate({position:"absolute",left:a.basePosition.unfilledDot.left+"px",top:a.basePosition.unfilledDot.top+"px"},500),a.$el.find("#"+a.idPrefix+a.tabName+"unfilled-helper").show()),a.droppedCircleItem="filled",a.$el.find("#"+a.idPrefix+a.tabName+"filled-helper").hide();else if(d.id===a.idPrefix+""+a.tabName+"unfilled-dot")"filled"===a.droppedCircleItem&&(a.$el.find("#"+a.idPrefix+a.tabName+"filled-dot").removeClass("itemDropped").animate({position:"absolute",left:a.basePosition.filledDot.left+"px",top:a.basePosition.filledDot.top+"px"},500),a.$el.find("#"+a.idPrefix+a.tabName+"filled-helper").show()),a.droppedCircleItem="unfilled",a.$el.find("#"+a.idPrefix+a.tabName+"unfilled-helper").hide();else if(d.id===a.idPrefix+""+a.tabName+"left-indicator"){"right"===a.droppedIndicatorItem&&(a.$el.find("#"+a.idPrefix+a.tabName+"right-indicator").css({"margin-left":"0px",width:a.arrowWidth+13+"px"}),a.$el.find("#"+a.idPrefix+a.tabName+"right-indicator").find(".drag-arrow-width").width(a.arrowWidth),a.$el.find("#"+a.idPrefix+a.tabName+"right-indicator").animate({position:"absolute",left:a.basePosition.rightArrow.left+"px",top:a.basePosition.rightArrow.top+"px"},500).removeClass("itemDropped"),a.$el.find("#"+a.idPrefix+a.tabName+"right-helper").show()),a.droppedIndicatorItem="left",a.$el.find("#"+a.idPrefix+a.tabName+"left-helper").hide();var m=a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").css("margin-left","0px"),n=a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").find(".drag-arrow-width"),o=m.width(),p=m.offset().left-a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"-graph-pane-left-arrow").offset().left+o;m.draggable("disable"),n.animate({width:p-18+"px"},500),m.animate({width:p+"px","margin-left":-p+o+"px"},500,function(){a.$el.find(this).draggable("enable")})}else if(d.id===a.idPrefix+""+a.tabName+"right-indicator"){"left"===a.droppedIndicatorItem&&(a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").animate({position:"absolute",left:a.basePosition.leftArrow.left+"px",top:a.basePosition.leftArrow.top+"px"},500).removeClass("itemDropped"),a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").css({"margin-left":"0px",width:a.arrowWidth+18+"px"}),a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").find(".drag-arrow-width").width(a.arrowWidth),a.$el.find("#"+a.idPrefix+a.tabName+"left-helper").show(),a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").draggable("option","cursorAt",{left:35})),a.droppedIndicatorItem="right",a.$el.find("#"+a.idPrefix+a.tabName+"right-helper").hide();var q=a.$el.find("#"+a.idPrefix+a.tabName+"right-indicator"),r=a.$el.find("#"+a.idPrefix+a.tabName+"right-indicator").find(".drag-arrow-width"),p=a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"-graph-pane-right-arrow").offset().left-q.offset().left;q.draggable("disable"),r.animate({width:p+"px"},500),q.animate({width:p+18+"px"},500,function(){a.$el.find(this).draggable("enable")})}void 0!==a.viewFeedbackNegative&&null!==a.viewFeedbackNegative&&a.viewFeedbackNegative.closeHintFeedBackPanel(),""!==a.droppedCircleItem&&""!==a.droppedIndicatorItem&&a.model.setButtonState("active"),a.model.setFeedbackState("hide")},out:function(b,c){var d=c.draggable[0];""===d.id&&(d=d.parentNode),a.$el.find(d).hasClass("itemDropped")&&(a.$el.find(d).removeClass("itemDropped"),d.id===a.idPrefix+""+a.tabName+"filled-dot"?"filled"===a.droppedCircleItem&&(a.droppedCircleItem=""):d.id===a.idPrefix+""+a.tabName+"unfilled-dot"?"unfilled"===a.droppedCircleItem&&(a.droppedCircleItem=""):d.id===a.idPrefix+""+a.tabName+"left-indicator"?"left"===a.droppedIndicatorItem&&(a.droppedIndicatorItem=""):"right"===a.droppedIndicatorItem&&(a.droppedIndicatorItem="")),(""===a.droppedCircleItem||""===a.droppedIndicatorItem)&&a.model.setButtonState("disabled"),a.model.setFeedbackState("hide")}}),a.$numberLineView.$el.find(".graph-pane"));c=parseInt(e.css("top"),10)-7,d=parseInt(a.$numberLineView.lineWidth,10)+10,a.$el.find(".graph-droppable").css({left:e.css("left"),width:d+"px",top:c+"px"})},dropUsingKeys:function(a,b,c){var d=this,e=d.$el.find("#"+c),f=a,g=b;if(g-=3,e.css({"z-index":"1"}),c===d.idPrefix+""+d.tabName+"filled-dot"||c===d.idPrefix+""+d.tabName+"unfilled-dot"?(f-=12,e.css({"z-index":"2"}),g-=5):(e.css({"margin-left":"0px",width:d.arrowWidth+18+"px"}),e.find(".drag-arrow-width").width(d.arrowWidth)),c===d.idPrefix+""+d.tabName+"left-indicator"&&(f=f-d.$el.find(e).width()+7),d.marginInPoints=d.$numberLineView.$el.find("#"+d.idPrefix+d.tabName+"-graph-pane-"+d.basePoint).offset().left-d.$numberLineView.$el.find("#"+d.idPrefix+d.tabName+"-graph-pane-"+(d.basePoint+d.tickinterval)).offset().left,d.basePointOffset=d.$numberLineView.$el.find("#"+d.idPrefix+d.tabName+"-graph-pane-"+d.basePoint).offset().left,d.$el.find(e).offset({left:f,top:g}).addClass("itemDropped"),c===d.idPrefix+""+d.tabName+"filled-dot")"unfilled"===d.droppedCircleItem&&(d.$el.find("#"+d.idPrefix+d.tabName+"unfilled-dot").removeClass("itemDropped").animate({position:"absolute",left:d.basePosition.unfilledDot.left+"px",top:d.basePosition.unfilledDot.top+"px"},500),d.$el.find("#"+d.idPrefix+d.tabName+"unfilled-helper").show(),d.$numberLineView.resetDragDropTabIndex("unfilled-dot")),d.droppedCircleItem="filled",d.$el.find("#"+d.idPrefix+d.tabName+"filled-helper").hide();else if(c===d.idPrefix+""+d.tabName+"unfilled-dot")"filled"===d.droppedCircleItem&&(d.$el.find("#"+d.idPrefix+d.tabName+"filled-dot").removeClass("itemDropped").animate({position:"absolute",left:d.basePosition.filledDot.left+"px",top:d.basePosition.filledDot.top+"px"},500),d.$el.find("#"+d.idPrefix+d.tabName+"filled-helper").show(),d.$numberLineView.resetDragDropTabIndex("filled-dot")),d.droppedCircleItem="unfilled",d.$el.find("#"+d.idPrefix+d.tabName+"unfilled-helper").hide();else if(c===d.idPrefix+""+d.tabName+"left-indicator"){"right"===d.droppedIndicatorItem&&(d.$el.find("#"+d.idPrefix+d.tabName+"right-indicator").css({"margin-left":"0px",width:d.arrowWidth+13+"px"}),d.$el.find("#"+d.idPrefix+d.tabName+"right-indicator").find(".drag-arrow-width").width(d.arrowWidth),d.$el.find("#"+d.idPrefix+d.tabName+"right-indicator").animate({position:"absolute",left:d.basePosition.rightArrow.left+"px",top:d.basePosition.rightArrow.top+"px"},500).removeClass("itemDropped"),d.$el.find("#"+d.idPrefix+d.tabName+"right-helper").show(),d.$numberLineView.resetDragDropTabIndex("right-indicator"),d.updateFocusRect(d.tabName+"right-indicator")),d.droppedIndicatorItem="left",d.$el.find("#"+d.idPrefix+d.tabName+"left-helper").hide();var h=d.$el.find("#"+d.idPrefix+d.tabName+"left-indicator").css("margin-left","0px"),i=d.$el.find("#"+d.idPrefix+d.tabName+"left-indicator").find(".drag-arrow-width"),j=h.width(),k=h.offset().left-d.$numberLineView.$el.find("#"+d.idPrefix+d.tabName+"-graph-pane-left-arrow").offset().left+j;h.draggable("disable"),i.animate({width:k-18+"px"},500),h.animate({width:k+"px","margin-left":-k+j+"px"},500,function(){d.$el.find(this).draggable("enable"),d.updateFocusRect(d.tabName+"left-indicator")})}else if(c===d.idPrefix+""+d.tabName+"right-indicator"){"left"===d.droppedIndicatorItem&&(d.$el.find("#"+d.idPrefix+d.tabName+"left-indicator").animate({position:"absolute",left:d.basePosition.leftArrow.left+"px",top:d.basePosition.leftArrow.top+"px"},500).removeClass("itemDropped"),d.$el.find("#"+d.idPrefix+d.tabName+"left-indicator").css({"margin-left":"0px",width:d.arrowWidth+18+"px"}),d.$el.find("#"+d.idPrefix+d.tabName+"left-indicator").find(".drag-arrow-width").width(d.arrowWidth),d.$el.find("#"+d.idPrefix+d.tabName+"left-helper").show(),d.$el.find("#"+d.idPrefix+d.tabName+"left-indicator").draggable("option","cursorAt",{left:35}),d.$numberLineView.resetDragDropTabIndex("left-indicator"),d.updateFocusRect(d.tabName+"left-indicator")),d.droppedIndicatorItem="right",d.$el.find("#"+d.idPrefix+d.tabName+"right-helper").hide();var l=d.$el.find("#"+d.idPrefix+d.tabName+"right-indicator"),m=d.$el.find("#"+d.idPrefix+d.tabName+"right-indicator").find(".drag-arrow-width"),k=d.$numberLineView.$el.find("#"+d.idPrefix+d.tabName+"-graph-pane-right-arrow").offset().left-l.offset().left;l.draggable("disable"),m.animate({width:k+"px"},500),l.animate({width:k+18+"px"},500,function(){d.$el.find(this).draggable("enable"),d.updateFocusRect(d.tabName+"right-indicator")})}void 0!==d.viewFeedbackNegative&&null!==d.viewFeedbackNegative&&d.viewFeedbackNegative.closeHintFeedBackPanel(),""!==d.droppedCircleItem&&""!==d.droppedIndicatorItem&&d.model.setButtonState("active"),d.model.setFeedbackState("hide")},identifyCheck:function(){if("active"===this.model.getButtonState()){var a=this;if(a.model.setFeedbackState("show"),this.$el.find("#"+this.idPrefix+"feedback-pane-positive").html(""),this.$el.find("#"+this.idPrefix+"feedback-pane-negative").html(""),this.model.setButtonState("disabled"),"filled"!==this.droppedCircleItem&&"unfilled"!==this.droppedCircleItem||"left"!==this.droppedIndicatorItem&&"right"!==this.droppedIndicatorItem)return"Invalid Dropped";if("right"===this.droppedIndicatorItem&&("&ge;"===this.sign||">"===this.sign)||"left"===this.droppedIndicatorItem&&("&le;"===this.sign||"<"===this.sign)){if("filled"===this.droppedCircleItem){if("right"===this.droppedIndicatorItem){var b=a.$el.find("#"+a.idPrefix+a.tabName+"right-indicator").offset().left,c=a.$el.find("#"+a.idPrefix+a.tabName+"filled-dot").offset().left+12,d=b-c;if(2>d&&d>-2&&(b=c),b===c){var e=Math.round((b-this.basePointOffset)*this.tickinterval/(-1*this.marginInPoints)),f=this.basePoint+e;return f-1<=this.xPoint&&f+1>=this.xPoint&&"&ge;"===this.sign?(this.disableScreenItems(),"Success"):{filled:c,unfilled:"",left:"",right:b,point:this.basePoint+e,sign:"&ge;"}}return"Invalid Dropped"}var b=a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").offset().left+a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").width()-7,c=a.$el.find("#"+a.idPrefix+a.tabName+"filled-dot").offset().left+12,d=b-c;if(2>d&&d>-2&&(b=c),b===c){var e=Math.round((b-this.basePointOffset)*this.tickinterval/(-1*this.marginInPoints)),f=this.basePoint+e;return f-1<=this.xPoint&&f+1>=this.xPoint&&"&le;"===this.sign?(this.disableScreenItems(),"Success"):{filled:c,unfilled:"",left:b,right:"",point:this.basePoint+e,sign:"&le;"}}return"Invalid Dropped"}if("right"===this.droppedIndicatorItem){var b=a.$el.find("#"+a.idPrefix+a.tabName+"right-indicator").offset().left,c=a.$el.find("#"+a.idPrefix+a.tabName+"unfilled-dot").offset().left+12,d=b-c;if(2>d&&d>-2&&(b=c),b===c){var e=Math.round((b-this.basePointOffset)*this.tickinterval/(-1*this.marginInPoints)),f=this.basePoint+e;return f-1<=this.xPoint&&f+1>=this.xPoint&&">"===this.sign?(this.disableScreenItems(),"Success"):{filled:"",unfilled:c,left:"",right:b,point:this.basePoint+e,sign:"&gt;"}}return"Invalid Dropped"}var b=a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").offset().left+a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").width()-7,c=a.$el.find("#"+a.idPrefix+a.tabName+"unfilled-dot").offset().left+12,d=b-c;if(2>d&&d>-2&&(b=c),b===c){var e=Math.round((b-this.basePointOffset)*this.tickinterval/(-1*this.marginInPoints)),f=this.basePoint+e;return f-1<=this.xPoint&&f+1>=this.xPoint&&"<"===this.sign?(this.disableScreenItems(),"Success"):{filled:"",unfilled:c,left:b,right:"",point:this.basePoint+e,sign:"&lt;"}}return"Invalid Dropped"}var b;b="right"===a.droppedIndicatorItem?a.$el.find("#"+a.idPrefix+a.tabName+a.droppedIndicatorItem+"-indicator").offset().left:a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").offset().left+a.$el.find("#"+a.idPrefix+a.tabName+"left-indicator").width()-7;var c=a.$el.find("#"+a.idPrefix+a.tabName+a.droppedCircleItem+"-dot").offset().left+12,d=b-c;if(2>d&&d>-2&&(b=c),b===c){var e=Math.round((b-this.basePointOffset)*this.tickinterval/(-1*this.marginInPoints)+this.basePoint),g="";return g="left"===a.droppedIndicatorItem?"filled"===a.droppedCircleItem?"&le;":"&lt;":"filled"===a.droppedCircleItem?"&ge;":"&gt;",{filled:c,unfilled:"",left:"",right:b,point:e,sign:g}}return"Invalid Dropped"}},setBasePosition:function(){var a,b,c,d,e,f,g,h;d=this.$el.find("#"+this.idPrefix+this.tabName+"filled-dot").css("top").replace("px",""),c=this.$el.find("#"+this.idPrefix+this.tabName+"unfilled-dot").css("top").replace("px",""),g=this.$el.find("#"+this.idPrefix+this.tabName+"left-indicator").css("top").replace("px",""),e=this.$el.find("#"+this.idPrefix+this.tabName+"right-indicator").css("top").replace("px",""),b=this.$el.find("#"+this.idPrefix+this.tabName+"filled-dot").css("left").replace("px",""),a=this.$el.find("#"+this.idPrefix+this.tabName+"unfilled-dot").css("left").replace("px",""),h=this.$el.find("#"+this.idPrefix+this.tabName+"left-indicator").css("left").replace("px",""),f=this.$el.find("#"+this.idPrefix+this.tabName+"right-indicator").css("left").replace("px",""),this.basePosition={filledDot:{left:b,top:d},unfilledDot:{left:a,top:c},rightArrow:{left:f,top:e},leftArrow:{left:h,top:g},widthArrowLine:27}},disableScreenItems:function(){this.model.setButtonState("disabled"),this.$el.find("#"+this.idPrefix+this.tabName+"filled-dot").draggable("disable").css("cursor","default"),this.$el.find("#"+this.idPrefix+this.tabName+"unfilled-dot").draggable("disable").css("cursor","default"),this.$el.find("#"+this.idPrefix+this.tabName+"left-indicator").draggable("disable").css("cursor","default"),this.$el.find("#"+this.idPrefix+this.tabName+"right-indicator").draggable("disable").css("cursor","default"),this.screenDisable=!0},_mouseoverDragItems:function(a){var b=this;if(this.screenDisable!==!0)if(a.target.id===""+b.idPrefix+b.tabName+"filled-dot"||a.target.id===""+b.idPrefix+b.tabName+"unfilled-dot")this.$el.find(a.target).css("background-position","0px -37px");else{var c=a.target;(""===a.target.id||void 0===a.target.id||null===a.target.id||$(a.target).hasClass("acc-read-elem"))&&(c=a.target.parentNode);var d=c.id;this.$el.find(c).find(".drag-arrow-width").css("background-position","0px -4131px"),-1!==d.indexOf("left")?this.$el.find(c).find(".drag-arrow-image").css("background-position","-18px -1497px"):-1!==d.indexOf("right")&&this.$el.find(c).find(".drag-arrow-image").css("background-position","-31px -1497px")}},_mouseoutDragItems:function(a){var b=this;if(this.screenDisable!==!0)if(a.target.id===""+b.idPrefix+b.tabName+"filled-dot"||a.target.id===""+b.idPrefix+b.tabName+"unfilled-dot")this.$el.find(a.target).css("background-position","0px 0px");else{var c=a.target;(""===a.target.id||void 0===a.target.id||null===a.target.id||$(a.target).hasClass("acc-read-elem"))&&(c=a.target.parentNode);var d=c.id;this.$el.find(c).find(".drag-arrow-width").css("background-position","0px -4108px"),-1!==d.indexOf("left")?this.$el.find(c).find(".drag-arrow-image").css("background-position","-18px -1470px"):-1!==d.indexOf("right")&&this.$el.find(c).find(".drag-arrow-image").css("background-position","-31px -1470px")}}},{generateDragDrop:function(a){if(a){var b=new MathInteractives.Common.Components.Models.DragDropNumberLine(a),c=new MathInteractives.Common.Components.Views.DragDropNumberLine({model:b,el:$("#"+a.containerId)});return c}}}),MathInteractives.global.DragDropNumberLine=MathInteractives.Common.Components.Views.DragDropNumberLine}(),function(){"use strict";MathInteractives.Common.Components.Models.DragDropNumberLine=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:function(){return{containerId:null,filePath:null,manager:null,player:null,idPrefix:null,xPoint:null,minPoint:-10,maxPoint:10,sign:">",numberLineView:null,buttonState:"disabled",feedbackState:"show",tabName:"",tickinterval:1}},initialize:function(){},getPlayer:function(){return this.get("player")},setPlayer:function(a){this.set("player",a)},getButtonState:function(){return this.get("buttonState")},setButtonState:function(a){this.set("buttonState",a)},getFeedbackState:function(){return this.get("feedbackState")},setFeedbackState:function(a){this.set("feedbackState",a)}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.dragDrop=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'drag-drop-box" class="drag-drop-box">\r\n\r\n    \r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-pane-droppable" class="graph-droppable"></div>\r\n\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'dotted-box" class="drag-drop-dotted-box"></div>\r\n    \r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'filled-dot" class="drag-drop-filled-dot draggable-items">\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'filled-helper" class="helper-image drag-drop-helper-filled"></div>\r\n    </div>\r\n    \r\n    \r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'unfilled-dot" class="drag-drop-unfilled-dot draggable-items">\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'unfilled-helper" class="helper-image drag-drop-helper-unfilled"></div>\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'left-indicator" class="drag-drop-left-indicator draggable-items">\r\n      <div class="drag-arrow-image"></div><div class="drag-arrow-width"></div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'left-helper" class="helper-image drag-drop-helper-left"></div>\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-indicator" class="drag-drop-right-indicator draggable-items">\r\n      <div class="drag-arrow-width"></div><div class="drag-arrow-image"></div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'right-helper" class="helper-image drag-drop-helper-right"></div> \r\n    </div>\r\n    \r\n  </div>\r\n'})}(),function(){"use strict";MathInteractives.Common.Components.Views.DragDropPan=MathInteractives.Common.Player.Views.Base.extend({filePath:null,manager:null,player:null,idPrefix:null,xPoint:null,basePointOffset:0,basePoint:-10,maxPoint:10,marginInPoints:0,droppedCircleItem:"",droppedIndicatorItem:"",checkBtnView:null,sign:">",arrowWidth:60,basePosition:{circlePoint:{left:"353",top:"180"},arrowPoint:{left:"541",top:"180"},widthArrowLine:60,widthArrowHead:14,baseLeftIndicatorCursorAtLeft:45},screenDisable:!1,leftIndicatorCursorAtLeft:45,containerId:null,$numberLineView:null,tabName:"",tickinterval:1,currentDragArrow:"double",expectedDropArrow:"right",expectedDropDot:"filled",dotPointLeft:0,initialize:function(){this.manager=this.model.get("manager"),this.player=this.model.getPlayer(),this.idPrefix=this.model.get("idPrefix"),this.filePath=this.model.get("path"),this.$numberLineView=this.model.get("numberLineView"),this.xPoint=this.model.get("xPoint"),this.sign=this.model.get("sign"),this.basePoint=this.model.get("minPoint"),this.maxPoint=this.model.get("maxPoint"),this.tabName=this.model.get("tabName"),this.droppedCircleItem=this.model.get("droppedCircleItem"),this.tickinterval=this.model.get("tickinterval"),this.render();var a=this.model.get("equation"),b=MathInteractives.Common.Utilities.Models.Utils;if(a.a<0)switch(this.sign){case">":this.expectedDropArrow="left",this.expectedDropDot="unfilled";break;case"&ge;":this.expectedDropArrow="left",this.expectedDropDot="filled";break;case"&le;":this.expectedDropArrow="right",this.expectedDropDot="filled";break;case"<":this.expectedDropArrow="right",this.expectedDropDot="unfilled"}else switch(this.sign){case">":this.expectedDropArrow="right",this.expectedDropDot="unfilled";break;case"&ge;":this.expectedDropArrow="right",this.expectedDropDot="filled";break;case"&le;":this.expectedDropArrow="left",this.expectedDropDot="filled";break;case"<":this.expectedDropArrow="left",this.expectedDropDot="unfilled"}this.setBasePosition(),b.EnableTouch(this.$(".drag-drop-indicator"),{specificEvents:b.SpecificEvents.DRAGGABLE}),b.EnableTouch(this.$(".draggable-items"))},render:function(){var a=this,b={idPrefix:this.idPrefix,tabName:this.tabName};this.$el.html(MathInteractives.Common.Components.templates.dragDropPanBalance(b).trim()),this.$el.find(".drag-arrow-width").css({"background-image":'url("'+this.filePath.getImagePath("arrow-line-pan")+'")',"background-position":"0px -4049px"}),this.$el.find("#"+this.idPrefix+this.tabName+"arrow-indicator .drag-left-arrow-image").css({"background-image":'url("'+this.filePath.getImagePath("purple-left-arrow-head-pan")+'")'}),this.$el.find("#"+this.idPrefix+this.tabName+"arrow-indicator .drag-right-arrow-image").css({"background-image":'url("'+this.filePath.getImagePath("purple-right-arrow-head-pan")+'")'});var c=this.$el.find("#"+this.idPrefix+this.tabName+"-dot");"unfilled"===this.droppedCircleItem?c.css({"background-image":'url("'+this.filePath.getImagePath("purple-dot-outline-pan")+'")',"background-position":"-196px -977px"}):c.css({"background-image":'url("'+this.filePath.getImagePath("purple-dot-pan")+'")',"background-position":"-52px -1264px"}),this.$el.find(".helper-image").css({"background-image":'url("'+this.filePath.getImagePath("dot-helper-pan")+'")',"background-position":"-196px -967px;"}),this.$el.find("#"+a.idPrefix+a.tabName+"dot-helper").hide(),this.dotPointLeft=a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"graph-pane-"+a.xPoint).offset().left-c.width()/2;var d=a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"graph-pane").offset().top-1;c.offset({left:this.dotPointLeft,top:d}).addClass("itemDropped").css({"z-index":"2",visibility:"hidden"}),this.$numberLineView.model.on("change:currentDotItemType",$.proxy(a.twinDotItem,a));var e=this.$el.find("#"+this.idPrefix+this.tabName+"arrow-indicator").removeClass("inactive");e.draggable({start:function(a,b){MathInteractives.global.SpeechStream.stopReading()},stop:function(b,c){a.$el.find(this).css({"z-index":"1"}),"left"===a.currentDragArrow?a.$el.find(this).hasClass("itemDropped")?setTimeout(function(){a.leftIndicatorCursorAtLeft=e.width()-10,e.draggable("option","cursorAt",{left:a.leftIndicatorCursorAtLeft})},600):(a.currentDragArrow="double",e.find(".drag-left-arrow-image,.drag-right-arrow-image").show(),a.$el.find(this).animate({position:"absolute",left:a.basePosition.arrowPoint.left+"px",top:a.basePosition.arrowPoint.top+"px","margin-left":"0px"},500,function(){})):a.$el.find(this).hasClass("itemDropped")?setTimeout(function(){e.draggable("option","cursorAt",{left:0})},600):(a.currentDragArrow="double",e.find(".drag-left-arrow-image, .drag-right-arrow-image").show(),a.$el.find(this).animate({position:"absolute",left:a.basePosition.arrowPoint.left+"px",top:a.basePosition.arrowPoint.top+"px"},500,function(){}))},drag:function(b,c){a.$el.find(this).css("z-index","10");var d=a.$el.find("#"+a.idPrefix+a.tabName+"-dot"),f=e.find(".drag-left-arrow-image"),g=e.find(".drag-right-arrow-image"),h=e.find(".drag-drop-helper-arrow").offset();if($(this).offset().top>=d.offset().top-50&&$(this).offset().top<=d.offset().top+50){var i=a.$el.find("#"+a.idPrefix+a.tabName+"-dot").offset().left;i>=h.left?(a.currentDragArrow="left",f.show(),g.hide()):(a.currentDragArrow="right",g.show(),f.hide())}else"double"!==a.currentDragArrow&&(a.currentDragArrow="double",f.show(),g.show())},containment:$("#"+a.idPrefix+"activity-area-"+a.player.getCurrentActiveTab())});this.$(".draggable-items").on("dragstart",$.proxy(function(a,b){this.trigger("number-line-drag-start",a,b)},this));var f,g=(a.$el.find(".graph-droppable").droppable({accept:a.$(".ui-draggable"),drop:function(b,c){var f=c.draggable[0];(""===f.id||void 0===f.id||null===f.id)&&(f=f.parentNode);var g=a.dotPointLeft;if(f.id===a.idPrefix+""+a.tabName+"arrow-indicator"&&("left"===a.currentDragArrow?g=g-a.$el.find(f).width()+27:g+=14),a.marginInPoints=a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"graph-pane-"+a.basePoint).offset().left-a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"graph-pane-"+(a.basePoint+a.tickinterval)).offset().left,a.$el.find(f).offset({left:g,top:d}).addClass("itemDropped"),f.id===a.idPrefix+""+a.tabName+"arrow-indicator")if("left"===a.currentDragArrow)if("left"===a.expectedDropArrow&&a.droppedCircleItem===a.expectedDropDot){a.droppedIndicatorItem="left",a.$el.find("#"+a.idPrefix+a.tabName+"arrow-helper").hide();var h=e.css("margin-left","0px"),i=e.find(".drag-arrow-width"),j=h.width(),k=h.offset().left-a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"graph-pane-left-arrow").offset().left+j;e.find(".drag-arrow-width").css("background-position","0px -4095px"),e.find(".drag-left-arrow-image").css("background-position","-666px -475px"),e.find(".drag-right-arrow-image").css("background-position","-439px -804px"),a.disableScreenItems(),a.model.setCorrectDropValue(!0),i.animate({width:k-27+"px"},500),h.animate({width:k+"px","margin-left":-k+j+"px"},500,function(){var b=e.find(".drag-right-arrow-image");a._pulsateDragItems(b),a.updateFocusRect(a.tabName+"arrow-indicator"),a.screenDisable=!0})}else a.currentDragArrow="double",a.trigger("disableSlider"),e.find(".drag-left-arrow-image").show(),a.$el.find("#"+a.idPrefix+a.tabName+"arrow-indicator").find(".drag-right-arrow-image").show(),e.animate({position:"absolute",left:a.basePosition.arrowPoint.left+"px",top:a.basePosition.arrowPoint.top+"px"},500,function(){a.trigger("enableSlider")}).removeClass("itemDropped");else if("right"===a.expectedDropArrow&&a.droppedCircleItem===a.expectedDropDot){a.droppedIndicatorItem="right",a.$el.find("#"+a.idPrefix+a.tabName+"arrow-helper").hide();var l=e.find(".drag-arrow-width"),k=a.$numberLineView.$el.find("#"+a.idPrefix+a.tabName+"graph-pane-right-arrow").offset().left-e.offset().left;e.find(".drag-arrow-width").css("background-position","0px -4095px"),e.find(".drag-left-arrow-image").css("background-position","-666px -475px"),
e.find(".drag-right-arrow-image").css("background-position","-439px -804px"),a.disableScreenItems(),a.model.setCorrectDropValue(!0),l.animate({width:k+"px"},500),e.animate({width:k+18+"px"},500,function(){var b=e.find(".drag-right-arrow-image");a._pulsateDragItems(b),a.updateFocusRect(a.tabName+"arrow-indicator"),a.screenDisable=!0})}else a.currentDragArrow="double",a.trigger("disableSlider"),e.find(".drag-left-arrow-image").show(),a.$el.find("#"+a.idPrefix+a.tabName+"arrow-indicator").find(".drag-right-arrow-image").show(),e.animate({position:"absolute",left:a.basePosition.arrowPoint.left+"px",top:a.basePosition.arrowPoint.top+"px"},500,function(){a.trigger("enableSlider")}).removeClass("itemDropped");void 0!==a.viewFeedbackNegative&&null!==a.viewFeedbackNegative&&a.viewFeedbackNegative.closeHintFeedBackPanel(),""!==a.droppedCircleItem&&""!==a.droppedIndicatorItem&&a.model.setButtonState("active"),a.model.setFeedbackState("hide")},out:function(b,c){var d=c.draggable[0];""===d.id&&(d=d.parentNode),a.$el.find(d).hasClass("itemDropped")&&(a.$el.find(d).removeClass("itemDropped"),d.id===a.idPrefix+""+a.tabName+"arrow-indicator"?"left"===a.droppedIndicatorItem&&(a.droppedIndicatorItem=""):"right"===a.droppedIndicatorItem&&(a.droppedIndicatorItem="")),(""===a.droppedCircleItem||""===a.droppedIndicatorItem)&&a.model.setButtonState("disabled"),a.model.setFeedbackState("hide")}}),a.$numberLineView.$el.find(".graph-pane"));f=parseInt(a.$numberLineView.lineWidth,10)+10,a.$el.find(".graph-droppable").css({width:f+"px"}).offset(g.offset()).offset({top:g.offset().top-5})},twinDotItem:function(){"filled"===this.droppedCircleItem?(this.droppedCircleItem="unfilled",this.$el.find("#"+this.idPrefix+this.tabName+"-dot").css({"background-image":'url("'+this.filePath.getImagePath("purple-dot-outline-pan")+'")',"background-position":"-196px -977px"})):(this.droppedCircleItem="filled",this.$el.find("#"+this.idPrefix+this.tabName+"-dot").css({"background-image":'url("'+this.filePath.getImagePath("purple-dot-pan")+'")',"background-position":"-52px -1264px"}))},_pulsateDragItems:function(a){var b,c=1.3,d=1,e=.01,f=d,g=0,h=3,i=1,j=$("#"+this.idPrefix+this.tabName+"graph-pane-slider-handle");b=setInterval($.proxy(function(){switch(g){case 0:f+=e,f=parseFloat(f.toFixed(2)),f===c&&g++;break;case 1:f-=e,f=parseFloat(f.toFixed(2)),f===d&&g++;break;default:i++,h>=i?g=0:clearInterval(b)}a.parent().css({"-ms-transform":"scaleY("+f+")","-webkit-transform":"scaleY("+f+")","-moz-transform":"scaleY("+f+")",transform:"scaleY("+f+")"}),j.css({"-ms-transform":"scale("+f+")","-webkit-transform":"scale("+f+")","-moz-transform":"scale("+f+")",transform:"scale("+f+")"})},this),17)},dropUsingKeys:function(a,b,c){var d,e=this,f=this.$el.find("#"+this.idPrefix+this.tabName+"arrow-indicator"),g=f.find(".drag-left-arrow-image"),h=f.find(".drag-right-arrow-image"),i=(f.find(".drag-drop-helper-arrow").offset(),a),j=b;if(j-=3,f.css({"z-index":"1"}),1===c?(h.hide(),i=i-f.width()+17):(g.hide(),i+=5),e.marginInPoints=e.$numberLineView.$el.find("#"+e.idPrefix+e.tabName+"graph-pane-"+e.basePoint).offset().left-e.$numberLineView.$el.find("#"+e.idPrefix+e.tabName+"graph-pane-"+(e.basePoint+e.tickinterval)).offset().left,f.offset({left:i,top:j}).addClass("itemDropped"),d={expectedArrow:e.expectedDropArrow,droppedArrow:e.currentDragArrow,expectedCircle:e.expectedDropDot,droppedCircle:e.droppedCircleItem},1===c)if(e.currentDragArrow="left",d={expectedArrow:e.expectedDropArrow,droppedArrow:e.currentDragArrow,expectedCircle:e.expectedDropDot,droppedCircle:e.droppedCircleItem},"left"===e.expectedDropArrow&&e.droppedCircleItem===e.expectedDropDot){e.droppedIndicatorItem="left",e.$el.find("#"+e.idPrefix+e.tabName+"arrow-helper").hide();var k=f.css("margin-left","0px"),l=f.find(".drag-arrow-width"),m=k.width(),n=k.offset().left-e.$numberLineView.$el.find("#"+e.idPrefix+e.tabName+"graph-pane-left-arrow").offset().left+m;f.find(".drag-arrow-width").css("background-position","0px -4095px"),f.find(".drag-left-arrow-image").css("background-position","-666px -475px"),f.find(".drag-right-arrow-image").css("background-position","-439px -804px"),e.disableScreenItems(),e.model.setCorrectDropValue(!0),l.animate({width:n-27+"px"},500),k.animate({width:n+"px","margin-left":-n+m+"px"},500,function(){var a=f.find(".drag-right-arrow-image");e._pulsateDragItems(a),e.screenDisable=!0})}else e.currentDragArrow="double",e.trigger("disableSlider"),f.find(".drag-left-arrow-image").show(),e.$el.find("#"+e.idPrefix+e.tabName+"arrow-indicator").find(".drag-right-arrow-image").show(),f.animate({position:"absolute",left:e.basePosition.arrowPoint.left+"px",top:e.basePosition.arrowPoint.top+"px"},500,function(){e.trigger("enableSlider")}).removeClass("itemDropped"),e.setFocus(e.tabName+"dotted-box");else if(e.currentDragArrow="right",d={expectedArrow:e.expectedDropArrow,droppedArrow:e.currentDragArrow,expectedCircle:e.expectedDropDot,droppedCircle:e.droppedCircleItem},"right"===e.expectedDropArrow&&e.droppedCircleItem===e.expectedDropDot){e.droppedIndicatorItem="right",e.$el.find("#"+e.idPrefix+e.tabName+"arrow-helper").hide();var o=f.find(".drag-arrow-width"),n=e.$numberLineView.$el.find("#"+e.idPrefix+e.tabName+"graph-pane-right-arrow").offset().left-f.offset().left;f.find(".drag-arrow-width").css("background-position","0px -4095px"),f.find(".drag-left-arrow-image").css("background-position","-666px -475px"),f.find(".drag-right-arrow-image").css("background-position","-439px -804px"),e.disableScreenItems(),e.model.setCorrectDropValue(!0),o.animate({width:n+"px"},500),f.animate({width:n+18+"px"},500,function(){var a=f.find(".drag-right-arrow-image");e._pulsateDragItems(a),e.screenDisable=!0})}else e.currentDragArrow="double",e.trigger("disableSlider"),f.find(".drag-left-arrow-image").show(),e.$el.find("#"+e.idPrefix+e.tabName+"arrow-indicator").find(".drag-right-arrow-image").show(),f.animate({position:"absolute",left:e.basePosition.arrowPoint.left+"px",top:e.basePosition.arrowPoint.top+"px"},500,function(){e.trigger("enableSlider")}).removeClass("itemDropped"),e.setFocus(e.tabName+"dotted-box");return void 0!==e.viewFeedbackNegative&&null!==e.viewFeedbackNegative&&e.viewFeedbackNegative.closeHintFeedBackPanel(),""!==e.droppedCircleItem&&""!==e.droppedIndicatorItem&&e.model.setButtonState("active"),e.model.setFeedbackState("hide"),d},setBasePosition:function(){var a,b,c=this,d=c.$numberLineView.$el.find("#"+c.idPrefix+c.tabName+"graph-pane-"+c.xPoint).offset().left,e=c.$numberLineView.$el.find("#"+c.idPrefix+c.tabName+"graph-pane-"+c.xPoint).offset().top;a=this.$el.find("#"+this.idPrefix+this.tabName+"arrow-indicator").css("top").replace("px",""),b=this.$el.find("#"+this.idPrefix+this.tabName+"arrow-indicator").css("left").replace("px",""),this.basePosition={circlePoint:{left:d,top:e},arrowPoint:{left:b,top:a},widthArrowLine:60,widthArrowHead:14},this.basePosition.baseLeftIndicatorCursorAtLeft=this.basePosition.widthArrowLine-this.basePosition.widthArrowHead,this.leftIndicatorCursorAtLeft=this.basePosition.baseLeftIndicatorCursorAtLeft},events:{"mouseover .draggable-items":"_mouseoverDragItems","mouseout  .draggable-items":"_mouseoutDragItems"},disableScreenItems:function(){this.$el.find("#"+this.idPrefix+this.tabName+"arrow-indicator").draggable("disable").css("cursor","default").addClass("inactive"),this.screenDisable=!0},_mouseoverDragItems:function(a){var b=this.$el.find("#"+this.idPrefix+this.tabName+"arrow-indicator");if(!b.hasClass("inactive"))if(a.target.id===""+this.idPrefix+this.tabName+"filled-dot"||a.target.id===""+this.idPrefix+this.tabName+"unfilled-dot")this.$el.find(a.target).css("background-position","0px -37px");else{var c=a.target;(""===a.target.id||void 0===a.target.id||null===a.target.id||$(a.target).hasClass("acc-read-elem"))&&(c=a.target.parentNode),this.$el.find(c).find(".drag-arrow-width").css("background-position","0px -4072px"),this.$el.find(c).find(".drag-left-arrow-image").css("background-position","-666px -448px"),this.$el.find(c).find(".drag-right-arrow-image").css("background-position","-439px -777px")}},_mouseoutDragItems:function(a){var b=this.$el.find("#"+this.idPrefix+this.tabName+"arrow-indicator");if(!b.hasClass("inactive"))if(a.target.id===""+this.idPrefix+this.tabName+"filled-dot"||a.target.id===""+this.idPrefix+this.tabName+"unfilled-dot")this.$el.find(a.target).css("background-position","0px 0px");else{var c=a.target;(""===a.target.id||void 0===a.target.id||null===a.target.id||$(a.target).hasClass("acc-read-elem"))&&(c=a.target.parentNode),this.$el.find(c).find(".drag-arrow-width").css("background-position","0px -4049px"),this.$el.find(c).find(".drag-left-arrow-image").css("background-position","-666px -421px"),this.$el.find(c).find(".drag-right-arrow-image").css("background-position","-439px -750px")}}},{generateDragDropPanBalance:function(a){if(a){var b=new MathInteractives.Common.Components.Models.DragDropPan(a),c=new MathInteractives.Common.Components.Views.DragDropPan({model:b,el:$("#"+a.containerId)});return c}}}),MathInteractives.global.DragDropPan=MathInteractives.Common.Components.Views.DragDropPan}(),function(){"use strict";MathInteractives.Common.Components.Models.DragDropPan=MathInteractives.Common.Player.Models.Base.extend({defaults:function(){return{containerId:null,filePath:null,manager:null,player:null,idPrefix:null,xPoint:null,minPoint:-10,maxPoint:10,sign:">",numberLineView:null,buttonState:"disabled",feedbackState:"show",tabName:"",tickinterval:1,droppedCircleItem:"",equation:null,correctEleDrop:!1}},initialize:function(){},getPlayer:function(){return this.get("player")},setPlayer:function(a){this.set("player",a)},getButtonState:function(){return this.get("buttonState")},setButtonState:function(a){this.set("buttonState",a)},getFeedbackState:function(){return this.get("feedbackState")},setFeedbackState:function(a){this.set("feedbackState",a)},getCorrectDropValue:function(){return this.get("correctEleDrop")},setCorrectDropValue:function(a){this.set("correctEleDrop",a)}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.dragDropPanBalance=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'drag-drop-box" class="drag-drop-box">\r\n\r\n    \r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-pane-droppable" class="graph-droppable"></div>\r\n\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'dotted-box" class="drag-drop-dotted-box-pan"></div>\r\n    \r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-dot" class="drag-drop-dot draggable-items">\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'dot-helper" class="helper-image drag-drop-helper-dot"></div>\r\n    </div>\r\n    \r\n    \r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'arrow-indicator" class="drag-drop-indicator draggable-items">\r\n      <div class="drag-left-arrow-image"></div><div class="drag-arrow-width"></div><div class="drag-right-arrow-image"></div>\r\n      <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.tabName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.tabName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'arrow-helper" class="helper-image drag-drop-helper-arrow"></div>\r\n    </div>\r\n    \r\n  </div>\r\n'})}(),function(){"use strict";MathInteractives.Common.Components.Models.CustomCombobox=Backbone.Model.extend({defaults:function(){return{elementID:null,idPrefix:null,defaultText:null,selectedItem:null,imagePath:null,isHintEnabled:!1}},setElementID:function(a){this.set("elementId",a)},setIdPrefix:function(a){this.set("idPrefix",a)},setDefaultText:function(a){this.set("defaultText",a)},setSelectedItem:function(a){this.set("selectedItem",a)},setImagePath:function(a){this.set("imagePath",a)},getElementID:function(){return this.get("elementID")},getIdPrefix:function(){return this.get("idPrefix")},getDefaultText:function(){return this.get("defaultText")},getSelectedItem:function(){return this.get("selectedItem")},getImagePath:function(){return this.get("imagePath")},produceSavedData:function(){var a={elementID:this.getElementID(),defaultText:this.getDefaultText(),imagePath:this.getImagePath(),selectedItem:this.getSelectedItem()};return a}})}(),function(){"use strict";MathInteractives.Common.Components.Views.CustomCombobox=MathInteractives.Common.Player.Views.Base.extend({contextElement:null,_manager:null,_screenID:"combobox",items:{},groups:{},openComboBoxes:{},selectedIndex:{},comboCollection:null,highlightedIndex:-1,ignoreBlur:!1,touchOnCombo:!1,hintDelay:600,disabledItemsSelectionEnabled:!1,initialize:function(){this.hintElement=$('<span class="combo-hint"></span>'),$("body").append(this.hintElement),this.tempDiv=$("<div>",{id:"CustomComboTempFocusDiv"}),$("body").append(this.tempDiv);var a=this;this.defaultEventPrevented=!1,window.addEventListener("mousedown",function(){a.defaultEventPrevented=!1})},setContextElement:function(a){this.contextElement=a},getContextElement:function(){return this.contextElement},parseDOM:function(){this.contextElement&&this._replaceAllComboBoxes()},_replaceAllComboBoxes:function(){var a=this;$(this.contextElement.find("select")).each(function(){a._replaceComboBox(this.id)})},_replaceComboBox:function(a){var b,c,d=this,e=null,f=function(a){if(b=window.scrollY||0,c=window.scrollX||0,g(),!$(this).hasClass("customComboDisabled")){var f,h=$(this).attr("id");f=$("#"+h+"-selected-item").html(),"none"!==$("#"+h+"-default-text").css("display")&&(f=$("#"+h+"-default-text").html()),f=f.replace(/&nbsp;/g,""),e=setTimeout(function(){d.showHint(f,h)},d.hintDelay),d.setPos(a.clientX+c+15,a.clientY+b+15)}},g=function(){d.hideHint(),clearTimeout(e)};this.isTouchDevice();$("#"+a).each(function(){var b=$(this),c=$("<div>");c.attr("name",b.attr("name")),c.attr("class",b.attr("class")),c.attr("style",b.attr("style")),c.addClass("customCombo"),$(c).on("mousemove",f),$(c).on("mouseleave",g),$(c).on("click",g);var e=b.css("position");c.css("position",e),"absolute"!==e&&"relative"!==e&&c.css("position","relative"),c.insertAfter("#"+this.id),c.attr("id",this.id);var h,i,j,k=[],l=[],m=b.find("option"),n=m.length;for(d.selectedIndex[this.id]=0===n?-1:0,i=0;n>i;i++){var o=m[i],p=$(o);if(p.is("option"))h={},h.value=p.attr("value"),h.text=p.html(),"undefined"!=typeof d._manager&&(h.acc=d._manager.getAccMessage(a,i)),h.enabled="disabled"!==p.attr("disabled"),h.isOptGroupChild=!1,k.push(h),l.push(h),"selected"===p.attr("selected")&&(d.selectedIndex[this.id]=l.length-1);else if(p.is("optgroup")){var q={};q.label=p.attr("label"),q.data=[];var r=p.children(),s=r.length;for(j=0;s>j;j++){var t=$(r[j]);t.is("option")&&(h={},h.value=t.attr("value"),h.text=t.html(),"undefined"!=typeof d._manager&&(h.acc=d._manager.getAccMessage(a,i)),h.enabled="disabled"!==t.attr("disabled"),h.isOptGroupChild=!0,l.push(h),"selected"===t.attr("selected")&&(d.selectedIndex[this.id]=l.length-1),q.data.push(h))}k.push(q)}}$(this).remove(),d._addComboBox(this.id,k,l),d._adjustWidth(this.id)})},_addComboBox:function(a,b,c){var d=this;this.items[a]={},this.items[a].data=b,this.items[a].linear=c;var e=this.getContextElement().find("#"+a)[0],f=document.createElement("div");$(e).data("customDisabled",!1);var g=this.getSetterGetterFunctions();try{Object.defineProperty(e,"selectedIndex",{get:g.getSelectedIndex,set:g.setSelectedIndex}),Object.defineProperty(e,"selectedValue",{get:g.getSelectedValue,set:g.setSelectedValue}),Object.defineProperty(e,"arrOptions",{get:g.getarrOptions,set:g.setarrOptions}),Object.defineProperty(e,"disabled",{get:g.getDisabled,set:g.setDisabled}),Object.defineProperty(e,"group",{get:g.getGroupName,set:g.setGroupName})}catch(h){e.__defineGetter__("selectedIndex",g.getSelectedIndex),e.__defineSetter__("selectedIndex",g.setSelectedIndex),e.__defineGetter__("selectedValue",g.getSelectedValue),e.__defineSetter__("selectedValue",g.setSelectedValue),e.__defineGetter__("arrOptions",g.getarrOptions),e.__defineSetter__("arrOptions",g.setarrOptions),e.__defineGetter__("disabled",g.getDisabled),e.__defineSetter__("disabled",g.setDisabled),e.__defineGetter__("group",g.getGroupName),e.__defineSetter__("group",g.setGroupName)}$(e).on("enableDisableCombo",function(){var a=$(this).data("customDisabled");d.enableDisableCombobox(this.id,a)}),$(e).on("comboGroupChange",function(){d._adjustWidth(this.id)}),f.id=a+"-combo-holder",$(f).addClass("customComboHolder");var i=document.createElement("div");i.id=a+"-selected-item",$(i).addClass("customComboSelectedItem typography-label").css("line-height",parseInt($(e).height()-2)+"px");var j=document.createElement("div"),k=this.comboCollection[$(e).attr("id")].get("imagePath");$(j).addClass("customComboButton").addClass("customComboButtonImage"),null!==k&&void 0!==k&&0!==k.trim().length&&$(j).css("background-image","url("+this.comboCollection[$(e).attr("id")].get("imagePath")+")"),e.appendChild(f),f.appendChild(i),f.appendChild(j),$(f).css("height",$(e).height()-2);var l=this.comboCollection[$(e).attr("id")].get("selectedItem"),m=this.comboCollection[$(e).attr("id")].get("defaultText");null!==l&&void 0!==l||null!==m&&void 0!==m||(l=0),$(e).on("click",$.proxy(d._openDropDown,d)).on("keydown",$.proxy(d.onKeyDown,d)).on("mousedown",function(){$("#"+this.id+"-combo-holder > .customComboButton").removeClass("customComboButtonImage").removeClass("customComboButtonImageHover").addClass("customComboButtonImageActive")}).on("mouseover",function(){$("#"+this.id+"-combo-holder > .customComboButton").removeClass("customComboButtonImage").removeClass("customComboButtonImageActive").addClass("customComboButtonImageHover")}).on("mouseup",function(){$("#"+this.id+"-combo-holder > .customComboButton").removeClass("customComboButtonImage").removeClass("customComboButtonImageActive").addClass("customComboButtonImageHover")}).on("mouseout",function(){$("#"+this.id+"-combo-holder > .customComboButton").removeClass("customComboButtonImageHover").removeClass("customComboButtonImageActive").addClass("customComboButtonImage")}),MathInteractives.Common.Utilities.Models.Utils.EnableTouch($(e));var n=document.createElement("div");n.id=a+"-default-text",$(n).addClass("customComboDefaultText typography-label").append(m),$(e).append(n),$(n).css({width:$(e).width()-$(j).width()}),$(i).css({width:$(e).width()-$(j).width()}),null!==l&&void 0!==l&&l>=0?($(e).prop("selectedIndex",l),$(n).empty().hide()):($(n).show(),d.selectedIndex[e.id]=-1)},enableDisableCombobox:function(a,b){b?(this.getContextElement().find("#"+a).addClass("customComboDisabled"),this.getContextElement().find("#"+a+"-combo-holder").addClass("customComboHolderDisabled"),this.getContextElement().find("#"+a+"-combo-holder > .customComboButton").addClass("customComboButtonImageDisabled")):(this.getContextElement().find("#"+a).removeClass("customComboDisabled"),this.getContextElement().find("#"+a+"-combo-holder").removeClass("customComboHolderDisabled"),this.getContextElement().find("#"+a+"-combo-holder > .customComboButton").removeClass("customComboButtonImageDisabled"))},_adjustWidth:function(a){if(document.getElementById(a).style.width&&this.items[a].widthAdjusted!==!0)this.items[a].widthAdjusted=!1,this.refreshDOM();else{var b,c,d,e,f=0,g=document.createElement("div"),h=this.items[a].linear.length,i=$(g).addClass("customComboSelectedItem");for($("body").append(g),e=0;h>e;e++)c=this.items[a].linear[e],b=c.isOptGroupChild?MathInteractives.Common.Components.Views.CustomCombobox.LEFT_OFFSET_FOR_OPTGROUP_ITEM:"",b+=c.text,g.innerHTML=b,i.css("font-family",this.getContextElement().find("#"+a).css("font-family")),d=i.getTextWidth(),d>f&&(f=d);for(i.addClass("customComboGroup"),e=0;e<this.items[a].data.length;e++)null!==this.items[a].data[e].label&&(b=this.items[a].data[e].label,g.innerHTML=b,d=i.getTextWidth(),d>f&&(f=d));if(i.remove(),0!==f){f+=34;var k=this.getContextElement().find("#"+a),l=k.prop("group");if(this.groups[l])for(j=0;j<this.groups[l].length;j++){var m=this.getContextElement().find("#"+this.groups[l][j]),n=parseInt(m.css("width"),10);n>f?f=n:(m.css("width",f),this.items[this.groups[l][j]].widthAdjusted=!0)}k.css("width",f)}this.items[a].widthAdjusted=!0}this.$(".customComboButton").css({width:"15%"}),this.$(".customComboSelectedItem").css({width:"85%"})},getSetterGetterFunctions:function(){var a=this,b=this.getContextElement().parents(".de-mathematics-interactive").find(".player"),c={};return c.setSelectedIndex=function(c){if(-1===c){var d=$(this),e=a.comboCollection[$(this).attr("id")].get("defaultText");return d.data("customSelectedIndex",-1),a.comboCollection[d[0].id].setSelectedItem(null),a.selectedIndex[d.attr("id")]=-1,d.val(""),null!==e&&void 0!==e&&d.find(".customComboDefaultText").append(e).show(),d.find(".customComboSelectedItem").text(""),d.data("customSelectedIndex",-1)}c=parseInt(c,10);var f,d=$(this),g=d.data("customSelectedIndex"),h=a.items[this.id].linear.length;if(0===h)return d.data("customSelectedIndex",-1),d.data("customSelectedIndex",-1);if("NaN"===c.toString()&&(c=0),parseInt(c,10)<0?c=0:parseInt(c,10)>h-1&&(c=h-1),a.disabledItemsSelectionEnabled||a.items[this.id].linear[c].enabled!==!1)return a.items[this.id].linear[c].enabled===!1?b.find("#"+this.id+"-selected-item").addClass("customComboItemDisabled"):b.find("#"+this.id+"-selected-item").removeClass("customComboItemDisabled"),d.data("customSelectedIndex",c),a.setSelectedIndex(this.id,c),c;if(h=0,c>g){for(f=c+1;h>f;f++)if(a.items[this.id].linear[f].enabled===!0){this.selectedIndex=f;break}}else if(g>c)for(f=c-1;f>=0;f--)if(a.items[this.id].linear[f].enabled===!0){this.selectedIndex=f;break}},c.getSelectedIndex=function(){return $(this).data("customSelectedIndex")},c.setSelectedValue=function(b){var c,d=a.items[this.id].linear.length;for(c=0;d>c;c++)a.items[this.id].linear[c].value===b&&(this.selectedIndex=c);return $(this).val()},c.getSelectedValue=function(){return $(this).val()},c.getarrOptions=function(){var b,c,d=[],e=CustomComboBox.oItems[this.id].linear.length;for(c=0;e>c;c++)b={},b.enabled=a.items[this.id].linear[c].enabled,d.push(b);return d},c.setarrOptions=function(a){},c.getDisabled=function(){return $(this).data("customDisabled")},c.setDisabled=function(a){$(this).data("customDisabled",a).trigger("enableDisableCombo")},c.getGroupName=function(){return $(this).data("customGroup")},c.setGroupName=function(b){b&&(a.groups[b]||(a.groups[b]=[]),-1===a.groups[b].indexOf(this.id)&&a.groups[b].push(this.id));var c=$(this).data("customGroup");c!==b&&(c&&a.groups[c].splice(a.groups[c].indexOf(this.id),1),$(this).data("customGroup",b).trigger("comboGroupChange"))},c},_openDropDown:function(a){var b=this,c=this.getContextElement().parents(".de-mathematics-interactive").find(".player"),d=$(a.currentTarget).offset().left-c.offset().left,e=$(a.currentTarget).offset().top-c.offset().top+$(a.currentTarget).height()-4;if(!this.defaultEventPrevented){var f=$(a.currentTarget);if(!f.hasClass("customComboDisabled")){var g=null;if(this.openComboBoxes[a.currentTarget.id]?g=this.openComboBoxes[a.currentTarget.id]:$(a.currentTarget).hasClass("customComboDropDown")&&(g=a.currentTarget),null!==g)return $(g).remove(),void this.closeOpenComboBoxes();var h;this.items[a.currentTarget.id].dropDown?h=this.items[a.currentTarget.id].dropDown:(h=document.createElement("div"),this.items[a.currentTarget.id].dropDown=h);var i=$(h);i.html(""),f.off("mousedown").on("mousedown",$.proxy(b.closeCombobox,b)),$(document).off("mousedown").on("mousedown",$.proxy(b.closeCombobox,b)).off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",$.proxy(b.closeCombobox,b)),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(f);var j=f.offset();i.css({top:e,left:d,"min-width":f.width(),color:f.css("color"),"font-size":f.css("font-size")}),i.off("mousedown").on("mousedown",$.proxy(b.closeCombobox,b)).off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(a){a.stopPropagation(),a.stopImmediatePropagation()}).off("click").on("click",$.proxy(b._openDropDown,b)),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(i),i.removeClass().addClass("customComboDropDown");this.openComboBoxes[a.currentTarget.id]=h;var k,l,m,n,o,p=0;for(o=this.items[a.currentTarget.id],m=0;m<o.data.length;m++)if(null!=o.data[m].label)for(k=document.createElement("div"),l=$(k),k.innerHTML=this.items[a.currentTarget.id].data[m].label+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;",l.addClass("customComboItem typography-label").addClass("customComboGroup"),h.appendChild(k),n=0;n<this.items[a.currentTarget.id].data[m].data.length;n++)k=document.createElement("div"),l=$(k),k.id=a.currentTarget.id+"-comboItemX"+p,this.items[a.currentTarget.id].data[m].data[n].enabled===!1?l.addClass("customComboItemDisabled"):this._bindListenersOnItem(l),p===this.selectedIndex[a.currentTarget.id]&&(l.addClass("customComboItemSelected"),this.highlightedIndex=p),k.innerHTML=MathInteractives.Common.Components.Views.CustomCombobox.LEFT_OFFSET_FOR_OPTGROUP_ITEM+this.items[a.currentTarget.id].data[m].data[n].text+"  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",l.addClass("customComboItem typography-label"),h.appendChild(k),p++;else k=document.createElement("div"),l=$(k),k.id=a.currentTarget.id+"-comboItemX"+p,k.innerHTML=o.data[m].text,o.data[m].renderTpl&&(k.innerHTML=k.innerHTML+o.data[m].renderTpl),l.addClass("customComboItem typography-label"),o.data[m].enabled===!1?l.addClass("customComboItemDisabled"):this._bindListenersOnItem(l),p===this.selectedIndex[a.currentTarget.id]&&(l.addClass("customComboItemSelected"),this.highlightedIndex=p),h.appendChild(k),p++;var q=i.children(),r=MathInteractives.Common.Components.Views.CustomCombobox.DEFAULT_LINE_HEIGHT*q.length>MathInteractives.Common.Components.Views.CustomCombobox.MAX_DROP_DOWN_HEIGHT?MathInteractives.Common.Components.Views.CustomCombobox.MAX_DROP_DOWN_HEIGHT:MathInteractives.Common.Components.Views.CustomCombobox.DEFAULT_LINE_HEIGHT*q.length;(j.top+r-$(window).scrollTop())/$(window).height()>.9,i.css("height",r+2*i.children().length+2),c.append($(h));var s=document.getElementById(a.currentTarget.id+"-hack");s&&s.focus();var t=a.currentTarget.id,u=document.getElementById(t+"-comboItemX"+this.highlightedIndex);if(this.openComboBoxes[t]&&u&&u.offsetTop>=this.openComboBoxes[t].scrollTop+parseInt($(this.openComboBoxes[t]).css("height"),10)){var v=c.find("#"+t+"-comboItemX"+this.highlightedIndex);this.openComboBoxes[t].scrollTop=v[0].offsetTop+v.height()}f.trigger(MathInteractives.global.CustomCombo.DROPDOWN_OPEN),this.trigger(MathInteractives.global.CustomCombo.DROPDOWN_OPEN,[f.attr("id")])}}},_bindListenersOnItem:function(a){var b=this;a.off("mouseover").on("mouseover",$.proxy(b.onComboItemOver,b)),a.off("click").on("click",$.proxy(b.onComboItemClick,b)),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(a)},onComboBoxFocus:function(a){var b=this,c=$(a.currentTarget);c.html();c.off("focus").on("blur",$.proxy(b.onComboBoxBlur,b))},onComboBoxBlur:function(a){var b=this;return b.ignoreBlur?void(b.ignoreBlur=!1):(b.ignoreBlur=!1,void $(a.currentTarget).off("blur").on("focus",$.proxy(b.onComboBoxFocus,b)))},onKeyDown:function(a){var b,c,d,e,f,g,h,i=a.currentTarget.id,j=this.items[i].linear.length,k=a?a.which:a.keyCode,l=this.getContextElement().find("#"+i),m=this.getContextElement().parents(".de-mathematics-interactive").find(".player"),n=l.prop("selectedIndex");if(!l.hasClass("customComboDisabled")){switch(k){case 9:case 27:this.closeOpenComboBoxes();break;case 33:if(a.preventDefault(),this.openComboBoxes[i]?(b=parseInt($(this.openComboBoxes[i]).css("height"),10),c=parseInt($(this.openComboBoxes[i]).css("lineHeight"),10),this.openComboBoxes[i].scrollTop-=parseInt($(this.openComboBoxes[i]).css("height"),10)):(c=MathInteractives.Common.Components.Views.CustomCombobox.DEFAULT_LINE_HEIGHT,b=j*c>MathInteractives.Common.Components.Views.CustomCombobox.MAX_DROP_DOWN_HEIGHT?MathInteractives.Common.Components.Views.CustomCombobox.MAX_DROP_DOWN_HEIGHT:j*c),d=parseInt(b/c,10),isNaN(n-d))return;l.prop("selectedIndex",n-d);break;case 34:a.preventDefault(),this.openComboBoxes[i]?(b=parseInt($(this.openComboBoxes[i]).css("height"),10),c=parseInt($(this.openComboBoxes[i]).css("lineHeight"),10),this.openComboBoxes[i].scrollTop+=parseInt($(this.openComboBoxes[i]).css("height"),10)):(c=MathInteractives.Common.Components.Views.CustomCombobox.DEFAULT_LINE_HEIGHT,b=j*c>MathInteractives.Common.Components.Views.CustomCombobox.MAX_DROP_DOWN_HEIGHT?MathInteractives.Common.Components.Views.CustomCombobox.MAX_DROP_DOWN_HEIGHT:j*c),d=parseInt(b/c,10),l.prop("selectedIndex",n+d);break;case 35:a.preventDefault(),this.openComboBoxes[i]&&(this.openComboBoxes[i].scrollTop=this.openComboBoxes[i].scrollHeight),l.prop("selectedIndex",j-1);break;case 36:a.preventDefault(),this.openComboBoxes[i]&&(this.openComboBoxes[i].scrollTop=0),l.prop("selectedIndex",0);break;case 13:case 32:return void a.preventDefault();case 37:case 189:break;case 38:case 219:if(a.preventDefault(),0===m.find(".customComboDropDown").length)d=-1===this.highlightedIndex?n:this.highlightedIndex,d-=1,-1===d&&(d=0),isNaN(d)||this.getContextElement().find("#"+i).prop("selectedIndex",d),d>=0&&this.openComboBoxes[i]&&this.openComboBoxes[i].scrollTop-MathInteractives.Common.Components.Views.CustomCombobox.DEFAULT_LINE_HEIGHT<document.getElementById(i+"-comboItemX"+d).offsetTop&&document.getElementById(i+"-comboItemX"+d).scrollIntoView();else{if(e=m.find(".customComboItemSelected"),f=e.attr("id"),g="undefined"==typeof f||null===f?0:parseInt(f.split("X")[1],10),g--,-1>=g)return!1;l[0].selectedIndex=g,this.highlightedIndex=g,e.removeClass("customComboItemSelected"),h=m.find("#"+i+"-comboItemX"+g),h.addClass("customComboItemSelected"),h[0].offsetTop<this.openComboBoxes[i].scrollTop&&(this.openComboBoxes[i].scrollTop=h[0].offsetTop)}break;case 39:case 187:break;case 40:case 222:if(a.preventDefault(),0===m.find(".customComboDropDown").length)d=-1===this.highlightedIndex?n:this.highlightedIndex,l.prop("selectedIndex",d+1),this.openComboBoxes[i]&&document.getElementById(i+"-comboItemX"+this.highlightedIndex).offsetTop>this.openComboBoxes[i].scrollTop+parseInt($(this.openComboBoxes[i]).css("height"),10)&&document.getElementById(i+"-comboItemX"+this.highlightedIndex).scrollIntoView();else{if(e=m.find(".customComboItemSelected"),f=e.attr("id"),g="undefined"==typeof f||null===f?-1:parseInt(f.split("X")[1],10),g++,h=$("#"+i+"-comboItemX"+g),g>=m.find(".customComboItem").length)return!1;l[0].selectedIndex=g,e.removeClass("customComboItemSelected"),this.highlightedIndex=g,h.addClass("customComboItemSelected"),h[0].offsetTop+15>this.openComboBoxes[i].scrollTop+parseInt($(this.openComboBoxes[i]).css("height"),10)&&(this.openComboBoxes[i].scrollTop=h[0].offsetTop+h.height());
}}var o,p=this;if("undefined"!=typeof p._manager){var q=function(){l.find(".acc-read-elem").blur(),l[0].selectedIndex>=0&&(o=p.items[i].linear[p.getAbsoluteIndex(l[0].id,l[0].selectedIndex)].acc),p._manager.setAccMessage(l[0].id,o),setTimeout(function(){l.find(".acc-read-elem").focus()},50)};if(9!==k)q();else{var o,r=this.comboCollection[l[0].id].get("idPrefix"),s=l[0].selectedIndex;"undefined"!=typeof this._manager&&(o=r?this._manager.getAccMessage(r+"commonCustomComboText",0):this._manager.getAccMessage("commonCustomComboText",0)),s||0===s||(s=-1);var t,u=this.getAbsoluteIndex(l[0].id,s);-1===u||null===u||"undefined"==typeof u?"undefined"!=typeof this._manager&&(t=this._manager.getAccMessage(l[0].id,s)):t=this.items[l[0].id].linear[u].acc,"undefined"!=typeof this._manager&&this._manager.setAccMessage(l[0].id,o,[t])}}if(n!==this.getContextElement().find("#"+i).prop("selectedIndex")){this.ignoreBlur=!0;var v=document.getElementById(a.currentTarget.id+"-hack");$(v).focus()}}},onComboItemClick:function(a){var b=a.currentTarget.id,c=b.substring(0,b.lastIndexOf("-"));b=b.substring(b.lastIndexOf("X")+1,b.length);var d=this.getContextElement().find("#"+c);if(d.prop("selectedIndex",parseInt(b,10)),"undefined"!=typeof this._manager){var e;d[0].selectedIndex>=0&&(e=this.items[d[0].id].linear[this.getAbsoluteIndex(d[0].id,d[0].selectedIndex)].acc),this._manager.setAccMessage(d[0].id,e)}},onComboItemTouchEnd:function(a){var b=this,c=a.currentTarget.id,d=c.substring(0,c.lastIndexOf("-"));this.getContextElement().find("#"+d+"-comboItemX"+b.highlightedIndex).removeClass("customComboItemSelected")},onComboItemOver:function(a){var b=this,c=a.currentTarget.id,d=c.substring(0,c.lastIndexOf("-"));$("#"+d+"-comboItemX"+b.highlightedIndex).removeClass("customComboItemSelected"),$(a.currentTarget).addClass("customComboItemSelected"),c=c.substring(c.lastIndexOf("X")+1,c.length),b.highlightedIndex=parseInt(c,10)},onTouchStart:function(a){return this.touchOnCombo?void(this.touchOnCombo=!1):void(a.currentTarget===document||(this.touchOnCombo=!0))},closeCombobox:function(a){a.currentTarget!==document&&(a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault(),this.openComboBoxes[a.currentTarget.id]||$(a.currentTarget).hasClass("customComboDropDown"))||this.closeOpenComboBoxes()},closeOpenComboBoxes:function(){var a;this.touchOnCombo=!1,this.highlightedIndex=-1;for(a in this.openComboBoxes)$(this.openComboBoxes[a]).remove(),delete this.openComboBoxes[a],$("#"+a).off("mousedown").on("mousedown",function(){$("#"+this.id+"-combo-holder > .customComboButton").removeClass("customComboButtonImage").removeClass("customComboButtonImageHover").addClass("customComboButtonImageActive")});$(document).off("mousedown").off("mousewheel DOMMouseScroll")},showHint:function(a,b){var c=this;0!==a.trim().length&&c.comboCollection[b].get("isHintEnabled")===!0&&(this.hintElement.html(a),this.hintElement.show())},preventDefault:function(a){this.defaultEventPrevented=a},hideHint:function(){this.hintElement.hide()},setPos:function(a,b){this.hintElement.css("left",a+"px"),this.hintElement.css("top",b+"px")},isTouchDevice:function(){return"ontouchstart"in window||navigator.msMaxTouchPoints},removeItem:function(a,b,c,d){var e,f,g=!0;for(d?(e=this.getAbsoluteIndex(a,0,b),this.items[a].linear.splice(e,this.items[a].data[b].length),this.items[a].data.splice(b,1)):(null===c&&null!==this.items[a].data[b].data,null!==c?this.items[a].data[c].data.splice(b,1):this.items[a].data.splice(b,1),e=this.getAbsoluteIndex(a,b,c),this.items[a].linear.splice(e,1)),f=0;f<this.items[a].linear.length;f++)this.items[a].linear[f].value===$("#"+a).val()&&(g=!1);g&&$("#"+a).prop("selectedIndex",0),this._adjustWidth(a)},removeAllOptionsForComboWithId:function(a){var b=this.items[a];b&&(b.data.splice(0),b.linear.splice(0))},getComboSelectedData:function(a){var b,c=this.items[a];return c?(b=this.getAbsoluteIndex(a,$("#"+a)[0].selectedIndex),c.linear[b]):void 0},addOptionsToComboWithId:function(a,b){var c=this.items[a];c&&b&&(c.data=b.data,c.linear=b.linear)},addItem:function(a,b,c,d){var e,f,g,h,i,j={},k=$(d);if(k.is("option"))e={},e.value=k.attr("value"),e.text=k.html(),e.acc=k.attr("acc"),e.enabled="disabled"!==k.attr("disabled"),e.isOptGroupChild=!1,null!==c?this.items[a].data[c].data.splice(b,0,e):this.items[a].data.splice(b,0,e),f=this.getAbsoluteIndex(a,b,c),this.items[a].linear.splice(f,0,e),(f<=this.selectedIndex[a]||-1===this.selectedIndex[a])&&(this.selectedIndex[a]+=1),"selected"===k.attr("selected")&&(this.selectedIndex[a]=f);else if(k.is("optgroup")){for(j.label=k.attr("label"),j.data=[],f=this.getAbsoluteIndex(a,b,c),h=k.children(),i=h.length,g=0;i>g;g++){var l=$(h[g]);e={},e.value=l.attr("value"),e.text=l.html(),e.acc=l.attr("acc"),e.enabled="disabled"!==l.attr("disabled"),e.isOptGroupChild=!0,this.items[a].linear.splice(f+g,0,e),"selected"===l.attr("selected")&&(this.selectedIndex[this.id]=f+g),j.data.push(e)}this.items[a].data.splice(b,0,j)}},getAbsoluteIndex:function(a,b,c){var d,e,f=0;if(null===c||"undefined"==typeof c)return b;for(d=0;d<this.items[a].data.length;d++)if(null!==this.items[a].data[d].label)for(e=0;e<this.items[a].data[d].data.length;e++){if(c===d&&b===e)return f;f++}else{if(d===b)return f;f++}},updateGroup:function(a){this.groups[a]&&this.groups[a][0]&&this._adjustWidth(this.groups[a][0])},enableDisableComboItem:function(a,b,c,d){var e,f,g,h=0;if(null===c)for(g=0;g<this.items[a].linear.length;g++)this.items[a].linear[g].value===d&&(c=g);for(this.selectedIndex[a]===c?$("#"+a+"_selectedItem").addClass("CustomComboItemDisabled"):$("#"+a+"_selectedItem").removeClass("CustomComboItemDisabled"),e=0;e<this.items[a].data.length;e++)if(null!==this.items[a].data[e].label){for(f=0;f<this.items[a].data[e].data.length;f++){if(h===c){this.items[a].linear[h].enabled=b,h=-1;break}h++}if(-1===h)break}else{if(h===c){this.items[a].linear[h].enabled=b;break}h++}},enableDisableAllComboItems:function(a,b){var c,d,e=0,f=this.items[a].data.length;for(c=0;f>c;c++)if(null!==this.items[a].data[c].label){var g=this.items[a].data[c].data.length;for(d=0;g>d;d++)this.items[a].linear[e].enabled=b,e++}else this.items[a].linear[e].enabled=b,e++},getTabIndex:function(a){return noCall},setTabIndex:function(a,b){return noCall},getOptionTextAt:function(a,b){return noCall},setFocus:function(a){return noCall},setSelectedIndex:function(a,b){this.openComboBoxes[a]&&(-1!==this.highlightedIndex&&$("#"+a+"-comboItemX"+this.highlightedIndex).removeClass("customComboItemSelected"),$("#"+a+"-comboItemX"+b).addClass("customComboItemSelected"),this.highlightedIndex=b);var c=this.selectedIndex[a];this.selectedIndex[a]=b,$("#"+a+"-default-text").empty().hide(),$("#"+a).val(this.items[a].linear[this.selectedIndex[a]].value),c!==this.selectedIndex[a]&&($("#"+a).trigger("change"),this.comboCollection[a].setSelectedItem(this.selectedIndex[a]));var d=document.getElementById(a+"-selected-item");d.innerHTML=this.items[a].linear[this.selectedIndex[a]].text;var e,f,g=this.comboCollection[a].get("idPrefix");"undefined"!=typeof this._manager&&(e=g?this._manager.getAccMessage(g+"commonCustomComboText",0):this._manager.getAccMessage("commonCustomComboText",0)),f=$("#"+a)[0].selectedIndex,f||0===f||(f=-1);var h,i=this.getAbsoluteIndex(a,f);-1===i||null===i||"undefined"==typeof i?"undefined"!=typeof this._manager&&(h=this._manager.getAccMessage(a,f)):h=this.items[a].linear[i].acc,"undefined"!=typeof this._manager&&this._manager.setAccMessage(a,e,[h])},mLoadCombo:function(a){return noCall},refreshDom:function(){return noCall},getSaveData:function(){for(var a=[],b=0;b<Object.keys(this.comboCollection).length;b++)a.push(this.comboCollection[Object.keys(this.comboCollection)[b]].produceSavedData());return a}},{MAX_DROP_DOWN_HEIGHT:250,DEFAULT_LINE_HEIGHT:25,DROPDOWN_OPEN:"custom_combo_dropdown_opened",LEFT_OFFSET_FOR_OPTGROUP_ITEM:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",generateCustomComboboxController:function(a){for(var b={},c=0;c<a.elementData.length;c++){var d={idPrefix:a.idPrefix},e=new MathInteractives.Common.Components.Models.CustomCombobox($.extend(a.elementData[c],d));b[a.elementData[c].elementID]=e}var f=new MathInteractives.Common.Components.Views.CustomCombobox({$el:a.el});f.comboCollection=b,f.setContextElement(a.el),f._manager=a.manager,a.screenId&&(f._screenID=a.screenId),"undefined"!=typeof f._manager&&(f._manager.unloadScreen("custom-combo-screen",a.idPrefix),f._manager.loadScreen("custom-combo-screen",a.idPrefix),f._manager.loadScreen(f._screenID,a.idPrefix)),f.parseDOM(),"undefined"!=typeof f._manager&&(f._manager.unloadScreen(f._screenID,a.idPrefix),f._manager.loadScreen(f._screenID,a.idPrefix));for(var c=0;c<a.elementData.length;c++){null!==a.elementData[c].selectedIndex&&"undefined"!=typeof a.elementData[c].selectedIndex&&(a.el.find("#"+a.elementData[c].elementID)[0].selectedIndex=a.elementData[c].selectedIndex);var g,h,i=f.comboCollection[a.elementData[c].elementID].get("idPrefix");"undefined"!=typeof f._manager&&(g=i?f._manager.getAccMessage(f.comboCollection[a.elementData[c].elementID].get("idPrefix")+"commonCustomComboText",0):f._manager.getAccMessage("commonCustomComboText",0)),h=$("#"+a.elementData[c].elementID)[0].selectedIndex,h||0===h||(h=-1);var j,k=f.getAbsoluteIndex(a.elementData[c].elementID,h);-1===k||null===k||"undefined"==typeof k?"undefined"!=typeof f._manager&&(j=f._manager.getAccMessage(a.elementData[c].elementID,h)):j=f.items[a.elementData[c].elementID].linear[k].acc,"undefined"!=typeof f._manager&&f._manager.setAccMessage(a.elementData[c].elementID,g,[j])}return f}}),MathInteractives.global.CustomCombo=MathInteractives.Common.Components.Views.CustomCombobox}(),function(){"use strict";MathInteractives.Common.Components.Models.IntroBox=Backbone.Model.extend({defaults:function(){return{id:null,title:null,text:null,accTitle:null,accText:null,buttons:[]}}})}(),function(){"use strict";MathInteractives.Common.Components.Views.IntroBox=MathInteractives.Common.Player.Views.Base.extend({manager:null,player:null,idPrefix:null,_path:null,initialize:function(){var a=this.model,b=a.get("screenId");this.manager=a.get("manager"),this.player=a.get("player"),this.idPrefix=a.get("idPrefix"),this._path=a.get("path"),this.render(),"undefined"!=typeof b&&(this.unloadScreen(b),this.loadScreen(b))},render:function(){this._renderTexts(),this._renderButtons(),this._positionButtons(),this._setIntroBoxDimensions(),this.$el.replaceWith(function(){return $(this).contents()})},_renderTexts:function(){var a,b;a=this.model.get("title"),b=this.model.get("text"),(null!==a||null!==b)&&this.$el.append(MathInteractives.Common.Components.templates.introBox({title:a,text:b,idPrefix:this.idPrefix}).trim())},_setIntroBoxDimensions:function(){var a,b,c=this.$("#"+this.idPrefix+"intro-box");a=(c.innerWidth()-c.width())/2,b=(c.innerHeight()-c.height())/2,c.height(this.$el.height()-2*b),c.width(this.$el.width()-2*a)},_renderButtons:function(){var a,b,c,d,e,f,g=this.idPrefix;a={containerId:g+"intro-box-tts-container",messagesToPlay:[g+"intro-box-text"],path:this._path,player:this.player,manager:this.manager,idPrefix:this.idPrefix},b=MathInteractives.global.PlayerTTS.generateTTS(a),c=this.$("#"+g+"intro-btns-container"),d=this.model.get("buttons"),e=d.length;for(var h=0;e>h;h++)f=$("<div>",{id:g+d[h].id,"class":"intro-box-btn"}),c.append(f),a={id:g+d[h].id,type:MathInteractives.Common.Components.Views.Button.TYPE.GENERAL,width:d[h].width,text:d[h].text,path:this._path},MathInteractives.global.Button.generateButton(a),f.bind("click",{currentButton:d[h]},$.proxy(this._bottomBtnClickHandler,this))},_positionButtons:function(){var a,b,c=20,d=this.$el.offset(),e=this.$("#"+this.idPrefix+"intro-btns-container");a=d.top+this.$el.height()-e.height()-c,b=d.left+this.$el.width()-e.width()-c,e.offset({top:a,left:b})},_bottomBtnClickHandler:function(a){var b=a.data.currentButton;MathInteractives.global.SpeechStream.stopReading(),b.clickCallBack&&b.clickCallBack.fnc.apply(b.clickCallBack.scope||this,[a])}},{generate:function(a){if(null!==a.id){var b,c,d="#"+a.id;return b=new MathInteractives.Common.Components.Models.IntroBox(a),c=new MathInteractives.Common.Components.Views.IntroBox({el:d,model:b})}}}),MathInteractives.global.IntroBox=MathInteractives.Common.Components.Views.IntroBox}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.introBox=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box" class="intro-box ',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box">\r\n\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box-header" class="intro-box-header ',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box-header">\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box-title" class="typography-header ',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box-title">\r\n      ',(g=c.title)?f=g.call(b,{hash:{},data:e}):(g=b&&b.title,f=typeof g===i?g.call(b,{hash:{},data:e}):g),(f||0===f)&&(h+=f),h+='\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box-tts-container" class="intro-box-tts-container ',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box-tts-container"></div>\r\n  </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box-text" class="intro-box-text ',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-box-text">\r\n    ',(g=c.text)?f=g.call(b,{hash:{},data:e}):(g=b&&b.text,f=typeof g===i?g.call(b,{hash:{},data:e}):g),(f||0===f)&&(h+=f),h+='\r\n  </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-btns-container" class="intro-btns-container ',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'intro-btns-container"></div>\r\n</div>'})}(),function(){"use strict";MathInteractives.Common.Components.Models.Badge=MathInteractives.Common.Player.Models.Base.extend({defaults:function(){return{containerId:"",textId:"",messageText:"",type:MathInteractives.Common.Components.Views.Badge.TYPES.TEXT_BOX}}})}(),function(){"use strict";MathInteractives.Common.Components.Views.Badge=MathInteractives.Common.Player.Views.Base.extend({_containerType:null,_path:null,manager:null,_accId:null,initialize:function(){this._path=this.model.get("path"),this.manager=this.model.get("manager"),this._containerType=this.model.get("type"),this._accId=this.$el.attr("id"),this.render()},render:function(){var a=MathInteractives.Common.Components.Views.Badge.BADGE_BORDER_THICKNESS,b=this.$el;switch(this._containerType){case MathInteractives.Common.Components.Views.Badge.TYPES.TEXT_BOX:var c=this.model.get("textId");"undefined"!=typeof c&&$("<input/>",{id:c,"class":c+" feedback-badges-textbox"}).appendTo(b);var d=this.$("#"+c);b.append('<div id="badge-input-modal" class="badge-input-modal"></div>'),this.$(".badge-input-modal").css({width:d.width()+a+"px",height:d.height()+a+"px",left:"0px",top:-b.height()+"px"}).hide(),b.css({border:a+"px solid transparent","border-radius":"6px"}).on("keydown",function(){13===event.keyCode&&$(this).find("input").focus()});break;case MathInteractives.Common.Components.Views.Badge.TYPES.MESSAGE:var e=this.model.get("messageText");b.html('<span class="feedback-message">'+e+"</span>"),b.find(".feedback-message").css({padding:"5px",border:a+"px solid transparent","border-radius":"6px"});break;case MathInteractives.Common.Components.Views.Badge.TYPES.SCORE_BOX:var c=this.model.get("textId");"undefined"!=typeof c&&$("<input/>",{id:c,"class":c+" score-badges-textbox"}).appendTo(b),b.css({border:a+"px solid transparent","border-radius":"6px"}).on("keydown",function(a){13===a.keyCode&&$(this).find("input").focus()})}},markBadge:function(a,b){var c,d,e,f,g,h,i,j,k,e=this.$el;switch(f=this.$(".badge-image"),c=MathInteractives.Common.Components.Views.Badge,d=c.BADGE_TYPE,k=c.BADGE_CLASS,0===f.length&&($("<div/>").addClass("badge-image").appendTo(e),f=this.$(".badge-image"),g=e.width(),h=e.height(),i=f.position().top-e.position().top,f.css({"background-image":'url("'+this._path.getImagePath("player-lr")+'")',"background-position":"734px 0",left:g-f.width()/2+"px",top:-(f.height()/2)+"px"})),f.show(),this._containerType===c.TYPES.TEXT_BOX&&this.$(".badge-input-modal").show(),a){case d.CORRECT_RESPONSE:e.css({"border-color":"#749718"}),e.find("input").attr("disabled",!0),f.css({"background-position":"-33px -290px"}),j=k.CORRECT,"undefined"!=typeof this.manager&&null!==this.manager&&this.manager.changeAccMessage(this._accId,"correct");break;case d.INCORRECT_RESPONSE:e.css({"border-color":"#CF1D78"}),f.css({"background-position":"-33px -326px"}),j=k.INCORRECT,"undefined"!=typeof this.manager&&null!==this.manager&&this.manager.changeAccMessage(this._accId,"incorrect");break;case d.FEEDBACK:e.css({"border-color":"transparent"}),f.css({"background-position":"-0px -1444px"}),j=k.FEEDBACK,"undefined"!=typeof this.manager&&null!==this.manager&&this.manager.changeAccMessage(this._accId,"feedback");break;case d.INCORRECT_RESPONSE_AND_HINT:}this._setCurrentClassResponse(j)},_setCurrentClassResponse:function(a){var b=MathInteractives.Common.Components.Views.Badge.BADGE_CLASS,c=this.$el;this._removeBadgeClass(c,b),c.addClass(a)},_removeBadgeClass:function(a,b){a.hasClass(b.CORRECT)&&a.removeClass(b.CORRECT),a.hasClass(b.INCORRECT)&&a.removeClass(b.INCORRECT),a.hasClass(b.FEEDBACK)&&a.removeClass(b.FEEDBACK),a.hasClass(b.INCORRECT_RESPONSE_AND_HINT)&&a.removeClass(b.INCORRECT_RESPONSE_AND_HINT)},revertBadge:function(){var a=this.$el,b=this.$(".badge-image");a.css({"border-color":"transparent"}),a.find("input").attr("disabled",!1),b.hide();var c=MathInteractives.Common.Components.Views.Badge.BADGE_CLASS;this._removeBadgeClass(a,c),this._containerType===MathInteractives.Common.Components.Views.Badge.TYPES.TEXT_BOX&&this.$(".badge-input-modal").hide(),"undefined"!=typeof this.manager&&null!==this.manager&&this.manager.changeAccMessage(this._accId,0)},returnText:function(a){var b=this.$el,c=MathInteractives.Common.Components.Views.Badge,d=c.TYPES,e=null;switch(a){case d.TEXT_BOX:case d.SCORE_BOX:e=b.find("input").val();break;case d.MESSAGE:e=b.text()}return e}},{TYPES:{TEXT_BOX:"textBox",MESSAGE:"message",SCORE_BOX:"scoreBox"},BADGE_TYPE:{CORRECT_RESPONSE:0,INCORRECT_RESPONSE:1,FEEDBACK:2,INCORRECT_RESPONSE_AND_HINT:3},BADGE_BORDER_THICKNESS:3,BADGE_CLASS:{CORRECT:"badge-correct",INCORRECT:"badge-incorrect",FEEDBACK:"badge-feedback",INCORRECT_RESPONSE_AND_HINT:"badge-response-hint"},generateBadge:function(a){var b;if("undefined"!=typeof a){b="#"+a.containerId;var c=new MathInteractives.Common.Components.Models.Badge(a),d=new MathInteractives.Common.Components.Views.Badge({el:b,model:c});return d}}}),MathInteractives.global.Badge=MathInteractives.Common.Components.Views.Badge}(),function(){"use strict";MathInteractives.Common.Components.Views.Slider=MathInteractives.Common.Player.Views.Base.extend({_$slider:null,_$sliderMid:null,_$sliderLeft:null,_$sliderRight:null,_$sliderHandle:null,_isDisabled:!1,_sliderHandleType:null,initialize:function(){this.filePath=this.model.get("filePath"),this.idPrefix=this.model.get("idPrefix"),this.manager=this.model.get("manager"),this.player=this.model.get("player"),this._sliderHandleType=this.model.get("sliderHandleType"),this.render(),this._attachEvents(),this._$sliderMid=this.$(".slider-mid"),this._$sliderLeft=this.$(".slider-left"),this._$sliderRight=this.$(".slider-right"),this._$sliderHandle=this.$(".slider-handle")},render:function(){var a=this.model,b=this.idPrefix+a.get("sliderId"),c=a.get("step"),d=a.get("points"),e=null===a.get("intervalGap")?1:a.get("intervalGap"),f=a.get("minValue");a.get("smoothSliding")&&(c/=MathInteractives.Common.Components.Models.Slider.SLIDER_INTERVAL_DIVIDER),d?this.model.updateSelectedValue(d[0]):this.model.updateSelectedValue(f),this._$slider=this.$("#"+b).CustomSlider({min:f,max:a.get("maxValue"),step:c,value:a.get("selectedValue"),animate:a.get("animate")}).addClass("slider-component").css({width:a.get("width")+"px",height:a.get("height")}),this._$slider=$("#"+b),this.model.get("appendLabel")&&this._appendLabels(),this.model.get("showIntervals")&&this._$slider.each(function(){for(var a=$(this).data().CustomSlider||$(this).data().uiCustomSlider,b=a.options,c=b.max-b.min,d=b.min;d<=b.max-1;d+=e){if(b.min<0)var f=$('<label class="slider-labels typography-label">'+d+"</label >").css("left",(d+Math.abs(b.min))/c*100+"%");else if(b.min>0)var f=$('<label class="slider-labels typography-label">'+d+"</label >").css("left",(d-b.min)/c*100+"%");else var f=$('<label class="slider-labels typography-label">'+d+"</label >").css("left",d/c*100+"%");$(this).siblings().append(f)}}),this.$(".ui-slider-handle").attr({id:b+"-handle"}).addClass("slider-handle"),this._addImages(),this.createAccDiv({elementId:a.get("sliderId")+"-handle",tabIndex:a.get("tabIndex"),acc:""});var g=$("<div>",{id:this.idPrefix+"temp-focus-div",style:"position: absolute; height: 1px; width: 1px; top: 1px; left: 1px;"});this.$el.append(g),this.loadScreen("temp-focus-div-screen"),this.setTabIndex("temp-focus-div",parseInt(this.model.get("tabIndex"),10)+1),this.enableTab("temp-focus-div",!1)},_addImages:function(){var a='<div class="slider-left"></div> <div class="slider-mid"></div><div class="slider-right"></div>',b=this.model.get("width"),c=MathInteractives.Common.Components.Models.Slider,d=b-(c.LEFT_IMAGE_WIDTH+c.RIGHT_IMAGE_WIDTH);this._$slider.append(a),this.model.get("isBackgroundImage")===!0&&(this.$(".slider-mid").css({"background-image":'url("'+this.filePath.getImagePath("player-m")+'")'}),this.$(".slider-left, .slider-right").css({"background-image":'url("'+this.filePath.getImagePath("player-lr")+'")'})),this.$(".slider-mid").css({width:d+"px"}),this.setSliderHandleImage()},setSliderHandleImage:function(){var a=this.$(".slider-handle");switch(a.css({"background-image":'url("'+this.filePath.getImagePath("player-lr")+'")'}),this._sliderHandleType){case 1:a.addClass("slider-handle-pink");break;case 2:a.addClass("slider-handle-green")}},_appendLabels:function(){var a=this.model,b=a.get("minValue"),c=a.get("maxValue"),d=this.model.get("width"),e='<div class="slider-labels-cont"></div>';this.$el.append(e);var f=this.$(".slider-labels-cont");f.css("width",d+"px"),this.model.get("showIntervals")||f.append($('<label class="slider-labels typography-label">'+b+"</label >").css("left","0%")),f.append($('<label class="slider-labels typography-label ">'+c+"</label >").css("left","100%"))},events:{"click .slider-labels":"_labelClicked","mouseover .ui-slider":"_sliderMouseOver","mouseout .ui-slider":"_sliderMouseOut"},_sliderMouseOver:function(){this.$(".ui-slider").addClass("slider-mouse-over-out")},_sliderMouseOut:function(){this.$(".ui-slider").removeClass("slider-mouse-over-out")},_attachEvents:function(){var a=this.model,b=this._$slider,c=null,d=MathInteractives.Common.Utilities.Models.Utils;b.on({slidestop:$.proxy(this._snapToNearestPoint,this),slide:$.proxy(this._updateOnSlide,this)}),a.get("onStart")&&b.on("slidestart",a.get("onStart")),c=$("#"+this.idPrefix+a.get("sliderId")+"-handle"),c.off("click.slider").on({"click.slider":$.proxy(this._sliderHandleClicked,this)}),c.on({mouseenter:$.proxy(this._mouseEnter,this),mouseleave:$.proxy(this._mouseLeave,this)}),c.off("keydown keyup"),(this.isAccessible()||this.model.get("isAllowKeyboardNavigation"))&&c.off("keydown keyup").off("keydown.slider keyup.slider").on({"keydown.slider":$.proxy(this._moveUsingKeyboard,this),"keyup.slider":$.proxy(this._keyUpOnHandle,this)}),d.EnableTouch(c,{specificEvents:d.SpecificEvents.DRAGGABLE})},_mouseEnter:function(){var a=this._$sliderHandle,b=MathInteractives.Common.Utilities.Models.BrowserCheck;a.addClass("slider-handle-hover ui-state-hover"),b.isMobile||this._isDisabled?b.isMobile||a.css("cursor","default"):a.css("cursor","pointer")},_mouseLeave:function(){this.$(".ui-slider-handle").removeClass("slider-handle-hover ui-state-hover")},_snapToNearestPoint:function(a,b){if(!this._isKeyBoardEvent(a)){var c=this.model.get("points"),d=b.value,e=null,f=this.model.get("onStop"),g=null;e=c&&c.length>0?this._getNearestPointFromArray(d):this._getNearestPoint(d),this._$slider.CustomSlider("value",e),this.model.updateSelectedValue(e),g={handle:b.handle,value:e,points:b.points},f&&f(a,g),this._fireChangeEvent(a,g)}},_updateOnSlide:function(a,b){if(!this._isKeyBoardEvent(a)){var c=this._getNearestPoint(b.value),d=this.model.get("onSlide");this.model.updateSelectedValue(c),d&&d(a,{handle:b.handle,value:c})}},_moveUsingKeyboard:function(a){var b=this.model,c=b.get("selectedValue"),d=b.get("step"),e=b.get("minValue"),f=b.get("maxValue"),g=this._getAccId(),h=b.get("points"),i=!1;if(this.setFocus(g),!this.isSliderDisabled()){switch(a.keyCode){case 38:case 39:case 33:if(i=!0,h&&h.length>0){var j=this._getNextPoint();this.setSelectedValue(j)}else f>c&&this.setSelectedValue(c+d);break;case 40:case 37:case 34:if(i=!0,h&&h.length>0){var j=this._getPreviousPoint();this.setSelectedValue(j)}else c>e&&this.setSelectedValue(c-d);break;case 36:i=!0,h&&h.length>0?this.setSelectedValue(h[0]):this.setSelectedValue(e);break;case 35:i=!0,h&&h.length>0?this.setSelectedValue(h[h.length-1]):this.setSelectedValue(f)}i&&(this._setSelfFocus(),this.setFocus(g),a.preventDefault(),this._keyDownOnHandle())}},_sliderHandleClicked:function(){this.trigger("onSlideHandleClick")},_keyUpOnHandle:function(){this.trigger("onSlideHandleKeyUp")},_keyDownOnHandle:function(){this.trigger("onSlideHandleKeyDown")},_labelClicked:function(a){if(!this._isDisabled){var b=$(a.target);this.setSelectedValue(parseInt(b.text()));var c=this.model.get("onStop");c&&c(a,null)}},_fireChangeEvent:function(a,b){var c=this.model.get("onChange");c&&c(a,b)},setSelectedValue:function(a){this._$slider.CustomSlider("value",a),this.model.updateSelectedValue(a),this._fireChangeEvent(null,{value:a})},getSelectedValue:function(){return this.model.get("selectedValue")},disableSlider:function(){this._isDisabled=!0,this._$slider.CustomSlider("disable"),this._$sliderMid.addClass("slider-mid-disabled"),this._$sliderLeft.addClass("slider-left-disabled"),this._$sliderRight.addClass("slider-right-disabled"),this._$sliderHandle.addClass("slider-handle-disabled"),this.$(".slider-labels").addClass("slider-labels-disabled"),this.enableTab(this._getAccId(),!1)},enableSlider:function(){this.model;this._isDisabled=!1,this._$slider.CustomSlider("enable"),this._$sliderMid.removeClass("slider-mid-disabled"),this._$sliderLeft.removeClass("slider-left-disabled"),this._$sliderRight.removeClass("slider-right-disabled"),this._$sliderHandle.removeClass("slider-handle-disabled"),this.$(".slider-labels").removeClass("slider-labels-disabled"),this.enableTab(this._getAccId(),!0)},isSliderDisabled:function(){return this._$slider.CustomSlider("option","disabled")},changeAccMessage:function(a){var b=this._getAccId();this.setAccMessage(b,a),this._setSelfFocus()},_setSelfFocus:function(){var a=this._getAccId();this.enableTab("temp-focus-div",!0),this.setTabIndex("temp-focus-div",parseInt(this.model.get("tabIndex"),10)+1),this.setFocus("temp-focus-div"),this.setFocus(a,0),this.enableTab("temp-focus-div",!1)},_getAccId:function(){var a=this.model.get("sliderId")+"-handle";return a},_getNearestPoint:function(a){var b=this.model,c=b.get("step"),d=Math.round(a/c)*c;return d},_getNearestPointFromArray:function(a){for(var b=this.model.get("points"),c=b.length,d=b[0],e=0;c>e;e++)Math.abs(a-b[e])<Math.abs(a-d)&&(d=b[e]);return d},_isKeyBoardEvent:function(a){var b=!1;return a.keyCode&&(b=!0),b},_getNextPoint:function(){var a=this.model,b=a.get("points"),c=a.get("selectedValue"),d=b.indexOf(c),e=null;switch(d){case b.length-1:e=b[b.length-1];break;case-1:e=this._getNearestPointFromArray(c);break;default:e=b[d+1]}return e},_getPreviousPoint:function(){var a=this.model,b=a.get("points"),c=a.get("selectedValue"),d=b.indexOf(c),e=null;switch(d){case 0:e=b[0];break;case-1:e=this._getNearestPointFromArray(c);break;default:e=b[d-1]}return e}},{generateSlider:function(a){if(a){var b,c,d;return b="#"+a.idPrefix+a.containerId,c=new MathInteractives.Common.Components.Models.Slider(a),d=new MathInteractives.Common.Components.Views.Slider({el:b,model:c})}}}),MathInteractives.global.Slider=MathInteractives.Common.Components.Views.Slider}(),function(){"use strict";MathInteractives.Common.Components.Models.Slider=Backbone.Model.extend({defaults:{containerId:"",sliderId:"",width:200,height:8,minValue:1,maxValue:10,step:1,smoothSliding:!0,animate:!1,orientation:"horizontal",selectedValue:1,onChange:null,onSlide:null,onStop:null,onStart:null,tabIndex:null,isBackgroundImage:!0,sliderHandleType:null,appendLabel:!0,points:null,isAllowKeyboardNavigation:!1,intervalGap:null,showIntervals:!1},updateSelectedValue:function(a){this.set("selectedValue",a)}},{SLIDER_INTERVAL_DIVIDER:30,LEFT_IMAGE_WIDTH:5,RIGHT_IMAGE_WIDTH:5})}(),function(){"use strict";MathInteractives.Common.Components.Models.CheckBox=Backbone.Model.extend({defaults:{player:null,manager:null,filePath:null,checkedByDefault:null,enabledByDefault:null,containerId:null,checkUncheck:!1},_initialize:function(){}})}(),function(){"use strict";MathInteractives.Common.Components.Views.CheckBox=MathInteractives.Common.Player.Views.Base.extend({containerId:null,player:null,manager:null,filePath:null,idPrefix:null,currentState:null,lable:null,initialize:function(){this.containerId=this.model.get("containerId"),this.player=this.model.get("player"),this.manager=this.model.get("manager"),this.filePath=this.model.get("filePath"),this.idPrefix=this.model.get("idPrefix"),this.label=this.model.get("label"),this.model.get("checkUncheck")?this.currentState=MathInteractives.Common.Components.Views.CheckBox.CHECKED_ENABLE:this.currentState=MathInteractives.Common.Components.Views.CheckBox.UNCHECKED_ENABLE,this.render(),this._bindTouchEvents()},render:function(){var a={containerID:this.containerId},b=MathInteractives.Common.Components.templates.checkBox(a);this.$el.append(b.trim()),this.$el.find(".check-box-inner-icon-common-componenet").css({"background-image":'url("'+this.filePath.getImagePath("check-box-states")+'")'}),this.$el.find(".check-box-inner-label-common-componenet").html(this.label),this._setCheckBoxState(this.currentState)},events:function(){var a={mouseover:"_mouseover_check_box_outer_common_componenet",mouseout:"_mouseout_check_box_outer_common_componenet",click:"_click_check_box_outer_common_componenet","mouseover .check-box-icon-cover-common-componenet,.check-box-inner-label-common-componenet":"_mouseover_inner_componenets","mouseout .check-box-icon-cover-common-componenet,.check-box-inner-label-common-componenet":"_mouseout_inner_componenets"};return a},_bindTouchEvents:function(){MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$el)},_mouseover_inner_componenets:function(a){var b=MathInteractives.Common.Components.Views.CheckBox,c=$(a.currentTarget).parent().find(".check-box-inner-icon-common-componenet");(c.hasClass("check-box-"+b.CHECKED_ENABLE)||c.hasClass("check-box-"+b.UNCHECKED_ENABLE))&&$(a.currentTarget).addClass("hand-cursor");
},_mouseout_inner_componenets:function(a){$(a.currentTarget).hasClass("hand-cursor")&&$(a.currentTarget).removeClass("hand-cursor")},_mouseover_check_box_outer_common_componenet:function(a){var b=$(a.currentTarget),c=b.find(".check-box-inner-icon-common-componenet"),d=MathInteractives.Common.Components.Views.CheckBox;this.currentState===d.UNCHECKED_ENABLE&&c.removeAttr("class").addClass("check-box-inner-icon-common-componenet check-box-unchecked-hover"),this.currentState===d.CHECKED_ENABLE&&c.removeAttr("class").addClass("check-box-inner-icon-common-componenet check-box-checked-hover")},_mouseout_check_box_outer_common_componenet:function(a){var b=$(a.currentTarget),c=b.find(".check-box-inner-icon-common-componenet"),d=MathInteractives.Common.Components.Views.CheckBox;this.currentState===d.UNCHECKED_ENABLE&&c.removeAttr("class").addClass("check-box-inner-icon-common-componenet check-box-"+d.UNCHECKED_ENABLE),this.currentState===d.CHECKED_ENABLE&&c.removeAttr("class").addClass("check-box-inner-icon-common-componenet check-box-"+d.CHECKED_ENABLE)},_click_check_box_outer_common_componenet:function(a){var b=$(a.currentTarget),c=(b.find(".check-box-inner-icon-common-componenet"),MathInteractives.Common.Components.Views.CheckBox);return this.currentState===c.UNCHECKED_ENABLE?(this.currentState=c.CHECKED_ENABLE,this._setCheckBoxState(this.currentState),void this.trigger(this.containerId+c.CHECK_EVENT_NAME,this)):this.currentState===c.CHECKED_ENABLE?(this.currentState=c.UNCHECKED_ENABLE,this._setCheckBoxState(this.currentState),void this.trigger(this.containerId+c.UNCHECK_EVENT_NAME,this)):void 0},_setCheckBoxState:function(a){var b=MathInteractives.Common.Components.Views.CheckBox,c=this.$el.find(".check-box-inner-icon-common-componenet");switch(this.currentState=a,a){case b.UNCHECKED_ENABLE:c.removeAttr("class").addClass("check-box-inner-icon-common-componenet check-box-"+b.UNCHECKED_ENABLE);break;case b.CHECKED_ENABLE:c.removeAttr("class").addClass("check-box-inner-icon-common-componenet check-box-"+b.CHECKED_ENABLE);break;case b.UNCHECKED_DISABLE:c.removeAttr("class").addClass("check-box-inner-icon-common-componenet check-box-"+b.UNCHECKED_DISABLE);break;case b.CHECKED_DISABLE:c.removeAttr("class").addClass("check-box-inner-icon-common-componenet check-box-"+b.CHECKED_DISABLE)}},enableCheckBox:function(){var a=MathInteractives.Common.Components.Views.CheckBox,b=this;b.enableTab(b.model.get("accId"),!0),b.currentState===a.UNCHECKED_DISABLE?b._setCheckBoxState(a.UNCHECKED_ENABLE):b.currentState===a.CHECKED_DISABLE&&b._setCheckBoxState(a.CHECKED_ENABLE)},disableCheckBox:function(){var a=MathInteractives.Common.Components.Views.CheckBox,b=this;b.enableTab(this.model.get("accId"),!1),b.currentState===a.UNCHECKED_ENABLE?b._setCheckBoxState(a.UNCHECKED_DISABLE):b.currentState===a.CHECKED_ENABLE&&b._setCheckBoxState(a.CHECKED_DISABLE)},checkTheCheckBox:function(){var a=MathInteractives.Common.Components.Views.CheckBox,b=this;b.currentState===a.UNCHECKED_ENABLE?b._setCheckBoxState(a.CHECKED_ENABLE):b.currentState===a.UNCHECKED_DISABLE&&b._setCheckBoxState(a.CHECKED_DISABLE)},uncheckTheCheckBox:function(){var a=MathInteractives.Common.Components.Views.CheckBox,b=this;b.currentState===a.CHECKED_ENABLE?b._setCheckBoxState(a.UNCHECKED_ENABLE):b.currentState===a.CHECKED_DISABLE&&b._setCheckBoxState(a.UNCHECKED_DISABLE)}},{UNCHECKED_ENABLE:"unchecked-enable",CHECKED_ENABLE:"checked-enable",UNCHECKED_DISABLE:"unchecked-disable",CHECKED_DISABLE:"checked-disable",CHECK_EVENT_NAME:"checkbox-check",UNCHECK_EVENT_NAME:"checkbox-uncheck",DISABLE_EVENT_NAME:"checkbox-disable",ENABLE_EVENT_NAME:"checkbox-enable",createCheckBox:function(a){if(null!==a.containerId){var b,c,d="#"+a.containerId;return b=new MathInteractives.Common.Components.Models.CheckBox(a),c=new MathInteractives.Common.Components.Views.CheckBox({el:d,model:b})}}}),MathInteractives.global.CheckBox=MathInteractives.Common.Components.Views.CheckBox}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.checkBox=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.containerID)?f=g.call(b,{hash:{},data:e}):(g=b&&b.containerID,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-check-box-outer" class="check-box-outer-common-componenet">\r\n    <div id="',(g=c.containerID)?f=g.call(b,{hash:{},data:e}):(g=b&&b.containerID,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-check-box-icon-cover" class="check-box-icon-cover-common-componenet">\r\n        <div id="',(g=c.containerID)?f=g.call(b,{hash:{},data:e}):(g=b&&b.containerID,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-check-box-inner-icon" class="check-box-inner-icon-common-componenet"></div>\r\n    </div>\r\n    <div id="',(g=c.containerID)?f=g.call(b,{hash:{},data:e}):(g=b&&b.containerID,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-check-box-inner-label" class="check-box-inner-label-common-componenet"></div>\r\n</div>'})}(),function(){"use strict";MathInteractives.Common.Components.Models.RadioButton=MathInteractives.Common.Player.Models.Base.extend({defaults:{filePath:null,screenID:null,id:null,idPrefix:null,manager:null,direction:"vertical",gapBetweenRadioButtonContainers:null,enabled:!0,radioButtonCollection:null},initialize:function(){this.set({radioButtonCollection:new MathInteractives.Common.Components.Models.RadioButton.RadioButtonCollectionData})}},{RadioButtonData:Backbone.Model.extend({defaults:{elementID:null,text:null,value:null,selected:!1,labelWidth:null}}),RadioButtonCollectionData:Backbone.Collection.extend({initialize:function(){this.model=MathInteractives.Common.Components.Models.RadioButton.RadioButtonData}})})}(),function(){"use strict";MathInteractives.Common.Components.Views.RadioButton=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,screenID:null,tabIndex:null,initialize:function(){this.manager=this.model.get("manager"),this.filePath=this.model.get("filePath"),this.screenID=this.model.get("screenID"),this.idPrefix=this.model.get("idPrefix"),this.render(),this.bindTouchEvents()},render:function(){for(var a=this.model.get("radioButtonCollection"),b=null,c=[],d=0;d<a.length;d++)b=a.models[d],c.push({radioID:this.idPrefix+b.get("elementID"),text:b.get("text")});this.$el.html(MathInteractives.Common.Components.templates.radioButton({radioButtonLabel:c}).trim()),this.setWidthOfGivenLabels(),this.loadScreen(this.screenID),this.$(".image-container").css({"background-image":'url("'+this.filePath.getImagePath("radio-button-states")+'")'}),this.setInitialTabIndex(),this.alignRadioButton(this.model.get("direction"),this.model.get("gapBetweenRadioButtonContainers")),this.checkDefaultCheckedRadioButtons(),this.setInitialStateOfRadioButtons()},events:{"click .radio-elements":"radioButtonClicked","mouseenter .radio-elements":"radioButtonEntered","mouseleave .radio-elements":"radioButtonLeft","keydown .radio-elements":"processKeyEvents"},bindTouchEvents:function(){MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$(".radio-elements"))},radioButtonClicked:function(a){var b=null;if(this.model.get("enabled")){var c=this.$(a.currentTarget),d=this.getImageContainer(c);0==this.$(d).hasClass("selected")&&(this.resetRadioButtons(),this.$(d).addClass("selected"),this.resetTabIndices(),b=this.getAccIDByReplacingIdPrefix(this.$(d).attr("id")),this.setTabIndex(b,this.tabIndex),this.triggerOnChangeEvent()),b=this.getAccIDByReplacingIdPrefix(this.$(d).attr("id")),this.setFocus(b)}},radioButtonEntered:function(a){var b=this.$(a.currentTarget),c=this.getImageContainer(b);this.$(c).addClass("hover"),this.$(b).addClass("cursor-pointer")},radioButtonLeft:function(a){var b=this.$(a.currentTarget),c=this.getImageContainer(b);this.$(c).removeClass("hover"),this.$(b).removeClass("cursor-pointer")},getImageContainer:function(a){var b=null;return b=a.hasClass("text-container")?a.prev():a},alignRadioButton:function(a,b){var c=this.$(".de-mathematics-interactive-radio-button .single-radio-container");"vertical"==a?this.$(c).removeClass("float-left"):(this.$(c).addClass("float-left"),null==b&&(b=10),this.$(c).css({"margin-right":b+"px"}))},checkDefaultCheckedRadioButtons:function(){for(var a=this.model.get("radioButtonCollection"),b=this.getAllImageContainers(),c=null,d=null,e=null,f=0;f<a.length;f++)c=a.models[f],d=b[f],e=this.getAccIDByReplacingIdPrefix(this.$(d).attr("id")),e==c.get("elementID")&&1==c.get("selected")&&(this.resetRadioButtons(),this.$(d).addClass("selected"),this.resetTabIndices(),this.setTabIndex(c.get("elementID"),this.tabIndex))},setInitialStateOfRadioButtons:function(){this.model.get("enabled")?this.enableRadioButtons():this.disableRadioButtons()},enableRadioButtons:function(){this.model.set({enabled:!0}),this.$(".de-mathematics-interactive-radio-button .image-container").removeClass("disabled"),this.$(".de-mathematics-interactive-radio-button .text-container").removeClass("disable-text");var a=this.getAllImageContainers(),b=null;if(1==this.$(a).hasClass("selected")){var c=this.getCurrentRadioButtonAndModel(null,!0);void 0!=c&&null!=c.curChild&&(this.resetTabIndices(),b=this.getAccIDByReplacingIdPrefix(this.$(c.curChild).attr("id")),this.setTabIndex(b,this.tabIndex))}else if(0==this.DoesAnyElementHaveTabIndex()){var d=this.getImageContainerWithSmallestTabIndex();b=this.getAccIDByReplacingIdPrefix(this.$(d).attr("id")),this.setTabIndex(b,this.tabIndex)}},disableRadioButtons:function(){this.model.set({enabled:!1}),this.$(".de-mathematics-interactive-radio-button .image-container").addClass("disabled"),this.$(".de-mathematics-interactive-radio-button .text-container").addClass("disable-text"),this.resetTabIndices()},resetRadioButtons:function(){this.$(".de-mathematics-interactive-radio-button .image-container").removeClass("selected")},getAllImageContainers:function(){return $(this.$el).find("div.de-mathematics-interactive-radio-button.image-container")},getAllTextContainers:function(){return $(this.$el).find("div.de-mathematics-interactive-radio-button.text-container")},selectRadioButton:function(a){var b=this.getCurrentRadioButtonAndModel(a,!1),c=null;void 0!=b&&null!=b.curChild&&0==this.$(b.curChild).hasClass("selected")&&(this.resetRadioButtons(),this.$(b.curChild).addClass("selected"),this.resetTabIndices(),c=this.getAccIDByReplacingIdPrefix(this.$(b.curChild).attr("id")),this.setTabIndex(c,this.tabIndex),this.triggerOnChangeEvent())},deselectRadioButton:function(a){var b=this.getCurrentRadioButtonAndModel(a,!0);void 0!=b&&null!=b.curChild&&(this.$(b.curChild).removeClass("selected"),this.resetTabIndices())},getCurrentRadioButtonAndModel:function(a,b){var c=this.model.get("radioButtonCollection"),d=this.getAllImageContainers(),e=null,f=null,g={curChild:null,curModel:null},h=!1;null==a&&(h=!0);for(var i=0;i<c.length;i++)if(e=c.models[i],f=d[i],h&&(a=this.$(f).attr("id")),a=this.getAccIDByReplacingIdPrefix(a),a==e.get("elementID")&&this.$(f).hasClass("selected")==b)return g.curChild=f,g.curModel=e,g},getSelectedRadioButtonValue:function(){var a=this.getCurrentRadioButtonAndModel(null,!0);return void 0!=a&&null!=a.curModel?a.curModel.get("value"):void 0},getSelectedRadioButtonID:function(){var a=this.getCurrentRadioButtonAndModel(null,!0);return void 0!=a&&null!=a.curModel?a.curModel.get("elementID"):void 0},processKeyEvents:function(a){switch(a.keyCode){case $.ui.keyCode.LEFT:this.selectPrevRadioButton(a),a.preventDefault();break;case $.ui.keyCode.RIGHT:this.selectNextRadioButton(a),a.preventDefault();break;case $.ui.keyCode.UP:this.selectPrevRadioButton(a),a.preventDefault();break;case $.ui.keyCode.DOWN:this.selectNextRadioButton(a),a.preventDefault();break;case $.ui.keyCode.SPACE:this.selectRadioButton(this.$(a.currentTarget).attr("id")),a.preventDefault()}},selectNextRadioButton:function(a){var b=this.model.get("radioButtonCollection"),c=this.getAllImageContainers();0==this.$(c).hasClass("selected")?this.selectAppropriateRadioButton(a.currentTarget,!1,1,b.length-1,0):this.selectAppropriateRadioButton(null,!0,1,b.length-1,0),this.triggerOnChangeEvent()},selectPrevRadioButton:function(a){var b=this.model.get("radioButtonCollection"),c=this.getAllImageContainers();0==this.$(c).hasClass("selected")?this.selectAppropriateRadioButton(a.currentTarget,!1,-1,0,b.length-1):this.selectAppropriateRadioButton(null,!0,-1,0,b.length-1),this.triggerOnChangeEvent()},selectAppropriateRadioButton:function(a,b,c,d,e){var f=this.model.get("radioButtonCollection"),g=this.getAllImageContainers(),h=null,i=null,j=!1;null==a&&(j=!0);for(var k=0;k<f.length;k++)if(h=f.models[k],i=g[k],j&&(a=i),this.getAccIDByReplacingIdPrefix(this.$(a).attr("id"))==h.get("elementID")&&this.$(i).hasClass("selected")==b){this.$(i).removeClass("selected"),k==d?(i=g[e],h=f.models[e]):(i=g[k+c],h=f.models[k+c]),this.$(i).addClass("selected"),this.resetTabIndices(),this.setTabIndex(h.get("elementID"),this.tabIndex),this.setFocus(h.get("elementID"));break}},resetTabIndices:function(){for(var a=this.model.get("radioButtonCollection"),b=null,c=0;c<a.length;c++)b=a.models[c],this.setTabIndex(b.get("elementID"),-1)},setInitialTabIndex:function(){var a=this.getImageContainerWithSmallestTabIndex(),b=this.getAccIDByReplacingIdPrefix(this.$(a).attr("id"));this.tabIndex=this.getTabIndex(b),this.resetTabIndicesExceptSmallestElement(a)},getImageContainerWithSmallestTabIndex:function(){for(var a=this.getAllImageContainers(),b=null,c=this.getAccIDByReplacingIdPrefix(this.$(a[0]).attr("id")),d=this.getTabIndex(c),e=a[0],f=1;f<a.length;f++)b=a[f],c=this.getAccIDByReplacingIdPrefix(this.$(b).attr("id")),this.getTabIndex(c)<d&&(d=this.getTabIndex(this.getAccIDByReplacingIdPrefix(this.$(b).attr("id"))),e=b);return e},resetTabIndicesExceptSmallestElement:function(a){for(var b=this.getAllImageContainers(),c=null,d=null,e=0;e<b.length;e++)c=b[e],c!=a&&(d=this.getAccIDByReplacingIdPrefix(this.$(c).attr("id")),this.setTabIndex(d,-1))},triggerOnChangeEvent:function(){this.trigger(MathInteractives.Common.Components.Views.RadioButton.SELECTION_CHANGED,this.getSelectedRadioButtonValue())},setWidthOfGivenLabels:function(){for(var a=this.model.get("radioButtonCollection"),b=null,c=this.getAllTextContainers(),d=null,e=0;e<a.length;e++)b=a.models[e],d=c[e],null!=b.get("labelWidth")&&this.$(d).css({width:b.get("labelWidth")+"px"})},getAccIDByReplacingIdPrefix:function(a){return a.replace(this.idPrefix,"")},DoesAnyElementHaveTabIndex:function(){for(var a=this.getAllImageContainers(),b=null,c=0;c<a.length;c++)if(b=a[c],-1!=this.getTabIndex(this.getAccIDByReplacingIdPrefix(this.$(b).attr("id"))))return!0;return!1}},{generateRadioButton:function(a){var b;if(a){b="#"+a.id;for(var c=new MathInteractives.Common.Components.Models.RadioButton(a),d=c.get("radioButtonCollection"),e=0;e<a.elementData.length;e++)d.add(a.elementData[e]);var f=new MathInteractives.Common.Components.Views.RadioButton({el:b,model:c});return f}},SELECTION_CHANGED:"selection-changed"})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.radioButton=a(function(a,b,c,d,e){function f(a,b){var d,e,f,h="";return h+="\r\n",f={hash:{},inverse:l.noop,fn:l.program(2,g,b),data:b},(e=c.radioButtonLabel)?d=e.call(a,f):(e=a&&a.radioButtonLabel,d=typeof e===j?e.call(a,f):e),c.radioButtonLabel||(d=m.call(a,d,{hash:{},inverse:l.noop,fn:l.program(2,g,b),data:b})),(d||0===d)&&(h+=d),h+="\r\n"}function g(a,b){var d,e,f="";return f+='\r\n<div class="de-mathematics-interactive-radio-button single-radio-container">\r\n    <div id="',(e=c.radioID)?d=e.call(a,{hash:{},data:b}):(e=a&&a.radioID,d=typeof e===j?e.call(a,{hash:{},data:b}):e),f+=k(d)+'" class="de-mathematics-interactive-radio-button image-container float-left radio-elements normal"></div>\r\n    <div class="de-mathematics-interactive-radio-button text-container float-left radio-elements">',(e=c.text)?d=e.call(a,{hash:{},data:b}):(e=a&&a.text,d=typeof e===j?e.call(a,{hash:{},data:b}):e),f+=k(d)+"</div>\r\n</div>\r\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="",j="function",k=this.escapeExpression,l=this,m=c.blockHelperMissing;return i+="\ufeff",h=c["if"].call(b,(h=b&&b.radioButtonLabel,null==h||h===!1?h:h.length),{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+="\r\n\r\n"})}(),function(){"use strict";MathInteractives.Common.Components.Models.CounterLabel=MathInteractives.Common.Player.Models.Base.extend({defaults:{id:null,idPrefix:null,manager:null,counterLabelWidth:null,counterLabelHeight:null,counterLabelText:null},initialize:function(){this.initializeWidth(),this.initializeHeight(),this.initializeText()},initializeWidth:function(){var a=MathInteractives.Common.Components.Models.CounterLabel;(null===this.get("counterLabelWidth")||void 0===this.get("counterLabelWidth"))&&this.set({counterLabelWidth:a.COUNTER_LABEL_WIDTH})},initializeHeight:function(){var a=MathInteractives.Common.Components.Models.CounterLabel;(null===this.get("counterLabelHeight")||void 0===this.get("counterLabelHeight"))&&this.set({counterLabelHeight:a.COUNTER_LABEL_HEIGHT})},initializeText:function(){(null===this.get("counterLabelText")||void 0===this.get("counterLabelText"))&&this.set({counterLabelText:""})}},{COUNTER_LABEL_WIDTH:58,COUNTER_LABEL_HEIGHT:23})}(),function(){"use strict";MathInteractives.Common.Components.Views.CounterLabel=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,id:null,initialize:function(){this.manager=this.model.get("manager"),this.idPrefix=this.model.get("idPrefix"),this.id=this.model.get("id"),this.$el.html(MathInteractives.Common.Components.templates.counterLabel({counterLabelID:this.id+"-inner-container"}).trim()),this.render(),this.model.on("change",this.render,this)},render:function(){this.initializeCounterLabelDimensions(),this.initializeCounterLabelText()},initializeCounterLabelDimensions:function(){var a=this.model.get("counterLabelWidth"),b=this.model.get("counterLabelHeight");this.$(".counter-label").css({width:a+"px",height:b+"px"})},initializeCounterLabelText:function(){var a=this.model.get("counterLabelText");null!==a&&void 0!==a&&this.$(".counter-label").html(a)},setCounterLabelWidth:function(a){this.model.set({counterLabelWidth:a})},setCounterLabelHeight:function(a){this.model.set({counterLabelHeight:a})},setCounterLabelText:function(a){this.model.set({counterLabelText:a})},setCounterLabelBackgroundColor:function(a){this.$(".counter-label").css({"background-color":a})},setCounterLabelPaddingTop:function(a){this.$(".counter-label").css({"padding-top":a+"px"})},getCounterLabelWidth:function(){return this.model.get("counterLabelWidth")},getCounterLabelHeight:function(){return this.model.get("counterLabelHeight")},getCounterLabelText:function(){return this.model.get("counterLabelText")}},{generateCounterLabel:function(a){if(a){var b="#"+a.id,c=new MathInteractives.Common.Components.Models.CounterLabel(a),d=new MathInteractives.Common.Components.Views.CounterLabel({model:c,el:b});return d}}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.counterLabel=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.counterLabelID)?f=g.call(b,{hash:{},data:e}):(g=b&&b.counterLabelID,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="counter-label"></div>'})}(),function(){MathInteractives.Common.Components.Models.MotionGraph=Backbone.Model.extend({defaults:{title:null,origin:null,xAxis:null,yAxis:null,plots:[],referencePlot:null,plotToRepaint:null,paintReferencePlotFlag:null,player:null,manager:null,idPrefix:null,path:null,MotionGraphClass:this,paintWithEndPoints:!1,showControlOnInit:!1,allowDrawing:!1,tickLength:0,repaintIndicator:0,canvasHeight:100,canvasWidth:100,xAxisStrokeColor:null,yAxisStrokeColor:null,xAxisStepSize:null,yAxisStepSize:null,verticalLineSize:null,horizontalLineSize:null,unitsPerStepsize:5,xUnitsPerStepsize:null,yUnitsPerStepsize:null,prependID:null,showControls:null,trashCanCustomPosition:null,hideRaster:!1,defaultVerticalLine:20,defaultHorizontalLine:30,stepValueColor:"#777777",hideControlButtons:!1,toolTipText:null,toolTipXOffset:null,toolTipYOffset:null,toolTipTextPrecision:null,toolTipBackGroundImageIds:null,xLabelDistFromAxis:null,yLabelDistFromAxis:null,yLabelVerticalOffset:null,characterStyle:null,showGridLines:!0,ignoreZero:!1},initialize:function(){var a=this.get("xUnitsPerStepsize"),b=null,c=this.get("yUnitsPerStepsize");this.setIDPrefix(this.get("idPrefix")+this.get("prependID")),this.get("showControls")&&this.set("showControls",this.get("showControls"));var d,e,f,g,h,i;e=this,d=this.get("plots").plots,f=this.get("title"),f?this.set("title",new MathInteractives.Common.Components.Models.MotionGraph.Title(f)):this.set("title",new MathInteractives.Common.Components.Models.MotionGraph.Title),g=this.get("xAxis"),g?this.set("xAxis",new MathInteractives.Common.Components.Models.MotionGraph.Axis(g)):(b=null!==a?a:this.get("unitsPerStepsize"),this.set("xAxis",new MathInteractives.Common.Components.Models.MotionGraph.Axis({stepSize:48,min:0,max:this.get("defaultHorizontalLine"),unitsPerStepSize:b}))),h=this.get("yAxis"),h?this.set("yAxis",new MathInteractives.Common.Components.Models.MotionGraph.Axis(h)):(b=null!==c?c:this.get("unitsPerStepsize"),this.set("yAxis",new MathInteractives.Common.Components.Models.MotionGraph.Axis({stepSize:48,min:0,max:this.get("defaultVerticalLine"),unitsPerStepSize:b}))),i=this.get("origin"),i?this.set("origin",new MathInteractives.Common.Components.Models.MotionGraph.Point(i)):this.set("origin",new MathInteractives.Common.Components.Models.MotionGraph.Point({x:0,y:0})),d=this.get("plots"),d=new MathInteractives.Common.Components.Models.MotionGraph.PlotLineCollection(d),this.set("plots",d),d.on("add",function(a){e.set("plotToRepaint",a)}),d.on("change",function(a){e.set("plotToRepaint",a)})},setIDPrefix:function(a){a&&this.set("idPrefix",a)},setReferencePlot:function(a){var b,c;c=this,b=this.get("referencePlot"),b&&b.paperPathObject&&(b.paperPathObject.remove(),b.get("points").off("add")),this.set("referencePlot",a),a&&a.get("points").on("add",function(b){c.get("paintReferencePlotFlag")&&c.set("plotToRepaint",a)}),this.get("paintReferencePlotFlag")&&this.set("plotToRepaint",this.get("referencePlot"))},setPaintReferencePlotFlag:function(a){var b;this.set("paintReferencePlotFlag",a),b=this.get("referencePlot"),a&&b&&this.set("plotToRepaint",b)},addPlot:function(a){var b=this;this.get("plots").add(a),a.get("points").on("add",function(c){b.set("plotToRepaint",a)})},clearGraph:function(){var a,b,c,d,e,f,g;for(b=this.get("plots"),c=b.length,f=0;c>f;f++){for(d=b.at(f).paperPathObject,b.at(f).paperEndPointCircleGroup.removeChildren(),a=d.segments.length,e=a-1;e>=0;e--)d.segments[e].remove();b.at(f).get("points").reset()}this.set("plotToRepaint",null),this.set("plots",new MathInteractives.Common.Components.Models.MotionGraph.PlotLineCollection),g=this.get("referencePlot"),g&&g.paperPathObject&&g.paperPathObject.remove(),g&&g.paperEndPointCircleGroup&&(g.paperEndPointCircleGroup.remove(),g.get("points").reset())},setOrigin:function(a){a=new MathInteractives.Common.Components.Models.MotionGraph.Point(a),this.set("origin",a)},getSnappedPoint:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return b={},m=this.get("xAxis"),n=this.get("yAxis"),e=m.get("stepSize"),f=n.get("stepSize"),g=m.get("max"),h=n.get("max"),k=m.get("unitsPerStepSize"),l=n.get("unitsPerStepSize"),i=this.get("origin"),j={},j.x=a.x-i.get("x"),j.y=i.get("y")-a.y,c=Math.round(j.x*(k/e)),d=Math.round(j.y*(l/f)),b.x=c*(e/k)+i.get("x"),b.y=i.get("y")-d*(f/l),b}},{Title:Backbone.Model.extend({defaults:{content:"Height over Time",fillColor:"#6F2AAC",justification:"center",fontSize:18}}),Axis:Backbone.Model.extend({defaults:{labelText:"Axis",labelColor:"#000000",labelJustification:"center",labelFontSize:15,stepSize:null,unitsPerStepSize:null,max:null}}),Point:Backbone.Model.extend({defaults:{x:0,y:0}}),PointCollection:Backbone.Collection.extend({model:this.Point,initialize:function(){this.model=MathInteractives.Common.Components.Models.MotionGraph.Point}}),PlotLine:Backbone.Model.extend({defaults:{points:null,strokeColor:"#22B14C",strokeWidth:1,lineType:null},initialize:function(){var a=this;a.set("points",new MathInteractives.Common.Components.Models.MotionGraph.PointCollection),a.set("lineType",MathInteractives.Common.Components.Models.MotionGraph.PlotLine.LINE_TYPES.CONTINUES_THIN_LINE)},addPoint:function(a){var b;b=new MathInteractives.Common.Components.Models.MotionGraph.Point(a),this.get("points").add(b)}},{LINE_TYPES:{CONTINUES_THIN_LINE:0,DASHED_THIN_LINE:1}}),PlotLineCollection:Backbone.Collection.extend({model:this.PlotLine,initialize:function(){this.model=MathInteractives.Common.Components.Models.MotionGraph.PlotLine,this.paperPathObject=null}})})}(),function(){"use strict";var a=null;a=MathInteractives.Common.Player.Views.Base.extend({manager:null,filePath:null,idPrefix:null,disabledBtnRaster:null,hoverBtnRaster:null,activeBtnRaster:null,allowLineDraw:!1,allowLineDrag:!1,myPaper:null,tool:null,myPath:null,currentGroup:null,xMaxBoundry:null,xMinBoundry:null,yMaxBoundry:null,yMinBoundry:null,allPaths:[],pathCount:0,pointToMove:null,endPointRadius:9,originalPoint:null,drawingColor:"#4c1787",drawingLineHoverColor:"#BC417E",drawingCircleColor:"#FFFFFF",hitAreaCircleRadius:11,drawingCircleStrokeColor:"#7C708C",staticCircleColor:"#00b9e6",staticCircleStrokeColor:"#00b9e6",lineWidth:5,invisibleLine:null,invisibleLineStrokeWidth:12,plotColor:"#00b9e6",gridLineThickness:1,gridLineColor:"#BBBBBB",axisLineThickness:1,axisLineColor:"#BBBBBB",axisLabelFontSize:16,startPoints:null,endPoints:null,clearAllBtn:null,drawLineBtnView:null,dragLineBtnView:null,userGraphBtnView:null,feedbackGraphBtnView:null,xMinGraph:null,xMaxGraph:null,yMinGraph:null,yMaxGraph:null,originX:null,originY:null,player:null,currentGridPosition:{},preventLongTap:!1,showControls:!1,toolTipText:null,xLabelDistFromAxis:29,yLabelDistFromAxis:22,yLabelVerticalOffset:5,toolTipXOffset:null,toolTipYOffset:null,toolTipBackGroundImageIds:null,initialize:function(){var a,b=this,c=null,d=null,e=null,f=null;c=b.$el,d=b.model,b.manager=d.get("manager"),b.filePath=d.get("path"),b.idPrefix=d.get("idPrefix"),b.toolTipText=d.get("toolTipText"),b.toolTipXOffset=d.get("toolTipXOffset"),b.toolTipYOffset=d.get("toolTipYOffset"),b.toolTipXOffset=null===b.toolTipXOffset||"undefined"==typeof b.toolTipXOffset?25:Number(b.toolTipXOffset),b.toolTipBackGroundImageIds=d.get("toolTipBackGroundImageIds"),b.xLabelDistFromAxis=d.get("xLabelDistFromAxis")||b.xLabelDistFromAxis,b.yLabelDistFromAxis=d.get("yLabelDistFromAxis")||b.yLabelDistFromAxis,b.yLabelVerticalOffset=d.get("yLabelVerticalOffset")||b.yLabelVerticalOffset,e=c.find("canvas"),this.myPaper=new paper.PaperScope,a=this.myPaper,a.setup(e[0]),a.activate(),f=this.tool=new a.Tool,f.view=this,MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?(f.onMouseDrag=$.proxy(this.manageMouseMovefeatures,b),f.onMouseUp=function(a){b.positionTooltip(a);var c=b.$("#"+b.idPrefix+"tooltip-container");c.hide(),b.fireEventOnMouseup(a)}):(f.onMouseMove=$.proxy(this.manageMouseMovefeatures,this),f.onMouseUp=$.proxy(this.fireEventOnMouseup,this)),this.setUpGraph(),this.model.on("change",this.repaint,this),this.model.get("showControls")&&(this.showControls=this.model.get("showControls")),this.render(),this.model.get("allowDrawing")&&this.allowLineDrawing(),this.player=d.get("player"),this.xMinGraph=d.get("xAxis").get("min"),this.xMaxGraph=d.get("xAxis").get("max"),this.yMinGraph=d.get("yAxis").get("min"),this.yMaxGraph=d.get("yAxis").get("max"),this.originX=d.get("origin").get("x"),this.originY=d.get("origin").get("y")},render:function(){this.repaint(),this.generateButtons(),this._renderTooltip(),this._hideTrashCanRaster(),this._hideControlButtons()},_renderTooltip:function(){var a='<div id="'+this.idPrefix+'tooltip-container" class="draggable-tooltip-container"><div id="'+this.idPrefix+'tooltip-left" class="draggable-tooltip-left"></div><div id="'+this.idPrefix+'tooltip-mid" class="draggable-tooltip-mid typography-body-text"></div><div id="'+this.idPrefix+'tooltip-right" class="draggable-tooltip-right"></div></div>';this.$el.find(".graph-it-graph-container-main-wrapper").append(a);var b=this.toolTipBackGroundImageIds;if("none"!==b){var c,d;d=b&&b.left?b.left:"tooltip-left",c=this.filePath.getImagePath(d),this.$(".draggable-tooltip-left").css({"background-image":'url("'+c+'")'}),d=b&&b.left?b.middle:"tooltip-middle",c=this.filePath.getImagePath(d),this.$(".draggable-tooltip-mid").css({"background-image":'url("'+c+'")'}),d=b&&b.left?b.right:"tooltip-right",c=this.filePath.getImagePath(d),this.$(".draggable-tooltip-right").css({"background-image":'url("'+c+'")'}),this.$(".draggable-tooltip-container").hide()}},fireEventOnMouseup:function(a){var b=this.$("#"+this.idPrefix+"tooltip-container");this.positionTooltip(a),(null!==b||"undefined"!==b)&&b.hide(),this.trigger(MathInteractives.Common.Components.Views.MotionGraph.CUSTOM_MOUSEUP_EVENT_FIRED,a,this.currentGridPosition)},_hideTrashCanRaster:function(){var a=this,b=a.model.get("hideRaster");b===!0&&(this.disabledBtnRaster.visible=!1,this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1)},_hideControlButtons:function(){this.model.get("hideControlButtons")&&this.$("#"+this.idPrefix+"graph-controls").hide()},generateButtons:function(){if(this.showControls!==!1&&0!==this.$el.find(".graph-controls").length){var a,b,c,d,e;this.$(".graph-controls").show(),a={id:this.idPrefix+"draw-line-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION_DRAW_LINE,path:this.filePath},this.drawLineBtnView=MathInteractives.global.Button.generateButton(a),this.$("#"+this.idPrefix+"draw-line-label").addClass("typography-label"),b={id:this.idPrefix+"move-line-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION_MOVE,path:this.filePath},this.dragLineBtnView=MathInteractives.global.Button.generateButton(b),this.$("#"+this.idPrefix+"move-line-label").addClass("typography-label"),this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),MathInteractives.global.Button.toggleButtonHandler({buttonObjects:[this.drawLineBtnView,this.dragLineBtnView]}),c={id:this.idPrefix+"users-graph-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION,toggleButton:!0,icon:{pathId:"users-graph-line",width:26,height:2},width:56,height:32,path:this.filePath},this.userGraphBtnView=MathInteractives.global.Button.generateButton(c),this.userGraphBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.$("#"+this.idPrefix+"users-graph-label").addClass("typography-body-text"),d={id:this.idPrefix+"feedback-graph-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION,toggleButton:!0,icon:{pathId:"feedback-graph-line",width:26,height:2},width:56,height:32,path:this.filePath},this.feedbackGraphBtnView=MathInteractives.global.Button.generateButton(d),this.feedbackGraphBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.$("#"+this.idPrefix+"feedback-graph-label").addClass("typography-body-text"),e={id:this.idPrefix+"clear-graph-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION,path:this.filePath,text:"Clear All"},this.clearAllBtn=MathInteractives.global.Button.generateButton(e),this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED)}},events:{"click .draw-line-btn.click-enabled":"allowLineDrawing","click .move-line-btn.click-enabled":"allowLineDraging",
"click .users-graph-btn":"showHideUserDrawnGraph","click .feedback-graph-btn":"showHideFeedbackGraph","click .clear-graph-btn.click-enabled":"clearUserCreatedGraph"},setUpGraph:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,l={};for(v=this.myPaper,m=this.model,q=m.get("xAxis"),r=m.get("yAxis"),d=r.get("max"),e=q.get("max"),f=r.get("unitsPerStepSize"),g=q.get("unitsPerStepSize"),n=m.get("tickLength"),l.x=m.get("origin").get("x"),l.y=m.get("origin").get("y"),o=q.get("stepSize"),p=r.get("stepSize"),s=m.get("title"),t=q.get("unitsPerStepSize"),u=r.get("unitsPerStepSize"),w=m.get("verticalLineSize"),x=m.get("horizontalLineSize"),y=m.get("stepValueColor"),z=m.get("characterStyle"),A=m.get("showGridLines"),B=m.get("ignoreZero"),null===y&&(y="#777777"),this.axisLineColor=m.get("xAxisStrokeColor")||this.axisLineColor,this.gridLineColor=m.get("xAxisStrokeColor")||this.gridLineColor,null!==w?(j=w,d=w,p=m.get("yAxisStepSize"),r.set("stepSize",p)):j=p*d/f+n,null!==x?(k=x,e=x,o=m.get("xAxisStepSize"),q.set("stepSize",o)):k=o*e/g+n,a=0;e/g+1>a;a++)h=l.x+a*o,0===a?(b=new v.Path.Line({from:[h,l.y+n],to:[h,l.y+n-j]}),A===!0&&(b.strokeColor=this.axisLineColor,b.strokeWidth=this.axisLineThicknes)):(b=new v.Path.Line({from:[h,l.y+n],to:[h,l.y+n-j]}),A===!0&&(b.strokeColor=this.gridLineColor,b.strokeWidth=this.gridLineThickness)),c=new v.PointText(new v.Point(h,l.y+n+this.xLabelDistFromAxis)),c.style={fontFamily:"Arial, sans-serif",fontWeight:"bold",fontSize:16,fillColor:y},(null!==z||"undefined"!=typeof z)&&(c.characterStyle=z),c.content=(g*a).toString(),c.justification="center",B===!0&&0===a&&c.remove();for(a=0;d/f+1>a;a++)i=l.y-a*p,(i>10&&null!==w||null===w)&&(c=new v.PointText(new v.Point(l.x-n-this.yLabelDistFromAxis,i+this.yLabelVerticalOffset)),c.style={fontFamily:"Arial, sans-serif",fontWeight:"bold",fontSize:16,fillColor:y},(null!==z||"undefined"!=typeof z)&&(c.characterStyle=z),c.content=(f*a).toString(),c.justification="center",B===!0&&0===a&&c.remove()),0===a?(b=new v.Path.Line({from:[l.x-n,i],to:[k+l.x-n,i]}),A===!0&&(b.strokeColor=this.axisLineColor,b.strokeWidth=this.axisLineThicknes)):(b=new v.Path.Line({from:[l.x-n,i],to:[k+l.x-n,i]}),A===!0&&(b.strokeColor=this.gridLineColor,b.strokeWidth=this.gridLineThickness));this.trashCanRasters(m.get("trashCanCustomPosition")),this.showHideGraphControls(this.model.get("showControlOnInit")),this.xMaxBoundry=e*(o/t)+l.x,this.xMinBoundry=l.x,this.yMaxBoundry=l.y,this.yMinBoundry=l.y-d*(p/u)},allowLineDrawing:function(a){this.allowLineDraw=!0,this.allowLineDrag=!1,this.detachSegmentRelocateEvents(),this.attachDrawingEvents()},allowLineDraging:function(a){this.allowLineDraw=!1,this.allowLineDrag=!0,this.detachDrawingEvents(),this.attachSegmentRelocateEvents()},_isPathDisjoint:function(){var a=this.allPaths,b=a.length;if(0>=b)return!1;for(var c,d,e,f,g,h,i=new Array,j=new Array,k=0;b>k;k++)c=a[k].children[0],d=c.segments.length,e=c.segments[0],f=c.segments[d-1],g=this._getPointFromLogicalCoordinate({x:e.point.x,y:e.point.y}).attributes,h=this._getPointFromLogicalCoordinate({x:f.point.x,y:f.point.y}).attributes,i.push({x:Math.round(Number(g.x)),y:Math.round(Number(g.y))}),j.push({x:Math.round(Number(h.x)),y:Math.round(Number(h.y))});this.startPoints=i,this.endPoints=j;var l=this._bubbleSortArray(i,j);i=l[0],j=l[1];for(var m=0;b-1>m;m++)if(j[m].x!==i[m+1].x||j[m].y!==i[m+1].y)return!0;return!1},_bubbleSortArray:function(a,b){for(var c,d=a.length,e=0;d-1>e;e++)for(var f=e+1;d>f;f++)a[f].x<a[e].x&&(c=a[e],a[e]=a[f],a[f]=c,c=b[e],b[e]=b[f],b[f]=c);return[a,b]},_arePointsDrawnCorrect:function(){var a=this.model.get("referencePlot");if(!a||!this.startPoints||!this.endPoints)return!1;var b=a.get("points").toJSON(),c=b.length;if(0>=c)return!1;var d=this.startPoints;d.push(this.endPoints[this.endPoints.length-1]);for(var e=0;c>e;e++)if(b[e].x!==d[e].x||b[e].y!==d[e].y)return!1;return!0},arePointsCorrect:function(){return!this._isPathDisjoint()&&this._arePointsDrawnCorrect()?!0:(this.startPoints=null,this.endPoints=null,!1)},showHideLineEndPoints:function(a){var b,c,d,e,f,g,h,i,j;for(j=this.myPaper,b=a?this.endPointRadius:0,c=this.allPaths,d=this.allPaths.length,e=0;d>e;e++)g=c[e],f=c[e].children[0],h=g.children[1],a?h.scale(100):h.scale(.01),i=g.children[2],a?i.scale(100):i.scale(.01)},attachDrawingEvents:function(){var a=this.tool;a.onMouseUp=null,a.onMouseDown=this.startLine,a.onMouseDrag=$.proxy(this.drawLineOnDrag,this),a.onMouseUp=$.proxy(this.endLine,this),a.onDoubleClick=this.doubleClickOnLine},detachDrawingEvents:function(){var a=this.tool,b=this;a.onMouseUp=null,a.onMouseDown=null,a.onMouseDrag=null,a.onMouseUp=function(){var a=b.$("#"+b.idPrefix+"tooltip-container");a.hide()}},doubleClickOnLine:function(a){},startLine:function(a){var b,c,d,e,f,g=this.view;if(!g.preventLongTap){if(g.preventLongTap=!0,f=g.myPaper,d=g.isValidPoint(a.point),e=g.endPointRadius,!d)return void(g.preventLongTap=!1);if(g.allowLineDraw&&!g.allowLineDrag){c=g.model.getSnappedPoint(a.point),b=new f.Point(c.x,c.y),g.currentGroup=new f.Group,g.myPath=new f.Path,g.myPath.add(b),g.myPath.strokeColor=g.drawingColor,g.myPath.strokeWidth=g.lineWidth,g.myPath.strokeCap="round",g.myPath.strokeJoin="bevel",g.myPath.shadowColor=new f.Color(0,0,0),g.myPath.shadowColor.alpha=.68,g.myPath.shadowBlur=3,g.myPath.shadowOffset=new f.Point(2,2);var h=new f.Path.Circle(b,e);h.fillColor={gradient:{stops:[["#ffffff",0],["#cec8d8",1]],radial:!1},origin:{x:h.position._x,y:h.position._y-e},destination:{x:h.position._x,y:h.position._y+e}},h.strokeColor=g.drawingCircleStrokeColor,h.shadowColor=new f.Color(0,0,0),h.shadowBlur=3,h.shadowOffset=new f.Point(2,1),g.invisibleLine=new f.Path,g.invisibleLine.add(b),g.invisibleLine.strokeColor="green",g.invisibleLine.strokeWidth=g.invisibleLineStrokeWidth,g.invisibleLine.strokeCap="round",g.invisibleLine.strokeJoin="round",g.invisibleLine.opacity=.01;var i=new f.Path.Circle(b,g.hitAreaCircleRadius);i.fillColor=g.drawingCircleColor,i.strokeColor=g.drawingCircleStrokeColor,i.opacity=.01,g.currentGroup=new f.Group([g.myPath,h,g.invisibleLine,i])}}},drawLineOnDrag:function(a){var b,c;this.myPath&&(c=this.myPaper,this.allowLineDraw&&!this.allowLineDrag&&(b={},this.myPath.segments.length>1&&(this.myPath.segments.pop(),this.invisibleLine.segments.pop()),b=this.getValidPoint(a.point),this.myPath.add(new c.Point(b)),this.invisibleLine.add(new c.Point(b))),this.positionTooltip(a))},endLine:function(a){var b,c,d,e,f,g,h,i=this.$("#"+this.idPrefix+"tooltip-container");if(i.hide(),this.myPath&&(this.preventLongTap=!1,e=this.myPaper,b=this.myPath.segments[0].point,this.allowLineDraw&&!this.allowLineDrag)){if(h=this.getValidPoint(a.point),f=this.model.getSnappedPoint(h),g=new e.Point(f.x,f.y),g.x===b.x&&g.y===b.y)return this.currentGroup.remove(),this.currentGroup=null,this.myPath=null,void this.myPaper.view.draw();this.myPath.segments.length>1&&this.myPath.segments.pop(),this.myPath.add(g),d=this.endPointRadius,c=new e.Path.Circle(g,d),c.fillColor={gradient:{stops:[["#ffffff",0],["#cec8d8",1]],radial:!1},origin:{x:c.position._x,y:c.position._y-d},destination:{x:c.position._x,y:c.position._y+d}},c.shadowColor=new e.Color(0,0,0),c.shadowBlur=3,c.shadowOffset=new e.Point(2,1),c.strokeColor=this.drawingCircleStrokeColor,this.currentGroup.insertChild(2,c);var j=new e.Path.Circle(g,this.hitAreaCircleRadius);j.fillColor=this.drawingCircleColor,j.strokeColor=this.drawingCircleStrokeColor,j.opacity=.01,this.currentGroup.insertChild(5,j),this.currentGroup.pos=this.pathCount,this.currentGroup.name="name-"+this.pathCount.toString(),this.allPaths.push(this.currentGroup),this.pathCount+=1,this.allPaths.length>0?(this.disabledBtnRaster.visible=!1,this.activeBtnRaster.visible=!0):(this.disabledBtnRaster.visible=!0,this.activeBtnRaster.visible=!1),this.myPath=null,this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_ACTIVE),this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_ACTIVE),this.trigger(MathInteractives.Common.Components.Views.MotionGraph.FIRST_LINE_DRAWN)}},manageMouseMovefeatures:function(a){this.positionTooltip(a),this.allowLineDraw&&this.manageCursor(a.point)},manageCursor:function(a){this.isValidPoint(a)?this.$el.find(".graph-it-canvas").addClass("crossHairCursor"):this.$el.find(".graph-it-canvas").removeClass("crossHairCursor")},positionTooltip:function(a){var b=this._getPointFromLogicalCoordinate({x:a.point.x,y:a.point.y}).attributes,c=null,d=(this.model.get("verticalLineSize"),this.model),e=d.get("xAxis"),f=d.get("yAxis"),g=(e.get("stepSize"),f.get("stepSize"),e.get("unitsPerStepSize"),f.get("unitsPerStepSize"),a.point.x,a.point.y,this.toolTipYOffset),h=this.model.get("toolTipTextPrecision"),i=this.currentGridPosition;h=h&&0!==h?Number(h):1,c={x:Math.round(b.x/h)*h,y:Math.round(b.y/h)*h};var j=this.$("#"+this.idPrefix+"tooltip-container");if(!this.player.getModalPresent())if(c.x>=this.xMinGraph&&c.x<=this.xMaxGraph&&c.y>=this.yMinGraph&&c.y<=this.yMaxGraph){var k=c.x,l=c.y;i.xValue=k,i.yValue=l;var m=this.toolTipText,n=m&&m.message?m.message:"%@$%, %@$%",o=m&&m.units?m.units:[],p=[];o.length&&4===o.length?(p.push(k+o[1===k||0===k?0:1]),p.push(l+o[1===l||0===l?2:3])):(p.push(k),p.push(l)),n=this._replaceSpecialStr(n,p),this.$(".draggable-tooltip-mid").html(n),g=null===g||"undefined"==typeof g?j.height()/2:Number(g),j.show().css({left:String(a.point.x+this.toolTipXOffset)+"px",top:String(a.point.y+g)+"px"})}else j.hide()},_replaceSpecialStr:function(a,b){for(var c=0;c<b.length;c++)a=a.replace("%@$%",b[c]);return a},triggerMouseUp:function(a){var b,c,d,e,f,g;b=a.data.group,d=a.data.viewObj,e=$(a.target),g=this,f=e.parents("#"+d.$el.attr("id")).length>0,f||(c={},c.point=d.originalPoint,b.fire("mouseup",c)),$(this).off("mouseup",d.triggerMouseUp)},attachSegmentRelocateEvents:function(){var a,b,c,d;for(b=this.allPaths,a=b.length,d=this,c=0;a>c;c++)b[c].onMouseDown=function(a){var b,c,e,f,g;this.bringToFront(),b=d,b.pointToMove=null,f=this.children[0],g=this,c=f.segments[0].point,e=f.segments[f.segments.length-1].point,d.distanceBetweenTwoPoints(a.point,c)<d.hitAreaCircleRadius?(b.pointToMove={},b.pointToMove.endPoint=this.children[1],b.pointToMove.index=0):d.distanceBetweenTwoPoints(a.point,e)<d.hitAreaCircleRadius?(b.pointToMove={},b.pointToMove.endPoint=this.children[2],b.pointToMove.index=this.children[0].segments.length-1):b.originalPoint=this.position,$(document.body).on("mouseup",{group:g,viewObj:b},b.triggerMouseUp)},b[c].onMouseDrag=function(a){var b,c,e,f;b=d,c=this.children[0],f=this.children[3],b.pointToMove?(e=d.getValidPoint(a.point),b.pointToMove.endPoint.position=e,this.children[b.pointToMove.index+4].position=e,c.removeSegment(b.pointToMove.index),c.insert(b.pointToMove.index,e),f.removeSegment(b.pointToMove.index),f.insert(b.pointToMove.index,e)):this.position=a.point,b.pointerOverTrashCan(a.point)?(b.activeBtnRaster.visible=!1,b.hoverBtnRaster.visible=!0):(b.activeBtnRaster.visible=!0,b.hoverBtnRaster.visible=!1),b.positionTooltip(a)},b[c].onMouseEnter=function(){var a=d;this.children[0].strokeColor=a.drawingLineHoverColor,this.children[1].fillColor={gradient:{stops:[["#cec8d8",0],["#ffffff",1]],radial:!1},origin:{x:this.children[1].position._x,y:this.children[1].position._y-a.endPointRadius},destination:{x:this.children[1].position._x,y:this.children[1].position._y+a.endPointRadius}},this.children[2].fillColor={gradient:{stops:[["#cec8d8",0],["#ffffff",1]],radial:!1},origin:{x:this.children[2].position._x,y:this.children[2].position._y-a.endPointRadius},destination:{x:this.children[2].position._x,y:this.children[2].position._y+a.endPointRadius}},this.children[1].radius=30,this.children[2].radius=30,this.children[1].strokeWidth=1,this.children[2].strokeWidth=1,this.children[1].strokeColor=a.drawingCircleStrokeColor,this.children[2].strokeColor=a.drawingCircleStrokeColor,a.$(".graph-it-canvas").addClass("handCursor")},b[c].onMouseLeave=function(){var a=d;this.children[0].strokeColor=a.drawingColor,this.children[1].fillColor={gradient:{stops:[["#ffffff",0],["#cec8d8",1]],radial:!1},origin:{x:this.children[1].position._x,y:this.children[1].position._y-a.endPointRadius},destination:{x:this.children[1].position._x,y:this.children[1].position._y+a.endPointRadius}},this.children[2].fillColor={gradient:{stops:[["#ffffff",0],["#cec8d8",1]],radial:!1},origin:{x:this.children[2].position._x,y:this.children[2].position._y-a.endPointRadius},destination:{x:this.children[2].position._x,y:this.children[2].position._y+a.endPointRadius}},a.$(".graph-it-canvas").removeClass("handCursor")},b[c].onMouseUp=function(a){var b=self.$("#"+self.idPrefix+"tooltip-container");b.hide();var c,e,f,g,h;if(c=d,g=this.children[0],h=this.children[3],c.pointToMove)e=c.getValidPoint(a.point),f=c.getValidSnappedPoint(e,this.pos),c.pointToMove.endPoint.position=f,this.children[c.pointToMove.index+4].position=f,g.removeSegment(c.pointToMove.index),g.insert(c.pointToMove.index,f),h.removeSegment(c.pointToMove.index),h.insert(c.pointToMove.index,e);else{if(c.pointerOverTrashCan(a.point)){if(this.trigger("mouseleave"),c.detachEventsOnIndividualSegments(this),c.removePath(this),this.remove(),c.hoverBtnRaster.visible=!1,!(d.allPaths.length>0))return c.drawLineBtnView.$el.trigger("click"),c.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),c.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),c.trigger(MathInteractives.Common.Components.Views.MotionGraph.ALL_LINES_CLEARED),c.disabledBtnRaster.visible=!0,c.activeBtnRaster.visible=!1,void c.allowLineDrawing();c.activeBtnRaster.visible=!0,c.disabledBtnRaster.visible=!1}if(this.position=a.point,c.isValidPoint(g.segments[0].point)&&c.isValidPoint(g.segments[g.segments.length-1].point)){return}else this.position=c.originalPoint}c.pointToMove=null,c.originalPoint=null}},detachSegmentRelocateEvents:function(){var a,b,c;for(b=this.allPaths,a=b.length,c=0;a>c;c++)this.detachEventsOnIndividualSegments(b[c])},detachEventsOnIndividualSegments:function(a){var b=this;a.onMouseDown=null,a.onMouseDrag=null,a.onMouseLeave=null,a.onMouseEnter=null,a.onMouseUp=function(){var a=b.$("#"+b.idPrefix+"tooltip-container");a.hide()},a.onMouseMove=null},removePath:function(a){var b,c,d;for(c=this.allPaths,b=c.length,d=0;b>d;d++)if(a.pos===c[d].pos){this.detachEventsOnIndividualSegments(c[d]),c.splice(d,1);break}},pointerOverTrashCan:function(b){var c,d,e,f,g,h,i=this.model.get("trashCanCustomPosition"),j=i?i.x:a.DELETE_BTN_X,k=i?i.y:a.DELETE_BTN_Y;return c=j-a.DELETE_BTN_WIDTH/2,d=j+a.DELETE_BTN_WIDTH-a.DELETE_BTN_WIDTH/2,e=k-a.DELETE_BTN_HEIGHT/2,f=k+a.DELETE_BTN_HEIGHT-a.DELETE_BTN_HEIGHT/2,g=b.x,h=b.y,g>c&&d>g&&h>e&&f>h?!0:!1},trashCanRasters:function(b){var c,d=(this.model,b?b:{x:a.DELETE_BTN_X,y:a.DELETE_BTN_Y});c=this.myPaper,this.activeBtnRaster=new c.Raster({source:this.filePath.getImagePath("trashcan-up"),position:d,visible:!1}),this.disabledBtnRaster=new c.Raster({source:this.filePath.getImagePath("trashcan-disabled"),position:d,visible:!0}),this.hoverBtnRaster=new c.Raster({source:this.filePath.getImagePath("trashcan-hover"),position:d,visible:!1})},showHideGraphControls:function(a){a?(this.$el.find(".graph-controls").show(),this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1,this.disabledBtnRaster.visible=!0):(this.$el.find(".graph-controls").hide(),this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1,this.disabledBtnRaster.visible=!1)},distanceBetweenTwoPoints:function(a,b){var c;return c=MathInteractives.Common.Utilities.Models.Utils.distanceBetweenPoints(a.x,a.y,b.x,b.y),c=Math.floor(c)},isValidPoint:function(a){return a.x<this.xMinBoundry||a.x>this.xMaxBoundry||a.y>this.yMaxBoundry||a.y<this.yMinBoundry?!1:!0},getValidPoint:function(a){var b;return this.isValidPoint(a)?b=a:(b={},b.x=a.x>this.xMaxBoundry?this.xMaxBoundry:a.x<this.xMinBoundry?this.xMinBoundry:a.x,b.y=a.y>this.yMaxBoundry?this.yMaxBoundry:a.y<this.yMinBoundry?this.yMinBoundry:a.y,b=new this.myPaper.Point(b)),b},getPointDetailsInVicinity:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;for(c={},c.index=null,c.segmentIndex=null,j=2*this.endPointRadius,d=this.allPaths,e=d.length,f=0;e>f;f++)d[f].pos!==b&&(o=d[f].children[0],i=o.segments.length,g=o.segments[0].point,h=o.segments[i-1].point,k=this.distanceBetweenTwoPoints(a,g),l=this.distanceBetweenTwoPoints(a,h),l>k?m=j>k?!0:!1:n=j>l?!0:!1,m?(j=k,c.index=f,c.segmentIndex=0):n&&(j=l,c.index=f,c.segmentIndex=i-1),m=n=!1);return c},getValidSnappedPoint:function(a,b){var c,d,e;return c=this.model.getSnappedPoint(a),c=new this.myPaper.Point(c.x,c.y),d=this.getPointDetailsInVicinity(a,b),e=d.index?this.allPaths[d.index].children[0].segments[d.segmentIndex].point:c},repaint:function b(){this.myPaper.activate();var c,d,e,f,g,h,b,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(s=this.myPaper,k=this.model,p=this.model.get("plotToRepaint"),x=5,null===p&&this.myPaper.view)return void this.myPaper.view.draw();switch(this.model.set("plotToRepaint",null),i=k.get("origin").get("x"),j=k.get("origin").get("y"),l=k.get("xAxis"),m=k.get("yAxis"),n=l.get("stepSize"),o=m.get("stepSize"),r=m.get("unitsPerStepSize"),q=l.get("unitsPerStepSize"),t=p.get("lineType"),u=a.LINE_TYPES,d=p.get("points").models,c=d.length,b=p.paperPathObject?p.paperPathObject:new s.Path,v=p.paperEndPointCircleGroup?p.paperEndPointCircleGroup:new s.Group,b.removeSegments(),v.removeChildren(),b.strokeColor=this.plotColor,b.strokeWidth=this.lineWidth,t){case u.DASHED_THIN_LINE:b.dashArray=[8,4]}for(e=0;c>e;e++)g=Math.floor(d[e].get("x")*n/q+i),h=Math.floor(j-d[e].get("y")*o/r),f=new s.Point(g,h),b.add(f);if(this.model.get("paintWithEndPoints"))for(e=0;c>e;e++)g=Math.floor(d[e].get("x")*n/q+i),h=Math.floor(j-d[e].get("y")*o/r),f=new s.Point(g,h),w=new s.Path.Circle({center:f,radius:x}),w.strokeColor=this.staticCircleStrokeColor,w.fillColor=this.staticCircleColor,v.addChild(w);p.paperPathObject=b,p.paperEndPointCircleGroup=v,this.myPaper.view.draw()},_getPointFromLogicalCoordinate:function(a){var b=this.model,c=b.get("origin").get("x"),d=b.get("origin").get("y"),e=b.get("xAxis"),f=b.get("yAxis"),g=e.get("stepSize"),h=f.get("stepSize"),i=f.get("unitsPerStepSize"),j=e.get("unitsPerStepSize"),k=(a.x-c)*j/g,l=(d-a.y)*i/h,m=new MathInteractives.Common.Components.Models.MotionGraph.Point({x:k,y:l});return m},_setTitleTextInModel:function(a){a&&this.model.get("title").set("content",a)},_getTitleTextFromModel:function(){return this.model.get("title").get("content")},_setXAxisLabelInModel:function(a){a&&this.model.get("xAxis").set("labelText",a)},_getXAxisLabelFromModel:function(){return this.model.get("xAxis").get("labelText")},_setYAxisLabelInModel:function(a){a&&this.model.get("yAxis").set("labelText",a)},_getYAxisLabelFromModel:function(){return this.model.get("yAxis").get("labelText")},_alignLabel:function(a){if("undefined"!=typeof a){var b=(MathInteractives.Common.Player.Views.Player,MathInteractives.Common.Components.Views.MotionGraph),c=b.AXIS_LABEL_PADDING,d=b.TITLE_LABEL_PADDING,e=this.xMinBoundry,f=this.xMaxBoundry,g=this.yMinBoundry,h=this.yMaxBoundry,i={topLeft:{x:e,y:g},bottomRight:{x:f,y:h},topRight:{x:f,y:g},bottomLeft:{x:e,y:h},xAxisLength:f-e,yAxisLength:h-g},j=null,k=null;switch(a){case"xAxis":j=this.$("#"+this.idPrefix+"draw-graph-x-axis-label"),k=this.player.getTextHeightWidth(this._getXAxisLabelFromModel(),"draw-graph-x-axis-label typography-label"),j.css({top:i.bottomLeft.y+c,left:i.bottomLeft.x+i.xAxisLength/2-k.width/2});break;case"yAxis":j=this.$("#"+this.idPrefix+"draw-graph-y-axis-label"),k=this.player.getTextHeightWidth(this._getYAxisLabelFromModel(),"draw-graph-y-axis-label typography-label"),j.css({top:i.bottomLeft.y-i.yAxisLength/2-k.height/2,left:i.bottomLeft.x-k.width/2-k.height/2-c});break;case"title":j=this.$("#"+this.idPrefix+"draw-graph-title"),k=this.player.getTextHeightWidth(this._getTitleTextFromModel(),"draw-graph-title typography-header"),j.css({top:i.topLeft.y-k.height/2-d,left:i.topLeft.x+i.xAxisLength/2-k.width/2})}}},showHideFeedbackGraph:function(){var a,b,c;a=this.model.get("referencePlot"),a&&a.paperPathObject&&(b=a.paperPathObject,b.visible=!b.visible),a&&a.paperEndPointCircleGroup&&(c=a.paperEndPointCircleGroup,c.visible=!c.visible),this.myPaper.view.draw()},showFeedbackGraph:function(){var a,b,c;a=this.model.get("referencePlot"),a&&a.paperPathObject&&(b=a.paperPathObject,b.visible=!0,this.myPaper.view.draw()),a&&a.paperEndPointCircleGroup&&(c=a.paperEndPointCircleGroup,c.visible=!0)},showHideUserDrawnGraph:function(){var a,b,c;for(a=this.allPaths,b=a.length,c=0;b>c;c++)a[c].visible=!a[c].visible;this.myPaper.view.draw()},showUserDrawnGraph:function(){var a,b,c;for(a=this.allPaths,b=a.length,c=0;b>c;c++)a[c].visible=!0;this.myPaper.view.draw()},enableDrawing:function(){this.hoverBtnRaster.visible=!1,this.allPaths.length>0?(this.activeBtnRaster.visible=!0,this.disabledBtnRaster.visible=!1,this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_ACTIVE)):(this.disabledBtnRaster.visible=!0,this.activeBtnRaster.visible=!1,this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED)),this.drawLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.allowLineDrawing()},disableDrawing:function(){this.allowLineDraw=!1,this.allowLineDrag=!1,this.detachDrawingEvents(),this.detachSegmentRelocateEvents(),this.drawLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1,this.disabledBtnRaster.visible=!0,this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED)},showHideGraphDisplayBtns:function(a){a?(this.userGraphBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.feedbackGraphBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.$el.find(".users-graph-control").show(),this.$el.find(".feedback-graph-control").show(),this.showFeedbackGraph(),this.showUserDrawnGraph()):(this.$el.find(".users-graph-control").hide(),this.$el.find(".feedback-graph-control").hide())},clearUserCreatedGraph:function(){var a,b;for(this.detachSegmentRelocateEvents(),this.detachDrawingEvents(),this.allowLineDrawing(),a=this.allPaths,b=a.length;a.length>0;)a[0].remove(),this.removePath(a[0]);this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1,this.disabledBtnRaster.visible=!0,this.drawLineBtnView.$el.trigger("click"),this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.myPaper.view.draw(),this.trigger(MathInteractives.Common.Components.Views.MotionGraph.ALL_LINES_CLEARED)},getUserDrawLineCount:function(){return this.allPaths?this.allPaths.length:0},setTitle:function(a){return a?(this._setTitleTextInModel(a),this.$("#"+this.idPrefix+"draw-graph-title").append(this._getTitleTextFromModel()),void this._alignLabel("title")):void 0},setXAxisLabel:function(a){return a?(this._setXAxisLabelInModel(a),this.$("#"+this.idPrefix+"draw-graph-x-axis-label").append(this._getXAxisLabelFromModel()),void this._alignLabel("xAxis")):void 0},setYAxisLabel:function(a){return a?(this._setYAxisLabelInModel(a),this.$("#"+this.idPrefix+"draw-graph-y-axis-label").append(this._getYAxisLabelFromModel()),void this._alignLabel("yAxis")):void 0},setTooltipText:function(a){this.model.set("toolTipText",a),this.toolTipText=a}},{LINE_TYPES:{CONTINUES_THIN_LINE:0,DASHED_THIN_LINE:1},FIRST_LINE_DRAWN:"first_line_drawn",ALL_LINES_CLEARED:"all_lines_cleared",CUSTOM_MOUSEUP_EVENT_FIRED:"mouseup-event-fired",AXIS_LABEL_PADDING:35,TITLE_LABEL_PADDING:20,DELETE_BTN_X:345,DELETE_BTN_Y:357,DELETE_BTN_HEIGHT:49,DELETE_BTN_WIDTH:127}),MathInteractives.Common.Components.Views.MotionGraph=a}(),function(){MathInteractives.Common.Player.Models.Table=Backbone.Model.extend({defaults:{isSuperTable:!1,hasAlternateRowColors:!1,idPrefix:"",idSuffix:"",showRedundantValues:!1,showCurrentRowColor:!0,blinkRedundantRow:!1,changeRedundantRowToCurrent:!1,tableData:null,defaultRowCount:null,defaultColumnCount:null,isTableDisabled:null,tabIndex:-1,enableTableSorting:!1,columnsForCustomSort:null,classForCustomSort:"",customSortingOrder:null,filePath:null,manager:null,player:null,tableScreenId:null,prevElementAccId:null,nextElementAccId:null,headerRowCustomClass:null,headerRowBGPath:null,dataRowCustomClass:null,dataRowBGPath:null,tableBorderClass:null,hasInputBoxInTable:!1,hasAccDelay:null},initialize:function(){"use strict";var a=MathInteractives.Common.Player.Models.Table;this.get("tableData")?this.set("tableData",new a.DataRows(this.get("tableData"))):this.set("tableData",new a.DataRows),this.get("hasAccDelay")||this.set("hasAccDelay",!1)}},{DataRow:Backbone.Model.extend({defaults:{isHeaderRow:!1,isSubHeaderRow:!1,isTableSectionHeaderRow:!1,rowData:null,rowNumber:null},initialize:function(){"use strict";var a=MathInteractives.Common.Player.Models.Table;this.get("isHeaderRow")===!0?this.get("rowData")?this.set("rowData",new a.HeaderCells(this.get("rowData"))):this.set("rowData",new a.HeaderCells):this.get("rowData")?this.set("rowData",new a.DataCells(this.get("rowData"))):this.set("rowData",new a.DataCells)}}),DataRows:Backbone.Collection.extend({model:this.DataRow,initialize:function(){"use strict";this.model=MathInteractives.Common.Player.Models.Table.DataRow}}),DataCell:Backbone.Model.extend({defaults:{text:null,addBlankData:null,formulaForCalculation:null,showCalculatedValues:!1,compareWithColumns:null,columnNumberForTicks:null,showTicksInThisCell:!1}}),DataCells:Backbone.Collection.extend({model:this.DataCell,initialize:function(){"use strict";this.model=MathInteractives.Common.Player.Models.Table.DataCell}}),HeaderCell:Backbone.Model.extend({defaults:{text:null,rowSpan:1,colSpan:1,width:100}}),HeaderCells:Backbone.Collection.extend({model:this.HeaderCell,initialize:function(){"use strict";this.model=MathInteractives.Common.Player.Models.Table.HeaderCell}})})}(),function(){"use strict";var _filePath=null;MathInteractives.Common.Player.Views.DataTable=MathInteractives.Common.Player.Views.Base.extend({manager:null,idPrefix:null,player:null,_columnCount:null,_lastSortedColumn:null,_previousAccElementId:null,_nextAccElementId:null,_bShiftKeyPressed:!1,initialize:function(){this.manager=this.model.get("manager"),this.idPrefix=this.model.get("idPrefix"),this.player=this.model.get("player"),this._nextAccElementId=this.model.get("nextElementAccId"),this._previousAccElementId=this.model.get("prevElementAccId"),this.render()},events:function a(){var a={"click .header-table .tbl-header.sorting-enabled":"_onTableHeaderClick"};return null!==this.player&&this.player.model.get("isAccessible")&&(a["focusin .body-table"]="_onTableFocusIn",a["focusout .body-table"]="_onTableFocusOut",a.keydown="_onTableKeyDown"),a},render:function(){var a=this,b=this.model,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=b.get("tableData").length,k=$("<thead></thead>"),l=$("<tbody></tbody>"),m=0,n=0,o=0,p=0,q=b.get("idSuffix"),r=b.get("isTableDisabled"),s=b.get("showRedundantValues"),t=b.get("showCurrentRowColor"),u=b.get("blinkRedundantRow"),v=b.get("changeRedundantRowToCurrent"),w=b.get("columnsForCustomSort"),x={},y=0;null!==this.manager&&-1!==b.get("tabIndex")&&(y=this.manager.model.get("startTabindex")),_filePath=b.get("filePath");for(var z=0;j>z;z++){var A=new MathInteractives.Common.Player.Views.DataRow({model:a.model.get("tableData").models[z],player:this.player,enableTableSorting:b.get("enableTableSorting")});if(A.model.get("isHeaderRow")===!0||A.model.get("isSubHeaderRow")===!0)k.append(A.el),m++,z==j-1&&(this._columnCount=A.model.get("rowData").length);else{var B,C,D=!1,E=[];this._columnCount=A.model.get("rowData").length,$(A.el).find("div").each(function(){E.push($(this).text())}),l.find("tr").each(function(){C=[],$(this).find("div").each(function(){C.push($(this).text())});for(var a=!0,b=0;b<E.length&&(E[b]!==C[b]&&(a=!1),a!==!1);b++);a===!0&&(B=$(this).find("td"),D=!0,n++)}),D===!0&&u===!0&&B.each(function(){$(this).addClass("blinkRowColor")}),(D===!0&&s===!0||D===!1)&&l.append(A.el),D===!0&&v===!0&&($(B[0]).parents().find("tr.table-row").find("td").removeClass("current-row currentRowColor"),B.each(function(){$(this).addClass("current-row currentRowColor")})),z===j-1&&($(A.el).parent().find("td").removeClass("current-row"),$(A.el).find("td").addClass("current-row"),t===!0&&($(A.el).parent().find("td").removeClass("currentRowColor"),$(A.el).find("td").addClass("currentRowColor")))}A.model.set("rowNumber",z),$(A.el).find("td,th").addClass("row_"+z),$(A.el).attr("rowNumber",z)}if(s===!0&&(n=0),b.get("defaultRowCount")+n>=j){for(var F=b.get("defaultRowCount")+n-(j-1),G=[],z=0;z<b.get("defaultColumnCount");z++)G.push({text:MathInteractives.Common.Player.Views.DataCell.defaultTextString});for(var z=0;F>z;z++){var A=new MathInteractives.Common.Player.Views.DataRow({model:new MathInteractives.Common.Player.Models.Table.DataRow({isHeaderRow:!1,rowData:G}),emptyRow:!0});l.append(A.el)}}if(e=$("<table></table>",{id:this.idPrefix+"header-table"+q,"class":"header-table tbl",cellpadding:0,cellspacing:0,border:0,role:"presentation",tabIndex:-1}),g=$("<table></table>",{id:this.idPrefix+"body-table"+q,"class":"body-table tbl tablesorter",cellpadding:0,cellspacing:0,border:0,tabIndex:y+this.model.get("tabIndex")}),h=$("<div></div>",{"class":"table-bottom-border"}),k.appendTo([e,g]),l.appendTo(g),d=$("<div></div>",{id:this.idPrefix+"header-table-holder"+q,"class":"header-table-holder"}).append(e),f=$("<div></div>",{id:this.idPrefix+"body-table-holder"+q,"class":"body-table-holder"}).append(g),c=$("<div></div>",{id:this.idPrefix+"complete-table-holder"+q,"class":"complete-table-holder"}).append(d),c.append(f),c.append(h),$(a.el).html("").append(c),o=$(a.el).width()-17,this.$(".complete-table-holder").css({width:o}),this._addImportantToStyle(this.$(".header-table, .body-table"),{width:o+"px"}),this._addImportantToStyle(this.$(".table-bottom-border"),{width:o+"px"}),p=this.$(".header-table").height(),this.$(".body-table-holder")[0].scrollHeight-p>this.$(".body-table-holder")[0].offsetHeight&&this.$(".complete-table-holder").css({width:$(this.el).width()+"px"}),this.$(".body-table").css({"margin-top":-(p+1)+"px"}),this.$(".current-row").position()&&f.scrollTop(this.$(".current-row").position().top-f.height()),r===!0&&(i=$("<div></div>",{"class":"tableMask"}),this._addImportantToStyle(i,{height:f.height()+p+2+"px",width:f.width()+"px"}),f.append(i),d.find("table").addClass("disabled")),b.get("enableTableSorting")===!0){for(var z=0;z<this._columnCount;z++){var H=function(a,b,c){var d=$(a).find(".table-blank-data");return d.length>0?d.is(":visible")?"":void 0:$(a).text()};x[z]=H}if(null!==w)for(var I=b.get("classForCustomSort"),H=function(a,b,c){return $(a).find("."+I).text()},z=0;z<w.length;z++)x[w[z]]=H;this.$(".body-table").tablesorter({textExtraction:x}),this.$(".body-table .tbl-header").removeAttr("tabindex"),this.$(".body-table").on("sortEnd",function(){a._rearrangeTableData(),a.trigger("table-sorting-complete")});for(var z=0;z<this._columnCount;z++)this.$(".body-table")[0].config.headers[z]={sorter:!0}}this.$(".body-table-holder").attr("tabindex",-1),this.$(".header-table-holder").attr("tabindex",-1),this._applyCustomStyles()},_applyCustomStyles:function(){var a=this.model,b=this.$(".tbl-header,.tbl-sub-header,.tbl-section-header"),c=this.$(".tbl-header-up-arrrow-image,.tbl-header-down-arrrow-image"),d=b.attr("style"),e=this.$(".tbl-cell"),f=e.attr("style"),g=a.get("headerRowCustomClass"),h=a.get("headerRowBGPath"),i=a.get("dataRowCustomClass"),j=a.get("dataRowBGPath"),k=a.get("tableBorderClass");null!==g&&(b.addClass(g),
c.addClass(g)),null!==h&&(d=b.attr("style"),(null===d||void 0===d)&&(d=""),b.attr("style",d+'background-image: url("'+h+'") !important;')),null!==i&&e.addClass(i),null!==j&&(f=e.attr("style"),(null===f||void 0===f)&&(f=""),e.attr("style",f+'background-image: url("'+j+'") !important;')),null!==k&&this.$(".tbl th, .tbl td, table.tbl, .table-bottom-border").addClass(k)},highlightRowNumber:function(a){this.$(".currentRowColor").removeClass("currentRowColor"),this.$(".current-row").removeClass("current-row"),$(this.$(".body-table-holder tbody").find("tr").get(a-1)).find("td").addClass("current-row currentRowColor"),this.$(".current-row").position()&&(this.$(".body-table-holder").scrollTop(0),this.$(".body-table-holder").scrollTop(this.$(".current-row").position().top-this.$(".body-table-holder").height()+this.$(".current-row").height()))},scrollToRowNumber:function(a){var b=this.$(".body-table-holder"),c=this.$(".body-table-holder tbody"),d=$(c.find("tr").get(a-1)).position().top;b.scrollTop(0),b.scrollTop(d-b.height())},addRow:function(a){var b=new MathInteractives.Common.Player.Models.Table.DataRow(a),c=new MathInteractives.Common.Player.Views.DataRow({model:b});this._checkDuplicateNAddRow(this,c),this.$(".body-table-holder")[0].scrollHeight>this.$(".body-table-holder")[0].offsetHeight&&this.$(".complete-table-holder").css({width:$(this.el).width()+"px"})},_checkDuplicateNAddRow:function(a,b){for(var c,d=1,e=a.$("tbody"),f=0,g=(a.model.get("isTableDisabled"),a.model.get("showRedundantValues")),h=a.model.get("showCurrentRowColor"),i=a.model.get("blinkRedundantRow"),j=a.model.get("changeRedundantRowToCurrent"),k=0;d>k;k++){var l,m,n=!1,o=[];$(b.el).find("div").each(function(){o.push($(this).text())}),e.find("tr").each(function(a){m=[],$(this).find("div").each(function(){m.push($(this).text())});for(var b=!0,c=0;c<o.length;c++)o[c]!==m[c]&&(b=!1);b===!0&&(l=$(this).find("td"),n=!0,f++)}),n===!0&&i===!0&&l.each(function(){$(this).addClass("blinkRowColor")}),(n===!0&&g===!0||n===!1)&&(a.$(".empty-row").length>0?(a.$(".empty-row:first").before($(b.el)),a.$(".empty-row:last").remove()):a.$(".body-table  tbody").append($(b.el)),c=e.find("tr").length-a.$(".empty-row").length,b.model.set("rowNumber",c),a.model.get("tableData").add(b.model),$(b.el).find("td,th").addClass("row_"+c),$(b.el).attr("rowNumber",c)),n===!0&&j===!0&&($(l[0]).parents().find("tr.table-row").find("td").removeClass("current-row currentRowColor"),l.each(function(){$(this).addClass("current-row currentRowColor")})),k===d-1&&($(b.el).parent().find("td").removeClass("current-row"),$(b.el).find("td").addClass("current-row"),h===!0&&($(b.el).parent().find("td").removeClass("currentRowColor"),$(b.el).find("td").addClass("currentRowColor"))),null!==this.model.get("tableBorderClass")&&$(b.el).find("td").addClass(this.model.get("tableBorderClass"))}g===!0&&(f=0),a.$(".current-row").position()&&(a.$(".body-table-holder").scrollTop(0),a.$(".body-table-holder").scrollTop(a.$(".current-row").position().top))},addTabIndexToElements:function(a,b,c){var d=void 0!==c?c:5,e=this.manager.model.get("startTabindex"),b=b;this.$(a).each(function(a){$(this).attr("tabindex",e+b+a*d).addClass("hack-div")})},showAutoFilledValues:function(){this.$(".hide-autofill-data+.table-blank-data").hide(),this.$(".hide-autofill-data").removeClass("hide-autofill-data").addClass("show-autofill-data")},hideAutoFilledValues:function(){this.$(".show-autofill-data+.table-blank-data").show(),this.$(".show-autofill-data").removeClass("show-autofill-data").addClass("hide-autofill-data")},enableDisableColumn:function(a,b){a>=0&&a<this._columnCount&&(b?this.$(".body-table-holder tbody .col_"+a).addClass("table-column-disabled"):this.$(".body-table-holder tbody .col_"+a).removeClass("table-column-disabled"))},_onTableHeaderClick:function(a){if(this.model.get("enableTableSorting")===!0){var b,c,d,e=$(a.currentTarget),f=null;if(e.hasClass("tbl-header")||(e=$(a.currentTarget).parents(".tbl-header")),b=e.attr("class").split(" ")[1],b=Number(b.substr("col_".length)),null!==this.model.get("customSortingOrder")&&(c=this.model.get("customSortingOrder"),void 0!==c[b])){d=c[b],f=[];for(var g=0;g<d.length;g++)f.push([d[g],0])}this.$(".body-table")[0].config.sortForce=f,this._lastSortedColumn=b,this.sortColumn(b)}},sortColumn:function(a,b){if(a>=0&&a<this._columnCount){var c,d=0;d=void 0!==b?b:this.$(".body-table thead .col_"+a).hasClass("tablesorter-headerAsc")?1:0,c=0===d?"asc":"desc",this.$(".body-table")[0].config.headers[a].sorter!==!1&&(this.$(".body-table").trigger("update"),this.$(".body-table").trigger("sorton",[[[a,d]]]),this._lastSortedColumn=a,this.$(".header-table thead .tbl-sort-asc").removeClass("tbl-sort-asc"),this.$(".header-table thead .tbl-sort-desc").removeClass("tbl-sort-desc"),this.$(".header-table thead .col_"+a).addClass("tbl-sort-"+c))}},getLastSortedColumn:function(){var a,b={},c=this._lastSortedColumn,d=this.$(".body-table thead .col_"+c);return a=d.hasClass("tablesorter-headerAsc")||d.hasClass("tablesorter-headerDesc")?d.hasClass("tablesorter-headerAsc")?0:1:0,b={columnNumber:c,sortOrder:a}},enableDisableSortingOnColumn:function(a,b){var c=this._columnCount,d={};void 0!==b&&(c=b.length);for(var e=0;c>e;e++)void 0!==b?(d[b[e]]={sorter:a},this.$(".body-table")[0].config.headers[b[e]]=d[b[e]],a?$(this.$(".header-table .tbl-header")[b[e]]).addClass("sorting-enabled").removeClass("sorting-disabled"):$(this.$(".header-table .tbl-header")[b[e]]).addClass("sorting-disabled").removeClass("sorting-enabled")):(d[e]={sorter:a},this.$(".body-table")[0].config.headers[e]=d[e]);this.$(".body-table").trigger("update")},enableDisableTableHeaderClicks:function(a){a?this.$(".header-table .tbl-header").addClass("sorting-enabled"):this.$(".header-table .tbl-header").removeClass("sorting-enabled")},getHighlightedRowIndex:function(){var a=0;return this.$(".body-table tbody").find("tr").each(function(b){return $(this).find("td").first().hasClass("currentRowColor")?(a=b+1,!1):void 0}),a},_rearrangeTableData:function(){var a=[],b=this.model.get("tableData"),c=[];this.$("tbody tr.empty-bottom").each(function(){a.push(Number($(this).attr("rownumber")))});for(var d=0;d<a.length;d++)for(var e=0;e<b.length;e++)if(a[d]==b.models[e].get("rowNumber")){c.push(this.model.get("tableData").models[e]);break}for(var d=0;d<c.length;d++)b.models[d+1]=c[d];this.model.set("tableData",b)},showHideComparisonTicksInTable:function(a,b){if(void 0!==b&&b.length>0)for(var c=0;c<b.length;c++)a?this.$(".body-table .col_"+b[c]+" .comparison-result").removeClass("hide-autofill-data"):this.$(".body-table .col_"+b[c]+" .comparison-result").addClass("hide-autofill-data");else a?this.$(".body-table .comparison-result").removeClass("hide-autofill-data"):this.$(".body-table .comparison-result").addClass("hide-autofill-data")},_addImportantToStyle:function(a,b){var c,d,e;a.each(function(){c=$(this),d=c.attr("style"),("undefined"==typeof d||null===d)&&(d="");for(e in b)d+=e+":"+b[e]+" !important;";c.attr("style",d)})},_onTableFocusIn:function(){if(null!==this.player&&!this.player.model.get("isAccessible"))return!1;var a=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;null!==this.player&&this.player._enableDisableApplicationMode(!1),a||this.$(".complete-table-holder").addClass("on-focus-in")},_onTableFocusOut:function(a){if(null!==this.player&&!this.player.model.get("isAccessible"))return!1;a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation();var b=this,c=this.manager._checkElementExistsByAccId(this._nextAccElementId),d=this.manager._checkElementExistsByAccId(this._previousAccElementId),e=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile,f=0;this.model.get("hasAccDelay")===!0&&(f=10),e||(b.$(".complete-table-holder").removeClass("on-focus-in"),null!==b.player&&b.player._enableDisableApplicationMode(!0)),b.model.get("hasInputBoxInTable")||(b._bShiftKeyPressed?d?b.setFocus(b._previousAccElementId,f):$("#"+b.idPrefix+b._previousAccElementId).focus():c?b.setFocus(b._nextAccElementId,f):$("#"+b.idPrefix+b._nextAccElementId).focus())},_onTableKeyDown:function(a){if(null!==this.player&&!this.player.model.get("isAccessible"))return!1;if(!this.model.get("hasInputBoxInTable")){a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation();var b=a.which||a.keyCode,c=this.$(".body-table-holder"),d=this,e=this.manager._checkElementExistsByAccId(this._nextAccElementId),f=this.manager._checkElementExistsByAccId(this._previousAccElementId),g=0;switch(this.model.get("hasAccDelay")===!0&&(g=10),d._bShiftKeyPressed=!1,b){case 9:return a.shiftKey?setTimeout(function(){d._bShiftKeyPressed=!0,f?d.setFocus(d._previousAccElementId,g):$("#"+d.idPrefix+d._previousAccElementId).focus()},10):setTimeout(function(){d._bShiftKeyPressed=!1,e?d.setFocus(d._nextAccElementId,g):$("#"+d.idPrefix+d._nextAccElementId).focus()},10),!1;case 38:c.scrollTop(c.scrollTop()-20);break;case 40:c.scrollTop(c.scrollTop()+20);break;case 16:d._bShiftKeyPressed=!0}}},setNextAccElement:function(a){var b=this;this.model.set("nextElementAccId",a),this._nextAccElementId=a,this.$(".body-table").off("focusout").on("focusout",function(a){b._onTableFocusOut(a)}),this.$el.off("keydown").on("keydown",function(a){b._onTableKeyDown(a)})},setPreviousAccElement:function(a){var b=this;this.model.set("prevElementAccId",a),this._previousAccElementId=a,this.$(".body-table").off("focusout").on("focusout",function(a){b._onTableFocusOut(a)}),this.$el.off("keydown").on("keydown",function(a){b._onTableKeyDown(a)})},modifyTableRow:function(a,b){var c,d,e,f,g=this.model.get("tableData").length;g>a&&(c=this.model.get("tableData").models[a].get("rowNumber"),d=new MathInteractives.Common.Player.Models.Table.DataRow(b),d.set("rowNumber",c),e=new MathInteractives.Common.Player.Views.DataRow({model:d}),$(e.el).attr("rowNumber",c),null!==this.model.get("tableBorderClass")&&$(e.el).find("td").addClass(this.model.get("tableBorderClass")),this.model.get("tableData").models[a]=d,f=$(this.$(".body-table tbody").find("tr")[a-1]),f.before($(e.el)),f.remove())},_loadTableScreen:function(){var a=this.model.get("tableScreenId");null!==a&&void 0!==a&&""!==a&&(this.unloadScreen(a),this.loadScreen(a))},isThisRowVisible:function(a){var b=this.$(".body-table-holder"),c=b.offset().top,d=c+b.height(),e=this.$($(".body-table-holder tr").get(a)),f=e.offset().top,g=f+e.height();return g>=c&&d>=f&&d>=g&&f>=c},setTableTabIndex:function(a){var b=0;null!==this.manager&&-1!==a&&(b=this.manager.model.get("startTabindex")),this.$(".body-table").attr("tabindex",b+a)},setFocusToTable:function(){this.$(".body-table").focus()}},{loadTable:function(a,b){var c,d;$(b).parent(),$(b).attr("id"),$(b).attr("class");return c=new MathInteractives.Common.Player.Models.Table(a),d=new MathInteractives.global.DataTable({model:c,el:b})}}),MathInteractives.Common.Player.Views.DataRow=MathInteractives.Common.Player.Views.Base.extend({tagName:"tr",className:function(){return this.options.emptyRow===!0?"table-row empty-row":"table-row empty-bottom"},initialize:function(){this.render()},render:function(){for(var a=this,b=this.model.get("rowData").length,c="",d=0;b>d;d++){var e=a.model.get("isHeaderRow"),f=a.model.get("isSubHeaderRow"),g=a.model.get("isTableSectionHeaderRow");if(e||f){var h="tbl-header";f&&(h="tbl-sub-header");var i=new MathInteractives.Common.Player.Views.DataCell({model:a.model.get("rowData").models[d],tagName:"th",className:h+" col_"+d,parent:this,cellNumber:d,player:this.options.player,enableTableSorting:this.options.enableTableSorting})}else{var h="tbl-cell";g&&(h="tbl-section-header");var i=new MathInteractives.Common.Player.Views.DataCell({model:a.model.get("rowData").models[d],tagName:"td",className:h+" col_"+d,parent:this,cellNumber:d,player:this.options.player})}c+=i.el,$(this.el).append(i.el)}return this}}),MathInteractives.Common.Player.Views.DataCell=MathInteractives.Common.Player.Views.Base.extend({initialize:function(){this.render()},render:function(){var a,b=this.model.get("text"),c=b,d=MathInteractives.Common.Player.Views.DataCell,e=this.model.get("formulaForCalculation"),f=!1,g="hide-autofill-data",h=this.model.get("compareWithColumns"),i="",j=this.model.get("showTicksInThisCell"),k=j?"":"hide-autofill-data",l=this.model.get("columnNumberForTicks"),m="",n=this.options.parent,o=this.options.cellNumber,p=this.options.player,q=this.options.enableTableSorting,r=MathInteractives.Common.Player.Views.Player,s=MathInteractives.Common.Components.templates.tableSortNotation().trim();if(this.model.get("colSpan")&&$(this.el).attr("colspan",this.model.get("colSpan")),this.model.get("rowSpan")&&$(this.el).attr("rowspan",this.model.get("rowSpan")),null!==e&&void 0!==e&&(this.model.get("showCalculatedValues")&&(f=!0,g=""),b="<span class="+g+">"+this._getFormulaResult(e,n)+"</span>"),f===!1&&(""===c||null===c?b+=d.defaultTextString:this.model.get("addBlankData")===!0?b+=d.defaultTextString:null===this.model.get("addBlankData")&&this.isCellDataBlank(c)===!0&&(b+=d.defaultTextString)),null!==h&&void 0!==h&&h.length>0)for(var t=0;t<h.length;t++)b==n.model.get("rowData").models[h[t]].get("text")?(i+=" equal-to-col-"+h[t],m='<span class="'+k+' comparison-correct comparison-result"></span>'):m='<span class="'+k+' comparison-incorrect comparison-result"></span>';return null!==l&&void 0!==l&&l!==o?($(this.el).html('<div class="tbl-data'+i+'">'+b+"</div>"),n.model.get("rowData").models[l].set("hasTick",!0),n.model.get("rowData").models[l].set("tickHtmlStructure",m)):(this.model.get("hasTick")===!0&&(m=this.model.get("tickHtmlStructure")),void 0!==p&&null!==p&&(a=p.getPlayerThemeType(),"th"===this.options.tagName&&a===r.THEMES.THEME_2&&q===!0&&(b='<div class="tbl-header-text">'+b+"</div>",b+=s)),$(this.el).html('<div class="tbl-data'+i+'">'+b+m+"</div>")),this.model.get("showTicksInThisCell")&&$(this.el).find(".comparison-result").removeClass("hide-autofill-data"),this.$(".comparison-result").length>0&&(null!==_filePath&&void 0!==_filePath?this.$(".comparison-result").css({"background-image":"url("+_filePath.getImagePath("table-tick-and-cross")+")"}):alert("Please specify filePath for table")),this},isCellDataBlank:function(a){var b=!0;return $("<div></div>",{"class":"data-table-cell-data-container-dummy"}).append(a).appendTo("body"),""!==$(".data-table-cell-data-container-dummy").text().trim()||$(".data-table-cell-data-container-dummy input").length>0?b=!1:$(".data-table-cell-data-container-dummy").children().each(function(){if($(this).hasClass("table-blank-data"))return b=!1,!1;if("img"===$(this).prop("tagName").toLowerCase()){if("none"!==$(this).css("display")&&void 0!==$(this).attr("src"))return b=!1,!1}else{if(""!==$(this).text().trim())return b=!1,!1;if("none"!==$(this).css("display")&&"none"!==$(this).css("background-image"))return b=!1,!1}}),$(".data-table-cell-data-container-dummy").remove(),b},_getFormulaResult:function _getFormulaResult(formulaString,rowView){var result=this._generateFormulaString(formulaString,rowView);try{result=eval(result)}catch(error){}return result},_generateFormulaString:function(a,b){function c(a){if(-1!==a.indexOf("col")){var b=a.indexOf("col")+3;g.push(parseInt(a.charAt(b),10)),a=e._setCharacterAt(a,b,""),a=a.replace("col",f)}return a}var d=a,e=this,f=MathInteractives.Common.Player.Views.DataCell.placeHolderInFormula,g=[];do d=c(d);while(-1!=d.indexOf("col"));return d=this._insertDataIntoFormula(d,g,b,f)},_setCharacterAt:function(a,b,c){return a.substr(0,b)+c+a.substr(b+1)},_insertDataIntoFormula:function(a,b,c,d){for(var e=0;e<b.length;e++)a=a.replace(d,c.model.get("rowData").models[b[e]].get("text"));return a}},{defaultTextString:'<span class="typography-label table-blank-data" >&#8211; &#8211; &#8211;</span>',placeHolderInFormula:"DataPlaceHolder"}),MathInteractives.global.DataTable=MathInteractives.Common.Player.Views.DataTable}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.tableSortNotation=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.columnID)?f=g.call(b,{hash:{},data:e}):(g=b&&b.columnID,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="tbl-header-sort-container">\r\n	<div class="tbl-header-up-arrow-container">\r\n		<div class="tbl-header-up-arrrow-image"></div>\r\n	</div>\r\n	<div class="tbl-header-down-arrow-container">\r\n		<div class="tbl-header-down-arrrow-image"></div>\r\n	</div>\r\n</div>'})}(),function(){"use strict";MathInteractives.Common.Components.Models.Graph=Backbone.Model.extend({defaults:{chartType:"scatter",chartCredits:!1,chartHeight:null,chartWidth:null,animation:!1,zoomType:null,borderColor:"#C9C9C9",borderRadius:0,borderWidth:2,marginBottom:50,marginLeft:50,marginRight:50,marginTop:50,chartTitle:"New title",plotBorderWidth:1,showGrid:!0,gridLineThickness:2,gridLineColor:"#AAAAAA",xMin:0,yMin:0,xMax:10,yMax:10,xAxisLineWidth:3,xAxislineColor:"#606060",xTitle:"x-axis title",xTickLength:0,xLabelPositionX:0,xLabelPositionY:24.5,xTickInterval:1,xTitleOffset:35,xUseHTML:!0,xFormatter:null,xAxisLabelStyle:{color:"#777777",fontSize:"16px",fontFamily:"Arial",fill:"#777777"},xAxisTitleUseHTML:!1,yAxisLineWidth:3,yAxislineColor:"#606060",yTitle:"y-axis title",yTickLength:0,yLabelPositionX:-12.5,yLabelPositionY:5,yTickInterval:2,yTitleOffset:30,yUseHTML:!1,yFormatter:null,yAxisLabelStyle:{color:"#777777",fontSize:"16px",fontFamily:"Arial",fill:"#777777"},toolTipFormatter:null,toolTipUseHTML:!1,toolTipEnabled:!0,toolTipHideDelay:-1,tooltipStyle:{fontSize:"13px",fontFamily:"Arial",color:"#000000"},toolTipHideAnimation:!1,toolTipBorderColor:null,plotOptHover:!1,plotLineAnimation:!1,plotCount:1,plotCountIdPrefix:"plot_",series:[]},initialize:function(){var a;a=this,this.manageHeightWidth("height"),this.manageHeightWidth("width"),this.on("change:chartHeight",function(){a.manageHeightWidth("height")}),this.on("change:chartWidth",function(){a.manageHeightWidth("width")})},manageHeightWidth:function(a){var b,c;switch(a){case"height":c=this.get("chartHeight")?this.get("chartHeight")+this.get("marginTop")+this.get("marginBottom"):this.get("chartHeight"),this.set("chartHeight",c);break;case"width":b=this.get("chartWidth")?this.get("chartWidth")+this.get("marginLeft")+this.get("marginRight"):this.get("chartWidth"),this.set("chartWidth",b)}},addPlot:function(a,b){var c,d,e,f,g,h;return f=this,b||(b=new MathInteractives.Common.Components.Models.Graph.Marker),g=f.get("plotCount"),e=MathInteractives.Common.Components.Models.Graph,d={},d.id=f.get("plotCountIdPrefix")+g,f.set("plotCount",g+1,{silent:!0}),d.color=b.get("lineColor")?b.get("lineColor"):e.LINE_COLOR,d.lineWidth=b.get("lineWidth")||0===b.get("lineWidth")?b.get("lineWidth"):e.LINE_WIDTH,d.data=a,d.marker={},d.marker.lineWidth=b.get("pointLineWidth")?b.get("pointLineWidth"):e.POINT_LINE_WIDTH,d.marker.radius=b.get("pointRadius")?b.get("pointRadius"):e.POINT_RADIUS,d.marker.fillColor=b.get("pointFillColor"),h="url("+(b.get("pointSymbol")?b.get("pointSymbol"):e.POINT_FILL_URL)+")",d.marker.symbol=b.get("useImageInSymbol")?h:b.get("pointSymbol"),d.marker.states={},d.marker.states.hover={},d.marker.states.hover.enabled=!1,d.showInLegend=!1,d.dashStyle=b.get("dashStyle")?b.get("dashStyle"):e.LINE_TYPES.CONTINUES_THIN_LINE,d.toolTipText=b.get("toolTipText")||{},c=_.clone(f.get("series")),c.push(d),f.set("series",c),d.id},getMarkerData:function(a,b){var c,d,e,f,g;switch(f=null,b){case"mouseOver":g="mouseOverMarker";break;case"mouseOut":g="mouseOutMarker"}for(d=this.get("series"),e=d.length,c=0;e>c;c++)a===d[c].id&&(f=d[c][g]);return f},addMarkerForEvents:function(a,b,c){var d,e,f,g,h,i,j;if(i=MathInteractives.Common.Components.Models.Graph,b){switch(a){case"mouseOver":d="mouseOverMarker";break;case"mouseOut":d="mouseOutMarker"}for(h={},h.lineWidth=b.get("pointLineWidth")?b.get("pointLineWidth"):i.POINT_LINE_WIDTH,h.radius=b.get("pointRadius")?b.get("pointRadius"):i.POINT_RADIUS,h.fillColor=b.get("pointFillColor"),j="url("+(b.get("pointSymbol")?b.get("pointSymbol"):i.POINT_FILL_URL)+")",h.symbol=b.get("useImageInSymbol")?j:b.get("pointSymbol"),h.states={},h.states.hover={},h.states.hover.enabled=!1,g=this.get("series"),f=g.length,e=0;f>e;e++)c===g[e].id&&(g[e][d]=h,this.set("series",g,{silent:!0}))}},addPoint:function(a,b,c){var d,e,f;for(d=a.get(c),d.addPoint(b),d=this.get("series"),e=d.length,f=0;e>f;f++)d[f].id===c&&d[f].push(b)},removeAllPlot:function(){this.set("series",[])}},{POINT_FILL_URL:"common/media/image/dragItems/Drag-Handle_up.png",POINT_FILL_URL_MOUSE_OVER:"common/media/image/dragItems/Drag-Handle_Over.png",POINT_LINE_WIDTH:0,POINT_RADIUS:9,LINE_COLOR:"#4c1787",LINE_WIDTH:5,LINE_TYPES:{CONTINUES_THIN_LINE:"solid",DASHED_THIN_LINE:"dash"},PREDEFINED_SHAPES:{CIRCLE:"circle",SQUARE:"square",TRIANGLE:"triangle",DIAMOND:"diamond",TRIANGLE_DOWN:"triangle-down"},Marker:Backbone.Model.extend({defaults:{lineColor:null,lineWidth:null,pointFillColor:null,pointLineWidth:null,pointRadius:null,pointSymbol:null,useImageInSymbol:!0,dashStyle:null}})})}(),function(){"use strict";MathInteractives.Common.Components.Views.Graph=Backbone.View.extend({graphOptions:{},markerOnMouseOver:null,markerOnMouseOut:null,initialize:function(){this.model.on("change",this.render,this),this.bindEvents(),this.render()},render:function(){var a;this.getGraphSetupOptions(),a=this.graphOptions,this.$el.highcharts(a),this.doMiscellaneousWork()},bindEvents:function(){$(window).resize(function(a){$(".highcharts-container").slice(1).remove()})},doMiscellaneousWork:function(){return},getGraphSetupOptions:function(){var a,b,c,d,e,f,g,h,i,j,k,l;l=this,a=this.model,b=this.graphOptions,e=a.get("marginBottom"),f=a.get("marginTop"),g=a.get("marginRight"),h=a.get("marginLeft"),i=this.$el.width(),j=this.$el.height(),d=i-g-h,k=d/(a.get("xMax")-a.get("xMin")),d=k*Math.abs(a.get("xMin")),c=j-f-e,k=c/(a.get("yMax")-a.get("yMin")),c=k*Math.abs(a.get("yMin")),b.chart={type:a.get("chartType"),height:a.get("chartHeight"),width:a.get("chartWidth"),animation:!1,showAxes:!0,borderColor:"#C9C9C9",bordeRadius:0,bordeWidth:2,marginBottom:e,marginLeft:h,marginTop:f,marginRight:g,plotBorderWidth:a.get("plotBorderWidth")},b.title={},b.title.text=a.get("chartTitle"),b.title.style={color:"#4c1787","font-size":"18px",fontFamily:"Montserrat, Arial, sans-serif","font-weight":"bold",fill:"#4c1787"},b.xAxis={min:a.get("xMin"),max:a.get("xMax"),tickInterval:a.get("xTickInterval"),gridLineColor:a.get("gridLineColor"),gridLineWidth:a.get("gridLineThickness"),lineColor:a.get("xAxislineColor"),lineWidth:a.get("xAxisLineWidth"),tickLength:a.get("xTickLength"),offset:-c},b.xAxis.title={},b.xAxis.title.useHTML=a.get("xAxisTitleUseHTML"),b.xAxis.title.text=a.get("xTitle"),b.xAxis.title.offset=a.get("xTitleOffset"),b.xAxis.title.style={color:"#222",fontSize:"16px",fontFamily:"Arial, sans-serif",fontWeight:"bold",fill:"#222"},b.xAxis.labels={},b.xAxis.labels.align="center",b.xAxis.labels.x=a.get("xLabelPositionX"),b.xAxis.labels.y=a.get("xLabelPositionY"),b.xAxis.labels.style=a.get("xAxisLabelStyle"),null!==a.get(" ")&&(b.xAxis.labels.formatter=a.get("xFormatter")),b.xAxis.labels.useHTML=a.get("xUseHTML"),b.yAxis={min:a.get("yMin"),max:a.get("yMax"),tickInterval:a.get("yTickInterval"),gridLineColor:a.get("gridLineColor"),gridLineWidth:a.get("gridLineThickness"),lineColor:a.get("yAxislineColor"),lineWidth:a.get("yAxisLineWidth"),tickLength:a.get("yTickLength"),offset:-d},b.yAxis.title={},b.yAxis.title.text=a.get("yTitle"),b.yAxis.title.offset=a.get("yTitleOffset"),b.yAxis.title.style={color:"#222","font-size":"16px",fontFamily:"Arial, sans-serif","font-weight":"bold",fill:"#222"},b.yAxis.labels={},b.yAxis.labels.align="right",b.yAxis.labels.x=a.get("yLabelPositionX"),b.yAxis.labels.y=a.get("yLabelPositionY"),b.yAxis.labels.style=a.get("yAxisLabelStyle"),null!==a.get("yFormatter")&&(b.yAxis.labels.formatter=a.get("yFormatter")),b.yAxis.labels.useHTML=a.get("yUseHTML"),b.tooltip={},b.tooltip.animation=a.get("toolTipHideAnimation"),b.tooltip.style=a.get("tooltipStyle"),b.tooltip.enabled=a.get("toolTipEnabled"),b.tooltip.useHTML=a.get("toolTipUseHTML"),null!==a.get("toolTipBorderColor")&&(b.tooltip.borderColor=a.get("toolTipBorderColor")),null!==a.get("toolTipFormatter")?b.tooltip.formatter=a.get("toolTipFormatter"):b.tooltip.formatter=function(){return a.get("xTitle")+": "+this.x+"<br/>"+a.get("yTitle")+": "+this.y},b.tooltip.hideDelay=a.get("toolTipHideDelay"),b.series=a.get("series"),b.credits={enabled:a.get("chartCredits")},b.plotOptions={},b.plotOptions.series={},b.plotOptions.series.animation=a.get("plotLineAnimation"),b.plotOptions.series.states={},b.plotOptions.series.states.hover={},b.plotOptions.series.states.hover.enabled=a.get("plotOptHover"),b.plotOptions.series.point={},b.plotOptions.series.point.events={},b.plotOptions.series.point.events.mouseOver=function(){var b,c;c=this.series.userOptions.id,b=a.getMarkerData(c,"mouseOver"),b&&this.update({marker:b})},b.plotOptions.series.point.events.mouseOut=function(){var b,c;c=this.series.userOptions.id,b=a.getMarkerData(c,"mouseOut"),b&&this.update({marker:b})}}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.graphIt=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-it-graph-container-main-wrapper" class="graph-it-graph-container-main-wrapper">\r\n<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-it-graph-container" class="graph-it-graph-container">\r\n    <canvas id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-it-canvas" width="',(g=c.canvasWidth)?f=g.call(b,{hash:{},data:e}):(g=b&&b.canvasWidth,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" height="',(g=c.canvasHeight)?f=g.call(b,{hash:{},data:e}):(g=b&&b.canvasHeight,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'canvas"></canvas>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-controls" class="graph-controls">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'draw-line-control" class="draw-line-control">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'draw-line-btn" class="draw-line-btn"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'draw-line-label" class="draw-line-label"></div>\r\n        </div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'move-line-control" class="move-line-control">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'move-line-btn" class="move-line-btn"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'move-line-label" class="move-line-label"></div>\r\n        </div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'users-graph-control" class="users-graph-control">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'users-graph-btn" class="users-graph-btn"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'users-graph-label" class="users-graph-label"></div>\r\n        </div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'feedback-graph-control" class="feedback-graph-control">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'feedback-graph-btn" class="feedback-graph-btn"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'feedback-graph-label" class="feedback-graph-label"></div>\r\n        </div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'clear-graph-btn" class="clear-graph-btn"></div>\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'draw-graph-title" class="draw-graph-title typography-header">\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'draw-graph-x-axis-label" class="draw-graph-x-axis-label typography-label">\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'draw-graph-y-axis-label" class="draw-graph-y-axis-label typography-label">\r\n    </div>\r\n</div>\r\n</div>'})}(),function(){"use strict";MathInteractives.Common.Player.Collections.CanvasItems=Backbone.Collection.extend({model:MathInteractives.Common.Player.Models.CanvasItem,currentItem:null,initialize:function(){},getCurrentItem:function(){return this.currentItem},getCurrentItemIndex:function(){return this.indexOf(this.getCurrentItem("currentItem"))},setCurrentItem:function(a){"undefined"==typeof a&&(a=null),this.currentItem=a},next:function(){var a=null;return a=this.at(this.indexOf(this.getCurrentItem("currentItem"))+1),this.setCurrentItem(a),a},prev:function(){var a=null;return a=this.at(this.indexOf(this.getCurrentItem("currentItem"))-1),this.setCurrentItem(a),a},hasNext:function(){var a=!1,b=this.indexOf(this.getCurrentItem("currentItem"))+1;return b>0&&b<this.length&&(a=!0),a},hasPrev:function(){var a=!1;return this.indexOf(this.getCurrentItem("currentItem"))-1>=0&&(a=!0),a}})}(),function(){"use strict";MathInteractives.Common.Player.Models.CanvasAcc=Backbone.Model.extend({defaults:function(){return{type:MathInteractives.Common.Player.Models.CanvasAcc.TYPE.NAVIGATE_ITEM,collectionCanvasItems:null,isToolLineDrawingOn:!1,paperItems:[],paperScope:null,gridCell:{size:{width:null,height:null},origin:{x:0,y:0}},gridContainment:{minX:null,maxX:null,minY:null,maxY:null},focusRectSize:null,focusRectColor:"#000000",focusRectBorderWidth:1,focusCurrentPosition:null,selfFocusDisableEvents:null,detailsForFocusRect:{size:{width:0,height:0},gridCellSize:50,canvasBounds:{minX:0,maxX:600,minY:0,maxY:400}},setAccMessageObject:{elementId:null,strMessage:null},disableSelfFocusOnSpace:!1}},initialize:function(){var a=new MathInteractives.Common.Player.Collections.CanvasItems;this.set("collectionCanvasItems",a),this._lineDrawingBoolchange()},_attchEvents:function(){this.on("change:isToolLineDrawingOn",this._lineDrawingBoolchange)},_lineDrawingBoolchange:function(){this.get("isToolLineDrawingOn")===!0&&this.set("paperItems",[]),this.setCollectionCanvasItems(this.get("paperItems"))},setCollectionCanvasItems:function(a,b){var c,d=this.get("collectionCanvasItems"),e=!1,f=MathInteractives.Common.Player.Models.CanvasItem,g=this.get("paperScope");
d.reset();for(var h in a)c=new f({paperItem:a[h],paperScope:g}),d.add(c),b||0!==Number(h)||(d.setCurrentItem(c),e=!0);if(!e&&d.getCurrentItem()){var i=d.length>0?d.getCurrentItem().get("paperItem"):null;i?this.setCollectionCurrentItem(i):d.setCurrentItem(i)}this.set("collectionCanvasItems",d)},setCollectionCurrentItem:function(a){var b=this.get("collectionCanvasItems"),c=b.where({paperItem:a});return c[0]?(b.setCurrentItem(c[0]),!0):!1},getCollectionCurrentItemIndex:function(){return this.get("collectionCanvasItems").getCurrentItemIndex()},getCollectionCurrentItem:function(){return this.get("collectionCanvasItems").getCurrentItem().get("paperItem")}},{TYPE:{DRAW_LINE:"canvas-type-draw-line",NAVIGATE_ITEM:"canvas-type-navigate-item",NAVIGATE_LINE:"canvas-type-navigate-line",DRAW_AND_EXPAND:"canvas-type-draw-and-expand",DRAG_AND_DROP:"canvas-type-drag-and-drop"},CANVAS_EVENTS:{FOCUS_OUT:"focus-out"},ITEM_EVENTS:{ITEM_FOCUS_OUT:"item-focus-out"},CANVAS_KEY_EVENTS:{TAB:"canvas-tab-key",SPACE:"canvas-space-key",ARROW:"canvas-arrow-key",ESCAPE:"canvas-escape-key",DELETE:"canvas-delete-key",ROTATE_CLOCKWISE:"canvas-rotate-clockwise-key",ROTATE_ANTI_CLOCKWISE:"canvas-rotate-anti-clockwise-key"},DRAW_LINE_EVENTS:{SPACE:"canvas-draw-line-events-space",ARROW:"canvas-draw-line-events-arrow",FOCUS_OUT:"canvas-draw-line-events-focus-out",ESCAPE:"canvas-draw-line-events-escape"},DRAW_AND_EXPAND_EVENTS:{SPACE:"canvas-draw-and-expand-events-space",ARROW:"canvas-draw-and-expand-events-arrow",FOCUS_OUT:"canvas-draw-and-expand-events-focus-out",ESCAPE:"canvas-draw-and-expand-events-escape"},DRAG_AND_DROP_EVENTS:{TAB:"canvas-drag-and-drop-events-tab",SPACE:"canvas-drag-and-drop-events-space",ARROW:"canvas-drag-and-drop-events-arrow",FOCUS_OUT:"canvas-drag-and-drop-events-focus-out",ESCAPE:"canvas-drag-and-drop-events-escape",ROTATE_CLOCKWISE:"canvas-drag-and-drop-events-rotate-clockwise",ROTATE_ANTI_CLOCKWISE:"canvas-drag-and-drop-events-rotate-anti-clockwise",DELETE:"canvas-drag-and-drop-events-delete"},CANVAS_KEYUP_EVENTS:{ANY_KEYUP:"canvas-any-key-up",SPACE_KEYUP:"canvas-space-key-up",ENTER_KEYUP:"canvas-enter-key-up",ARROW_KEYUP:"canvas-arrow-key-up",DELETE_KEYUP:"canvas-delete-key-up",ROTATION_KEYUP:"canvas-rotation-key-up",CLOCKWISE_ROTATION_KEYUP:"canvas-clockwise-rotation-key-up",ANTI_CLOCKWISE_ROTATION_KEYUP:"canvas-anti-clockwise-rotation-key-up",LEFT_ARROW_KEYUP:"canvas-left-arrow-key-up",RIGHT_ARROW_KEYUP:"canvas-right-arrow-key-up",UP_ARROW_KEYUP:"canvas-up-arrow-key-up",DOWN_ARROW_KEYUP:"canvas-down-arrow-key-up"},KEYUP_TIMER:300})}(),function(){MathInteractives.Common.Player.Views.CanvasAcc||(MathInteractives.Common.Player.Views.CanvasAcc=MathInteractives.Common.Player.Views.Base.extend({_paperScope:null,_detailsForFocusRect:null,manager:null,player:null,idPrefix:null,_isStart:!0,isExpand:!1,isDrag:!1,_isShifDown:!1,_currentFocusRect:null,prevText:"",lastTriggeredEvent:null,_lastArrowKeyUpEvent:null,_lastArrowKeyUpItem:null,_previousArrowKeyDownCount:0,_currentArrowKeyDownCount:0,_keyUpInterval:null,initialize:function(){this._paperScope=this.model.get("paperScope"),this.player=this.model.get("player"),this.idPrefix=this.player.getIDPrefix(),this.manager=this.model.get("manager"),this.render(),this._bindEvents();var a=this.model.get("type");(a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_LINE||a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_AND_EXPAND||a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP)&&this.initGridFocusRectDetails()},render:function(){var a=this.model.get("canvasHolderID"),b=this.$el.find(".acc-read-elem"),c={height:"1px",width:"1px",top:"1px",left:"1px"};b&&(c.height=b.height()+"px",c.width=b.width()+"px",c.top=b.css("top"),c.left=b.css("left"));var d="position: absolute; height: "+c.height+"; width: "+c.width+"; top: "+c.top+"; left: "+c.left+"; outline: none",e=$("<div>",{id:a+"temp-focus-div",style:d});this.$el.prepend(e);var f={elementId:a.replace(this.idPrefix,"")+"temp-focus-div"};this.createAccDiv(f);var g=e.find(".acc-read-elem");g&&g.css("outline","none")},initGridFocusRectDetails:function(){var a=this.model.get("gridCell").origin,b=this.model.get("gridCell").size,c={x:a.x,y:a.y},d={width:b.width,height:b.height};this.model.get("focusCurrentPosition")||this.model.set("focusCurrentPosition",c),this.model.get("focusRectSize")||this.model.set("focusRectSize",d)},_bindEvents:function(){var a=this.model,b=this;this.$el.on("keydown",$.proxy(this._handleKeyDownEvent,this)),this.$el.on("keyup",$.proxy(this._handleKeyUpEvent,this)),a.on("change:paperItems",$.proxy(function(){var a=this.model.get("isKeepCurrentItem")?!0:!1;this.model.setCollectionCanvasItems(this.model.get("paperItems"),a)},this)),a.on("change:setAccMessageObject",function(){b._updateHolderAccMessage()})},_updateHolderAccMessage:function(){var a=this.model.get("setAccMessageObject"),b=a.elementId;this.setAccMessage(b,a.strMessage),this._setSelfFocus(),this.setFocus(b)},changeCanvasAccType:function(a){this.model.set("type",a)},_handleKeyDownEvent:function(a){a.shiftKey?this._isShifDown=!0:this._isShifDown=!1;var b=a.keyCode,c=this.model.get("type"),d=!1;if(b===MathInteractives.global.CanvasAcc.KEYS.SPACE&&this._isStart&&(this._isStart=!1,d=!0),!this._isStart)if(c===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.NAVIGATE_ITEM||c===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.NAVIGATE_LINE||c===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP){var e=this.model.get("collectionCanvasItems"),f=e.getCurrentItem();if(null!==f){if(a.keyCode==MathInteractives.global.CanvasAcc.KEYS.ESCAPE)return void this._handleEscape(c,f);if(e.hasNext()&&!this._isShifDown||e.hasPrev()&&this._isShifDown||b!==MathInteractives.global.CanvasAcc.KEYS.TAB){switch(b){case MathInteractives.global.CanvasAcc.KEYS.TAB:a.preventDefault(),a.shiftKey?a.shiftKey&&e.prev():e.next(),this._triggerCurrentItemFocusOutEvent(a,f),f=e.getCurrentItem(),this._handleTab(c,f,a);break;case MathInteractives.global.CanvasAcc.KEYS.SPACE:case MathInteractives.global.CanvasAcc.KEYS.ENTER:d?this._handleTab(c,f,a):this._handleSpace(c,f,a);break;case MathInteractives.global.CanvasAcc.KEYS.LEFTARROW:case MathInteractives.global.CanvasAcc.KEYS.RIGHTARROW:case MathInteractives.global.CanvasAcc.KEYS.UPARROW:case MathInteractives.global.CanvasAcc.KEYS.DOWNARROW:a.preventDefault(),c===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP?this._hadleGridNavigation(c,b,d,f):this._handleArrows(f,b),this._handleArrowUpTrigger();break;case MathInteractives.global.CanvasAcc.KEYS.DELETE:this._handleDelete(c,f);break;case MathInteractives.global.CanvasAcc.KEYS.ROTATE_CLOCKWISE:case MathInteractives.global.CanvasAcc.KEYS.ROTATE_ANTI_CLOCKWISE:this._handleRotate(c,f,b)}this._paperScope&&this._paperScope.view.draw()}else this._handleFocusOut(c,f)}else this._isStart=!0}else if(c===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_LINE)switch(b){case MathInteractives.global.CanvasAcc.KEYS.SPACE:case MathInteractives.global.CanvasAcc.KEYS.ENTER:d?this._hadleGridNavigation(c,b,d):this._handleDrawLineSpace();break;case MathInteractives.global.CanvasAcc.KEYS.LEFTARROW:case MathInteractives.global.CanvasAcc.KEYS.RIGHTARROW:case MathInteractives.global.CanvasAcc.KEYS.UPARROW:case MathInteractives.global.CanvasAcc.KEYS.DOWNARROW:a.preventDefault(),this._hadleGridNavigation(c,b,d);break;case MathInteractives.global.CanvasAcc.KEYS.TAB:this._handleGridNavigationFocusOut(c);break;case MathInteractives.global.CanvasAcc.KEYS.ESCAPE:this._handleEscape(c)}else if(c===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_AND_EXPAND)switch(b){case MathInteractives.global.CanvasAcc.KEYS.SPACE:case MathInteractives.global.CanvasAcc.KEYS.ENTER:d?this._hadleGridNavigation(c,b,d):this._handleDrawAndExpandSpace(b,d);break;case MathInteractives.global.CanvasAcc.KEYS.LEFTARROW:case MathInteractives.global.CanvasAcc.KEYS.RIGHTARROW:case MathInteractives.global.CanvasAcc.KEYS.UPARROW:case MathInteractives.global.CanvasAcc.KEYS.DOWNARROW:a.preventDefault(),this._hadleGridNavigation(c,b,d);break;case MathInteractives.global.CanvasAcc.KEYS.TAB:this._handleGridNavigationFocusOut(c);break;case MathInteractives.global.CanvasAcc.KEYS.ESCAPE:this._handleEscape(c)}},_triggerCurrentItemFocusOutEvent:function(a,b){var c={item:b.get("paperItem"),event:{which:1,shiftKey:a.shiftKey},isAccessibility:!0,isArrowKey:!1};this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.ITEM_EVENTS.ITEM_FOCUS_OUT,c)},_handleKeyUpEvent:function(a){if(a.keyCode!==MathInteractives.global.CanvasAcc.KEYS.TAB){var b=a.keyCode,c=this.model.get("type"),d=this.model.get("collectionCanvasItems"),e=d.getCurrentItem(),f=null;if(null!==e){switch(f=e.get("paperItem"),b){case MathInteractives.global.CanvasAcc.KEYS.SPACE:this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.SPACE_KEYUP,[a,b,f]);break;case MathInteractives.global.CanvasAcc.KEYS.ENTER:this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.ENTER_KEYUP,[a,b,f]);break;case MathInteractives.global.CanvasAcc.KEYS.LEFTARROW:case MathInteractives.global.CanvasAcc.KEYS.RIGHTARROW:case MathInteractives.global.CanvasAcc.KEYS.UPARROW:case MathInteractives.global.CanvasAcc.KEYS.DOWNARROW:a.preventDefault(),this._lastArrowKeyUpEvent=a,this._lastArrowKeyUpItem=f;break;case MathInteractives.global.CanvasAcc.KEYS.DELETE:this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.DELETE_KEYUP,[a,b,f]);break;case MathInteractives.global.CanvasAcc.KEYS.ROTATE_CLOCKWISE:case MathInteractives.global.CanvasAcc.KEYS.ROTATE_ANTI_CLOCKWISE:this._handleRotationKeyUp(a,b,f),this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.ROTATION_KEYUP,[a,b,f]);break;default:return}this._handleAnyKeyUp(c,f,a,b)}}},_handleAnyKeyUp:function(a,b,c,d){this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.ANY_KEYUP,[c,d,b])},_handleRotationKeyUp:function(a,b,c){switch(b){case MathInteractives.global.CanvasAcc.KEYS.ROTATE_CLOCKWISE:this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.CLOCKWISE_ROTATION_KEYUP,[a,b,c]);break;case MathInteractives.global.CanvasAcc.KEYS.ROTATE_ANTI_CLOCKWISE:this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.ANTI_CLOCKWISE_ROTATION_KEYUP,[a,b,c])}},_handleArrowUpTrigger:function(){var a=this,b=MathInteractives.Common.Player.Models.CanvasAcc.KEYUP_TIMER;a._previousArrowKeyDownCount=a._currentArrowKeyDownCount,a._currentArrowKeyDownCount++,0===a._previousArrowKeyDownCount&&(a._keyUpInterval&&window.clearInterval(a._keyUpInterval),a._keyUpInterval=window.setInterval(function(){a._previousArrowKeyDownCount===a._currentArrowKeyDownCount?(window.clearInterval(a._keyUpInterval),a._keyUpInterval=null,a._previousArrowKeyDownCount=0,a._currentArrowKeyDownCount=0,a._handleArrowKeyUp(),a._lastArrowKeyUpEvent=null):a._lastArrowKeyUpEvent&&(a._previousArrowKeyDownCount=a._currentArrowKeyDownCount)},b))},_handleArrowKeyUp:function(){if(this._lastArrowKeyUpEvent){var a=this._lastArrowKeyUpItem,b=this._lastArrowKeyUpEvent,c=b.keyCode,d=MathInteractives.global.CanvasAcc.KEYS;switch(c){case d.LEFTARROW:this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.LEFT_ARROW_KEYUP,[b,c,a]);break;case d.RIGHTARROW:this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.RIGHT_ARROW_KEYUP,[b,c,a]);break;case d.UPARROW:this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.UP_ARROW_KEYUP,[b,c,a]);break;case d.DOWNARROW:this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.DOWN_ARROW_KEYUP,[b,c,a])}this.$el.trigger(MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEYUP_EVENTS.ARROW_KEYUP,[b,c,a])}},_handleTab:function(a,b,c){var d={item:b.get("paperItem"),event:{which:1,shiftKey:c.shiftKey},isAccessibility:!0,isArrowKey:!1};a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP?(this.isDrag=!1,this.hideFocusRect(),this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.TAB,this.$el.trigger(this.lastTriggeredEvent,d)):(this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS.TAB,this.$el.trigger(this.lastTriggeredEvent,d)),this._setSelfFocus()},_handleSpace:function(a,b){var c={item:b.get("paperItem"),event:{which:1},isAccessibility:!0,isArrowKey:!1};if(a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP){if(this.isDrag=!this.isDrag,c.isDrag=this.isDrag,this.hideFocusRect(),this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.SPACE,this.$el.trigger(this.lastTriggeredEvent,c),this.isDrag){var d=this.model.get("gridCell").origin,e={x:d.x,y:d.y};this.model.set("focusCurrentPosition",e),this._hadleGridNavigation(a,null,!1,b,!0)}}else this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS.SPACE,this.$el.trigger(this.lastTriggeredEvent,c);this.model.get("disableSelfFocusOnSpace")!==!0&&this._setSelfFocus()},_handleRotate:function(a,b,c){var d={item:b.get("paperItem"),event:{which:1},isAccessibility:!0,isArrowKey:!1};c===MathInteractives.global.CanvasAcc.KEYS.ROTATE_CLOCKWISE?(a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP?this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.ROTATE_CLOCKWISE:this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS.ROTATE_CLOCKWISE,this.$el.trigger(this.lastTriggeredEvent,d)):c===MathInteractives.global.CanvasAcc.KEYS.ROTATE_ANTI_CLOCKWISE&&(a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP?this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.ROTATE_ANTI_CLOCKWISE:this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS.ROTATE_ANTI_CLOCKWISE,this.$el.trigger(this.lastTriggeredEvent,d)),this._setSelfFocus()},_handleDelete:function(a,b){var c=this.model.get("collectionCanvasItems"),d={item:b.get("paperItem"),nextItem:null,event:{which:1},isAccessibility:!0,isArrowKey:!1};if(b.get("paperItem").allowDelete){if(a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.NAVIGATE_ITEM)c.hasNext()&&(d.nextItem=c.next().get("paperItem")),this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS.DELETE;else if(a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.NAVIGATE_LINE){var e=!1,f=this.getCurrentPaperItemIndex();null!==f&&f+3<c.length&&(e=!0),e&&(c.next(),c.next(),d.nextItem=c.next().get("paperItem")),this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS.DELETE}else a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP&&(c.hasNext()&&(d.nextItem=c.next().get("paperItem")),this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.DELETE);this.$el.trigger(this.lastTriggeredEvent,d),d.nextItem||(this._isStart=!0,this.model.setCollectionCanvasItems(this.model.get("paperItems"))),this._setSelfFocus()}},_handleArrows:function(a,b){var c=a.get("paperItem"),d={item:c,point:c.position,event:{which:1},isAccessibility:!0,isArrowKey:!0,directionX:0,directionY:0};switch(b){case MathInteractives.global.CanvasAcc.KEYS.LEFTARROW:d.directionX=-1,d.directionY=0;break;case MathInteractives.global.CanvasAcc.KEYS.UPARROW:d.directionX=0,d.directionY=-1;break;case MathInteractives.global.CanvasAcc.KEYS.RIGHTARROW:d.directionX=1,d.directionY=0;break;case MathInteractives.global.CanvasAcc.KEYS.DOWNARROW:d.directionX=0,d.directionY=1}this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS.ARROW,this.$el.trigger(this.lastTriggeredEvent,d),this._setSelfFocus()},_handleFocusOut:function(a,b){var c={item:b?b.get("paperItem"):null,event:{which:1},isAccessibility:!0,isArrowKey:!1};if(this._isStart=!0,this.model.setCollectionCanvasItems(this.model.get("paperItems")),a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP){var d=this.model.get("gridCell").origin,e={x:d.x,y:d.y};this.model.set("focusCurrentPosition",e),this.hideFocusRect(),this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.FOCUS_OUT,this.$el.trigger(this.lastTriggeredEvent,c)}else this.isDrag=!1,this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS.FOCUS_OUT,this.$el.trigger(this.lastTriggeredEvent,c)},_handleEscape:function(a,b){var c=b?b.get("paperItem"):null,d={item:c,event:{which:1},isAccessibility:!0,isArrowKey:!1};this._isStart=!0,this.canvasFocusOut(a,b),a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_LINE?(this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAW_LINE_EVENTS.ESCAPE,this.$el.trigger(this.lastTriggeredEvent,d)):a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_AND_EXPAND?(this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAW_AND_EXPAND_EVENTS.ESCAPE,this.$el.trigger(this.lastTriggeredEvent,d)):a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP?(this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.ESCAPE,this.$el.trigger(this.lastTriggeredEvent,d)):(this.model.setCollectionCanvasItems(this.model.get("paperItems")),this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS.ESCAPE,this.$el.trigger(this.lastTriggeredEvent,d)),this._paperScope&&this._paperScope.view.draw(),this._setSelfFocus()},setSelfFocus:function(){this._setSelfFocus()},_setSelfFocus:function(){if(!this.player.getModalPresent()){var a=this.model.get("selfFocusDisableEvents");if(a&&this.lastTriggeredEvent)for(var b=a.length,c=0;b>c;c++)if(this.lastTriggeredEvent===a[c])return void(this.lastTriggeredEvent=null);this.lastTriggeredEvent=null;var d=this.el.id,e=this.model.get("canvasHolderID"),f=this.$("#"+d+"-acc-elem");if(f.length>0){var g=f.text(),h=d.replace(this.idPrefix,"");g===this.prevText&&""!==g?(this.prevText=g+" ",this.setAccMessage(h,this.prevText)):this.prevText=g}this.setFocus(e.replace(this.idPrefix,"")+"temp-focus-div"),this.manager.setFocus(d,0)}},canvasFocusOut:function(a,b){a=a?a:this.model.get("type"),b=b?b:this.model.get("collectionCanvasItems").getCurrentItem(),a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.NAVIGATE_ITEM||a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.NAVIGATE_LINE||a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP?this._handleFocusOut(a,b):(a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_LINE||a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_AND_EXPAND)&&this._handleGridNavigationFocusOut(a)},addPaperItem:function(a){var b=this.model.get("collectionCanvasItems"),c=new MathInteractives.Common.Player.Models.CanvasItem({paperItem:a,paperScope:this._paperScope});this.model.get("paperItems").push(a),b.add(c)},removePaperItem:function(a){var b=this.model.get("collectionCanvasItems"),c=b.where({paperItem:a}),d=this.model.get("paperItems"),e=d.indexOf(a);e>-1&&(d.splice(e,1),b.remove(c))},updatePaperItems:function(a,b){this.model.set({paperItems:a,isKeepCurrentItem:b}),b||(this._isStart=!0)},setCurrentPaperItem:function(a,b){return b&&(this._isStart=!1),this.model.setCollectionCurrentItem(a)},updateSelfFocusDisableEvents:function(a){this.model.set("selfFocusDisableEvents",a)},getCurrentPaperItem:function(){return this.model.getCollectionCurrentItem()},getCurrentPaperItemIndex:function(){return this.model.getCollectionCurrentItemIndex()},_handleDrawLineSpace:function(){var a=this.model.get("focusCurrentPosition"),b={point:{x:a.x,y:a.y},event:{which:1},isAccessibility:!0,isArrowKey:!1};this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAW_LINE_EVENTS.SPACE,this.$el.trigger(this.lastTriggeredEvent,b),this._setSelfFocus()},_handleDrawAndExpandSpace:function(a,b){var c=this.model.get("focusCurrentPosition"),d={point:{x:c.x,y:c.y},event:{which:1},isAccessibility:!0,isArrowKey:!1};b||a!==MathInteractives.global.CanvasAcc.KEYS.SPACE&&a!==MathInteractives.global.CanvasAcc.KEYS.ENTER||(this.isExpand=!this.isExpand),d.isExpand=this.isExpand,this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAW_AND_EXPAND_EVENTS.SPACE,this.$el.trigger(this.lastTriggeredEvent,d),this._setSelfFocus()},_hadleGridNavigation:function(a,b,c,d,e){var f=this.model.get("focusCurrentPosition"),g=this.model.get("gridCell").size,h=this.model.get("gridContainment"),i={point:{x:f.x,y:f.y},event:{which:1},isAccessibility:!0,isArrowKey:!0,directionX:0,directionY:0,isFirstSpace:c};if(a!==MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP||this.isDrag){switch(b){case MathInteractives.global.CanvasAcc.KEYS.LEFTARROW:i.directionX=-1,i.directionY=0;break;case MathInteractives.global.CanvasAcc.KEYS.UPARROW:i.directionX=0,i.directionY=-1;break;case MathInteractives.global.CanvasAcc.KEYS.RIGHTARROW:i.directionX=1,i.directionY=0;break;case MathInteractives.global.CanvasAcc.KEYS.DOWNARROW:i.directionX=0,i.directionY=1}var j={x:i.point.x+g.width*i.directionX,y:i.point.y+g.height*i.directionY};j.x>=h.minX&&j.x<=h.maxX&&(i.point.x=j.x),j.y>=h.minY&&j.y<=h.maxY&&(i.point.y=j.y),this.model.set("focusCurrentPosition",i.point),this._drawFocusRect(),a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_LINE?(this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAW_LINE_EVENTS.ARROW,this.$el.trigger(this.lastTriggeredEvent,i)):a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_AND_EXPAND?(i.isExpand=this.isExpand,this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAW_AND_EXPAND_EVENTS.ARROW,this.$el.trigger(this.lastTriggeredEvent,i)):a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAG_AND_DROP&&(i.item=d.get("paperItem"),this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAG_AND_DROP_EVENTS.ARROW,this.$el.trigger(this.lastTriggeredEvent,i)),e||this._setSelfFocus()}},_handleGridNavigationFocusOut:function(a){this._isStart=!0;var b=this.model.get("focusCurrentPosition"),c={point:{x:b.x,y:b.y},event:{which:1},isAccessibility:!0,isArrowKey:!1},d=this.model.get("gridCell").origin,e={x:d.x,y:d.y};this.model.set("focusCurrentPosition",e),this.hideFocusRect(),a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_LINE?(this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAW_LINE_EVENTS.FOCUS_OUT,this.$el.trigger(this.lastTriggeredEvent,c)):a===MathInteractives.Common.Player.Models.CanvasAcc.TYPE.DRAW_AND_EXPAND&&(this.isExpand=!1,this.lastTriggeredEvent=MathInteractives.Common.Player.Models.CanvasAcc.DRAW_AND_EXPAND_EVENTS.FOCUS_OUT,this.$el.trigger(this.lastTriggeredEvent,c))},_drawFocusRect:function(a){var b=a?a:this.model.get("focusCurrentPosition"),c=this._paperScope,d=this.model.get("focusRectSize");this.hideFocusRect();var e=new c.Path.Rectangle([b.x-d.width/2,b.y-d.height/2],[d.width,d.height]);e.strokeColor=this.model.get("focusRectColor"),e.strokeWidth=this.model.get("focusRectBorderWidth"),e.dashArray=[2,2],this._currentFocusRect=e,c.view.draw()},getFocusRect:function(){return this._currentFocusRect},hideFocusRect:function(){null!==this._currentFocusRect&&(this._currentFocusRect.remove(),this._paperScope.view.draw())},_currrentPosition:{x:36,y:36},_getNextPosition:function(a){var b=this._detailsForFocusRect,c=b.canvasBounds,d=b.gridCellSize,e=d;null===this._currrentPosition&&(this._currrentPosition={x:d,y:d}),a.shiftKey&&(e*=-1),this._currrentPosition.x+=e,this._currrentPosition.x>c.maxX-d&&(this._currrentPosition.x=d,this._currrentPosition.y+=e),this._currrentPosition.x<d&&(this._currrentPosition.x=c.maxX-d,this._currrentPosition.y-=d),(this._currrentPosition.y<d||this._currrentPosition.y>c.maxY)&&(this._currrentPosition=null)},_mouseDownTriggered:!1,_toolMouseEvents:function(){var a={x:this._currentFocusRect.position.x,y:this._currentFocusRect.position.y},b=this._paperScope.tool;this._mouseDownTriggered===!1?(b.fire("mousedown",{point:a,event:{which:1}}),this._mouseDownTriggered=!0):(b.fire("mousedrag",{point:a,event:{which:1}}),b.fire("mouseup",{point:a,event:{which:1}}),this._mouseDownTriggered=!1),this._paperScope.view.draw()}},{KEYS:{TAB:9,SPACE:32,ENTER:13,ESCAPE:27,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40,DELETE:68,ROTATE_CLOCKWISE:82,ROTATE_ANTI_CLOCKWISE:69},intializeCanvasAcc:function(a){var b=a.model||null,c=null,d="#"+a.canvasHolderID;return null===b&&(b=new MathInteractives.Common.Player.Models.CanvasAcc(a)),c=new MathInteractives.Common.Player.Views.CanvasAcc({model:b,el:d})}}),MathInteractives.global.CanvasAcc=MathInteractives.Common.Player.Views.CanvasAcc)}(),function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraphNew.GridGraphModel=Backbone.Model.extend({defaults:{_points:null,_plots:null,_images:null,circleDrag:null,positionBox:null,xCoOrdinateBase:null,xCoOrdinatePower:null,yCoOrdinatePower:null,yCoOrdinateBase:null,coOrdinateSeparator:null,path:null,markerBounds:null,_graphDisplayValues:null},initialize:function(){var a,b=this.attributes;b._points=[],b._plots=[],b._images=[],b.markerBounds={max:{x:null,y:null,"\\theta":null},min:{x:null,y:null,"\\theta":null}},b._graphDisplayValues={_graphDisplay:null,_graphsAxisLimits:null,_graphOrigin:null,_graphParameters:null,_zoomingFactor:null,_graphLimitTextBoxDomElement:null,_symbols:null},a=b._graphDisplayValues,a._graphDisplay={isCartesionCurrentGraphType:!0,isLabelShown:!0,isGridLineShown:!0,isAxisLinesShown:!0,isProjectorModeOn:!1,isXmarkerInRadians:!1,isYmarkerInRadians:!1,isPolarAngleInRadian:!0},a._graphsAxisLimits={defaultLimits:{xLower:null,xUpper:null,yLower:null,yUpper:null},currentLimits:{xLower:null,xUpper:null,yLower:null,yUpper:null},isXLastChangedLimit:null},a._graphOrigin={currentOrigin:null,defaultOrigin:null,doubleClickedPoint:null,isOriginPositionChanged:null},a._graphParameters={graphGridLine:null,yGridLine:null,xGridLine:null,totalVerticalLines:null,distanceBetweenTwoVerticalLines:null,currentDistanceBetweenTwoVerticalLines:null,totalHorizontalLines:null,distanceBetweenTwoHorizontalLines:null,currentDistanceBetweenTwoHorizontalLines:null},a._zoomingFactor={previousZoomAngle:null,zoomLevel:null,zoomFactorForGraphParameterModification:null,xZoomFactorForGraphParameterModification:null,yZoomFactorForGraphParameterModification:null,zoomAngle:null,zoomDistance:null,doubleClickZoomAllow:!0,xCurrentFactor:null,yCurrentFactor:null,xZoomMultiplier:null,yZoomMultiplier:null,xTotalMultiplier:null,yTotalMultiplier:null,xZoomLevel:null,currentXZoomLevel:null,yZoomLevel:null,currentYZoomLevel:null,zoomCounter:null},a._graphLimitTextBoxDomElement={xLower:null,xUpper:null,yLower:null,yUpper:null},a._symbols={xAxis:null,yAxis:null,xMarkerLines:null,yMarkerLines:null,xInnerGridLines:null,yInnerGridLines:null}},setModelAttribute:function(a){var b=this.attributes;b._points=[],b._plots=[],b.markerBounds=a.markerBounds,b._graphDisplayValues._graphDisplay=a.graphDisplay,b._graphDisplayValues._graphsAxisLimits.currentLimits.xLower=a.currentLimits.xLower,b._graphDisplayValues._graphsAxisLimits.currentLimits.xUpper=a.currentLimits.xUpper,b._graphDisplayValues._graphsAxisLimits.currentLimits.yLower=a.currentLimits.yLower,b._graphDisplayValues._graphsAxisLimits.currentLimits.yUpper=a.currentLimits.yUpper,b.markerBounds.max.x=a.currentLimits.xUpper,b.markerBounds.max.y=a.currentLimits.yUpper,b.markerBounds.min.x=a.currentLimits.xLower,b.markerBounds.min.y=a.currentLimits.yLower,b._graphDisplayValues._graphOrigin.currentOrigin.x=a.graphOrigin.currentOrigin.x,b._graphDisplayValues._graphOrigin.currentOrigin.y=a.graphOrigin.currentOrigin.y,b._graphDisplayValues._graphOrigin.defaultOrigin.x=a.graphOrigin.defaultOrigin.x,b._graphDisplayValues._graphOrigin.defaultOrigin.y=a.graphOrigin.defaultOrigin.y,b._graphDisplayValues._graphOrigin.isOriginPositionChanged=a.graphOrigin.isOriginPositionChanged,b._graphDisplayValues._graphParameters=a.graphParameters,b._graphDisplayValues._zoomingFactor=a.zoomingFactor}},{})}(window.MathInteractives),function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.MathFunctions=Backbone.Model.extend({},{checkIfNotADecimalNumber:function(a){return"number"==typeof a&&a%1===0},performMathematicalCalculations:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(void 0===b||void 0===c)return null;switch(e=NaN,f=c.length,g=0,h=null,h=void 0!==d&&"rad"===d.angle?1:0,b){case"+":for(e=0,g;f>g;g++){if(l=c[g],"number"!=typeof l){e=NaN;break}e+=l}break;case"-":if("number"!=typeof c[0])break;for(e=c[0],g=1;f>g;g++){if(l=c[g],"number"!=typeof l){e=NaN;break}e-=l}break;case"^":case"pow":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(0===c[0]&&0===c[1])break;if(!r.MathFunctions.checkIfNotADecimalNumber(c[1])){if(q=1/c[1],o=Math.abs(c[0]),p=c[0]>=0?1:-1,q%2===0&&-1===p)break;e=p*Math.pow(o,c[1]);break}e=Math.pow(c[0],c[1]);break;case"*":case"\\cdot":for(e=1,g;f>g;g++){if(l=c[g],"number"!=typeof l){e=NaN;break}e*=l}break;case"/":case"\\frac":if("number"!=typeof c[0]||"number"!=typeof c[1])break;e=c[0]/c[1];break;case"\\sqrt":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(0===c[0]||c[0]%2===0&&c[1]<0)break;if(0===c[0]){e=0;break}e=c[0]<0?1/Math.pow(Math.abs(c[1]),1/(-1*c[0])):Math.pow(Math.abs(c[1]),1/c[0]),c[1]<0&&(e=-e);break;case"\\ln":if("number"!=typeof c[0])break;e=Math.log(c[0]);break;case"\\log":if("number"!=typeof c[0])break;e=Math.log(c[0])/Math.LN10;break;case"\\log_":if("number"!=typeof c[0]||"number"!=typeof c[1])break;e=Math.log(c[1])/Math.log(c[0]);break;case"\\sin":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=Math.sin(k);break}e=Math.sin(c[0]);break;case"\\cos":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=Math.cos(k);break}e=Math.cos(c[0]);break;case"\\tan":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\sin",c,d)/r.MathFunctions.performMathematicalCalculations("\\cos",c,d);break;case"\\sec":if("number"!=typeof c[0])break;e=1/r.MathFunctions.performMathematicalCalculations("\\cos",c,d);break;case"\\csc":if("number"!=typeof c[0])break;e=1/r.MathFunctions.performMathematicalCalculations("\\sin",c,d);break;case"\\cot":if("number"!=typeof c[0])break;e=1/r.MathFunctions.performMathematicalCalculations("\\tan",c,d);break;case"\\arcsin":if("number"!=typeof c[0])break;e=Math.asin(c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arccos":if("number"!=typeof c[0])break;e=Math.acos(c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arctan":if("number"!=typeof c[0])break;e=Math.atan(c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arccsc":if("number"!=typeof c[0])break;e=Math.asin(1/c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arcsec":if("number"!=typeof c[0])break;e=Math.acos(1/c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arccot":if("number"!=typeof c[0])break;e=Math.PI/2-Math.atan(c[0]),0===h&&(e=180*e/Math.PI);break;case"\\sinh":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=(Math.pow(Math.E,k)-Math.pow(Math.E,-k))/2;break}e=(Math.pow(Math.E,c[0])-Math.pow(Math.E,-c[0]))/2;break;case"\\cosh":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=(Math.pow(Math.E,k)+Math.pow(Math.E,-k))/2;break}e=(Math.pow(Math.E,c[0])+Math.pow(Math.E,-c[0]))/2;break;case"\\tanh":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=(Math.pow(Math.E,2*k)-1)/(Math.pow(Math.E,2*k)+1);break}e=(Math.pow(Math.E,2*c[0])-1)/(Math.pow(Math.E,2*c[0])+1);break;case"\\csch":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=2/(Math.pow(Math.E,k)-Math.pow(Math.E,-k));break}e=2/(Math.pow(Math.E,c[0])-Math.pow(Math.E,-c[0]));
break;case"\\sech":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=2/(Math.pow(Math.E,k)+Math.pow(Math.E,-k));break}e=2/(Math.pow(Math.E,c[0])+Math.pow(Math.E,-c[0]));break;case"\\coth":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=(Math.pow(Math.E,2*k)+1)/(Math.pow(Math.E,2*k)-1);break}e=(Math.pow(Math.E,2*c[0])+1)/(Math.pow(Math.E,2*c[0])-1);break;case"\\arsinh":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\sqrt",[2,r.MathFunctions.performMathematicalCalculations("^",[c[0],2],d)+1],d),e=r.MathFunctions.performMathematicalCalculations("\\ln",[c[0]+e],d),0===h&&(e=180*e/Math.PI);break;case"\\arcosh":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\sqrt",[2,r.MathFunctions.performMathematicalCalculations("^",[c[0],2],d)-1],d),e=r.MathFunctions.performMathematicalCalculations("\\ln",[c[0]+e],d),0===h&&(e=180*e/Math.PI);break;case"\\artanh":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\frac",[1+c[0],1-c[0]],d),e=.5*r.MathFunctions.performMathematicalCalculations("\\ln",[e],d),0===h&&(e=180*e/Math.PI);break;case"\\arcsch":if("number"!=typeof c[0])break;e=1/c[0]+r.MathFunctions.performMathematicalCalculations("\\sqrt",[2,1/r.MathFunctions.performMathematicalCalculations("^",[c[0],2],d)+1],d),e=r.MathFunctions.performMathematicalCalculations("\\ln",[e],d),0===h&&(e=180*e/Math.PI);break;case"\\arsech":if("number"!=typeof c[0])break;e=1/c[0]+r.MathFunctions.performMathematicalCalculations("\\sqrt",[2,1/r.MathFunctions.performMathematicalCalculations("^",[c[0],2],d)-1],d),e=r.MathFunctions.performMathematicalCalculations("\\ln",[e],d),0===h&&(e=180*e/Math.PI);break;case"\\arcoth":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\frac",[c[0]+1,c[0]-1],d),e=.5*r.MathFunctions.performMathematicalCalculations("\\ln",[e],d),0===h&&(e=180*e/Math.PI);break;case"!":if("number"!=typeof c[0]||c[0]<0)break;if(c[0]>170||!isFinite(c[0])){e=1/0;break}if(0===c[0]){e=1;break}e=r.MathFunctions.checkIfNotADecimalNumber(c[0])&&c[0]>0?r.MathFunctions.findFactorial(c[0]):c[0]*r.MathFunctions._gammaFunction(c[0]);break;case"\\%":if(1===c.length){if("number"!=typeof c[0]){e=NaN;break}e=c[0]/100}else{if("number"!=typeof c[0]||"number"!=typeof c[1]){e=NaN;break}e=c[1]*(c[0]/100)}break;case"\\gcd":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(c[0]=Math.floor(Math.abs(c[0])),c[1]=Math.floor(Math.abs(c[1])),0===c[0]){e=c[1],0===c[1]&&(e=0);break}if(0===c[1]){e=c[0];break}e=r.MathFunctions._calculateGcd(c[0],c[1]);break;case"\\lcm":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(c[0]=Math.floor(Math.abs(c[0])),c[1]=Math.floor(Math.abs(c[1])),0===c[0]){if(0===c[1]){e=NaN;break}e=0;break}if(0===c[1]){e=0;break}e=c[0]*c[1]/r.MathFunctions._calculateGcd(c[0],c[1]);break;case"\\ceil":if("number"!=typeof c[0])break;e=Math.ceil(c[0]);break;case"\\floor":if("number"!=typeof c[0])break;e=Math.floor(c[0]);break;case"\\round":if("number"!=typeof c[0])break;e=Math.round(c[0]);break;case"\\abs":if("number"!=typeof c[0])break;e=Math.abs(c[0]);break;case"\\min":if("number"!=typeof c[0]||"number"!=typeof c[1])break;e=Math.min(c[0],c[1]);break;case"\\max":if("number"!=typeof c[0]||"number"!=typeof c[1])break;e=Math.max(c[0],c[1]);break;case"\\mod":if(e=NaN,"number"!=typeof c[0]||"number"!=typeof c[1]||0===c[1])break;if(c[0]%c[1]===0){e=0;break}if(c[0]>0&&c[1]>0||c[0]<0&&c[1]<0){e=c[0]%c[1];break}if(c[0]<0&&c[1]>0||c[0]>0&&c[1]<0){e=c[1]+c[0]%c[1];break}break;case"\\nCr":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(c[0]<0||c[1]<0){e=0;break}if(c[0]=Math.floor(Math.abs(c[0])),c[1]=Math.floor(Math.abs(c[1])),c[0]<c[1]){e=0;break}e=r.MathFunctions.findFactorial(c[0])/(r.MathFunctions.findFactorial(c[1])*r.MathFunctions.findFactorial(c[0]-c[1]));break;case"\\nPr":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(c[0]<0||c[1]<0){e=0;break}if(c[0]=Math.floor(Math.abs(c[0])),c[1]=Math.floor(Math.abs(c[1])),c[0]<c[1]){e=0;break}e=r.MathFunctions.findFactorial(c[0])/r.MathFunctions.findFactorial(c[0]-c[1]);break;case"\\prod_":if("number"!=typeof c[1]||"number"!=typeof c[2])break;if(c[1]>c[2]){e=1;break}if(0===c[3]){e=0;break}if(i=Math.round(c[2])-Math.round(c[1])+1,j=1,"number"==typeof c[3])for(var s=Math.round(c[1]);s<=Math.round(c[2]);s++)j*=c[3];else for(var s=Math.round(c[1]);s<=Math.round(c[2]);s++)j*=c[3];for(;0!==i;)j*=c[3],i--;e=j;break;case"\\sum_":if("number"!=typeof c[1]||"number"!=typeof c[2])break;if(c[1]>c[2]||0===c[3]){e=0;break}for(m=Math.round(c[1])-Math.round(c[0])+1,n=0;0!==m;)n+=c[2],m--;e=n;break;case"\\exp":if("number"!=typeof c[0])break;e=Math.exp(c[0])}return e=r.MathFunctions._processResultForTrignometricFunctions(b,e)},getGUID:function(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(a()+a()+"-"+a()+"-4"+a().substr(0,3)+"-"+a()+"-"+a()+a()+a()).toLowerCase()},findFactorialString:"function findFactorial(number) {            var factorial = 1,                input_value;    if (number === 0 || number === 1) {        return factorial;    }    input_value = number;    while (input_value !== 1) {        factorial = factorial * input_value;        input_value--;    }    return factorial;};",findFactorial:function(a){var b,c=1;if(0===a||1===a)return c;for(b=a;1!==b;)c*=b,b--;return c},_calculateGcd:function(b,c){var d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return c?d.MathFunctions._calculateGcd(c,b%c):b},whileInOneLine:function(a,b,c,d){var c=a+"while("+b+"){"+c+"} return "+d,e=new Function("",c);return e()},_gammaFunctionString:"function gammaFunction(value) { var gammaCounter,gammaSum,gamma,arbitaryCounter = 7,gammaArray = [0.99999999999980993, 676.5203681218851, -1259.1392167224028, 771.32342877765313, -176.61502916214059, 12.507343278686905,-0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];    if (value < 0.5) {        return Math.PI / (Math.sin(Math.PI * value) * gammaFunction(1 - value));    }    else {        value -= 1;        gamma = gammaArray[0];        for (gammaCounter = 1; gammaCounter < arbitaryCounter + 2; gammaCounter++) {            gamma += gammaArray[gammaCounter] / (value + gammaCounter);        }        gammaSum = value + arbitaryCounter + 0.5;        return Math.sqrt(2 * Math.PI) * Math.pow(gammaSum, (value + 0.5)) * Math.exp(-gammaSum) * gamma;    }};",_gammaFunction:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,g=7,h=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];if(.5>b)return Math.PI/(Math.sin(Math.PI*b)*f.MathFunctions._gammaFunction(1-b));for(b-=1,e=h[0],c=1;g+2>c;c++)e+=h[c]/(b+c);return d=b+g+.5,Math.sqrt(2*Math.PI)*Math.pow(d,b+.5)*Math.exp(-d)*e},getSumString:function(){return"function sum(pivot, start, end, expression, param, constants) {var findFactorialString = '"+a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.MathFunctions.findFactorialString+"';var gammaFunctionString='"+New.EquationEngine.MathFunctions._gammaFunctionString+"'; function addStringFunctionDependency(functionCode) {            if (functionCode.search('findFactorial') > -1) {                functionCode = findFactorialString + functionCode;            }    if (functionCode.search('gammaFunction') > -1) {        functionCode = gammaFunctionString + functionCode;    }  return functionCode;}; start = addStringFunctionDependency(start) + '; return ' +start;            end = addStringFunctionDependency(end) + '; return ' + end;    expression = addStringFunctionDependency(expression) + '; return ' + expression;    var funcStartRange = new Function('param,constants', start);            var funcEndRange = new Function('param,constants', end);            var funcExpression = new Function(pivot+',param,constants', expression);            var startValue = funcStartRange(param, constants);            var endValue = funcEndRange(param, constants);           var result = 0;    if (!isFinite(startValue) || !isFinite(endValue)) {            return;        }        for(i = startValue;i<=endValue;i+= 1){                result +=funcExpression(i,param, constants);                if (!isFinite(result)) {                    return;                }            }         return result;        };"},getProdString:function(){return"function prod(pivot, start, end, expression, param, constants) {var findFactorialString = '"+a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.MathFunctions.findFactorialString+"';var gammaFunctionString='"+a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.MathFunctions._gammaFunctionString+"'; function addStringFunctionDependency(functionCode) {            if (functionCode.search('findFactorial') > -1) {                functionCode = findFactorialString + functionCode;            }    if (functionCode.search('gammaFunction') > -1) {        functionCode = gammaFunctionString + functionCode;    }  return functionCode;}; start = addStringFunctionDependency(start) + '; return ' +start;            end = addStringFunctionDependency(end) + '; return ' + end;    expression = addStringFunctionDependency(expression) + '; return ' + expression;  var funcStartRange = new Function('param,constants', start);            var funcEndRange = new Function('param,constants', end);            var funcExpression = new Function(pivot+',param,constants', expression);            var startValue = funcStartRange(param, constants);            var endValue = funcEndRange(param, constants);           var result = 1;   if (!isFinite(startValue) || !isFinite(endValue)) {            return;        }         for(i = startValue;i<=endValue;i+= 1){                result *=funcExpression(i,param, constants);                if (!isFinite(result)) {                    return;                }            }         return result;        };"},addStringFunctionDependency:function(a){return a.search("findFactorial")>-1&&(a=nameSpace.MathFunctions.findFactorialString+a),a.search("gammaFunction")>-1&&(a=nameSpace.MathFunctions._gammaFunctionString+a),a},sumProductPrototype:function(a,b,c,d,e,f){b=nameSpace.MathFunctions.addStringFunctionDependency(b)+"return "+b,c=nameSpace.MathFunctions.addStringFunctionDependency(c)+"return "+c,d=nameSpace.MathFunctions.addStringFunctionDependency(d)+"return "+d;var g=new Function("param,constants",b),h=new Function("param,constants",c),j=new Function(a+",param,constants",d),k=g(e,f),l=h(e,f),m=0;if(isFinite(k)&&isFinite(l)){for(i=k;i<l;i+=1)if(m+=j(i,e,f),!isFinite(m))return;return m}},decToFrac:function(a,b){},_processResultForTrignometricFunctions:function(a,b){var c=["\\sin","\\cos","\\tan","\\cot","\\sec","\\csc","\\sinh","\\cosh","\\tanh","\\coth","\\sech","\\csch"];return-1!==c.indexOf(a)&&(isNaN(b)||(b=Number(b.toFixed(10)))),b}})}(window.MathInteractives),function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Productions=Backbone.Model.extend({},{_terminalProductions:null,_nonTerminalProductions:null,productionTable:null,productionRules:null,_seperatedTokens:null,treeGenerationRules:null,_nonTerminalRules:null,_operatorsInPrecedenceOrder:null,_terminalRules:null,init:function(){null===a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Productions.productionRules&&a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Productions._populateProductionData()},getMaximumParameters:function(a){switch(a){case"^":case"\\log_":case"\\sqrt":case"\\gcd":case"\\lcm":case"\\min":case"\\max":case"\\mod":case"\\nCr":case"\\nPr":case"\\frac":return 2;case"+":case"-":case"\\cdot":case".":return 1/0;case"!":case"\\%":case"\\sin":case"\\cos":case"\\tan":case"\\csc":case"\\sec":case"\\cot":case"\\sinh":case"\\cosh":case"\\tanh":case"\\arcsin":case"\\arccos":case"\\arctan":case"\\log":case"\\ln":case"\\ceil":case"\\floor":case"\\round":case"\\abs":case"\\exp":case"do":return 1;case"\\sum":case"\\prod":return 4}},_populateProductionData:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;for(n.Productions._terminalProductions=["\\frac","(","[","var","const","digit","\\theta","{","\\sin","\\cos","\\tan","\\csc","\\sec","\\cot","\\arcsin","\\arccos","\\arctan","\\arccsc","\\arcsec","\\arccot","\\sinh","\\cosh","\\tanh","\\csch","\\sech","\\coth","\\log_","\\ln","\\log","\\sqrt","\\gcd","\\lcm","\\ceil","\\floor","\\round","\\abs","\\min","\\max","\\mod","\\nPr","\\nCr","\\exp","\\sum","\\prod"],n.Productions._terminalRules=["node.\\frac","node.do","node.do","terminal.var","terminal.const","terminal.digit","terminal.\\theta","node.do","node.\\sin","node.\\cos","node.\\tan","node.\\csc","node.\\sec","node.\\cot","node.\\arcsin","node.\\arccos","node.\\arctan","node.\\arccsc","node.\\arcsec","node.\\arccot","node.\\sinh","node.\\cosh","node.\\tanh","node.\\csch","node.\\sech","node.\\coth","node.\\log_","node.\\ln","node.\\log","node.\\sqrt","node.\\gcd","node.\\lcm","node.\\ceil","node.\\floor","node.\\round","node.\\abs","node.\\min","node.\\max","node.\\mod","node.\\nPr","node.\\nCr","node.\\exp","node.\\sum terminal.const","node.\\prod terminal.const"],n.Productions._seperatedTokens={"\\frac":["\\frac","{","E","}","{","E","}"],"(":["(","E",")"],"[":["[","E","]"],"var":["var"],"const":["const"],digit:["digit"],"\\theta":["\\theta"],"{":["{","E","}"],"\\sin":["\\sin","(","E",")"],"\\cos":["\\cos","(","E",")"],"\\tan":["\\tan","(","E",")"],"\\csc":["\\csc","(","E",")"],"\\sec":["\\sec","(","E",")"],"\\cot":["\\cot","(","E",")"],"\\arcsin":["\\arcsin","(","E",")"],"\\arccos":["\\arccos","(","E",")"],"\\arctan":["\\arctan","(","E",")"],"\\arccsc":["\\arccsc","(","E",")"],"\\arcsec":["\\arcsec","(","E",")"],"\\arccot":["\\arccot","(","E",")"],"\\sinh":["\\sinh","(","E",")"],"\\cosh":["\\cosh","(","E",")"],"\\tanh":["\\tanh","(","E",")"],"\\csch":["\\csch","(","E",")"],"\\sech":["\\sech","(","E",")"],"\\coth":["\\coth","(","E",")"],"\\log_":["\\log_","{","E","}","(","E",")"],"\\ln":["\\ln","(","E",")"],"\\log":["\\log","(","E",")"],"\\sqrt":["\\sqrt","[","E","]","{","E","}"],"\\gcd":["\\gcd","(","E",",","E",")"],"\\lcm":["\\lcm","(","E",",","E",")"],"\\ceil":["\\ceil","(","E",")"],"\\floor":["\\floor","(","E",")"],"\\round":["\\round","(","E",")"],"\\abs":["\\abs","(","E",")"],"\\min":["\\min","(","E",",","E",")"],"\\max":["\\max","(","E",",","E",")"],"\\mod":["\\mod","(","E",",","E",")"],"\\nPr":["\\nPr","(","E",",","E",")"],"\\nCr":["\\nCr","(","E",",","E",")"],"\\exp":["\\exp","(","E",")"],"\\sum":["\\sum","{","const","}","{","E","}","{","E","}","{","E","}"],"\\prod":["\\prod","{","const","}","{","E","}","{","E","}","{","E","}"]},n.Productions._operatorsInPrecedenceOrder=["+","\\cdot","^","!","\\%"],n.Productions._nonTerminalRules=["node.+","node.\\cdot","node.^","node.!","node.\\%"],n.Productions.productionTable={E:{}},b=0,c=n.Productions._terminalProductions.length,b;c>b;b++)n.Productions.productionTable.E[n.Productions._terminalProductions[b]]=[];for(n.Productions.treeGenerationRules=[],n.Productions.productionRules=[],e=0,f=n.Productions._operatorsInPrecedenceOrder.length,b=0,c=n.Productions._terminalProductions.length,g=Math.pow(2,f)-1,b=0;c>b;b++)for(k=n.Productions._terminalProductions[b],l=n.Productions._seperatedTokens[k][0],j=0;g>j;j++){for(h=[],m="",d="",e=0;f>e;e++)(j&Math.pow(2,e))>0&&("!"===n.Productions._operatorsInPrecedenceOrder[e]||"\\%"===n.Productions._operatorsInPrecedenceOrder[e]?h.unshift("("+n.Productions._operatorsInPrecedenceOrder[e]+")+"):h.unshift("("+n.Productions._operatorsInPrecedenceOrder[e]+",E)+"),m=m+"node."+n.Productions._operatorsInPrecedenceOrder[e]+" ");if(i=n.Productions._seperatedTokens[k].concat.apply(n.Productions._seperatedTokens[k],[h]),d=m+n.Productions._terminalRules[b],n.Productions.treeGenerationRules.push(d),n.Productions.productionRules.push(i),n.Productions.productionTable.E[l].push(n.Productions.productionRules.length-1),"{"===k||"["===k)break}n.Productions._getProductionTableAsString()},_getProductionTableAsString:function(){var b=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,c="",d=0,e=b.Productions.productionRules.length;for(d=0;e>d;d++)c+=d+" : "+b.Productions.productionRules[d].join("")+"   >>    "+b.Productions.treeGenerationRules[d]+"\n";$("#rules").text(c)}}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationAnalysis=Backbone.Model.extend({_A:null,_B:null,_C:null,_canBeSolved:!0,_freeVars:null,_functionVariable:null,_paramVariable:null,_equationParameters:null,_pivot:null,_accText:null,_rhsAuto:null,_order:null,_FDFlag:null,_functionCode:null,_paramVariableOrder:null,_inEquatlityType:null,initialize:function(){this._A={},this._B={},this._C={},this._freeVars={},this._inEquatlityType="equal"},getA:function(){return this._A},getB:function(){return this._B},getC:function(){return this._C},isCanBeSolved:function(){return this._canBeSolved},getFreeVars:function(){return this._freeVars},getFunctionVariable:function(){return this._functionVariable},getParamVariable:function(){return this._paramVariable},getPivot:function(){return this._pivot},getAccText:function(){return this._accText},getRhsAuto:function(){return this._rhsAuto},getOrder:function(){return this._order},getFdFlag:function(){return this._FDFlag},getFunctionCode:function(){return this._functionCode},getParamVariableOrder:function(){return this._paramVariableOrder},setParamVariableOrder:function(a){this._paramVariableOrder=a},setA:function(a){this._A=a},setB:function(a){this._B=a},setC:function(a){this._C=a},setCanBeSolved:function(a){this._canBeSolved=a},setFreeVars:function(a){this._freeVars=a},setFunctionVariable:function(a){this._functionVariable=a},setParamVariable:function(a){this._paramVariable=a},setPivot:function(a){this._pivot=a},setAccText:function(a){this._accText=a},setRhsAuto:function(a){this._rhsAuto=a},setOrder:function(a){this._order=a},setFdFlag:function(a){this._FDFlag=a},setFunctionCode:function(a){this._functionCode=a},addToAccText:function(a){this._accText+=a},setInEqualityType:function(a){switch(a){case"\\le":this._inEquatlityType="ltequal";break;case"\\ge":this._inEquatlityType="gtequal";break;case">":this._inEquatlityType="greater";break;case"<":this._inEquatlityType="lesser";break;case"=":this._inEquatlityType="equal";break;default:this._inEquatlityType=a}},getInEqualityType:function(){return this._inEquatlityType},flush:function(){this._A={},this._B={},this._C={},this._freeVars={},this._canBeSolved=!0,this._functionVariable=null,this._paramVariable=null,this._accText=null,this._rhsAuto=null,this._order=null,this._FDFlag=null,this._functionCode=null,this._inEquatlityType="equal"}},{}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.PlotData=Backbone.Model.extend({_bannerData:{},_draggable:!1,_labelData:null,_pathGroup:null,_pointsGroup:null,_plotSessionCount:0,_bestFit:null,_raster:null,_rayPolygon:null,_plot:null,_inEqualititesPathGroup:null,getBannerData:function(){return this._bannerData},isDraggable:function(){return this._draggable},getLabelData:function(){return this._labelData},getPathGroup:function(){return this._pathGroup},removePathGroup:function(){delete this._pathGroup},getPointsGroup:function(){return this._pointsGroup},getPlotSessionCount:function(){return this._plotSessionCount},getBestFit:function(){return this._bestFit},getRaster:function(){return this._raster},getRayPolygon:function(){return this._rayPolygon},setRayPolygon:function(a){this._rayPolygon=a},setBannerData:function(a){this._bannerData=a},setDraggable:function(a){this._draggable=a},setLabelData:function(a){this._labelData=a},setPathGroup:function(a){this._pathGroup=a},setPointsGroup:function(a){this._pointsGroup=a},setPlotSessionCount:function(a){this._plotSessionCount=a},setBestFit:function(a){this._bestFit=a},setRaster:function(a){this._raster=a},setPlot:function(a){this._plot=a},getPlot:function(){return this._plot},setInEqualititesPathGroup:function(a){this._inEqualititesPathGroup=a},getInEqualititesPathGroup:function(){return this._inEqualititesPathGroup},initialize:function(){this._labelData={labelObject:null}},flush:function(){this._bannerData={},this._draggable=null,this._labelData={labelObject:null},this._pathGroup=null,this._pointsGroup=null,this._plotSessionCount=null,this._bestFit,this._raster=null}},{}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.ParserData=Backbone.Model.extend({_constants:null,_leftExpression:null,_leftRoot:null,_rightExpression:null,_rightRoot:null,getConstants:function(){return this._constants},getLeftExpression:function(){return this._leftExpression},getLeftRoot:function(){return this._leftRoot},getRightExpression:function(){return this._rightExpression},getRightRoot:function(){return this._rightRoot},setConstants:function(a){this._constants=a},setLeftExpression:function(a){this._leftExpression=a},setLeftRoot:function(a){this._leftRoot=a},setRightExpression:function(a){this._rightExpression=a},setRightRoot:function(a){this._rightRoot=a},getLeftEquationParameters:function(){return this._leftExpression.equationParameters},getRightEquationParameters:function(){return this._rightExpression.equationParameters},initialize:function(){this._setInitialStates()},_setInitialStates:function(){this._leftExpression={constants:{},freevars:{},expression:null,equationParameters:{operatorsList:[],variablesList:[],digitsList:[],constantsList:[],functionsList:[]}},this._rightExpression={constants:{},freevars:{},expression:null,equationParameters:{operatorsList:[],variablesList:[],digitsList:[],constantsList:[],functionsList:[]}}},flush:function(){this._constants=null,this._leftRoot=null,this._rightRoot=null,this._setInitialStates()}},{}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationStyleData=Backbone.Model.extend({_color:null,_dragHitThickness:null,_dragHitColor:null,_opacity:null,_thickness:null,_thicknessOnFocus:null,_visible:null,_dashArray:null,_closedPolygon:null,_smoothPolygon:null,_dragHitAlpha:null,initialize:function(){this._setInitialStyles()},flush:function(){this._setInitialStyles()},getColor:function(){return this._color},getDragHitThickness:function(){return this._dragHitThickness},getDragHitColor:function(){return this._dragHitColor},getOpacity:function(){return this._opacity},getThickness:function(){return this._thickness},getThicknessOnFocus:function(){return this._thicknessOnFocus},getVisible:function(){return this._visible},getPointVisibility:function(){return this._visible.point},getCurveVisibility:function(){return this._visible.curve},getDashArray:function(){return this._dashArray},isClosedPolygon:function(){return this._closedPolygon},isSmoothPolygon:function(){return this._smoothPolygon},getDragHitAlpha:function(){return this._dragHitAlpha},setColor:function(a){this._color=a},setDragHitThickness:function(a){this._dragHitThickness=a},setDragHitColor:function(a){this._dragHitColor=a},setOpacity:function(a){this._opacity=a},setThickness:function(a){this._thickness=a},setThicknessOnFocus:function(a){this._thicknessOnFocus=a},setVisible:function(a){"object"==typeof a?this._visible=a:(this._visible.point=a,this._visible.curve=a)},setPointVisibility:function(a){this._visible.point=a},setCurveVisibility:function(a){this._visible.curve=a},setDashArray:function(a){this._dashArray=a},setClosedPolygon:function(a){this._closedPolygon=a},setSmoothPolygon:function(a){this._smoothPolygon=a},setDragHitAlpha:function(a){this._dragHitAlpha=a},_setInitialStyles:function(){this._color="#000000",this._dragHitThickness=15,this._dragHitColor="#ff0000",this._opacity=1,this._thickness=1,this._thicknessOnFocus=3,this._visible={point:!0,curve:!0},this._dashArray=[],this._closedPolygon=!1,this._smoothPolygon=!1,this._dragHitAlpha=0}},{}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationPointsData=Backbone.Model.extend({_leftArray:null,_points:null,_rightArray:null,_criticalPoints:null,_intersectionPoints:null,_inEqualityPlots:null,getLeftArray:function(){return this._leftArray},getPoints:function(){return this._points},getRightArray:function(){return this._rightArray},setLeftArray:function(a){this._leftArray=a},setPoints:function(a){this._points=a},setRightArray:function(a){this._rightArray=a},getCriticalPoints:function(){return this._criticalPoints},setCriticalPoints:function(a){this._criticalPoints=a},getIntersectionPoints:function(){return this._intersectionPoints},setIntersectionPoints:function(a){this._intersectionPoints=a},getInEqualityPlots:function(){return this._inEqualityPlots},setInEqualityPlots:function(a){this._inEqualityPlots=a},flush:function(){this._leftArray=null,this._points=null,this._rightArray=null}},{}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationErrorData=Backbone.Model.extend({_errorCode:null,_errorData:null,_errorString:null,getErrorCode:function(){return this._errorCode},getErrorData:function(){return this._errorData},getErrorString:function(){return this._errorString},setErrorCode:function(a){this._errorCode=a},setErrorData:function(a){this._errorData=a},setErrorString:function(a){this._errorString=a},initialize:function(){this._errorData=[]},flush:function(){this._errorCode=null,this._errorData=null,this._errorString=null}},{}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationData=Backbone.Model.extend({_units:null,_latex:null,_style:null,_plotData:null,_parserData:null,_error:null,_pointsData:null,_analysis:null,_blind:!1,_autonomous:void 0,_specie:null,_parent:void 0,_solution:null,_debugging:null,_id:null,_isSaveRestoreData:!1,_directives:void 0,_prevLatex:null,_constants:null,initialize:function(){this._units={angle:"rad"},this._debugging={profiles:[]},this._autonomous=!1,this._specie="error",this._id=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.MathFunctions.getGUID(),this._analysis=new a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationAnalysis,this._style=new a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationStyleData,this._plotData=new a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.PlotData,this._parserData=new a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.ParserData,this._error=new a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationErrorData,this._pointsData=new a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationPointsData,this._directives={FDFlagMethod:"calculator",definedConstant:null,range:null}},toString:function(){return this.getLatex()},setLatex:function(a,b){this._latex=a,b||this.trigger("change-equation")},getLatex:function(){return this._latex},getAccText:function(){return this._analysis.getAccText()},setAccText:function(a){this._analysis.setAccText(a)},addToAccText:function(a){this._analysis.addToAccText(a)},getFreeVars:function(){return this._analysis.getFreeVars()},setFreeVars:function(a){this._analysis.setFreeVars(a)},getFunctionVariable:function(){return this._analysis.getFunctionVariable()},setFunctionVariable:function(a){this._analysis.setFunctionVariable(a)},getParamVariable:function(){return this._analysis.getParamVariable()},setParamVariable:function(a){this._analysis.setParamVariable(a)},setFdFlag:function(a){this._analysis.setFdFlag(a)},getFdFlag:function(){return this._analysis.getFdFlag()},getLeftRoot:function(){return this._parserData.getLeftRoot()},getRightRoot:function(){return this._parserData.getRightRoot()},setLeftRoot:function(a){return this._parserData.setLeftRoot(a)},setRightRoot:function(a){return this._parserData.setRightRoot(a)},setFunctionCode:function(a){this._analysis.setFunctionCode(a)},getFunctionCode:function(){return this._analysis.getFunctionCode()},getA:function(){return this._analysis.getA()},getB:function(){return this._analysis.getB()},getC:function(){return this._analysis.getC()},setA:function(a){this._analysis.setA(a)},setB:function(a){this._analysis.setB(a)},setC:function(a){this._analysis.setC(a)},getParamVariableOrder:function(){return this._analysis.getParamVariableOrder()},setParamVariableOrder:function(a){this._analysis.setParamVariableOrder(a)},getLeftEquationParameters:function(){return this._parserData.getLeftEquationParameters()},getRightEquationParameters:function(){return this._parserData.getRightEquationParameters()},getAllConstants:function(){var a,b=this._parserData.getLeftEquationParameters().constantsList,c=this._parserData.getRightEquationParameters().constantsList;return a=_.union(b,c)},setPlot:function(a){this._plotData.setPlot(a)},getPlot:function(){return this._plotData.getPlot()},getBestFit:function(){return this._plotData.getBestFit()},setBestFit:function(a){return this._plotData.setBestFit(a)},getThicknessOnFocus:function(){return this._style.getThicknessOnFocus()},setThicknessOnFocus:function(a){return this._style.setThicknessOnFocus(a)},setInEqualityType:function(a){this._analysis.setInEqualityType(a)},getInEqualityType:function(){return this._analysis.getInEqualityType()},getInEqualityPlots:function(){return this._pointsData.getInEqualityPlots()},setInEqualityPlots:function(a){this._pointsData.setInEqualityPlots(a)},setInEqualititesPathGroup:function(a){this._plotData.setInEqualititesPathGroup(a)},getInEqualititesPathGroup:function(){return this._plotData.getInEqualititesPathGroup()},getDefinedConstant:function(){return this._directives.definedConstant},setDefinedConstant:function(a){this._directives.definedConstant=a},reverseInequality:function(){var a=this.getInEqualityType();switch(a){case"lesser":this.setInEqualityType(">");break;case"greater":this.setInEqualityType("<");break;case"ltequal":this.setInEqualityType("\\ge");break;case"gtequal":this.setInEqualityType("\\le")}},setConstants:function(a,b){this._constants=a,b||this.trigger("change-constants")},getConstants:function(){return this._constants},getProfiles:function(){return this._debugging.profiles},getEquationParameters:function(){return this._analysis.getEquationParameters()},setCanBeSolved:function(a){this._analysis.setCanBeSolved(a)},isCanBeSolved:function(){return this._analysis.isCanBeSolved()},setPivot:function(a){this._analysis.setPivot(a)},getPivot:function(){return this._analysis.getPivot()},setErrorCode:function(a){this._error.setErrorCode(a)},getErrorCode:function(){return this._error.getErrorCode()},setErrorData:function(a){this._error.setErrorData(a)},getErrorData:function(){return this._error.getErrorData()},setErrorString:function(a){this._error.setErrorString(a)},getErrorString:function(){return this._error.getErrorString()},getLeftExpression:function(){return this._parserData.getLeftExpression()},getRightExpression:function(){return this._parserData.getRightExpression()},getRange:function(){return this._directives.range},setRange:function(a){this._directives.range=a},setUnits:function(a){var b=null;for(b in a)this._units[b]=a[b]},getUnits:function(){return this._units},setAnalysis:function(a){this._analysis=a},getAnalysis:function(){return this._analysis},setSpecie:function(a){this._specie=a},getSpecie:function(){return this._specie},setBlind:function(a){this._blind=a},getBlind:function(){return this._blind},setAutonomous:function(a){this._autonomous=a},getAutonomous:function(){return this._autonomous},setParent:function(a){this._parent=a},getParent:function(){return this._parent},setSolution:function(a){this._solution=a},getSolution:function(){return this._solution},setDebugging:function(a){this._debugging=a},getDebugging:function(){return this._debugging},setId:function(a){this._id=a},getId:function(){return this._id},setIsSaveRestoreData:function(a){this._isSaveRestoreData=a},getIsSaveRestoreData:function(){return this._isSaveRestoreData},setDirectives:function(a){this._directives=a},getDirectives:function(){return this._directives;
},setStyle:function(a){this._style=a},getStyle:function(){return this._style},setPlotData:function(a){this._plotData=a},getPlotData:function(){return this._plotData},setParserData:function(a){this._parserData=a},getParserData:function(){return this._parserData},setError:function(a){this._error=a},getError:function(){return this._error},setPointsData:function(a){this._pointsData=a},getPointsData:function(){return this._pointsData},getCid:function(){return this.cid},setColor:function(a){this._style.setColor(a)},getColor:function(){return this._style.getColor()},setThickness:function(a){this._style.setThickness(a)},getThickness:function(){return this._style.getThickness()},setOpacity:function(a){this._style.setOpacity(a)},getOpacity:function(){return this._style.getOpacity()},setDashArray:function(a){this._style.setDashArray(a)},getDashArray:function(){return this._style.getDashArray()},setVisible:function(a){this._style.setVisible(a)},getVisible:function(){return this._style.getVisible()},setDraggable:function(a){this._plotData.setDraggable(a)},isDraggable:function(){return this._plotData.isDraggable()},setDragHitThickness:function(a){this._style.setDragHitThickness(a)},getDragHitThickness:function(){return this._style.getDragHitThickness()},getDragHitColor:function(){return this._style.getDragHitColor()},getDragHitAlpha:function(){return this._style.getDragHitAlpha()},getPointsGroup:function(){return this._plotData.getPointsGroup()},setPointsGroup:function(a){this._plotData.setPointsGroup(a)},setLabelData:function(a){this._plotData.setLabelData(a)},getLabelData:function(){return this._plotData.getLabelData()},getBannerData:function(){return this._plotData.getBannerData()},setBannerData:function(a){this._plotData.setBannerData(a)},getPathGroup:function(){return this._plotData.getPathGroup()},setPathGroup:function(a){this._plotData.setPathGroup(a)},getRaster:function(){return this._plotData.getRaster()},setRaster:function(a){this._plotData.setRaster(a)},getLeftArray:function(){return this._pointsData.getLeftArray()},setLeftArray:function(a){this._pointsData.setLeftArray(a)},getRightArray:function(){return this._pointsData.getRightArray()},setRightArray:function(a){this._pointsData.setRightArray(a)},getPoints:function(){return this._pointsData.getPoints()},setPoints:function(a){this._pointsData.setPoints(a)},getRayPolygon:function(){return this._plotData.getRayPolygon()},setRayPolygon:function(a){this._plotData.setRayPolygon(a)},setClosedPolygon:function(a){this._style.setClosedPolygon(a)},isClosedPolygon:function(){return this._style.isClosedPolygon()},setSmoothPolygon:function(a){this._style.setSmoothPolygon(a)},isSmoothPolygon:function(){return this._style.isSmoothPolygon()},getRhsAuto:function(){return this._analysis.getRhsAuto()},setRhsAuto:function(a){this._analysis.setRhsAuto(a)},getPlotSessionCount:function(){return this._plotData.getPlotSessionCount()},setPlotSessionCount:function(a){this._plotData.setPlotSessionCount(a)},getPointVisibility:function(){return this._style.getPointVisibility()},getCurveVisibility:function(){return this._style.getCurveVisibility()},setPointVisibility:function(a){this._style.setPointVisibility(a)},setCurveVisibility:function(a){this._style.setCurveVisibility(a)},getCriticalPoints:function(){return this._pointsData.getCriticalPoints()},setCriticalPoints:function(a){this._pointsData.setCriticalPoints(a)},getIntersectionPoints:function(){return this._pointsData.getIntersectionPoints()},setIntersectionPoints:function(a){this._pointsData.setIntersectionPoints(a)},setPrevLatex:function(a){this._prevLatex=a},getPrevLatex:function(){return this._prevLatex},flushAnalysis:function(){this._analysis.flush()},flushError:function(){this._error.flush()},flushParserData:function(){this._parserData.flush()},flushPlotData:function(){this._plotData.flush()},changePointsColor:function(a,b){this._style.setColor(a),b||this.trigger("change-points-color")},changeColor:function(a,b){this._style.setColor(a),b||this.trigger("change-color")},changeThickness:function(a,b){this._style.setThickness(a),this._style.setThicknessOnFocus(a+1),b||this.trigger("change-thickness")},changeVisibility:function(a){this.setVisible(a),this.trigger("change-visibility")},removePathGroup:function(){this._plotData.removePathGroup()},hideGraph:function(){var a,b,c=this.getPathGroup(),d=this.getPointsGroup(),e=this.getCriticalPoints();if(null!==c&&(c.visible=!1),null!==d){for(a=d.children.length,b=0;a>b;b++)d.children[b].visible=!1;d.visible=!1}if(null!==e&&null!==e.getPointsGroup()){for(d=e.getPointsGroup(),a=d.children.length,b=0;a>b;b++)d.children[b].visible=!1;d.visible=!1}this.setVisible(!1)},showGraph:function(){var a,b,c=this.getPathGroup(),d=this.getPointsGroup(),e=this.getCriticalPoints();if(this.setVisible(!0),null!==c&&(c.visible=!0),null!==d){for(b=d.children.length,a=0;b>a;a++)d.children[a].visible=!0;d.visible=!0}if(null!==e&&null!==e.getPointsGroup()){for(d=e.getPointsGroup(),b=d.children.length,a=0;b>a;a++)d.children[a].visible=!0;d.visible=!0}},toggleGraphView:function(){this.getCurveVisibility()?this.hideGraph():this.showGraph()},dashedGraph:function(){if("point"===this.getSpecie()){this.getPointsGroup();this.pointsGroup.strokeColor=this.getColor(),this.pointsGroup.fillColor="#ffffff"}else this.getPathGroup().dashArray=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationData.DASHED_ARRAY;this.setDashArray(a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationData.DASHED_ARRAY)},normalGraph:function(){if("point"===this.getSpecie()){this.getPointsGroup().fillColor=this.getColor();var a=this.getLabelData();a.labelObject&&(a.labelObject.fillColor=this.getColor())}else this.getPathGroup().dashArray=[];this.setDashArray([])},toggleDashedGraph:function(){0!==this.getDashArray().length?this.normalGraph():this.dashedGraph()},getData:function(){var a={};return a.equation=this.getLatex(),a.color=this.getColor(),a.thickness=this.getThickness(),a.styleType=this.styleType,a.visible=this.getVisible(),a.points=this.getPoints(),a},setData:function(a){this.setLatex(a.equation),this.setColor(a.color),this.setThickness(a.thickness),this.styleType=a.styleType,this.setVisible(a.visible),this.setPoints(a.points),this.isSaveRestoreData=!0,this.labelData={},this.labelData.text=a.labelText,this.labelData.position=a.position,this.labelData.visible=a.labelVisibility},removePlottedGraph:function(){this.pathGroup&&this.pathGroup.remove()},flushData:function(){delete this.A,delete this.B,delete this.C,delete this.errorCode,delete this.errorData,delete this.errorString,delete this.freeVars,delete this.functionVariable,delete this.isPolar,delete this.leftExpresstion,delete this.leftRoot,delete this.rightExpresstion,delete this.rightRoot,delete this.points,delete this.solution,delete this.type}},{DASHED_ARRAY:[10,4],minThickness:1,maxThickness:8}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.ParserAssist=Backbone.Model.extend({},{getEquationAccessibility:function(b){a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Productions.init();var c,d=new a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationData;return d.setLatex(b,!0),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.parseEquation(d),c=d.getAccText(),d=null,c}}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser=Backbone.Model.extend({},{_deploy:!0,_constants:{"\\pi":Math.PI,e:Math.E},_debugFlag:{tokens:!1,rules:!1,tree:!1,power:!1,simplify:!1,expand:!1,convert2q:!1,solve:!1,plot:!1,info:!1,common:!1,error:!1},_INVERSIBLE_FUNCTIONS:["\\sin^{-1}","\\cos^{-1}","\\tan^{-1}","\\cot^{-1}","\\csc^{-1}","\\sec^{-1}","\\sinh^{-1}","\\cosh^{-1}","\\tanh^{-1}","\\coth^{-1}","\\csch^{-1}","\\sech^{-1}"],_INVERT_FUNCTIONS_IN_ORDER:["\\arcsin","\\arccos","\\arctan","\\arccot","\\arccsc","\\arcsec","\\arsinh","\\arcosh","\\artanh","\\arcoth","\\arcsch","\\arsech"],_productions:a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Productions,_mathFunctions:a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.MathFunctions,_NSTYLE:"background: #c00; color: #fff",_HSTYLE:"background: #cc0; color: #fff",_BLUE_STYLE:"background: #004; color: #fff",_YSTYLE:"background: #0c0; color: #fff",_borderColor:"#C1C1C1",_isBlank:function(a){return void 0===a?!1:(a=a.trim(),""===a)},_preProcessLatexSumProduct:function(a,b,c,d,e,f,g){var h,i,j=0;for(h=0;h<a.length;h++)if(")"===a.charAt(h)){if(0===j){if("("===a.charAt(0)){b=a.substring(1,h-1);break}b=a.substring(0,h);break}j--}else"("===a.charAt(h)&&j++;return void 0===g||""===g?((-1!==e.indexOf(d)||-1!==f.indexOf(d))&&(i=!0),c+"{"+d+"}{"+e+"}{"+f+"}{"+b+"}"+a.substring(h,a.length)):((-1!==e.indexOf(d)||-1!==g.indexOf(d))&&(i=!0),c+"{"+d+"}{"+e+"}{"+g+"}{"+b+"}"+a.substring(h,a.length))},_preProcessSumProductCase:function(b,c){if(void 0!==b&&null!==b){var d,e,f,g,h,i,j,k=/(\\sum)|(\\prod)/g,l=/^[a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|z|A-Z]$/,m=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,n=!1,o=/(\\sum|\\prod)[\_][\{]([A-Za-z])[\=]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^\!]+)([\}])[\^]([0-9A-Za-z]|[\{](([\{][0-9a-zA-Z\+\_\.\-\\()\[\]\^\!][\}])+|[0-9a-zA-Z\+\_\.\-\\()\[\]\^\!]+)[\}])([\(]([0-9a-zA-Z\s\+\_\.\-\\{}()\[\]\^\!]+)[\)])/g,p=/(\\sum|\\prod)[\_][\{]([A-Za-z])[\=]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^\!]+)([\}])[\^]([0-9A-Za-z]|[\{](([\{][0-9a-zA-Z\+\_\.\-\\()\[\]\^][\}])+|[0-9a-zA-Z\+\_\.\-\\()\[\]\^\!]+)[\}])([0-9a-zA-Z\s\+\_\.\-\\{}()\[\]\^\!]+)/g,q=/(\\sum|\\prod)[\^]([0-9A-Za-z]|[\{](([\{][0-9a-zA-Z\+\_\.\-\\()\[\]\^\!][\}])+|[0-9a-zA-Z\+\_\.\-\\()\[\]\^\!]+)[\}])[\_][\{]([A-Za-z])[\=]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^\!]+)([\}])([\(]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^]+)[\)])[^\^]/g,r=/(\\sum|\\prod)[\^]([0-9A-Za-z]|[\{](([\{][0-9a-zA-Z\+\_\.\-\\()\[\]\^\!][\}])+|[0-9a-zA-Z\+\_\.\-\\()\[\]\^\!]+)[\}])[\_][\{]([A-Za-z])[\=]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^\!]+)([\}])([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^]+)/g,s=function(a,b,f,g,h,i,j,k,l,n){return n=null,c.setPivot(f),d=l,e=d.substring(1,d.length-1),m.Parser._preProcessLatexSumProduct(d,e,b,f,g,i,j)},t=function(a,b,f,g,h,i,j,k,l){return c.setPivot(f),d=l,e=d,m.Parser._preProcessLatexSumProduct(d,e,b,f,g,i,j)},u=function(a,b,f,g,h,i,j,k,l,n){return c.setPivot(i),d=n,e=d.substring(0,d.length),m.Parser._preProcessLatexSumProduct(d,e,b,i,j,f,g)},v=function(a,b,f,g,h,i,j,k,l){return c.setPivot(i),d=l,e=d.substring(0,d.length),m.Parser._preProcessLatexSumProduct(d,e,b,i,j,f,g)};for(g=null!==b.match(k)?b.match(k).length:0,f=0;g>f;f++)b=b.replace(o,s),b=b.replace(p,t),b=b.replace(q,u),b=b.replace(r,v);if(n)return c.setCanBeSolved(!1),void c.setErrorCode("CannotUnderstandThis");if(null===c.getPivot()&&(h=b.indexOf("\\sum"),-1!==h?(j="\\sum",j=j.length):(h=b.indexOf("\\prod"),-1!==h&&(j="\\prod",j=j.length+1)),-1!==h))for(i=b.length,f=h+j;i>f;f++)if(null!==b.charAt(f).match(l)&&"="===b.charAt(f+1)){c.setPivot(b.charAt(f));break}return b}},_checkSumProductCase:function(b,c){var d,e,f,g,h=b.length,i=!1,j=!1,k=!1,l=!1,m=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,n=0,o="",p="",q=!1,r=!1,s="",t="",u="";for(d=0;h>d;d++)if(e=b.charAt(d),i===!0)if(0===n&&r===!1&&"_"===e)j=!0,k=!1;else if(0===n&&q===!1&&"^"===e)j=!1,k=!0;else if(m.ParsingProcedures._isOpeningBracket(e)?n++:m.ParsingProcedures._isClosingBracket(e)&&n--,j===!0)o+=e,0===n&&(r=!0,j=!1);else if(k===!0)p+=e,0===n&&(q=!0,k=!1);else{if(0===n&&"+"===e){i=!1,l=!1,s=e;continue}if(-1===n){i=d===h-1?!0:!1,l=!1,s=e;continue}if(t+=e,f=t.lastIndexOf("\\sum"),-1!==f&&f===t.length-4)return c.setCanBeSolved(!1),void c.setErrorCode("CannotUnderstandThis");if(g=t.lastIndexOf("\\prod"),-1!==g&&g===t.length-5)return c.setCanBeSolved(!1),void c.setErrorCode("CannotUnderstandThis")}else""!==t&&(u+=m.Parser._prepareSumProductLatex(p,o,t,c),t="",o="",p="",j=!1,q=!1,r=!1,k=!1,n=0),""!==s&&(u+=s,s=""),u+=e,l===!1&&m.Parser._checkSumProductCondition(u)&&(i=!0,l=!0);return i===!0&&(u+=m.Parser._prepareSumProductLatex(p,o,t,c),""!==s&&(u+=s,s="")),u},_checkSumProductCondition:function(a){var b=a.lastIndexOf("\\sum"),c=a.lastIndexOf("\\prod"),d=a.length;return-1===b&&-1===c?!1:-1!==b&&b===d-4?!0:-1!==c&&c===d-5?!0:!1},_prepareSumProductLatex:function(a,b,c,d){var e,f="";return"{"===b.charAt(0)&&(b=b.substring(1,b.length-1)),e=b.split("="),f+="{"+e[0]+"}{"+e[1]+"}",d.setPivot(e[0]),"{"===a.charAt(0)&&(a=a.substring(1,a.length-1)),f+="{"+a+"}",f+="{"+c+"}",-1!==e[1].indexOf(d.getPivot())||-1!==a.indexOf(d.getPivot())?(d.setCanBeSolved(!1),void d.setErrorCode("CannotUnderstandThis")):f},parseEquation:function(b){if(!b.getBlind()){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=b.getDirectives(),I=b.getProfiles();if(c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,c.Parser._deploy||paper.install(window),b.setSpecie("error"),b.setRange(null),b.setSolution(null),b.flushError(),b.flushAnalysis(),b.flushParserData(),b.setCanBeSolved(!0),c.Parser._isBlank(b.getLatex()))return b.setCanBeSolved(!1),b.setSpecie("error"),b.setErrorCode("Blank"),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if(B=b.getLeftExpression(),C=b.getRightExpression(),d=b.getLatex(),c.Parser._showConsole(c.Parser._debugFlag.common,"Processing equation "+d,[]),d=d.replace(/\\space/gi,""),d=d.replace(/\\left/gi,""),d=d.replace(/\\right/gi,""),d=d.replace(/\\:/gi,""),d=d.replace(/\$/gi,""),d=d.replace(/\s/gi,""),d=d.replace(/\\cdot/gi,"\\cdot "),d=d.replace(/\\pi/gi,"\\pi "),d=d.replace(/\\le/gi,"\\le "),d=d.replace(/\\ge/gi,"\\ge "),d=d.replace(/\\theta/gi,"\\theta "),d=c.Parser._splitRangeFromSolution(d,b),b.isCanBeSolved()!==!1){if(d=c.Parser._checkSumProductCase(d,b),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured in sum pivot case",["#ff0000"]);if(c.Parser._preProcessLatexForErrors(d,b),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured in syntax of latex",["#ff0000"]);if(e=/(.*?)(=|<|>|\\le|\\ge)(.*)/gi,f=e.exec(d),c.Parser._showConsole(c.Parser._debugFlag.common,d,[]),null===f)b.setInEqualityType("="),B.expression=d,c.Parser._showConsole(c.Parser._debugFlag.common,"Eqaution is an expression",[]);else{if(""===f[1]||""===f[3])return""===f[3]?(B.expression=f[1],c.Parser._preProcessExpression(B),c.Parser._parseExpression(B,b)):(C.expression=f[3],c.Parser._preProcessExpression(C),c.Parser._parseExpression(C,b)),b.setCanBeSolved(!1),void b.setErrorCode("CannotUnderstandThis");b.setInEqualityType(f[2]),B.expression=f[1],C.expression=f[3]}if(c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("leftPreProcess"),c.Parser._preProcessExpression(B),c.Parser._deploy||(I[0]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("leftPreProcess"),D=$("#pre-process-latex-left"),E=$("<div></div>"),D.append(E),E.attr("id","left-preprocess-latex-expression").append(B.expression).css({border:"1px solid","border-color":c.Parser._borderColor,padding:"5px 5px 5px 5px"}),D.parent().css({border:"1px solid black"})),c.Parser._showConsole(c.Parser._debugFlag.tokens,"Left expression after preprocessing :: ",[]),c.Parser._showConsole(c.Parser._debugFlag.tokens,B,[]),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("leftTokenGeneration"),c.Parser._parseExpression(B,b),c.Parser._deploy||(A=b.getLeftEquationParameters(),c.Parser._displayArrayOfObjects(A.operatorsList,"operators-display-container-left","#777700","white"),c.Parser._displayArrayOfObjects(A.constantsList,"constants-display-container-left","#777700","white"),c.Parser._displayArrayOfObjects(A.variablesList,"variables-display-container-left","#777700","white"),c.Parser._displayArrayOfObjects(A.digitsList,"digits-display-container-left","#777700","white"),c.Parser._displayArrayOfObjects(A.functionsList,"functions-display-container-left","#777700","white")),c.Parser._deploy||(I[1]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("leftTokenGeneration")),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if("point"!==b.getSpecie()){if(c.Parser._displayArrayOfObjects(B.tokens,"tokens-display-container-left","#777700","white"),null===C.expression)if(3===B.tokens.length){if("digit"===B.tokens[1].type&&"("===B.tokens[0].value&&")"===B.tokens[2].value)return b.setSpecie("number"),void("-"===B.tokens[1].sign?b.setSolution(-1*Number(B.tokens[1].value)):b.setSolution(Number(B.tokens[1].value)))}else if(1===B.tokens.length&&"digit"===B.tokens[0].type)return b.setSpecie("number"),"-"===B.tokens[0].sign?(b.setAccText("-"+c.TreeProcedures._getAccessibleStringForNumber(B.tokens[0].value)),b.setSolution(-1*Number(B.tokens[0].value))):(b.setAccText(c.TreeProcedures._getAccessibleStringForNumber(B.tokens[0].value)),b.setSolution(Number(B.tokens[0].value))),void $("#accessibility-display").html("The Accesibility string is "+b.getAccText());g=[],h=null;for(h in B.freevars)-1===g.indexOf(h)&&g.push(h);if(null!==C.expression){if(b.setRhsAuto(!1),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightPreProcess"),c.Parser._preProcessExpression(C),c.Parser._deploy||(I[0]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightPreProcess")),c.Parser._showConsole(c.Parser._debugFlag.tokens,"right expression after preprocessing :: ",[]),c.Parser._showConsole(c.Parser._debugFlag.tokens,C,[]),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightTokenGeneration"),c.Parser._parseExpression(C,b),c.Parser._deploy||(I[1]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightTokenGeneration")),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);h=null;for(h in C.freevars)-1===g.indexOf(h)&&g.push(h)}else{if(0===g.length)b.setRhsAuto(!0),C.expression="0";else{if(1!==g.length)return b.setCanBeSolved(!1),b.setErrorCode("Cant understand this"),b.setErrorString("Complicated"),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if("x"!==g[0])return b.setCanBeSolved(!1),b.setErrorCode("Complicated"),b.setErrorString("Cant understand this"),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);g.push("y"),b.setRhsAuto(!0),C.expression="y"}if(c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightPreProcess"),c.Parser._preProcessExpression(C),c.Parser._deploy||(I[0]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightPreProcess"),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightTokenGeneration")),c.Parser._parseExpression(C,b),c.Parser._deploy||(I[1]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightTokenGeneration")),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"])}if("graphing"===H.FDFlagMethod&&c.Parser._getFracDecAnalysis(b),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if(c.Parser._deploy||(F=$("#pre-process-latex-right"),G=$("<div></div>"),F.append(G),G.attr("id","right-preprocess-latex-expression").append(C.expression).css({border:"1px solid","border-color":c.Parser._borderColor,padding:"5px 5px 5px 5px"})),r=-1!==g.indexOf("r"),s=-1!==g.indexOf("x")||-1!==g.indexOf("y"),t=[],r&&s){for(u=0,v=g.length,u;v>u;u++)"r"!==g[u]&&t.push(g[u]);for(g=t,x=0,y=B.tokens.length,z=null,x;y>x;x++)z=B.tokens[x],"r"===z.value&&(z.type="const");for(y=C.tokens.length,x=0;y>x;x++)z=C.tokens[x],"r"===z.value&&(z.type="const")}if(c.Parser._displayArrayOfObjects(C.tokens,"tokens-display-container-right","#777700","white"),g.length>2&&(b.setCanBeSolved(!1),b.setErrorCode("MoreFreeVariables"),b.setErrorString(c.EquationEnums.ERROR_TOO_MANY_FREE_VARIABLES),c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"])),c.Parser._showConsole(c.Parser._debugFlag.common,"%c[READY]Final equation is "+b,[c.Parser._YSTYLE]),c.Parser._showConsole(c.Parser._debugFlag.common,b,[]),i=!1,null===b.getConstants()&&(i=!0),c.Parser._checkIfOnlyNumbersAndConstantsPresent(b),b.isCanBeSolved()!==!1){if(c.Parser._substituteConstants(B,b,i),c.Parser._substituteConstants(C,b,i),!b.isCanBeSolved())return this._mergeConstantsErrorData(b),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if(c.Parser._printTokens(B,"Left expression "),c.Parser._printTokens(C,"Right expression "),c.Parser._showConsole(c.Parser._debugFlag.common,"%c[STAGE1 - Success]Token Generation Complete",[c.Parser._YSTYLE]),$("#production-rules-display").html(""),$.isEmptyObject(B.freevars)&&$.isEmptyObject(C.freevars)&&b.setSpecie("expression"),c.Parser._generateAnalysis(b),b.isCanBeSolved()===!1)return b.setSpecie("error"),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if("expression"===b.getSpecie())return c.Parser._showConsole(c.Parser._debugFlag.common,"The equation is solved",[]),void c.Parser._showConsole(c.Parser._debugFlag.common,b.getSolution(),[]);if(c.Parser._calculateMaxPowerOfVariable(b),b.isCanBeSolved()===!1)return b.setSpecie("error"),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);j=[],k=null,w=b.getFreeVars(),l=0;for(k in w)l++,c.Parser._showConsole(c.Parser._debugFlag.common,"checking complexity of freevar "+k+">> "+w[k],[]),"number"==typeof w[k]&&w[k]<=2&&j.push(k);if(1===l){if(0===j.length)return b.setCanBeSolved(!1),b.setErrorCode("Complicated"),c.Parser._showConsole(c.Parser._debugFlag.error,"%c ERROR: complicated equation. Cant solve"),void b.setSpecie("error");c.Parser._showConsole(c.Parser._debugFlag.info,"%c INFO %c: Equation will yield solutions",[c.Parser._BLUE_STYLE,void 0]),w[j[0]]>1?b.setSpecie("quadratic"):(b.setSpecie("linear"),(1===w.x||1===w.y)&&b.setSpecie("plot"))}else b.setSpecie("plot");if(j.length<=2){for(o=!1,p=0,q=j.length,p;q>p;p++)c.Parser._showConsole(c.Parser._debugFlag.common,c.Parser._getFunctionVariablePrecedenceIndex(n)+">>"+c.Parser._getFunctionVariablePrecedenceIndex(j[p]),[]),o=void 0===n?!0:c.Parser._getFunctionVariablePrecedenceIndex(n)<c.Parser._getFunctionVariablePrecedenceIndex(j[p])?!0:!1,o===!0&&(n=j[p]);b.setFunctionVariable(n),m=b.getRange(),j.length>1&&null!==m&&-1!==j.indexOf(m.variable)&&("y"===m.variable?(n="x",b.setFunctionVariable(n)):(n="y",b.setFunctionVariable(n))),"y"===n?b.setParamVariable("x"):b.setParamVariable("y"),null!==m&&b.getParamVariable()!==m.variable&&(b.setCanBeSolved(!1),b.setErrorCode("ComplicatedRange")),c.Parser._showConsole(c.Parser._debugFlag.common,"%c[STAGE5 - SUCCESS] Chosen function variable is "+n,[c.Parser._YSTYLE])}else b.setCanBeSolved(!1),b.setErrorCode("MoreFreeVariables"),b.setErrorString(c.EquationEnums.ERROR_TOO_MANY_FREE_VARIABLES),c.Parser._showConsole(c.Parser._debugFlag.error,"%c[STAGE5 - FAIL]TOO many free variables...it should NOT have been be detected so late",[c.Parser._NSTYLE])}}}}},processTokensWithRules:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,d=b.getLeftExpression(),e=b.getRightExpression(),f=d.tokens,g=e.tokens,h=(b.getUnits(),b.getProfiles());b.getDirectives();return c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("leftProductionRules"),d.validPredictionStack=c.Parser._recursiveDescentParser(b,f,0,0,[void 0],!1),c.Parser._deploy||(h[2]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("leftProductionRules")),b.isCanBeSolved()!==!1&&(c.Parser._displayArrayOfObjects(d.validPredictionStack,"production-rules-display-left","#777700","white"),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightProductionRules"),e.validPredictionStack=c.Parser._recursiveDescentParser(b,g,0,0,[void 0],!1),c.Parser._deploy||(h[2]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightProductionRules")),b.isCanBeSolved()!==!1)?(c.Parser._displayArrayOfObjects(e.validPredictionStack,"production-rules-display-right","#777700","white"),void 0===d.validPredictionStack||void 0===e.validPredictionStack?(b.setCanBeSolved(!1),b.setErrorCode("CannotUnderstandThis"),void c.Parser._showConsole(c.Parser._debugFlag.common,"%c[STAGE2 - FAIL]Left Prediction Rules Failed",[c.Parser._NSTYLE])):void c.Parser._showConsole(c.Parser._debugFlag.common,"%c[STAGE2 - Success]Prediction rules Generated Left:"+d.validPredictionStack,[c.Parser._YSTYLE])):void 0},generateTreeFromRules:function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,p=b.getLeftExpression(),q=b.getRightExpression(),r=(p.tokens,q.tokens,b.getUnits()),s=b.getDirectives(),t=b.getProfiles();o.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("generateTree"),b.setLeftRoot(o.TreeProcedures.generateTree(p.validPredictionStack,0,r)),b.setRightRoot(o.TreeProcedures.generateTree(q.validPredictionStack,0,r)),o.Parser._deploy||(t[3]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("generateTree")),d=b.getLeftRoot(),e=b.getRightRoot();var u=o.TreeProcedures._toAccessible(d).expression;if(b.getRhsAuto()!==!0&&(u+=" equal to "+o.TreeProcedures._toAccessible(e).expression),b.setAccText(u),$("#accessibility-display").html("The Accesibility string is "+u),"graphing"===s.FDFlagMethod&&"frac"===b.getFdFlag()&&("\\frac"===d.name||"do"===d.name&&"\\frac"===d.params[0].name)&&(b.setFdFlag("decimal"),"do"===d.name?o.Parser._checkIfFracHasNonFracChilds(d.params[0],b):o.Parser._checkIfFracHasNonFracChilds(d,b)),"calculator"===s.FDFlagMethod&&b.setFdFlag(0===o.Parser._getAnalysisForFD(d)?"frac":"decimal"),o.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("simplify"),d.isTerminal||d.simplify(b),e&&!e.isTerminal&&e.simplify(b),o.Parser._deploy||(t[4]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("simplify")),d.isTerminal&&"digit"===d.type&&null!==e&&!b.getRhsAuto()&&e.isTerminal&&"digit"===e.type)return b.setCanBeSolved(!1),b.setErrorString("Try adding some free variables"),void b.setErrorCode("CannotUnderstandThis");if(o.Parser._showConsole(o.Parser._debugFlag.common,"%c[STAGE4 - SUCCESS]Tree Simplified",[o.Parser._YSTYLE]),o.Parser._deploy||o.Parser._printLatex(d,4,!0),"expression"!==b.getSpecie()&&o.TreeProcedures.combineLeftRightTree(b),c=d,void 0===d)return b.setCanBeSolved(!1),b.setErrorCode("CannotUnderstandThis"),void o.Parser._showConsole(o.Parser._debugFlag.common,"%c[STAGE3 - FAIL]Left Equation Tree Generation Failed",[o.Parser._NSTYLE]);if(o.Parser._showConsole(o.Parser._debugFlag.common,"%c[STAGE3 - Success]Equation Tree Generated",[o.Parser._YSTYLE]),o.Parser._deploy||o.Parser._printLatex(c,3,!0),"expression"===b.getSpecie()&&b.setSolution(o.TreeProcedures._substituteParamVariableAndGetValue(b.getLeftRoot(),b.getConstants())),o.Parser._deploy||o.TreeProcedures._toLatex(c),b.isCanBeSolved()===!1)return b.setSpecie("error"),void o.Parser._showConsole(o.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if("expression"===b.getSpecie())return o.Parser._showConsole(o.Parser._debugFlag.common,"The equation is solved",[]),void o.Parser._showConsole(o.Parser._debugFlag.common,b.getSolution(),[]);if(o.Parser._calculateMaxPowerOfVariable(b),b.isCanBeSolved()===!1)return b.setSpecie("error"),void o.Parser._showConsole(o.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);f=[],g=null,n=b.getFreeVars(),h=0;for(g in n)h++,o.Parser._showConsole(o.Parser._debugFlag.common,"checking complexity of freevar "+g+">> "+n[g],[]),"number"==typeof n[g]&&n[g]<=2&&f.push(g);if(1===h){if(0===f.length)return b.setCanBeSolved(!1),b.setErrorCode("Complicated"),o.Parser._showConsole(o.Parser._debugFlag.error,"%c ERROR: complicated equation. Cant solve"),void b.setSpecie("error");o.Parser._showConsole(o.Parser._debugFlag.info,"%c INFO %c: Equation will yield solutions",[o.Parser._BLUE_STYLE,void 0]),n[f[0]]>1?b.setSpecie("quadratic"):(b.setSpecie("linear"),(1===n.x||1===n.y)&&b.setSpecie("plot"))}else b.setSpecie("plot");if(f.length<=2){for(k=!1,l=0,m=f.length,l;m>l;l++)o.Parser._showConsole(o.Parser._debugFlag.common,o.Parser._getFunctionVariablePrecedenceIndex(j)+">>"+o.Parser._getFunctionVariablePrecedenceIndex(f[l]),[]),k=void 0===j?!0:o.Parser._getFunctionVariablePrecedenceIndex(j)<o.Parser._getFunctionVariablePrecedenceIndex(f[l])?!0:!1,k===!0&&(j=f[l]);b.setFunctionVariable(j),i=b.getRange(),f.length>1&&null!==i&&-1!==f.indexOf(i.variable)&&("y"===i.variable?(j="x",b.setFunctionVariable(j)):(j="y",b.setFunctionVariable(j))),"y"===j?b.setParamVariable("x"):b.setParamVariable("y"),null!==i&&b.getParamVariable()!==i.variable&&(b.setCanBeSolved(!1),b.setErrorCode("ComplicatedRange")),o.Parser._showConsole(o.Parser._debugFlag.common,"%c[STAGE5 - SUCCESS] Chosen function variable is "+j,[o.Parser._YSTYLE])}else b.setCanBeSolved(!1),b.setErrorCode("MoreFreeVariables"),b.setErrorString(o.EquationEnums.ERROR_TOO_MANY_FREE_VARIABLES),o.Parser._showConsole(o.Parser._debugFlag.error,"%c[STAGE5 - FAIL]TOO many free variables...it should NOT have been be detected so late",[o.Parser._NSTYLE])},parseEquationToGetTokens:function(b){if(!b.getBlind()){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=b.getDirectives(),z=b.getProfiles();if(c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,c.Parser._deploy||paper.install(window),b.setSpecie("error"),b.setRange(null),b.setSolution(null),b.flushError(),b.flushAnalysis(),b.flushParserData(),b.setCanBeSolved(!0),c.Parser._isBlank(b.getLatex()))return b.setCanBeSolved(!1),b.setSpecie("error"),b.setErrorCode("Blank"),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if(s=b.getLeftExpression(),t=b.getRightExpression(),d=b.getLatex(),c.Parser._showConsole(c.Parser._debugFlag.common,"Processing equation "+d,[]),d=d.replace(/\\space/gi,""),d=d.replace(/\\left/gi,""),d=d.replace(/\\right/gi,""),d=d.replace(/\\:/gi,""),d=d.replace(/\$/gi,""),d=d.replace(/\s/gi,""),d=d.replace(/\\cdot/gi,"\\cdot "),d=d.replace(/\\pi/gi,"\\pi "),d=d.replace(/\\le/gi,"\\le "),d=d.replace(/\\ge/gi,"\\ge "),d=d.replace(/\\theta/gi,"\\theta "),d=c.Parser._splitRangeFromSolution(d,b),b.isCanBeSolved()!==!1){if(d=c.Parser._checkSumProductCase(d,b),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured in sum pivot case",["#ff0000"]);if(c.Parser._preProcessLatexForErrors(d,b),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured in syntax of latex",["#ff0000"]);if(e=/(.*?)(=|<|>|\\le|\\ge)(.*)/gi,f=e.exec(d),c.Parser._showConsole(c.Parser._debugFlag.common,d,[]),null===f)b.setInEqualityType("="),s.expression=d,c.Parser._showConsole(c.Parser._debugFlag.common,"Eqaution is an expression",[]);else{if(""===f[1]||""===f[3])return""===f[3]?(s.expression=f[1],c.Parser._preProcessExpression(s),c.Parser._parseExpression(s,b)):(t.expression=f[3],c.Parser._preProcessExpression(t),c.Parser._parseExpression(t,b)),b.setCanBeSolved(!1),void b.setErrorCode("CannotUnderstandThis");b.setInEqualityType(f[2]),s.expression=f[1],t.expression=f[3]}if(c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("leftPreProcess"),
c.Parser._preProcessExpression(s),c.Parser._deploy||(z[0]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("leftPreProcess"),u=$("#pre-process-latex-left"),v=$("<div></div>"),u.append(v),v.attr("id","left-preprocess-latex-expression").append(s.expression).css({border:"1px solid","border-color":c.Parser._borderColor,padding:"5px 5px 5px 5px"}),u.parent().css({border:"1px solid black"})),c.Parser._showConsole(c.Parser._debugFlag.tokens,"Left expression after preprocessing :: ",[]),c.Parser._showConsole(c.Parser._debugFlag.tokens,s,[]),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("leftTokenGeneration"),c.Parser._parseExpression(s,b),c.Parser._deploy||(r=b.getLeftEquationParameters(),c.Parser._displayArrayOfObjects(r.operatorsList,"operators-display-container-left","#777700","white"),c.Parser._displayArrayOfObjects(r.constantsList,"constants-display-container-left","#777700","white"),c.Parser._displayArrayOfObjects(r.variablesList,"variables-display-container-left","#777700","white"),c.Parser._displayArrayOfObjects(r.digitsList,"digits-display-container-left","#777700","white"),c.Parser._displayArrayOfObjects(r.functionsList,"functions-display-container-left","#777700","white")),c.Parser._deploy||(z[1]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("leftTokenGeneration")),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if("point"!==b.getSpecie()){if(c.Parser._displayArrayOfObjects(s.tokens,"tokens-display-container-left","#777700","white"),null===t.expression)if(3===s.tokens.length){if("digit"===s.tokens[1].type&&"("===s.tokens[0].value&&")"===s.tokens[2].value)return b.setSpecie("number"),void("-"===s.tokens[1].sign?b.setSolution(-1*Number(s.tokens[1].value)):b.setSolution(Number(s.tokens[1].value)))}else if(1===s.tokens.length&&"digit"===s.tokens[0].type)return b.setSpecie("number"),"-"===s.tokens[0].sign?(b.setAccText(c.TreeProcedures.OPERATOR_TEXT.NEGATIVE+" "+c.TreeProcedures._getAccessibleStringForNumber(s.tokens[0].value)),b.setSolution(-1*Number(s.tokens[0].value))):(b.setAccText(c.TreeProcedures._getAccessibleStringForNumber(s.tokens[0].value)),b.setSolution(Number(s.tokens[0].value))),void $("#accessibility-display").html("The Accesibility string is "+b.getAccText());g=[],h=null;for(h in s.freevars)-1===g.indexOf(h)&&g.push(h);if(null!==t.expression){if(b.setRhsAuto(!1),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightPreProcess"),c.Parser._preProcessExpression(t),c.Parser._deploy||(z[0]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightPreProcess")),c.Parser._showConsole(c.Parser._debugFlag.tokens,"right expression after preprocessing :: ",[]),c.Parser._showConsole(c.Parser._debugFlag.tokens,t,[]),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightTokenGeneration"),c.Parser._parseExpression(t,b),c.Parser._deploy||(z[1]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightTokenGeneration")),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);h=null;for(h in t.freevars)-1===g.indexOf(h)&&g.push(h)}else{if(0===g.length)b.setRhsAuto(!0),t.expression="0";else{if(1!==g.length)return b.setCanBeSolved(!1),b.setErrorCode("Cant understand this"),b.setErrorString("Complicated"),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if("x"!==g[0])return b.setCanBeSolved(!1),b.setErrorCode("Complicated"),b.setErrorString("Cant understand this"),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);g.push("y"),b.setRhsAuto(!0),t.expression="y"}if(c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightPreProcess"),c.Parser._preProcessExpression(t),c.Parser._deploy||(z[0]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightPreProcess"),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightTokenGeneration")),c.Parser._parseExpression(t,b),c.Parser._deploy||(z[1]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightTokenGeneration")),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"])}if("graphing"===y.FDFlagMethod&&c.Parser._getFracDecAnalysis(b),b.isCanBeSolved()===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if(c.Parser._deploy||(w=$("#pre-process-latex-right"),x=$("<div></div>"),w.append(x),x.attr("id","right-preprocess-latex-expression").append(t.expression).css({border:"1px solid","border-color":c.Parser._borderColor,padding:"5px 5px 5px 5px"})),j=-1!==g.indexOf("r"),k=-1!==g.indexOf("x")||-1!==g.indexOf("y"),l=[],j&&k){for(m=0,n=g.length,m;n>m;m++)"r"!==g[m]&&l.push(g[m]);for(g=l,o=0,p=s.tokens.length,q=null,o;p>o;o++)q=s.tokens[o],"r"===q.value&&(q.type="const");for(p=t.tokens.length,o=0;p>o;o++)q=t.tokens[o],"r"===q.value&&(q.type="const")}if(c.Parser._displayArrayOfObjects(t.tokens,"tokens-display-container-right","#777700","white"),g.length>2&&(b.setCanBeSolved(!1),b.setErrorCode("MoreFreeVariables"),b.setErrorString(c.EquationEnums.ERROR_TOO_MANY_FREE_VARIABLES),c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"])),c.Parser._showConsole(c.Parser._debugFlag.common,"%c[READY]Final equation is "+b,[c.Parser._YSTYLE]),c.Parser._showConsole(c.Parser._debugFlag.common,b,[]),i=!1,null===b.getConstants()&&(i=!0),c.Parser._checkIfOnlyNumbersAndConstantsPresent(b),b.isCanBeSolved()!==!1){if(c.Parser._substituteConstants(s,b,i),c.Parser._substituteConstants(t,b,i),!b.isCanBeSolved())return this._mergeConstantsErrorData(b),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);c.Parser._printTokens(s,"Left expression "),c.Parser._printTokens(t,"Right expression "),c.Parser._showConsole(c.Parser._debugFlag.common,"%c[STAGE1 - Success]Token Generation Complete",[c.Parser._YSTYLE]),$("#production-rules-display").html(""),$.isEmptyObject(s.freevars)&&$.isEmptyObject(t.freevars)&&b.setSpecie("expression")}}}}},_checkIfOnlyNumbersAndConstantsPresent:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,f=b.getLeftExpression(),g=b.getRightExpression();c=e.Parser._containsOnlyNumbersAndConstants(f.tokens),d=e.Parser._containsOnlyNumbersAndConstants(g.tokens),c===!0&&d===!0&&-1!==b.getLatex().indexOf("=")&&(b.setCanBeSolved(!1),e.Parser._substituteConstants(f,b,!1),e.Parser._substituteConstants(g,b,!1),this._mergeConstantsErrorData(b),b.setErrorCode("OnlyNumbers"))},_getFracDecAnalysis:function(b){var c,d,e,f=b.getLeftExpression(),g=b.getRightExpression(),h=function(d){var e,f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,h=["\\pi","e","x","y"],i=1,j=[],k=!1,l="Syntax Error in FracDec",m=d.length,n=!1;if(void 0!==d&&0!==m){if(2>m)return void c(d);if("\\fracdec"!==d[0].value){for(e=0;m>e;e++)if(f=d[e],"\\fracdec"!==f.value){if(g.ParsingProcedures._isValidBracket(f.value))n&&g.ParsingProcedures.recordBracket(j,f.value);else if(j.length>0&&-1!==h.indexOf(f.value))return b.setCanBeSolved(!1),b.setErrorString(l),void b.setErrorCode("FracDecError")}else n=!0;return"decimal"}for(;m>i;){if(1===i&&!g.ParsingProcedures._isValidBracket(d[i].value)){k=!0;break}if(g.ParsingProcedures.recordBracket(j,d[i].value),-1!==h.indexOf(d[i].value)){k=!0,l="No  or e allowed in fracdec";break}if(i++,0===j.length)break}return k=k?k:j.length>0?l="No  or e allowed in fracdec":!1,k?(b.setCanBeSolved(!1),b.setErrorString(l),void b.setErrorCode("FracDecError")):i<d.length?"decimal":"frac"}};c=function(a){var c=0;if(a)for(;c<a.length;)if("\\fracdec"!==a[c].value)c++;else{if(a.length>c+1){if("("!==a[c+1].value)return b.setCanBeSolved(!1),void b.setErrorCode("CannotUnderstandThis");a[c+1].sign=a[c].sign}a.splice(c,1)}},d=h(f.tokens),"frac"===d&&g&&g.tokens&&(e=h(g.tokens)),c(f.tokens),c(g.tokens),b.setFdFlag(e?e:d)},_mergeConstantsErrorData:function(a){var b,c,d,e,f=a.getLeftExpression(),g=a.getRightExpression();if(a.setErrorData([]),d=a.getErrorData(),void 0!==f.errorData)for(b=0,c=f.errorData.length,b;c>b;b++)e=f.errorData[b],-1===d.indexOf(e)&&d.push(e);if(void 0!==g.errorData)for(b=0,c=g.errorData.length,b;c>b;b++)e=g.errorData[b],-1===d.indexOf(e)&&d.push(e)},_containsOnlyNumbersAndConstants:function(a){var b,c,d=a.length,e=!0;for(b=0;d>b;b++)if(c=a[b],"digit"!==c.type&&"opr"!==c.type){if("const"!==c.type){e=!1;break}if("e"===c.value||"\\pi"===c.value){e=!1;break}}return e},_isCommaFunction:function(a){var b=["\\lcm","\\gcd","\\min","\\nPr","\\nCr","\\mod"];return-1!==b.indexOf(a)},_parseAndSetRange:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return b.length<2?(c.setCanBeSolved(!1),void c.setErrorCode("ComplicatedRange")):(e.RangeProductionRules.generateRules(),d=e.Parser._recursiveDescentParser(c,b,0,0,[void 0],!0),void 0===d&&c.setCanBeSolved(!1),c.isCanBeSolved()===!1?void c.setErrorCode("ComplicatedRange"):void c.setRange(e.Parser._setRangeFromSequenceString(d,b,c)))},_setRangeFromSequenceString:function(b,c,d){var e,f,g,h,i,j,k=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,l={min:null,max:null,variable:null};return e=k.RangeProductionRules.solution[b[0]],f=e.split(" "),g=f.length,2===g?(-1===f[0].indexOf("var")?(l.variable=f[1],h=f[0],i=-1!==f[0].indexOf("min")):(l.variable=f[0],h=f[1],i=-1!==f[1].indexOf("min")),i?l.min=k.Parser._createMinMaxObject(h,c):l.max=k.Parser._createMinMaxObject(h,c)):(l.variable=f[1],-1!==f[0].indexOf("min")?(l.min=k.Parser._createMinMaxObject(f[0],c),l.max=k.Parser._createMinMaxObject(f[2],c)):(l.min=k.Parser._createMinMaxObject(f[2],c),l.max=k.Parser._createMinMaxObject(f[0],c)),l.min.value>=l.max.value&&d.setCanBeSolved(!1)),j=l.variable.split("."),l.variable=c[Number(j[j.length-1])].value,l},_createMinMaxObject:function(a,b){var c,d,e={include:-1!==a.indexOf("equal"),value:null};return c=a.split("."),d=b[c[c.length-1]],e.value=Number(d.value),"-"===d.sign&&(e.value*=-1),e},_splitRangeFromSolution:function(b,c){var d,e=/(\\\})/,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,g=b.split("\\{");if(g[1]){if(g[1].indexOf("\\}")!==g[1].length-2||b.indexOf("\\}")!==b.length-2)return c.setCanBeSolved(!1),void c.setErrorCode("CannotUnderstandThis");if(g[1]=g[1].replace(e,""),d=f.Parser._generateTokens(g[1],c),c.isCanBeSolved()===!1)return;f.Parser._parseAndSetRange(d,c)}return""===g[0]&&(c.setCanBeSolved(!1),c.setErrorCode("CannotUnderstandThis")),g[0]},_preProcessLatexForErrors:function(a,b){var c,d,e,f,g,h=/[\\a-zA-Z0-9]*[\^][a-zA-Z0-9](([0-9]+)|([\.]))/g;if(-1!==a.indexOf("---"))return b.setCanBeSolved(!1),void b.setErrorCode("CannotUnderstandThis");if(c=a.match(h),null!==c)for(e=c.length,g=/\\[a-zA-Z0-9]+[\^][a-zA-Z0-9][0-9]+(([\.]?[0-9])*)/g,d=0;e>d;d++)if(f=g.exec(c[d]),null===f)return b.setCanBeSolved(!1),void b.setErrorCode("CannotUnderstandThis");return-1!==a.indexOf("!!")?(b.setCanBeSolved(!1),void b.setErrorCode("CannotUnderstandThis")):void 0},_getFunctionVariablePrecedenceIndex:function(a){switch(a){case"y":return 3;case"x":return 2;default:return 0}},_shiftAllRightTokensToLeft:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,g=b.getRightExpression(),h=g.tokens,i=b.getLeftExpression(),j=h.length,k=0;for(k;j>k;k++)c=h[k],d=f.Parser._getFactoryToken(),d.value="+",d.isValid=!0,d.type="opr",d.sign="+",i.tokens.push(d),"-"===c.sign?c.sign="+":c.sign="-",i.tokens.push(c);e=f.Parser._getFactoryToken(),e.value="0",e.isValid=!0,e.type="digit",e.sign="+",g.tokens=[],g.tokens.push(e),f.Parser._showConsole(f.Parser._debugFlag.common,"Shifted all right tokens to left ----------------------------------------------",[]),f.Parser._showConsole(f.Parser._debugFlag.common,b,[])},_preProcessExpression:function(a){if(void 0!==a){a.expression=a.expression.replace(/\\times/g,"\\cdot ");var b,c,d="\\cdot ",e=(d.length,/\\text\{fracdec}/g),f=/\\text\{abs}/g,g=/\\l((ceil)|(floor))/g,h=/\\r(ceil|floor)/g,i=/(\\sin\^\{\-1\}|\\cos\^\{\-1\}|\\tan\^\{\-1\}|\\cot\^\{\-1\}|\\csc\^\{\-1\}|\\sec\^\{\-1\}|\\sinh\^\{\-1\}|\\cosh\^\{\-1\}|\\tanh\^\{\-1\}|\\coth\^\{\-1\}|\\csch\^\{\-1\}|\\sech\^\{\-1\})/g,j=/\\prod_\{[A-Za-z]=(([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[\.][0-9]+)|([\-]?\\theta|[\-]?\\pi|[\-]?[A-Za-z])[A-Za-z]*(\\theta)*(\\pi)*|[\-]?\\theta|[\-]?\\pi|[\-]?[a-zA-Z])\}\^([0-9]|[A-Za-z])/g,k=/\\sum_\{[A-Za-z]=(([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[\.][0-9]+)|([\-]?\\theta|[\-]?\\pi|[\-]?[A-Za-z])[A-Za-z]*(\\theta)*(\\pi)*|[\-]?\\theta|[\-]?\\pi|[\-]?[a-zA-Z])\}\^([0-9]|[A-Za-z])/g,l=/(([\-]?[0-9]*[\.]?[0-9]*[A-Za-z]*(\\theta)*(\\pi\s)*)[\^][\{]([\-]?[0-9]*[\.]?[0-9]*[A-Za-z]*(\\theta)*(\\pi\s)*)[\}])([\\][\%])/g,m=/(([0-9]*[\.]?[0-9]*[A-Za-z]*(\\theta)*(\\pi\s)*)[\^]([0-9]+[\.]?[0-9]*[A-Za-z]*(\\theta)*(\\pi\s)*))([\\][\%])/g,n=/([\(|\)|\{|\}|\[|\]|\+|\-|\/|\%|\*|\^|])?((([\-]?[\.][0-9]+)|([\-]?[A-Za-z])|([\-]?(\\theta))|([\-]?(\\pi\s))|([\-]?[0-9]+[\.]?[0-9]*)))[\\][\%]([\\][\%])/g,o=/([\(|\)|\{|\}|\[|\]|\+|\-|\/|\%|\*|\^])?([\(]+(([\-]?[\.][0-9]+)|([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[A-Za-z])|([\-]?(\\theta))|([\-]?(\\pi\s)))([\\][\%][\)])+)([\\][\%]([\\][\%]+))/g,p=/((([\-]?[0-9]+[\.]?[0-9]*)|([\-]?(\\theta))|([\-]?(\\pi\s))|([\-]?[\.][0-9]+)|([\-]?[a-zA-Z]))[\!])([\/^]([\{]|[0-9A-Za-z]))/g,q=/(\\log_)(([0-9A-Za-z])|[\{]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^]+|(?:[\-]?(\\pi\s)))[\}])[\^](([0-9A-Za-z])|[\{]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^]+|(?:[\-]?(\\pi\s)))[\}])(([\-]?[\.][0-9]+)|([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[A-Za-z])|([\-]?(\\theta))|([\-]?(\\pi\s)))/g,r=this;for(a.expression=a.expression.replace(i,function(a){var b=r._INVERSIBLE_FUNCTIONS.indexOf(a);return r._INVERT_FUNCTIONS_IN_ORDER[b]}),a.expression=a.expression.replace(e,"\\fracdec"),a.expression=a.expression.replace(f,"\\abs"),a.expression=a.expression.replace(g,function(a,b){return"\\"+b+"("}),a.expression=a.expression.replace(h,")"),a.expression=a.expression.replace(j,function(a,b,c,d,e,f,g,h){return"\\prod_{n="+b+"}^{"+h+"}"}),a.expression=a.expression.replace(k,function(a,b,c,d,e,f,g,h){return"\\sum_{n="+b+"}^{"+h+"}"}),a.expression=a.expression.replace(l,function(a,b,c){return c=null,"("+b+")\\%"}),a.expression=a.expression.replace(m,function(a,b,c){return c=null,"("+b+")\\%"}),a.expression=a.expression.replace(n,function(a,b,c){return void 0===b||""===b?"("+c+"\\%)\\%":b+"("+c+"\\%)\\%"}),b=1,c=function(a,c,d,e,f,g,h,i,j,k,l,m,n,o){return o.length>b&&(b=o.length),void 0===c||""===c?"("+d+"\\%)\\%":c+"("+d+"\\%)\\%"};0!==b;)a.expression=a.expression.replace(o,c),b--;a.expression=a.expression.replace(p,function(a,b,c,d,e,f,g,h,i,j,k){return"("+b+")"+k}),a.expression=a.expression.replace(q,function(a,b,c,d,e,f,g,h,i,j,k){var l="";return l=void 0===e||""===e?b+"{"+c+"}^{":b+"{"+e+"}^{",void 0===i||""===i?l+g+"}("+k+")":l+i+"}("+k+")"})}},_processError:function(a){var b=window.open("","","width=200,height=200"),c=b.document;c.write("The error is :: <strong>"+a.getErrorString()+"</strong>\n"),c.write("The error data is :: <strong>"+a.getErrorData()+"</strong>\n")},_getValueOfConstantFromEquationData:function(a,b){if(null===a||void 0===a)return null;var c=a.getConstants();return null===c?null:void 0===c[b]?null:c[b]},_calculateMaxPowerOfVariable:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,f=null,g=null,h=null,i=b.getLeftExpression(),j=b.getLeftRoot(),k=!1,l=!1;f=e.Parser._getFreeVarPower(j,i.freevars);for(g in i.freevars)i.freevars[g]=f[g];h=null,b.setFreeVars({}),c=b.getFreeVars();for(h in i.freevars)h in c?"c"!==c[h]&&(c[h]<i.freevars[h]||"c"===i.freevars[h])&&(c[h]=i.freevars[h]):c[h]=i.freevars[h];g=null;for(g in c)if(d=c[g],"c"!==d&&d!==1/0&&!isNaN(d)){l=!0;break}if(l!==!0)return b.setCanBeSolved(!1),b.setErrorCode("Complicated"),void b.setErrorString(e.EquationEnums.ERROR_COMPLICATED);g=null;for(g in c)if(d=c[g],"c"!==d&&d!==1/0&&!isNaN(d)&&2>=d&&0!==d){k=!0;break}return e.Parser._showConsole(e.Parser._debugFlag.common,"Max power",[]),e.Parser._showConsole(e.Parser._debugFlag.common,b.freeVars,[]),k===!1?(b.setCanBeSolved(!1),b.setErrorCode("NoneVariablesQuadratic"),void b.setErrorString(e.EquationEnums.ERROR_VARIABLE_HAS_TO_BE_QUADRATIC)):void 0},_substituteConstants:function(b,c,d){var e,f,g,h=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,i=[],j=!1,k=c.getConstants();for(f=0;f<b.tokens.length;f++)e=void 0,g=!1,"const"===b.tokens[f].type&&(h.Parser._showConsole(h.Parser._debugFlag.common,"substituting value of constant "+b.tokens[f].value,[]),void 0===e&&(e=h.Parser._constants[b.tokens[f].value],b.tokens[f].constantSubstituted=b.tokens[f].value),void 0===e?(null===k||d||void 0===k[b.tokens[f].value])&&b.tokens[f].value!==c.getPivot()&&(g=!0,j=!0):(b.tokens[f].value=e,b.tokens[f].type="digit")),g&&-1===i.indexOf(b.tokens[f].value)&&i.push(b.tokens[f].value);j&&(b.errorData=i,MathUtilities.Components.EquationEngine.Models.Parser.processTokensWithRules(c),c.isCanBeSolved()===!1?c.setErrorCode("CannotUnderstandThis"):c.setErrorCode("ConstantDeclaration"),c.setCanBeSolved(!1),c.setErrorString(h.EquationEnums.ERROR_CONSTANTS_NOT_DEFINED),h.Parser._showConsole(h.Parser._debugFlag.common,"I found a constant that didnt have value specified ",[]),h.Parser._showConsole(h.Parser._debugFlag.common,c.getErrorData(),[]))},_getBracketBounds:function(b,c){var d,e,f,g,h=b[c].value,i=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(null===b||void 0===b)return-1;if(0===b.length)return i.Parser._showConsole(i.Parser._debugFlag.common,"Empty tokens",[]),-1;if(b.length<c+1)return i.Parser._showConsole(i.Parser._debugFlag.common,"invalid start index "+c,[]),-1;for(i.Parser._showConsole(i.Parser._debugFlag.common,"Finding end token for "+h,[]),"{"===h?d="}":"("===h?d=")":i.Parser._showConsole(i.Parser._debugFlag.common,"Invalid Start Token "+h,[]),e=0,f=b.length,g=null,g=c+1;f>g;g++)if(i.Parser._showConsole(i.Parser._debugFlag.common,b[g].value+" >> "+h,[]),b[g].value===h)e++;else if(b[g].value===d&&(e--,-1===e))return g;return i.Parser._showConsole(i.Parser._debugFlag.common,"Cant find end token",[]),-1},_getFactoryToken:function(){var a={};return a.toString=function(){return"("+this.value+" "+this.type+" "+this.sign+" "+this.negativeCaseType+")"},a},_processFunctionPowers:function(b){var c,d,e,f,g,h,i,j,k,l,m=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,n=null;for(c=0;c<b.length;c++)l=!1,d=b[c],0!==c&&(e=b[c-1],"func"===e.type?l=!0:(n=m.Parser._checkLogToBasePowerCase(b.slice(0,c)),null!==n&&(l=!0)),"^"===d.value&&l&&(f=m.Parser._getFunctionTokens(b.slice(c+1)),g=m.Parser._getFunctionTokens(b.slice(c+1+f.length)),h=m.Parser._getFactoryToken(),i=m.Parser._getFactoryToken(),h.type=i.type="delim",h.isValid=i.isValid=!0,h.sign=i.sign="+",h.value="(",i.value=")",j=b.slice(0,c-1),k=b.slice(c+f.length+1+g.length,b.length),null!==n?(b=j.slice(0,j.length-n.length-2),b.push(h),b=b.concat(n)):(b=j,b.push(h),b.push(e)),b=b.concat(g),b.push(i),b.push(d),b=b.concat(f),b=b.concat(k)));return b},_checkLogToBasePowerCase:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,f=b.length,g=0,h=null;for(c=f-1;c>=0;c--)if(d=b[c],e.ParsingProcedures._isOpeningBracket(d.value))g++;else if(e.ParsingProcedures._isClosingBracket(d.value))g--;else if(0===g){"\\log_"===d.value&&(h=b.slice(c,f));break}return h},_getFunctionTokens:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,f=b.length,g=0,h=[];for(c=0;f>c&&(d=b[c],h.push(d),e.ParsingProcedures._isOpeningBracket(d.value)?g++:e.ParsingProcedures._isClosingBracket(d.value)&&g--,0!==g);c++);return h},_isFunctionSupported:function(a){var b=["\\cdot","\\pi","\\sqrt","\\fracdec","\\gcd","\\lcm","\\theta","\\min","\\max","\\mod","\\nCr","\\nPr","\\frac","\\%","\\sin","\\cos","\\tan","\\csc","\\sec","\\cot","\\arccot","\\arccsc","\\arcsin","\\arcsec","\\arccos","\\arctan","\\log","\\ln","\\ceil","\\floor","\\round","\\abs","\\exp","\\sum","\\prod"];return-1!==b.indexOf(a)?!0:!1},_createToken:function(b,c,d,e){var f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,g=f.Parser._getFactoryToken();return g.value=b,g.isValid=c,g.type=d,g.sign=e,g},_generateTokens:function(b,c){var d,e,f,g,h,i,j=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,k=[],l="",m=0,n=["func","delim","var","opr","digit","const"],o=!1,p=!1,q=[/^\\[a-z|\%|\_]+[\s]?$/i,/^[\[|\]|\}|\{|\(|\)|\,|\{|\}]$/i,/^[x|y]{1}$/,/^[\+|\-|\^|\!|<|\>|\_]{1}$/,/^(([\.][0-9]+)|([0-9]+[\.]?[0-9]*))$/,/^[a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|z|A-Z]$/],r=0,s=q.length;for("string"==typeof b?(d=b,f=!0):(d=b.expression,f=!1),d=d.trim(),h=d.length,j.Parser._showConsole(j.Parser._debugFlag.common,"parse expression called",[]);h>m;){for(p=!1,j.Parser._showConsole(j.Parser._debugFlag.tokens,">>"+d.charAt(m)+"<<",[])," "===l&&(l=""),l+=d.charAt(m),j.Parser._showConsole(j.Parser._debugFlag.tokens,"Analysing token "+l,[]),r=0;s>r;r++)if(g=q[r].test(l),g!==!1){if(m++,"func"===n[r]){if(j.Parser._isFunctionSupported(l)){"\\frac"===l&&d.charAt(m)+d.charAt(m+1)+d.charAt(m+2)==="dec"&&(l="\\fracdec",m+=3),e&&(i=e.index),e=j.Parser._createToken(l,!0,n[r],"+"),j.Parser._showConsole(j.Parser._debugFlag.tokens,">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>TOKEN FOUND "+e.value,[]),k.push(e),p=!0,void 0!==i?e.index=d.indexOf(l,i+1):e.index=d.indexOf(l),l="";break}o=!1;break}if("digit"!==n[r]){e&&(i=e.index),e=j.Parser._createToken(l,!0,n[r],"+"),j.Parser._showConsole(j.Parser._debugFlag.tokens,">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>TOKEN FOUND "+e.value,[]),k.push(e),p=!0,void 0!==i?e.index=d.indexOf(l,i+1):e.index=d.indexOf(l),l="";break}if(e&&"opr"===e.type&&("_"===e.value||"^"===e.value)){e&&(i=e.index),e=j.Parser._createToken(l,!0,n[r],"+"),j.Parser._showConsole(j.Parser._debugFlag.tokens,">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>TOKEN FOUND "+e.value,[]),k.push(e),p=!0,void 0!==i?e.index=d.indexOf(l,i+1):e.index=d.indexOf(l),l="";break}for(;;){if(""!==d.charAt(m)){if(l+=d.charAt(m),j.Parser._showConsole(j.Parser._debugFlag.tokens,"Digit found",[]),j.Parser._showConsole(j.Parser._debugFlag.tokens,"Analysing token "+l,[]),q[4].test(l)){m++;continue}m--,1!==l.length&&(l=l.substring(0,l.length-1))}e&&(i=e.index),e=j.Parser._createToken(l,!0,n[r],"+"),j.Parser._showConsole(j.Parser._debugFlag.tokens,">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>TOKEN FOUND "+e.value,[]),k.push(e),p=!0,void 0!==i?e.index=d.indexOf(l,i+1):e.index=d.indexOf(l),l="";break}}else j.Parser._showConsole(j.Parser._debugFlag.tokens,"NO!! match "+q[r]+" >>"+l,[]);r===s&&m++}return p?k=j.Parser._processTokens(k,b,c,f):(c.setCanBeSolved(!1),void c.setErrorCode("Complicated"))},_processTokens:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,s=0,t=0,u=0,v=0,w=0;for(q=b.length,f=0;q>f;f++)switch(m=f+1,g=b[f],h=b[m],g.type){case"func":switch(g.value){case"\\cdot":g.value="\\cdot",g.type="opr",f--;break;case"\\pi":g.value="\\pi",g.type="const";break;case"\\%":g.value="\\%",g.type="opr";break;case"\\theta ":case"\\theta":g.value="\\theta",g.type="const"}if("func"===g.type&&"\\frac"!==g.value&&(0!==u&&(k=r.Parser._createToken(")",!0,"delim","+"),b.splice(f,0,k),u--,q++),h)){if("\\log"===g.value)if(g.value="\\log_","_"===h.value)if(b.splice(++f,1),q--,"{"!==b[f].value)k=r.Parser._createToken("{",!0,"delim","+"),b.splice(f++,0,k),k=r.Parser._createToken("}",!0,"delim","+"),b.splice(++f,0,k);else{for(t=1,f++,j=f;0!==t;)"{"===b[f].value&&t++,"}"===b[f].value&&t--,f++;for(f--,n=b.splice(j,f-j),n.length>1&&(n=r.Parser._processTokens(n,c,d)),o=n.length,p=0;o>p;p++)b.splice(j,0,n[p]),j++;f=j}else k=r.Parser._createToken("{",!0,"delim","+"),b.splice(++f,0,k),k=r.Parser._createToken("10",!0,"digit","+"),b.splice(++f,0,k),k=r.Parser._createToken("}",!0,"delim","+"),b.splice(++f,0,k),q+=3;else"\\sqrt"===g.value&&"{"===h.value&&(k=r.Parser._createToken("[",!0,"delim","+"),b.splice(++f,0,k),k=r.Parser._createToken("2",!0,"digit","+"),b.splice(++f,0,k),k=r.Parser._createToken("]",!0,"delim","+"),b.splice(++f,0,k),q+=3,v++);if("^"===h.value)if("{"===b[f+2].value){for(t=1,f+=3,j=f;0!==t;)"{"===b[f].value&&t++,"}"===b[f].value&&t--,f++;for(f--,n=b.splice(j,f-j),n.length>1&&(n=r.Parser._processTokens(n,c,d)),o=n.length,p=0;o>p;p++)b.splice(j,0,n[p]),j++;f=j}else f+=2;h=b[f+1],h&&"delim"!==h.type&&"func"!==h.type?(0!==v&&w++,k=r.Parser._createToken("(",!0,"delim","+"),b.splice(f+1,0,k),u++,q=b.length):h&&"\\frac"===h.value&&(k=r.Parser._createToken("(",!0,"delim","+"),b.splice(f+1,0,k),u++,q=b.length,f++)}break;case"var":e===!1&&(void 0===c.freevars&&(c.freevars={}),void 0===c.freevars[g.value]&&(r.Parser._showConsole(r.Parser._debugFlag.tokens,"---------------------recording var "+g.value+"-------------------------",[]),c.freevars[g.value]=0));break;case"const":if(e===!1){void 0===c.constants&&(c.constants={}),void 0===c.constants[g.value]&&(r.Parser._showConsole(r.Parser._debugFlag.tokens,"------------------ recording constant "+g.value+"--------------------",[]),c.constants[g.value]=1),d.containsConstant=!0;break}case"delim":"}"!==g.value&&")"!==g.value||!u?"{"===g.value&&v++:0===v||0!==w?(k=r.Parser._createToken(")",!0,"delim","+"),b.splice(f,0,k),u--,q++,0!==w&&w--):v--;break;case"opr":if("+"!==g.value&&"-"!==g.value||0===u){if("_"===g.value&&(j=f-1,i=b[f-1],"var"===i.type||"const"===i.type))if("delim"!==h.type)k=r.Parser._createToken(i.value+g.value+h.value,!0,"const","+"),b.splice(f-1,3),b.splice(f-1,0,k),f--,q=b.length;else{for(l=i.value+g.value+h.value,s=3,f++;;){if(f++,"delim"===b[f].type)break;l+=b[f].value,s++}f++,s++,l=l.replace("{",""),k=r.Parser._createToken(l,!0,"const","+"),b.splice(j,s),b.splice(j,0,k),q=b.length,f=j}}else k=r.Parser._createToken(")",!0,"delim","+"),b.splice(f,0,k),u--,q++}for(;0!==u;)k=r.Parser._createToken(")",!0,"delim","+"),b.splice(f+1,0,k),u--,q++;return b},_checkIfFunctionParanthesis:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,f=b.length,g=0,h=!1;for(c=f-1;c>=0;c--)if(d=b[c],e.ParsingProcedures._isClosingBracket(d.value))g++;else if(e.ParsingProcedures._isOpeningBracket(d.value)&&(g--,0===g&&0!==c)){if("^"===b[c-1].value&&"func"===b[c-2].type){h=!0;break}if("func"===b[c-1].type)h=!0;else if("delim"===b[c-1].type)continue;break}return h},_processPointEquation:function(b,c){var d,e,f,g,h=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,i=[],j=b.length;if("("===b[0].value&&")"===b[j-1].value){for(c.setSolution([]),i.push(b[0]),d=1;j>d;d++)if(f=b[d-1],e=b[d],")"===f.value&&","===e.value||")"===e.value&&d===j-1){if(d===j-1)i.push(e);else if(h.Parser._checkIfFunctionParanthesis(b.slice(0,d))){i.push(e);continue}if(g=h.Parser._checkIfPoint(i,c),c.isCanBeSolved()===!1||void 0===g)return;c.getSolution().push(g),i=[]}else i.push(e);return i.length>0&&c.getSolution().length>0?(c.setCanBeSolved(!1),void c.setErrorCode("CannotUnderstandThis")):void(c.getSolution().length>0&&c.setSpecie("point"))}},_checkIfPoint:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=[],w=[],x=!0,y=b.length,z=0,A=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,B=-1,C=!1;if("("===b[0].value&&")"===b[y-1].value){for(d=1;y-1>d;d++){if(e=b[d],"func"===e.type)A.Parser._isCommaFunction(e.value)&&z++;else if(","===e.value){if(0===z){B=e.index,x=!1;continue}z--}x?v.push(e):w.push(e)}if(!x){if(p=new a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationData,q=new a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationData,p.setLatex(c.getLeftExpression().expression.substring(b[0].index+1,B),!0),f=c.getPivot(),null!==f&&(q.setPivot(f),p.setPivot(f)),g=c.getConstants(),q.setConstants(g,!0),p.setConstants(g,!0),h=c.getUnits(),q.setUnits(h,!0),p.setUnits(h,!0),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.parseEquationToGetTokens(p),p.isCanBeSolved()===!1)return;if("number"!==p.getSpecie()&&"point"!==p.getSpecie()){if(a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.processTokensWithRules(p),p.isCanBeSolved()===!1)return;a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.generateTreeFromRules(p)}if(j=p.getSpecie(),i=p.getErrorCode(),"number"===j||"ConstantDeclaration"===i||"expression"===j){if("ConstantDeclaration"===i&&(C=!0),q.setLatex(c.getLeftExpression().expression.substring(B+1,b[y-1].index),!0),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.parseEquationToGetTokens(q),q.isCanBeSolved()===!1)return;if("number"!==q.getSpecie()&&"point"!==q.getSpecie()){if(a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.processTokensWithRules(q),q.isCanBeSolved()===!1)return;a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.generateTreeFromRules(q)}l=q.getSpecie(),"number"===l||"expression"===l?(u=[p.getSolution(),q.getSolution()],c.setAccText("Point of "+p.getSolution()+" and "+q.getSolution()),$("#accessibility-display").html("The Accesibility string is "+c.getAccText())):(k=q.getErrorCode(),"ConstantDeclaration"===k?C=!0:(c.setCanBeSolved(!1),c.setErrorCode("CannotUnderstandThis")))}else c.setCanBeSolved(!1),c.setErrorCode("CannotUnderstandThis");if(C){if(c.setCanBeSolved(!1),c.setErrorCode("ConstantDeclaration"),c.setErrorData([]),m=c.getErrorData(),n=p.getErrorData(),null!==n)for(r=0,s=n.length,r;s>r;r++)t=n[r],-1===m.indexOf(t)&&m.push(t);if(o=q.getErrorData(),null!==o)for(r=0,s=o.length,r;s>r;r++)t=o[r],-1===m.indexOf(t)&&m.push(t)}}return u}},_parseExpression:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(d=e.Parser._generateTokens(b,c),c.isCanBeSolved()!==!1){if(d=e.Parser._processNegativeTokens(d,c,b.equationParameters),d.length<1)return c.setCanBeSolved(!1),void c.setErrorCode("CannotUnderstandThis");e.Parser._processPointEquation(d,c),c.isCanBeSolved()!==!1&&"point"!==c.getSpecie()&&(d=e.Parser._processFunctionPowers(d),d=e.Parser._addInvisibleCdotToTokens(d),e.Parser._adjustPostFixOperatorPowers(d),$("#left-column-container").width($("#button-container").width()+$("#equation").width()+$(".mathquill-editable").width()+50),b.tokens=d)}},_NEGATIVE_CASE_TYPES:{NONE:0,SINGLE:1,DOUBLE:2,PLUS_SINGLE:3,NEGATIVE:4},_processNegativeTokens:function(b,c,d){var e,f,g,h=[],i=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,j=/(\(|\[|\{|\+|\\cdot|,)/,k=b.length,l=i.Parser._NEGATIVE_CASE_TYPES.NONE,m=null;for(e=0;k>e;e++){if(f=b[e],"-"===f.value)null!==m?l===i.Parser._NEGATIVE_CASE_TYPES.NONE?"+"===m.value?l=i.Parser._NEGATIVE_CASE_TYPES.PLUS_SINGLE:null!==m&&null!==m.value.match(j)?l=i.Parser._NEGATIVE_CASE_TYPES.NEGATIVE:(d.operatorsList.push(f.value),l=i.Parser._NEGATIVE_CASE_TYPES.SINGLE,g=i.Parser._getFactoryToken(),g.value="+",g.isValid=!0,g.type="opr",g.sign="+",g.negativeCaseType=i.Parser._NEGATIVE_CASE_TYPES.NONE,h.push(g)):l=i.Parser._NEGATIVE_CASE_TYPES.DOUBLE:l=i.Parser._NEGATIVE_CASE_TYPES.NEGATIVE;else{switch(f.type){case"var":l===i.Parser._NEGATIVE_CASE_TYPES.NONE||l!==i.Parser._NEGATIVE_CASE_TYPES.DOUBLE&&l!==i.Parser._NEGATIVE_CASE_TYPES.PLUS_SINGLE&&l!==i.Parser._NEGATIVE_CASE_TYPES.NEGATIVE?d.variablesList.push(f.value):d.variablesList.push("-"+f.value);break;case"const":f.value!==c.getPivot()&&(l===i.Parser._NEGATIVE_CASE_TYPES.NONE||l!==i.Parser._NEGATIVE_CASE_TYPES.DOUBLE&&l!==i.Parser._NEGATIVE_CASE_TYPES.PLUS_SINGLE&&l!==i.Parser._NEGATIVE_CASE_TYPES.NEGATIVE?d.constantsList.push(f.value):d.constantsList.push("-"+f.value));
break;case"digit":l===i.Parser._NEGATIVE_CASE_TYPES.NONE||l!==i.Parser._NEGATIVE_CASE_TYPES.DOUBLE&&l!==i.Parser._NEGATIVE_CASE_TYPES.PLUS_SINGLE&&l!==i.Parser._NEGATIVE_CASE_TYPES.NEGATIVE?d.digitsList.push(f.value):d.digitsList.push("-"+f.value);break;case"opr":d.operatorsList.push(f.value);break;case"func":d.functionsList.push(f.value)}h.push(f),f.negativeCaseType=l,l!==i.Parser._NEGATIVE_CASE_TYPES.NONE&&l!==i.Parser._NEGATIVE_CASE_TYPES.DOUBLE&&("+"===f.sign?f.sign="-":f.sign="+"),l=i.Parser._NEGATIVE_CASE_TYPES.NONE}m=f}return h},_adjustPostFixOperatorPowers:function(b){var c,d,e,f,g,h,i=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,j=["^","!","\\%"];for(c=0;c<b.length;c++)if(e=b[c],f=[],-1!==j.indexOf(e.value)&&0!==c)for(i.Parser._showConsole(i.Parser._debugFlag.common,"Checking for power sign at "+c,[]),d=c-1;d>=0;d--)if(g=b[d],"delim"!==g.type){if(i.Parser._showConsole(i.Parser._debugFlag.common,"Current left token is "+g+" stack is "+f,[]),!(f.length>0||"var"!==g.type&&"const"!==g.type&&"digit"!==g.type)){i.Parser._showConsole(i.Parser._debugFlag.common,"terminal found ignoring the sign "+g,[]),e.sign=g.sign,e.negativeCaseType=g.negativeCaseType,g.sign="+",g.negativeCaseType=0;break}}else if(0===f.length&&(h=!0),i.Parser._showConsole(i.Parser._debugFlag.common,"Recording bracket "+g.value,[]),i.ParsingProcedures.recordBracket(f,g.value),h===!0&&0===f.length){i.Parser._showConsole(i.Parser._debugFlag.common,"stealing the sign of "+g,[]),e.sign=g.sign,g.sign="+";break}},_printTokens:function(b,c){var d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;d.Parser._showConsole(d.Parser._debugFlag.common,"******************************************************************",[]),d.Parser._showConsole(d.Parser._debugFlag.common,c+" All Tokens Are "+b.tokens,[]),d.Parser._showConsole(d.Parser._debugFlag.common,"******************************************************************",[])},_addInvisibleCdotToTokens:function(b){var c,d,e,f,g,h,i,j,k=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,l=["var","const","func"],m=["("],n={"var":{tokenTypes:["var","const","digit"],tokenValues:[")","!","}"]},"const":{tokenTypes:["var","const","digit"],tokenValues:["}",")","!","\\%"]},func:{tokenTypes:["var","const","digit"],tokenValues:[")","!","}","\\%"]},"(":{tokenTypes:["var","const","digit"],tokenValues:[")","!","}"]}},o=0,p=/^([0-9]+[\.])$/,q=k.Parser._getFactoryToken();for(q.type="opr",q.value="\\cdot",q.sign="+",q.isValid=!0,o=1;o<b.length;o++)if(c=b[o-1],d=b[o],e=-1!==l.indexOf(d.type),f=-1!==m.indexOf(d.value),(e||f)&&(i=e?d.type:d.value,-1!==n[i].tokenTypes.indexOf(c.type)||-1!==n[i].tokenValues.indexOf(c.value))){if("digit"===c.type&&null!==c.value.match(p))continue;if("("===d.value&&"}"===c.value){if(j=k.Parser._isFractionBrace(b.slice(0,o)),!j)continue;if(null!==k.Parser._checkLogToBasePowerCase(b.slice(0,o)))continue}g=b.slice(0,o),g.push(q),h=b.slice(o,b.length),b=g.concat(h),o++}return b},_isFractionBrace:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,f=b.length,g=0;for(c=f-1;c>=0;c--)if(d=b[c],e.ParsingProcedures._isOpeningBracket(d.value))g++;else if(e.ParsingProcedures._isClosingBracket(d.value))g--;else if(0===g&&("\\frac"===d.value||"\\sqrt"===d.value))return!0;return!1},_getFreeVarPower:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,r={};if(b.isTerminal){j=null;for(j in c)o=0,b.value===j&&(o=1),r[j]=o}else{for(d=[],e=0,f=b.params.length,e;f>e;e++)d.push(q.Parser._getFreeVarPower(b.params[e],c));switch(b.name){case"+":for(g=0,h=d.length,g;h>g;g++){i=d[g],j=null;for(j in i)j in r?"c"!==r[j]&&("c"===i[j]||r[j]<i[j])&&(r[j]=i[j]):r[j]=i[j]}break;case"\\cdot":for(g=0,h=d.length,g;h>g;g++){i=d[g],j=null;for(j in i)j in r?"c"!==r[j]&&("c"===i[j]?r[j]=i[j]:r[j]+=i[j]):r[j]=i[j]}break;case"^":case"\\frac":j=null;for(j in d[1])0!==d[1][j]?r[j]="c":r[j]=d[0][j];k=!1,j=null;for(j in r)"c"===r[j]&&(k=!0),"^"===b.name&&r[j]<0&&(k=!0);if("^"===b.name){j=null;for(j in d[0])k&&d[1][j]>0?r[j]="c":d[0][j]>0&&(b.params[1].isTerminal===!0&&"digit"===b.params[1].type?(p=Number(q.TreeProcedures._getValueFromParam(b.params[1])),r[j]=0>p?"c":0===r[j]?p:r[j]*p):r[j]="c")}else{j=null;for(j in d[0])"c"!==r[j]&&(r[j]=d[0][j])}break;default:for(l=0,m=d.length,l;m>l;l++){n=d[l],j=null;for(j in n)n[j]>0||"c"===n[j]?r[j]="c":"c"!==r[j]&&(r[j]=0)}}}return r},_displayArrayOfObjects:function(b,c,d,e){var f,g,h,i,j,k=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(k.Parser._deploy!==!0)if(void 0!==b){for(void 0===e&&(e="black"),void 0===d&&(d="#777700"),f=$("#"+c),f.parent().css({border:"1px solid black"}),f.css({border:"1px solid","border-color":k.Parser._borderColor,position:"relative","overflow-x":"hidden"}),g=0,h=b.length,g;h>g;g++)i=b[g],j=$("<div>"+i+"</div>"),j.attr("class","tokens"),f.append(j);$(".tokens").css({"float":"left",border:"1px solid black",margin:"5px",padding:"5px","background-color":d,color:e,"font-weight":"bold"})}else k.Parser._showConsole(k.Parser._debugFlag.common,"The objects provided is undefined",[])},_generateAnalysis:function(b){var c,d,e,f,g,h=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,i=b.getLeftExpression().tokens,j=b.getRightExpression().tokens,k=b.getUnits(),l=b.getProfiles(),m=b.getDirectives();if(h.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("leftProductionRules"),g=h.Parser._recursiveDescentParser(b,i,0,0,[void 0],!1),h.Parser._deploy||(l[2]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("leftProductionRules")),b.isCanBeSolved()!==!1&&(h.Parser._displayArrayOfObjects(g,"production-rules-display-left","#777700","white"),h.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("rightProductionRules"),c=h.Parser._recursiveDescentParser(b,j,0,0,[void 0],!1),h.Parser._deploy||(l[2]+=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("rightProductionRules")),b.isCanBeSolved()!==!1)){if(h.Parser._displayArrayOfObjects(c,"production-rules-display-right","#777700","white"),void 0===g||void 0===c)return b.setCanBeSolved(!1),b.setErrorCode("CannotUnderstandThis"),void h.Parser._showConsole(h.Parser._debugFlag.common,"%c[STAGE2 - FAIL]Left Prediction Rules Failed",[h.Parser._NSTYLE]);h.Parser._showConsole(h.Parser._debugFlag.common,"%c[STAGE2 - Success]Prediction rules Generated Left:"+g,[h.Parser._YSTYLE]),h.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("generateTree"),b.setLeftRoot(h.TreeProcedures.generateTree(g,0,k)),b.setRightRoot(h.TreeProcedures.generateTree(c,0,k)),h.Parser._deploy||(l[3]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("generateTree")),e=b.getLeftRoot(),f=b.getRightRoot();var n=h.TreeProcedures._toAccessible(e).expression;if(b.getRhsAuto()!==!0&&(n+=" equal to "+h.TreeProcedures._toAccessible(f).expression),b.setAccText(n),$("#accessibility-display").html("The Accesibility string is "+n),"graphing"===m.FDFlagMethod&&"frac"===b.getFdFlag()&&("\\frac"===e.name||"do"===e.name&&"\\frac"===e.params[0].name)&&(b.setFdFlag("decimal"),"do"===e.name?h.Parser._checkIfFracHasNonFracChilds(e.params[0],b):h.Parser._checkIfFracHasNonFracChilds(e,b)),"calculator"===m.FDFlagMethod&&b.setFdFlag(0===h.Parser._getAnalysisForFD(e)?"frac":"decimal"),h.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("simplify"),e.isTerminal||e.simplify(b),f&&!f.isTerminal&&f.simplify(b),h.Parser._deploy||(l[4]=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getProcessingTime("simplify")),e.isTerminal&&"digit"===e.type&&null!==f&&!b.getRhsAuto()&&f.isTerminal&&"digit"===f.type)return b.setCanBeSolved(!1),b.setErrorString("Try adding some free variables"),void b.setErrorCode("CannotUnderstandThis");if(h.Parser._showConsole(h.Parser._debugFlag.common,"%c[STAGE4 - SUCCESS]Tree Simplified",[h.Parser._YSTYLE]),h.Parser._deploy||h.Parser._printLatex(e,4,!0),"expression"!==b.getSpecie()&&h.TreeProcedures.combineLeftRightTree(b),d=e,void 0===e)return b.setCanBeSolved(!1),b.setErrorCode("CannotUnderstandThis"),void h.Parser._showConsole(h.Parser._debugFlag.common,"%c[STAGE3 - FAIL]Left Equation Tree Generation Failed",[h.Parser._NSTYLE]);h.Parser._showConsole(h.Parser._debugFlag.common,"%c[STAGE3 - Success]Equation Tree Generated",[h.Parser._YSTYLE]),h.Parser._deploy||h.Parser._printLatex(d,3,!0),"expression"===b.getSpecie()&&b.setSolution(h.TreeProcedures._substituteParamVariableAndGetValue(b.getLeftRoot(),b.getConstants())),h.Parser._deploy||h.TreeProcedures._toLatex(d)}},_checkIfFracHasNonFracChilds:function(b,c){if("frac"!==c.getFdFlag()){var d,e,f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(!b.isTerminal)if("\\frac"===b.name){for(f=b.params,e=f.length,d=0;e>d;d++)if(g.Parser._checkIfFracHasNonFracChilds(f[d],c),"frac"===c.getFdFlag())return}else c.setFdFlag("frac")}},_getAnalysisForFD:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,g=1;if(b.isTerminal)return"digit"===b.type?-1!==b.value.toString().indexOf(".")?NaN:1:"const"===b.type&&("e"===b.value||"\\pi"===b.value)?NaN:1;if(f.TreeProcedures.isOperator(b.name)||"do"===b.name){for(d=b.params.length,c=0;d>c;c++)if(e=f.Parser._getAnalysisForFD(b.params[c]),g=e*g,isNaN(g))return NaN;return g}return"\\frac"===b.name?0:NaN},_showRules:function(){var a=window.open("","","width=700,height=700"),b=$("<textarea>"+$("#rules").text()+"</textarea>");b.css({width:"600px",height:"600px"}),$(a.document.body).append(b)},_printLatex:function(b,c,d){var e,f,g,h,i,j,k,l,m=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;m.Parser._deploy!==!0&&(e={0:"Preprocessing",1:"Token Generation",2:"Create Production Rules",3:"Generate Equation Tree",4:"Simplify",5:"Find Equation Solvability",6:"Expand Equation",7:"Convert to Quadratic Form",8:"Solve"},f=$("<div></div>"),h=$("#display-outter-container"),h.append(f),g=$("<div></div>"),g.attr("id","header"+c).css({"font-weight":"bold"}).html(e[c]),f.attr("id","stage-number"+c).append(g).css({border:"1px solid black",padding:"10px 5px 5px 10px",margin:"25px 5px 5px 5px"}),i=m.TreeProcedures._toLatex(b),j=$("<span></span>"),j.attr("id","stage"+c).css({border:"1px solid","border-color":m.Parser._borderColor,margin:"5px 5px 5px 5px",padding:"5px 5px 5px 5px"}),f.append(j),$("#stage"+c).append(i).mathquill(),f.append("<br/>"),d&&(k=$("<canvas></canvas>"),k.attr("id","canvas-stage"+c).css({border:"1px solid","border-color":m.Parser._borderColor}),f.append(k),l=["canvas-stage"+c],m.Parser._displayTree(b,l),m.Parser._showConsole(m.Parser._debugFlag.common,"The latex string is "+i,[])))},_recursiveDescentParser:function(b,c,d,e,f,g){if(b.isCanBeSolved()!==!1&&0!==c.length){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,B=c[d],C=d,D=A.ParsingProcedures.getPredictionStacksForToken(B,"E",g);if(void 0===D)return A.Parser._showConsole(A.Parser._debugFlag.common,"############################### ERROR ##########################",[]),A.Parser._showConsole(A.Parser._debugFlag.common,"no rules found for E ->"+B.value,[]),b.setCanBeSolved(!1),void b.setErrorCode("CannotUnderstandThis");for(h=d,i=0,l=0,p=[],q=[],y=D.length,A.Parser._showConsole(A.Parser._debugFlag.rules,"----------------------Begin recursion "+e+"------------------ with lookahead "+f,[]),k=0;y>k;k++)if(x=D[k],r=[],j=[],g?(A.ParsingProcedures.cloneStringStack(A.RangeProductionRules.rangeRules[x],j),A.Parser._showConsole(A.Parser._debugFlag.rules,"for "+x+" rules are "+A.RangeProductionRules.rangeRules[x],[])):(A.ParsingProcedures.cloneStringStack(A.Parser._productions.productionRules[x],j),A.Parser._showConsole(A.Parser._debugFlag.rules,"for "+x+" rules are "+A.Parser._productions.productionRules[D[k]],[])),r.push(x),A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[Predict "+e+"] Level "+e+" by rule "+x+" Processing prediction "+j,[A.Parser._HSTYLE]),h=d,i=0,o=!0,s=!1,u=A.ParsingProcedures.isStackInfinite(j),u!==!0||A.ParsingProcedures.verifyStackWithLookahead(j,f)!==!1){for(;i<j.length;){if(n=A.ParsingProcedures.peekInPredictionStack(j,i),B=c[h],A.Parser._showConsole(A.Parser._debugFlag.rules,B+" <> "+n+" >> "+A.ParsingProcedures.isTokenSame(B,n),[]),A.ParsingProcedures.isTokenSame(B,n))r.push(B);else if(A.ParsingProcedures.isNonTerminal(n)){if(A.Parser._showConsole(A.Parser._debugFlag.rules,"TErminal Node...going in...stack so far "+r,[]),w=A.ParsingProcedures.pushAllLookAheads(f,j,i+1),A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[PAUSE "+e+"]",[A.Parser._BLUE_STYLE]),t=A.Parser._recursiveDescentParser(b,c,h,e+1,f,g),b.isCanBeSolved()===!1)return;for(m=0;w>m;m++)f.pop();if(A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[RESUME "+e+"]>>>>Recursion level "+e+" resumes with solution "+t,[A.Parser._BLUE_STYLE]),void 0===t){A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[FAIL "+e+"] prediction "+j+" is invalid...REJECTING at "+r,[A.Parser._NSTYLE]),o=!1;break}for(A.Parser._showConsole(A.Parser._debugFlag.rules," recursion will resume from index "+t.tokenPointer,[]),h=t.tokenPointer,l=0;l<t.length;l++)r.push(t[l])}else{if(!(u&&s&&A.ParsingProcedures.isTermInfinite(j[i]))){o=!1,A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[FAIL "+e+"] STack match failed...DISCARDING stack!!! "+j,[A.Parser._NSTYLE]);break}v=j[i],i>=j.length?(A.Parser._showConsole(A.Parser._debugFlag.rules,"Finished chasing recursive term "+v+" from total stack :"+j,[]),s=!1):(o=!0,A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[ACCEPT "+e+"]Stack matched so far...dumping ALL infinite term and breaking: "+j+" recursionIndex :: "+e,[A.Parser._YSTYLE]))}if(i++,h++,u&&A.ParsingProcedures.isTermInfinite(j[i]))if(z=c[h],A.Parser._showConsole(A.Parser._debugFlag.rules,"trying to match peek from "+j[i]+" >> "+A.ParsingProcedures._getPeekValue(j[i])+" with next token "+z,[]),void 0!==z)if(A.ParsingProcedures._getPeekValue(j[i])!==c[h].value){if(s===!1){o=!1,A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[FAIL "+e+"] "+j[i]+" is NOT used...DISCARDING stack!!! "+j,[A.Parser._NSTYLE]);break}if(i+1>=j.length){if(A.ParsingProcedures.checkWithLookAhead(c[h],f)){o=!0;break}o=!1,A.Parser._showConsole(A.Parser._debugFlag.rules," All recursive terms are used and exhausted...breaking the chain for stack "+j+" and lookahead "+f,[]);break}A.Parser._showConsole(A.Parser._debugFlag.rules,"match FAILED so moving on to "+j[i+1],[]),s=!0,A.ParsingProcedures.expandRecursiveStack(j,i+1),i++}else A.Parser._showConsole(A.Parser._debugFlag.rules,"match success expanding "+j[i],[]),s=!0,A.ParsingProcedures.expandRecursiveStack(j,i);else A.Parser._showConsole(A.Parser._debugFlag.rules,"All tokens are over...No need to expand stack "+j,[]);if(h>=c.length&&i<j.length){A.Parser._showConsole(A.Parser._debugFlag.common,"Checking when tokens are over and stack is not: recursive is "+u,[]),u?s&&i===j.length-1?(A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[ACCEPT "+e+"] prediction accepted "+j,[A.Parser._YSTYLE]),o=!0):(o=!1,A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[FAIL "+e+"]Tokens are finished but there are unexpanded recursive terms...rejecting the prediction "+j+" at index "+i,[A.Parser._NSTYLE]),A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[FAIL]There was an error in syntax of equation. We could not find "+j[i],[A.Parser._NSTYLE])):(A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[FAIL "+e+"]Tokens are finished when prediction stack is NOT...REJECTING the prediction",[A.Parser._NSTYLE]),o=!1);break}if(i>=j.length&&h<c.length){A.Parser._showConsole(A.Parser._debugFlag.rules,"Prediction Stack over: Checking with lookahead "+c[h]+" <> "+f,[]),A.ParsingProcedures.checkWithLookAhead(c[h],f)?(A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[ACCEPT "+e+"]Prediction stack finished and lookahead matches...ACCEPTING the prediction by rule "+D[k],[A.Parser._YSTYLE]),o=!0):(A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[FAIL "+e+"]Prediction stack finished and lookahead doesnt match...REJECTING the prediction by rule "+D[k],[A.Parser._NSTYLE]),o=!1);break}}if(o===!0){A.Parser._showConsole(A.Parser._debugFlag.rules,"checking if the accepted solution is final :: "+A.ParsingProcedures.checkWithLookAhead(B,f),[]),A.Parser._showConsole(A.Parser._debugFlag.rules,"checking if the accepted solution is final :: "+A.ParsingProcedures.checkWithLookAhead(B,f),[]),A.Parser._showConsole(A.Parser._debugFlag.rules,"Prediction accepted is "+r,[]),r.tokenPointer=h-1,q.push(r);break}}else A.Parser._showConsole(A.Parser._debugFlag.rules,"%c[FAIL "+e+"]Rejecting STACk "+j+" because we cant pursue same GOAL again...",[A.Parser._NSTYLE]);if(A.Parser._showConsole(A.Parser._debugFlag.rules,q.length+" Solutions found ....",[]),A.Parser._showConsole(A.Parser._debugFlag.rules,"----------------------End recursion "+e+"------------------"),q.length>1)for(A.Parser._showConsole(A.Parser._debugFlag.common,"=================================ACCEPTED PREDICTIONS ARE MORE THAN ONE!!!!==================================after "+C,[]),m=0;m<q.length;m++)A.Parser._showConsole(A.Parser._debugFlag.common,"Prediction is "+q[m],[]);else if(1===q.length)return q[0]}},_displayTree:function(b,c){var d,e,f,g,h=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,i=0,j=[],k=null;if(d=window.innerWidth-($("#button-container").width()+$("#equation").width()+$(".mathquill-editable").width()+100),$("#canvasContainer").width(d),e=[],"object"==typeof c)e=c;else for(f=1;f<arguments.length;f++)e[f-1]=arguments[f];for(g=e.length;g>i;i++)"string"==typeof e[i]&&(j[i]=new paper.PaperScope,k=document.getElementById(e[i]),j[i].setup(k),h.Parser._nodeDisplay(b,!0,j[i],k))},_nodeDisplay:function(b,c,d,e){var f,g,h,i,j,k,l=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,m=0,n=0,o=l.Parser._getTextWidth($("<div></div>").html(b.toString()),!0),p=[0],q=0;if(c){for(g=[],b.isTerminal||(n=b.params.length),l.Parser._nodeCounter(b,q.toString(),g,p),l.Parser._totalNodeCounter(g),h=null,f=0;n>f;f++)h=l.Parser._getTextWidth($("<div></div>").html(b.params[f].toString()),!0),h>o&&(o=h);for(i=1,f=0;f<g.length;f++)2===g[f].name.length&&(i+=g[f].totalNode);j=p[0]*(100+o)+100,k=30*i,$(e).height(k),$(e).width(j),paper=d,paper.view.viewSize=[j,k],l.Parser._textOnCanvas(b.toString(),m.toString(),o,g),l.Parser._subnodeDisplay(b,m.toString(),o,g),l.Parser._textOnCanvas(b.toString(),m.toString(),o,g),l.Parser._arrowGenerator(),paper.view.draw()}},_nodeCounter:function(b,c,d,e){var f,g,h=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,i=0;if(b.isTerminal)f={name:c,childNode:0,totalNode:0},d.push(f);else{for(i=0,g=b.params.length;g>i;i++)h.Parser._nodeCounter(b.params[i],c+i,d,e);"0"!==c&&(f={name:c,childNode:g,totalNode:0},d.push(f)),e[0]++}},_totalNodeCounter:function(a){for(var b,c,d,e,f,g=0,h=a.length;h>g;g++){for(b=a[g].name,e=b.length,d=b.substring(0,e-1),c=g+1;h>c;c++)if(a[c].name===d){0!==a[g].totalNode?a[c].totalNode+=a[g].totalNode:(f=a[g].childNode,0===f&&(f=1),a[c].totalNode=a[c].totalNode+f);break}0===a[g].childNode&&(a[g].totalNode=1)}},_subnodeDisplay:function(b,c,d,e){var f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,h=0,i=0;if(!b.isTerminal&&(f=b.params.length,0!==f))for(;f>h;h++)g.Parser._subnodeDisplay(b.params[h],c+h,d,e),i=b.params[h].toString(),g.Parser._textOnCanvas(i,c+h,d,e)},_textOnCanvas:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,u=c.length,v=0;for(h=(u-1)*(100+d);u>v;v++)switch(v){case 0:i=20;break;default:for(k=c.substring(0,v+1),l=k.length,o=k[l-1],p=parseInt(o,10),f=0,f=p-1;f>=0;f--)for(m=k.split(""),m[l-1]=f.toString(),n=m.join(""),g=0,g=0;g<e.length;g++)if(e[g].name===n){i+=30*e[g].totalNode;break}}j=d+30,q=new Path.Rectangle({point:[h,i-12],size:[j,20],strokeWidth:2,strokeColor:"#000000"}),q.subNodeRoot=c,r=t.Parser._getTextWidth($("<div></div>").html(b),!0),s=(j-r)/2,b=new PointText({point:[h+s,i],content:b,fontSize:12,fillColor:"black"})},_arrowGenerator:function(){for(var a,b,c,d=paper.project.activeLayer.children,e=d.length,f=0,g=new Point,h=new Point,i=new Point;e>f;f++)if(f%2===0)for(a=d[f].subNodeRoot,a=a.substring(0,a.length-1),b=f;e>b;b++)d[b].subNodeRoot===a&&(g.x=(d[f].segments[0].point.x+d[f].segments[1].point.x)/2,g.y=(d[f].segments[0].point.y+d[f].segments[1].point.y)/2,h.x=(d[b].segments[2].point.x+d[b].segments[3].point.x)/2,h.y=(d[b].segments[2].point.y+d[b].segments[3].point.y)/2,g.y!==h.y?(i.x=(h.x+g.x)/2,i.y=h.y,c=new Path({segments:[i,[i.x,g.y],g],strokeWidth:2,strokeColor:"#000000"})):c=new Path({segments:[g,h],strokeWidth:2,strokeColor:"#000000"}))},_getTextWidth:function(a,b){b&&$("body").append(a);var c,d=a.html(),e="<span>"+d+"</span>";return a.html(e),c=a.find("span:first").width(),a.html(d),b&&a.detach(),c},_showConsole:function(a,b,c){return}}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.TreeProcedures=Backbone.Model.extend({},{_mathFunctions:a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.MathFunctions,_productions:a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Productions,OPERATOR_TEXT:{ADD:" plus ",SUBTRACT:" minus ",MULTIPLY:" multiplied by ",NEGATIVE:" negative ",DIVIDE:" divided by ",SIN:"sine of ",COS:"cos of ",TAN:"tan of ",CSC:"cosec of ",FACTORIAL:" factorial",NATURAL_LOG:"Natural log of ","\\pi":"Pi",e:" Eulers constant ",RECIPROCAL:"Reciprocal of ",ABS:"Absolute value of ",SIN_INV:"Inverse sine of ",COS_INV:"Inverse cos of ",TAN_INV:"Inverse tan of ",CSC_INV:"Inverse cosec of ",INV:"Inverse ",SQUARE:" squared",CUBE:" cube",POWER:" raised to ",SQUARE_ROOT:"Square root of ",CUBE_ROOT:"Cube root of ",ROOT:"root of ",OPEN_BRACKET:"open bracket ",CLOSE_BRACKET:" close bracket ",PERCENT:" Percentage",TH:"th ",RD:"rd ",ST:"st ",ND:"nd "},_toLatex:function(b){var c,d,e,f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(b.isTerminal!==!1)return"+"===b.sign?b.value:b.value<0?-1*b.value:b.sign+b.value;for(c=[],e=0;e<b.params.length;e++)c.push(g.TreeProcedures._toLatex(b.params[e])),g.Parser._showConsole(g.Parser._debugFlag.common,c,[]);switch(d="","-"===b.sign&&(d="-"),b.name){case"do":return d+=c[0];case"^":return d+=b.params[0].isTerminal===!0?c[0]:g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[0].name)?"\\left("+c[0]+"\\right)":c[0],d+=b.params[1].isTerminal===!0?"^"+c[1]:g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[1].name)?"^\\left("+c[1]+"\\right)":"^"+c[1];case"+":for(d+=c[0],f=1;f<c.length;f++)d+="+"+c[f];return d;case"\\cdot":for(d+=b.params[0].isTerminal===!1&&g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[0].name)?"\\left("+c[0]+"\\right)":c[0],f=1;f<c.length;f++)d+=b.params[f].isTerminal===!0?"\\cdot "+c[f]:g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[f].name)?"\\cdot \\left("+c[f]+"\\right)":"\\cdot "+c[f];return d;case"\\frac":return d+="\\frac {"+c[0]+"}{"+c[1]+"}";case"\\sqrt":return d="",d+=b.params[0].isTerminal===!1?"\\sqrt [\\left("+c[0]+"\\right)]":"\\sqrt ["+c[0]+"]",d=b.params[1].isTerminal===!1?d+" {\\left("+c[1]+"\\right)}":d+" {"+c[1]+"}";case"\\log_":return d="",d+=b.params[0].isTerminal===!1?"\\log_{\\left("+c[0]+"\\right)}":"\\log_{"+c[0]+"}",d=d+" \\left("+c[1]+"\\right)";case"\\log":case"\\ln":case"\\sin":case"\\cos":case"\\tan":case"\\csc":case"\\sec":case"\\cot":case"\\arcsin":case"\\arccos":case"\\arctan":case"\\arccsc":case"\\arcsec":case"\\arccot":case"\\sinh":case"\\cosh":case"\\tanh":case"\\csch":case"\\sech":case"\\coth":return d+=b.params[0].isTerminal===!1?b.name+" \\left("+c[0]+"\\right)":b.name+" "+c[0];case"\\ceil":case"\\floor":case"\\round":case"\\abs":case"\\exp":return d+=b.name+" \\left("+c[0]+"\\right)";case"!":return d="",d=b.params[0].isTerminal===!1?"\\left("+c[0]+"\\right)!":c[0]+"!";case"\\lcm":case"\\gcd":case"\\mod":case"\\min":case"\\max":case"\\nCr":case"\\nPr":return d+=b.params[0].isTerminal===!1?b.name+" \\left( \\left( "+c[0]+"\\right) , ":b.name+" \\left( "+c[0]+" , ",d+=b.params[1].isTerminal===!1?" \\left( "+c[1]+"\\right) \\right)":c[1]+"\\right)";case"\\prod":case"\\sum":return d+=b.params[0].isTerminal===!1?b.name+"{n=\\left("+c[0]+"\\right)}^":b.name+"{n="+c[0]+"}^",d+=b.params[1].isTerminal===!1?"{ \\left("+c[1]+"\\right)}":"{"+c[1]+"}",d+=b.params[2].isTerminal===!1?" \\left("+c[2]+"\\right)":c[2];case"\\%":return d+=b.params[0].isTerminal?b.params[0].value+b.name:c[0]+b.name}},getNumberPostFix:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,g=f.TreeProcedures.OPERATOR_TEXT;if(isNaN(b)===!0)return"";if(c=b.toString(),d=c.length,-1!==c.indexOf(".")||"1"===c.charAt(d-2))return g.TH;switch(e=c.charAt(c.length-1)){case"1":return g.ST;case"2":return g.ND;case"3":return g.RD;default:return g.TH}},_toAccessible:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,g={negativeCaseType:null,expression:""},h=f.TreeProcedures.OPERATOR_TEXT;if(g.negativeCaseType=void 0===b.negativeCaseType?0:b.negativeCaseType,b.isTerminal!==!1)return"+"===b.sign?("digit"===b.type?void 0!==b.constantSubstituted?g.expression=h[b.constantSubstituted]:g.expression=f.TreeProcedures._getAccessibleStringForNumber(b.value):g.expression=b.value,g):("digit"===b.type?void 0!==b.constantSubstituted?b.negativeCaseType!==f.Parser._NEGATIVE_CASE_TYPES.SINGLE&&b.negativeCaseType!==f.Parser._NEGATIVE_CASE_TYPES.NONE?g.expression=h.NEGATIVE+h[b.constantSubstituted]:g.expression=h[b.constantSubstituted]:b.negativeCaseType!==f.Parser._NEGATIVE_CASE_TYPES.SINGLE&&b.negativeCaseType!==f.Parser._NEGATIVE_CASE_TYPES.NONE?g.expression=h.NEGATIVE+f.TreeProcedures._getAccessibleStringForNumber(b.value):g.expression=f.TreeProcedures._getAccessibleStringForNumber(b.value):g.expression=h.NEGATIVE+b.value,g);for(c=[],d=0;d<b.params.length;d++)c.push(f.TreeProcedures._toAccessible(b.params[d])),f.Parser._showConsole(f.Parser._debugFlag.common,c,[]);switch(g.expression="",g.negativeCaseType===f.Parser._NEGATIVE_CASE_TYPES.NEGATIVE&&(g.expression=h.NEGATIVE),b.name){case"do":return"{"==b.value||"}"==b.value?g.expression="":b.params[0].isTerminal===!1&&"do"!==b.params[0].name?g.expression+=h.OPEN_BRACKET+c[0].expression+h.CLOSE_BRACKET:g.expression+=c[0].expression,g;case"^":return b.params[0].isTerminal===!0?g.expression+=c[0].expression:f.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>f.ParsingProcedures.getOperatorPrecedenceIndex(b.params[0].name)?g.expression+=c[0].expression:g.expression+=c[0].expression,b.params[1].isTerminal===!0?2===Number(b.params[1].value)?g.expression+=h.SQUARE:3===Number(b.params[1].value)?g.expression+=h.CUBE:g.expression+=h.POWER+c[1].expression:f.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>f.ParsingProcedures.getOperatorPrecedenceIndex(b.params[1].name)?g.expression+=h.POWER+c[1].expression:g.expression+=h.POWER+c[1].expression,g;case"+":for(g.expression+=c[0].expression,e=1;e<c.length;e++)switch(c[e].negativeCaseType){case f.Parser._NEGATIVE_CASE_TYPES.NONE:case f.Parser._NEGATIVE_CASE_TYPES.NEGATIVE:g.expression+=h.ADD+c[e].expression;break;case f.Parser._NEGATIVE_CASE_TYPES.SINGLE:g.expression=g.expression+h.SUBTRACT+c[e].expression.replace("-","");break;case f.Parser._NEGATIVE_CASE_TYPES.DOUBLE:g.expression+=h.SUBTRACT+h.NEGATIVE+c[e].expression;break;case f.Parser._NEGATIVE_CASE_TYPES.PLUS_SINGLE:g.expression+=h.ADD+c[e].expression.replace("-","")}return g;case"\\cdot":for(b.params[0].isTerminal===!1&&f.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>f.ParsingProcedures.getOperatorPrecedenceIndex(b.params[0].name)?g.expression+="("+c[0].expression+")":g.expression+=c[0].expression,e=1;e<c.length;e++)b.params[e].isTerminal===!0?g.expression+=h.MULTIPLY+c[e].expression:f.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>f.ParsingProcedures.getOperatorPrecedenceIndex(b.params[e].name)?g.expression+=h.MULTIPLY+c[e].expression:g.expression+=h.MULTIPLY+c[e].expression;return g;case"\\frac":return b.params[0].isTerminal===!1?g.expression+=h.OPEN_BRACKET+c[0].expression+h.CLOSE_BRACKET:g.expression+=c[0].expression,g.expression+=h.DIVIDE,b.params[1].isTerminal===!1?g.expression+=h.OPEN_BRACKET+c[1].expression+h.CLOSE_BRACKET:g.expression+=c[1].expression,g;case"\\sqrt":return g.expression="",b.params[0].isTerminal===!0?2===Number(b.params[0].value)?g.expression+=h.SQUARE_ROOT:3===Number(b.params[0].value)?g.expression+=h.CUBE_ROOT:g.expression+=c[0].expression+f.TreeProcedures.getNumberPostFix(c[0].expression)+h.ROOT:g.expression+=c[0].expression+f.TreeProcedures.getNumberPostFix(c[0].expression)+h.ROOT,b.params[1].isTerminal===!1?g.expression+=h.OPEN_BRACKET+c[1].expression+h.CLOSE_BRACKET:g.expression+=c[1].expression,g;case"\\log_":return g.expression="",g.expression+="Log of ",g.expression+=c[1].expression,g.expression+=" to the base "+c[0].expression,g;case"\\log":return g.expression+="Log of "+c[0].expression+" to the base 10",g;case"\\ln":return g.expression+=h.NATURAL_LOG+c[0].expression,g;case"\\sin":return b.params[0].isTerminal?g.expression+=h.SIN+c[0].expression:g.expression+=h.SIN+h.OPEN_BRACKET+c[0].expression+h.CLOSE_BRACKET,g;case"\\csc":return b.params[0].isTerminal?g.expression+=h.CSC+c[0].expression:g.expression+=h.CSC+h.OPEN_BRACKET+c[0].expression+h.CLOSE_BRACKET,g;case"\\cos":case"\\tan":case"\\sec":case"\\cot":case"\\sinh":case"\\cosh":case"\\tanh":case"\\csch":case"\\sech":case"\\coth":case"\\ceil":case"\\floor":case"\\round":case"\\exp":return b.params[0].isTerminal?g.expression+=b.name.substring(1)+" of "+c[0].expression:g.expression+=b.name.substring(1)+" of "+h.OPEN_BRACKET+c[0].expression+h.CLOSE_BRACKET,g;case"\\abs":return b.params[0].isTerminal?g.expression+=h.ABS+c[0].expression:g.expression+=h.ABS+h.OPEN_BRACKET+c[0].expression+h.CLOSE_BRACKET,g;case"\\arcsin":return g.expression+=h.SIN_INV+c[0].expression,g;case"\\arccsc":return g.expression+=h.CSC_INV+c[0].expression,g;case"\\arccos":case"\\arctan":case"\\arcsec":case"\\arccot":return g.expression+=h.INV+b.name.replace("\\arc","")+" of "+c[0].expression,g;case"!":return g.expression+=c[0].expression+h.FACTORIAL,g;case"\\lcm":case"\\gcd":case"\\mod":case"\\min":case"\\max":case"\\nCr":case"\\nPr":return g.expression+=f.TreeProcedures._getAccessibleName(b.name)+" of "+c[0].expression+" and "+c[1].expression,g;case"\\prod":case"\\sum":return g.expression+=b.name.replace("\\","")+" from "+c[0].expression+" equal to ",b.params[1].isTerminal===!1?g.expression+=h.OPEN_BRACKET+c[1].expression+h.CLOSE_BRACKET:g.expression+=c[1].expression,g.expression+=" to ",b.params[2].isTerminal===!1?g.expression+=h.OPEN_BRACKET+c[2].expression+h.CLOSE_BRACKET:g.expression+=c[2].expression,g.expression+=" of ",g.expression+=c[3].expression,g;case"\\%":return g.expression+=c[0].expression+h.PERCENT,g}},_DECIMAL_POINT:".",_getAccessibleStringForNumber:function(b){var c,d,e,f,g,h="",i=!1,j=0,k=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(isNaN(b)===!0)return b;if(c=b.toString(),-1!==c.indexOf(k.TreeProcedures._DECIMAL_POINT)&&(g=c.split(k.TreeProcedures._DECIMAL_POINT),i=!0,c=g[0]),e=c.length,4>e)return b;for(f=e-1;f>=0;f--)(3===d||d>3&&(d-(3+j))%3===0)&&(h=","+h,j++),h=c.charAt(f)+h,d=h.length;return i&&(h+=k.TreeProcedures._DECIMAL_POINT+g[1]),h},_getAccessibleName:function(a){var b={"\\lcm":"least common multiplier","\\gcd":"greatest common divisor","\\mod":"modulas","\\min":"minimum","\\max":"maximum",
"\\nCr":"combinations","\\nPr":"permutations","\\ceil":"ceil value","\\floor":"floor value","\\round":"rounded value","\\abs":"absolute value","\\exp":"exponential value"};return void 0===b[a]?"":b[a]},_clone:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(b.isTerminal===!0)c=f.TreeProcedures._getParseTreeTerminalObject(void 0,b.type,b.sign,b.units),c.isEmpty=b.isEmpty,c.value=b.value;else{for(c=f.TreeProcedures._getParseTreeNodeObject(void 0,b.name,b.sign,void 0),d=[],e=0;e<b.params.length;e++)c._addParam(f.TreeProcedures._clone(b.params[e]));c.allTermsDigits=b.allTermsDigits,c.isEmpty=b.isEmpty}return c},convertToSolvableForm:function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;for(c=b.getLeftRoot(),d=b.getFunctionVariable(),e=b.getParamVariable(),c.expand(d,b),y.Parser._showConsole(y.Parser._debugFlag.common,"%c[STAGE6 - Complete]Expansion Complete",[y.Parser._YSTYLE]),y.Parser._deploy||y.Parser._printLatex(c,6,!0),y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"%c[CHECKPOINT] after expansion... "+y.TreeProcedures._toLatex(c),[y.Parser._BLUE_STYLE]),c.isTerminal===!1&&"+"===c.name?k=y.TreeProcedures._extractAllParams(c):(k=[],k.push(y.TreeProcedures._clone(c)),y.TreeProcedures._removeAllParams(c)),l=[],m=[],n=[];k.length>0;){if(f=y.TreeProcedures._getFunctionVariableSegregationIndex(k[0],d),void 0===f)return void y.Parser._showConsole(y.Parser._debugFlag.common,"%c[FAIL - STAGE7]CANT CONVERT THIS EQUATION TO SOLVABLE FORM>>> SOMETHING IS WRONG",[y.Parser._NSTYLE]);switch(y.Parser._showConsole(y.Parser._debugFlag.convert2q,"Segregation index is "+f,[]),f){case 2:g=k.shift(),y.TreeProcedures._commonOutFunctionVariable(g,d),l.push(g);break;case 1:g=k.shift(),y.TreeProcedures._commonOutFunctionVariable(g,d),m.push(g);break;case 0:n.push(k.shift());break;default:return void y.Parser._showConsole(y.Parser._debugFlag.common,"%c[FAIL - STAGE7]CANT CONVERT THIS EQUATION TO SOLVABLE FORM>>> SOMETHING IS WRONG",[y.Parser._NSTYLE])}}if(l.length>0){if(r=y.TreeProcedures._getParseTreeNodeObject(void 0,"\\cdot","+",void 0),o=y.TreeProcedures._getParseTreeNodeObject(r,"^","+",void 0),p=y.TreeProcedures._getParseTreeTerminalObject(o,"var","+"),p.value=d,q=y.TreeProcedures._getParseTreeTerminalObject(o,"digit","+"),q.value=2,l.length>1)for(h=y.TreeProcedures._getParseTreeNodeObject(r,"+","+",void 0);l.length>0;)h._addParam(l.shift());else h=l.shift(),r._addParam(h);h.isTerminal===!1&&h.simplify(b)}if(m.length>0){if(s=y.TreeProcedures._getParseTreeNodeObject(void 0,"\\cdot","+",void 0),p=y.TreeProcedures._getParseTreeTerminalObject(s,"var","+"),p.value=d,m.length>1)for(i=y.TreeProcedures._getParseTreeNodeObject(s,"+","+",void 0);m.length>0;)i._addParam(m.shift());else i=m.shift(),s._addParam(i);i.isTerminal===!1&&i.simplify(b)}if(n.length>0){if(n.length>1)for(j=y.TreeProcedures._getParseTreeNodeObject(void 0,"+","+",void 0);n.length>0;)j._addParam(n.shift());else j=n.shift();j.isTerminal===!1&&j.simplify(b)}for(u=[r,s,j],v=0,t=0;t<u.length;t++)void 0!==u[t]&&(v++,w=u[t]);if(v>0)for(y.TreeProcedures._convertTreeNodeTo(c,"+"),t=0;t<u.length;t++)void 0!==u[t]&&c._addParam(u[t]);else y.TreeProcedures._convertTreeNodeTo(c,w);b.setA(h),b.setB(i),b.setC(j),b.setFunctionCode(y.TreeProcedures._getMobileFunction(b)),b.setParamVariableOrder(void 0!==b.getA()?2:1),void 0!==h?y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"A:"+y.TreeProcedures._toLatex(h),[]):y.Parser._showConsole(y.Parser._debugFlag.common,"A:undefined",[]),void 0!==i?y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"B:"+y.TreeProcedures._toLatex(i),[]):y.Parser._showConsole(y.Parser._debugFlag.common,"B:undefined",[]),void 0!==j?y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"C:"+y.TreeProcedures._toLatex(j),[]):y.Parser._showConsole(y.Parser._debugFlag.common,"C:undefined",[]),y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"%c[STAGE7 - SUCCESS]Converted to quadratic form "+y.TreeProcedures._toLatex(c),[y.Parser._YSTYLE]),y.Parser._showConsole(y.Parser._debugFlag.common,b,[]),y.Parser._deploy||y.Parser._printLatex(c,7,!1),("linear"===b.getSpecie()||"quadratic"===b.getSpecie())&&(x=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.TreeProcedures.solveEquation(b),y.Parser._showConsole(y.Parser._debugFlag.info,"%c INFO%c: finding solutions for eqution "+x,[y.Parser._BLUE_STYLE,void 0]))},_getMobileFunction:function(b){var c,d,e,f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return c=void 0!==b.getA()?g.TreeProcedures._toMobileFunction(b.getA(),b):0,d=void 0!==b.getB()?g.TreeProcedures._toMobileFunction(b.getB(),b):0,void 0!==b.getC()&&(e=g.TreeProcedures._toMobileFunction(b.getC(),b)),f="var solution,a = ("+c+"),b=("+d+"), c=("+e+");solution = []; a !== 0 ? (solution[0] = (-b + Math.sqrt(b*b - 4*a*c))/(2*a),solution[1] = (-b - Math.sqrt(b*b - 4*a*c))/(2*a)) :(solution[0] = -c/b,solution[1] = solution[0]); return solution;",f.search("findFactorial")>-1&&(f=g.MathFunctions.findFactorialString+f),f.search("gammaFunction")>-1&&(f=g.MathFunctions._gammaFunctionString+f),f.search("sum")>-1&&(f=g.MathFunctions.getSumString()+f),f.search("prod")>-1&&(f=g.MathFunctions.getProdString()+f),f},_toMobileFunction:function b(c,d,e){var f,g,h,i,j,k,l,m,n=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(void 0!==c){if(f="",c.isTerminal)if("var"===c.type){if(c.value===d.getParamVariable())return"-"===c.sign?"(param*-1)":"param"}else if("const"===c.type)switch(c.value){case"\\pi":f="Math.PI";break;case"e":f="Math.E";break;case"\\theta":f='constants["\\\\theta"]';break;default:f=e&&e===c.value?c.value:"constants['"+c.value+"']"}else f=c.value;else{for(g=[],h=e,("\\sum"===c.name||"\\prod"===c.name)&&(h=c.params[0].value),l=0;l<c.params.length;l++)g[l]=b(c.params[l],d,h);switch("rad"===d.getUnits().angle?(j="angle="+g[0]+",",k=""):(j="angle="+g[0]+",angle = angle*Math.PI /180,",k=",angle = angle*Math.PI /180"),m="",c.name){case"+":for(i="+",f=g[0],l=1;l<g.length;l++)f+=i+g[l];break;case"\\cdot":for(i="*",f=g[0],l=1;l<g.length;l++)f+=i+g[l];break;case"^":case"pow":f="raised=0,absBase=0,sign=0,num="+g[0]+",pow="+g[1]+",num===0&&pow===0?NaN:pow%1!==0?(raised=1/pow,absBase=Math.abs(num),sign=num>=0?1:-1,raised%2===0 && sign ===-1?Math.pow(num,pow):sign*Math.pow(absBase,pow)):Math.pow(num,pow)";break;case"\\frac":f=g[0]+"/"+g[1];break;case"\\sqrt":f="num=("+g[1]+"),pow = "+g[0]+",result=(isFinite(num)&&isFinite(pow)&&pow%2===0&&num<0)?NaN:pow<0?(1/Math.pow(Math.abs(num),(1/-pow))):Math.pow(Math.abs(num),1/pow),num<0?result*-1:result";break;case"\\ln":f="Math.log("+g[0]+")";break;case"\\log":f="Math.log("+g[0]+")/Math.LN10";break;case"\\log_":f="Math.log("+g[1]+")/Math.log("+g[0]+")";break;case"\\sin":case"\\cos":f=j+n.TreeProcedures.getMathFunction(c.name)+"(angle)";break;case"\\tan":f=j+"Math.sin(angle)/Math.cos(angle)";break;case"\\sec":f=j+"1/Math.cos(angle)";break;case"\\csc":f=j+"1/Math.sin(angle)";break;case"\\cot":f=j+"Math.cos(angle)/Math.sin(angle)";break;case"\\sinh":f=j+"(Math.pow(Math.E, angle) - Math.pow(Math.E, -angle)) / 2";break;case"\\cosh":f=j+"(Math.pow(Math.E, angle) + Math.pow(Math.E, -angle)) / 2";break;case"\\tanh":f=j+"Math.pow(Math.E, 2 * angle) - 1) / (Math.pow(Math.E, 2 * angle) + 1";break;case"\\csch":f=j+"2 / (Math.pow(Math.E, angle) - Math.pow(Math.E, -angle))";break;case"\\sech":f=j+"2 / (Math.pow(Math.E, angle) + Math.pow(Math.E, -angle))";break;case"\\coth":f=j+"Math.pow(Math.E, 2 * angle) + 1) / (Math.pow(Math.E, 2 * angle) - 1";break;case"\\arcsin":f="angle = "+g[0]+",Math.asin(angle)"+k;break;case"\\arccos":f="angle = "+g[0]+",Math.acos(angle)"+k;break;case"\\arctan":f="angle = "+g[0]+",Math.atan(angle)"+k;break;case"\\arccsc":f="angle = "+g[0]+",Math.asin(1/angle)"+k;break;case"\\arcsec":f="angle = "+g[0]+",Math.acos(1/angle)"+k;break;case"\\arccot":f="angle = "+g[0]+",Math.PI/2 - Math.atan(angle)"+k;break;case"\\arsinh":f="num = "+g[0]+",Math.log(num + Math.pow(num*num + 1 ,1/2))";break;case"\\arcosh":f="num = "+g[0]+",Math.log(Math.pow(num*num - 1 ,1/2))";break;case"\\artanh":f="num = "+g[0]+",Math.pow(num*num - 1 ,1/2)";break;case"\\arcsch":f="num = "+g[0]+",1/num + Math.sqrt(1/(num*num + 1))";break;case"\\arsech":f="num = "+g[0]+",1/num + Math.sqrt(1/(num*num - 1))";break;case"\\arcoth":f="num = "+g[0]+",0.5* Math.log((num+1)/(num-1))";break;case"!":f="num = "+g[0]+",num>170||!isFinite(num)?Infinity:num === 0?1:num%1===0 && num > 0?(findFactorial(num)):num*gammaFunction(num)";break;case"\\gcd":case"\\lcm":f=g[0];break;case"\\ceil":f="Math.ceil("+g[0]+")";break;case"\\floor":f="Math.floor("+g[0]+")";break;case"\\round":f="Math.round("+g[0]+")";break;case"\\abs":f="Math.abs("+g[0]+")";break;case"\\min":f="Math.min("+g[0]+","+g[1]+")";break;case"\\max":f="Math.max("+g[0]+","+g[1]+")";break;case"\\mod":f="num0="+g[0]+",num1="+g[1]+",num1===0?NaN:num0>0 === num1>0?num0%num1:num1+num0%num1";break;case"\\nCr":f="num0="+g[0]+",num1="+g[1]+",num0<0||num1<0?0:(num0 = Math.floor(Math.abs(num0)),num1 = Math.floor(Math.abs(num1)),num0<num1?0:findFactorial(num0)/(findFactorial(num1) - findFactorial(num0 - num1)))";break;case"\\nPr":f="num0="+g[0]+",num1="+g[1]+",num0<0||num1<0?0:(num0 = Math.floor(Math.abs(num0)),num1 = Math.floor(Math.abs(num1)),num0<num1?0:findFactorial(num0)/findFactorial(num0 - num1))";break;case"\\exp":f="Math.exp("+g[0]+")";break;case"\\sum":f='sum("'+c.params[0].value+'","'+g[1]+'","'+g[2]+'","'+g[3]+'",param,constants)';break;case"\\prod":f='prod("'+c.params[0].value+'","'+g[1]+'","'+g[2]+'","'+g[3]+'",param,constants)';break;default:f=0}}return f="-"===c.sign?"-("+f+")":"("+f+")"}},getMathFunction:function(a){switch(a){case"\\sin":return"Math.sin";case"\\cos":return"Math.cos";case"\\tan":return"Math.tan"}},solveEquation:function(b,c){var d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return d.TreeProcedures._solveCartesian(b,c)},_solvePolar:function(){},_solveCartesian:function(b,c){var d,e,f,g,h,i,j=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,k=b.getA(),l=b.getB(),m=b.getC(),n=b.getConstants(),o=b.getParamVariable();if(j.Parser._debugFlag.solve&&j.Parser._showConsole(j.Parser._debugFlag.common,"For paramValue = "+c,[]),void 0!==k&&(d=j.TreeProcedures._substituteParamVariableAndGetValue(k,n,o,c)),j.Parser._showConsole(j.Parser._debugFlag.solve,"A="+d,[]),void 0!==l&&(e=j.TreeProcedures._substituteParamVariableAndGetValue(l,n,o,c)),j.Parser._showConsole(j.Parser._debugFlag.solve,"B="+e,[]),void 0!==m&&(j.Parser._deploy||j.Parser._showConsole(j.Parser._debugFlag.convert2q,"C is "+j.TreeProcedures._toLatex(m),[]),f=j.TreeProcedures._substituteParamVariableAndGetValue(m,n,o,c)),j.Parser._showConsole(j.Parser._debugFlag.solve,"C="+f,[]),void 0===d){if(j.Parser._showConsole(j.Parser._debugFlag.convert2q,"cant use quadratic formula since a = 0",[]),void 0===e)return void j.Parser._showConsole(j.Parser._debugFlag.common,"%c[FAIL - STAGE7]Cant process this equation",[j.Parser._NSTYLE]);g=h=void 0===f?void 0:-f/e}else j.Parser._showConsole(j.Parser._debugFlag.convert2q,"Using quadratic formula since a != 0",[]),void 0===e&&(e=0),void 0===f&&(f=0),i=e*e-4*d*f,0>i?(g=h="undefined",j.Parser._showConsole(j.Parser._debugFlag.convert2q,"Solution is complex",[])):(g=(-e+Math.sqrt(i))/(2*d),h=0===i?g:(-e-Math.sqrt(i))/(2*d));return g=Number(g),h=Number(h),[g,h]},_substituteParamVariableAndGetValue:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(o.Parser._showConsole(o.Parser._debugFlag.convert2q,"Substituting param "+d+" with value "+e,[]),b.isTerminal===!0)return"digit"===b.type?"-"===b.sign?-1*Number(b.value):Number(b.value):"var"===b.type?b.value===d?"-"===b.sign?-1*Number(e):Number(e):void o.Parser._showConsole(o.Parser._debugFlag.common,"%c[FAIL-STAGE8]Unknown freevar occured "+b.value,[o.Parser._NSTYLE]):void 0!==o.Parser._constants[b.value]?"-"===b.sign?-1*o.Parser._constants[b.value]:o.Parser._constants[b.value]:void 0!==c[b.value]?"-"===b.sign?-1*c[b.value]:c[b.value]:void o.Parser._showConsole(o.Parser._debugFlag.common,"%c[FAIL-STAGE8]unsubstituted constant occured "+b.value,[o.Parser._NSTYLE]);switch(f=[],h="-"===b.sign?-1:1,b.name){case"\\sum":case"\\prod":if(k=c[b.params[0].value],l=o.TreeProcedures._substituteParamVariableAndGetValue(b.params[1],c,d,e),m=o.TreeProcedures._substituteParamVariableAndGetValue(b.params[2],c,d,e),isNaN(l)||isNaN(m)||void 0===l||void 0===m||!isFinite(m)||!isFinite(l))return void 0;for(n=l;m>=n;n++){if(c[b.params[0].value]=n,g=o.TreeProcedures._substituteParamVariableAndGetValue(b.params[3],c,d,e),void 0===g)return void o.Parser._showConsole(o.Parser._debugFlag.common,"%c[FAIL-STAGE8]Cant Calculate value of "+b.name,[o.Parser._NSTYLE]);f.push(g)}j="\\sum"===b.name?o.TreeProcedures._mathFunctions.performMathematicalCalculations("+",f,o.TreeProcedures._getUnits(b)):o.TreeProcedures._mathFunctions.performMathematicalCalculations("\\cdot",f,o.TreeProcedures._getUnits(b));break;default:for(i=0;i<b.params.length;i++){if(g=o.TreeProcedures._substituteParamVariableAndGetValue(b.params[i],c,d,e),void 0===g)return void o.Parser._showConsole(o.Parser._debugFlag.common,"%c[FAIL-STAGE8]Cant Calculate value of "+b.name,[o.Parser._NSTYLE]);f.push(g)}j=o.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,f,o.TreeProcedures._getUnits(b))}return null===j?void 0:h*j},_commonOutFunctionVariable:function(b,c){var d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,g=!1;if(b.isTerminal){if(b.value===c)return b.value=1,b.type="digit",1}else switch(b.name){case"+":for(d=0;d<b.params.length;d++)e=f.TreeProcedures._commonOutFunctionVariable(b.params[d],c);break;case"\\cdot":for(d=0;d<b.params.length;d++)e=f.TreeProcedures._commonOutFunctionVariable(b.params[d],c),1===e&&(g=!0);if(g===!0)return 1;break;case"\\frac":return f.TreeProcedures._commonOutFunctionVariable(b.params[0],c);case"^":return f.TreeProcedures._commonOutFunctionVariable(b.params[0],c)}},_add:function(b,c){var d,e,f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;for(b.isTerminal===!1&&"+"===b.name?(d=b,c.isTerminal===!1&&"+"===c.name?(e=g.TreeProcedures._extractAllParams(c),c.incinerate()):e=[c]):c.isTerminal===!1&&"+"===c.name?(d=c,b.isTerminal===!1&&"+"===b.name?(e=g.TreeProcedures._extractAllParams(b),b.incinerate()):e=[b]):(d=g.TreeProcedures._getParseTreeNodeObject(void 0,"+","+",void 0),e=[b,c]),f=0;f<e.length;f++)d._addParam(e[f]);return d},multiply:function(b,c){var d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(b.isTerminal===!1&&"\\cdot"===b.name)if(d=b,c.isTerminal===!0)d._addParam(c);else{for(e=0;e<c.params.length;e++)d._addParam(c.params[e]);c.incinerate()}else if(c.isTerminal===!1&&"\\cdot"===c.name)if(d=c,b.isTerminal===!0)d._addParam(b);else{for(e=0;e<b.params.length;e++)d._addParam(b.params[e]);b.incinerate()}else d=f.TreeProcedures._getParseTreeNodeObject(void 0,"\\cdot","+",void 0),d._addParam(b),d._addParam(c);return d},updateFreeVars:function(){},combineLeftRightTree:function(b){var c,d,e,f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,h=b.getRightExpression(),i=b.getLeftExpression(),j=b.getRightRoot(),k=b.getLeftRoot();if(void 0!==j&&null!==j){if(g.Parser._showConsole(g.Parser._debugFlag.common,"Right tree is "+b.rightRoot,[]),g.TreeProcedures.negateTree(j),j.isTerminal===!0&&0===g.TreeProcedures._getValueFromParam(j)&&k.isTerminal===!1)return;b.setLeftRoot(g.TreeProcedures._add(k,j)),b.setRightRoot(g.TreeProcedures._getParseTreeTerminalObject(void 0,"digit","+",b.getUnits())),b.getRightRoot().value="0"}for(c in h.freevars)d=i.freevars[c],e=h.freevars[c],f=d?"c"===d?d:"c"===e?e:d>e?d:e:e,i.freevars[c]=f,delete h.freevars[c]},negateTree:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,e=b.isTerminal===!1&&"+"===b.name;if(e===!0)for(c=0;c<b.params.length;c++)d.TreeProcedures.negateTree(b.params[c]);else"+"===b.sign?b.sign="-":b.sign="+"},generateTree:function(b,c,d){function e(a){if(void 0!==a.parentNode){var b=a.parentNode.params.indexOf(a),c=a.parentNode.params[b+1];return void 0===c?a.parentNode:c}}if(void 0!==b){for(var f,g,h,i,j=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,k=[];c<b.length;){if(h=b[c],j.Parser._showConsole(j.Parser._debugFlag.tree,"...Processing object "+h,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"...Current Parent is "+g,[]),"number"==typeof h){if(i=j.ParsingProcedures.getStackCode(k),g=j.TreeProcedures._getNodeForRule(g,h,i,d),void 0===f)for(f=g;void 0!==f.parentNode;)f=f.parentNode;j.Parser._showConsole(j.Parser._debugFlag.tree,"rule returned "+g,[])}else if("func"===h.type)j.Parser._showConsole(j.Parser._debugFlag.tree,"ignoring func token "+h,[]),h.value===g.name?(j.Parser._showConsole(j.Parser._debugFlag.tree,"%cCHECK...function name matches with currentNode "+h+"<>"+g,[j.Parser._YSTYLE]),g.sign=h.sign,g.negativeCaseType=h.negativeCaseType):j.Parser._showConsole(j.Parser._debugFlag.tree,"%cFAIL...function name does not match with currentNode "+h+"<>"+g,[j.Parser._NSTYLE]);else if("delim"===h.type){if(j.Parser._showConsole(j.Parser._debugFlag.tree,"skipping delimiter "+h,[]),","===h.value&&!j.Parser._isCommaFunction(g.name))for(;!j.Parser._isCommaFunction(g.name);)g=e(g);for(j.ParsingProcedures.recordBracket(k,h.value),"do"===g.name&&(g.sign=h.sign,g.negativeCaseType=h.negativeCaseType);g.liberationCode>j.ParsingProcedures.getStackCode(k)&&(j.Parser._showConsole(j.Parser._debugFlag.common,"Current node type "+g.type,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"shifting up parent because "+g+" is Delimiter found... parent shift from "+g+" to "+g.parentNode,[]),g=e(g),void 0!==g););}else if("opr"===h.type){if(j.Parser._showConsole(j.Parser._debugFlag.tree,"skipping operator "+h,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"Operator found...shifting parent from "+g+" to "+g.parentNode+h,[]),h.value!==g.name){do j.Parser._showConsole(j.Parser._debugFlag.tree,h.value+"<> "+g.name,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"!!!!!!!!!!!!!!!!!!! current operator does not match the current node !!!!!!!!!!!!! SHOULD SHIFT parent up to!!"+g.parentNode,[]),g=e(g);while(void 0!==g&&h.value!==g.name)}else j.Parser._showConsole(j.Parser._debugFlag.tree,"Operator "+g.value+" confirms with the parent >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>",[]);void 0!==g&&h.value===g.name?(j.Parser._showConsole(j.Parser._debugFlag.tree,"%cCHECK...OPERATOR name matches with currentNode "+h+"<>"+g,[j.Parser._YSTYLE]),g.sign=h.sign,g.negativeCaseType=h.negativeCaseType):j.Parser._showConsole(j.Parser._debugFlag.common,"%cFAIL...OPERATOR name does not match with currentNode "+h+"<>"+g,[j.Parser._NSTYLE])}else if("digit"===h.type||"const"===h.type||"var"===h.type){if(g.isTerminal===!1)return void j.Parser._showConsole(j.Parser._debugFlag.tree,"!!!!!!!!!!!!!!!! ERROR terminal expected found NODE------------",[]);j.Parser._showConsole(j.Parser._debugFlag.tree,"+++ found terminal "+h+" will be filled into shell "+g,[]),g.sign=h.sign,g.negativeCaseType=h.negativeCaseType,g.value=h.value,g.type=h.type,g.isEmpty=!1,void 0!==h.constantSubstituted&&(g.constantSubstituted=h.constantSubstituted)}else j.Parser._showConsole(j.Parser._debugFlag.tree,"!!!!!!!!!!!!!!!!!!!!!!!!!!! DONT KNOW WHAT TO DO WITH "+h,[]);if(void 0!==g)for(j.Parser._showConsole(j.Parser._debugFlag.tree,"Checking stackcode "+g+" "+g.liberationCode+" <> "+j.ParsingProcedures.getStackCode(k),[]);g.isEmpty===!1&&j.TreeProcedures.isOperator(g.name)===!1&&(j.Parser._showConsole(j.Parser._debugFlag.tree,"Current node type "+g.type,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"shifting up parent because "+g+" is NOT EMPTY parent shift from "+g+" to "+e(g),[]),g=e(g),void 0!==g););if(c++,void 0===g)break}return f}},isOperator:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return-1!==c.TreeProcedures._productions._operatorsInPrecedenceOrder.indexOf(b)},_getNodeForRule:function(b,c,d,e){var f,g,h,i,j=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,k=j.TreeProcedures._productions.treeGenerationRules[c],l=k.split(" "),m=b;if(l.length>0&&("node.\\sum"===l[0]||"node.\\prod"===l[0])){for(i=0;i<l.length;i++)f=l[i].split("."),"node"===f[0]?m=j.TreeProcedures._getParseTreeNodeObject(m,f[1],"+",d):void 0===h?h=j.TreeProcedures._getParseTreeTerminalObject(m,f[1],"+",e):j.TreeProcedures._getParseTreeTerminalObject(m,f[1],"+",e),void 0===g&&(g=m);m=h}else for(i=0;i<l.length;i++)f=l[i].split("."),m="node"===f[0]?j.TreeProcedures._getParseTreeNodeObject(m,f[1],"+",d):j.TreeProcedures._getParseTreeTerminalObject(m,f[1],"+",e),void 0===g&&(g=m);return j.Parser._showConsole(j.Parser._debugFlag.common,"------ Rule "+c+" Processing complete---------------",[]),j.Parser._showConsole(j.Parser._debugFlag.common,"returning "+m,[]),m},_getParseTreeTerminalObject:function(b,c,d,e){var f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return g.Parser._showConsole(g.Parser._debugFlag.common,"Generating Node with parent "+b+" and type "+c,[]),void 0===d&&(d="+"),f={toString:function(){return"["+this.sign+this.value+" "+this.type+"]"},isTerminal:!0,type:c,sign:d,value:void 0,units:e,isEmpty:!0,incinerate:function(){this.value="incinerated (X)",delete this.isTerminal,delete this.type,delete this.isEmpty,delete this.units,delete this.parentNode},parentNode:b},void 0!==b&&b.isEmpty===!0&&b._addParam(f),f},getFunctionVariablePowerInTerm:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(b.isTerminal)return 0;switch(b.name){case"+":case"-":c.Parser._showConsole(c.Parser._debugFlag.common,"%c[FAIL ]This term should have occured when looking  for power of function variable",[c.Parser._NSTYLE]);break;case"\\cdot":}},_getFunctionVariableSegregationIndex:function(b,c){var d,e,f=0,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(void 0===c)return void g.Parser._showConsole(g.Parser._debugFlag.common,"Cant segregate with unknown fVar",[]);if(b.isTerminal===!0)return c===b.value?1:0;switch(b.name){case"+":for(d=0;d<b.params.length;d++)if(e=g.TreeProcedures._getFunctionVariableSegregationIndex(b.params[d],c),0===d)f=e;else if(e!==f)return;return f;case"\\cdot":for(d=0;d<b.params.length;d++){if(e=g.TreeProcedures._getFunctionVariableSegregationIndex(b.params[d],c),void 0===e)return;e>0&&(f+=e)}return f;case"\\frac":return e=g.TreeProcedures._getFunctionVariableSegregationIndex(b.params[0],c),g.Parser._showConsole(g.Parser._debugFlag.convert2q,"fraction with numerator fvar power "+e,[]),e;case"^":return b.params[1].isTerminal===!1||"digit"!==b.params[1].type?(g.Parser._showConsole(g.Parser._debugFlag.convert2q,"No point in checking when power is complicated for "+b+" power is "+b.params[1],[]),0):(e=g.TreeProcedures._getFunctionVariableSegregationIndex(b.params[0],c),g.Parser._showConsole(g.Parser._debugFlag.convert2q,"power: fVar "+e+" my power "+b.params[1],[]),void 0===e?void 0:e>0?e*g.TreeProcedures._getValueFromParam(b.params[1]):0);default:return 0}},_findSameOperatorAndMerge:function(b){var c,d,e,f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if("+"!==b.name&&"\\cdot"!==b.name&&"-"!==b.name)return void g.Parser._showConsole(g.Parser._debugFlag.common,"Cant merge function "+b,[]);for(g.Parser._showConsole(g.Parser._debugFlag.common,"Merging operator "+b,[]),d=[],e=0,f=null,e=0;e<b.params.length;e++)if(f=b.params[e],f.name===b.name)for(c=g.TreeProcedures._extractAllParams(f),b._removeParam(f),e--;c.length>0;)d.push(c.shift());if(d.length>0)for(;d.length>0;)b._addParam(d.shift())},_getParseTreeNodeObject:function(b,c,d,e){var f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return g.Parser._showConsole(g.Parser._debugFlag.common,"Generating function "+c+" with parent "+b,[]),void 0===d&&(d="+"),f={toString:function(){return"+"===this.sign?this.name+"()":this.sign+this.name+"()"},params:[],isTerminal:!1,name:c,isEmpty:!0,sign:d,allTermsDigits:void 0,liberationCode:e,maxParams:g.TreeProcedures._productions.getMaximumParameters(c),_addParam:function(a){return this.params.length>=this.maxParams?void g.Parser._showConsole(g.Parser._debugFlag.common,"!!!!!!!! ERROR I CANT ACCEPT THIS CHILD",[]):(a.parentNode=this,this.params.push(a),g.Parser._showConsole(g.Parser._debugFlag.common,"Adding param "+a.name+" to "+this.name+" at index "+(this.params.length-1),[]),void(this.params.length===this.maxParams&&(g.Parser._showConsole(g.Parser._debugFlag.common,"---Function "+this.name+" is full---",[]),this.isEmpty=!1)))},_removeParam:function(a,b){var c,d,e;return c="number"==typeof a?a:this.params.indexOf(a),-1===c||c>=this.params.length?void g.Parser._showConsole(g.Parser._debugFlag.common,"Cant remove object at index "+c,[]):(d=this.params.splice(c,1),e=d[0],void 0===b&&(b=!0),b!==!0?e:void e.incinerate())},convertToTerminal:function(a){this.isTerminal=!0,this.value=a.value,this.isEmpty=a.isEmpty,this.type=a.type,this.units=a.units,this.sign=a.sign,this.toString=function(){return"["+this.sign+this.value+" "+this.type+"]"},void 0!==a.parentNode&&a.parentNode._removeParam(a),delete this.params,delete this.name,delete this.liberationCode,delete this.maxParams,delete this._removeParam,delete this.toEquation,delete this._addParam,delete this.simplify},incinerate:function(){this.name="incinerated (+)",delete this.params,delete this.isTerminal,delete this.isEmpty,delete this.liberationCode,delete this.parentNode,delete this.maxParams},toEquation:function(){},expand:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;switch(this.name){case"+":for(k=0;k<this.params.length;k++)this.params[k].isTerminal===!1&&this.params[k].expand(b,c);y.TreeProcedures._findSameOperatorAndMerge(this),l=!0;break;case"\\cdot":if(y.TreeProcedures._getAdditionGroupCount(this.params)>0){for(m=[],n=0;n<this.params.length;)"+"===this.params[n].name?m.push(this._removeParam(this.params[n],!1)):n++;if(m.length>1)for(;m.length>1;)o=y.TreeProcedures._expandMultiplication(m.shift(),m.shift(),this.sign),m.unshift(o);else o=m[0];y.Parser._showConsole(y.Parser._debugFlag.expand,"Remaining non plus params count is "+this.params.length,[]),this.params.length>0&&(this.params.length>1?(w=y.TreeProcedures._getParseTreeNodeObject(void 0,"\\cdot","+",void 0),y.TreeProcedures._adoptAllParams(this,w),o=y.TreeProcedures._expandMultiplication(w,o,this.sign)):(o=y.TreeProcedures._expandMultiplication(this.params[0],o,this.sign),y.TreeProcedures._removeAllParams(this))),y.Parser._showConsole(y.Parser._debugFlag.expand,"Addition group is "+o,[]),y.TreeProcedures._convertTreeNodeTo(this,"+"),y.TreeProcedures._adoptAllParams(o,this)}else y.Parser._showConsole(y.Parser._debugFlag.expand,"Nothing to expand",[]);y.TreeProcedures._findSameOperatorAndMerge(this);break;case"^":if(i=this.params[0],i.isTerminal===!1&&i.expand(c),j=this.params[1],y.Parser._showConsole(y.Parser._debugFlag.expand,"Expanding ^ with params "+this.params,[]),"+"===i.name&&j.isTerminal===!0){if(y.Parser._showConsole(y.Parser._debugFlag.expand,"Possible expansion of "+i+" at degree "+j,[]),"2"===j.value){if(y.TreeProcedures._hasFreeVariable(this,b)===!1)return void y.Parser._showConsole(y.Parser._debugFlag.expand,"No function variable found in my params....Expansion is futile",[]);if(p=y.TreeProcedures._extractAllParams(i),y.TreeProcedures._convertTreeNodeTo(this,"+"),y.TreeProcedures._removeAllParams(this),r=y.TreeProcedures._seperateTermsWithFreeVariable(p,b),y.Parser._showConsole(y.Parser._debugFlag.expand,"Terms with free Variable "+b+" are "+r,[]),y.Parser._showConsole(y.Parser._debugFlag.expand,"Terms WITHOUT free Variable "+b+" are "+p,[]),0===r.length)y.Parser._showConsole(y.Parser._debugFlag.expand,"##############ERROR THIS SHOULDNT HAPPEN...@#@#######",[]);else{if(t=y.TreeProcedures._getParseTreeTerminalObject(void 0,"digit","+"),t.value=2,r.length>0)for(i=y.TreeProcedures._getParseTreeNodeObject(void 0,"+",void 0,void 0),k=0;k<r.length;k++)y.Parser._showConsole(y.Parser._debugFlag.expand,"Adding param "+r[k],[]),i._addParam(r[k]);else i=r[0];if(p.length>0)for(j=y.TreeProcedures._getParseTreeNodeObject(void 0,"+",void 0,void 0),k=0;k<p.length;k++)j._addParam(p[k]);else j=p[0];s=y.TreeProcedures._getParseTreeNodeObject(void 0,"^",void 0,void 0),s._addParam(y.TreeProcedures._clone(i)),s._addParam(y.TreeProcedures._clone(t)),y.Parser._showConsole(y.Parser._debugFlag.expand,"expansion term 1 generated "+s,[]),s.sign=y.TreeProcedures._multiplySigns(s.sign,this.sign),this._addParam(s),s=y.TreeProcedures._getParseTreeNodeObject(void 0,"^",void 0,void 0),s._addParam(y.TreeProcedures._clone(j)),s._addParam(y.TreeProcedures._clone(t)),y.Parser._showConsole(y.Parser._debugFlag.expand,"expansion term 2 generated "+s,[]),s.sign=y.TreeProcedures._multiplySigns(s.sign,this.sign),this._addParam(s),s=y.TreeProcedures.multiply(i,j),s=y.TreeProcedures.multiply(s,t),s.sign=y.TreeProcedures._multiplySigns(s.sign,this.sign),this._addParam(s),l=!0}}}else if("\\cdot"===i.name&&j.isTerminal&&"digit"===j.type){for(q=this._removeParam(j,!1),y.TreeProcedures._convertTreeNodeTo(this,"\\cdot"),p=y.TreeProcedures._extractAllParams(i),y.TreeProcedures._removeAllParams(this),i.incinerate();p.length>0;)v=y.TreeProcedures._getParseTreeNodeObject(void 0,"^","+",void 0),v._addParam(p.shift()),v._addParam(y.TreeProcedures._clone(q)),this._addParam(v);q.incinerate(),l=!0}break;case"\\frac":if(d=this.params[0],d.isTerminal===!1&&d.expand(b),"+"===d.name){for(l=!0,this.name="+",this.maxParams=y.TreeProcedures._productions.getMaximumParameters(this.name),f=this.params[1],this._removeParam(d,!1),this._removeParam(f,!1),e=d.params.length;d.params.length>0;)x=this.sign,g=d.params[0],d._removeParam(g,!1),h=0===d.params.length?f:y.TreeProcedures._clone(f),u=y.TreeProcedures._getParseTreeNodeObject(this,"\\frac"),u._addParam(g),u._addParam(h),u.sign=x,u.simplify(c),this._addParam(u);d.incinerate()}}l===!0&&this.simplify(c)},simplify:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,f=!0;if(e.Parser._showConsole(e.Parser._debugFlag.simplify,"Simplifying "+this,[]),"\\sum"===this.name||"\\prod"===this.name)return void e.TreeProcedures.simplifySumProd(this,b);for(d=this.params.length,c=d-1;c>=0;c--)e.Parser._showConsole(e.Parser._debugFlag.common,"...processing "+this.params[c],[]),this.params[c].isTerminal!==!0?(this.params[c].simplify(b),(this.params[c].isTerminal===!1||"digit"!==this.params[c].type)&&(e.Parser._showConsole(e.Parser._debugFlag.simplify,this.params[c]+" is not digit",[]),f=!1)):"digit"!==this.params[c].type&&(e.Parser._showConsole(e.Parser._debugFlag.simplify,this.params[c]+" is not digit",[]),f=!1);this.allTermsDigits=f,e.Parser._showConsole(e.Parser._debugFlag.simplify,"all terms digit flag is "+this.allTermsDigits+" for function "+this,[]),e.TreeProcedures._performNumericalOptimizations(this,b),e.TreeProcedures._performStructuralOptimizations(this,b)},parentNode:b},void 0!==b&&b.isEmpty===!0&&b._addParam(f),f},_isInversibleFunction:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return-1!==c.Parser._INVERSIBLE_FUNCTIONS.indexOf(b)},_isNodeSimple:function c(a){var b,d=!0;if(a.isTerminal)d=d&&"var"!==a.type;else for(b=0;b<a.params.length;b++)if(d=d&&c(a.params[b]),!d)return d;return d},simplifySumProd:function(b,c){var d,e,f,g,h,i,j,k,l=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;!b||!b.params||b.params.length<4||(d=b.params[1],e=b.params[2],f=b.params[3],d.isTerminal||d.simplify(),e.isTerminal||e.simplify(),f.isTerminal||f.simplify(),l.TreeProcedures._isNodeSimple(d)&&l.TreeProcedures._isNodeSimple(e)&&l.TreeProcedures._isNodeSimple(f)&&d.isTerminal&&"digit"===d.type&&e.isTerminal&&"digit"===e.type&&(g=l.TreeProcedures._toMobileFunction(f,c,b.params[0].value),
g.search("param")>-1||(h="return "+l.TreeProcedures._toMobileFunction(b,c)+";",h.search("findFactorial")>-1&&(h=l.MathFunctions.findFactorialString+h),h.search("gammaFunction")>-1&&(h=l.MathFunctions._gammaFunctionString+h),h.search("sum")>-1&&(h=l.MathFunctions.getSumString()+h),h.search("prod")>-1&&(h=l.MathFunctions.getProdString()+h),i=new Function("param,constants",h),j=i(0,c.getConstants()),k=l.TreeProcedures._getParseTreeTerminalObject(void 0,"digit","+",b.params[0].units),k.value=j,b.convertToTerminal(k))))},_getLeftChild:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return b.isTerminal?null:"do"===b.params[0].name?c.TreeProcedures._getLeftChild(b.params[0]):b.params[0]},_getRightChild:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return b.isTerminal?null:"do"===b.params[1].name?c.TreeProcedures._getLeftChild(b.params[1]):b.params[1]},_getInversibleFunctionReplacement:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return c=d.Parser._INVERSIBLE_FUNCTIONS.indexOf(b),-1!==c?d.Parser._INVERT_FUNCTIONS_IN_ORDER[c]:null},_preNumericalStructuralOptimizations:function(b){var c,d,e,f,g,h,i=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;switch(b.name){case"^":if(c=i.TreeProcedures._getLeftChild(b),null!==c&&i.TreeProcedures._isInversibleFunction(c.name)&&(d=i.TreeProcedures._getRightChild(b),null!==d&&-1===i.TreeProcedures._getValueFromParam(d)&&(f=i.TreeProcedures._getInversibleFunctionReplacement(c.name),null!==f)))for(e=i.TreeProcedures._extractAllParams(c),i.TreeProcedures._convertTreeNodeTo(b,f),b.sign=i.TreeProcedures._multiplySigns(b.sign,c.sign),i.TreeProcedures._removeAllParams(b),g=0,h=e.length,g;h>g;g++)b._addParam(e[g])}},_performStructuralOptimizations:function(b,c){var d,e,f,g,h,i,j,k,l,m,n=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,o=!1;switch(b.name){case"^":"^"===b.params[0].name?(h=b._removeParam(1,!1),e=b.params[0]._removeParam(0,!1),f=b.params[0]._removeParam(0,!1),b._removeParam(0),h=n.TreeProcedures.multiply(h,f),b._addParam(e),b._addParam(h),o=!0):"\\%"===b.params[0].name&&(j=n.TreeProcedures._getNumberOfPercentChilds(b),i=b.params[1],k=n.TreeProcedures._getPercentChild(b.params[0]),d=k.sign,l=Math.pow(.01,j),l=Math.pow(l,i.value),l*=k.value,m=n.TreeProcedures._getParseTreeTerminalObject(void 0,"digit",d,void 0),m.value=l,n.TreeProcedures._removeAllParams(b),b.convertToTerminal(m));break;case"do":n.Parser._showConsole(n.Parser._debugFlag.simplify,"optimizing "+b+" with params "+b.params,[]),g=n.TreeProcedures._extractAllParams(b),d=b.sign,n.TreeProcedures._convertTreeNodeTo(b,g[0]),d=n.TreeProcedures._multiplySigns(d,g[0].sign),"+"===g[0].name&&"-"===d?n.TreeProcedures.negateTree(b):b.sign=d;break;case"!":"\\%"===b.params[0].name&&(j=n.TreeProcedures._getNumberOfPercentChilds(b),k=n.TreeProcedures._getPercentChild(b.params[0]),d=k.sign,l=Math.pow(.01,j),l=n.TreeProcedures._mathFunctions.performMathematicalCalculations("!",[l],n.TreeProcedures._getUnits(b)),l*=k.value,m=n.TreeProcedures._getParseTreeTerminalObject(void 0,"digit",d,void 0),m.value=l,n.TreeProcedures._removeAllParams(b),b.convertToTerminal(m))}o&&n.TreeProcedures._performNumericalOptimizations(b,c)},_getNumberOfPercentChilds:function(b){var c,d,e,f=0,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(b.isTerminal===!1)for(c=0,d=b.params.length,c;d>c;c++)e=b.params[c],"\\%"===e.name&&(f++,f+=g.TreeProcedures._getNumberOfPercentChilds(e));return f},_getPercentChild:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return"\\%"===b.params[0].name?c.TreeProcedures._getPercentChild(b.params[0]):b.params[0]},_expandMultiplication:function(b,c,d){var e,f,g,h,i,j,k,l,m=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(m.Parser._showConsole(m.Parser._debugFlag.common,"multiplying "+b+" to "+c,[]),"+"!==b.name&&"+"!==c.name)return m.Parser._showConsole(m.Parser._debugFlag.expand,"Both terms are not + series...just multiplying",[]),m.TreeProcedures.multiply(b,c);if(g=!1,h=!1,"+"===b.name?(e=m.TreeProcedures._extractAllParams(b),f=b,g=!0):(e=[b],g=!1),"+"===c.name?(i=m.TreeProcedures._extractAllParams(c),h=!0,void 0===f?f=c:c.incinerate()):(i=[c],h=!1),m.Parser._showConsole(m.Parser._debugFlag.expand,"term1 params "+e,[]),m.Parser._showConsole(m.Parser._debugFlag.expand,"term2 params "+e,[]),void 0===f)return void m.Parser._showConsole(m.Parser._debugFlag.expand,"Parent node not found...skip expand multiplication",[]);for(j=0;j<e.length;j++)for(k=0;k<i.length;k++)l=m.TreeProcedures.multiply(m.TreeProcedures._clone(e[j]),m.TreeProcedures._clone(i[k])),l.sign=m.TreeProcedures._multiplySigns(d,l.sign),m.Parser._showConsole(m.Parser._debugFlag.expand,">>>"+l,[]),f._addParam(l);if(g)for(;e.length>0;)e[0].incinerate(),e.shift();if(h)for(;i.length>0;)i[0].incinerate(),i.shift();return f},_extractAllParams:function(a){for(var b=[];a.params.length>0;)b.push(a._removeParam(a.params[0],!1));return b},_removeAllParams:function(a,b){for(void 0===b&&(b=!0);a.params.length>0;)a._removeParam(a.params[0],b)},_getAdditionGroupCount:function(a){var b=0,c=0;for(c=0;c<a.length;c++)"+"===a[c].name&&b++;return b},_adoptAllParams:function(b,c){var d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(b===c)return void d.Parser._showConsole(d.Parser._debugFlag.common,"Skipping adopting your own params -_-",[]);for(;b.params.length>0;)c._addParam(b._removeParam(0,!1))},_seperateTermsWithFreeVariable:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,f=[];for(d=0;d<b.length;d++)e.TreeProcedures._hasFreeVariable(b[d],c)===!0?(e.Parser._showConsole(e.Parser._debugFlag.common,"term "+b[d]+" have freevar "+c,[]),f.push(b[d]),b.splice(d,1),d--):e.Parser._showConsole(e.Parser._debugFlag.common,"term "+b[d]+"  doesnt have freevar "+c,[]);return f},_hasFreeVariable:function d(a,b){if(a.isTerminal===!0)return"var"===a.type&&a.value===b;var c,e;for(e=0;e<a.params.length;e++)if(c=d(a.params[e],b),c===!0)return!0;return!1},_convertTreeNodeTo:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(b.isTerminal===!0)return void e.Parser._showConsole(e.Parser._debugFlag.common,"Cant convert terminal to a NODE",[]);if(e.Parser._showConsole(e.Parser._debugFlag.common,"Converting the tree node "+b+" from "+b.name+" to "+c,[]),"string"==typeof c)b.name=c,b.maxParams=e.TreeProcedures._productions.getMaximumParameters(c);else if(c.isTerminal===!1)for(b.name=c.name,b.sign=c.sign,b.maxParams=e.TreeProcedures._productions.getMaximumParameters(b.name),d=e.TreeProcedures._extractAllParams(c),e.TreeProcedures._removeAllParams(b);d.length>0;)b._addParam(d.shift());else b.convertToTerminal(c);b.maxParams===1/0&&(b.isEmpty=!0)},_getUnits:function(b){var c=b.params[0],d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return c.isTerminal===!0?c.units:d.TreeProcedures._getUnits(c)},_getAllParamsValues:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,e=[],f=0,g=b.params.length;for(f;g>f;f++)c=b.params[f],c.isTerminal?e.push(d.TreeProcedures._getValueFromParam(c)):d.Parser._showConsole(d.Parser._debugFlag.common,"%c[FAIL ]The Node provided is not terminal",[d.Parser._NSTYLE]);return e},_getValueFromParam:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return b.isTerminal?(c=Number(b.value),isNaN(c)?b.value:"-"===b.sign&&0!==c?-1*c:c):(d.Parser._showConsole(d.Parser._debugFlag.common,"Value for a non terminal node was asked"+b.name,[]),null)},_multiplySigns:function(a,b){return"+"===a&&"+"===b?"+":"+"===a||"+"===b?"-":"+"},_getAdditionValue:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,e=null,f=b.params.length,g=0;for(g;f>g;g++)c=b.params[g],c.isTerminal&&"digit"===c.type&&(null===e&&(e=0),e+=d.TreeProcedures._getValueFromParam(c));return e},_performPercentOptimizations:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,g=b.parentNode;return void 0===g?f.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,[f.TreeProcedures._getValueFromParam(b.params[0])],f.TreeProcedures._getUnits(b)):"+"!==g.name?"^"===g.name||"!"===g.name?void 0:f.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,[f.TreeProcedures._getValueFromParam(b.params[0])],f.TreeProcedures._getUnits(b)):(e=f.TreeProcedures._getAdditionValue(g),void 0===g.onlyPercent&&(null===e?g.onlyPercent=!0:g.onlyPercent=!1),c=g.onlyPercent===!0?f.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,[f.TreeProcedures._getValueFromParam(b.params[0])],f.TreeProcedures._getUnits(b)):f.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,[e,f.TreeProcedures._getValueFromParam(b.params[0])],f.TreeProcedures._getUnits(b)),"-"===b.sign&&(c*=-1),d=f.TreeProcedures._extractAllParams(b,!1),b.convertToTerminal(d[0]),b.sign=d[0].sign,b.value=c,d[0].incinerate(),void 0)},_performNumericalOptimizations:function(b,c){if(b.isTerminal!==!0){var d,e,f,g,h,i,j,k,l,m,n,o=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(o.Parser._showConsole(o.Parser._debugFlag.simplify,"solving---------------"+b+" with maxparams "+b.maxParams,[]),g=1,"-"===b.sign&&(g=-1),b.maxParams===1/0){for(h=0,h=0;h<b.params.length;h++)if(i=b.params[h],i.isTerminal===!0&&"digit"===i.type)if(o.Parser._showConsole(o.Parser._debugFlag.simplify,"processing digit "+i,[]),void 0===d)d=o.TreeProcedures._getValueFromParam(b.params[h]),o.Parser._showConsole(o.Parser._debugFlag.simplify,"for operator "+b.name+" Result init to "+d,[]),f=b.params[h];else{switch(b.name){case"+":d+=o.TreeProcedures._getValueFromParam(b.params[h]);break;case"-":d-=o.TreeProcedures._getValueFromParam(b.params[h]);break;case"\\cdot":d*=o.TreeProcedures._getValueFromParam(b.params[h])}b._removeParam(i),h--}else o.Parser._showConsole(o.Parser._debugFlag.simplify,"param "+i+" is not terminal",[]),g=1;"\\cdot"===b.name,void 0!==d&&(d*=g),1===b.params.length&&(e=!0),void 0!==f&&(o.Parser._showConsole(o.Parser._debugFlag.simplify,"Reduced to result "+d,[]),f.value=d,f.sign="+")}else if(o.Parser._showConsole(o.Parser._debugFlag.common,b+" all terms digits flag is "+b.allTermsDigits,[]),b.allTermsDigits===!0){switch(o.Parser._showConsole(o.Parser._debugFlag.simplify,"!!!Processing function "+b.name+" with params "+b.params,[]),b.name){case"\\%":d=o.TreeProcedures._performPercentOptimizations(b);break;case"do":e=!1;break;default:d=o.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,o.TreeProcedures._getAllParamsValues(b),o.TreeProcedures._getUnits(b)),null===d&&o.Parser._showConsole(o.Parser._debugFlag.simplify,"Dont know how to process function "+b,[])}if(void 0!==d){for(d*=g,b.params[0].value=d,b.params[0].type="digit",b.params[0].sign="+";b.params.length>1;)b._removeParam(b.params[1]);e=!0}}else switch(o.Parser._showConsole(o.Parser._debugFlag.simplify,"Not all terms are digits in function "+b+" params are "+b.params,[]),b.name){case"\\frac":b.params[0].isTerminal===!1&&"\\frac"===b.params[0].name?(o.Parser._showConsole(o.Parser._debugFlag.common,"SImplifying fraction in numerator",[]),j=b.params[0],k=b.params[1],b._removeParam(j,!1),b._removeParam(k,!1),b._addParam(j.params[0]),l=o.TreeProcedures.multiply(k,j.params[1]),b._addParam(l),l.simplify(c)):o.Parser._showConsole(o.Parser._debugFlag.simplify,"Cant simplify frac any further",[])}e===!0&&(m=b.params[0],o.Parser._showConsole(o.Parser._debugFlag.simplify,"node "+b+" has only param left "+m,[]),n=m.isTerminal===!0||"+"===b.name||"\\cdot"===b.name,n===!0&&(o.Parser._showConsole(o.Parser._debugFlag.simplify,"CONVERTING last node from "+b+" to "+m,[]),o.Parser._showConsole(o.Parser._debugFlag.simplify,"before conversion it was "+b,[]),m.isTerminal?b.convertToTerminal(m):(o.TreeProcedures._convertTreeNodeTo(b,m),m.incinerate()),o.Parser._showConsole(o.Parser._debugFlag.simplify,"after conversion it is  "+b,[]))),o.Parser._showConsole(o.Parser._debugFlag.simplify,"Finished solving---------------"+b,[])}}}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.ParsingProcedures=Backbone.Model.extend({},{_validOpeningBrackets:["(","{","["],_validClosingBrackets:[")","}","]"],_recursiveTokenRegEx:/^\((.+)\)\+$/i,_productions:a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Productions,peekInPredictionStack:function(b,c){if(!(c>b.length)){var d=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return d.ParsingProcedures._getPeekValue(b[c])}},_getPeekValue:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(void 0!==b)return e.ParsingProcedures._recursiveTokenRegEx.test(b)?(e.Parser._showConsole(e.Parser._debugFlag.common,"peek term is recursive..."+b,[]),c=b.match(e.ParsingProcedures._recursiveTokenRegEx),e.Parser._showConsole(e.Parser._debugFlag.common,"matches "+c,[]),d=c[1].split(","),e.Parser._showConsole(e.Parser._debugFlag.common,"tokens are "+d,[]),d[0]):b},expandRecursiveStack:function(b,c){var d,e,f,g,h=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;for(h.Parser._showConsole(h.Parser._debugFlag.common,"Expanding prediction stack "+b+" at index "+c,[]),d=b[c],e=d.match(h.ParsingProcedures._recursiveTokenRegEx),f=e[1].split(","),h.Parser._showConsole(h.Parser._debugFlag.common,"Expanded terms are "+f,[]),g=f.length-1;g>=0;g--)b.splice(c,0,f[g]);h.Parser._showConsole(h.Parser._debugFlag.common,"now prediction stack is "+b,[])},isStackInfinite:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return c.ParsingProcedures.isTermInfinite(b[b.length-1])},isTermInfinite:function(b){if(void 0===b)return!1;var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return c.Parser._showConsole(c.Parser._debugFlag.common,"checking for recursive term "+b+" result is "+this._recursiveTokenRegEx.test(b),[]),c.ParsingProcedures._recursiveTokenRegEx.test(b)},verifyStackWithLookahead:function(b,c){var d,e,f=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(f.Parser._showConsole(f.Parser._debugFlag.common,"*******************verifying stack "+b+" with lookahead "+c,[]),void 0===c||0===c.length)return!0;for(e=c.length-1;e>0;e--){if(d=c[e],f.Parser._showConsole(f.Parser._debugFlag.common,d+" <> "+b[b.length-1],[]),f.ParsingProcedures._isClosingBracket(d))return!0;if(b[b.length-1]===d)return!1;if(f.ParsingProcedures.getOperatorPrecedenceIndex(f.ParsingProcedures._getPeekValue(b[b.length-1]))<f.ParsingProcedures.getOperatorPrecedenceIndex(f.ParsingProcedures._getPeekValue(d)))return f.Parser._showConsole(f.Parser._debugFlag.common,">>>>>>>>>>>!!!!!!>>>>>>>> REJECTING THE STACK because "+b[b.length-1]+" should not be precededed by "+d,[]),!1}return!0},getOperatorPrecedenceIndex:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,d=c.Productions._operatorsInPrecedenceOrder.indexOf(b);return c.Parser._showConsole(c.Parser._debugFlag.common,"checking operator precedence index for operator "+b+" index is "+d,[]),d},isTokenSame:function(a,b){return a.value===b||a.type===b?!0:!1},cloneStringStack:function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c]},pushAllLookAheads:function(a,b,c){var d,e=0;for(d=b.length-1;d>=c;d--)e++,a.push(b[d]);return e},checkWithLookAhead:function(b,c){var d,e,f,g=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(g.Parser._showConsole(g.Parser._debugFlag.rules,"------------------------------------------------------------------------------",[]),g.Parser._showConsole(g.Parser._debugFlag.rules,"checking token "+b+" from Lookahead stack "+c,[]),void 0===c)return!1;for(f=c.length-1;f>=0&&(d=g.ParsingProcedures._getPeekValue(c[f]),e=g.ParsingProcedures.isTermInfinite(c[f]),void 0!==d);f--)if(g.ParsingProcedures._isClosingBracket(b.value)){if(e===!1)return g.ParsingProcedures.isTokenSame(b,d)}else{if(g.ParsingProcedures._isClosingBracket(d))return g.ParsingProcedures.isTokenSame(b,d);if(!e)return g.Parser._showConsole(g.Parser._debugFlag.common,c[f]+" is not recursive...checking normally now",[]),g.ParsingProcedures.isTokenSame(b,d);if(g.Parser._showConsole(g.Parser._debugFlag.common,"checkign with recursive "+g.ParsingProcedures._getPeekValue(c[f]),[]),g.ParsingProcedures.isTokenSame(b,d))return!0}return!1},isNonTerminal:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return c.Parser._showConsole(c.Parser._debugFlag.common,"checking "+b,[]),"E"===b},_isSpecialTerminal:function(a){return"var"===a||"const"===a||"digit"===a?!0:!1},getPredictionStacksForToken:function(b,c,d){var e,f,g,h=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return g=h.ParsingProcedures._isSpecialTerminal(b.type)?b.type:b.value,h.Parser._showConsole(h.Parser._debugFlag.common,"token value is "+g,[]),e=d?h.RangeProductionRules.rangeRulesTable[c]:h.ParsingProcedures._productions.productionTable[c],h.Parser._showConsole(h.Parser._debugFlag.common,"node objects "+e,[]),f=e[g],h.Parser._showConsole(h.Parser._debugFlag.common,"valid rules "+f,[]),f},recordBracket:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;if(e.ParsingProcedures._isValidBracket(c)){if(0===b.length)return b.push(c),void e.Parser._showConsole(e.Parser._debugFlag.common,"Updating bracket stack "+b,[]);d=b[b.length-1],e.ParsingProcedures._isOppositeBracket(d,c)?(e.Parser._showConsole(e.Parser._debugFlag.common,"Opposites found "+d+"<>"+c,[]),b.pop()):(e.Parser._showConsole(e.Parser._debugFlag.common,"pushing in stack "+c,[]),b.push(c)),e.Parser._showConsole(e.Parser._debugFlag.common,"Updating bracket stack "+b,[])}},_isValidBracket:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return-1!==c.ParsingProcedures._validOpeningBrackets.indexOf(b)||-1!==c.ParsingProcedures._validClosingBrackets.indexOf(b)},_isOpeningBracket:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return-1!==c.ParsingProcedures._validOpeningBrackets.indexOf(b)},_isClosingBracket:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return-1!==c.ParsingProcedures._validClosingBrackets.indexOf(b)},_isOppositeBracket:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;return e.ParsingProcedures._isValidBracket(b)===!1||e.ParsingProcedures._isValidBracket(c)===!1?void e.Parser._showConsole(e.Parser._debugFlag.common,"Wrong bracket Pair "+b+" <> "+c,[]):e.ParsingProcedures._isOpeningBracket(b)?(d=e.ParsingProcedures._validOpeningBrackets.indexOf(b),e.ParsingProcedures._validClosingBrackets[d]===c):(d=e.ParsingProcedures._validClosingBrackets.indexOf(b),e.ParsingProcedures._validOpeningBrackets[d]===c)},getStackCode:function(a){return a.length}}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.RangeProductionRules=Backbone.Model.extend({},{rangeRules:null,rangeRulesTable:null,solution:null,generateRules:function(){var b,c,d,e=["var","digit"],f=["\\le","\\ge","<",">"],g={"\\le":"<","\\ge":">"},h=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,i=f.length,j=null;for(h.RangeProductionRules.rangeRulesTable={E:{"var":[],digit:[]}},h.RangeProductionRules.rangeRules=[],h.RangeProductionRules.solution=[],b=0;i>b;b++)c=f[b],j=[],j.push(e[0]),j.push(c),j.push(e[1]),h.RangeProductionRules._createAndPushRule(j),h.RangeProductionRules.solution.push(h.RangeProductionRules._setSequenceRules(c,1,!0)),j=[],j.push(e[1]),j.push(c),j.push(e[0]),h.RangeProductionRules._createAndPushRule(j),h.RangeProductionRules.solution.push(h.RangeProductionRules._setSequenceRules(c,1)),h.RangeProductionRules._getRulesForSeperatorCombination(c),void 0!==g[c]&&(d=g[c],h.RangeProductionRules._getRulesForSeperatorCombination(c,d),h.RangeProductionRules._getRulesForSeperatorCombination(d,c));h.Parser._showConsole(h.Parser._debugFlag.common,"rules :: "),h.Parser._showConsole(h.Parser._debugFlag.common,h.RangeProductionRules.rangeRules),h.Parser._showConsole(h.Parser._debugFlag.common,"rules table :: "),h.Parser._showConsole(h.Parser._debugFlag.common,h.RangeProductionRules.rangeRulesTable)},_setSequenceRules:function(a,b,c){var d;switch(a){case"\\le":d=1===b?c?"var."+(b-1)+" max.equal."+(b+1):"min.equal.0 var."+(b+1):"max.equal."+(b+1);break;case"\\ge":d=1===b?c?"var."+(b-1)+" min.equal."+(b+1):"max.equal.0 var."+(b+1):"min.equal."+(b+1);break;case"<":d=1===b?c?"var."+(b-1)+" max."+(b+1):"min.0 var."+(b+1):"max."+(b+1);break;case">":d=1===b?c?"var."+(b-1)+" min."+(b+1):"max.0 var."+(b+1):"min."+(b+1)}return d},_getRulesForSeperatorCombination:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine,f=["digit","var","digit"];void 0===c&&(c=b),f.splice(1,0,b),f.splice(3,0,c),e.RangeProductionRules._createAndPushRule(f),d=e.RangeProductionRules._setSequenceRules(b,1),d+=" "+e.RangeProductionRules._setSequenceRules(c,3),e.RangeProductionRules.solution.push(d)},_createAndPushRule:function(b){var c=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine;c.RangeProductionRules.rangeRules.push(b),c.RangeProductionRules.rangeRulesTable.E[b[0]].push(c.RangeProductionRules.rangeRules.length-1)}}),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.EquationEnums=Backbone.Model.extend({},{ERROR_TOO_MANY_FREE_VARIABLES:"Too many free variables.",ERROR_CONSTANTS_NOT_DEFINED:"Constants are not defined",ERROR_COMPLICATED:"Its complicated",ERROR_SYNTAX_ERROR:"Equation has syntax error",ERROR_VARIABLE_HAS_TO_BE_QUADRATIC:"Atleast one variable has to be quadratic"})}(window.MathInteractives);var geomFunctions={isDebugMode:!1,distance:function(a,b){return Math.sqrt((b.y-a.y)*(b.y-a.y)+(b.x-a.x)*(b.x-a.x))},distance2:function(a,b,c,d){return Math.sqrt((d-b)*(d-b)+(c-a)*(c-a))},hypotenuse:function(a,b){return 0===a&&0===b?0:Math.abs(a)>Math.abs(b)?Math.abs(a)*Math.sqrt(b/a*(b/a)+1):Math.abs(b)*Math.sqrt(a/b*(a/b)+1)},areaOfEllipse:function(a,b){var c;return c=Math.PI*a*b},areaOfArcSegament:function(a){var b,c,d,e;return c=geomFunctions.areaOfArcSector(a),e=[[a.x1,a.y1],[a.a,a.b],[a.x3,a.y3],[a.x1,a.y1]],d=geomFunctions.areaOfIrregularPolygon(e),b=d+c},areaOfArcSector:function(a){var b,c;return b=geomFunctions.getArcAngle(a),c=b/360*(Math.PI*a.r*a.r)},intersectionOfLines:function(a,b,c,d,e,f,g,h){var i=(a-c)*(f-h)-(b-d)*(e-g);if(0!==i){var j=((a*d-b*c)*(e-g)-(a-c)*(e*h-f*g))/i,k=((a*d-b*c)*(f-h)-(b-d)*(e*h-f*g))/i;return[j,k]}},intersectionOfCircles:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n={},o={},p=[],g=geomFunctions.distance2(a,b,c,d);return g>e+f?p:g<Math.abs(e-f)?p:(h=(e*e-f*f+g*g)/(2*g),i=(f*f-e*e+g*g)/(2*g),m=Math.sqrt(e*e-h*h),o.a=b-d,o.b=-(a-c),o.c=-o.b*b-o.a*a,k=geomFunctions.getPointAtADistance(o.a,o.b,o.c,a,b,h),l=geomFunctions.getPointAtADistance(o.a,o.b,o.c,c,d,i),j=k[0][0].toFixed(3)===l[0][0].toFixed(3)&&k[0][1].toFixed(3)===l[0][1].toFixed(3)||k[0][0].toFixed(3)===l[1][0].toFixed(3)&&k[0][1].toFixed(3)===l[1][1].toFixed(3)?k[0]:k[1],n.a=-o.b,n.b=o.a,n.c=-o.a*j[0]+o.b*j[1],p=geomFunctions.getPointAtADistance(n.a,n.b,n.c,j[0],j[1],m))},onSegment:function(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)},orientation:function(a,b,c){var d=(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y);return 0==d?0:d>0?1:2},doSegmentIntersect:function(a,b,c,d){var e=geomFunctions.orientation(a,b,c),f=geomFunctions.orientation(a,b,d),g=geomFunctions.orientation(c,d,a),h=geomFunctions.orientation(c,d,b);return e!=f&&g!=h?!0:0==e&&geomFunctions.onSegment(a,c,b)?!0:0==f&&geomFunctions.onSegment(a,d,b)?!0:0==g&&geomFunctions.onSegment(c,a,d)?!0:0==h&&geomFunctions.onSegment(c,b,d)?!0:!1},calculateLineOutCode:function(a,b,c,d,e,f,g){var h=0,i=1,j=2,k=4,l=8;return("undefined"==typeof g||null===g)&&(g=0),c+g>=a?h|=i:a>=d-g&&(h|=j),e+g>=b?h|=k:b>=f-g&&(h|=l),h},doesLineIntersectRectangle:function(a,b,c,d,e,f,g,h){var i;return(i=geomFunctions.doSegmentIntersect({x:a,y:b},{x:c,y:d},{x:e,y:g},{x:f,y:g}))?!0:(i=geomFunctions.doSegmentIntersect({x:a,y:b},{x:c,y:d},{x:f,y:g},{x:f,y:h}))?!0:(i=geomFunctions.doSegmentIntersect({x:a,y:b},{x:c,y:d},{x:f,y:h},{x:e,y:h}))?!0:(i=geomFunctions.doSegmentIntersect({x:a,y:b},{x:c,y:d},{x:e,y:h},{x:e,y:g}),i?!0:!1)},lineClipWithRectangle:function(a,b,c,d,e,f,g,h){for(var i,j,k,l=geomFunctions.calculateLineOutCode(a,b),m=geomFunctions.calculateLineOutCode(c,d),n=!1,o=1,p=2,q=4,r=8;;){if(!(l|m)){n=!0;break}if(l&m)break;k=l?l:m,k&r?(i=a+(c-a)*(h-b)/(d-b),j=h):k&q?(i=a+(c-a)*(g-b)/(d-b),j=g):k&p?(j=b+(d-b)*(f-a)/(c-a),i=f):k&o&&(j=b+(d-b)*(e-a)/(c-a),i=e),k==l?(a=i,b=j,l=ComputeOutCode(a,b)):(c=i,d=j,m=ComputeOutCode(c,d))}return n?{x0:a,y0:b,x1:c,y1:d}:void 0},intersectionOfLineAndCircle:function(a,b,c,d,e,f){var g,h,i,j;return g=geomFunctions.getProjectionOfPointOnLine(a,b,d,e,f),i=geomFunctions.distance2(a,b,g[0],g[1]),i>c?void 0:(h=Math.sqrt(c*c-i*i),j=geomFunctions.getPointAtADistance(d,e,f,g[0],g[1],h))},getPointAtADistance:function(a,b,c,d,e,f){var g,h,i,j=[[],[]];return g=-b,h=a,i=Math.sqrt(g*g+h*h),g/=i,h/=i,j[0][0]=d+g*f,j[0][1]=e+h*f,j[1][0]=d-g*f,j[1][1]=e-h*f,j},mean:function(a,b){return a>0==b>0?a+(b-a)/2:(a+b)/2},getProjectionOfPointOnLine:function(a,b,c,d,e){var f=-c*b+d*a,g=c*c+d*d,h=[(-e*c+d*f)/g,(-c*f-d*e)/g];return h},reflectPointAroundLine:function(a,b,c,d,e){var f=this.getProjectionOfPointOnLine(a,b,c,d,e),g=f[0]-a,h=f[1]-b;return f[0]+=g,f[1]+=h,f},areaOfIrregularPolygon:function(a){var b,c=0,d=0,e=0;for(b=0;b<a.length-1;b++)c+=a[b][0]*a[b+1][1];for(b=0;b<a.length-1;b++)d+=a[b][1]*a[b+1][0];return e=Math.abs(c-d)/2},getArcAngle:function(a){var b,c,d=this.getPositiveAngle(a.from),e=this.getPositiveAngle(a.via),f=this.getPositiveAngle(a.to);return a.x1===a.x3&&a.y3===a.y3?360:(d>f?(b=f,c=d):(b=d,c=f),e>b&&c>e?180*(c-b)/Math.PI:180*(2*Math.PI-(c-b))/Math.PI)},getPointOnArcFromOffset:function(a,b,c){var d,e=geomFunctions.getArcAngle(a),f=e/360*2*Math.PI*a.r;return b*=f,d=360*b/(2*Math.PI*a.r),1===c?geomFunctions.rotatePoint(a.x1,a.y1,a.a,a.b,d,!0):3===c?geomFunctions.rotatePoint(a.x3,a.y3,a.a,a.b,d,!0):void 0},isPointProjectionOnArc:function(a,b){var c,d,e=Math.atan2(b[1]-a.b,b[0]-a.a),f=geomFunctions.getPositiveAngle(a.from),g=geomFunctions.getPositiveAngle(a.via),h=geomFunctions.getPositiveAngle(a.to),e=geomFunctions.getPositiveAngle(e);if(f>h?(c=h,d=f):(c=f,d=h),g>c&&d>g){if(!(e>c&&d>e))return!1}else if(e>c&&d>e)return!1;return!0},getPositiveAngle:function(a){return 0>a&&(a+=2*Math.PI),a},reflectLineAroundLine:function(a,b,c,d,e,f){return[a*(Math.pow(e,2)-Math.pow(d,2))-2*b*d*e,b*(Math.pow(d,2)-Math.pow(e,2))-2*a*d*e,c*(Math.pow(d,2)+Math.pow(e,2))-2*f*(d*a+e*b)]},dilateLine:function(a,b,c,d,e,f){var g=-a*e+b*d,h=a*a+b*b,i=[(-c*a+b*g)/h,(-a*g-b*c)/h];return this.dilatePoint(i[0],i[1],d,e,f)},getRotatedImageMatrix:function(a,b,c){var d,e,f,g,h,i;return e=[[1,0,0],[0,1,0],[-b[0],-b[1],1]],h=-c.angle*Math.PI/180,f=[[Math.cos(h),Math.sin(h),0],[-Math.sin(h),Math.cos(h),0],[0,0,1]],g=[[1,0,0],[0,1,0],[b[0],b[1],1]],i=[[a._a,a._c,0],[a._b,a._d,0],[a._tx,a._ty,1]],i=this.matrixMultiplication(i,e),i=this.matrixMultiplication(i,f),i=this.matrixMultiplication(i,g),d=a.set(i[0][0],i[0][1],i[1][0],i[1][1],i[2][0],i[2][1])},getTranslatedImageMatrix:function(a,b){var c,d,e,f;return e=b.dx,f=b.dy,d=[[1,0,0],[0,1,0],[e,f,1]],rasterImageMatrix=[[a._a,a._c,0],[a._b,a._d,0],[a._tx,a._ty,1]],rasterImageMatrix=this.matrixMultiplication(rasterImageMatrix,d),c=a.set(rasterImageMatrix[0][0],rasterImageMatrix[0][1],rasterImageMatrix[1][0],rasterImageMatrix[1][1],rasterImageMatrix[2][0],rasterImageMatrix[2][1])},getDilatedImageMatrix:function(a,b,c,d){var e,f,g,h,i;return e=this.dilatePoint(b[0],b[1],c[0],c[1],d),f=[[1,0,0],[0,1,0],[-b[0],-b[1],1]],h=[[d.ratio,0,0],[0,d.ratio,0],[0,0,1]],g=[[1,0,0],[0,1,0],[b[0],b[1],1]],i=[[a._a,a._c,0],[a._b,a._d,0],[a._tx,a._ty,1]],i=this.matrixMultiplication(i,f),i=this.matrixMultiplication(i,h),i=this.matrixMultiplication(i,g),f=[[1,0,0],[0,1,0],[e[0]-b[0],e[1]-b[1],1]],i=this.matrixMultiplication(i,f),a.set(i[0][0],i[0][1],i[1][0],i[1][1],i[2][0],i[2][1]),a},getReflectedImageMatrix:function(a,b,c){var d,e,f,g,h,i,j,k;return d=[[1,0,0],[0,1,0],[-c[0],-c[1],1]],i=-b.a/b.b,j=Math.atan(i),e=[[Math.cos(j),Math.sin(j),0],[-Math.sin(j),Math.cos(j),0],[0,0,1]],f=[[1,0,0],[0,-1,0],[0,0,1]],g=[[Math.cos(j),-Math.sin(j),0],[Math.sin(j),Math.cos(j),0],[0,0,1]],h=[[1,0,0],[0,1,0],[c[0],c[1],1]],k=[[a._a,a._c,0],[a._b,a._d,0],[a._tx,a._ty,1]],k=this.matrixMultiplication(k,d),k=this.matrixMultiplication(k,e),k=this.matrixMultiplication(k,f),k=this.matrixMultiplication(k,g),k=this.matrixMultiplication(k,h),a.set(k[0][0],k[0][1],k[1][0],k[1][1],k[2][0],k[2][1]),a},matrixMultiplication:function(a,b){var c,d,e,f=[[0,0,0],[0,0,0],[0,0,0]];for(c=0;3>c;c++)for(d=0;3>d;d++)for(e=0;3>e;e++)f[c][d]+=a[c][e]*b[e][d];return f},getPolarCoordinate:function(a,b,c){var d=Math.sqrt(a*a+b*b),e=Math.atan2(b,a);return c&&(e=180*e/Math.PI),[d,e]},dotProduct:function(a,b,c,d){return a*c+b*d},getSegmentParam:function(a,b,c,d,e,f){var g=this.hypotenuse(e-c,f-d);if(0===g)return 0;var h=this.dotProduct((a-c)/g,(b-d)/g,(e-c)/g,(f-d)/g);return h},midPoint:function(a,b){return[(b[0]+a[0])/2,(b[1]+a[1])/2]},midPoint2:function(a,b,c,d){return[(a+c)/2,(b+d)/2]},closestPointOnSegment:function(a,b,c,d,e,f){var g=this.getSegmentParam(a,b,c,d,e,f);return 0>=g?[c,d]:g>=1?[e,f]:[c+g*(e-c),d+g*(f-d)]},getPointOffset:function(a,b,c,d,e,f){var g,h,i,j;return g=geomFunctions.distance2(a,b,c,d),h=geomFunctions.distance2(a,b,e,f),i=geomFunctions.distance2(c,d,e,f),j=i>g&&i>h?-h/g:h/g},getPointPositionFromOffset:function(a,b,c,d,e){var f,g,h,i,j=[];return f=geomFunctions.distance2(a,b,c,d),0>e?(g=-e*f,h=f+g):(g=e*f,h=e>1?g-f:f-g),h>g?(i=h/f,j[0]=(1-i)*c+i*a,j[1]=(1-i)*d+i*b):(i=g/f,j[0]=(1-i)*a+i*c,j[1]=(1-i)*b+i*d),j},pointAtADistanceFromMidPoint:function(a,b,c,d,e){var f=geomFunctions.midPoint2(a,b,c,d),g=Math.atan2(a-c,d-b),h=[f[0]+e*Math.cos(g),f[1]+e*Math.sin(g)];return h},pointAtADistanceFromMidPointWithBetterName:function(a,b,c,d,e,f,g,h,i){var j=geomFunctions.midPoint2(a,b,c,d),k=geomFunctions.midPoint2(e,f,g,h),l=Math.atan2(j[1]-k[1],j[0]-k[0]),m=[j[0]+i*Math.cos(l),j[1]+i*Math.sin(l)];return m},distanceToSegment:function(a,b,c,d,e,f){var g=this.closestPointOnSegment(a,b,c,d,e,f);return this.hypotenuse(a-g[0],b-g[1])},getParameterOfParabola:function(a,b,c,d,e,f){var g,h,i;return g=Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2)),h=Math.atan((b-d)/(a-c)),i=(Math.cos(h)*(f-d)-Math.sin(h)*(e-c))/(2*g)},getParameterOfHyperbola:function(a,b,c,d,e,f,g,h,i,j){var k=Math.sqrt(Math.pow(e-g,2)+Math.pow(f-h,2)),l=Math.sqrt(Math.pow(e-i,2)+Math.pow(f-j,2)),m=Math.atan((Math.cos(d)*(f-b)-Math.sin(d)*(e-a))/c);return l>k?m:-Math.PI+m},getParameterOfEllipse:function(a,b,c,d,e,f,g,h,i,j,k){var l,m=Math.sqrt(Math.pow(f-h,2)+Math.pow(g-i,2)),n=Math.sqrt(Math.pow(f-j,2)+Math.pow(g-k,2));return l=Math.atan(a*(Math.cos(e)/(f-b)-Math.sin(e)/(g-c))/(d*(Math.cos(e)/(g-c)+Math.sin(e)/(f-b)))),n>m?l:0>l?(geomFunctions.traceConsole(3.14+l),3.14+l):-3.14+l},angleBetweenPoints:function(a,b,c,d,e,f,g){var h=Math.atan2(f-d,e-c)-Math.atan2(b-d,a-c);return g?180*h/Math.PI:h},smallerAngleBetweenPoints:function(a,b,c,d,e,f,g){var h;return h=this.angleBetweenPoints(a,b,c,d,e,f,!1),Math.abs(h)>Math.PI&&(h=h>0?2*Math.PI-h:2*Math.PI+h),g?180*h/Math.PI:h},rotatePoint:function(a,b,c,d,e,f,g){f&&(e=e*Math.PI/180),g&&(e*=-1);var h=Math.cos(e),i=Math.sin(e);return[c+(a-c)*h-(b-d)*i,d+(a-c)*i+(b-d)*h]},rotateLine:function(a,b,c,d,e,f,g){var c;return g&&(f=f*Math.PI/180),cos=Math.cos(f),sin=Math.sin(f),[a*cos-b*sin,a*sin+b*cos,a*d+b*e+c-(a*d+b*e)*cos-(a*e-b*d)*sin]},getPolarCoordinates:function(a,b,c,d,e){var f,g,h;return f=a-c,g=b-d,theta=Math.atan2(g,f),theta<0&&(theta+=2*Math.PI),e===!0&&(theta=180*theta/Math.PI),
h=this.distance2(a,b,c,d),[h,theta]},getCartesianCoordinates:function(a,b,c,d,e){var f=[];return e===!0&&(d=d*Math.PI/180),f[0]=a+c*Math.cos(d),f[1]=b+c*Math.sin(d),f},translatePoint:function(a,b,c,d){var e=d?-1:1;return"polar"===c.coordinateSystem?this.rotatePoint(a+c.r,b,a,b,c.angle,!0,d):[a+c.dx*e,b+c.dy*e]},getTriangleCircumCentre:function(a,b,c,d,e,f){var g=2*(a*(d-f)+c*(f-b)+e*(b-d)),h=((a*a+b*b)*(d-f)+(c*c+d*d)*(f-b)+(e*e+f*f)*(b-d))/g,i=((a*a+b*b)*(e-c)+(c*c+d*d)*(a-e)+(e*e+f*f)*(c-a))/g;return[h,i]},getTriangleIncentre:function(a,b,c,d,e,f){var g=this.distance2(a,b,c,d),h=this.distance2(a,b,e,f),i=this.distance2(e,f,c,d),j=g+h+i;return[(g*e+h*c+i*a)/j,(g*f+h*d+i*b)/j]},dilatePoint:function(a,b,c,d,e){var f,g;return f=c-(c-a)*e.ratio,g=d-(d-b)*e.ratio,[f,g]},getXYInterceptsOfLine:function(a,b,c){var d,e;return d=0===a?null:-c/a,e=0===b?null:-c/b,{xIntercept:d,yIntercept:e}},getCanvasCoordinates:function(a){var b=a.event.target,c=$(b),d=(c.offset(),[a.point.x,a.point.y]);return d},traceConsole:function(a){this.isDebugMode===!0},calculatePerimeter:function(a){var b,c,d,e,f,g,h=0,i=[],j="x",k="y";for(b=Object.keys(a[0]).length,c=.5*b,e=0;c>e;e++)j+=e,k+=e,f=a[0][j],g=a[0][k],i.push([f,g]),j="x",k="y";for(i.push(i[0]),e=0;c>e;e++)d=geomFunctions.distance2(i[e][0],i[e][1],i[e+1][0],i[e+1][1]),h+=d;return h}},CurveDerivativeTracker=Backbone.Model.extend({_points:void 0,_arrOrderNo:void 0,currentDerivatives:void 0,flipState:void 0,initialize:function(){this._points=[],this._arrOrderNo=[],this.currentDerivatives=[],this.flipState=[],this.curveAffinity=[]},trackPoint:function(a){var b,c,d,e,f,g;for(orderCounter=0;orderCounter<4&&(breakAfter=void 0===this._arrOrderNo[orderCounter],0===orderCounter?(b="",breakAfter&&(this._arrOrderNo[orderCounter]=[]),this._arrOrderNo[orderCounter].push(a)):(breakAfter&&(this._arrOrderNo[orderCounter]=[]),c=this._arrOrderNo[orderCounter-1],e=this._getPointDiff(c),1===orderCounter&&(f=180*Math.atan2(e[1],e[0])/Math.PI,Math.abs(f)>85&&(g=f>0?+(1/0):-(1/0),this.curveAffinity[this.curveAffinity.length-1]!==g&&(geomFunctions.traceConsole("Curve now leads to "+g),this.curveAffinity.push(g)))),this._arrOrderNo[orderCounter].push(e),this.flipState[orderCounter]=this._getFlipState(this._arrOrderNo[orderCounter]),b+=this.printPoint(c[c.length-1])+">>"),d=this._arrOrderNo[orderCounter],this.currentDerivatives[orderCounter]=d[d.length-1],!breakAfter);orderCounter++);geomFunctions.traceConsole("Order Derivatives "+this.printPoint(this.currentDerivatives[0])+" >> "+this.printPoint(this.currentDerivatives[1])+" >> "+this.printPoint(this.currentDerivatives[2])+" >> "+this.printPoint(this.currentDerivatives[3])),void 0!==this.currentDerivatives[1]},_getFlipState:function(a){var b=a[a.length-1],c=a[a.length-2];if(void 0!==c){var d=b[0]>=0?1:-1,e=c[0]>=0?1:-1,f=[];return f[0]=0>d*e&&Math.abs(b[0])>1&&Math.abs(c[0])>1,d=b[1]>=0?1:-1,e=c[1]>=0?1:-1,f[1]=0>d*e&&Math.abs(b[1])>1&&Math.abs(c[1])>1,f}},printPoint:function(a){return void 0!==a?a[0].toFixed(2)+","+a[1].toFixed(2):void 0},_radToDeg:function(a){return 180*a/Math.PI},_getPointDiff:function(a){var b=a[a.length-1],c=a[a.length-2];return[b[0]-c[0],b[1]-c[1]]},clear:function(){for(;this._points.length>0;)this._points.pop();for(;this._arrOrderNo.length>0;)this._arrOrderNo.pop();for(;this.currentDerivatives.length>0;)this.currentDerivatives.pop();for(;this.flipState.length>0;)this.flipState.pop()}}),getCanvasCoordinates=function(a){var b=a.event.target,c=$(b),d=(c.offset(),[a.point.x,a.point.y]);return d};!function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraphNew.plotterModel=Backbone.Model.extend({_equations:null,_equationsMap:null,_annotationPaths:null,incompleteAnnotations:null,_firstPoint:null,pathThickness:null,initialize:function(){this._equations=[],this._equationsMap={},this.incompleteAnnotations=[]}},{BASEPATH:null})}(window.MathInteractives),function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile=Backbone.Model.extend({},{profiler:{},getStartTime:function(a){var b=(new Date).getTime();this.profiler[a]={id:"",start:0,end:0,processingTime:0},this.profiler[a].start=b},getProcessingTime:function(a){var b=(new Date).getTime();return this.profiler[a].end=b,this.profiler[a].processingTime=b-this.profiler[a].start,this.profiler[a].processingTime}})}(window.MathInteractives),function(a){"use strict";a.Common.Components.Views.MathUtilitiesGraphNew.GridGraph=Backbone.View.extend({ID:null,_shapePan:null,_projectLayers:null,_paperScope:null,_canvasSize:null,markerBounds:null,_polarLineAngleMarker:null,_zoomFactors:[1,2,5],TEXT_ALIGN:{HORIZONTAL:{LEFT:"left",RIGHT:"right",CENTER:"center"},VERTICAL:{TOP:"top",BOTTOM:"bottom",MIDDLE:"middle"}},PI:"",_ADJECENT_LINES_MIN_DISTANCE:14,MINIMUM_THRESHOLD_LINE_DISTANCE:15,_ZOOM_DISTANCE:3,_ZOOM_STEPS:6,_ZOOM_STEPS_FOR_FIVE_MULTIPLIER:8,GRID_LINES:{DEFAULT:4,FIVE_MULTIPLIER:5},MARKER_FONT_SIZE:{ON_GRAPH_AREA:12,ON_GRAPH_AREA_PROJECTOR_MODE:16},MARKER_FONT_COLOR:{ON_GRAPH_AREA:"#000000",AT_END_OF_GRAPH_AREA:"grey"},_gridGraphModelObject:null,_isGraphDefaultZoomBehaviourAllowed:null,_isGraphDefaultPanBehaviourAllowed:null,snapToGridFlag:void 0,isDragInProgress:void 0,_X10_STRING:"10",_gridMode:null,_selectionRect:null,_touchDoubleTapCounter:null,_DOUBLE_TAP_THRESHOLD:600,_pinchCounter:null,_MINIMUM_ZOOM_LEVEL_FACTOR:.65,_MAXIMUM_ZOOM_LEVEL_FACTOR:1.5,_ZOOM_LEVEL_INCREMENT_STEPS:.1,_GRAPH_SHIFT_DISTANCE:50,graphShiftDistance:null,graphShiftDistanceAfterDrag:null,isSnap:!1,isDrawingsDraggable:null,isTooltipForPoint:null,paddingTop:0,paddingLeft:0,settingsOption:{XLowerTextBox:"x-lower-text-box",XUpperTextBox:"x-upper-text-box",YLowerTextBox:"y-lower-text-box",YUpperTextBox:"y-upper-text-box",graphTypeButton:"change-graph-type",zoomInButton:"zoom-graph",zoomOutButton:"zoom-out-graph",restoreDefaultZooming:"restore-default-zoom",gridLineDisplayButton:"toggle-grid-line-display",labelLineDisplayButton:"toggle-label-display",axesLinesDisplayButton:"toggle-axes-display",equalizeAxisScaleButton:"equalize-axis",projectorModeButton:"toggle-projector-mode",xAxisLabelInRadian:"change-x-axis-label-to-radian",xAxisLabelInDegree:"change-x-axis-label-to-degree",yAxisLabelInRadian:"change-y-axis-label-to-radian",yAxisLabelInDegree:"change-y-axis-label-to-degree",polarAngleInDegree:"change-polar-angle-label-to-degree",polarAngleInRadian:"change-polar-angle-label-to-radian",polarAngleLinesButton:"toggle-polar-angle-label-style",xAxisLableStyleButton:"toggle-x-axis-label-style",yAxisLabelStyleButton:"toggle-y-axis-label-style"},events:{click:"_functionAttacher",keyup:"_functionAttacher",mousewheel:"_functionAttacher"},_isGestureProgress:!0,resetGridMode:function(){this._gridMode="Graph"},getGridMode:function(){return this._gridMode},setGridMode:function(a){this._gridMode=a},isSnapToGridEnabled:function(){return this.snapToGridFlag},setSnapSnapToGridFlag:function(a){this.snapToGridFlag=a},_isGridRefreshPaused:void 0,pauseGridRefresh:function(){this._isGridRefreshPaused=!0},resumeGridRefresh:function(){this._isGridRefreshPaused=!1},_functionAttacher:function(b,c){var d,e,f=this.ID,g=this.settingsOption,h=$(b.target).attr("data-setting-option");switch(b.type){case"click":switch(h){case g.graphTypeButton:this._graphTypeChange();break;case g.gridLineDisplayButton:this._gridLineDisplayChange();break;case g.labelLineDisplayButton:this._labelDisplayChange();break;case g.axesLinesDisplayButton:this._axisDisplayChange();break;case g.projectorModeButton:this._projectorModeChange();break;case g.equalizeAxisScaleButton:this._equalizeAxisScales();break;case g.xAxisLabelInRadian:this._xAxisMarkerLineStyle(!0);break;case g.xAxisLabelInDegree:this._xAxisMarkerLineStyle(!1);break;case g.yAxisLabelInRadian:this._yAxisMarkerLineStyle(!0);break;case g.yAxisLabelInDegree:this._yAxisMarkerLineStyle(!1);break;case g.polarAngleInDegree:this._polarAngleLineMarkerStyle(!1);break;case g.polarAngleInRadian:this._polarAngleLineMarkerStyle(!0);break;case g.polarAngleLinesButton:this._polarAngleLineMarkerStyleToggle();break;case g.xAxisLableStyleButton:this._xAxisMarkerStyleToggle();break;case g.yAxisLabelStyleButton:this._yAxisMarkerStyleToggle();break;case g.zoomInButton:this._zoomInButtonClicked();break;case g.restoreDefaultZooming:this._restoreDefaultZoomingClicked();break;case g.zoomOutButton:this._zoomOutButtonClicked();break;case g.XLowerTextBox:case g.XUpperTextBox:case g.YLowerTextBox:case g.YUpperTextBox:break;default:this._setTextBoxValues()}break;case"keyup":switch(d=b.keyCode,e=[37,38,39,40,13,9,20,27,33,34,35,36,45],h){case g.XLowerTextBox:case g.XUpperTextBox:-1===e.indexOf(d)&&this._graphAxisLimitChangedByUserInput(!0,e);break;case g.YLowerTextBox:case g.YUpperTextBox:-1===e.indexOf(d)&&this._graphAxisLimitChangedByUserInput(!1,e)}break;case"mousewheel":switch(b.target.id){case f.canvasId:a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Profile.getStartTime("graph"),this._isGraphDefaultZoomBehaviourAllowed===!0&&"Graph"===this._gridMode&&(this.setDefaultPanBehaviour(!1),this._zoomGraph(c,!0),this.setDefaultPanBehaviour(!0),b.preventDefault())}break;case"dblclick":switch(b.target.id){case f.canvasId:}}},_triggerEqualizeEvent:function(a){a===!0?this.trigger("graph:un-equalize"):this.trigger("graph:equalize")},_customZoomInMultiplier:null,_customZoomOutMultiplier:null,_backgroundColor:"white",initialize:function(){this.ID={canvasId:null,XLowerTextBox:null,XUpperTextBox:null,YLowerTextBox:null,YUpperTextBox:null,graphTypeButton:null,zoomInButton:null,zoomOutButton:null,restoreDefaultZooming:null,gridLineDisplayButton:null,labelLineDisplayButton:null,axesLinesDisplayButton:null,equalizeAxisScaleButton:null,projectorModeButton:null,xAxisLabelInRadian:null,xAxisLabelInDegree:null,yAxisLabelInRadian:null,yAxisLabelInDegree:null,polarAngleInDegree:null,polarAngleInRadian:null,polarAngleLinesButton:null,xAxisLableStyleButton:null,yAxisLabelStyleButton:null},this._projectLayers={gridLayer:null,shapeLayer:null,pointLayer:null,imageLayer:null,serviceLayer:null},this._canvasSize={height:null,width:null},this.markerBounds={max:{x:null,y:null,"\\theta":null},min:{x:null,y:null,"\\theta":null}},this._polarLineAngleMarker={degree:[],radian:[]};var b,c,d,e;b=this.options.option,this.disableLineTooltip=this.options.option.disableLineTooltip,this._gridGraphModelObject=new a.Common.Components.Models.MathUtilitiesGraphNew.GridGraphModel,this.adjustGraphToPoints=this.options.option.adjustGraphToPoints,this._gridGraphModelObject.set("_points",[]),this._gridGraphModelObject.set("_plots",[]),this._gridGraphModelObject.set("_images",[]),this._defaultClassVariblesValue(),this._updateClassVariablesValue(b),"undefined"!=typeof this.options.option.paddingTop&&(this.paddingTop=this.options.option.paddingTop),"undefined"!=typeof this.options.option.paddingLeft&&(this.paddingLeft=this.options.option.paddingLeft),this.isDragInProgress=!1,this.snapToGridFlag=!1,this._gridMode="Graph",this._polarAngleLinesMarkerArrayGenerator(),this._canvasSetUp(),b.backgroundColor&&(this._backgroundColor=new this._paperScope.Color(b.backgroundColor[0],b.backgroundColor[1],b.backgroundColor[2],b.backgroundColor[3])),this._canvasTool(),this.render(),e=this,this._onShapeRollOver=function(a){e.isDragInProgress||"Graph"!==e._gridMode||(c=a.target,$(a.event.target).is("canvas")&&(d=c.equation,d.isDraggable()&&d.trigger("roll-over",d)))},this._onShapeRollOut=function(a){e.isDragInProgress||"Graph"!==e._gridMode||$(a.event.target).is("canvas")&&(c=a.target,d=c.equation,d.isDraggable()&&d.trigger("roll-out",d))}},render:function(){this._cartesionSymbolGenerator(),this._restoreDefaultZoom()},_defaultClassVariblesValue:function(){var a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),c=this._canvasSize,d=(b._graphOrigin,b._graphsAxisLimits),e=b._graphParameters;this._paperScope;c.height=800,c.width=1244,d.defaultLimits.xLower=d.currentLimits.xLower=-10,d.defaultLimits.xUpper=d.currentLimits.xUpper=10,d.defaultLimits.yLower=d.currentLimits.yLower=-10,d.defaultLimits.yUpper=d.currentLimits.yUpper=10,e.graphGridLine=4,e.xGridLine=4,e.yGridLine=4,this._shapePan=!1,this._isGraphDefaultZoomBehaviourAllowed=!0,this._isGraphDefaultPanBehaviourAllowed=!0,this.graphShiftDistance=this._GRAPH_SHIFT_DISTANCE,this.graphShiftDistanceAfterDrag=this.graphShiftDistance,this.isDrawingsDraggable=!1,this.isTooltipForPoint=!0},_updateClassVariablesValue:function(a){var b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),d=this._canvasSize,e=c._graphLimitTextBoxDomElement,f=this.ID,g=c._graphsAxisLimits;f.canvasId=a.canvasId,f.XLowerTextBox=a.XLowerTextBox,f.XUpperTextBox=a.XUpperTextBox,f.YLowerTextBox=a.YLowerTextBox,f.YUpperTextBox=a.YUpperTextBox,f.graphTypeButton=a.graphTypeButton,f.zoomInButton=a.zoomInButton,f.zoomOutButton=a.zoomOutButton,f.restoreDefaultZooming=a.restoreDefaultZooming,f.gridLineDisplayButton=a.gridLineDisplayButton,f.labelLineDisplayButton=a.labelLineDisplayButton,f.axesLinesDisplayButton=a.axesLinesDisplayButton,f.equalizeAxisScaleButton=a.equalizeAxisScaleButton,f.projectorModeButton=a.projectorModeButton,f.xAxisLabelInRadian=a.xAxisLabelInRadian,f.xAxisLabelInDegree=a.xAxisLabelInDegree,f.yAxisLabelInRadian=a.yAxisLabelInRadian,f.yAxisLabelInDegree=a.yAxisLabelInDegree,f.polarAngleInRadian=a.polarAngleInRadian,f.polarAngleInDegree=a.polarAngleInDegree,f.yAxisLabelStyleButton=a.yAxisLabelStyleButton,f.xAxisLableStyleButton=a.xAxisLableStyleButton,f.polarAngleLinesButton=a.polarAngleLinesButton,e.xLower=document.getElementById(f.XLowerTextBox),e.xUpper=document.getElementById(f.XUpperTextBox),e.yLower=document.getElementById(f.YLowerTextBox),e.yUpper=document.getElementById(f.YUpperTextBox),"number"==typeof a.canvasHeight&&"number"==typeof a.canvasWidth&&(d.height=a.canvasHeight,d.width=a.canvasWidth),"number"==typeof a.xAxisMinValue&&"number"==typeof a.xAxisMaxValue&&(g.defaultLimits.xLower=g.currentLimits.xLower=a.xAxisMinValue,g.defaultLimits.xUpper=g.currentLimits.xUpper=a.xAxisMaxValue),void 0!==a._isGraphDefaultZoomBehaviourAllowed&&(this._isGraphDefaultZoomBehaviourAllowed=a.isGraphDefaultZoomBehaviourAllowed),void 0!==a._isGraphDefaultPanBehaviourAllowed&&(this._isGraphDefaultPanBehaviourAllowed=a.isGraphDefaultPanBehaviourAllowed),a.isDrawingsDraggable&&(this.isDrawingsDraggable=!0),(a.isTooltipForPoint||a.isTooltipForPoint===!1)&&(this.isTooltipForPoint=a.isTooltipForPoint),a.stopDoubleClickZoom&&(c._zoomingFactor.doubleClickZoomAllow=!a.stopDoubleClickZoom)},_canvasSetUp:function(){var a,b,c=this._gridGraphModelObject.get("_graphDisplayValues"),d=document.getElementById(this.ID.canvasId),e=this._canvasSize.height,f=this._canvasSize.width,g=$(d);300===g.width()&&150===g.height()?g.width(f).height(e):(this._canvasSize.width=g.width(),this._canvasSize.height=g.height()),this._paperScope=new paper.PaperScope,this._paperScope.install($("#"+this.ID.canvasId)),this._paperScope.setup(d),b=this,a=this._paperScope,c._graphOrigin.defaultOrigin=new this._paperScope.Point(d.width/2,d.height/2),this._gridGraphModelObject.get("_graphDisplayValues")._graphOrigin.defaultOrigin=new a.Point(this._canvasSize.width/2,this._canvasSize.height/2),this._projectLayers.gridLayer=a.project.activeLayer,this._projectLayers.imageLayer=new a.Layer,this._projectLayers.shapeLayer=new a.Layer,this._projectLayers.pointLayer=new a.Layer,this._projectLayers.labelLayer=new a.Layer,this._projectLayers.bannerLayer=new a.Layer,this._projectLayers.annotationLayer=new a.Layer,this._projectLayers.serviceLayer=new a.Layer,this._projectLayers.gridLayer.activate(),b=this,this._pinchCounter=1,d.addEventListener("gesturechange",function(a){b._isGraphDefaultZoomBehaviourAllowed===!0&&b._pinchZoom(a)}),d.addEventListener("gesturestart",function(a){b._gestureStartEvent=a,b._isGestureProgress=!1}),d.addEventListener("gestureend",function(){b._gestureStartEvent=null,b._isGestureProgress=!0}),d.addEventListener("touchstart",function(a){null===b._touchDoubleTapCounter?b._touchDoubleTapCounter=(new Date).getTime():(new Date).getTime()-b._touchDoubleTapCounter>b._DOUBLE_TAP_THRESHOLD?b._touchDoubleTapCounter=null:(b._touchDoubleTapCounter=null,b._graphDoubleClick(a))})},_gestureStartEvent:null,_pinchZoom:function(a){var b=this,c=$("#"+b.ID.canvasId).offset(),d={x:b._gestureStartEvent.pageX-c.left,y:b._gestureStartEvent.pageY-c.top};b.activateScope();var e,f,g,h,i,j,k,l,m,n,o;j=b._gridGraphModelObject,k=j.get("_graphDisplayValues"),f=k._graphOrigin,e=d,g=f.currentOrigin,i=f.defaultOrigin,h=k._zoomingFactor,l=b._canvasSize.height,m=b._canvasSize.width,f.isOriginPositionChanged=!0,n=b._getGraphPointCoordinates([e.x,e.y]),o=b._originShiftFactorForDoubleClick(n),b.graphShiftDistance=o.distance,h.previousZoomAngle=o.angle,a.scale>1?(5===this._pinchCounter&&(this._zoomGraph(1,!1,!0),this._pinchCounter=0),this._pinchCounter++):(5===this._pinchCounter&&(this._zoomGraph(-1,!1,!0),this._pinchCounter=0),this._pinchCounter++)},_canvasTool:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=this._gridGraphModelObject,p=o.get("_graphDisplayValues"),q=this._canvasSize.width,r=this._canvasSize.height,s=p._zoomingFactor,t=p._graphOrigin,u=this,v=!1,w=this._paperScope;this._projectLayers.shapeLayer.onMouseDown=function(b){u.activateScope(),u.trigger("grid-mousedown",b),u._isGraphDefaultPanBehaviourAllowed===!0&&"Graph"===u._gridMode&&u._isGestureProgress&&(u._projectLayers.shapeLayer.activate(),a=w.project.activeLayer.hitTest(b.point,{stroke:!0,type:w.Group}),void 0!==a?("stroke"===a.type&&(v=!0),v=null===a?!1:null!==a.item&&"group"===a.item._parent.type?!0:!1):v=!1,u._shapePan=v,v===!0&&this.disableLineTooltip===!0?(u._projectLayers.shapeLayer.activate(),u._traceMouseDownHandle.apply(u,[b,a.item._parent]),u._projectLayers.gridLayer.activate()):u.off("grid-graph-mousedrag",j).on("grid-graph-mousedrag",j).off("grid-graph-mouseup",i).on("grid-graph-mouseup",i))},this._paperScope.tool.minDistance=1,this._projectLayers.shapeLayer.onMouseDrag=function(b){u.activateScope(),u._isGraphDefaultPanBehaviourAllowed===!0&&"Graph"===u._gridMode&&u._isGestureProgress&&u._shapePan===!0&&this.disableLineTooltip===!0&&(u._projectLayers.shapeLayer.activate(),u._traceMouseDragHandle.apply(u,[b,a.item._parent]),u._projectLayers.gridLayer.activate())},b=function(a){var b,c;if(u.activateScope(),u._isGraphDefaultPanBehaviourAllowed===!0&&"Graph"===u._gridMode)u._shapePan===!0||(t.currentOrigin.x+=a.delta.x,t.currentOrigin.y+=a.delta.y,u._graphTypeSelector(),t.isOriginPositionChanged=!0,u._graphLimitChangesDuringDragging(),u._deltaAngle(),u._previousMaxValue=u._getGraphPointCoordinates([q,r/2])[0],b=o.get("_plots").length,c=o.get("_images").length,(0!==b||0!==c)&&(0!==b.length&&(u._layerDrag(u._projectLayers.shapeLayer,a.delta),u._layerDrag(u._projectLayers.labelLayer,a.delta),u._layerDrag(u._projectLayers.annotationLayer,a.delta)),0!==c&&u._layerDrag(u._projectLayers.imageLayer,a.delta),clearTimeout($.data(u,"timer")),$.data(u,"timer",setTimeout(function(){u.trigger("graph:zoom-pan"),u.refreshView()},150))),0!==o.get("_points").length&&u._repositionPoints());else if("SelectionRect"===u._gridMode){var d=u._selectionRect._startPoint,e=u._getMinXMinYFromPoints(a.point,d),f=Math.abs(a.point.x-u._selectionRect._startPoint.x),g=Math.abs(a.point.y-u._selectionRect._startPoint.y);u._selectionRect.remove(),u._selectionRect=null,u._selectionRect=new u._paperScope.Path.Rectangle(e,{width:f,height:g}),u._selectionRect.style={strokeColor:"black",strokeWidth:2},u._selectionRect._startPoint=d}},c=this._projectLayers.gridLayer,c.name="grid",d=this._projectLayers.shapeLayer,d.name="shape",e=this,f=this._projectLayers.pointLayer,f.name="point",g=this._projectLayers.bannerLayer,g.name="banner",h=this._projectLayers.imageLayer,h.name="image",l=this._projectLayers.annotationLayer,l.name="annotation",m=this._projectLayers.labelLayer,m.name="label",this._addLayerClickDoubleClickEvents(f),this._addLayerClickDoubleClickEvents(this._projectLayers.shapeLayer),this._addLayerClickDoubleClickEvents(g),this._addLayerClickDoubleClickEvents(this._projectLayers.gridLayer),this._addLayerClickDoubleClickEvents(h),this._addLayerClickDoubleClickEvents(l),this._addLayerClickDoubleClickEvents(m),this._paperScope.tool.onMouseDrag=function(a){"undefined"==typeof u.$el.attr("ogCursor")&&u._isGraphDefaultPanBehaviourAllowed===!0&&(u.$el.attr("ogCursor",u.$el.find("canvas").css("cursor")),u.$el.find("canvas").trigger("interactivegraphpanningstart"),u.$el.find("canvas").css("cursor","move")),u.trigger("grid-graph-mousedrag",a),u.trigger("draw-annotation",a)},this._paperScope.tool.onMouseDown=function(a){u.trigger("grid-graph-mousedown",a),u.trigger("annotation-start",a)},this._paperScope.tool.onMouseUp=function(a){u.$el.attr("ogCursor")&&(u.$el.find("canvas").css("cursor",u.$el.attr("ogCursor")),u.$el.find("canvas").trigger("interactivegraphpanningstop"),u.$el.removeAttr("ogCursor")),u.activateScope(),3!==a.event.which&&(e.isDragInProgress=!1,s.previousZoomAngle=u._angleBetweenTwoPoints(t.currentOrigin,t.defaultOrigin),n=u._distanceBetweenPoints(t.currentOrigin,t.defaultOrigin),s.zoomCounter=n/u._GRAPH_SHIFT_DISTANCE,null!==u._gridGraphModelObject.get("circleDrag")&&(u._gridGraphModelObject.get("circleDrag").visible=!1,u.$(".drag-tooltip").remove(),u._shapePan=!1),u.trigger("grid-graph-mouseup",a),u.trigger("annotation-end",a))},!("ontouchstart"in window),i=function(){if("SelectionRect"===this._gridMode&&this._selectionRect){var a=this._selectionRect.bounds;this._selectionRect.remove(),this._selectionRect=null,this.trigger("selection-rect-complete",a)}this.off("grid-graph-mousedrag",j)},j=function(a){b(a)},this.on("grid-layer-mousedown",function(a){"SelectionRect"===u._gridMode&&(u._selectionRect=new this._paperScope.Path.Rectangle(a.point,{width:1,height:1}),u._selectionRect.strokeColor="black",u._selectionRect.strokeWidth=2,u._selectionRect._startPoint=a.point),this.on("grid-graph-mousedrag",j),this.on("grid-graph-mouseup",i)}),k=function(a){u._isGraphDefaultPanBehaviourAllowed===!0&&"Graph"===u._gridMode&&u._isGestureProgress&&(u.trigger("graph:zoom-pan"),u.refreshView(),u._shapePan=!1),t.doubleClickedPoint=a.point},this.on("grid-layer-mouseup",k),this.on("grid-layer-doubleclick",$.proxy(this._graphDoubleClick,this))},_getMinXMinYFromPoints:function(a,b){var c={x:null,y:null};return c.x=a.x<=b.x?a.x:b.x,c.y=a.y<=b.y?a.y:b.y,c},refreshView:function(){this._isGridRefreshPaused||this._paperScope.view.draw()},_addLayerClickDoubleClickEvents:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=200;e=this,h=function(c){if(3!==c.event.which&&("Graph"===e._gridMode||"SelectionRect"===e._gridMode)){"image"!==a.name&&"service"!==a.name;var h,j,k,l;b&&clearInterval(b),h=function(){b&&(d=void 0,clearInterval(b)),e.isDragInProgress=!1,e.off("grid-graph-mouseup",h)},j=c.target,k=j.parent,l=void 0===j.equation?k.equation:j.equation,l&&(l.getLabelData().labelObject!==j?l.trigger("drag-begin",e._getGraphPointCoordinates(getCanvasCoordinates(c)),l):l.trigger("label-drag-begin",getCanvasCoordinates(c),l)),(!l||l.isDraggable())&&(f=getCanvasCoordinates(c),"label"!==a.name&&(g=[f[0]-k.position.x,f[1]-k.position.y]),e.on("grid-graph-mouseup",h),e.isDragInProgress=!0,b=setInterval(function(){i(c)},n/2))}},i=function(h){var i,j,n,o,p,q;clearInterval(b),b=void 0,i=h.target,e.trigger(a.name+"-layer-mousedown",h),"grid"!==a.name&&(j=i.parent,n=getCanvasCoordinates(h),p=function(b){d=i;var h,j,n,p,q;c&&(clearInterval(c),c=void 0),void 0!==b.event&&(o||(o=f,m=f),k=getCanvasCoordinates(b)[0]-m[0],l=getCanvasCoordinates(b)[1]-m[1],j=i.parent,n=getCanvasCoordinates(b),p=n[0]-o[0],q=n[1]-o[1],h=void 0===i.equation?j.equation:i.equation,void 0!==g&&(n[0]-=g[0],n[1]-=g[1]),e.snapToGridFlag&&"point"===a.name&&(n=e.getClosestCanvasPoint(n)),h&&(h.getLabelData().labelObject!==i?h.trigger("pre-drag",e._getGraphPointCoordinates(n),h,n):h.trigger("label-pre-drag",n,h)),"label"!==a.name?(j.position.x=n[0],j.position.y=n[1]):(i.position.x=n[0],i.position.y=n[1]),o=n,this._paperScope.view.draw(),h&&h.getLabelData().labelObject!==i&&h.trigger("post-drag",h,!0,k,l),m=getCanvasCoordinates(b))},q=function(b){if(3!==b.event.which){var c,d,f,h,j,k;e.off("grid-graph-mousedrag",p),e.off("grid-graph-mouseup",q),h=getCanvasCoordinates(b),d=h[0]-n[0],f=h[1]-n[1],j=.1,Math.abs(d)<j&&Math.abs(f)<j||(c=void 0===i.equation?i.parent.equation:i.equation,void 0!==g&&(h[0]-=g[0],h[1]-=g[1]),e.snapToGridFlag&&"point"===a.name&&(h=e.getClosestCanvasPoint(h)),"label"!==a.name&&c.trigger("pre-relocate",e._getGraphPointCoordinates(h),c,h),e.isDragInProgress=!1,k=e._getGraphPointCoordinates(h),"label"!==a.name&&("point"===c.getSpecie()&&(c.setPoints([k]),c.trigger("change-equation")),c&&c.trigger("post-relocate",c,k)))}},e.on("grid-graph-mousedrag",p),e.on("grid-graph-mouseup",q))},("grid"===a.name||e.isDrawingsDraggable===!0)&&(a.onMouseDown=h),a.onDoubleClick=function(d){if(3!==d.event.which&&"Graph"===e._gridMode){var f;b&&(clearInterval(b),b=void 0),c&&(clearInterval(c),c=void 0),e.isDragInProgress=!1,f=d.target,e.trigger(a.name+"-layer-doubleclick",d)}},j=function(b){c&&(clearInterval(c),c=void 0),e.isDragInProgress=!1,d!==b.target&&(e.trigger(a.name+"-layer-mouseup",b),e.trigger(a.name+"-layer-click",b),e._paperScope.view.draw())},a.onClick=function(b){3!==b.event.which&&("Graph"===e._gridMode||"point"===a.name||"tabletDrawing"===e._gridMode)&&(c&&(clearInterval(c),c=void 0),c=setInterval(function(){j(b)},n))}},_onShapeRollOver:void 0,_onShapeRollOut:void 0,_setPathRollOverListeners:function(a){a.onMouseEnter=this._onShapeRollOver,a.onMouseLeave=this._onShapeRollOut},_removePathRollOverListeners:function(a){a.onMouseEnter=void 0,a.onMouseLeave=void 0},_labelDisplayChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isLabelShown=!b._graphDisplay.isLabelShown,this._graphTypeSelector()},_axisDisplayChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isAxisLinesShown=!b._graphDisplay.isAxisLinesShown,this._graphTypeSelector()},_gridLineDisplayChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isGridLineShown=!b._graphDisplay.isGridLineShown,this._graphTypeSelector()},_projectorModeChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isProjectorModeOn=!b._graphDisplay.isProjectorModeOn,this._cartesionSymbolGenerator(),this._graphTypeSelector()},graphZoomIn:function(){this.isDragInProgress||this._zoomInButtonClicked()},_zoomInButtonClicked:function(){if(!this.isDragInProgress){var a,b,c=0,d=this,e=this._ZOOM_STEPS;this._customZoomInMultiplier&&(e=this._customZoomInMultiplier),a=function(){d._zoomGraph(1,!0)},b=setInterval(function(){a(),c++,c>e&&clearInterval(b)},.1)}},graphZoomOut:function(){this.isDragInProgress||this._zoomOutButtonClicked()},_zoomOutButtonClicked:function(){if(!this.isDragInProgress){var a,b,c=0,d=this,e=this._ZOOM_STEPS;this._customZoomOutMultiplier&&(e=this._customZoomOutMultiplier),a=function(){d._zoomGraph(-1,!0)},b=setInterval(function(){a(),c++,c>e&&clearInterval(b)},.1)}},_graphDoubleClick:function(a){this.activateScope();var b,c,d,e,f,g,h=this._gridGraphModelObject,i=h.get("_graphDisplayValues"),g=i._zoomingFactor.doubleClickZoomAllow,j=1,k=this,l=i._graphOrigin,m=a.point,n=(l.currentOrigin,l.defaultOrigin,i._zoomingFactor),o=(this._canvasSize.height,this._canvasSize.width,this.graphShiftDistance),b=this._ZOOM_STEPS;this._shapePan||g===!1||(l.isOriginPositionChanged=!0,e=this._getGraphPointCoordinates([m.x,m.y]),c=function(){k._zoomGraph(1,!1)},d=setInterval(function(){f=k._originShiftFactorForDoubleClick(e),k.graphShiftDistance=f.distance,n.previousZoomAngle=f.angle,c(),j++,j>b&&(clearInterval(d),k.graphShiftDistance=o)},.1))},_xAxisMarkerStyleToggle:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isXmarkerInRadians=!b._graphDisplay.isXmarkerInRadians,this._graphTypeSelector()},_xAxisMarkerLineStyle:function(a){var b,c;b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),c._graphDisplay.isXmarkerInRadians=a,this._graphTypeSelector()},_yAxisMarkerStyleToggle:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isYmarkerInRadians=!b._graphDisplay.isYmarkerInRadians,this._graphTypeSelector()},_yAxisMarkerLineStyle:function(a){var b,c;b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),c._graphDisplay.isYmarkerInRadians=a,this._graphTypeSelector()},_graphTypeChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isCartesionCurrentGraphType=!b._graphDisplay.isCartesionCurrentGraphType,this._graphTypeSelector()},_polarAngleLineMarkerStyleToggle:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isPolarAngleInRadian=!b._graphDisplay.isPolarAngleInRadian,this._graphTypeSelector()},_polarAngleLineMarkerStyle:function(a){var b,c;b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),c._graphDisplay.isPolarAngleInRadian=a,this._graphTypeSelector()},defaultGraphZoom:function(){this._restoreDefaultZoomingClicked()},_restoreDefaultZoomingClicked:function(){this._restoreDefaultZoom(),this._deltaAngle(),this._triggerEqualizeEvent(!1)},_restoreDefaultZoom:function(){this.activateScope();var a,b,c,d,e=this._gridGraphModelObject,f=e.get("_graphDisplayValues"),g=this._canvasSize,h=(g.width,g.height,f._graphsAxisLimits),i=h.defaultLimits,j=f._zoomingFactor,k=f._graphParameters,l=this._zoomFactors,m=f._graphOrigin;f._graphDisplay,this.markerBounds;a=i.xLower,c=i.xUpper,b=i.yLower,d=i.yUpper,j.xCurrentFactor=j.yCurrentFactor=l[1],j.xZoomMultiplier=j.yZoomMultiplier=1,j.xTotalMultiplier=j.yTotalMultiplier=l[1],k.yGridLine=4,k.xGridLine=4,j.zoomLevel=1,m.isOriginPositionChanged=!1,h.isXLastChangedLimit=!0,j.zoomCounter=0,this._setGraphLimits(a,c,b,d),this._equalizeAxisScales()},_zoomGraph:function(a,b,c){this.activateScope();var d,e,f,g=this,h=this._gridGraphModelObject,i=h.get("_graphDisplayValues"),j=i._graphParameters,k=i._graphOrigin,l=this._canvasSize.height,m=this._canvasSize.width,n=(j.distanceBetweenTwoHorizontalLines,j.distanceBetweenTwoVerticalLines,j.xGridLine),o=j.yGridLine,p=k.currentOrigin,q=k.defaultOrigin,r=i._zoomingFactor,s=(this._zoomFactors,this.graphShiftDistance),t=this._zoomLevelLimits();this._distanceBetweenPoints(p,q)/10;(!this.isDragInProgress||c)&&("annotation-mode"!==this._gridMode||c)&&"Graph"===this._gridMode&&(b=void 0,s=this.graphShiftDistance,0!==a&&(a>0?(r.zoomCounter++,k.isOriginPositionChanged===!0&&r.zoomCounter>0?(d=r.previousZoomAngle-Math.PI,f=new this._paperScope.Point(p.x+Math.cos(d)*s,p.y-Math.sin(d)*s),this._delta=new this._paperScope.Point(k.currentOrigin.x-f.x,k.currentOrigin.y-f.y),k.currentOrigin=f,this._previousMaxValue=this._getGraphPointCoordinates([m,l/2])[0]):this._delta=new this._paperScope.Point(0,0),r.currentXZoomLevel+=this._ZOOM_LEVEL_INCREMENT_STEPS,r.currentXZoomLevel=parseFloat(r.currentXZoomLevel.toFixed(4)),r.currentXZoomLevel>t.xMaxZoomLevel&&(this._xAxisZoomFactorModifier(!1),t=this._zoomLevelLimits(),r.currentXZoomLevel=t.xMinZoomLevel),r.currentYZoomLevel+=this._ZOOM_LEVEL_INCREMENT_STEPS,r.currentYZoomLevel=parseFloat(r.currentYZoomLevel.toFixed(4)),r.currentYZoomLevel>t.yMaxZoomLevel&&(this._yAxisZoomFactorModifier(!1),t=this._zoomLevelLimits(),r.currentYZoomLevel=t.yMinZoomLevel),n=j.xGridLine,o=j.yGridLine,j.currentDistanceBetweenTwoVerticalLines=r.currentXZoomLevel*j.distanceBetweenTwoVerticalLines,j.totalVerticalLines=m/j.currentDistanceBetweenTwoVerticalLines,j.currentDistanceBetweenTwoHorizontalLines=r.currentYZoomLevel*j.distanceBetweenTwoHorizontalLines,j.totalHorizontalLines=l/j.currentDistanceBetweenTwoHorizontalLines):(r.zoomCounter--,p.x!==q.x||p.y!==q.y?(e=Math.sqrt(Math.pow(p.x-q.x,2)+Math.pow(p.y-q.y,2)),25>=e?(f=new this._paperScope.Point([q.x,q.y]),
this._delta=new this._paperScope.Point(k.currentOrigin.x-f.x,k.currentOrigin.y-f.y),k.currentOrigin=f,this._previousMaxValue=this._getGraphPointCoordinates([m,l/2])[0]):(d=r.previousZoomAngle,f=new this._paperScope.Point(p.x+Math.cos(d)*s,p.y-Math.sin(d)*s),this._delta=new this._paperScope.Point(k.currentOrigin.x-f.x,k.currentOrigin.y-f.y),k.currentOrigin=f,this._previousMaxValue=this._getGraphPointCoordinates([m,l/2])[0])):this._delta=new this._paperScope.Point(0,0),r.currentXZoomLevel-=this._ZOOM_LEVEL_INCREMENT_STEPS,r.currentXZoomLevel=parseFloat(r.currentXZoomLevel.toFixed(4)),r.currentXZoomLevel<t.xMinZoomLevel&&(this._xAxisZoomFactorModifier(!0),t=this._zoomLevelLimits(),r.currentXZoomLevel=t.xMaxZoomLevel),r.currentYZoomLevel-=this._ZOOM_LEVEL_INCREMENT_STEPS,r.currentYZoomLevel=parseFloat(r.currentYZoomLevel.toFixed(4)),r.currentYZoomLevel<t.yMinZoomLevel&&(this._yAxisZoomFactorModifier(!0),t=this._zoomLevelLimits(),r.currentYZoomLevel=t.yMaxZoomLevel),n=j.xGridLine,o=j.yGridLine,j.currentDistanceBetweenTwoVerticalLines=r.currentXZoomLevel*j.distanceBetweenTwoVerticalLines,j.totalVerticalLines=m/j.currentDistanceBetweenTwoVerticalLines,j.currentDistanceBetweenTwoHorizontalLines=r.currentYZoomLevel*j.distanceBetweenTwoHorizontalLines,j.totalHorizontalLines=l/j.currentDistanceBetweenTwoHorizontalLines),this._graphTypeSelector(),this._graphLimitChangesDuringDragging(),this._deltaAngle(),0!==h.get("_plots").length&&this._shapeZoom(),0!==h.get("_points").length&&this._repositionPoints(),g=this,clearTimeout($.data(this,"timer")),$.data(this,"timer",setTimeout(function(){(0!==h.get("_plots").length||0!==h.get("_images").length)&&(g._shapeRedraw(),g.refreshView()),g.$el.find("canvas").trigger("interactivegraphzoomcomplete")},100)),this.refreshView()))},_xAxisZoomFactorModifier:function(a){var b,c,d,e;if(d=this._gridGraphModelObject,e=d.get("_graphDisplayValues"),b=e._zoomingFactor,c=this._zoomFactors,a===!0)switch(b.xCurrentFactor){case c[0]:b.xCurrentFactor=c[1],b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=4;break;case c[1]:b.xCurrentFactor=c[2],b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=5;break;case c[2]:b.xCurrentFactor=c[0],b.xZoomMultiplier=10*b.xZoomMultiplier,b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=4}else switch(b.xCurrentFactor){case c[0]:b.xCurrentFactor=c[2],b.xZoomMultiplier=b.xZoomMultiplier/10,b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=5;break;case c[1]:b.xCurrentFactor=c[0],b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=4;break;case c[2]:b.xCurrentFactor=c[1],b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=4}},_yAxisZoomFactorModifier:function(a){var b,c,d,e;if(d=this._gridGraphModelObject,e=d.get("_graphDisplayValues"),b=e._zoomingFactor,c=this._zoomFactors,a===!0)switch(b.yCurrentFactor){case c[0]:b.yCurrentFactor=c[1],b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=4;break;case c[1]:b.yCurrentFactor=c[2],b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=5;break;case c[2]:b.yCurrentFactor=c[0],b.yZoomMultiplier=10*b.yZoomMultiplier,b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=4}else switch(b.yCurrentFactor){case c[0]:b.yCurrentFactor=c[2],b.yZoomMultiplier=b.yZoomMultiplier/10,b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=5;break;case c[1]:b.yCurrentFactor=c[0],b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=4;break;case c[2]:b.yCurrentFactor=c[1],b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=4}},_angleBetweenTwoPoints:function(a,b){var c,d,e;return c=Math.abs(a.y-b.y),d=Math.abs(a.x-b.x),e=Math.atan(d/c),e=a.y<b.y?a.x<b.x?3*Math.PI/2+e:a.x>b.x?3*Math.PI/2-e:3*Math.PI/2:a.y>b.y?a.x<b.x?Math.PI/2-e:a.x>b.x?Math.PI/2+e:Math.PI/2:a.x<b.x?0:a.x>b.x?Math.PI:0},_graphLimitChangesDuringDragging:function(){var a,b,c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),e=(c.get("markerBounds"),d._graphParameters),f=(e.xGridLine,e.yGridLine,e.distanceBetweenTwoVerticalLines,e.distanceBetweenTwoHorizontalLines,d._graphOrigin.currentOrigin),g=(d._zoomingFactor,d._graphsAxisLimits.currentLimits),h=this._canvasSize.height,i=this._canvasSize.width;f.y<0?(a=-1,b=-1):f.y>h?(a=1,b=1):(a=-1,b=1),g.yLower=this._getGraphPointCoordinates([f.x,h])[1],g.yUpper=this._getGraphPointCoordinates([f.x,0])[1],f.x<0?(a=1,b=1):f.x>i?(a=-1,b=-1):(a=-1,b=1),g.xUpper=this._getGraphPointCoordinates([i,f.y])[0],g.xLower=this._getGraphPointCoordinates([0,f.y])[0],this._setBounds(),this._setTextBoxValues()},_setTextBoxValues:function(){var a,b,c,d;c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),a=d._graphLimitTextBoxDomElement,b=d._graphsAxisLimits.currentLimits,null!==a.xLower&&null!==a.xUpper&&null!==a.yLower&&null!==a.yUpper&&(a.xLower.value=b.xLower,a.xUpper.value=b.xUpper,a.yLower.value=b.yLower,a.yUpper.value=b.yUpper)},_graphAxisLimitChangedByUserInput:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=[];b=void 0,p=this._gridGraphModelObject,q=p.get("_graphDisplayValues"),c=q._graphLimitTextBoxDomElement,n=this._canvasSize,o=q._graphOrigin,r=q._graphsAxisLimits,s=r.currentLimits,d=c.xLower.value,e=c.xUpper.value,f=c.yLower.value,g=c.yUpper.value,h=this._checkForNumericValue(d),i=this._checkForNumericValue(e),j=this._checkForNumericValue(f),k=this._checkForNumericValue(g),h===!0&&i===!0&&j===!0&&k===!0?(s.xLower!==parseFloat(d)||s.xUpper!==parseFloat(e)||s.yLower!==parseFloat(f)||s.yUpper!==parseFloat(g))&&(q._graphsAxisLimits.isXLastChangedLimit=a,this._setGraphLimits(d,e,f,g),m=o.defaultOrigin,l=o.currentOrigin,q._zoomingFactor.previousZoomAngle=this._angleBetweenTwoPoints(l,m),this._graphTypeSelector(),0!==p.get("_plots").length&&this._shapeRedraw(),0!==p.get("_points").length&&this._repositionPoints(),this._deltaAngle(),m.x===l.x&&m.y===l.y?o.isOriginPositionChanged=!1:o.isOriginPositionChanged=!0,Math.abs(q._graphParameters.distanceBetweenTwoVerticalLines-q._graphParameters.distanceBetweenTwoHorizontalLines)>.1?this._triggerEqualizeEvent(!0):this._triggerEqualizeEvent(!1)):(t=["","-"],-1===t.indexOf(d)&&-1===t.indexOf(e)&&-1===t.indexOf(f)&&-1===t.indexOf(g)&&this._setTextBoxValues())},_axisMarkerMultiplierAdjuster:function(a,b,c,d,e){this.setLimits(a,b,c,d),this._gridGraphModelObject.get("_graphDisplayValues")._graphOrigin.isOriginPositionChanged=!1},_convertNumberTillRequiredDecimalPoint:function(a){return Math.abs(a)>1?a.toFixed(3):a.toFixed(10)},_checkForNumericValue:function(a){var b,c,d,e,f,g;if(b=a.toString(),b.length>0){for(d=!0,e=0,f=0,g=0;g<b.length;g++){if(c=b[g].charCodeAt(),!(c>=48&&57>=c||45===c||46===c)){d=!1;break}if(45===c?e+=1:46===c&&(f+=1),f>1||e>1){d=!1;break}}return 1===b.length&&45===c&&(d=!1),d}},_graphTypeSelector:function(){this._projectLayers.gridLayer.activate();var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isCartesionCurrentGraphType===!0?this._cartesianGraph():this._polarGraph(),this._drawAxisLines(),this._axisMarker(),this.refreshView()},getMarkerBounds:function(){return this.markerBounds},_equalizeAxisScales:function(){var a,b,c,d,e=this._gridGraphModelObject,f=e.get("_graphDisplayValues"),g=(e.get("markerBounds"),this.markerBounds,this._canvasSize),h=f._graphsAxisLimits,i=f._graphParameters,j=g.height,k=g.width,l=f._graphOrigin.currentOrigin,m=f._zoomingFactor,n=h.currentLimits;h.isXLastChangedLimit===!0?(l.y<0?(c=-1,d=-1):l.y>j?(c=1,d=1):(c=-1,d=1),i.distanceBetweenTwoHorizontalLines=i.distanceBetweenTwoVerticalLines,i.currentDistanceBetweenTwoHorizontalLines=i.currentDistanceBetweenTwoVerticalLines,i.totalHorizontalLines=j/i.currentDistanceBetweenTwoHorizontalLines,m.yCurrentFactor=m.xCurrentFactor,m.yZoomMultiplier=m.xZoomMultiplier,m.yTotalMultiplier=m.xTotalMultiplier,i.yGridLine=i.xGridLine,m.currentYZoomLevel=m.currentXZoomLevel,n.yLower=c*(Math.abs(l.y-j)/i.currentDistanceBetweenTwoHorizontalLines)/i.yGridLine*m.yTotalMultiplier,n.yUpper=d*(Math.abs(l.y-0)/i.currentDistanceBetweenTwoHorizontalLines)/i.yGridLine*m.yTotalMultiplier):(l.x<0?(a=1,b=1):l.x>k?(a=-1,b=-1):(a=-1,b=1),m.xCurrentFactor=m.yCurrentFactor,m.xZoomMultiplier=m.yZoomMultiplier,m.xTotalMultiplier=m.yTotalMultiplier,i.xGridLine=i.yGridLine,m.currentXZoomLevel=m.currentYZoomLevel,i.distanceBetweenTwoVerticalLines=i.distanceBetweenTwoHorizontalLines,i.currentDistanceBetweenTwoVerticalLines=i.currentDistanceBetweenTwoHorizontalLines,i.totalVerticalLines=k/i.currentDistanceBetweenTwoVerticalLines,n.xUpper=b*(Math.abs(l.x-k)/i.currentDistanceBetweenTwoVerticalLines/i.xGridLine)*m.xTotalMultiplier,n.xLower=a*(Math.abs(l.x-0)/i.currentDistanceBetweenTwoHorizontalLines)/i.xGridLine*m.xTotalMultiplier),this._triggerEqualizeEvent(!1),this._setBounds(),this._originPositionOnGraph(),this._graphTypeSelector(),0!==e.get("_plots").length&&this._shapeRedraw(),0!==e.get("_points").length&&this._repositionPoints(),this._setTextBoxValues()},_cartesionSymbolGenerator:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=this._gridGraphModelObject,q=p.get("_graphDisplayValues"),r=this._canvasSize.height,s=this._canvasSize.width,t=q._symbols;q._graphDisplay.isProjectorModeOn===!0?(a=2,b=new this._paperScope.Color(.8,.8,.8),c=new this._paperScope.Color(.4,.4,.4)):(a=1,b=new this._paperScope.Color(.9,.9,.9),c=new this._paperScope.Color(.7,.7,.7)),d=new this._paperScope.Path.Line({from:[0,0],to:[0,r],strokeColor:b,strokeWidth:1}),e=new this._paperScope.Path.Line({from:[0,0],to:[0,r],strokeColor:c,strokeWidth:1}),f=new this._paperScope.Symbol(d),g=new this._paperScope.Symbol(e),d.remove(),e.remove(),t.xInnerGridLines=f,t.xMarkerLines=g,h=new this._paperScope.Path.Line({from:[0,0],to:[s,0],strokeColor:b,strokeWidth:1}),i=new this._paperScope.Path.Line({from:[0,0],to:[s,0],strokeColor:c,strokeWidth:1}),j=new this._paperScope.Symbol(h),k=new this._paperScope.Symbol(i),h.remove(),i.remove(),t.yInnerGridLines=j,t.yMarkerLines=k,m=new this._paperScope.Path.Line({from:[0,0],to:[0,r],strokeColor:0,strokeWidth:a}),l=new this._paperScope.Path.Line({from:[0,0],to:[s,0],strokeColor:0,strokeWidth:a}),n=new this._paperScope.Symbol(l),o=new this._paperScope.Symbol(m),l.remove(),m.remove(),t.xAxis=n,t.yAxis=o},_distanceBetweenLinesCalculator:function(){var a,b=this._gridGraphModelObject.get("_graphDisplayValues"),c=b._graphsAxisLimits.currentLimits,d=b._graphParameters;a=this._calculateDistanceBetweenAdjecentLines(c.xLower,c.xUpper,c.yLower,c.yUpper),d.totalVerticalLines=a.totalVerticalLines,d.distanceBetweenTwoVerticalLines=d.currentDistanceBetweenTwoVerticalLines=a.distanceBetweenVerticalLines,d.totalHorizontalLines=a.totalHorizontalLines,d.distanceBetweenTwoHorizontalLines=d.currentDistanceBetweenTwoHorizontalLines=a.distanceBetweenHorizontalLines},_calculateDistanceBetweenAdjecentLines:function(a,b,c,d){var e,f,g,h,i=this._canvasSize.height,j=this._canvasSize.width,k=this._gridGraphModelObject,l=k.get("_graphDisplayValues"),m=(l._graphsAxisLimits.currentLimits,l._zoomingFactor,l._graphParameters),n=m.xGridLine,o=m.yGridLine;return e=(b-a)/l._zoomingFactor.xTotalMultiplier*n,f=j/e,g=(d-c)/l._zoomingFactor.yTotalMultiplier*o,h=i/g,{distanceBetweenVerticalLines:f,totalVerticalLines:e,distanceBetweenHorizontalLines:h,totalHorizontalLines:g}},_originPositionOnGraph:function(){var a,b,c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),e=this._canvasSize.height,f=this._canvasSize.width,g=d._graphsAxisLimits.currentLimits,h=d._graphParameters,i=g.xLower,j=g.yUpper,k=h.xGridLine,l=h.yGridLine,m=this._paperScope;a=i>=0?0-i:Math.abs(i),b=0>=j?0-Math.abs(j):Math.abs(j),d._graphOrigin.currentOrigin=new m.Point(a/d._zoomingFactor.xTotalMultiplier*k*h.currentDistanceBetweenTwoVerticalLines,b/d._zoomingFactor.yTotalMultiplier*l*h.currentDistanceBetweenTwoHorizontalLines),this._previousMaxValue=this._getGraphPointCoordinates([f,e/2])[0]},_cartesianGraph:function(){this._paperScope.project.activeLayer.removeChildren();var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=this._gridGraphModelObject,G=F.get("_graphDisplayValues"),r=(F.get("markerBounds"),this._canvasSize),H=G._graphParameters,I=(G._zoomingFactor,G._symbols),J=G._graphDisplay.isGridLineShown,K=r.height,L=r.width,M=H.xGridLine,N=H.yGridLine,O=G._graphOrigin.currentOrigin;if(C=new this._paperScope.Point(0,0),D=new this._paperScope.Size(this._canvasSize.width,this._canvasSize.height),E=new this._paperScope.Shape.Rectangle(C,D),E.fillColor=this._backgroundColor,J===!0){for(G._graphDisplay.isXmarkerInRadians===!1?(a=H.currentDistanceBetweenTwoVerticalLines,b=H.totalVerticalLines):(x=this._zoomLevelLimits().xMinZoomLevel*H.distanceBetweenTwoVerticalLines,B=this._getRadianMarkers(x,!0),s=B.marker,A=s/Math.PI,M=this._numberOfMarkerLines(A),t=this._getCanvasPointCoordinates([s,0]),u=Math.abs(O.x-t[0]),v=u/M,w=L/v,x>v&&(s=B.maxMarker,A=s/Math.PI,M=this._numberOfMarkerLines(A),t=this._getCanvasPointCoordinates([s,0]),u=Math.abs(O.x-t[0]),v=u/M,w=L/v),a=v,b=w),O.x>=0?(c=O.x,d=parseInt(c/a,10),e=c-d*a,f=0,g=M-d%M):(h=Math.abs(O.x),i=parseInt(h/a,10),e=a-(h-i*a),f=0,g=i,0!==e&&g++),G._graphDisplay.isYmarkerInRadians===!1?(j=H.currentDistanceBetweenTwoHorizontalLines,k=H.totalHorizontalLines):(x=this._zoomLevelLimits().yMinDistance,B=this._getRadianMarkers(x,!1),s=B.marker,A=s/Math.PI,N=this._numberOfMarkerLines(A),t=this._getCanvasPointCoordinates([0,s]),u=Math.abs(O.y-t[1]),y=u/N,z=K/y,x>y&&(s=B.maxMarker,A=s/Math.PI,N=this._numberOfMarkerLines(A),t=this._getCanvasPointCoordinates([0,s]),u=Math.abs(O.y-t[1]),y=u/N,z=K/y),j=y,k=z),O.y>=0?(l=O.y,m=parseInt(l/j,10),n=l-m*j,o=N-m%N):(p=Math.abs(O.y),q=parseInt(p/j,10),n=j-(p-q*j),o=q,0!==n&&o++),f=0;b>f;f++,g++)g%M===0?I.xMarkerLines.place(new this._paperScope.Point(e+f*a,K/2)):I.xInnerGridLines.place(new this._paperScope.Point(e+f*a,K/2));for(f=0;k>f;f++,o++)o%N===0?I.yMarkerLines.place(new this._paperScope.Point(L/2,n+f*j)):I.yInnerGridLines.place(new this._paperScope.Point(L/2,n+f*j))}},_numberOfMarkerLines:function(a){var b=this.GRID_LINES,c=/5/g;return c.test(a)?b.FIVE_MULTIPLIER:b.DEFAULT},_getRadianMarkers:function(a,b){var c,d,e,f,g,h,i,j,k,l=this._gridGraphModelObject,m=l.get("_graphDisplayValues");return b===!0?(i=m._zoomingFactor.xTotalMultiplier,j=m._zoomingFactor.xCurrentFactor,k=m._zoomingFactor.xZoomMultiplier):(i=m._zoomingFactor.yTotalMultiplier,j=m._zoomingFactor.yCurrentFactor,k=m._zoomingFactor.yZoomMultiplier),5===i?(d=Math.ceil(i/Math.PI)*Math.PI,e=Math.floor(i/Math.PI)*Math.PI):5===j&&(1>k?(c=Math.log(1/k)/Math.LN10,d=Math.PI/(6*Math.pow(8,c-1)),e=Math.PI/(12*Math.pow(8,c-1))):(d=2*k*Math.PI,e=k*Math.PI)),2===i?(d=Math.PI,e=Math.PI/2):2===j&&(1>k?(c=Math.log(1/k)/Math.LN10,d=Math.PI/(12*Math.pow(8,c-1)),e=Math.PI/(3*Math.pow(8,c))):(d=k*Math.PI,e=5*(k/10)*Math.PI)),1===i?(d=Math.PI/3,e=Math.PI/3):1===j&&(1>k?(c=Math.log(1/k)/Math.LN10,d=Math.PI/(3*Math.pow(8,c)),e=Math.PI/(6*Math.pow(8,c))):(d=5*(k/10)*Math.PI,e=2*(k/10)*Math.PI)),f=this._getCanvasPointCoordinates([0,0]),g=b?this._getCanvasPointCoordinates([d,0]):this._getCanvasPointCoordinates([0,d]),h=Math.sqrt(Math.abs(Math.pow(f[0]-g[0],2)+Math.pow(f[1]-g[1],2))),h/2>=a?{marker:e,minMarker:e,maxMarker:d}:{marker:d,minMarker:e,maxMarker:d}},_graphStartingGridLines:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;return z=this._gridGraphModelObject,A=z.get("_graphDisplayValues"),v=this._canvasSize,w=A._graphParameters,y=A._zoomingFactor,x=A._symbols,a=0,b=v.height,c=v.width,E=w.xGridLine,F=w.yGridLine,d=A._graphOrigin.currentOrigin,e=w.distanceBetweenTwoVerticalLines,f=w.totalVerticalLines,d.x>=0?(g=d.x,h=parseInt(g/e,10),i=g-h*e,j=0,k=E-h%E,B=parseInt(h/E,10)):(l=Math.abs(d.x),m=parseInt(l/e,10),i=e-(l-m*e),j=0,k=m,B=parseInt(m/E,10),0!==i&&k++),n=w.distanceBetweenTwoHorizontalLines,o=w.totalHorizontalLines,d.y>=0?(p=d.y,q=parseInt(p/n,10),r=p-q*n,s=F-q%F,C=parseInt(q/F,10)):(t=Math.abs(d.y),u=parseInt(t/e,10),r=e-(t-u*e),s=u,C=parseInt(u/F,10),0!==r&&s++),D=[i,k,B,r,s,C]},_polarGraph:function(){this._paperScope.project.activeLayer.removeChildren();var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R=this._gridGraphModelObject,S=R.get("_graphDisplayValues"),T=S._graphParameters,U=(S._zoomingFactor,this._canvasSize),V=S._graphDisplay.isLabelShown,W=S._graphDisplay.isGridLineShown,X=T.currentDistanceBetweenTwoVerticalLines,Y=T.currentDistanceBetweenTwoHorizontalLines,Z=(T.totalVerticalLines,U.width),$=U.height,_=T.xGridLine,aa=(T.yGridLine,S._graphOrigin.currentOrigin),ba=0;if(O=new this._paperScope.Point(0,0),P=new this._paperScope.Size(this._canvasSize.width,this._canvasSize.height),Q=new this._paperScope.Shape.Rectangle(O,P),Q.fillColor="white",d=Math.sqrt(Math.pow(aa.x-0,2)+Math.pow(aa.y-0,2)),e=Math.sqrt(Math.pow(aa.x-Z,2)+Math.pow(aa.y-0,2)),f=Math.sqrt(Math.pow(aa.x-Z,2)+Math.pow(aa.y-$,2)),g=Math.sqrt(Math.pow(aa.x-0,2)+Math.pow(aa.y-$,2)),ba=(c=(c=d>e?d:e)>f?c:f)>g?c:g,h=Y>X?X:Y,aa.y<0?aa.x<0?(p=Math.abs(aa.y),q=Math.sqrt(Math.pow(aa.x-0,2)+Math.pow(aa.y-0,2)),o=2*Math.PI-Math.acos(p/q),m=Math.abs(aa.x),n=Math.abs(aa.y),b=q):aa.x>Z?(p=Math.abs(aa.y),q=Math.sqrt(Math.pow(aa.x-Z,2)+Math.pow(aa.y-0,2)),o=1.5*Math.PI-Math.acos(p/q),m=Math.abs(aa.x)-Z,n=Math.abs(aa.y),b=q):(o=Math.PI/2,n=Math.abs(aa.y),m=X/Y*n,b=Math.abs(aa.y)):aa.y>$?aa.x<0?(p=Math.abs(aa.x),q=Math.sqrt(Math.pow(aa.x-0,2)+Math.pow(aa.y-$,2)),o=Math.acos(p/q),m=Math.abs(aa.x),n=Math.abs(aa.y)-$,b=q):aa.x>Z?(p=Math.abs(aa.x)-Z,q=Math.sqrt(Math.pow(aa.x-Z,2)+Math.pow(aa.y-$,2)),o=Math.PI-Math.acos(p/q),m=Math.abs(aa.x)-Z,n=Math.abs(aa.y)-$,b=q):(o=Math.PI/2,n=Math.abs(aa.y)-$,m=X/Y*n,b=Math.abs(aa.y)-$):aa.x<0?(o=0,m=Math.abs(aa.x),n=m*Y/X,b=Math.abs(aa.x)):aa.x>Z?(o=0,m=Math.abs(aa.x)-Z,n=m*Y/X,b=Math.abs(aa.x)-Z):(b=0,i=0,o=0,m=0,n=0),j=new this._paperScope.Point(aa.x+m*Math.cos(o),aa.y+n*Math.sin(o)),k=new this._paperScope.Point(aa.x+(m+X)*Math.cos(o),aa.y+(n+Y)*Math.sin(o)),l=Math.sqrt(Math.pow(j.x-k.x,2)+Math.pow(j.y-k.y,2)),i=parseInt(b/l,10),b=i*l,m=X*i,n=Y*i,r=b,s=m,t=n,S.isProjectorModeOn===!0?(u=new this._paperScope.Color(.8,.8,.8),v=new this._paperScope.Color(.4,.4,.4)):(u=new this._paperScope.Color(.9,.9,.9),v=new this._paperScope.Color(.7,.7,.7)),W===!0)for(;ba>=b;b+=h,m+=X,n+=Y)a=i%_===0?new this._paperScope.Path.Ellipse({point:[aa.x-m,aa.y-n],size:[2*m,2*n],strokeColor:v}):new this._paperScope.Path.Ellipse({point:[aa.x-m,aa.y-n],size:[2*m,2*n],strokeColor:u}),i++;for(S._graphDisplay.isProjectorModeOn===!0?(w=new this._paperScope.Color(.8,.8,.8),x=this.MARKER_FONT_SIZE.ON_GRAPH_AREA,y=new this._paperScope.Color(.6,.6,.6)):(w=new this._paperScope.Color(.9,.9,.9),x=14,y=new this._paperScope.Color(.7,.7,.7)),N=this._polarLineAngleMarker,z=S._graphDisplay.isPolarAngleInRadian===!0?N.radian:N.degree,A=0,aa.x<Z&&aa.x>0&&aa.y<$&&aa.y>0?(B=3,C=3,D=2,E=6,aa.x<=Y*_*2||Z-aa.x<=Y*_*2?(F=t+X*_*5-X,G=s+Y*_*5-Y):(F=t+X*_*3-X,G=s+Y*_*3-Y)):(B=4,C=1,D=1,E=3,F=t+X*_*6,G=s+Y*_*6),M=0;360>M;M+=5)H=aa.x+ba*Math.cos(M*Math.PI/180),I=aa.y+ba*Math.sin(M*Math.PI/180),M%C===0&&(W===!0&&(a=new this._paperScope.Path.Line({from:aa,to:[H,I],strokeColor:w})),V===!0&&M%E===0&&(o=M*Math.PI/180,J=aa.x+F*Math.cos(o),K=aa.y+G*Math.sin(o),L=new this._paperScope.PointText({point:[J,K],content:z[A],fontSize:x,fillColor:y}),A+=D))},_polarAngleLinesMarkerArrayGenerator:function(){var a,b,c,d,e,f,g,h,i,j;for(a=[0,345,330,315,300,285,270,255,240,225,210,195,180,165,150,135,120,105,90,75,60,45,30,15],this._polarLineAngleMarker.degree=a,d=this.PI,e=[0],b=1,c=23;c>0;c--){for(f=12>c?c:12,h=12,i=c,g=1,j=f;j>=2;j--)for(;h%j===0&&i%j===0;)h/=j,i/=j;1===i&&1===h?e[b]=d:1===i?e[b]=d+"/"+h:1===h?e[b]=i+d:e[b]=i+d+"/"+h,b++}this._polarLineAngleMarker.radian=e},_drawAxisLines:function(){var a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),c=b._graphOrigin.currentOrigin,d=b._graphDisplay.isAxisLinesShown,e=b._symbols,f=this._canvasSize,e=(b._graphParameters,b._symbols),g=f.height,h=f.width;d===!0&&(e.xAxis.place(new this._paperScope.Point(h/2,c.y)),e.yAxis.place(new this._paperScope.Point(c.x,g/2)))},_axisMarker:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=this._gridGraphModelObject,N=M.get("_graphDisplayValues"),O=this._canvasSize,P=N._graphParameters,Q=(N._symbols,O.height),R=O.width,S=N._graphOrigin.currentOrigin,T=N._zoomingFactor,U=T.xZoomMultiplier,V=T.yZoomMultiplier,W=T.xTotalMultiplier,X=T.yTotalMultiplier,Y=P.xGridLine,Z=P.yGridLine,$=N._graphDisplay.isCartesionCurrentGraphType,_=N._graphDisplay.isProjectorModeOn,aa=N._graphDisplay.isLabelShown,ba=this.MARKER_FONT_COLOR.ON_GRAPH_AREA,ca=this.MARKER_FONT_COLOR.AT_END_OF_GRAPH_AREA,da=ba,a=_?this.MARKER_FONT_SIZE.ON_GRAPH_AREA_PROJECTOR_MODE:this.MARKER_FONT_SIZE.ON_GRAPH_AREA,ea=this.TEXT_ALIGN.HORIZONTAL,fa=this.TEXT_ALIGN.VERTICAL,ga={},ha=N._graphDisplay.isXmarkerInRadians,ia=N._graphDisplay.isYmarkerInRadians,ja=8,ka=8,la=5,ma=5,na="arial";if(aa!==!1){for(ha===!1||$===!1?(c=P.currentDistanceBetweenTwoVerticalLines,d=P.totalVerticalLines,S.x>=0?(g=S.x,h=parseInt(g/c,10),i=g-h*c,j=Y-h%Y,k=parseInt(h/Y,10)):(o=Math.abs(S.x),p=parseInt(o/c,10),i=c-(o-p*c),j=p,k=parseInt(p/Y,10),0!==i&&(j++,k++)),q=W,S.x>=0&&N._graphDisplay.isCartesionCurrentGraphType===!0&&(q=-W),K=1):(C=this._zoomLevelLimits().xMinDistance,G=this._getRadianMarkers(C,!0),x=G.marker,F=x/Math.PI,Y=this._numberOfMarkerLines(F),y=this._getCanvasPointCoordinates([x,0]),z=Math.abs(S.x-y[0]),A=z/Y,B=R/A,C>A&&(x=G.maxMarker,F=x/Math.PI,Y=this._numberOfMarkerLines(F),y=this._getCanvasPointCoordinates([x,0]),z=Math.abs(S.x-y[0]),A=z/Y,B=R/A),c=A,d=B,S.x>=0?(g=S.x,h=parseInt(g/c,10),i=g-h*c,b=0,j=Y-h%Y,k=x/Math.PI*parseInt(h/Y,10)):(o=Math.abs(S.x),p=parseInt(o/c,10),i=c-(o-p*c),b=0,j=p,k=x/Math.PI*parseInt(p/Y,10),0!==i&&(j++,k+=x/Math.PI)),q=1,S.x>=0&&N._graphDisplay.isCartesionCurrentGraphType===!0&&(q=-1),K=x/Math.PI),b=0;d>=b;b++)H=ea.CENTER,I=fa.BOTTOM,j%Y===0&&(m=i+b*c,n=S.y,l=ha===!1||$===!1?this._getPowerOfNumber(k*q,U,q):this._getProperFormedRadianMarkerText(k*q,U,q),v=l[0],w=l[1],0===w&&(n+=ja),$===!1&&0>v&&(v=-v),J=this._displayToPower10(v,w,new this._paperScope.Point(m,n),{fontSize:a,fontColor:da,justification:H,verticalAlign:I},!1),0!==k?J.base.x<=0?(m=ma,H=ea.left):J.base.x+J.base.width+J.power.width>=R&&J.base.x+J.base.width/2<=R?(m=R-ma,H=ea.RIGHT):J.base.x+J.base.width+J.power.width>=R&&J.base.x+J.base.width/2>R&&(H=ea.LEFT):(m-=8,H=ea.RIGHT),$===!0&&(J.base.y<0||J.power.y<0?(n=0+ma,da=ca,I=fa.BOTTOM):J.base.y+J.base.height>Q&&(n=Q-ma,da=ca,I=fa.TOP)),(S.y>0&&S.y<Q&&0===v||0!==k)&&(ga={fontSize:a,fontColor:da,justification:H,verticalAlign:I,fontFamily:na},_&&(ga.strokeWidth=.3,ga.strokeColor=da),this._displayToPower10(v,w,new this._paperScope.Point(m,n),ga)),S.x<0?k+=K:k-=K),j++;for(ia===!1||$===!1?(e=P.currentDistanceBetweenTwoHorizontalLines,f=P.totalHorizontalLines,S.y>=0?(r=S.y,s=parseInt(r/e,10),i=r-s*e,j=Z-s%Z,k=parseInt(s/Z,10)):(t=Math.abs(S.y),u=parseInt(t/e,10),i=e-(t-u*e),j=u,k=parseInt(u/Z,10),0!==i&&(j++,k++)),S.y<0&&N._graphDisplay.isCartesionCurrentGraphType===!0&&(X=-X),L=1):(C=this._zoomLevelLimits().yMinDistance,G=this._getRadianMarkers(C,!1),x=G.marker,F=x/Math.PI,Z=this._numberOfMarkerLines(F),y=this._getCanvasPointCoordinates([0,x]),z=Math.abs(S.y-y[1]),D=z/Z,E=Q/D,C>D&&(x=G.maxMarker,F=x/Math.PI,Z=this._numberOfMarkerLines(F),y=this._getCanvasPointCoordinates([0,x]),z=Math.abs(S.y-y[1]),D=z/Z,E=Q/D),e=D,f=E,S.y>=0?(r=S.y,s=parseInt(r/e,10),i=r-s*e,j=Z-s%Z,k=x/Math.PI*parseInt(s/Z,10)):(t=Math.abs(S.y),u=parseInt(t/e,10),i=e-(t-u*e),j=u,k=x/Math.PI*parseInt(u/Z,10),0!==i&&(j++,k+=x/Math.PI)),X=1,S.y<0&&N._graphDisplay.isCartesionCurrentGraphType===!0&&(X=-1),L=x/Math.PI),da=ba,b=0;f>=b;b++)j%Z===0&&(I=fa.MIDDLE,H=ea.RIGHT,l=ia===!1||$===!1?this._getPowerOfNumber(k*X,V,X):this._getProperFormedRadianMarkerText(k*X,V,X),v=l[0],w=l[1],n=i+b*e,m=S.x-ka,$===!1&&0>v&&(v=-v),J=this._displayToPower10(v,w,new this._paperScope.Point(m,n),{fontSize:a,fontColor:da,justification:H,verticalAlign:I},!1),J.base.y+J.base.height/4<=0||J.power.y<=0?(n=2,I=fa.BOTTOM):J.base.y+J.base.height>Q&&(n=Q,I=fa.TOP),$===!0&&(J.base.x<0?(m=la,H=ea.LEFT,da=ca):S.x>R&&(m=R-la,H=ea.RIGHT,da=ca)),0!==v&&(ga={fontSize:a,fontColor:da,justification:H,verticalAlign:I,fontFamily:na},_&&(ga.strokeWidth=.3,ga.strokeColor=da),this._displayToPower10(v,w,new this._paperScope.Point(m,n),ga)),S.y<0?k+=L:k-=L),j++}},_getProperFormedRadianMarkerText:function(a,b,c){var d,e=Math.PI,f=this.PI;return b>1e4?(a*=e,d=this._getPowerOfNumber(a,b,c)):Math.abs(a)*e<e/25?(a*=e,d=this._getPowerOfNumber(a,b,c)):(d=this._convertToFractional(a),a=1===Math.abs(d[0])&&1===d[1]?1===d[0]?f:"-"+f:1===Math.abs(d[0])?1===d[0]?f+"/"+d[1]:"-"+f+"/"+d[1]:1===d[1]?d[0]+f:d[0]+f+"/"+d[1],[a,0])},_convertToFractional:function(a){var b,c,d,e,f;if(a=parseFloat(a.toFixed(2)),-1===a.toString().indexOf("."))return[a,1];for(b=a,c=.01,d=1,e=1,f=d/e;Math.abs(f-b)>c;)b>f?d++:(e++,d=parseInt(Math.round(b*e),10)),f=d/e;return[d,e]},_getPowerOfNumber:function(a,b,c){a=parseFloat(a);for(var d,e,f,g=0,h=1,c=Math.abs(c);1>c;)h++,c=10*c;if(0>a){if(d=Math.abs(a),1e-4>b)for(;1>d;)d=10*d,g-=1;else if(b>1e4)for(;d/10>=1;)d/=10,g+=1;a=-d}else if(1e-4>b&&0!==a)for(;1>a;)a=10*a,g-=1;else if(b>1e4)for(;a/10>=1;)a/=10,g+=1;return e=a,e=h>4?parseFloat(a.toFixed(h)):parseFloat(a.toFixed(4)),f=[],f.push(e),f.push(g),f},_displayToPower10:function(a,b,c,d,e){var f,g,a,h,i,j,k,l,m,n=d.strokeColor,o=d.fontSize,p=d.justification,q=d.verticalAlign,r=d.fontColor,s=d.strokeWidth,t=this.TEXT_ALIGN.HORIZONTAL,u=d.fontFamily,v=this.TEXT_ALIGN.VERTICAL;return f=new this._paperScope.PointText({point:c,justification:"left",fontSize:o,fillColor:r,strokeColor:n,strokeWidth:s,content:a,fontFamily:u}),g=new this._paperScope.PointText({point:[c.x+f.bounds.width,c.y],justification:"left",fontSize:3*o/4,fillColor:r,strokeColor:n,strokeWidth:s,fontFamily:u}),0!==b&&(f.content=f.content+this._X10_STRING,g.content=b,g.bounds.x=f.bounds.x+f.bounds.width,g.bounds.y=f.bounds.y-g.bounds.height/4),h=f.bounds.height,i=f.bounds.width,j=g.bounds.height,k=g.bounds.width,q===v.MIDDLE?(f.bounds.y+=h/4,g.bounds.y+=h/4):q===v.BOTTOM&&(f.bounds.y+=h/2+j/2,g.bounds.y+=h/2+j/2),p===t.RIGHT?(f.bounds.x-=k+i,g.bounds.x-=k+i):p===t.CENTER&&(f.bounds.x-=k/2+i/2,g.bounds.x-=k/2+i/2),l={x:f.bounds.x,y:f.bounds.y,width:f.bounds.width,height:f.bounds.height},m={x:g.bounds.x,y:g.bounds.y,width:g.bounds.width,height:g.bounds.height},e===!1&&(f.remove(),g.remove()),{base:l,power:m}},_getCanvasPointCoordinates:function(a){var b,c,d=this._gridGraphModelObject,e=d.get("_graphDisplayValues"),f=e._graphOrigin.currentOrigin,g=e._graphParameters.currentDistanceBetweenTwoVerticalLines,h=e._graphParameters.currentDistanceBetweenTwoHorizontalLines,i=e._graphParameters.xGridLine,j=e._graphParameters.yGridLine,k=e._zoomingFactor,l=k.xTotalMultiplier,m=k.yTotalMultiplier,n=[];return b=f.x+a[0]*i*g/l,n.push(b),c=f.y-a[1]*j*h/m,n.push(c),n},_getGraphPointCoordinates:function(a){var b,c,d=this._gridGraphModelObject,e=d.get("_graphDisplayValues"),f=e._graphOrigin.currentOrigin,g=e._graphParameters.currentDistanceBetweenTwoVerticalLines,h=e._graphParameters.currentDistanceBetweenTwoHorizontalLines,i=e._graphParameters.xGridLine,j=e._graphParameters.yGridLine,k=e._zoomingFactor,l=k.xTotalMultiplier,m=k.yTotalMultiplier,n=[];return b=-((f.x-a[0])/g/i)*l,c=(f.y-a[1])/h/j*m,n.push(b),n.push(c),n},_deltaAngle:function(){var a,b,c,d,e=this._gridGraphModelObject,f=e.get("_graphDisplayValues"),g=e.get("markerBounds"),h=f._graphOrigin.currentOrigin,i=this._canvasSize.height,j=this._canvasSize.width;h.y<0?h.x<0?(a=new this._paperScope.Point(0,i),c=this._angleBetweenTwoPoints(h,a),b=new this._paperScope.Point(j,0),d=this._angleBetweenTwoPoints(h,b)):h.x>j?(a=new this._paperScope.Point(0,0),c=this._angleBetweenTwoPoints(h,a),b=new this._paperScope.Point(j,i),d=this._angleBetweenTwoPoints(h,b)):(a=new this._paperScope.Point(0,0),c=this._angleBetweenTwoPoints(h,a),b=new this._paperScope.Point(j,0),d=this._angleBetweenTwoPoints(h,b)):h.y>i?h.x<0?(a=new this._paperScope.Point(j,i),c=this._angleBetweenTwoPoints(h,a),b=new this._paperScope.Point(0,0),d=this._angleBetweenTwoPoints(h,b)):h.x>j?(a=new this._paperScope.Point(j,0),c=this._angleBetweenTwoPoints(h,a),b=new this._paperScope.Point(0,i),d=this._angleBetweenTwoPoints(h,b)):(a=new this._paperScope.Point(j,i),c=this._angleBetweenTwoPoints(h,a),b=new this._paperScope.Point(0,i),d=this._angleBetweenTwoPoints(h,b)):h.x<0?(a=new this._paperScope.Point(j,0),c=this._angleBetweenTwoPoints(h,a),b=new this._paperScope.Point(j,i),d=this._angleBetweenTwoPoints(h,b)):h.x>j?(a=new this._paperScope.Point(j,0),c=this._angleBetweenTwoPoints(h,a),b=new this._paperScope.Point(j,i),d=this._angleBetweenTwoPoints(h,b)):(a=new this._paperScope.Point(j,0),c=this._angleBetweenTwoPoints(h,a),b=new this._paperScope.Point(j,i),d=this._angleBetweenTwoPoints(h,b)),this.markerBounds.max["\\theta"]=g.max["\\theta"]=d,this.markerBounds.min["\\theta"]=g.min["\\theta"]=c},repositionImage:function(a){var b=this._getCanvasPointCoordinates(a.getPoints());a.getRaster().position={x:b[0],y:b[1]},this._paperScope.view.draw()},_shapeRedraw:function(){this._projectLayers.shapeLayer.activate(),null!==this._paperScope.project.activeLayer.children&&this._paperScope.project.activeLayer.removeChildren(),this.trigger("graph:zoom-pan"),this._projectLayers.gridLayer.activate()},_delta:null,_previousMaxValue:null,_shapeZoom:function(){this.activateScope(),this._projectLayers.shapeLayer.activate();var a,b,c,d,e=this._gridGraphModelObject,f=e.get("_graphDisplayValues"),g=f._graphOrigin.currentOrigin,h=this._canvasSize.height,i=this._canvasSize.width,a=this._getGraphPointCoordinates([i,h/2])[0],j=this._previousMaxValue/a;for(c=this._paperScope.project.activeLayer.children,d=c.length,b=0;d>b;b++)c[b].bounds.x-=this._delta.x,c[b].bounds.y-=this._delta.y,c[b].scale(j,g);this._previousMaxValue=a,this.refreshView()},_layerDrag:function(a,b){a.activate();var c=this._paperScope.project.activeLayer.children,d=c.length;0!==d&&(a.bounds.x+=b.x,a.bounds.y+=b.y)},drawPoint:function(a){this._projectLayers.pointLayer.activate();var b,c,d,e,f,g,h=this._gridGraphModelObject;c=a.getColor(),d=3*a.getThickness(),e=a.getOpacity(),f=a.getDashArray(),g=a.getPointVisibility(),b=new this._paperScope.Group,-1===h.get("_points").indexOf(a)&&h.get("_points").push(a),this._drawPoints(a),this.refreshView(),this._projectLayers.gridLayer.activate()},resetGraph:function(a){var b;b=this._gridGraphModelObject;var c,d=function(a,b,c,d){this._axisMarkerMultiplierAdjuster(c,d,a,b,!0),this._graphTypeSelector(),this._repositionPoints(),this._shapeRedraw()},e=b.get("_points"),f=[];if("undefined"!=typeof a)f=a;else for(var g=0;g<e.length;g++){c=e[g].getPoints();for(var h=0;h<c.length;h++)f.push(c[h])}for(var i=this.getMarkerBounds(),j=i.min.x,k=i.min.y,l=i.max.x,m=i.max.y,n=f,o=null,p=null,q=0;q<n.length;q++)null===o?(o=[],p=[],o.push(Math.abs(n[q][0])),o.push(Math.abs(n[q][1])),p.push(n[q][0]),p.push(n[q][1]),o.push(0)):(Math.abs(n[q][0])>o[0]&&(o[0]=Math.abs(n[q][0]),p[0]=n[q][0],o[2]=q),Math.abs(n[q][1])>o[1]&&(o[1]=Math.abs(n[q][1]),p[1]=n[q][1],o[2]=q));var r,s,t,u,v=Math.abs(this._getCurrentBandPadding(i.max.y-i.min.y,this._canvasSize.height,this.paddingTop)),w=Math.abs(this._getCurrentBandPadding(i.max.x-i.min.x,this._canvasSize.width,this.paddingLeft));l/Math.abs(l)===-1?t=l+w:l/Math.abs(l)===1&&(t=l-w),m/Math.abs(m)===-1?u=m-v:m/Math.abs(m)===1&&(u=m-v),j/Math.abs(j)===-1?r=j+w:j/Math.abs(j)===1&&(r=j+w),k/Math.abs(k)===-1?s=k+v:k/Math.abs(k)===1&&(s=k-v);var x=p;if(x[0]>=t||x[1]>=u||x[0]<=r||x[1]<=s||"undefined"==typeof a){var y=this._getNewBoundsWithPadding(o[0],this._canvasSize.width,this.paddingLeft),z=this._getNewBoundsWithPadding(o[1],this._canvasSize.height,this.paddingTop);
$.proxy(d,this)(-z,z,-y,y)}},_getCurrentBandPadding:function(a,b,c){return Math.ceil(c/b*a)},_getNewBoundsWithPadding:function(a,b,c){var d,e;return e=a/(b/2-c),d=e*(b/2),d+=d/10},_togglePointsColor:function(a,b){var c=a.getColor();return b&&a.changeColor(b),c},_showHoverOnPoint:function(a){var b;if("point"===a.getSpecie())return b=this._togglePointsColor(a,a.hoverColor)},_removeHoverOnPoint:function(a,b){var b;if("point"===a.getSpecie())return b=this._togglePointsColor(a,b)},_drawPoints:function(a){this.activateScope();var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(d=a.getColor(),e=3*a.getThickness(),f=a.getOpacity(),g=a.getDashArray(),h=a.getPointVisibility(),c=new this._paperScope.Group,k=this,o=function(){var b,c=[this.tooltipPoint[0],this.tooltipPoint[1]];c[0]=k._getNumberForToolTip(c[0]),c[1]=k._getNumberForToolTip(c[1]),b=$('.coordinate-tooltip[data-point="'+c[0]+"-"+c[1]+'"]').css("opacity",.4),k.$el.find("canvas").css("cursor","default"),m=k._showHoverOnPoint(a),0===b.length?k.showToolTipForPoint(this.bounds.center,[c[0],0],[c[1],0],!1,a):b.remove()},p=function(){var b,c=[this.tooltipPoint[0],this.tooltipPoint[1]];c[0]=k._getNumberForToolTip(c[0]),c[1]=k._getNumberForToolTip(c[1]),k.$el.find("canvas").css("cursor","pointer"),k._removeHoverOnPoint(a,m),b=$('.coordinate-tooltip[data-point="'+c[0]+"-"+c[1]+'"]'),b.remove()},l=a.getPoints(),n=l.length,i=0;n>i;i++)b=this._getCanvasPointCoordinates(l[i]),a.isDraggable()&&(j=this._getPointShapePath(a.pointShape,b,a.getDragHitThickness()/2,a.getDragHitColor()),j.hit=!0,j.fillColor.alpha=a.getDragHitAlpha(),j.equation=a,j.data.point=l[i],c.addChild(j)),j=this._getPointShapePath(a.pointShape,b,e/2),j.data.point=l[i],j.equation=a,this.isTooltipForPoint&&(j.tooltipPoint=l[i],j.onMouseEnter=o,j.onMouseLeave=p),c.addChild(j),0===a.getDashArray().length?j.fillColor=d:(j.fillColor="#ffffff",j.strokeColor=d),j.visible=h,k=this,this.repositionPointsToolTip(b);null!==a.getPointsGroup()&&(this._removePathRollOverListeners(a.getPointsGroup()),a.getPointsGroup().remove(),a.setPointsGroup(null)),a.setPointsGroup(c),this._setPathRollOverListeners(c),this.refreshView()},_getPointShapePath:function(a,b,c,d){var e;switch(d||(d="#000000"),a){case"triangle":e=new this._paperScope.Path.RegularPolygon(b,3,c);break;case"square":e=new this._paperScope.Path.RegularPolygon(b,4,c);break;default:e=new this._paperScope.Path.Circle({center:b,radius:c})}return e.fillColor=d,e},_repositionPoints:function(){this._projectLayers.pointLayer.activate();var a,b,c,d,e,f,g,h,i,j=this._gridGraphModelObject.get("_points"),k=j.length;for(a=0;k>a;a++){for(f=j[a],e=f.getPoints(),c=e.length,h=f.getPointsGroup(),b=0,i=0;c>b;b++,i++)d=this._getCanvasPointCoordinates(e[b]),g=h.children[i],g&&(g.position=new this._paperScope.Point(d),g.hit===!0&&(i++,g=h.children[i],g.position=new this._paperScope.Point(d)),this.repositionPointsToolTip(this._getGraphPointCoordinates(d)));null!==f.getLabelData()&&null!==f.getLabelData().labelObject&&this._updateLabelPosition(f)}this.refreshView()},_getNumberForToolTip:function(a){if(void 0!==a&&null!==a){var b,c,d,e,f=a.toString(),g=3;return-1===f.indexOf(".")?f:(f=Number(f).toFixed(g),b=f.split("."),d=/([0-9]*[1-9])([0]+)/g,b[1]=b[1].replace(d,function(a,b,c){return c=void 0,b}),e=Number(b[1]),0===e?Number(b[0]):(c=b[1].length,3>c&&(g=c),Number(f).toFixed(g)))}},removePoint:function(a){if(void 0!==a&&null!==a){this._projectLayers.pointLayer.activate();var b,c=this._gridGraphModelObject.get("_points").indexOf(a);-1!==c&&this._gridGraphModelObject.get("_points").splice(c,1),this._repositionPoints(),b=a.getPointsGroup(),b&&(this._removePathRollOverListeners(b),b.remove(),a.setPointsGroup(null)),this.$(".coordinate-tooltip[data-equation-cid="+a.cid+"]").remove(),this.refreshView(),this._projectLayers.gridLayer.activate()}},removeRaster:function(a){if("undefined"!=typeof a){this._projectLayers.imageLayer.activate();var b=a.getRaster();b&&(b.remove(),a.setRaster(null)),this.refreshView()}},_redrawPoints:function(){this._projectLayers.pointLayer.activate(),null!==this._paperScope.project.activeLayer.children&&this._paperScope.project.activeLayer.removeChildren();var a,b,c,d,e=this._gridGraphModelObject.get("_points"),f=this;for(c=function(){var a,c=f._getGraphPointCoordinates([this.bounds.center.x,this.bounds.center.y]);c[0]=f._getNumberForToolTip(c[0]),c[1]=f._getNumberForToolTip(c[1]),a=$('.coordinate-tooltip[data-point="'+c[0]+"-"+c[1]+'"]'),0===a.length?f.showToolTipForPoint(this.bounds.center,[c[0],0],[c[1],0],!1,b):a.remove()},d=function(){var a,b=f._getGraphPointCoordinates([this.bounds.center.x,this.bounds.center.y]);b[0]=f._getNumberForToolTip(b[0]),a=$('.coordinate-tooltip[data-point="'+b[0]+"-"+b[1]+'"]'),a.remove()},a=0;a<e.length;a++)this._drawPoints(e[a]);this.refreshView(),this._projectLayers.gridLayer.activate()},repositionPointsToolTip:function(a){var b,c,d,e,f,g,h,i,j,k=this.$("#"+this.ID.canvasId);a[0]=this._getNumberForToolTip(a[0]),a[1]=this._getNumberForToolTip(a[1]),b=$($('.coordinate-tooltip[data-point="'+a[0]+"-"+a[1]+'"]')[0]),0!==b.length&&(c=this._getCanvasPointCoordinates(a),h=k.height(),i=k.width(),j=k.position(),f=b.height(),g=b.width(),d=j.left+c[0],e=j.top+c[1]-2*f,c[1]-f<0||c[1]-f>h||c[0]<0||c[0]+2*g>=i?b.hide():b.show(),$(b[0]).css({top:e+"px",left:d+"px"}))},_changePlotColor:function(){var a=this.pathGroup;a.strokeColor=this.changed.color,this.refreshView()},setLabelStyle:function(a){var b;b=a.labelObject,b.fillColor="red",b.fontWeight="bold",b.fontSize=20,b.fontFamily="Montserrat",b.content=a.text},addLabel:function(a){var b=!1,c=this,d=a.getLabelData(),e=a.getPathGroup();switch(this._projectLayers.labelLayer.activate(),a.getSpecie()){case"point":d.labelObject?(this._updateLabelPosition(a,!0),b=!0):(d.labelObject=new this._paperScope.PointText,d.labelObject.equation=a,this.setLabelStyle(d),this._updateLabelPosition(a,!0),b=!0),d.isSaveRestoreData===!0&&(this._updateLabelPosition(a,!0),b=!0);break;case"polygon":d.labelObject?(this._updateLabelPosition(a,!0),b=!0):(d.labelObject=new this._paperScope.PointText,d.labelObject.equation=a,this.setLabelStyle(d),e&&void 0!==e.children[0]&&(this._updateLabelPosition(a,!0),b=!0)),d.isSaveRestoreData===!0&&(this._updateLabelPosition(a,!0),b=!0);break;case"plot":d.labelObject?e&&void 0!==e.children[0]&&(this._updateLabelPosition(a,!0),b=!0):(d.labelObject=new this._paperScope.PointText,d.labelObject.equation=a,this.setLabelStyle(d),e&&void 0!==e.children[0]&&(this._updateLabelPosition(a,!0),b=!0));break;case"drawAnnotation":return void(b=!1)}this.refreshView(),a.on("post-drag",function(a,b,d,e){c._updateLabelPosition(a,!0,d,e)}),a.on("post-relocate",function(a){c._updateLabelPosition(a)}),a.on("teleported",function(a){c._updateLabelPosition(a)}),a.on("drag-label",$.proxy(c._updateLabelPosition,c))},_updateLabelPosition:function(a,b,c,d){var e,f=a.getLabelData();(b!==!0||f.isSaveRestoreData===!0)&&this.trigger("change-label-position",void 0,a),e=[f.position.x,f.position.y],void 0!==c&&void 0!==d?(f.labelObject.position.x+=c,f.labelObject.position.y+=d):(f.labelObject.position.x=e[0],f.labelObject.position.y=e[1])},setBannerPosition:function(a,b){var b,c,d,e,f,g=a.model.equation.getBannerData().bannerObject;this._projectLayers.bannerLayer.activate(),this._paperScope.project.activeLayer.addChild(g),null!==b?(c=b.equation.getBannerData().bannerObject.children[2],d=c.bounds.y,e=c.bounds.x,f=c.bounds.height):(d=50,e=10,f=0),g.children[2].bounds.y=d+f+10,g.children[2].bounds.x=e,this._projectLayers.pointLayer.activate()},showToolTipForPoint:function(b,c,d,e,f){var g,h,i,j,k,l=this.$("#"+this.ID.canvasId),m=l.position(),n="";f&&(h=f.getCid(),i=f.getColor()),g=$("<div></div>").css({position:"absolute",top:m.top+b.y+"px",left:m.left+b.x+"px","z-index":1e3,"border-color":i}).attr("class","coordinate-tooltip"),j=a.Common.Utilities.Models.Utils.convertIntoScientificNotaion({number:c[0],numberOfDigits:5}).number,k=a.Common.Utilities.Models.Utils.convertIntoScientificNotaion({number:d[0],numberOfDigits:5}).number,f.titleLabel&&(n+=f.titleLabel+"<br/>"),f.xToolTipLabel&&f.yToolTipLabel?(n+=f.xToolTipLabel+":&nbsp",n+=j,0!==c[1]&&(n+="  "+c[1]),n+="<br>",n+=f.yToolTipLabel+":&nbsp;",n+=k,0!==d[1]&&(n+="  "+d[1])):(n=j,0!==c[1]&&(n+="  "+c[1]),n+=",&nbsp;"+k,0!==d[1]&&(n+="  "+d[1])),g.html(n),e?(this.$(".drag-tooltip").remove(),g.addClass("drag-tooltip")):(g.attr("data-point",c[0]+"-"+d[0]),g.attr("data-equation-cid",h));var o,p,q=g.css("top"),r=g.css("left");this.$el.parents(".de-mathematics-interactive .player").append(g),g.css({top:0,left:0}),o=g.width()+20+2,p=g.height()+6+2,g.css({top:q,left:r}),this.$el.find(".coordinate-tooltip").remove(),this.$el.append(g),g.css("top",g.position().top-(p+15)),g.position().left+o>this.$el.width()&&g.css("left",g.position().left-o),g.position().top<m.top&&g.css("top",g.position().top+(p+15+15))},addPoints:function(a){this._projectLayers.shapeLayer.activate();var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;for(E=a.getPathGroup(),null!==E&&(E.remove(),this._removePathRollOverListeners(E)),-1===this._gridGraphModelObject.get("_plots").indexOf(a)&&this._gridGraphModelObject.get("_plots").push(a),Backbone.listenTo(a,"change:color",$.proxy(this._changePlotColor,a)),u=a.getPoints(),v=a.getColor(),w=a.getThickness(),b=null,c=null,d=null,f=null,x=new this._paperScope.Group,g=new this._paperScope.Path,g.equation=a,g.strokeColor=v,g.strokeWidth=w,x.addChild(g),i=new this._paperScope.Point(0,0),j=new this._paperScope.Point(0,0),k=[],m=!1,s=[],t=[],y=1,z="color: #000",A="background: #0c0; color: #fff",C=0;C<u.length;C++)if(e=u[C],null===f||f[0]!==e[0]||f[1]!==e[1]){for(q=!1,l=0;4>l&&(m=void 0===k[l],0===l?(n="",m&&(k[l]=[]),k[l].push(e)):(m&&(k[l]=[]),p=k[l-1],k[l].push(this._getPointDiff(p))),o=k[l],n+="%c "+o[o.length-1][0].toFixed(5)+","+o[o.length-1][1].toFixed(5)+"%c>>",t[l]=l>=2&&(Math.abs(o[o.length-1][0])>y||Math.abs(o[o.length-1][1])>y)?A:z,2===l&&(r=o[o.length-1],(Math.abs(r[0])>y||Math.abs(r[1])>y)&&(B=this._getCanvasPointCoordinates(e))),!m);l++);q&&(h=new this._paperScope.Path,h.strokeColor=v,h.equation=a,h.strokeWidth=w,g=h,x.addChild(g)),e=this._getCanvasPointCoordinates(e),g.add(e),this._plottingPoints(x,c,b,e),c=b,b=e,f=e}x.strokeColor=v,this.refreshView(),a.setPathGroup(x),D=this,a.set({color:"black"})},_traceMouseDownHandle:function(a,b){if(this.isTooltipForPoint&&this.disableLineTooltip!==!0){b.bringToFront();var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(q=15,e=this._gridGraphModelObject,g=[],h=this._canvasSize.height,i=this._canvasSize.width,d=this._getGraphPointCoordinates([a.point.x,a.point.y]),k=this._getPowerOfNumber(d[0],this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.xTotalMultiplier),k[0]=parseFloat(k[0].toFixed(4)),0!==k[1]?(m=k[0].toString().length+k[1].toString().length+this._X10_STRING.length,n=2):(m=k[0].toString().length,n=1),l=this._getPowerOfNumber(d[1],this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.yTotalMultiplier),l[0]=parseFloat(l[0].toFixed(4)),0!==l[1]?(o=l[0].toString().length+l[1].toString().length+this._X10_STRING.length,p=2):(o=l[0].toString().length,p=1),f=new this._paperScope.Path([a.point.x,0],[a.point.x,h]),b.children)for(j=0;j<b.children.length;j++)g=g.concat(f.getIntersections(b.children[j]));else g=b.getIntersections(e.get("path"));if(g.length<1){if(f=new this._paperScope.Path([0,a.point.y],[i,a.point.y]),b.children)for(j=0;j<b.children.length;j++)g=g.concat(f.getIntersections(b.children[j]));else g=b.getIntersections(e.get("path"));g.length<1&&(f=new this._paperScope.Path)}b.children[0].equation.trigger("focus-equation"),c=new this._paperScope.Path.Circle(g[0].point,3),c.fillColor=b.children[0].equation.getColor(),this.disableLineTooltip!==!0&&this.showToolTipForPoint(g[0].point,k,l,!0,b.children[0].equation),e.set("circleDrag",c),e.set("path",f),this.refreshView()}},_traceMouseDragHandle:function(a,b){if(this.isTooltipForPoint&&this.disableLineTooltip!==!0){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=[],q=this._gridGraphModelObject;if(this.$el.find(".hover-tooltip").attr("event-id"))return q.get("circleDrag").visible=!1,void(this.isSnap=!0);if(this.isSnap=!1,q.get("circleDrag").visible=!0,0===q.get("path").firstSegment.point.y?q.get("path").position.x=a.point.x:q.get("path").position.y=a.point.y,b.children)for(e=0;e<b.children.length;e++)p=p.concat(b.children[e].getIntersections(q.get("path")));else p=b.getIntersections(q.get("path"));if(p.length<1)return q.get("circleDrag").visible=!1,void this.$(".drag-tooltip").remove();for(c=new Array(p.length),c[0]=p[0].point.getDistance(a.point),d=c[0],e=1;e<p.length;e++)c[e]=p[e].point.getDistance(a.point),c[e]<d&&(d=c[e]);f=c.indexOf(d),q.get("circleDrag").position=p[f].point,g=this._getGraphPointCoordinates([q.get("circleDrag").position.x,q.get("circleDrag").position.y]),h=this._getPowerOfNumber(g[0],this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.xTotalMultiplier),h[0]=parseFloat(h[0].toFixed(4)),0!==h[1]?(o=h[0].toString().length+this._X10_STRING.length,j=o+h[1].toString().length,k=2):(o=0,j=h[0].toString().length,k=1),i=this._getPowerOfNumber(g[1],this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.yTotalMultiplier),i[0]=parseFloat(i[0].toFixed(4)),0!==i[1]?(n=i[0].toString().length+this._X10_STRING.length,l=n+i[1].toString().length,m=2):(n=0,l=i[0].toString().length,m=1),this.disableLineTooltip!==!0&&this.showToolTipForPoint(p[f].point,h,i,!0,b.children[0].equation),this.refreshView()}},drawInequalitites:function(a){var b,c,d,e,f=a.getInEqualityPlots();if(null!==f){for(e=new this._paperScope.Group,e.fillColor=a.getColor(),e.strokeColor=a.getColor(),e.fillColor.alpha=.5,e.strokeColor.alpha=0,b=f.length,c=0;b>c;c++)d=new this._paperScope.Path({segments:f[c]}),d.fillColor=a.getColor(),d.strokeColor=a.getColor(),d.fillColor.alpha=.5,d.strokeColor.alpha=0,e.addChild(d);a.setInEqualititesPathGroup(e)}},removeInEqualityPlots:function(a){var b=a.getInEqualititesPathGroup();null!==b&&(b.remove(),a.setInEqualititesPathGroup(null))},_addSegments:function(a){this.activateScope();var b,c,d,e,f,g,h,i,j,k,l,m;for(b=a.getLeftArray(),c=a.getRightArray(),this._projectLayers.shapeLayer.activate(),null!==a.getPathGroup()&&(this._removePathRollOverListeners(a.getPathGroup()),a.getPathGroup().remove()),j=void 0===a.getColor()?"#000000":a.getColor(),k=void 0===a.getThickness()?1:a.getThickness(),void 0!==a.getDashArray()&&(l=a.getDashArray()),m=void 0===a.getCurveVisibility()?!0:"object"==typeof a.getCurveVisibility()?a.getCurveVisibility().curve:a.getCurveVisibility(),e=new this._paperScope.Group,h=null,i=null,g=0;g<b.length;g++)a.isDraggable()&&(d=new this._paperScope.Path({segments:b[g]}),d.strokeColor=a.getDragHitColor(),d.strokeColor.alpha=a.getDragHitAlpha(),d.equation=a,d.hit=!0,d.equationID=a.getId(),d.strokeWidth=a.getDragHitThickness(),e.addChild(d)),d=new this._paperScope.Path({segments:b[g]}),d.strokeColor=j,d.strokeWidth=k,d.equation=a,d.equationID=a.getId(),e.addChild(d);if(null!==c)for(h=null,g=0;g<c.length;g++)a.isDraggable()&&(d=new this._paperScope.Path({segments:c[g]}),d.strokeColor=a.getDragHitColor(),d.equation=a,d.hit=!0,d.strokeColor.alpha=a.getDragHitAlpha(),d.equationID=a.getId(),d.strokeWidth=a.getDragHitThickness(),e.addChild(d)),d=new this._paperScope.Path({segments:c[g]}),d.strokeColor=j,d.equation=a,d.equationID=a.getId(),d.strokeWidth=k,e.addChild(d);e.dashArray=a.getDashArray(),e.visible=m,this._setPathRollOverListeners(e),a.setPathGroup(e),f=a.getLabelData(),null!==f&&null!==f.labelObject&&this._updateLabelPosition(a),this._projectLayers.gridLayer.activate(),this.refreshView(),-1===this._gridGraphModelObject.get("_plots").indexOf(a)&&this._gridGraphModelObject.get("_plots").push(a)},_getOppositeAxis:function(a){switch(a){case"y":return"x";case"x":return"y"}},_getAxisIndex:function(a){switch(a){case"y":return 1;case"x":return 0}},_extendPathForConnection:function(a,b){var c,d,e;c=a[0],d=b[0],void 0!==c&&void 0!==d&&(e=geomFunctions.distance(new this._paperScope.Point(c[0],c[1]),new this._paperScope.Point(d[0],d[1])),10>e&&a.unshift(d),c=a[a.length-1],d=b[b.length-1],e=geomFunctions.distance(new this._paperScope.Point(c[0],c[1]),new this._paperScope.Point(d[0],d[1])),50>e&&a.push(d),this.refreshView())},_generatePoint:function(a,b,c){var d=[];return"y"!==b?(d.push(a[0+c]),d.push(a[0])):(d.push(a[0]),d.push(a[0+c])),d},_plottingPoints:function(a,b,c,d){var e;if(null!==b&&null!==c)return c[1]<b[1]&&c[1]<d[1]||c[1]>b[1]&&c[1]>d[1]?(e=new this._paperScope.Path.Circle({center:[c[0],c[1]],radius:2,fillColor:"#666666",strokeColor:"#666666"}),void a.addChild(e)):c[0]<b[0]&&c[0]<d[0]||c[0]>b[0]&&c[0]>d[0]?(e=new this._paperScope.Path.Circle({center:[c[0],c[1]],radius:2,fillColor:"#666666",strokeColor:"#666666"}),void a.addChild(e)):void 0},_getPointDiff:function(a){var b,c;return b=a[a.length-1],c=a[a.length-2],[b[0]-c[0],b[1]-c[1]]},_printorder:function(a,b){b=void 0,a=void 0},getAttribute:function(){var a,b,c;return c=function(a){var b,d;if(null===a||"object"!=typeof a)return a;b=a.constructor();for(d in a)b[d]=c(a[d]);return b},a={markerBounds:{},graphDisplay:{},currentLimits:{},graphOrigin:{currentOrigin:{x:{},y:{}},defaultOrigin:{x:{},y:{}},isOriginPositionChanged:null},graphParameters:{},zoomingFactor:{}},b=this._gridGraphModelObject.get("_graphDisplayValues"),a.markerBounds=this._gridGraphModelObject.get("markerBounds"),a.graphDisplay=b._graphDisplay,a.currentLimits=b._graphsAxisLimits.currentLimits,a.graphOrigin.currentOrigin.x=b._graphOrigin.currentOrigin.x,a.graphOrigin.currentOrigin.y=b._graphOrigin.currentOrigin.y,a.graphOrigin.defaultOrigin.x=b._graphOrigin.defaultOrigin.x,a.graphOrigin.defaultOrigin.y=b._graphOrigin.defaultOrigin.y,a.graphOrigin.isOriginPositionChanged=b._graphOrigin.isOriginPositionChanged,a.graphParameters=b._graphParameters,a.zoomingFactor=b._zoomingFactor,c(a)},saveState:function(){return this.getAttribute()},retrieveState:function(a){this.setAttribute(a)},setAttribute:function(a){this._gridGraphModelObject.setModelAttribute(a),this._retrieveGraph()},_retrieveGraph:function(){this._setBounds(),this._graphTypeSelector()},activateScope:function(){this._paperScope.activate()},drawPolygon:function(b){this.activateScope();var c=b.getPathGroup();"annotation"===b.getSpecie()?this._projectLayers.annotationLayer.activate():(this._projectLayers.shapeLayer.activate(),null!==c&&this._removePathRollOverListeners(c)),null!==c&&c.remove();var d,e,f,g,h,i,j,k,l,m=new this._paperScope.Path,n=new this._paperScope.Group,o=0,p=b.getPoints();if(b.isDraggable()&&(e=new this._paperScope.Path,e.strokeColor=b.getDragHitColor(),e.equation=b,e.strokeColor.alpha=b.getDragHitAlpha(),e.equationID=b.getId(),e.strokeWidth=b.getDragHitThickness(),e.hit=!0),null!==p){if(l=p.length,d=this._gridGraphModelObject,f=d.get("_plots"),-1===f.indexOf(b)&&f.push(b),l=p.length,m.strokeColor=n.strokeColor=b.getColor(),m.strokeWidth=n.strokeWidth=b.getThickness(),m.opacity=n.opacity=b.getOpacity(),m.equation=b,m.visible=b.getCurveVisibility(),i=m.style,h=[],"annotation"!==b.getSpecie()&&b.getRayPolygon()){for(g=[],k=1;l>k;k++)g.push(p[k-1][0]),g.push(p[k-1][1]),g.push(p[k][0]),g.push(p[k][1]);g=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.fitPointsInsideDomain({domain:{minX:this.markerBounds.min.x,maxX:this.markerBounds.max.x,minY:this.markerBounds.min.y,maxY:this.markerBounds.max.y}},g)}else g=p;for(k=0;l>k;k++)"annotation"===b.getSpecie()?void 0===p[k]||null===p[k]?(n.addChild(m),m=new this._paperScope.Path,m.style=i,o=0):(m.add(this._getCanvasPointCoordinates(p[k])),e&&e.add(this._getCanvasPointCoordinates(p[k]))):b.getRayPolygon()?(j=[g[0][2*k],g[0][2*k+1]],m.add(this._getCanvasPointCoordinates(j)),e&&e.add(this._getCanvasPointCoordinates(j))):(m.add(this._getCanvasPointCoordinates(g[k])),e&&e.add(this._getCanvasPointCoordinates(g[k])));b.isClosedPolygon()===!0&&(e&&(e.closed=!0),m.closed=!0),b.isSmoothPolygon()===!0&&m.smooth(),e&&n.addChild(e),n.addChild(m),"annotation"!==b.getSpecie()&&this._setPathRollOverListeners(n),b.setPathGroup(n),null!==b.getLabelData().labelObject&&this._updateLabelPosition(b),this.refreshView()}},removePlottedGraph:function(a){var b=a.getPathGroup();b&&(this._removePathRollOverListeners(b),b.remove(),a.setPathGroup(null)),this.refreshView()},canvasResize:function(){this._paperScope.activate();var a,b,c=document.getElementById(this.ID.canvasId),d=this._gridGraphModelObject,e=d.get("_graphDisplayValues"),f=e._graphParameters.xGridLine,g=e._graphParameters.yGridLine,h=e._graphsAxisLimits.currentLimits,i=e._graphParameters,j=$(c).height(),k=$(c).width(),l=e._graphParameters.currentDistanceBetweenTwoHorizontalLines,m=e._graphParameters.currentDistanceBetweenTwoVerticalLines,n=this._canvasSize.height,o=this._canvasSize.width,p=j-n,q=k-o,r=0,s=0;k>0&&j>0&&(0!==p||0!==q)&&(0!==p&&(this._canvasSize.height=j,s=p/(l*g)*e._zoomingFactor.yTotalMultiplier,h.yLower=h.yLower-s/2,h.yUpper=h.yUpper+s/2),0!==q&&(this._canvasSize.width=k,r=q/(m*f)*e._zoomingFactor.xTotalMultiplier,h.xLower=h.xLower-r/2,h.xUpper=h.xUpper+r/2),this._setBounds(),this._setTextBoxValues(),i=e._graphParameters,i.totalVerticalLines+=q/m,i.totalHorizontalLines+=p/l,a=h.xLower>=0?0-h.xLower:Math.abs(h.xLower),b=h.yUpper<=0?0-Math.abs(h.yUpper):Math.abs(h.yUpper),e._graphOrigin.currentOrigin=new this._paperScope.Point(a/e._zoomingFactor.xTotalMultiplier*f*m,b/e._zoomingFactor.yTotalMultiplier*g*l),e._graphOrigin.defaultOrigin=new this._paperScope.Point(this._canvasSize.width/2,this._canvasSize.height/2),this._cartesionSymbolGenerator(),this._deltaAngle(),this._graphTypeSelector(),0!==d.get("_plots").length&&this._shapeRedraw(),0!==d.get("_points").length&&this._repositionPoints(),this._paperScope.view.viewSize=[k,j],this.refreshView())},_originShiftFactorForDoubleClick:function(a){var b,c,d,e,f,g,h,i,j,k=this._getNextMultipliers(),l=this._gridGraphModelObject,m=l.get("_graphDisplayValues"),n=m._zoomingFactor,o=m._graphParameters,p=m._graphOrigin.currentOrigin,q=n.currentXZoomLevel+this._ZOOM_LEVEL_INCREMENT_STEPS,r=n.currentYZoomLevel+this._ZOOM_LEVEL_INCREMENT_STEPS,s=this._zoomLevelLimits(n.xTotalMultiplier,n.yTotalMultiplier),t=this._zoomLevelLimits(k.xFactor.xTotalMultiplier,k.yFactor.yTotalMultiplier),u={};return q>=s.xMaxZoomLevel?(q=t.xMinZoomLevel,d=k.xFactor.xGridLine,f=k.xFactor.xTotalMultiplier):(d=o.xGridLine,f=n.xTotalMultiplier),r>=s.yMaxZoomLevel?(r=t.yMinZoomLevel,e=k.yFactor.yGridLine,g=k.yFactor.yTotalMultiplier):(e=o.yGridLine,g=n.yTotalMultiplier),b=q*o.distanceBetweenTwoVerticalLines,c=r*o.distanceBetweenTwoHorizontalLines,h=this._getCanvasPointCoordinates(a),u.x=h[0]-a[0]*d*b/f,u.y=h[1]+a[1]*e*c/g,i=Math.sqrt(Math.pow(u.x-p.x,2)+Math.pow(u.y-p.y,2)),j=this._angleBetweenTwoPoints(p,u)+Math.PI,{distance:i,angle:j}},_getNextMultipliers:function(){var a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),c=b._zoomingFactor,d=this._zoomFactors,e={},f={};switch(c.yCurrentFactor){case d[0]:f.yCurrentFactor=d[2],f.yZoomMultiplier=c.yZoomMultiplier/10,f.yTotalMultiplier=f.yCurrentFactor*f.yZoomMultiplier,f.yGridLine=5;break;case d[1]:f.yCurrentFactor=d[0],f.yZoomMultiplier=c.yZoomMultiplier,f.yTotalMultiplier=f.yCurrentFactor*c.yZoomMultiplier,f.yGridLine=4;break;case d[2]:f.yCurrentFactor=d[1],f.yZoomMultiplier=c.yZoomMultiplier,f.yTotalMultiplier=f.yCurrentFactor*c.yZoomMultiplier,f.yGridLine=4}switch(c.xCurrentFactor){case d[0]:e.xCurrentFactor=d[2],e.xZoomMultiplier=c.xZoomMultiplier/10,e.xTotalMultiplier=e.xCurrentFactor*e.xZoomMultiplier,e.xGridLine=5;break;case d[1]:e.xCurrentFactor=d[0],e.xZoomMultiplier=c.xZoomMultiplier,e.xTotalMultiplier=e.xCurrentFactor*c.xZoomMultiplier,e.xGridLine=4;break;case d[2]:e.xCurrentFactor=d[1],e.xZoomMultiplier=c.xZoomMultiplier,e.xTotalMultiplier=e.xCurrentFactor*c.xZoomMultiplier,e.xGridLine=4}return{xFactor:e,yFactor:f}},getDefaultZoomBehaviour:function(){return this._isGraphDefaultZoomBehaviourAllowed},setDefaultZoomBehaviour:function(a){"boolean"==typeof a&&(this._isGraphDefaultZoomBehaviourAllowed=a)},getDefaultPanBehaviour:function(){return this._isGraphDefaultPanBehaviourAllowed},setDefaultPanBehaviour:function(a){"boolean"==typeof a&&(a===!0?(this.$el.attr("disabledCursor",this.$el.find("canvas").css("cursor")),this.$el.find("canvas").css("cursor","pointer")):a===!1&&(this.$el.find("canvas").css("cursor","default"),this.$el.removeAttr("disabledCursor")),this._isGraphDefaultPanBehaviourAllowed=a)},getClosestGridPoint:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=[],I=1,J=1;for(g=a[0],h=a[1],c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),i=d._graphParameters.xGridLine,j=d._graphParameters.yGridLine,k=d._zoomingFactor.xTotalMultiplier,l=d._zoomingFactor.yTotalMultiplier,void 0===b&&(b=d._graphDisplay.isCartesionCurrentGraphType?"cartesian-graph":"polar-graph"),0!==Math.abs(g)&&(I=g/Math.abs(g)),0!==Math.abs(h)&&(J=h/Math.abs(h)),"cartesian-graph"===b?(e=I*k/i,f=J*l/j,m=g%e,n=e-m,o=h%f,p=f-o,H=[[g-m,h-o],[g+n,h-o],[g-m,h+p],[g+n,h+p]]):"polar-graph"===b&&(u=this._polarAngleIncrement(),v=this.angleBetweenPoints(a,[0,0],!1),0>v&&(v=2*Math.PI+v),w=v-v%u,x=v+(u-v%u),A=k/i,B=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)),y=B-B%A,z=B+(A-B%A),C=[y*Math.cos(x),y*Math.sin(x)],D=[y*Math.cos(w),y*Math.sin(w)],E=[z*Math.cos(x),z*Math.sin(x)],F=[z*Math.cos(w),z*Math.sin(w)],H=[C,D,E,F]),G=.4*geomFunctions.distance2(H[0][0],H[0][1],H[2][0],H[2][1]),r=0;r<H.length;r++)s=Math.sqrt(Math.pow(g-H[r][0],2)+Math.pow(h-H[r][1],2)),void 0===q?(q=s,t=H[r]):q>s&&(q=s,t=H[r]);return q>G?a:t},getClosestCanvasPoint:function(a,b){var c,d,e;return d=this._getGraphPointCoordinates(a),e=this.getClosestGridPoint(d,b),c=this._getCanvasPointCoordinates(e)},changeOriginPosition:function(a){var b,c,d;b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),d=c._graphOrigin.currentOrigin,(d.x!==a[0]||d.y!==a[1])&&(c._graphOrigin.currentOrigin=new this._paperScope.Point(a),this._graphLimitChangesDuringDragging(),this._graphTypeSelector(),this._deltaAngle(),0!==b.get("_plots").length&&this._shapeRedraw(),0!==b.get("_points").length&&this._repositionPoints(),this.refreshView())},angleBetweenPoints:function(a,b,c){var d,e,f,g,h;return d=a[0],e=a[1],f=b[0],g=b[1],h=Math.atan2(e-g,d-f),c?180*h/Math.PI:h},_polarAngleIncrement:function(){var a,b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),d=c._graphOrigin.currentOrigin,e=this._canvasSize.width,f=this._canvasSize.height;return a=d.x<e&&d.x>0&&d.y<f&&d.y>0?15*Math.PI/180:5*Math.PI/180},setGraphType:function(a){var b,c;switch(b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),a){case"no-grid":c._graphDisplay.isLabelShown=!1,c._graphDisplay.isGridLineShown=!1,c._graphDisplay.isAxisLinesShown=!1,this._graphTypeSelector();break;case"cartesian-graph":c._graphDisplay.isCartesionCurrentGraphType=!0,c.isLabelShown||c.isGridLineShown||c.isAxisLinesShown||(c._graphDisplay.isLabelShown=!0,c._graphDisplay.isGridLineShown=!0,c._graphDisplay.isAxisLinesShown=!0),this._graphTypeSelector();break;case"polar-graph":c._graphDisplay.isCartesionCurrentGraphType=!1,c.isLabelShown||c.isGridLineShown||c.isAxisLinesShown||(c._graphDisplay.isLabelShown=!0,c._graphDisplay.isGridLineShown=!0,c._graphDisplay.isAxisLinesShown=!0,this._graphTypeSelector())}},getGraphType:function(){var a,b;return a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b.isLabelShown||b.isGridLineShown||b.isAxisLinesShown?"no-grid":b.isCartesionCurrentGraphType?"cartesian-graph":"polar-graph"},getMinimumMarkerValues:function(){var a,b,c,d,e,f,g;return a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),e=b._zoomingFactor,f=b._graphParameters.xGridLine,g=b._graphParameters.yGridLine,c=e.xTotalMultiplier/f,d=e.yTotalMultiplier/g,{xMinMarker:c,yMinMarker:d}},getMinimumSteps:function(){var a=this.getMinimumMarkerValues(),b=a.xMinMarker*a.xGridLines,c=a.yMinMarker*a.yGridLines;return{xMarker:b,yMarker:c}},criticalPointsShowOnHover:function(a,b){if(null!==a){var c,d,e,f,g,h,i,j=this;if(d=j.$('.coordinate-tooltip[data-equation-cid="'+b.getCid()+'"]'),g=d.length,0!==g)for(f=a.children.length,e=0;f>e;e++)i=a.children[e],i.hit!==!0&&(h=[j._getNumberForToolTip(i.data.point[0]),j._getNumberForToolTip(i.data.point[1])],0!=j.$(".coordinate-tooltip[data-point='"+h[0]+"-"+h[1]+"']").length&&(i.fillColor="black",i.opacity=1,i.data.selected=!0));j.$(".hover-tooltip").remove(),j.$el.removeClass("tool-tip-hover-cursor"),a.onMouseEnter=function(a){i=a.target,c=i.data.point,i.hit?(i=j._getPointPath(i.parent.children,i.data.point),i.opacity=1):i.opacity=1,j.showToolTipOnMouseEnter(c,a.target.id,b.getCid()),j.$el.addClass("tool-tip-hover-cursor")},a.onMouseLeave=function(a){i=a.target,i.hit?(i=j._getPointPath(i.parent.children,i.data.point),i.data.selected!==!0&&(i.opacity=.5,i.fillColor="#8D8D8D")):i.data.selected!==!0&&(i.opacity=.5,i.fillColor="#8D8D8D"),parseInt(j.$el.find(".hover-tooltip").attr("event-id"))===a.target.id&&j.$(".hover-tooltip").remove(),j.$el.removeClass("tool-tip-hover-cursor")},a.onMouseUp=function(a){if(i=a.target,c=i.data.point,i.hit){if(i=j._getPointPath(i.parent.children,i.data.point),j.isSnap===!1)return;i.fillColor="black",i.data.selected=!0}else{if(j.isSnap===!1)return;i.fillColor="black",i.data.selected=!0}h=[j._getNumberForToolTip(i.data.point[0]),j._getNumberForToolTip(i.data.point[1])],j.showToolTipForPoint(i.bounds.center,[h[0],0],[h[1],0],!1,i.equation.getCid()),j.isSnap=!1}}},_getPointPath:function(a,b){var c,d=a.length;for(c=0;d>c;c++)if(a[c].hit!==!0&&a[c].data.point[0]===b[0]&&a[c].data.point[1]===b[1])return a[c]},showToolTipOnMouseEnter:function(a,b,c){a=this._getCanvasPointCoordinates(a);var d,e,f,g,h=this.$("#"+this.ID.canvasId),i=h.position(),j=$("<div></div>").css({position:"absolute",top:i.top+a[1]+"px",left:i.left+a[0]+"px"}).attr("class","hover-tooltip"),k=this;j.attr("data-equation-cid",c),0!==k.$(".drag-tooltip").length&&k.$(".drag-tooltip").hide(),e=k._getGraphPointCoordinates(a),f=k._getNumberForToolTip(e[0]),g=k._getNumberForToolTip(e[1]),d=f,d+=",&nbsp;"+g,j.html(d),j.attr("event-id",b),0==this.$(".coordinate-tooltip[data-point='"+f+"-"+g+"']").length&&(this.$el.append(j),j.css("top",j.position().top-2*j.height()),j.position().top<i.top&&j.remove())},startDoubleClickZoom:function(){this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.doubleClickZoomAllow=!0},stopDoubleClickZoom:function(){this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.doubleClickZoomAllow=!1},_setGraphLimits:function(a,b,c,d){var e,f,g=this._gridGraphModelObject,h=g.get("_graphDisplayValues"),i=h._graphsAxisLimits.currentLimits,j=h._graphOrigin;a=parseFloat(a),c=parseFloat(c),b=parseFloat(b),d=parseFloat(d),a>=b||c>=d||(i.xLower=a,i.xUpper=b,i.yLower=c,i.yUpper=d,this._setDistanceBetweenLines(),this._originPositionOnGraph(),e=j.defaultOrigin,f=j.currentOrigin,e.x===f.x&&e.y===f.y?j.isOriginPositionChanged=!1:j.isOriginPositionChanged=!0,this._setBounds())},_setDistanceBetweenLines:function(){var a,b,c,d,e,f,g=this._gridGraphModelObject,h=g.get("_graphDisplayValues"),i=h._zoomingFactor,j=h._graphParameters,k=(h._graphsAxisLimits.currentLimits,1),l=1,m=[],n=[],o=(this._MINIMUM_ZOOM_LEVEL_FACTOR,this._ZOOM_LEVEL_INCREMENT_STEPS),p=function(a,g,h,i,j){for(b=parseFloat(h.toFixed(4));i>=b;)c=h/b*j,d=i/b*j,c>=a&&g>=d&&(e=b,f=!0),b+=o,b=parseFloat(b.toFixed(4))};for(f=!1;!f;)this._distanceBetweenLinesCalculator(),a=this._zoomLevelLimits(),j.distanceBetweenTwoVerticalLines<a.xMinDistance?(this._xAxisZoomFactorModifier(!0),k++):(p(a.xMinDistance,a.xMaxDistance,a.xMinZoomLevel,a.xMaxZoomLevel,j.distanceBetweenTwoVerticalLines),f||(this._xAxisZoomFactorModifier(!1),k--)),-1!==m.indexOf(k)&&p(a.xExtraMinDistance,a.xExtraMaxDistance,a.xMinZoomLevel,a.xMaxZoomLevel,j.distanceBetweenTwoVerticalLines),m.push(k);for(i.currentXZoomLevel=e,f=!1;!f;)this._distanceBetweenLinesCalculator(),
a=this._zoomLevelLimits(),j.distanceBetweenTwoHorizontalLines<a.yMinDistance?(this._yAxisZoomFactorModifier(!0),l++):(p(a.yMinDistance,a.yMaxDistance,a.yMinZoomLevel,a.yMaxZoomLevel,j.distanceBetweenTwoHorizontalLines),f||(this._yAxisZoomFactorModifier(!1),l--)),f||-1===n.indexOf(l)||p(a.yExtraMinDistance,a.yExtraMaxDistance,a.yMinZoomLevel,a.yMaxZoomLevel,j.distanceBetweenTwoHorizontalLines),n.push(l);i.currentYZoomLevel=e,j.distanceBetweenTwoVerticalLines=j.distanceBetweenTwoVerticalLines/i.currentXZoomLevel,j.distanceBetweenTwoHorizontalLines=j.distanceBetweenTwoHorizontalLines/i.currentYZoomLevel},drawGraph:function(){this._graphTypeSelector()},_zoomLevelLimits:function(a,b){var c,d,e,f,g,h=this._gridGraphModelObject,i=h.get("_graphDisplayValues"),j=i._zoomingFactor,k=j.xTotalMultiplier,l=j.yTotalMultiplier,m=this.GRID_LINES,n=this._ZOOM_STEPS_FOR_FIVE_MULTIPLIER,o=this._ZOOM_STEPS,p=this._MINIMUM_ZOOM_LEVEL_FACTOR,q=this._ZOOM_LEVEL_INCREMENT_STEPS,r=this._ADJECENT_LINES_MIN_DISTANCE,s=this._ZOOM_DISTANCE;return k=a?a:k,l=b?b:l,e=this._numberOfMarkerLines(k),f=this._numberOfMarkerLines(l),g=function(a){var b,c,d,e,f,g;return a===m.FIVE_MULTIPLIER?(b=r,c=b+s*n,d=p,e=d+q*n,f=c+s,g=b-s):(b=r+s,c=b+s*o,d=p+q,e=d+q*o,f=c+s,g=b-s),{minDistance:b,maxDistance:c,minZoomLevel:d,maxZoomLevel:e,extraMaxDistance:f,extraMinDistance:g}},c=g(e),d=g(f),{xMinDistance:c.minDistance,xMaxDistance:c.maxDistance,xMinZoomLevel:c.minZoomLevel,xMaxZoomLevel:c.maxZoomLevel,xExtraMaxDistance:c.extraMaxDistance,xExtraMinDistance:c.extraMinDistance,yMinDistance:d.minDistance,yMaxDistance:d.maxDistance,yMinZoomLevel:d.minZoomLevel,yMaxZoomLevel:d.maxZoomLevel,yExtraMaxDistance:d.extraMaxDistance,yExtraMinDistance:d.extraMinDistance}},_setBounds:function(){var a=this._gridGraphModelObject.get("markerBounds"),b=this.markerBounds,c=this._gridGraphModelObject.get("_graphDisplayValues")._graphsAxisLimits.currentLimits;a.max.x=b.max.x=c.xUpper,a.min.x=b.min.x=c.xLower,a.max.y=b.max.y=c.yUpper,a.min.y=b.min.y=c.yLower,this._deltaAngle()},getLimits:function(){var a=this._gridGraphModelObject.get("markerBounds");return{xLower:a.min.x,xUpper:a.max.x,yLower:a.min.y,yUpper:a.max.y}},setLimits:function(a,b,c,d){isNaN(parseFloat(b))||isNaN(parseFloat(a))||isNaN(parseFloat(c))||isNaN(parseFloat(d))||this._setGraphLimits(a,b,c,d)},_distanceBetweenPoints:function(a,b){return Math.sqrt((b.y-a.y)*(b.y-a.y)+(b.x-a.x)*(b.x-a.x))},convertToCanvasCoordinate:function(a){return this._getCanvasPointCoordinates(a)},convertToGraphCoordinate:function(a){return this._getGraphPointCoordinates(a)},hideGridLines:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isGridLineShown=!1,this._graphTypeSelector()},hideLabels:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isLabelShown=!1,this._graphTypeSelector()},hideAxis:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isAxisLinesShown=!1,this._graphTypeSelector()}},{AXIS_LABEL_RIGHT_PADDING:5,AXIS_LABEL_BOTTOM_PADDING:3})}(window.MathInteractives),function(a){"use strict";a.Common.Components.Views.MathUtilitiesGraphNew.plotterView=Backbone.View.extend({model:null,_graphView:null,_plottingFuntions:null,_worker:null,initialize:function(){this.model=new a.Common.Components.Models.MathUtilitiesGraphNew.plotterModel,this.graphView=this.options.graphView,this.graphView.on("graph:zoom-pan",$.proxy(function(){var a,b,c,d=this.model._equations,e=d.length;for(a=0;e>a;a++)if(b=d[a].getSpecie(),c=d[a].getCriticalPoints(),null!==c&&null!==c.getPointsGroup()&&(c.getPointsGroup().visible=!1),void 0!==b&&null!==b&&"error"!==b&&"expression"!==b&&"number"!==b&&"quadratic"!==b)if("polygon"===b)this.graphView.drawPolygon(d[a]);else{if("point"===b)continue;"annotation"===b?this.graphView.drawPolygon(d[a]):"image"===b?this.graphView.repositionImage(d[a]):this._plot(d[a])}},this)),a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Productions.init()},addEquation:function(a){var b=this.model._equations,c=this.model._equationsMap;if(-1===b.indexOf(a))return b.push(a),c[a.getId()]=a,a.on("change-visibility",$.proxy(function(){this.changePlotVisibility(a)},this)),"image"===a.getSpecie()?void this.graphView._paperScope.view.draw():(a.on("change-equation",$.proxy(function(){this._showConsole(!0,"Updating plot for equation "+a),this.addPlot(a)},this)),a.on("plot-equation",$.proxy(function(){this._showConsole(!0,"Plotting equation "+a),this._plot(a)},this)),a.on("change-color",$.proxy(function(){this.changePlotColor(a)},this)),a.on("change-points-color",$.proxy(function(){this.changePointsColor(a)},this)),a.on("change-constants",$.proxy(function(){var b=a.getAllConstants().length;0!==b&&"point"!==a.getSpecie()&&("error"===a.getSpecie()||"expression"===a.getSpecie()||b>0?this.addPlot(a):this._plot(a))},this)),a.on("change-thickness",$.proxy(function(){"point"===a.getSpecie()?null!==a.getPointsGroup()&&this.graphView._redrawPoints():null!==a.getPathGroup()&&(a.getPathGroup().strokeWidth=a.getThickness())},this)),"polygon"===a.getSpecie()||"annotation"===a.getSpecie()?("annotation"===a.getSpecie()&&null!==this.model._annotationPaths&&(this.model._annotationPaths.remove(),this.graphView._paperScope.view.draw()),void this.graphView.drawPolygon(a)):void this.addPlot(a))},removeEquation:function(a){var b,c=this.model._equations,d=this.model._equationsMap;b=c.indexOf(a),-1!==b&&(null!==a.getPathGroup()&&this.graphView.removePlottedGraph(a),null!==a.getPointsGroup()&&this.graphView.removePoint(a),null!==a.getRaster()&&this.graphView.removeRaster(a),this.graphView.removeInEqualityPlots(a),c.splice(b,1)),delete d[a.getId()]},createAnnotationStart:function(a,b){this.graphView._projectLayers.annotationLayer.activate(),this.graphView.setGridMode("annotation-mode");var c=this;this.graphView.on("annotation-start",$.proxy(c._createAnnotationMouseDown,c)),this.graphView.on("draw-annotation",$.proxy(c._createAnnotationMove,c)),this.graphView.on("annotation-end",$.proxy(c._createAnnotationMouseUp,c)),this.model._annotationPaths=new this.graphView._paperScope.Group,this.model._annotationPaths.strokeColor=a,this.model._annotationPaths.strokeWidth=b},_createAnnotationMouseDown:function(a){this.graphView.setGridMode("annotation-mode");var b,c=this.model;b=new this.graphView._paperScope.Path,b.strokeWidth=c._annotationPaths.strokeWidth,this.graphView._paperScope.tool.minDistance=1,b.strokeColor=this.model._annotationPaths.strokeColor,b.strokeWidth=this.model._annotationPaths.strokeWidth,c.incompleteAnnotations.push(this.graphView._getGraphPointCoordinates(getCanvasCoordinates(a))),c._firstPoint=a.point,c._annotationPaths.addChild(b),b.strokeCap="round"},_createAnnotationMove:function(a){var b=this.model._annotationPaths._children,c=this.model;this.graphView._paperScope.tool.minDistance=1,null!==c._firstPoint&&(b[b.length-1].add(c._firstPoint),c._firstPoint=null),b[b.length-1].add(a.point),c.incompleteAnnotations.push(this.graphView._getGraphPointCoordinates(getCanvasCoordinates(a)))},_createAnnotationMouseUp:function(a){a=void 0;var b=this.model,c=this.model._annotationPaths._children;null!==b._firstPoint&&(c[c.length-1].add([b._firstPoint.x,b._firstPoint.y]),c[c.length-1].add([b._firstPoint.x+1,b._firstPoint.y+1]),this.model.incompleteAnnotations.push(this.graphView._getGraphPointCoordinates([b._firstPoint.x+2,b._firstPoint.y+4])),b._firstPoint=null),this.model.incompleteAnnotations.push(void 0),this.graphView.refreshView()},createAnnotationEnd:function(a){a=void 0;var b;return this.model.incompleteAnnotations.pop(),b=this.model.incompleteAnnotations,this.model.incompleteAnnotations=[],this.graphView.off("annotation-start"),this.graphView.off("draw-annotation"),this.graphView.off("annotation-end"),this.graphView.resetGridMode(),b},changePlotVisibility:function(a){var b,c,d,e,f;if("point"===a.getSpecie())for(f=a.getPointsGroup(),b=0;b<f.children.length;b++)f.children[b].hit||(f.children[b].visible=a.getVisible().point);else c=a.getPathGroup(),e=a.getVisible().curve,c&&e===!1?(c.visible=e,a.removePathGroup()):c||(d=a.getSpecie(),"plot"===a.getSpecie()?this._plot(a):("annotation"===d||"polygon"===d)&&this.graphView.drawPolygon(a)),a.getRaster()&&(a.getRaster().visible=a.getVisible().curve);this.graphView.refreshView()},changePlotColor:function(a){var b,c=a.getPathGroup();if("point"===a.getSpecie())0===a.getDashArray().length?this.changePointsColor(a):this.changePointsColor(a);else if(c)for(b=0;b<c.children.length;b++)c.children[b].hit||(c.children[b].strokeColor=a.getColor());this.graphView.refreshView()},changePointsColor:function(a){var b=a.getPointsGroup();if(null!==b){var c;if(0===a.getDashArray().length)for(c=0;c<b.children.length;c++)b.children[c].hit||(b.children[c].fillColor=a.getColor());else for(c=0;c<b.children.length;c++)b.children[c].hit||(b.children[c].strokeColor=a.getColor());this.graphView._paperScope.view.draw()}},_showConsole:function(a,b,c){a=void 0,b=void 0,c=void 0},addPlot:function(b){var c,d,e,f,g,h;if(!b.getBlind()){if(a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.parseEquationToGetTokens(b),b.isCanBeSolved()===!1)return;if("number"!==b.getSpecie()&&"point"!==b.getSpecie()){if(a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.processTokensWithRules(b),b.isCanBeSolved()===!1)return;a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.Parser.generateTreeFromRules(b)}}if("point"===b.getSpecie()){if(!b.getBlind())for(h=b.getSolution(),d=h.length,b.setPoints([]),c=0;d>c;c++)e=[],e.push(Number(h[c][0])),e.push(Number(h[c][1])),b.getPoints().push(e);this.graphView.drawPoint(b)}else b.getBlind()===!1&&b.isCanBeSolved()===!0&&"expression"!==b.getSpecie()&&"number"!==b.getSpecie()?(a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.TreeProcedures.convertToSolvableForm(b),"quadratic"===b.getSpecie()&&(h=a.Common.Components.Models.MathUtilitiesGraphNew.EquationEngine.TreeProcedures.solveEquation(b,1),b.setSolution(h)),"plot"===b.getSpecie()&&(f=b.getParamVariableOrder(),g=2>f?b.getB():b.getA(),"equal"!==b.getInEqualityType()&&("-"===g.sign||g.value<0)&&b.reverseInequality(),this._plot(b))):b.getBlind()===!0?this._plot(b):this._showConsole(!0,"Cant plot this equation")},_plot:function(b){b.setLeftArray([]),b.setRightArray([]);var c,d,e,f,g,h,i,j,k,l=(this.model._equationsMap,this.graphView.markerBounds),m=b.getParamVariable(),n=Number(l.min[m]),o=Number(l.max[m]),p=(navigator.userAgent.toLowerCase(),[]),q=[],r=b.getRange(),s=this.graphView,t=8*((Math.abs(n)+Math.abs(o))/1e4);if(s._paperScope.activate(),r=b.getRange(),null!==r&&void 0!==r&&(null!==r.min&&(n=r.min.value,r.min.include===!1&&(n+=t)),null!==r.max&&(o=r.max.value,r.max.include===!1&&(o-=t))),c=this.graphView.getMinimumMarkerValues(),f={minX:n,maxX:o,minY:Number(l.min[b.getFunctionVariable()]),maxY:Number(l.max[b.getFunctionVariable()]),step:t,tolerance:c.xMinMarker/100,paramVariable:m},e=(t.toString().split(".")[1]||[]).length,d=b.getParamVariableOrder(),b.getVisible().curve!==!1){if(f.gridGraph=s,b.getAutonomous()){for(i=new Function("constants,plot",b.getFunctionCode()),p=i(b.getConstants(),f),g=[],h=0;h<p.length;h++)g.push(a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.translateSegment(f,p[h],s));p=g}else i=new Function("param,constants",b.getFunctionCode()),j=function(a){var c=i(a,b.getConstants());return c[0]},k=function(a){var c=i(a,b.getConstants());return c[1]},p=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.generatePlot(j,f),2===d&&(q=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.generatePlot(k,f),b.setRightArray(q));b.setLeftArray(p),this.graphView._addSegments(b),b.setPoints(p),void 0===b.getThickness()&&b.setThickness(3)}},_createCriticalPointEquationData:function(a){a.setCriticalPoints(new MathUtilities.Components.EquationEngine.Models.EquationData);var b=a.getCriticalPoints();return b.setColor("#8D8D8D",!0),b.hasParent=a,b.setDraggable(!0),b.getStyle().setDragHitThickness(20),b.setThickness(2.5*b.getThickness()),b},getLinearContinuousInequalityPlots:function(a,b,c,d,e,f,g){if(!(a.length<2)){var h,i,j=a.length,k=[],l=!1,m=a[0],n=a[j-1];if(h=this._getPointIntersectionWithBounds(m,b,c,d,e),i=this._getPointIntersectionWithBounds(n,b,c,d,e),null===h||null===i)return k=this.getDiscontinuousInequalityPlots(a,b,c,d,e,f,g);switch(("lesser"===g||"ltequal"===g)&&(l=!0),h){case"xMax":switch(i){case"xMin":"y"===f?l?(k.push([m[0],e]),k=k.concat(a),k.push([n[0],e])):(k.push([m[0],c]),k=k.concat(a),k.push([n[0],c])):l?(k.push([m[0],c]),k=k.concat(a),k.push([n[0],c])):(k.push([m[0],e]),k=k.concat(a),k.push([n[0],e]));break;case"xMax":l?(k.push([b,e]),k.push([m[0],e]),k=k.concat(a),k.push([n[0],c]),k.push([b,c])):k=k.concat(a);break;case"yMin":l?(k.push([m[0],e]),k=k.concat(a),k.push([b,n[1]]),k.push([b,e])):(k.push([m[0],n[1]]),k=k.concat(a))}break;case"xMin":switch(i){case"xMax":l?(k.push([m[0],e]),k=k.concat(a),k.push([n[0],e])):(k.push([m[0],c]),k=k.concat(a),k.push([n[0],c]));break;case"yMax":l?(k.push([m[0],n[1]]),k=k.concat(a)):(k.push([m[0],c]),k=k.concat(a),k.push([d,n[1]]),k.push([d,c]));break;case"yMin":"y"===f?l?(k.push([m[0],e]),k=k.concat(a),k.push([d,n[1]]),k.push([d,e])):(k.push([m[0],n[1]]),k=k.concat(a)):l?(k.push([m[0],n[1]]),k=k.concat(a)):(k.push([m[0],e]),k=k.concat(a),k.push([d,n[1]]),k.push([d,e]));break;case"xMin":l?k=k.concat(a):(k.push([d,e]),k.push([m[0],e]),k=k.concat(a),k.push([n[0],c]),k.push([d,c]))}break;case"yMax":switch(i){case"yMin":"y"===f?l?(k.push([d,m[1]]),k=k.concat(a),k.push([d,n[1]])):(k.push([b,m[1]]),k=k.concat(a),k.push([b,n[1]])):l?(k.push([b,m[1]]),k=k.concat(a),k.push([b,n[1]])):(k.push([d,m[1]]),k=k.concat(a),k.push([d,n[1]]));break;case"xMax":"y"===f?l?(k.push([d,m[1]]),k=k.concat(a)):(k.push([b,m[1]]),k=k.concat(a),k.push([n[0],c]),k.push([b,c])):l?(k.push([b,m[1]]),k=k.concat(a),k.push([n[0],c]),k.push([b,c])):(k.push([d,m[1]]),k=k.concat(a));break;case"yMax":l?k=k.concat(a):(k.push([b,c]),k.push([b,m[1]]),k=k.concat(a),k.push([d,n[1]]),k.push([d,c]));break;case"xMin":l?(k.push([n[0],m[1]]),k=k.concat(a)):(k.push([d,m[1]]),k=k.concat(a),k.push([n[0],c]),k.push([d,c]))}break;case"yMin":switch(i){case"xMax":l?(k.push([b,m[1]]),k=k.concat(a),k.push([n[0],e]),k.push([b,e])):(k.push([n[0],m[1]]),k=k.concat(a));break;case"yMin":l?(k.push([b,e]),k.push([b,m[1]]),k=k.concat(a),k.push([d,n[1]]),k.push([d,e])):k=k.concat(a);break;case"yMax":l?(k.push([b,m[1]]),k=k.concat(a),k.push([b,n[1]])):(k.push([d,m[1]]),k=k.concat(a),k.push([d,n[1]]))}}return k}},_getPointIntersectionWithBounds:function(a,b,c,d,e){var f=null;return a[0].toFixed(11)<=b?f="xMin":Math.ceil(a[0])>=d?f="xMax":a[1].toFixed(11)<=c?f="yMin":Math.ceil(a[1])>=e&&(f="yMax"),f},_getBoundsForDiscontinuousFucntion:function(a){var b=a[0],c=a.length,d=a[c-1],e={min:{x:0,y:0},max:{x:0,y:0}};return b[0]<=d[0]?(e.min.x=b[0],e.max.x=d[0]):(e.max.x=b[0],e.min.x=d[0]),b[1]<=d[1]?(e.min.y=b[1],e.max.y=d[1]):(e.max.y=b[1],e.min.y=d[1]),e},getInEqualityPlots:function(a,b){var c,d,e,f,g,h=a.getParamVariableOrder(),i=a.getLeftArray(),j=a.getInEqualityType(),k=i.length,l=0,m=this.graphView._getCanvasPointCoordinates([Number(b.max.x),0])[0],n=0,o=this.graphView._getCanvasPointCoordinates([0,Number(b.min.y)])[1],p=[],q=a.getFunctionVariable();if(m=Math.floor(m),o=Math.floor(o),2>h)if(1===k)p.push(this.getLinearContinuousInequalityPlots(i[0],l,n,m,o,q,j));else for(g=0;k>g;g++)d=i[g],p.push(this.getDiscontinuousInequalityPlots(d,l,n,m,o,q,j));else for(g=0;k>g;g++)for(d=i[g],c=this.getQuadraticDiscontinuousInequalityPlots(a.getLeftArray()[g],a.getRightArray()[g],l,n,m,o,q,j,k),e=c.length,f=0;e>f;f++)p.push(c[f]);a.setInEqualityPlots(p)},getQuadraticDiscontinuousInequalityPlots:function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o=[],p=[],q=b[0],r=a[0],s=b[b.length-1],t=a[a.length-1];return void 0===b&&(j=!0),k=this._getPointIntersectionWithBounds(r,c,d,e,f),l=this._getPointIntersectionWithBounds(t,c,d,e,f),m=this._getPointIntersectionWithBounds(q,c,d,e,f),n=this._getPointIntersectionWithBounds(s,c,d,e,f),"lesser"===h||"ltequal"===h?(p.push(q),1===i&&"yMin"===k&&"yMin"===l&&"yMax"===m&&"yMax"===n&&(p.push([c,q[1]]),p.push([c,r[1]])),p.push(r),p=p.concat(a),p.push(t),1===i&&"yMin"===k&&"yMin"===l&&"yMax"===m&&"yMax"===n&&(p.push([e,t[1]]),p.push([e,s[1]])),p.push(s),p=p.concat(b.reverse()),o.push(p)):"y"===g?(p=[],p.push([r[0],d]),p=p.concat(a),"xMin"===k&&"xMin"===l?p.push([t[0],f]):p.push([t[0],d]),o.push(p),p=[],"xMax"===m&&"xMax"===n?p.push([q[0],d]):p.push([q[0],f]),p=p.concat(b),p.push([s[0],f]),o.push(p)):(p=[],p.push([e,r[1]]),p=p.concat(a),"yMax"===k&&"yMax"===l?p.push([c,t[1]]):p.push([e,t[1]]),o.push(p),p=[],"yMin"===m&&"yMin"===n?p.push([e,q[1]]):p.push([c,q[1]]),p=p.concat(b),p.push([c,s[1]]),o.push(p)),o},getDiscontinuousInequalityPlots:function(a,b,c,d,e,f,g){var h=[],i=a.length,j=a[0],k=a[i-1];return"y"===f?"lesser"===g||"ltequal"===g?(h.push([j[0],e]),h=h.concat(a),h.push([k[0],e])):(h.push([j[0],c]),h=h.concat(a),h.push([k[0],c])):"lesser"===g||"ltequal"===g?(h.push([b,j[1]]),h=h.concat(a),h.push([b,k[1]])):(h.push([d,j[1]]),h=h.concat(a),h.push([d,k[1]])),h},regressExtremaEdges:function(a,b,c,d,e){for(var f,g,h,i,j=a[0],k=a[1],l=b[0],m=b[1],n=c[0],o=c[1];;)if("y"===e){if(f=this.getCenterOfCoordinates(j,l),g=d(f),h=this.getCenterOfCoordinates(l,n),i=d(h),!isFinite(g)||!isFinite(i))return null;if(f===j||f===l||h===l||h===n)return g>m==m>k?[f,g]:i>m==m>k?[h,i]:[l,m];if(g===m||i===m)return this.getCenterOfFlatRegion(j,k,l,m,n,o,d,e);g>k==m>k&&g>k==g>m?(n=l,o=m,l=f,m=g):i>o==m>o&&i>m==i>o?(j=l,k=m,l=h,m=i):(j=f,k=g,n=h,o=i)}else{if(g=this.getCenterOfCoordinates(k,m),f=d(g),i=this.getCenterOfCoordinates(m,o),h=d(i),!isFinite(f)||!isFinite(h))return null;if(g===k||g===m||i===m||i===o)return f>l==l>j?[f,g]:h>l==l>j?[h,i]:[l,m];if(f===l||h===l)return this.getCenterOfFlatRegion(j,k,l,m,n,o,d,e);f>j==l>j&&f>j==f>l?(n=l,o=m,l=f,m=g):h>n==l>n&&h>l==h>n?(j=l,k=m,l=h,m=i):(j=f,k=g,n=h,o=i)}},_MAX_FLOAT:.01,getCenterOfCoordinates:function(a,b){var c,d,e,f,g,h;return a>b&&(c=a,a=b,b=c),d=a>0,e=b>0,f=Math.abs(a)>this._MAX_FLOAT,g=Math.abs(b)>this._MAX_FLOAT,f||g?this.getMean(a,b):0===a?b*Math.abs(b):0===b?a*Math.abs(a):d!==e?0:(h=d?Math.sqrt(a*b):-Math.sqrt(a*b),h>=a&&b>=h?h:this.getMean(a,b))},getMean:function(a,b){return a>0==b>0?a+.5*(b-a):.5*(a+b)},getCenterOfFlatRegion:function(a,b,c,d,e,f,g,h){var i,j,k,l;if("y"===h){if(!isFinite(d))return;return isFinite(b)||(i=this.getBisectedFiniteValues(a,b,c,d,g),a=i[0],b=i[1]),isFinite(f)||(i=this.getBisectedFiniteValues(c,d,e,f,g),e=i[0],f=i[1]),k=b===d?[a,b]:this.divideCoordinateForConstantValue(a,b,c,d,g,d),l=f===d?[e,f]:this.divideCoordinateForConstantValue(c,d,e,f,g,d),j=this.getCenterOfCoordinates(k[0],l[0]),[j,g(j)]}if(isFinite(c)){if(isFinite(a)||(i=this.getBisectedFiniteValues(b,a,d,c,g),a=i[1],b=i[0]),isFinite(e)||(i=this.getBisectedFiniteValues(d,c,f,e,g),e=i[1],f=i[0]),a===c)k=[a,b];else{k=this.divideCoordinateForConstantValue(b,a,d,c,g,c);var m=k[0];k[0]=k[1],k[1]=m}if(e===c)l=[e,f];else{l=this.divideCoordinateForConstantValue(d,c,f,e,g,c);var m=l[0];l[0]=l[1],l[1]=m}return j=this.getCenterOfCoordinates(k[1],l[1]),[g(j),j]}},getBisectedFiniteValues:function(a,b,c,d,e){if(isFinite(b)!==isFinite(d))for(var f,g;;){if(f=this.getCenterOfCoordinates(a,c),g=e(f),f===a||f===c)return isFinite(b)?[a,b]:[c,d];isFinite(g)!==isFinite(b)?(c=f,d=g):(a=f,b=g)}},divideCoordinateForConstantValue:function(a,b,c,d,e,f){if(b===f!=(d===f))for(var g,h;;){if(g=this.getCenterOfCoordinates(a,c),h=e(g),g===a||g===c)return b===f?[a,b]:[c,d];h===f!=(b===f)?(c=g,d=h):(a=g,b=h)}},findCriticalPoints:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=0,B=0,C=0,D=[],E=[],F=[];for(f=new Array,p=.01,s=1e-4,e=!0,MathUtilities.Components.EquationEngine.Models.Profile.getStartTime("criticalPoints"),A=0;A<a.length;A++){if(B=0,i=a[A].length,!(i>1))return f;for(t=0,B=B;i-2>B;B+=2){if(e===!0&&("y"===b?(j=a[A][B-2],k=a[A][B-1],l=a[A][B],m=a[A][B+1],n=a[A][B+2],o=a[A][B+3],x=a[A][B+4],y=a[A][B+5]):(k=a[A][B-2],j=a[A][B-1],m=a[A][B],l=a[A][B+1],o=a[A][B+2],n=a[A][B+3],y=a[A][B+4],x=a[A][B+5]),g=(m-k)/(l-j),h=(o-m)/(n-l),u=(y-o)/(x-n),q=h-g,r=!1,h>g&&h>u||g>h&&u>h))for(;r===!1&&("y"===b?(l=(j+n)/2,m=c(l)):(m=(k+o)/2,l=c(m)),g=(m-k)/(l-j),h=(o-m)/(n-l),u=(y-o)/(x-n),v=g-t,q=h-g,w=u-h,!(Math.abs(n-l)<s||Math.abs(l-j)<s||Math.abs(x-n)<s));)0>v&&w>0||v>0&&0>w?(F[C]=[l,m],C++,r=!0):q>0?h>0?(h=u,n=l,o=m):(j=l,k=m):0>q&&(0>g?(g=h,j=l,k=m):(n=l,o=m));"y"===b?(j=a[A][B-2],k=a[A][B-1],l=a[A][B],m=a[A][B+1],n=a[A][B+2],o=a[A][B+3],x=a[A][B+4],y=a[A][B+5],j>l&&(z=j,j=l,l=z),l>n&&(z=l,l=n,n=z)):(k=a[A][B-2],j=a[A][B-1],m=a[A][B],l=a[A][B+1],o=a[A][B+2],n=a[A][B+3],y=a[A][B+4],x=a[A][B+5],k>m&&(z=k,k=m,m=z),m>o&&(z=m,m=o,o=z)),g=(m-k)/(l-j),h=(o-m)/(n-l),u=(y-o)/(x-n),q=h-g,r=!1,(g>0&&0>h||h>0&&0>g)&&D.push(this.regressExtremaEdges([j,k],[l,m],[n,o],c,b))}}return f=e===!0?f.concat(D,E,F):f.concat(D,E)},refinePoint:function(a,b,c,d){var e,f=d/20;if(c){for(;;){if(e=b(a[0]+f),!(e>a[1]))break;a=[a[0]+f,e]}for(;;){if(e=b(a[0]-f),!(e>a[1]))break;a=[a[0]+f,e]}}else{for(;;){if(e=b(a[0]+f),!(e<a[1]))break;a=[a[0]+f,e]}for(;;){if(e=b(a[0]-f),!(e<a[1]))break;a=[a[0]+f,e]}}return a},addImage:function(a,b,c){var d,e,f;return this.graphView._paperScope.activate(),this.graphView._projectLayers.imageLayer.activate(),d="string"==typeof a?new this.graphView._paperScope.Raster({source:a}):new this.graphView._paperScope.Raster(a),void 0===c?(e=d.width/2,f=d.height/2):(e=c[0]+c[2]/2,f=c[1]+c[3]/2),d.position=new this.graphView._paperScope.Point(e,f),b.position=this.graphView._getGraphPointCoordinates([e,f]),b.setPoints([]),b.getPoints().push(this.graphView._getGraphPointCoordinates([e,f])),this.addEquation(b),this.graphView._gridGraphModelObject.get("_images").push(b),d}},{}),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions=Backbone.Model.extend({},{_graphView:null,generateSimplePlot:function(b,c){var d=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.getPlotObject(c);return a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.addPoint(d,c.minX,b(c.minX)),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.addPoint(d,c.maxX,b(c.maxX)),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.finishSegment(d),d.lines},convertPolarToCartesian:function(a){var b,c,d,e,f;for(b=[],c=[],e=0;e<a.length;e++){for(c=a[e],d=[],f=0;f<c.length-1;f+=2)isFinite(c[f])&&isFinite(c[f+1])&&(d.push(c[f+1]*Math.cos(c[f])),d.push(c[f+1]*Math.sin(c[f])));b.push(d)}return b},addPoint:function(a,b,c){var d,e=[b,c],f=a.basePoint;return a.temporaryLines?f?(d=[a.temporaryLines[a.temporaryLines.length-2],a.temporaryLines[a.temporaryLines.length-1]],this.changePivot(d,f,e,a.tolerance)||(this.removeUnsettledPoints(a),a.basePoint=e),void(a.unsettledPoint=e)):(a.basePoint=e,void(a.unsettledPoint=e)):void(a.temporaryLines=[e[0],e[1]])},removeUnsettledPoints:function(a){a.unsettledPoint&&(a.temporaryLines.push(a.unsettledPoint[0],a.unsettledPoint[1]),a.basePoint=null,a.unsettledPoint=null)},finishSegment:function(b){a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.removeUnsettledPoints(b);var c,d,e;if(b.temporaryLines){for(c=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.fitPointsInsideDomain(b,b.temporaryLines),e=0;e<c.length;e++)c[e].length<2||(d=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.translateSegment(b,c[e],this._graphView),b.lines.push(d));b.temporaryLines=null}},translateSegment:function(a,b,c){var d,e,f=[];for(e=0;e<b.length-1;e+=2)d="x"===a.paramVariable?[b[e],b[e+1]]:[b[e+1],b[e]],d=c?c._getCanvasPointCoordinates(d):a.gridGraph._getCanvasPointCoordinates(d),f.push(d);return f},projectPointOnDomain:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s;return isFinite(e)||(e=e>0?1e10:-1e10),isFinite(c)||(c=c>0?1e10:-1e10),j=!0,k=!0,isFinite(e)||(e=e>0?1e10:-1e10),isFinite(c)||(c=c>0?1e10:-1e10),d<a.domain.minX?(h=a.domain.minX,i=a.domain.minY,n=a.domain.minX,o=a.domain.maxY):d>a.domain.maxX?(h=a.domain.maxX,i=a.domain.minY,n=a.domain.maxX,o=a.domain.maxY):j=!1,e<a.domain.minY?(f=a.domain.minX,g=a.domain.minY,l=a.domain.maxX,m=a.domain.minY):e>a.domain.maxY?(f=a.domain.minX,g=a.domain.maxY,l=a.domain.maxX,m=a.domain.maxY):k=!1,k&&(p=geomFunctions.intersectionOfLines(f,g,l,m,b,c,d,e),void 0!==p&&(r=geomFunctions.distance2(b,c,p[0],p[1]))),j&&(q=geomFunctions.intersectionOfLines(h,i,n,o,b,c,d,e),void 0!==q&&(s=geomFunctions.distance2(b,c,q[0],q[1]))),r||s?r&&s?r>s?p:q:r?p:s?q:void 0:void 0},fitPointsInsideDomain:function(a,b){if(void 0!==b&&!(b.length<2)){var c,d,e,f,g,h,i=[],j=[i],k=[];for(c=0;c<b.length-1;c+=2)if(b[c]!==d||b[c+1]!==e)if(h=this.getDomainForPoint(a,b[c],b[c+1]),void 0!==d){if(h!==g){if(0===h&&k.indexOf(0)>-1){for(;k.length>0;)k.pop();i=[],j.push(i)}k.push(h)}if(0===h){if(0!==g){if(f=this.projectPointOnDomain(a,b[c],b[c+1],d,e),void 0===f)continue;i.push(f[0]),i.push(f[1])}i.push(b[c]),i.push(b[c+1])}else if(0===g){if(f=this.projectPointOnDomain(a,d,e,b[c],b[c+1]),void 0===f)continue;i.push(f[0]),i.push(f[1])}else if(h!==g){if(f=this.projectPointOnDomain(a,b[c],b[c+1],d,e),void 0===f)continue;if(i.push(f[0]),i.push(f[1]),f=this.projectPointOnDomain(a,d,e,b[c],b[c+1]),void 0===f)continue;i.push(f[0]),i.push(f[1])}g=h,d=b[c],e=b[c+1]}else d=b[c],e=b[c+1],0===h&&(i.push(b[c]),i.push(b[c+1])),g=h,k.push(h);return j}},changePivot:function(a,b,c,d){var e,f=geomFunctions.getSegmentParam(c[0],c[1],a[0],a[1],b[0],b[1]);return 1>f?!1:(e=[a[0]+f*(b[0]-a[0]),a[1]+f*(b[1]-a[1])],Math.abs(c[0]-e[0])<=d&&Math.abs(c[1]-e[1])<=d)},isPointOutSideDomain:function(a,b,c){return 0===this.getDomainForPoint(a,b,c)},getDomainForPoint:function(a,b,c){var d=0,e=0;return b<a.domain.minX-10?d=1:b>a.domain.maxX+10&&(d=2),c<a.domain.minY?e=1:c>a.domain.maxY&&(e=2),10*e+d},getPlotObject:function(a){return{lines:[],segment:null,gridGraph:a.gridGraph,tolerance:a.tolerance,domain:a,basePoint:null,unsettledPoint:null,paramVariable:a.paramVariable}},refine:function(b,c,d,e){var f,g;g=geomFunctions.mean(b[0],c[0]),f=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.detectJump(d,e.domain.tolerance,b[0],b[1],g,d(g),c[0],c[1]),f&&(a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.addPoint(e,f[0][0],f[0][1]),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.finishSegment(e),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.addPoint(e,f[1][0],f[1][1]))},generatePlot:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.getPlotObject(c),f=c.minX,g=b(f),h=[f,g];for(isFinite(g)&&a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.addPoint(e,f,g),f+=c.step;f<=c.maxX;)g=b(f),isFinite(g)&&isFinite(h[1])?(a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.refine(h,[f,g],b,e),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.addPoint(e,f,g)):isFinite(g)&&!isFinite(h[1])?(d=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.limitedRefine(h[0],h[1],f,g,b),d[0]!==f&&a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.addPoint(e,d[0],d[1]),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.refine(d,[f,g],b,e),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.addPoint(e,f,g)):!isFinite(g)&&isFinite(h[1])&&(d=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.limitedRefine(h[0],h[1],f,g,b),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.refine(h,d,b,e),d[0]!==h[0]&&a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.addPoint(e,d[0],d[1]),a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.finishSegment(e)),h=[f,g],f+=c.step;return a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.finishSegment(e),e.lines},detectJump:function(b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q;if(isFinite(e)&&isFinite(g)&&isFinite(i)&&!(d>f||f>h))for(;;){if(j=this.getInterpolationParam(d,f),l=b(j),n=Math.abs(l-geomFunctions.mean(e,g)),k=this.getInterpolationParam(f,h),m=b(k),o=Math.abs(m-geomFunctions.mean(g,i)),c>=n&&c>=o)return null;if(!isFinite(l))return p=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.limitedRefine(d,e,j,l,b),q=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.limitedRefine(j,l,h,i,b),[p,q];if(!isFinite(m))return p=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.limitedRefine(d,e,k,m,b),q=a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.limitedRefine(k,m,h,i,b),[p,q];if(!(j!==d&&j!==f||k!==f&&k!==h))return Math.abs(g-e)>Math.abs(i-g)?(p=[d,e],q=[f,g]):(p=[f,g],q=[h,i]),[p,q];if(j===d||j===f)return a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.selectJumpPoint(d,e,f,g,k,m,h,i);if(k===f||k===h)return a.Common.Components.Models.MathUtilitiesGraphNew.plottingFunctions.selectJumpPoint(d,e,j,l,f,g,h,i);n>o?(h=f,i=g,f=j,g=l):(d=f,e=g,f=k,g=m)}},selectJumpPoint:function(a,b,c,d,e,f,g,h){var i=Math.abs(d-b),j=Math.abs(f-d),k=Math.abs(h-f);return i>j&&i>k?[[a,b],[c,d]]:k>j&&k>i?[[e,f],[g,h]]:[[c,d],[e,f]]},getInterpolationParam:function(a,b){return a>b&&(a=a+b-(b=a)),Math.abs(a)>.01||Math.abs(b)>.01?geomFunctions.mean(a,b):0===a?b*Math.abs(b):0===b?a*Math.abs(a):a>0!=b>0?0:geomFunctions.mean(a,b)},setGraphView:function(a){this._graphView=a},limitedRefine:function(a,b,c,d,e){var f,g;if(isFinite(b)!==isFinite(d))for(;;){if(f=this.getInterpolationParam(a,c),g=e(f),f===a||f===c)return isFinite(b)?[a,b]:[c,d];isFinite(g)!==isFinite(b)?(c=f,d=g):(a=f,b=g)}}})}(window.MathInteractives);