!function(a){"use strict";var b=null;a.Common.Components.Models.Shape3D=a.Common.Player.Models.BaseInteractive.extend({defaults:{paperScope:null,player:null,manager:null,type:null,properties:null,masterGroup:null,crossSection:!1,crossSectionData:null,applyGradient:!0,gradientData:null,gradientColor:null,gradientStops:null,baseOnTop:!1,shapeOpacity:1,showBorders:!0,showLabels:!1,labelsData:{radius:{labelType:null,linePosition:50,labelPosition:null,lineProperties:{strokeColor:"#FFFFFF"},textProperties:{strokeColor:"#FFFFFF"},customText:null,show:!0,centerProperties:{fillColor:"#FFFFFF",radius:0},showPointText:!0},height:{labelType:null,linePosition:50,labelPosition:null,labelPositionOffset:null,lineProperties:{strokeColor:"#FFFFFF"},textProperties:{strokeColor:"#FFFFFF"},customText:null,show:!0,showPointText:!0}}},initialize:function(){null==this.get("manager")&&this.set("manager",this.get("player").getManager()),this._selectAndCreateShape()},_selectAndCreateShape:function(){this._removeShape();var a=this.get("properties");switch(a.dashedLineData?this.dashedLineData=a.dashedLineData:a.radius<=50||a.width<=50?this.dashedLineData=[5,3]:this.dashedLineData=[10,5],this.get("type")){case b.TYPES.SPHERE:this._createShape(this._generateSphere(),!0);break;case b.TYPES.ELLIPSE:break;case b.TYPES.CYLINDER:this._createShape(this._generateCylinder(),!1);break;case b.TYPES.CONE:this._createShape(this._generateCone(),!1);break;case b.TYPES.DOUBLECONE:this._createShape(this._generateDoubleCone(),!0);break;default:return}},_createShape:function(a,b){var c=this.get("paperScope"),d=new c.Group(a);c.activate(),this.set("masterGroup",d),this.getShape()&&(this._setCrossSection(),b===!0?this.setGradient():this.setGradient(a.children[0]),this.get("showLabels")===!0&&this._drawLabels())},_generateSphere:function(){var a=this,b=a.get("paperScope"),c=null;return b.activate(),c=new b.Group(new b.Path.Circle(a.get("properties"))),c.name="sphere-group",c.data="shape",c},_generateCylinder:function(){var a=this,b=a.get("paperScope"),c=a.get("properties"),d=parseFloat(c.height.toFixed(3)),e=c.width,f=e/2,g=c.shortRadius||e/8,h=c.center.x,i=c.center.y-d/2,j=null,k=null,l=null,m={center:[h,i],radius:[f,g],strokeWidth:c.strokeWidth,strokeColor:c.strokeColor},n={point:[c.center.x-e/2,i],size:[e,d]},o=null,p=null,q=null,r=null,s=null;return b.activate(),(0===e||0===d)&&(m.radius=[0,0],n.size=[0,0],m.strokeColor="",m.strokeWidth=0),l=this._drawRectangle(n),j=this._drawEllipse(m),k=this._drawDottedEllipse(m),k.position=new b.Point(j.position.x,j.position.y+d),s=j.unite(l),o=k.children[1].children[1].unite(s),s.remove(),l.remove(),o.name="united-path",j.name="top-ellipse",k.name="bottom-ellipse",p=new b.Group(o,j,k),j.bringToFront(),k.bringToFront(),this.get("showBorders")&&(q=this._drawLine([h-f,i],[h-f,i+d]),r=q.clone(),r.position=new b.Point(q.position.x+2*f,q.position.y),p.addChildren([q,r]),p.strokeColor=c.strokeColor,p.strokeWidth=c.strokeWidth,k.children[0].children[1].strokeWidth=c.dottedStrokeWidth||c.strokeWidth),p.position=new b.Point(j.position.x,Math.round(j.position.y+d/2)),p.name="cylinder-group",p.data="shape",p},_generateCone:function(){var a,b,c,d=this,e=d.get("paperScope"),f=d.get("properties"),g=f.height,h=f.radius,i=h,j=f.shortRadius||h/4,k=this.get("baseOnTop"),l=f.center.x,m=null,n=null,o=null,p=null,q=null,r=null;return e.activate(),a=f.center.y-g/2,b={center:[l,a],radius:[i,j],strokeColor:f.strokeColor,strokeWidth:f.strokeWidth},0===g&&(b.radius=[0,0],b.strokeColor="",b.strokeWidth=0),k?(m=this._drawEllipse(b),p=m):(m=this._drawDottedEllipse(b),p=m.children[1].children[1],r=m.children[0].children[1]),c=new e.Point(l,a+g),n=new e.Path(new e.Point(l-i,a),new e.Point(l+i,a),c),n.closed=!0,k?o=n.unite(m):(o=n.unite(p),o.rotate(-180),o.position=new e.Point(m.position.x,m.position.y-g/2+j/2),p.strokeColor=f.strokeColor,p.strokeWidth=f.strokeWidth),n.remove(),o.name="cone-united-path",m.name="cone-ellipse",q=new e.Group(o,m),q.position=new e.Point(f.center.x,f.center.y+j/2),this.get("showBorders")&&(q.strokeColor=f.strokeColor,q.strokeWidth=f.strokeWidth,r&&(r.strokeWidth=f.dottedStrokeWidth||f.strokeWidth)),q.name="cone-group",q.data="shape",q},_generateDoubleCone:function(){var a=this.get("paperScope"),b=this.get("properties"),c=b.radius,d=b.shortRadius||c/4,e=null,f=null,g=null;return a.activate(),b.height/=2,e=this._generateCone(),e.name="bottom-cone",this.set("baseOnTop",!this.get("baseOnTop")),f=this._generateCone(),f.name="top-cone",f.position=new a.Point(e.position.x,e.position.y-b.height-d),g=new a.Group(e,f),g.position=new a.Point(b.center.x,b.center.y),this.get("showBorders")&&(g.strokeColor=b.strokeColor,g.strokeWidth=b.strokeWidth),g.name="double-cone-group",b.height*=2,this.set("baseOnTop",!this.get("baseOnTop")),g.data="shape",g},_setLabelTextAndPosition:function(a,c,d,e,f){var g,h,i=this.get("paperScope"),j=c.labelType||b.LABELS_TYPES.DIMENSION_CONSTANT,k=c.labelPosition||f,l="",m=null,n=null,o=null,p=null,q=i.Point,r=this.get("manager"),s=null;switch(i.activate(),j){case b.LABELS_TYPES.DIMENSION_CONSTANT:r.loadScreen("theme2-3d-shape-labels"),e===b.TYPES_FOR_LABELS.RADIUS?l=r.getMessage("dimension-constant-labels",0):e===b.TYPES_FOR_LABELS.HEIGHT&&(l=r.getMessage("dimension-constant-labels",1)),m=d.positionTopOffset||b.LABELS_OFFSET.DIMENSION_CONSTANT_TOP_DEFAULT,n=d.positionLeftOffset||b.LABELS_OFFSET.DIMENSION_CONSTANT_LEFT_DEFAULT,o=d.positionBottomOffset||b.LABELS_OFFSET.DIMENSION_CONSTANT_BOTTOM_DEFAULT,p=d.positionRightOffset||b.LABELS_OFFSET.DIMENSION_CONSTANT_RIGHT_DEFAULT;break;case b.LABELS_TYPES.DIMENSION_VALUES:l=a.length,m=d.positionTopOffset||b.LABELS_OFFSET.DIMENSION_VALUES_TOP_DEFAULT,n=d.positionLeftOffset||b.LABELS_OFFSET.DIMENSION_VALUES_LEFT_DEFAULT,o=d.positionBottomOffset||b.LABELS_OFFSET.DIMENSION_VALUES_BOTTOM_DEFAULT,p=d.positionRightOffset||b.LABELS_OFFSET.DIMENSION_VALUES_RIGHT_DEFAULT;break;case b.LABELS_TYPES.CUSTOM:l=c.customText,m=d.positionTopOffset||b.LABELS_OFFSET.DIMENSION_VALUES_TOP_DEFAULT,n=d.positionLeftOffset||b.LABELS_OFFSET.DIMENSION_VALUES_LEFT_DEFAULT,o=d.positionBottomOffset||b.LABELS_OFFSET.DIMENSION_VALUES_BOTTOM_DEFAULT,p=d.positionRightOffset||b.LABELS_OFFSET.DIMENSION_VALUES_RIGHT_DEFAULT}switch(s=this.get("player").getTextHeightWidth(l),k){case b.LABELS_POSITION.TOP:h=new q(a.position.x,a.position.y-s.height/2-m);break;case b.LABELS_POSITION.LEFT:h=new q(a.position.x-s.width/2-n,a.position.y);break;case b.LABELS_POSITION.BOTTOM:h=new q(a.position.x,a.position.y+s.height/2+o);break;case b.LABELS_POSITION.RIGHT:h=new q(a.position.x+s.width/2+p,a.position.y)}return d.point=h,null!==l&&(d.content=l),d.justification=d.justification||"center",d.fontFamily=d.fontFamily||"Montserrat",d.fontSize=d.fontSize||14,d.fillColor=d.fillColor||"#FFFFFF",d.strokeColor=d.strokeColor||"#FFFFFF",g=new i.PointText(d)},_drawEllipse:function(a){var b=null,c=this,d=c.get("paperScope");return d.activate(),b=new d.Path.Ellipse(a),b=this._refineFloatValues(b)},_drawRectangle:function(a){var b=null,c=this,d=c.get("paperScope");return d.activate(),b=new d.Path.Rectangle(a),b=this._refineFloatValues(b)},_refineFloatValues:function(a){return $.each(a._segments,function(){var a=this._point._x;this._point._x=parseFloat(a.toFixed(1)),a=this._point._y,this._point._y=parseFloat(a.toFixed(1))}),a},_setCrossSection:function(){if(this.get("crossSection")===!0)for(var a=this.get("crossSectionData"),b=a.length,c=0;b>c;c++)this._setCrossSectionProperties(a[c])},_setCrossSectionProperties:function(a){var c=a.position;if(!(0>=c||c>=100)){var d=this.get("properties"),e=this.get("paperScope"),f=null,g=this.getShape(),h=g.bounds,i=h.width,j=d.shortRadius||i/8,k=null,l=null,m=null,n=null,o=null,p=null;switch(e.activate(),this.get("type")){case b.TYPES.CYLINDER:n=d.width/2,m=c*d.height/100,k=g.getItems({name:"top-ellipse"})[0].bounds.top+m+j;break;case b.TYPES.CONE:m=c*d.height/100,k=h.top+m,n=this._getRadiusForCrossSectionInCone(i/2,d.height,m,a.strokeWidth||1);break;case b.TYPES.SPHERE:l=j/10,50>=c?(c=50-c,m=c*(d.radius-l)*2/100,k=h.center.y-m):(c-=50,m=c*(d.radius-l)*2/100,k=h.center.y+m),n=this._getRadiusForCrossSectionInSphere(d.radius,m,a.strokeWidth||1);break;case b.TYPES.DOUBLECONE:50>=c?(c=50-c,m=c*d.height/100,k=h.center.y-m):(c-=50,m=c*d.height/100,k=h.center.y+m),n=this._getRadiusForCrossSectionInCone(i/2,d.height/2,m,a.strokeWidth||1)}switch(o=d.shortRadius?n*j/(i/2):n/4,f={center:[g.position.x,k],radius:[n,o],strokeColor:a.strokeColor,strokeWidth:a.strokeWidth||1,fillColor:a.fillColor,opacity:a.opacity},a.crossSectionType){case b.CROSSSECTION_TYPES.FULLSOLID:p=this._drawEllipse(f);break;case b.CROSSSECTION_TYPES.FULLDOTTED:f.dashArray=this.dashedLineData,p=this._drawEllipse(f);break;case b.CROSSSECTION_TYPES.CLIPPED:p=this._drawDottedEllipse(f,a.dottedFrom,a.dottedTo);break;case b.CROSSSECTION_TYPES.CUSTOM:f=a.properties,p=this._drawEllipse(f);break;case b.CROSSSECTION_TYPES.HALFDOTTED:default:p=this._drawDottedEllipse(f)}if(p)if(p.name="cross-section-"+a.position,p.bringToFront(),a.isShapeCut===!0){var q=null,r=null,s=null;g.children[0]=this._refineFloatValues(g.children[0]),s=g.children[0].exclude(p),r=this._drawRectangle({point:[g.position.x-i/2,k],size:[i,g.bounds.bottom-k]}),q=new e.Group(r,s),q.clipped=!0;var t=new e.Group(q,p);g.children[0].remove(),g.insertChild(0,t)}else g.addChild(p)}},_drawDottedEllipse:function(a,b,c){var d=null,e=null,f=this.get("properties");return d=this._drawEllipse(a),e=d.clone(),b=b||d.bounds.leftCenter,c=c||d.bounds.rightCenter,e.dashArray=this.dashedLineData,e.opacity=a.opacity||f.ellipseOpacity||1,e.strokeWidth=f.dottedStrokeWidth||d.strokeWidth,this._clipEllipseForCrossSection(b,c,d,e)},_getRadiusForCrossSectionInSphere:function(a,b,c){return Math.sqrt(Math.pow(a-c,2)-Math.pow(b,2))},_getRadiusForCrossSectionInCone:function(a,b,c,d){var e=(a-d)/b,f=e*c;return f},_clipEllipseForCrossSection:function(a,b,c,d){var e=null,f=this.get("paperScope"),g=this.get("properties").strokeWidth||2,h=c.bounds.width/2,i=null,j=null,k=null,l=null,m=null,n=null;return i=new f.Rectangle(new f.Point(c.position.x-h-g,a.y),new f.Size(2*(h+g),Math.round(c.bounds.top-a.y)-g)),k=new f.Path.Rectangle(i),j=new f.Rectangle(new f.Point(c.position.x-h-g,a.y),new f.Size(2*(h+g),Math.round(c.bounds.bottom-a.y)+g)),l=new f.Path.Rectangle(j),m=new f.Group(k,d),m.clipped=!0,m.name="dotted-group",n=new f.Group(l,c),n.clipped=!0,n.name="solid-group",e=new f.Group(m,n),e.name="clipped-group",e},_drawLabels:function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this.getShape(),x=this.get("properties"),y=this.get("paperScope"),z=this.get("labelsData"),A=z.radius,B=z.height,C=w.bounds,D=C.width,E=x.strokeWidth||2,F=new y.Group,G=0;y.activate(),A&&A.show!==!1&&(n=A.linePosition,A.from&&A.to?(u=A.from,v=A.to):(o=x.height||2*x.radius,q=(50-n)*o/100,this.get("type")===b.TYPES.CONE&&(t=x.shortRadius||D/8,q+=t/2),r=C.center.x,s=C.center.y-q,u=[r,s],v=[r+D/2-E,s]),a=A.lineProperties,c=A.textProperties,e=A.centerProperties,m=b.LABELS_POSITION.TOP,j=b.TYPES_FOR_LABELS.RADIUS,f=this._drawLine(u,v,a),f.name="radius-line",k=new y.Group(f),A.showPointText!==!1&&(g=this._setLabelTextAndPosition(f,A,c,j,m),g.name="radius-point-text",k.addChild(g)),e&&(d=new y.Path.Circle(u,e.radius),d.fillColor=e.fillColor,k.addChild(d)),k.name="radius-labels-group",F.addChild(k),f.bringToFront(),g&&g.bringToFront()),B&&B.show!==!1&&(n=B.linePosition,B.from&&B.to?(u=B.from,v=B.to):(p=x.width||2*x.radius,o=x.height||2*x.radius,q=(50-n)*p/100,this.get("type")===b.TYPES.CONE&&(t=x.shortRadius||D/8,G=t/2),r=C.center.x-q,s=C.center.y-o/2-G,u=[r,s],v=[r,s+o]),a=B.lineProperties,c=B.textProperties,m=b.LABELS_POSITION.LEFT,j=b.TYPES_FOR_LABELS.HEIGHT,h=this._drawLine(u,v,a),h.name="height-line",l=new y.Group(h),B.showPointText!==!1&&(i=this._setLabelTextAndPosition(h,B,c,j,m),i.name="height-point-text",l.addChild(i)),l.name="height-labels-group",F.addChild(l),h.bringToFront(),i&&i.bringToFront()),F.name="labels-group";var H=this.getMasterGroup();H.addChild(F),y.view.draw()},_drawLine:function(a,b,c){var d,e,f=this.get("paperScope"),g=null;return f.activate(),void 0!==c?(d=c.strokeColor,e=c.strokeWidth):(d=this.get("properties").strokeColor,e=2),g=new f.Path.Line({from:a,to:b,strokeColor:d,strokeWidth:e})},_removeShape:function(){var a=this.getMasterGroup();a&&(a.removeChildren(),a.remove())},setGradient:function(a,c){var a=a||this.getShape(),d=this.get("paperScope"),e=this.get("gradientColor"),f=e.length,g=this.get("shapeOpacity"),h=this.get("gradientData"),i=this.get("gradientStops"),j=this.get("radialGradient");if(d.activate(),c&&(e=c.gradientColor||e,f=e.length,g=c.shapeOpacity||g,h=c.gradientData||h,i=c.gradientStops||i,j=c.radialGradient||j),null!=e){if(this.get("applyGradient")===!0)if(null!=h)a.fillColor=h;else{var k,l,m=a.bounds.width/2,n=null!==j&&void 0!==j?j:this.get("type")===b.TYPES.SPHERE,o=[];n?(l=new d.Point(a.position.x+m/4,a.position.y-m/4),k=a.bounds.leftCenter):(l=a.bounds.leftCenter,k=a.bounds.rightCenter);for(var p=0;f>p;p++)o.push(new Array(e[p],i[p]));a.fillColor={gradient:{stops:o,radial:n},origin:l,destination:k}}else a.fillColor=e[0];a.opacity=g}d.view.draw()},updatePropertiesOfShape:function(a){var b=this.get("properties");this._removeShape(),this.set("properties",$.extend({},b,a)),this._selectAndCreateShape()},updateLabelsData:function(a){var b,c,d=this.get("labelsData"),e=d.radius,f=d.height;if(a){var g,h;b=a.radius,c=a.height,g=b?$.extend({},e,b):e,h=c?$.extend({},f,c):f,this.set("labelsData",new Object({radius:g,height:h}))}this._removeShape(),this._selectAndCreateShape()},addCrossSection:function(a){this._setCrossSectionProperties(a)},removeCrossSection:function(a,b){var c=this.getShape(),d=c.getItems({name:"cross-section-"+a}),e=this.get("paperScope"),f=d.length;if(e.activate(),b)d[b]&&d[b].remove();else for(var g=0;f>g;g++)d[g].remove();e.view.draw()},drawLine:function(a){var b=this.get("paperScope"),c=null;return b.activate(),c=new b.Path.Line(a)},removeShape:function(){this._removeShape()},getMasterGroup:function(){return this.get("masterGroup")},getShape:function(){var a=this.getMasterGroup();return a?a.getItems({data:"shape"})[0]:void 0},getLabelsGroup:function(){var a=this.getMasterGroup();return a?a.getItems({name:"labels-group"})[0]:void 0},getRadiusLabelGroup:function(){var a=this.getLabelsGroup();return a?a.getItems({name:"radius-labels-group"})[0]:void 0},getHeightLabelGroup:function(){var a=this.getLabelsGroup();return a?a.getItems({name:"height-labels-group"})[0]:void 0},getCrossSection:function(a,b){var c=this.getShape(),d=c.getItems({name:"cross-section-"+a}),e=d.length;return 0!==e?d[b]?d[b]:1===e?d[0]:d:void 0}},{generate3DShapeModel:function(b){return new a.Common.Components.Models.Shape3D(b)},TYPES:{SPHERE:"sphere",CYLINDER:"cylinder",CONE:"cone",DOUBLECONE:"doublecone",ELLIPSE:"ellipse"},CROSSSECTION_TYPES:{HALFDOTTED:"halfdotted",FULLDOTTED:"fulldotted",FULLSOLID:"fullsolid",CLIPPED:"clipped",CUSTOM:"custom"},LABELS_TYPES:{DIMENSION_VALUES:"dimension-values",DIMENSION_CONSTANT:"dimension-constant",CUSTOM:"custom"},LABELS_POSITION:{TOP:"top",LEFT:"left",BOTTOM:"bottom",RIGHT:"right"},LABELS_OFFSET:{DIMENSION_VALUES_BOTTOM_DEFAULT:8,DIMENSION_VALUES_TOP_DEFAULT:-1,DIMENSION_VALUES_LEFT_DEFAULT:5,DIMENSION_VALUES_RIGHT_DEFAULT:5,DIMENSION_CONSTANT_TOP_DEFAULT:-1,DIMENSION_CONSTANT_LEFT_DEFAULT:6,DIMENSION_CONSTANT_BOTTOM_DEFAULT:5,DIMENSION_CONSTANT_RIGHT_DEFAULT:5.5},TYPES_FOR_LABELS:{RADIUS:"radius",HEIGHT:"height"}}),b=a.Common.Components.Models.Shape3D}(MathInteractives);