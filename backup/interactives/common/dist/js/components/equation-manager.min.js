!function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager;a.TileItem=MathInteractives.Common.Player.Models.Base.extend({defaults:{base:null,exponent:null,operator:null,coefficient:null,tileArray:null,strDroppables:"*",bDenominator:!1,type:null,exprTree:null},initialize:function(){},getItemFromIndex:function(a){throw new Error("Not implemented getItemFromIndex")},getIndexOfItem:function(a){for(var b=0,c=this.get("tileArray");b<c.length;b++)return a.getLeft()>c.models[b].get("rectTerm").getLeft()?this.get("tileArray").at(b).getIndexOfItem():this;return null},deepClone:function(){var a=this.clone(),b=null,c=this.get("tileArray"),d=new Backbone.Collection,e=null;if(c&&c.length>0){for(b=0;b<c.length;b++)e=c.at(b).deepClone(),d.add(e);a.set("tileArray",d)}return a},getAllBases:function(){var a,b,c,d=[],e=this.get("tileArray"),f=[];for(a=0;a<e.length;a++)if(c=e.at(a),f=c.getAllBases(),void 0!==f)for(b=0;b<f.length;b++)void 0!==f[b]&&d.push(f[b]);return d},getAllBaseLocations:function(){var b,c,d,e,f,g,h=this.get("tileArray"),i=[],j=a.TileItem.SolveTileType;for(b=0;b<h.length;b++)d=h.at(b),c=d.get("type"),c!==j.BASE_EXPONENT&&c!==j.BASE_ONLY?i=i.concat(d.getAllBaseLocations()):(e=d.get("base"),f=d.get("exponent"),g=d.get("bDenominator"),null===e&&null===f?g===!1?i.push(1):i.push(-1):null!==e?i.push(g):null!==f&&i.push(g));return i},getBasesAtGivenLocation:function(b){var c,d,e,f,g=this.get("tileArray"),h=[],i=a.TileItem.SolveTileType;for(c=0;c<g.length;c++)e=g.at(c),d=e.get("type"),d!==i.BASE_EXPONENT&&d!==i.BASE_ONLY?h=h.concat(e.getBasesAtGivenLocation(b)):(f=e.get("bDenominator"),f===b&&h.push(f));return h},getTileStatus:function(){var b,c,d,e,f,g=this.get("tileArray"),h=[0,0],i=a.TileItem.SolveTileType,j=[];for(b=0;b<g.length;b++)d=g.at(b),c=d.get("type"),c!==i.BASE_EXPONENT&&c!==i.BASE_ONLY?(j=d.getTileStatus(),h[0]+=j[0],h[1]+=j[1]):(e=d.get("base"),f=d.get("exponent"),d.get("bDenominator")===!1?null!==e&&null!==f&&h[0]++:null!==e&&null!==f&&h[1]++);return h},checkParentesisExponent:function(){var b,c,d,e=this.get("tileArray"),f=a.TileItem.SolveTileType;for(b=0;b<e.length;b++)if(c=e.at(b),d=c.get("type"),d!==f.BASE_EXPONENT&&d!==f.BASE_ONLY&&c.checkParentesisExponent()===!1)return!1;return!0},isNegativeExpPresent:function(){var a,b,c=this.get("tileArray");for(a=0;a<c.length;a++)if(b=c.at(a),b.isNegativeExpPresent()===!1)return!1;return!0},getAllParenthesis:function(){var b,c,d,e=this.get("tileArray"),f=a.TileItem.SolveTileType,g=[];for(b=0;b<e.length;b++)d=e.at(b),c=d.get("type"),c!==f.BASE_EXPONENT&&c!==f.BASE_ONLY&&(g=g.concat(d.getAllParenthesis()));return g},isExpAbsOne:function(){var a,b,c=this.get("tileArray");for(a=0;a<c.length;a++)if(b=c.at(a),b.isExpAbsOne()===!0)return!0;return!1},isParenthesisPresent:function(){var a,b=this.get("tileArray");for(a=0;a<b.length;a++)if(b.at(a).isParenthesisPresent()===!0)return!0;return!1},setDenominator:function(a){this.set("bDenominator",a)},getExponentSign:function(){var a=parseInt(this.get("exponent"),10);return 0>a?-1:1},areChildrenOnlyMultiplied:function(){var a=this.get("tileArray").where({operator:"+"});return 0===a.length},next:function(){var a=this.collection,b=a.indexOf(this);return a.at(b+1)},getIndexFromItem:function(b){var c=this.get("tileArray"),d=null,e=(a.TileItem.SolveTileType,0);if(d=c.indexOf(b),-1!==d)return d+"";for(e=0;e<c.length;e++)if(d=c.at(e).getIndexFromItem(b),-1!==d)return e+"."+d;return-1},invertBDenominator:function(){var a=this.get("bDenominator"),b=this.get("tileArray");b&&b.each(function(a){a.invertBDenominator()},this),_.isBoolean(a)&&this.set("bDenominator",!a)},invertChildBDenominator:function(){var a=this.get("tileArray");a&&a.each(function(a){a.invertBDenominator()},this)},invertExponentSign:function(){var a=(this.get("exponent"),this.get("tileArray"));a.each(function(a){a.invertExponentNonRecursive()},this),this.invertExponentNonRecursive()},invertExponentNonRecursive:function(){this.set("exponent",-1*this.get("exponent"))},multiplyChildExponentsBy:function(a){var b,c,d,e,f,g=this.get("tileArray"),h=!1,i=[];for(b=0;b<g.length;b++)f=g.at(b),d=f.get("exponent"),d?(c=d*a,Math.abs(c)>99&&(h=!0),f.set("exponent",c)):(e=g.at(b).get("base"),-1===e&&a%2===0&&(f.set("base",1),i.push(b)));return h===!0?(this.divideChildExponentsBy(1/a,i),!1):i},divideChildExponentsBy:function(a,b){var c,d,e,f,g,h=this.get("tileArray");for(c=0;c<h.length;c++)g=h.at(c),e=g.get("exponent"),e?(d=e*a,g.set("exponent",d)):(f=h.at(c).get("base"),1===f&&a%2!==0&&-1!==b.indexOf(c)&&g.set("base",-1));return!0},getOperators:function(){var a=[],b=this.get("tileArray"),c=this.get("operator");return b?(b.each(function(b){Array.prototype.push.apply(a,b.getOperators())},this,a),a.push(c),_.compact(a)):[c]},allOperatorsMultiplicative:function(){var a=this.getOperators(),b=0;for(b=0;b<a.length;b++)if("*"!==a[b]&&"/"!==a[b])return!1;return!0},isEmpty:function(b){var c=this.get("exponent"),d=this.get("base"),e=a.TileItem.BinTileType;switch(b){case e.BASE:return null===d||void 0===d;case e.EXPONENT:return null===c||void 0===c;default:return!(null!==c&&void 0!==c||null!==d&&void 0!==d)}},getFirstDenominatorTile:function(){var a=this.get("tileArray");return a?a.findWhere({bDenominator:!0}):void 0},isFirstChild:function(a){return 0===this.indexOf(a)||this.get("tileArray").findWhere({bDenominator:!0})===a},nextTile:function(a){return this.at(this.indexOf(a)+1)},denominators:function(){return this.where({bDenominator:tile.get("bDenominator")})},remove:function(a,b){return this.get("tileArray").remove(a,b)},at:function(a){return this.get("tileArray").at(a)},add:function(a,b){return this.get("tileArray").add(a,b)},addMultiple:function(a,b){for(var c=0;c<a.length;c++)this.add(a[c],{at:b+c})},where:function(a){return this.get("tileArray")?this.get("tileArray").where(a):[]},indexOf:function(a,b){return this.get("tileArray").indexOf(a,b)},setBDenominator:function(a){this.set("bDenominator",a);var b=this.get("tileArray"),c=0;if(b)for(c=0;c<b.length;c++)b.at(c).set("bDenominator",a)},getChildBases:function(a){if(this.get("type")===a)return 1;var b,c,d=0,e=this.get("tileArray");for(b=0;b<e.length;b++)c=e.at(b),d+=c.getChildBases(a);return d},isOne:function(){return!1}},{SolveTileType:{NONE:"NONE",BASE_EXPONENT:"BASE_EXPONENT",BASE_ONLY:"BASE_ONLY",PARENTHESIS:"PARENTHESIS",BIG_PARENTHESIS:"BIG_PARENTHESIS",FRACTION:"FRACTION",EQUATION_COMPONENT:"EQUATION_COMPONENT"},BinTileType:{BASE:"BASE",EXPONENT:"EXPONENT",BASE_EXPONENT:"BASE_EXPONENT",BASE_ONLY:"BASE_ONLY",PARENTHESIS:"PARENTHESIS",BIG_PARENTHESIS:"BIG_PARENTHESIS",FRACTION:"FRACTION",EQUATION_COMPONENT:"EQUATION_COMPONENT",MARQUEE:"MARQUEE"},MultiplicationThresold:5,AdditionThresold:5,createTileItem:function(b){var c,d=a.TileItem.SolveTileType;switch(b.type){case d.BASE_EXPONENT:c=new a.BaseExpTile(b);break;case d.PARENTHESIS:c=new a.ParenthesisTile(b);break;case d.FRACTION:c=new a.FractionTile(b);break;case d.BIG_PARENTHESIS:c=new a.BigParenthesisTile(b);break;case d.BASE_ONLY:c=new a.BaseTile(b);break;default:throw new Error("Item Type does not exist")}return c},TreeNode:function(a,b){this.data=a,this.collectionData=b,this.children=[],this.parent=null}}),a.TileItem.TreeNode.prototype.isLeftmostChild=function(){return this.isRoot()?!1:this===this.parent.children[0]},a.TileItem.TreeNode.prototype.isRightmostChild=function(){return this.isRoot()?!1:this===_.last(this.parent.children)},a.TileItem.TreeNode.prototype.getRightmostChild=function(){return _.last(this.children)},a.TileItem.TreeNode.prototype.getLeftmostChild=function(){return this.children[0]},a.TileItem.TreeNode.prototype.isRoot=function(){return this.parent?!1:!0},a.TileItem.TreeNode.prototype.isLeaf=function(){return 0===this.children.length},a.TileItem.TreeNode.prototype.getPath=function(){for(var a=this,b=null,c=[];!a.isRoot();)b=a.parent.children.indexOf(a),c.push(b),a=a.parent;return c.reverse(),c},a.TileItem.TreeNode.prototype.getTreeRoot=function(){for(var a=this;!a.isRoot();)a=a.parent;return a},a.TileItem.TreeNode.prototype.get=function(a){var b=0,c=this;for(b=0;b<a.length;b++)c=c.children[a[b]];return c},a.TileItem.TreeNode.prototype.getTotalExponentUpto=function(a){var b=this,c=null;for(c="^"===b.data?1:this.data.get("exponent");!b.isRoot()&&!_.isEqual(a,b);)"^"===b.data&&(c*=b.getRightmostChild().data),b=b.parent;return"^"===b.data&&(c*=b.getRightmostChild().data),c},a.TileItem.TreeNode.prototype["delete"]=function(){var a=this.parent.children,b=this.parent.parent,c=a.indexOf(this);return a.splice(c,1),a.length<=1&&(Array.prototype.push.apply(b.children,a),a[0].parent=b),this},a.TileItem.TreeNode.prototype.getOperator=function(){for(var a=this;!a.isRoot();){if(_.isString(a.data)&&"^"!==a.data)return a.data;a=a.parent}return a.data}}(),function(){var a=MathInteractives.Common.Components.Models.EquationManager;a.Marquee=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:function(){return{idPrefix:null,manager:null,filePath:null,player:null,marqueeContainer:null,selectorClass:null,ignoreClass:"ignore-marquee",tolerance:0,zIndex:0,marqueeDefaultOffset:{top:0,left:0},itemsDefaultOffset:{top:0,left:0},paddingTop:2,paddingRight:0,paddingBottom:2,paddingLeft:0,scrollAmt:0,type:"MARQUEE"}}},{MARQUEE_STYLE_DRAGGING:{border:"1px dashed rgb(141, 141, 141)","border-radius":"5px","background-color":"rgba(206, 206, 206, 0.4)"},MARQUEE_STYLE_AFTER_RELEASE:{border:"1px dashed rgb(228, 228, 228)","border-radius":"5px","background-color":"rgba(206, 206, 206, 0.4)"},FAKE_MARQUEE_STYLE:{DRAGGING:{border:"1px dashed rgb(141, 141, 141)","border-radius":"5px","background-color":"rgba(0,0,0,0)"}}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.BaseCommand=MathInteractives.Common.Player.Models.Base.extend({initialize:function(){},execute:function(){throw"Execute function not implemented"},undo:function(){throw"Undo function not implemented"},getSourceWrtParent:function(b){var c=b.lastIndexOf(a.CommandFactory.SEPARATOR);return b.substring(c+1)},getParentIndex:function(b){if(1===b.length)return"";var c=b.lastIndexOf(a.CommandFactory.SEPARATOR);return b.substring(0,c)},getParentTiles:function(a,b){return b=this.getParentIndex(b),a.getItemFromIndex(b).get("tileArray")},isNotAlone:function(a,c){return a.get("type")===b.TileItem.SolveTileType.EQUATION_COMPONENT?a.where({bDenominator:c.get("bDenominator")}).length>2:a.where({bDenominator:c.get("bDenominator")}).length>1},searchInTree:function(a,b){var c,d;if(null===a||void 0===a)return null;if(a.data===b||a.collectionData===b)return a;for(c=0;c<a.children.length;c++)if(d=this.searchInTree(a.children[c],b),null!==d&&void 0!==d)return d},_getReversePosition:function(a,b,c){return void 0===c&&(c=[]),null===a||void 0===a?null:a.data===b?(a.isLeftChild()?c.push(0):a.isRightChild()&&c.push(1),c):(c=this.getPosition(a.left,b,c),null!==c&&void 0!==c&&c!==[]?(c.push(0),c):(c=this.getPosition(a.right,b,c),null!==c&&void 0!==c&&c!==[]?(c.push(1),c):null))},getPosition:function(a,b){return this._getReversePosition(a,b,[]).reverse()},getLeftOperator:function(a){return a.isRoot()?a.data:a.isLeftmostChild()?"^"===a.parent.data?null:this.getLeftOperator(a.parent):a.parent.data},getCommonParent:function(a,b){var c=a.getPath(),d=b.getPath(),e=a.getTreeRoot(),f=Math.min(c.length,d.length),g=[],h=0;for(h=0;f>h&&c[h]===d[h];h++)g[h]=c[h];return e.get(g)},getCommonParentFromMultiple:function(a){if(1===a.length)return a[0];var b=this.getCommonParent(a[0],a[1]),c=0;if(2===a.length)return b;for(c=2;c<a.length&&!b.isRoot();c++)b=this.getCommonParent(b,a[c]);return b},getOperatorsBetween:function(a,b){var c=this.getCommonParent(a,b),d=[],e=null,f=a;for(d.push(c);!_.isEqual(f,c)&&!_.isEqual(f.parent,c);)e=f.parent,d.push(e),f=f.parent;for(f=b;!_.isEqual(f,c)&&!_.isEqual(f.parent,c);)e=f.parent,d.push(e),f=f.parent;return d},getOperatorStringsBetween:function(a,b){var c=this.getOperatorsBetween(a,b),d=[],e=0;for(e=0;e<c.length;e++)d.push(c[e].data);return d},allOperatorsSame:function(a){var b=0,c=null;if(a.length&&(c=a[0]),"^"===c)return!1;for(b=0;b<a.length;b++)if(c!==a[b])return!1;return!0},allowedOperators:function(a){var b=["*","/","^"],c=0;for(c=0;c<a.length;c++)if(-1===b.indexOf(a[c]))return!1;return!0},countOccurences:function(a,b){for(var c=[],d=a.indexOf(b);-1!==d;)c.push(d),d=a.indexOf(b,d+1);return c.length},getBaseExponentLeaves:function(a){var c=[],d=0;if(_.isNumber(a.data))return[];if(!_.isString(a.data)&&a.data.get("type")===b.TileItem.SolveTileType.BASE_EXPONENT)return[a];for(d=0;d<a.children.length;d++)Array.prototype.push.apply(c,this.getBaseExponentLeaves(a.children[d]));return c},getChildTiles:function(a){if(a.get("type")===b.TileItem.SolveTileType.BASE_EXPONENT)return a;var c=a.get("tileArray"),d=[];return c.each(function(a){a.get("type")===b.TileItem.SolveTileType.BASE_EXPONENT?d.push(a):d.concat(this.getChildTiles(a))},this),d},tilesToNodes:function(a,b){var c=[],d=0;for(d=0;d<b.length;d++)c.push(this.searchInTree(a,b[d]));return c},belongsTo:function(a,b){return!(-1===b.indexOf(a))},isAddOrSub:function(a){return this.belongsTo(a,["+","-"])},isMulOrDiv:function(a){return this.belongsTo(a,["/","*"])},getOperatorsUpto:function(a,b){var c=[],d=0;for(d=0;d<a.length;d++)c.push(this.getOperatorStringsBetween(a[d],b));return c},allOperatorsMulOrDiv:function(a){for(var b=0;b<a.length;b++)if(!this.isMulOrDiv(a[b]))return!1;return!0},validatePlusNode:function(a,b){var c,d=0;if(a.isLeaf())return!0;if(this.isAddOrSub(a.data)||"^"===a.data){for(d=0;d<a.children.length;d++)if(!this.validatePlusNode(a.children[d],b))return!1;return!0}return this.isMulOrDiv(a.data)?(c=this.getBaseExponentLeaves(a),0===_.difference(c,b).length||_.difference(c,b).length===c.length?!0:!1):void 0},validateMarquee:function(a,b,c,d){var e=[],f=null,g=null,h=c,i=h.indexOf(b),j=null,k=[],l=[],m=[],n=0;for(n=0;d>n;n++)g=h.at(i+n),f=this.searchInTree(a,g),m.push(this.getBaseExponentLeaves(f)),e.push(f),f.isRoot()||k.push(f.parent.data);return m=_.flatten(m),j=this.getCommonParentFromMultiple(e),l=this.getBaseExponentLeaves(j),this.isMulOrDiv(j.data)?this.allOperatorsMulOrDiv(k):this.isAddOrSub(j.data)?this.validatePlusNode(j,m):void 0},getMarqueeNode:function(a,b,c,d){var e=[],f=0,g=null,h=c.get("tileArray"),i=h.indexOf(b),j=null,k=null;for(f=0;d>f;f++)g=h.at(i+f),k=this.searchInTree(a,g),e.push(this.getBaseExponentLeaves(k));return e=_.flatten(e),j=this.getCommonParentFromMultiple(e)},getLeftmostChild:function(a){return a.isLeaf()?a:a.collectionData?a:this.getLeftmostChild(a.children[0])},_setOperators:function(a,b,c){var d,e;this._toggleOperator(a,0,c),this._toggleOperator(b,0,c),d=this._getDenominatorStartIndex(a),e=this._getDenominatorStartIndex(b),-1!==d&&this._toggleOperator(a,d,c),-1!==e&&this._toggleOperator(b,e,c)},_toggleOperator:function(a,b,c){var d=a.at(b),e=d.get("operator");c===!0?"*"!==e&&d.set("operator","*"):null!==e&&d.set("operator",null)},_getDenominatorStartIndex:function(a){var b,c=a.length;for(b=0;c>b;b++)if(a.at(b).get("bDenominator")===!0)return b;return b===c?-1:void 0},addExtraOperators:function(a,b){a.invoke("set","operator","*"),b.invoke("set","operator","*")},removeExtraOperators:function(a,b){var c=a.findWhere({bDenominator:!0});a.at(0).set("operator",null),b.at(0).set("operator",null),c&&c.set("operator",null),c=b.findWhere({bDenominator:!0}),c&&c.set("operator",null)}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.RepositionCommand=a.BaseCommand.extend({defaults:{},numOfTiles:null,sourcePos:null,destPos:null,initialize:function(){},_initializeInstanceAttributes:function(a){this.source=a.source,this.dest=a.dest,this.numOfTiles=a.source.numOfTiles,this.isDenominator=this.isLeft=a.isLeft},execute:function(a,c,d){this._initializeInstanceAttributes(d),this.modelRef=c,this.oldOperators=[];var e=this.source.index,f=this.dest.index,g=b.CommandFactory.EXIT_CODE;if(-1!==e.indexOf("-1")||-1!==f.indexOf("-1"))return g.FAILURE;var h=c.getItemFromIndex(e),i=c.getItemFromIndex(f),j=h.get("bDenominator"),k=_.isBoolean(this.dest.isDenominator)?this.dest.isDenominator:i.get("bDenominator"),l=c.getItemFromIndex(this.getParentIndex(e)),m=c.getItemFromIndex(this.getParentIndex(f));return h&&i?(this.sourceInDenominator=h.get("bDenominator"),this.sourcePos=parseInt(this.getSourceWrtParent(e),10),this.destPos=parseInt(this.getSourceWrtParent(f),10),this.destLoc=k,this.sourceTile=h,this.destTile=i,l!==m?g.NOT_SAME_PARENT_COMBINE:(this.sourcePos<this.destPos&&(this.destPos-=this.numOfTiles),this.isLeft||this.destPos++,l===m&&this.destPos===this.sourcePos&&j===k?g.FAILURE:this._executeReposition(l,m,c))):g.FAILURE},undo:function(a){var b=this.source.index,c=this.dest.index,d=a.getItemFromIndex(this.getParentIndex(b)),e=a.getItemFromIndex(this.getParentIndex(c)),f=d.get("tileArray"),g=e.get("tileArray"),h=this.sourceTile,i=this.destTile,j=h.get("bDenominator"),k=(i.get("bDenominator"),this.movedTiles),l=this.sourceInDenominator,m=null,n=0;if(a.allOperatorsMultiplicative()){for(this.addExtraOperators(f,g),this.oneTile&&d.remove(this.oneTile),this.removedOneTile&&e.add(this.removedOneTile,{at:0}),g.remove(k),n=0;n<k.length;n++)k[n].setBDenominator(l),f.add(k[n],{at:this.sourcePos+n}),j!==l&&this._invertExponent(k[n]);return this.addedTile&&d.remove(this.addedTile),void this.removeExtraOperators(f,g)}for(g.remove(k),g.at(0).set("operator",null),m=g.findWhere({bDenominator:!0}),m&&m.set("operator",null),n=0,length=k.length;n<length;n++)f.add(k[n],{at:this.sourcePos+n});h.set("operator",this.draggedOperator),i.set("operator",this.droppedOperator),f.at(0).set("operator",null),m=f.findWhere({bDenominator:!0}),m&&m.set("operator",null)},_executeReposition:function(a,c,d){var e=(this.source.index,this.dest.index,this.tree),f=this.modelRef.getItemFromIndex(this.source.index),g=this.modelRef.getItemFromIndex(this.dest.index),h=f.get("bDenominator"),i=a.get("tileArray"),j=c.get("tileArray"),k=null,h=f.get("bDenominator"),l=null,m=(this.oldOperators,[]),n=this.destLoc,o=b.CommandFactory.EXIT_CODE,p=b.TileItem.BinTileType,d=this.modelRef,q=0;if(d.allOperatorsMultiplicative()){for(m=this._getConcernedTiles(a),this.addExtraOperators(i,j),a.remove(m),q=0;q<m.length;q++)h!==n&&this._invertExponent(m[q]),m[q].setBDenominator(n),c.add(m[q],{at:this.destPos+q});return a.get("type")===p.FRACTION&&a.isNumeratorEmpty()&&this._addOneTile(a),g.isOne()&&(this.removedOneTile=g,c.remove(g)),this.removeExtraOperators(i,j),this.movedTiles=m,o.SUCCESS}if(this.numOfTiles>1&&!this.validateMarquee(e,f,a,this.numOfTiles))return!1;if(!this.validateReposition())return!1;if(this.exponent=f.get("exponent"),m=this._getConcernedTiles(a,h===destLocation),d.allOperatorsMultiplicative())for(i.remove(m),q=0,length=m.length;q<length;q++)j.add(m[q],{at:this.destPos+q});for(this.repositionTree(e,draggedNode,droppedNode),i.remove(m),q=0,length=m.length;q<length;q++)j.add(m[q],{at:this.destPos+q});return this._handleEmptyDenOrNum(a),draggedOperator=this.getLeftOperator(this.draggedNode),droppedOperator=this.getLeftOperator(this.droppedNode),"/"===draggedOperator&&(draggedOperator="*"),"/"===droppedOperator&&(droppedOperator=null),f.set("operator",draggedOperator),l=this.droppedNode,_.isString(l.data)?l.collectionData&&l.collectionData.set("operator",droppedOperator):l.data.set("operator",droppedOperator),this._handleNextTileOperators(f,g),i.length>0&&i.at(0).set("operator",null),k=i.findWhere({bDenominator:!0}),k&&k.set("operator",null),j.length>0&&j.at(0).set("operator",null),k=j.findWhere({bDenominator:!0}),k&&k.set("operator",null),this._setDraggedExponent(draggedNode,droppedNode),!0},repositionTree:function(a,b,c){var d=b.parent.children,e=c.parent.children,f=b.parent,g=d.indexOf(b),h=null,i=null,j=(this.getCommonParent(b,c),this.isLeft);if(b.parent!==c.parent){for(i=c;!i.parent.isRoot()&&!this._areSimilar(i.parent,f);)i=i.parent;c=i,e=c.parent.children}this.droppedNode=c,this.draggedNode=b,"/"===c.parent.data&&this._handleDivisionOperator(a,c),d.splice(g,1),h=c.parent.children.indexOf(c),h=j?h:h+1,c.parent.children.splice(h,0,b)},_areSimilar:function(a,b){return a.data===b.data?!0:"*"===a.data&&"/"===b.data?!0:!1},_handleDivisionOperator:function(a,c){var d=new b.TileItem.TreeNode("*"),e=c.parent.children,f=e.indexOf(c);e.splice(f,1),d.children.push(c),e.splice(f,0,d),d.parent=c.parent,c.parent=d,this.droppedNode=c},_handleEmptyDenOrNum:function(a){if(a.get("type")!==b.TileItem.SolveTileType.FRACTION)return!1;var c,d=a.get("tileArray");0===d.where({bDenominator:!1}).length&&(c=new b.BaseExpTile,c.set("base",1),c.set("exponent",1),c.set("bDenominator",!1),d.add(c,{at:0})),0===d.where({bDenominator:!0}).length&&(c=new b.BaseExpTile,c.set("base",1),c.set("exponent",1),c.set("bDenominator",!0),d.add(c))},_handleNextTileOperators:function(a,b){var c=a.next(),d=b.next(),e=this.tree,f=this.searchInTree(e,c),g=this.searchInTree(e,d);c&&c.set("operator",this.getLeftOperator(f)),d&&d.set("operator",this.getLeftOperator(g))},validateReposition:function(){var a=this.modelRef,b=a.getItemFromIndex(this.source.index),c=a.getItemFromIndex(this.dest.index),d=(this.tree,null),e=null,f=null,g=null,h=this.isLeft,i=null,j=null;return d=this.getDraggedNode(b),e=this.getDroppedNode(c),_.isEqual(d.parent,e.parent)?!0:(f=d.getOperator(),g=e.getOperator(),this.draggedOperator=f,this.droppedOperator=g,this.draggedTile=b,this.droppedTile=c,this.belongsTo(f,["*","/"])&&this.belongsTo(g,["*","/"])?this.validatePath(d,e):this.isMulOrDiv(f)&&this.isAddOrSub(g)?!1:this.isAddOrSub(f)&&this.isMulOrDiv(g)?e.isLeftmostChild()&&h||e.isRightmostChild()&&!h?(e.isLeftmostChild()?j="left":e.isRightmostChild()&&(j="right"),i=this.getLastParentMulOrDivNode(j,e),_.isEqual(i.parent,d.parent)?!0:this.validatePath(d,i)):this.validatePath(d,e):!1)},validatePath:function(a,b){var c=this.getOperatorStringsBetween(a,b);a.parent.data,b.parent.data;return this.allowPlusAndCarat(a,b)||this.allowedOperators(c)&&this.allowCarat(a,b)?!0:!1},allowCarat:function(a,b){var c=0,d=null,e=this.getCommonParent(a,b),f=this.getOperatorsBetween(e,b),g=this.getOperatorsBetween(e,a),h=0;for("^"===e.data&&(f=_.without(f,e)),h=0;h<f.length;h++)"^"===f[h].data&&1!==f[h].children[1].data&&(d=f[h].children[1].data);for(h=0;h<g.length;h++)"^"===g[h].data&&1!==g[h].children[1].data&&c++;return c>1?!1:null===d&&0===c?!0:null===d?!1:d===a.getTotalExponentUpto(e)&&this.sameLocation(a,b)?!0:!1},sameLocation:function(a,b){var c,d;return c=_.isString(a.data)?a.collectionData.get("bDenominator"):a.data.get("bDenominator"),d=b.data?b.data.get("bDenominator"):b.collectionData.get("bDenominator"),c===d},allowPlusAndCarat:function(a,b){return!1},getLastParentMulOrDivNode:function(a,b){this.tree;return b.isRoot()?b:"*"!==b.parent.data&&"^"!==b.parent.data?b:b.isLeftmostChild()&&"left"===a||b.isRightmostChild()&&"right"===a?this.getLastParentMulOrDivNode(a,b.parent):b.isLeftmostChild()&&"right"===a?b.parent:b.isRightmostChild()&&"left"===a?b.parent:void 0},getLeftmostTile:function(a){var c=a.get("tileArray").at(0);return c.get("type")===b.TileItem.SolveTileType.BASE_EXPONENT?c:this.getLeftmostTile(c)},getNestingOfLeftmostTile:function(a){for(var b=a.get("tileArray").at(0),c=1;null!==b.get("tileArray");)c++,b=b.get("tileArray").at(0);return c},getDroppedNode:function(a){return this.searchInTree(this.tree,a)},getDraggedNode:function(a){var b=this.tree,c=this.modelRef.getItemFromIndex(this.getParentIndex(this.source.index));return this.numOfTiles>1?this.getMarqueeNode(b,a,c,this.numOfTiles):this.searchInTree(this.tree,a)},getExponentUptoDroppedNode:function(a,b){for(var c=this.getCommonParent(a,b),d=b,e=null;!_.isEqual(d,c)&&!_.isEqual(d.parent,c);)"^"===d.parent.data&&(e=d.parent.getRightmostChild().data),d=d.parent;return e},_setDraggedExponent:function(a,b){var c=this.getExponentUptoDroppedNode(a,b),d=this.draggedTile;null!==c&&d.set("exponent",d.get("exponent")/c)},_invertLocation:function(a){var b=0,c=null;for(a instanceof Backbone.Model&&(a=[a]),b=0;b<a.length;b++)c=a[b].get("bDenominator"),a[b].setBDenominator(!c)},_invertExponent:function(a){var b=0,c=null;for(a instanceof Backbone.Model&&(a=[a]),b=0;b<a.length;b++)c=a[b].get("exponent"),c&&a[b].set("exponent",-1*c)},_getConcernedTiles:function(a){var b,c=a.get("tileArray"),d=[];for(b=0;b<this.numOfTiles;b++)d[b]=c.at(this.sourcePos+b);return d},_addOneTile:function(a){var c=b.TileItem.createTileItem,d=b.TileItem.BinTileType;this.oneTile=c({type:d.BASE_ONLY,isDraggable:!1,isDroppable:!1,base:1,ignoreMarquee:!0,operator:"*"}),a.add(this.oneTile,{at:0})}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.BuildRepositionCommand=a.BaseCommand.extend({defaults:{},source:null,dest:null,operator:null,numOfTiles:null,isLeft:null,modelRef:null,sourcePos:null,destPos:null,sourceInDenominator:null,initialize:function(){},_initializeInstanceAttributes:function(a){this.source=a.source,this.dest=a.dest,this.operator=a.operator,this.numOfTiles=a.source.numOfTiles||1,this.isLeft=a.isLeft},execute:function(a,c,d){this._initializeInstanceAttributes(d),this.modelRef=c;var e=this.source.index,f=this.dest.index,g=c.getItemFromIndex(e),h=c.getItemFromIndex(f),i=g.get("bDenominator"),j=b.CommandFactory.EXIT_CODE,k=h.get("bDenominator"),l=c.getItemFromIndex(this.getParentIndex(e)),m=c.getItemFromIndex(this.getParentIndex(f));return this.sourcePos=parseInt(this.getSourceWrtParent(e),10),this.destPos=parseInt(this.getSourceWrtParent(f),10),this.sourceParent=l,this.destParent=m,l===m&&this.sourcePos<this.destPos&&(this.destPos-=this.numOfTiles),this.isLeft||this.destPos++,l===m&&this.destPos===this.sourcePos&&i===k?j.FAILURE:this._executeReposition(l,m,c)},undo:function(a){var b=this.sourceParent,c=this.destParent,d=b.get("tileArray"),e=c.get("tileArray"),f=this.movedTiles,g=this.sourceInDenominator,h=0;for(this.removedEmptyTile&&c.add(this.removedEmptyTile,{at:this.removedEmptyTilePos}),e.remove(f),h=0;h<f.length;h++)f[h].setBDenominator(g),d.add(f[h],{at:this.sourcePos+h});this.addedTile&&b.remove(this.addedTile),this._handleUndoOperators()},_executeReposition:function(c,d,e){var f=this.source.index,g=this.dest.index,h=e.getItemFromIndex(f),i=e.getItemFromIndex(g),j=b.CommandFactory.EXIT_CODE,k=[],l=a.TileItem.SolveTileType,m=i.get("bDenominator"),n=null,o=0;if(this.sourceInDenominator=h.get("bDenominator"),k=this._getConcernedTiles(c),(n=this._checkNestedParens(e))===!0)return j.FAILURE;if(e.allOperatorsMultiplicative()){for(c.remove(k),this._updateNextTileOperator(c),o=0;o<k.length;o++)k[o].setBDenominator(m),d.add(k[o],{at:this.destPos+o});this._handleEmptyDenOrNum(c)}return this.draggedFirstOperator=k[0].get("operator"),this.isLeft?(this.droppedOperator=i.get("operator"),i.set("operator",this.operator),k[0].set("operator",this.droppedOperator)):k[0].set("operator",this.operator),i&&i.get("type")===l.BASE_EXPONENT&&i.isEmpty()&&(this.removedEmptyTilePos=d.indexOf(i),d.remove(i),this.removedEmptyTile=i),this.draggedFirst=k[0],this.movedTiles=k,this.droppedTile=i,j.SUCCESS},_handleEmptyDenOrNum:function(a){var c=null,d=a.get("tileArray");0===d.where({bDenominator:!1}).length&&a.get("type")===b.TileItem.SolveTileType.FRACTION&&(c=new b.BaseExpTile,c.set("base",null),c.set("exponent",null),c.setBDenominator(!1),d.add(c,{at:0})),0===d.where({bDenominator:!0}).length&&a.get("type")===b.TileItem.SolveTileType.FRACTION&&(c=new b.BaseExpTile,c.set("base",null),c.set("exponent",null),c.setBDenominator(!0),d.add(c)),0===d.where({bDenominator:a.get("bDenominator")}).length&&(c=new b.BaseExpTile,c.set("base",null),c.set("exponent",null),c.setBDenominator(this.sourceInDenominator),d.add(c)),this.addedTile=c},_getConcernedTiles:function(a){var b,c=a.get("tileArray"),d=[];for(b=0;b<this.numOfTiles;b++)d[b]=c.at(this.sourcePos+b);return d},_setFirstTileOperator:function(a){var b=a.at(0),c=a.where({bDenominator:!0});b.set("operator",null),c.length>0&&c[0].set("operator",null)},_handleUndoOperators:function(){void 0!==this.sourceNextOperator&&this.sourceNextTile.set("operator",this.sourceNextOperator),void 0!==this.draggedFirstOperator&&this.draggedFirst.set("operator",this.draggedFirstOperator),void 0!==this.droppedOperator&&this.droppedTile.set("operator",this.droppedOperator)},_updateNextTileOperator:function(a){var b=a.at(parseInt(this.getSourceWrtParent(this.source.index),10));b&&a.isFirstChild(b)&&(this.sourceNextOperator=b.get("operator"),b.set("operator",null)),this.sourceNextTile=b},_checkNestedParens:function(b){var c=this.source.index,d=this.dest.index,e=b.getItemFromIndex(c),f=b.getItemFromIndex(this.getParentIndex(c)),g=b.getItemFromIndex(this.getParentIndex(d)),h=a.TileItem.SolveTileType;return e.get("type")===h.PARENTHESIS&&f!==g}})}(),function(){"use strict";MathInteractives.Common.Components.Models.EquationManager.CombineCommand=MathInteractives.Common.Components.Models.EquationManager.BaseCommand.extend({defaults:{sourceObj:null,destObj:null},sourceTiles:null,destTiles:null,sourcePos:null,destPos:null,isInserted:!1,numOfTilesInserted:null,exceedingExpLimit:!1,exceedingBaseLimit:!1,oneTile:null,directConvertZero:!1,initialize:function(){this.sourceTiles=[],this.destTiles=[]},_initializeModelAttributes:function(a,b){var c,d,e=b.source.index,f=b.source.numOfTiles,g=b.dest.index,h={};for(this.set("sourceObj",b.source),this.set("destObj",b.dest),this.sourcePos=parseInt(this.getSourceWrtParent(e)),this.destPos=parseInt(this.getSourceWrtParent(g)),h.sourceParent=a.getItemFromIndex(this.getParentIndex(e)),h.destParent=a.getItemFromIndex(this.getParentIndex(g)),h.sourceParentTiles=h.sourceParent.get("tileArray"),h.destParentTiles=h.destParent.get("tileArray"),d=parseInt(e.substring(e.lastIndexOf(".")+1,e.length),10),c=0;f>c;c++)this.sourceTiles.push(h.sourceParentTiles.at(d+c));return this.destTiles[0]=a.getItemFromIndex(g),h},execute:function(a,b,c){if(b.allOperatorsMultiplicative()){var d,e=this._initializeModelAttributes(b,c),f=MathInteractives.Common.Components.Models.EquationManager,g=f.CommandFactory,h=f.CombineCommand.RETURN_VAL,i=f.TileItem.BinTileType;if(null===e.sourceParentTiles)return!1;if(d=this._performCombineOnCollection(e,a),e.sourceParent.get("type")===i.FRACTION&&e.sourceParent.isNumeratorEmpty()&&this._addOneTile(e.sourceParent),d===h.SUCCESS)return g.EXIT_CODE.SUCCESS;if(d===h.INVALID_COMBINE)return g.EXIT_CODE.FAILURE;if(d===h.NOT_SAME_PARENT)return g.EXIT_CODE.NOT_SAME_PARENT_COMBINE;if(d===h.TILE_VALUE_EXCEEDING_COMBINE)return g.EXIT_CODE.TILE_VALUE_EXCEEDING_COMBINE;if(d===h.BASE_VALUE_EXCEEDING_COMBINE)return g.EXIT_CODE.BASE_VALUE_EXCEEDING_COMBINE;if(d===h.INVALID_COMBINE_WITH_MARQUEE)return g.EXIT_CODE.INVALID_COMBINE_WITH_MARQUEE}},_addOneTile:function(a){var b=MathInteractives.Common.Components.Models.EquationManager,c=b.TileItem.createTileItem,d=b.TileItem.BinTileType;this.oneTile=c({type:d.BASE_ONLY,isDraggable:!1,base:1,ignoreMarquee:!0,isDroppable:!1}),a.add(this.oneTile,{at:0})},_fillArrayCommands:function(a){var b=[],c=MathInteractives.Common.Components.Models.EquationManager.EquationComponent.Operations;return this.directConvertZero=a&c.ZERO_EXP_DIRECT_CONVERT,b[0]=a&c.MARQUEE_SELECT_AND_COMBINE,b[1]=a&c.COMBINE_SAME_BASE,b[2]=a&c.DIVIDE_EQUAL_TERMS_HAVING_BASE_EXP_1_BASE_EXP_ANY,b[3]=a&c.DIVIDE_SIMILAR_TERMS_WITH_SAME_EXP,b[4]=a&c.PRIME_TO_COMPOSITE_EXP_ANY,b},_isSameParent:function(a,b){return a===b?!0:!1},_removeSourceDestInsertClone:function(a,b,c){c.set("operator","*"),this._changeSourceDestPos(),a.remove(this.sourceTiles),b.remove(this.destTiles),b.add(c,{at:this.destPos}),this.isInserted=!0,this.numOfTilesInserted=1},_changeSourceDestPos:function(){this.sourcePos<this.destPos&&(this.destPos-=this.sourceTiles.length)},_checkLimitingCondition:function(a){return Math.abs(a)>99?!1:!0;
},_isBaseExp:function(a){var b,c,d=MathInteractives.Common.Components.Models.EquationManager.TileItem.SolveTileType;for(b=0;b<a.length;b++)if(c=a[b].get("type"),c!==d.BASE_EXPONENT&&c!==d.BASE_ONLY)return!1;return!0},makeTileBaseExp:function(a){var b,c=MathInteractives.Common.Components.Models.EquationManager,d=c.TileItem.createTileItem,e=MathInteractives.Common.Components.Models.EquationManager.TileItem.SolveTileType,f=c.TileItem.BinTileType;return b=a.get("type"),b===e.BASE_ONLY&&(a=d({type:f.BASE_EXPONENT,base:a.get("base"),exponent:1,bDenominator:a.get("bDenominator")})),a},_performCombineOnCollection:function(a,b){var c,d,e=a.sourceParentTiles,f=a.destParentTiles,g=b.allowedOperation,h=this._fillArrayCommands(g),i=MathInteractives.Common.Components.Models.EquationManager.CombineCommand.RETURN_VAL,j=!1;if(0===this.sourceTiles.length||null==this.sourceTiles[0]||0===this.destTiles.length||null==this.destTiles[0])return i.INVALID_COMBINE;if(!this._isSameParent(e,f))return i.NOT_SAME_PARENT;if(!this._isBaseExp(this.sourceTiles)||!this._isBaseExp(this.destTiles))return i.NOT_SAME_PARENT;if(1===this.sourceTiles.length&&this._performCombinationForBaseOne(e,f))return i.SUCCESS;if(this.sourceTiles.length>1){if(0!==h[0]){if(this["_execute"+h[0]](e,f))return i.SUCCESS;j=!0}}else for(c=1,d=h.length;d>c;c++)if(0!==h[c]&&this["_execute"+h[c]](e,f))return i.SUCCESS;return this.exceedingExpLimit===!0?i.TILE_VALUE_EXCEEDING_COMBINE:this.exceedingBaseLimit===!0?i.BASE_VALUE_EXCEEDING_COMBINE:j?i.INVALID_COMBINE_WITH_MARQUEE:i.INVALID_COMBINE},_performCombinationForBaseOne:function(a,b){var c,d=this.sourceTiles[0],e=this.destTiles[0],f=d.get("base"),g=e.get("base"),h=this.sourceTiles[0].get("bDenominator"),i=e.get("bDenominator"),j=d.get("exponent"),k=e.get("exponent"),l=MathInteractives.Common.Components.Models.EquationManager.TileItem;return 1===f&&d.get("type")===l.SolveTileType.BASE_ONLY?(c=b.at(this.destPos).deepClone(),this._removeSourceDestInsertClone(a,b,c),this._setOperators(a,b,!1),!0):1===g&&e.get("type")===l.SolveTileType.BASE_ONLY?(c=a.at(this.sourcePos).deepClone(),h!==i&&(c.set("bDenominator",e.get("bDenominator")),c.set("exponent",-1*j)),this._removeSourceDestInsertClone(a,b,c),this._setOperators(a,b,!1),!0):-1===f&&1===Math.abs(k)&&d.get("type")===l.SolveTileType.BASE_ONLY?(c=b.at(this.destPos).deepClone(),c.set("base",-1*g),this._removeSourceDestInsertClone(a,b,c),this._setOperators(a,b,!1),!0):-1===g&&1===Math.abs(j)&&e.get("type")===l.SolveTileType.BASE_ONLY?(c=a.at(this.sourcePos).deepClone(),h!==i&&(c.set("bDenominator",e.get("bDenominator")),c.set("exponent",-1*j)),c.set("base",-1*f),this._removeSourceDestInsertClone(a,b,c),this._setOperators(a,b,!1),!0):e.get("type")===l.SolveTileType.BASE_ONLY&&d.get("type")===l.SolveTileType.BASE_ONLY?(c=b.at(this.destPos).deepClone(),c.set("base",g*f),this._removeSourceDestInsertClone(a,b,c),this._setOperators(a,b,!1),!0):!1},_execute4:function(a,b){var c,d,e,f,g,h,i=this.sourceTiles,j=this.sourceTiles[0].get("bDenominator"),k=this.destTiles[0],l=k.get("bDenominator"),m=k.get("base"),n=MathInteractives.Common.Utilities.Models.MathUtils;if(f=this._validateAndGetCumulative(i),k=this.makeTileBaseExp(k),c=k.get("exponent"),f!==!1){if(e=f.get("base"),d=f.get("exponent"),e!==m)return!1;if(g=j===l?n.addExponents(d,c):n.subExponents(c,d),this.directConvertZero&&0===g){var o=MathInteractives.Common.Components.Models.EquationManager,p=o.TileItem.createTileItem,q=o.TileItem.BinTileType;h=p({type:q.BASE_ONLY,base:1,bDenominator:l})}else{if(!this._checkLimitingCondition(g))return this.exceedingExpLimit=!0,!1;h=k.deepClone(),h.set("exponent",g)}return this._removeSourceDestInsertClone(a,b,h),this._setOperators(a,b,!1),!0}return!1},_validateAndGetCumulative:function(a){var b,c,d,e=0,f=a[0].deepClone();for(d=f.get("base"),b=0;b<a.length;b++){if(c=a[b],c.get("base")!==d)return!1;e+=null==c.get("exponent")?1:c.get("exponent")}return f.set("exponent",e),f},_execute8:function(a,b){var c,d,e,f,g=this.sourceTiles[0],h=this.destTiles[0],i=g.get("base"),j=h.get("base"),k=g.get("bDenominator"),l=h.get("bDenominator"),m=MathInteractives.Common.Utilities.Models.MathUtils;if(i!==j)return!1;if(g=this.makeTileBaseExp(g),h=this.makeTileBaseExp(h),d=g.get("exponent"),e=h.get("exponent"),f=k===l?m.addExponents(d,e):m.subExponents(e,d),this.directConvertZero&&0===f){var n=MathInteractives.Common.Components.Models.EquationManager,o=n.TileItem.createTileItem,p=n.TileItem.BinTileType;c=o({type:p.BASE_ONLY,base:1,bDenominator:l})}else{if(!this._checkLimitingCondition(f))return this.exceedingExpLimit=!0,!1;c=h.deepClone(),c.set("exponent",f)}return this._removeSourceDestInsertClone(a,b,c),this._setOperators(a,b,!1),!0},_execute128:function(a,b){var c,d,e,f,g,h=this.sourceTiles[0],i=this.destTiles[0],j=h.get("base"),k=i.get("base"),l=h.get("exponent"),m=i.get("exponent"),n=h.get("bDenominator"),o=i.get("bDenominator"),p=MathInteractives.Common.Utilities.Models.MathUtils;return n!==o&&p.isBaseCancellable(l,m,n,o)&&(1===l||1===m)?(e=Math.abs(j)>Math.abs(k)?k:j,d=Math.abs(j)>Math.abs(k)?j:k,d%e!==0?!1:(f=Math.pow(j,Math.abs(l)),g=Math.pow(k,Math.abs(m)),f!==g?!1:(c=i.deepClone(),c.set("exponent",0),c.set("base",e),this._removeSourceDestInsertClone(a,b,c),this._setOperators(a,b,!1),!0))):!1},_execute256:function(a,b){var c,d,e,f,g=this.sourceTiles[0],h=this.destTiles[0],i=g.get("base"),j=h.get("base"),k=g.get("exponent"),l=h.get("exponent"),m=g.get("bDenominator"),n=h.get("bDenominator"),o=MathInteractives.Common.Utilities.Models.MathUtils;return m!==n&&o.isBaseCancellable(k,l,m,n)?k!==l?!1:(e=Math.abs(i)>Math.abs(j)?j:i,d=Math.abs(i)>Math.abs(j)?i:j,d%e!==0?!1:(f=d/e,c=h.deepClone(),c.set("base",f),i===d&&c.set("exponent",-1*l),this._removeSourceDestInsertClone(a,b,c),this._setOperators(a,b,!1),!0)):!1},_execute512:function(a,b){var c=this.sourceTiles[0],d=this.destTiles[0],e=c.get("base"),f=d.get("base"),g=c.get("exponent"),h=d.get("exponent"),i=c.get("bDenominator"),j=d.get("bDenominator");return i!==j||e===f||g!==h?!1:this._combineDiffBases(a,b,e,f)?(this._setOperators(a,b,!1),!0):!1},_combineDiffBases:function(a,b,c,d){var e,f;return e=c*d,this._checkLimitingCondition(e)?(f=b.at(this.destPos).deepClone(),f.set("base",e),this._removeSourceDestInsertClone(a,b,f),!0):(this.exceedingBaseLimit=!0,!1)},undo:function(a){var b,c,d,e=this.get("sourceObj"),f=e.index,g=this.get("destObj"),h=g.index,i=[];if(c=this.getParentTiles(a,f),d=this.getParentTiles(a,h),this._setOperators(c,d,!0),null!==this.oneTile&&c.remove(this.oneTile),this.isInserted===!0){for(b=0;b<this.numOfTilesInserted;b++)i[b]=d.at(this.destPos+b);d.remove(i)}for(b=0;b<this.destTiles.length;b++)d.add(this.destTiles[b],{at:this.destPos+b});for(b=0;b<this.sourceTiles.length;b++)c.add(this.sourceTiles[b],{at:this.sourcePos+b});this._setOperators(c,d,!1)}},{RETURN_VAL:{TILE_VALUE_EXCEEDING_COMBINE:0,SUCCESS:1,INVALID_COMBINE:2,NOT_SAME_PARENT:3,BASE_VALUE_EXCEEDING_COMBINEL:4,INVALID_COMBINE_WITH_MARQUEE:5}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.BreakExponentCommand=a.BaseCommand.extend({source:null,base:null,exponent:null,initialize:function(){},_initializeInstanceAttributes:function(a){return this.source=a.source,this},execute:function(a,c,d){this._initializeInstanceAttributes(d);var e=(this.get("sourceIndex"),this.source.isDenominator,this.source.index),f=this.getSourceWrtParent(e),g=c.getItemFromIndex(this.getParentIndex(e)),h=(g.get("tileArray"),g.getItemFromIndex(f)),i=null,j=h.get("exponent"),k=h.get("base"),l=h.get("coefficient"),m=null;b.CommandFactory.EXIT_CODE;return i=h.get("type"),i===b.TileItem.SolveTileType.BASE_EXPONENT?m=this._breakBaseExponentTile(g,h,f):i===b.TileItem.SolveTileType.PARENTHESES&&h.areChildrenOnlyMultiplied()&&(h.hasFractionChild()?this._breakParenthesesFractionTile(g,h,f):this._breakParenthesesTile(g,h,f)),this.exponent=j,this.base=k,this.tileType=i,this.coeff=l,m},_breakBaseExponentTile:function(a,c,d){var e=a.get("tileArray"),f=c.getExponentSign(),g=parseInt(c.get("exponent"),10),h=c.get("base"),i=null,j=(c.get("bDenominator"),0),k=c.get("coefficient"),l=b.CommandFactory.EXIT_CODE;if("i"===k&&null===h&&2===g)return void this._handleIota(a,c,d);if(1===Math.abs(g)&&-1!==h&&1!==h)return l.FAILURE;if(e.remove(c),this.removedTile=c,-1===h||1===h)return this._handleOneBase(a,c,d);if(0===g)return this._handleZeroExponentTile(a,c,d);for(var m=0;m<Math.abs(g);m++)i=c.clone(),i.set("exponent",f),i.set("isAnimate",!0),parseInt(d)+m!==0&&i.set("operator","*"),e.add(i,{at:parseInt(d)+m}),this.isFirstDenominatorTile(i,a)&&i.set("operator",null),j++;return this.createdTiles=j,l.SUCCESS},_handleIota:function(a,b,c){var d=a.get("tileArray"),e=null;return d.remove(b),e=b.clone(),e.set("exponent",1),e.set("base",-1),d.add(e,{at:parseInt(c)}),this.createdTiles=1,this},_handleZeroExponentTile:function(a,c,d){var e=a.get("tileArray"),f=null,g=b.TileItem.BinTileType,h=b.TileItem.createTileItem,i=b.CommandFactory.EXIT_CODE;return f=h({type:g.BASE_ONLY}),f.set("base",1),f.set("operator",c.get("operator")),f.set("bDenominator",c.get("bDenominator")),e.add(f,{at:parseInt(d)}),this.zeroExpOperator=c.get("operator"),this.zeroExpTile=c,this.createdTiles=1,i.SUCCESS},_handleOneBase:function(a,c,d){var e=a.get("tileArray"),f=null,g=b.TileItem.BinTileType,h=b.TileItem.createTileItem,i=b.CommandFactory.EXIT_CODE;return f=h({type:g.BASE_ONLY}),-1===c.get("base")?f.set("base",Math.abs(c.get("exponent"))%2===0?1:-1):f.set("base",1),f.set("operator",c.get("operator")),f.set("bDenominator",c.get("bDenominator")),e.add(f,{at:parseInt(d)}),this.oneBaseOperator=c.get("operator"),this.oneBaseTile=c,this.createdTiles=1,i.SUCCESS},_breakParenthesesTile:function(a,b,c){var d=a.get("tileArray"),e=parseInt(b.get("exponent"),10),f=parseInt(c),g=null,h=null,i=b.get("bDenominator"),j=0;if(d.remove(b),e>0){g=b.get("tileArray");for(var k=0;e>k;k++)for(var l=0;l<g.length;l++)h=g.at(l).deepClone(),f+k!==0&&h.set("operator","*"),h.set("bDenominator",i),d.add(h,{at:f++}),this.isFirstDenominatorTile(h,a)&&h.set("operator",null),j++}else if(-1>e)for(var k=0;k<Math.abs(e);k++)h=b.deepClone(),h.set("exponent",-1),h.set("bDenominator",i),f+k!==0&&h.set("operator","*"),d.add(h,{at:f++}),this.isFirstDenominatorTile(h,a)&&h.set("operator",null),j++;else if(-1===e){g=b.get("tileArray");for(var k=0;k<g.length;k++)h=g.at(k).deepClone(),f+k!==0&&h.set("operator","*"),h.set("bDenominator",i),h.invertExponentSign(),d.add(h,{at:f++}),this.isFirstDenominatorTile(h,a)&&h.set("operator",null),j++}return this.createdTiles=j,this},_breakParenthesesFractionTile:function(a,c,d){var e=a.get("tileArray"),f=c.get("tileArray").at(0),g=f.get("tileArray"),h=f.get("tileArray").where({bDenominator:!1}),i=f.get("tileArray").where({bDenominator:!0}),j=null,k=null,l=b.TileItem.SolveTileType,m=c.get("exponent");return this.createdTiles=1,e.remove(c),j=new b.ParenthesisTile({bDenominator:!1,type:l.PARENTHESES,exponent:m}),j.get("tileArray").add(h),k=new b.ParenthesisTile({bDenominator:!0,type:l.PARENTHESES,exponent:m}),k.get("tileArray").add(i),g.remove(h),g.remove(i),g.add(j),g.add(k),e.add(f,{at:parseInt(d)}),this.exponent=m,this},undo:function(a){var c,d=this.source.index,e=this.getSourceWrtParent(d),f=parseInt(e,10),g=a.getItemFromIndex(this.getParentIndex(d)),h=g.get("tileArray"),i=g.getItemFromIndex(e),j=i.get("bDenominator"),k=b.TileItem.SolveTileType,l=this.tileType,m=this.exponent,n=this.coeff,o=this.base,p=[],q=null,r=this.createdTiles,s=null,t=[];for(q=0;r>q;q++)p.push(h.at(f+q));if(_.each(p,function(a,b,c){h.remove(a)}),l===b.TileItem.SolveTileType.BASE_EXPONENT){if(-1===o)return this._handleUndoOneBase(g,i,e),!0;if(0===m)return this._handleUndoZeroExponent(g,i,e),!0;if(null===o&&"i"===n)return this._handleUndoIota(g,i,e),!0;s=this.removedTile,h.add(s,{at:f})}else if(l===b.TileItem.SolveTileType.PARENTHESES){if(i.get("type")===b.TileItem.SolveTileType.FRACTION)return void this._undoBreakParenthesesFractionTile(g,i,e);-1>m?(s=p.pop().deepClone(),s.set("exponent",m),s.set("bDenominator",j),0!==f&&s.set("operator","*"),h.add(s,{at:f}),this.isFirstDenominatorTile(s,g)&&s.set("operator",null)):m>0?(t=_.first(p,r/Math.abs(m)),t[0].set("operator",null),c=new b.ParenthesisTile({bDenominator:j,type:k.PARENTHESES}),c.get("tileArray").add(t),c.set("exponent",m),0!==f&&c.set("operator","*"),h.add(c,{at:f}),this.isFirstDenominatorTile(c,g)&&c.set("operator",null)):(m=-1)&&(t=_.first(p,r/Math.abs(m)),t[0].set("operator",null),c=new b.ParenthesisTile({bDenominator:j,type:k.PARENTHESES}),c.get("tileArray").add(t),c.set("exponent",m),0!==f&&c.set("operator","*"),h.add(c,{at:f}),this.isFirstDenominatorTile(c,g)&&c.set("operator",null))}},_handleUndoIota:function(a,c,d){var e=null,f=this.source.isDenominator,g=this.coeff,h=this.exponent,i=b.TileItem.SolveTileType,j=a.get("tileArray");return e=new b.BaseExpTile({bDenominator:f,type:i.BASE_EXPONENT,exponent:h,coefficient:g}),j.add(e,{at:d}),this},_handleUndoZeroExponent:function(a,c,d){var e=(c.get("bDenominator"),this.base,this.exponent,b.TileItem.SolveTileType,a.where({bDenominator:!1}).length,a.get("tileArray"));return e.add(this.zeroExpTile,{at:parseInt(d)}),this},_handleUndoOneBase:function(a,b,c){var d=a.get("tileArray");return d.add(this.oneBaseTile,{at:parseInt(c)}),this},_undoBreakParenthesesFractionTile:function(a,c,d){var e=a.get("tileArray"),f=null,g=c.get("tileArray").where({bDenominator:!1}),h=c.get("tileArray").where({bDenominator:!0}),i=g[0].get("tileArray"),j=h[0].get("tileArray"),k=b.TileItem.SolveTileType,l=this.exponent;c.get("tileArray").remove(g),c.get("tileArray").remove(h),c.get("tileArray").add(i.models),c.get("tileArray").add(j.models),f=new b.ParenthesisTile({bDenominator:!1,type:k.PARENTHESES,exponent:l}),f.get("tileArray").add(c),e.add(f)},isFirstDenominatorTile:function(a,b){var c=b.get("tileArray"),d=c.findWhere({bDenominator:!0});return a===d?!0:!1}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.ApplyExponentCommand=a.BaseCommand.extend({defaults:{},source:null,sourceWrtParent:null,exponent:null,type:null,modelRef:null,oldTile:null,fractionTile:null,innerTiles:[],initialize:function(){},_initializeInstanceAttributes:function(a){return this.source=a.source,this.sourceWrtParent=parseInt(this.getSourceWrtParent(this.source.index),10),this},execute:function(c,d,e){this.modelRef=d,this._initializeInstanceAttributes(e);var f=this.source.index,g=b.TileItem.SolveTileType,h=d.getItemFromIndex(f),i=b.CommandFactory.EXIT_CODE,j=d.getItemFromIndex(this.getParentIndex(f)),k=a.ApplyExponentCommand.RETURN_VAL;switch(this.exponent=h.get("exponent"),this.type=h.at(0).get("type"),this.type){case g.FRACTION:if(this._executeFractionInParens(h,j)===k.TILE_VALUE_EXCEEDING_COMBINE)return i.TILE_VALUE_EXCEEDING_COMBINE;break;default:if(this._executeTilesInParens(h,j)===k.TILE_VALUE_EXCEEDING_COMBINE)return i.TILE_VALUE_EXCEEDING_COMBINE}return i.SUCCESS},undo:function(a){var c=b.TileItem.SolveTileType,d=a.getItemFromIndex(this.getParentIndex(this.source.index));switch(this.type){case c.FRACTION:this._undoFractionInParens(d);break;default:this._undoTilesInParens(d)}},_executeFractionInParens:function(b,c){var d=a.ApplyExponentCommand.RETURN_VAL;return this.fractionTile=b.at(0),this.oneIndices=this.fractionTile.multiplyChildExponentsBy(this.exponent),this.oneIndices===!1?d.TILE_VALUE_EXCEEDING_COMBINE:(c.remove(b),this.oldTile=b,c.add(this.fractionTile,{at:this.sourceWrtParent}),d.SUCCESS)},_executeTilesInParens:function(b,c){var d=c.indexOf(b),e=a.ApplyExponentCommand.RETURN_VAL;return this.oneIndices=b.multiplyChildExponentsBy(this.exponent),this.oneIndices===!1?e.TILE_VALUE_EXCEEDING_COMBINE:(this.innerTiles=b.get("tileArray").models,this.oldOperator=this.innerTiles[0].get("operator"),this.oldTile=b,c.remove(b),this.innerTiles[0].set("operator",b.get("operator")),c.addMultiple(this.innerTiles,d),e.SUCCESS)},_undoFractionInParens:function(a){a.remove(this.fractionTile),a.add(this.oldTile,{at:this.sourceWrtParent}),this.fractionTile.divideChildExponentsBy(1/this.exponent,this.oneIndices)},_undoTilesInParens:function(a){a.remove(this.innerTiles),this.innerTiles[0].set("operator",this.oldOperator),a.add(this.oldTile,{at:this.sourceWrtParent}),this.oldTile.divideChildExponentsBy(1/this.exponent,this.oneIndices)}},{RETURN_VAL:{TILE_VALUE_EXCEEDING_COMBINE:0,SUCCESS:1}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.ChangeSignCommand=a.BaseCommand.extend({defaults:{},source:null,initialize:function(){},_initializeInstanceAttributes:function(a){return this.source=a.source,this},execute:function(a,c,d){this._initializeInstanceAttributes(d);var e=b.CommandFactory.EXIT_CODE;return this._execute(c),e.SUCCESS},undo:function(a){this._execute(a)},invert:function(a){a.invertChildBDenominator(),a.invertExponentNonRecursive()},_execute:function(a){var b=a.getItemFromIndex(this.source.index),c=b.at(0),d=[],e=[],f=c.get("tileArray").models.slice(0);d=c.where({bDenominator:!1}),e=c.where({bDenominator:!0}),this.invert(b),c.remove(f),c.addMultiple(e,0),c.addMultiple(d,e.length),this._handleEmptyNumerator(c),this._handleOneDenominator(c)},_handleEmptyNumerator:function(a){var c=b.TileItem.createTileItem,d=b.TileItem.BinTileType;return this.oneTile?void a.remove(this.oneTile):void(a.isNumeratorEmpty()&&(this.oneTile=c({type:d.BASE_ONLY,isDraggable:!1,isDroppable:!1,base:1,ignoreMarquee:!0}),a.add(this.oneTile,{at:0})))},_handleOneDenominator:function(a){var b=(a.get("tileArray"),a.where({bDenominator:!0}));return this.denominatorOne?void a.remove(this.denominatorOne):void(1===b.length&&b[0].isOne()&&(this.denominatorOne=b[0],a.remove(this.denominatorOne)))}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.BuildRepositionIndividualTileCommand=a.BaseCommand.extend({defaults:{},_commandStack:[],initialize:function(){},_initializeInstanceAttributes:function(a){this.source=a.source,this.dest=a.dest,this.type=a.type,this.operator=a.operator,this.isLeft=a.isLeft,this.sourcePos=parseInt(this.getSourceWrtParent(this.source.index),10)},execute:function(c,d,e){var f=e.source.index,g=e.dest.index,h=b.TileItem.BinTileType,i=new a.CommandFactory.COMMANDTOCLASS.ADD_TILE_COMMAND,j=new a.CommandFactory.COMMANDTOCLASS.DELETE_TILE_COMMAND,k=d.getItemFromIndex(f),l=b.CommandFactory.EXIT_CODE,m=d.getItemFromIndex(this.getParentIndex(f)),n=d.getItemFromIndex(this.getParentIndex(g)),o=e.source.index,p=null,q=e.dest;switch(e.type){case h.BASE:e.base=k.get("base");break;case h.EXPONENT:e.exponent=k.get("exponent")}return this._handleNoOperation(d,e,m,n)===l.FAILURE?l.FAILURE:(e.source=q,(p=i.execute(c,d,e))!==l.SUCCESS?p:(this._commandStack.push(i),o=d.getIndexFromItem(k),e.source.index=o,(p=j.execute(c,d,e))!==l.SUCCESS?p:(this._commandStack.push(j),l.SUCCESS)))},undo:function(a){this._commandStack.pop().undo(a),this._commandStack.pop().undo(a)},_handleNoOperation:function(a,c,d,e){var f=c.source.index,g=c.dest.index,h=c.source.isDenominator,i=c.dest.isDenominator,j=a.getItemFromIndex(f),k=parseInt(this.getSourceWrtParent(f),10),l=parseInt(this.getSourceWrtParent(g),10),m=b.CommandFactory.EXIT_CODE,n=c.isLeft,o=b.TileItem.BinTileType;if(!(c.base&&_.isNumber(j.get("exponent"))||c.exponent&&_.isNumber(j.get("base")))&&d===e&&i===h)return l===k-1&&!n||l===k&&j.get("type")===o.BASE_EXPONENT||l===k+1&&n?m.FAILURE:void 0}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager;a.BreakBaseCommand=a.BaseCommand.extend({defaults:{source:null},sourcePos:null,numOfTiles:null,deletedTile:null,initialize:function(){},_initializeModelAttributes:function(a){this.set("source",a.source)},execute:function(b,c,d){this._initializeModelAttributes(d);var e,f,g=a.EquationComponent.Operations,h=MathInteractives.Common.Components.Models.EquationManager.CommandFactory,i=this.get("source"),j=i.index,k=b.allowedOperation,l=!0;return this.sourcePos=parseInt(this.getSourceWrtParent(j)),e=this.getParentTiles(c,j),f=e.at(this.sourcePos),f.get("type")!==a.TileItem.SolveTileType.BASE_EXPONENT?!1:(this.deletedTile=f,(k&g.BREAK_BASE_EXP_ANY)===g.BREAK_BASE_EXP_ANY&&(l=!1),(k&g.BREAK_BASE_EXP_1)!==g.BREAK_BASE_EXP_1||l!==!1&&1!==f.get("exponent")||!this._separateNegativePrimeNumber(e,f)?l===!0?h.EXIT_CODE.FAILURE:this._modifyParentArray(e,f)?h.EXIT_CODE.SUCCESS:h.EXIT_CODE.FAILURE:h.EXIT_CODE.SUCCESS)},_separateNegativePrimeNumber:function(a,b){var c=b.get("base"),d=MathInteractives.Common.Utilities.Models.MathUtils,e=[],f=[],g=null,h=0;if(1!==Math.abs(c)&&d.isPrime(c)&&c/Math.abs(c)===-1){for(e.push(-1,Math.abs(c)),this.numOfTiles=e.length,a.remove(b),h=0,g=e.length;g>h;h++)f[h]=b.deepClone(),f[h].set("base",e[h]),f[h].set("isAnimate",!0),0!=h&&f[h].set("operator","*"),a.add(f[h],{at:this.sourcePos+h});return!0}return!1},_modifyParentArray:function(a,b){var c,d,e=[],f=[],g=MathInteractives.Common.Utilities.Models.MathUtils;if(e=g.getGreatestMultiple(b.get("base")),0===e.length)return!1;for(this.numOfTiles=e.length,a.remove(b),c=0,d=e.length;d>c;c++)f[c]=b.deepClone(),f[c].set("base",e[c]),f[c].set("isAnimate",!0),0!=c&&f[c].set("operator","*"),a.add(f[c],{at:this.sourcePos+c});return!0},undo:function(b){var c,d,e,f=(a.EquationComponent.Operations,MathInteractives.Common.Utilities.Models.MathUtils,this.get("source")),g=f.index,h=this.numOfTiles,i=[],j=1;for(c=this.getParentTiles(b,g),e=0;h>e;e++)i[e]=c.at(this.sourcePos+e),j*=i[e].get("base");d=i[0].deepClone(),d.set("base",j),c.remove(i),c.add(this.deletedTile,{at:this.sourcePos})}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.AddTileCommand=a.BaseCommand.extend({defaults:{},base:null,isLeft:null,exponent:null,type:null,operator:null,numOfTiles:1,source:null,coefficient:null,addedTile:null,parentTile:null,initialize:function(){},_initializeInstanceAttributes:function(a){return this.base=a.base,this.isLeft=a.isLeft,this.exponent=a.exponent,this.type=a.type,this.operator=a.operator,this.source=a.source,this.coefficient=a.coefficient,this.numOfTiles=a.source.numOfTiles||1,this},execute:function(a,c,d){this._initializeInstanceAttributes(d);var e=this.type,f=this.base,g=this.exponent,h=b.TileItem.BinTileType,i=null,j=null,k=this.isLeft,l=b.TileItem.createTileItem,m=null,n=b.CommandFactory.EXIT_CODE,o=this.source.index,p=this.getSourceWrtParent(o),q=c.getItemFromIndex(this.getParentIndex(o)),r=q.getItemFromIndex(p),s=r.get("bDenominator"),t=this.operator;if(p=parseInt(p,10),e===h.EXPONENT||e===h.BASE||e===h.BASE_ONLY){switch(k||p++,e){case h.BASE_ONLY:m=h.BASE_ONLY;break;default:m=h.BASE_EXPONENT}i=l({exponent:g,base:f,bDenominator:s,type:m}),q.get("tileArray").add(i,{at:p}),k?(j=q.at(p+1),i.set("operator",j.get("operator")),j.set("operator",t)):0!==p&&i.set("operator",t),this.addedTile=i}else(e===h.PARENTHESIS||e===h.BIG_PARENTHESIS)&&(d.sourceTile=r,d.parentTile=q,d.sourceWrtParent=p,d.rules=a,this._handleParenthesis(e,d));return this.parentTile=q,n.SUCCESS},undo:function(a){var c=this.type,d=b.TileItem.BinTileType,e=parseInt(this.getSourceWrtParent(this.source.index),10),f=this.parentTile,g=this.addedTile,h=b.CommandFactory.EVENTS,i=null;c===d.EXPONENT||c===d.BASE?(f.remove(g),this._setFirstTileOperator(f)):(i=g.get("tileArray").models,f.remove(g),f.addMultiple(i,e),i[0].set("operator",this.operator),c===d.BIG_PARENTHESIS&&a.trigger(h.BIG_PARENTHESIS_REMOVED))},_setFirstTileOperator:function(a){var b=a.at(0),c=a.getFirstDenominatorTile();b.set("operator",null),c&&c.set("operator",null)},_handleParenthesis:function(a,c){var d=0,e=[],f=this.operator,g=c.sourceTile,h=null,i=c.parentTile,j=c.rules.allowedOperation,k=b.EquationComponent.Operations,l=g.get("bDenominator"),m=(b.TileItem.BinTileType,b.TileItem.createTileItem),n=c.sourceWrtParent;for(d=0;d<this.numOfTiles;d++)e.push(i.at(n+d));f=g.get("operator"),g.set("operator",null),h=m({bDenominator:l,type:a}),h.set("coefficient",this.coefficient),h.set("operator",f),h.set("bDenominator",l),0===(j&k.PARENTHESIS_EXP_ALL)&&h.set("exponent",1),this.operator=f,i.get("tileArray").remove(e),h.get("tileArray").add(e),i.get("tileArray").add(h,{at:n}),this.addedTile=h}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.ReplaceTileCommand=a.BaseCommand.extend({defaults:{},initialize:function(){},_initializeInstanceAttributes:function(a){return this.base=a.base||null,this.exponent=a.exponent||null,this.type=a.type,this.source=a.source,this},execute:function(a,c,d){this._initializeInstanceAttributes(d),this._setAllowedExponents(a);var e=this.type,f=this.base,g=b.CommandFactory.EXIT_CODE,h=b.TileItem.SolveTileType,i=this.exponent,j=b.TileItem.BinTileType,k=(b.TileItem.SolveTileType,this.source.index),l=c.getItemFromIndex(k);switch(e){case j.EXPONENT:if(this.oldExponent=l.get("exponent"),(l.get("type")===h.PARENTHESIS||l.get("type")===h.BIG_PARENTHESIS)&&-1===this.allowedExponents.indexOf(i))return g.OUT_OF_RANGE_EXPONENT;if(this.oldExponent===i)return g.NO_OPERATION;l.set("exponent",i);break;case j.BASE:if(this.oldBase=l.get("base"),this.oldBase===f)return g.NO_OPERATION;l.set("base",f)}return this.tile=l,g.SUCCESS},undo:function(a){var c=b.TileItem.BinTileType,d=this.tile;switch(this.type){case c.EXPONENT:d.set("exponent",this.oldExponent);break;case c.BASE:d.set("base",this.oldBase)}return!0},_setAllowedExponents:function(a){var c=b.EquationComponent.Operations;0===(a.allowedOperation&c.PARENTHESIS_EXP_ALL)?this.allowedExponents=[1]:this.allowedExponents=[-3,-2,-1,0,1,2,3,null]}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.DeleteTileCommand=a.BaseCommand.extend({defaults:{},initialize:function(){},oldOperators:[],_initializeInstanceAttributes:function(a){return this.type=a.type,this.source=a.source,this.sourceWrtParent=parseInt(this.getSourceWrtParent(a.source.index),10),this.numOfTiles=this.source.numOfTiles,this},execute:function(a,c,d){this.modelRef=c,this._initializeInstanceAttributes(d),this.oldOperators=[];var e=(this.type,b.TileItem.BinTileType),f=(b.TileItem.SolveTileType,this.source.index),g=b.CommandFactory.EXIT_CODE,h=(b.CommandFactory.EVENTS,c.getItemFromIndex(this.getParentIndex(f))),i=c.getItemFromIndex(f);switch(this.type){case e.BASE:this._deleteBase(i,h);break;case e.EXPONENT:this._deleteExponent(i,h);break;case e.PARENTHESIS:this._deleteParentheses(i,h);break;case e.BIG_PARENTHESIS:this._deleteParentheses(i,h);break;default:this._deleteTiles(h,this.numOfTiles)}return this._setFirstTileOperator(h),g.SUCCESS},undo:function(a){var c=a.getItemFromIndex(this.getParentIndex(this.source.index)),d=b.CommandFactory.EVENTS,e=b.TileItem.BinTileType;switch(this.type){case e.BASE:this._undoDeleteBase(c);break;case e.EXPONENT:this._undoDeleteExponent(c);break;case e.PARENTHESIS:this._undoDeleteParentheses(c);break;case e.BIG_PARENTHESIS:this._undoDeleteParentheses(c),a.trigger(d.BIG_PARENTHESIS_ADDED);break;default:this._undoDeleteTiles(c)}return!0},_deleteTiles:function(c,d){var e=[],f=this.sourceWrtParent,g=null,h=c.get("type"),i=[],j=a.TileItem.BinTileType,k=null,l=0;for(l=0;d>l;l++)e.push(c.at(f+l));c.remove(e),g=e[0].get("bDenominator"),i=c.where({bDenominator:g}),1===i.length&&h===j.EQUATION_COMPONENT||0===i.length&&h!==j.EQUATION_COMPONENT?(this.emptyTile1=new b.BaseExpTile({bDenominator:g}),k=h===j.EQUATION_COMPONENT?"*":null,this.emptyTile1.set("operator",k),c.add(this.emptyTile1,{at:f})):0===i.length&&h===j.EQUATION_COMPONENT?(this.emptyTile1=new b.BaseExpTile({bDenominator:g}),c.add(this.emptyTile1,{at:f}),this.emptyTile2=new b.BaseExpTile({bDenominator:g,operator:"*"}),c.add(this.emptyTile2,{at:f+1})):(this.nextTile=c.at(f),this.nextTile&&(this.nextOperator=this.nextTile.get("operator"))),this.tiles=e},_deleteBase:function(a,b){a.get("exponent")?(this.base=a.get("base"),a.set("base",null)):this.isNotAlone(b,a)?(this.tile=a,b.remove(a)):(this.base=a.get("base"),a.set("base",null))},_deleteExponent:function(a,b){a.get("base")||a.get("tileArray")?(this.exponent=a.get("exponent"),a.set("exponent",null)):this.isNotAlone(b,a)?(this.tile=a,b.remove(a)):(this.exponent=a.get("exponent"),a.set("exponent",null))},_deleteParentheses:function(a,b){var c=a.get("tileArray"),d=b.indexOf(a),e=null;c&&(e=c.models,b.remove(a),b.addMultiple(e,d),this.operator=a.get("operator"),this.oldOperators.push([e[0],e[0].get("operator")]),e[0].set("operator",this.operator),this.tile=a,e[0].isEmpty()&&this.isNotAlone(b,e[0])&&(b.remove(e[0]),this.entireTileDeleted=!0))},_undoDeleteBase:function(a){if(this.tile)a.add(this.tile,{at:this.sourceWrtParent}),a.isFirstChild(this.tile)&&a.at(this.sourceWrtParent+1).set("operator",this.operator);else{var b=this.modelRef.getItemFromIndex(this.source.index);b.set("base",this.base)}},_undoDeleteExponent:function(a){if(this.tile)a.add(this.tile,{at:this.sourceWrtParent}),a.isFirstChild(this.tile)&&a.at(this.sourceWrtParent+1).set("operator",this.operator);else{var b=this.modelRef.getItemFromIndex(this.source.index);b.set("exponent",this.exponent)}},_undoDeleteParentheses:function(a){var b=this.sourceWrtParent;this.entireTileDeleted||a.remove(this.tile.get("tileArray").models),a.add(this.tile,{at:b}),this._undoOldOperators()},_undoDeleteTiles:function(a){a.addMultiple(this.tiles,this.sourceWrtParent),this.nextTile&&this.nextTile.set("operator",this.nextOperator),this.emptyTile1&&a.remove(this.emptyTile1),this.emptyTile2&&a.remove(this.emptyTile2)},_setFirstTileOperator:function(a){var b=a.at(0),c=this.oldOperators,d=b.get("operator"),e=a.where({bDenominator:!0});this.operator=d,c.push([b,d]),b.set("operator",null),e.length>0&&(d||(this.operator=e[0].get("operator")),c.push([e[0],e[0].get("operator")]),e[0].set("operator",null))},_undoOldOperators:function(){var a=this.oldOperators,b=0;for(b=0;b<a.length;b++)a[b][0].set("operator",a[b][1])}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.SwapTileCommand=a.BaseCommand.extend({defaults:{},initialize:function(){},_initializeInstanceAttributes:function(a){this.source=a.source,this.dest=a.dest,this.type=a.type},execute:function(a,b,c){return this._initializeInstanceAttributes(c),this._setAllowedExponents(a),this.swap(b)},undo:function(a){var c=this.source.index,d=(this.dest.index,this.type),e=b.CommandFactory.EXIT_CODE,f=a.getItemFromIndex(this.getParentIndex(c)),g=this.destTile,h=parseInt(this.getSourceWrtParent(this.source.index),10),i=b.TileItem.BinTileType;if(!this.removedTile)return this.swap(a),e.SUCCESS;switch(d){case i.EXPONENT:this._undoExponentSwap(f,g,h);break;case i.BASE:this._undoBaseSwap(f,g,h)}},swap:function(a){var c=this.source.index,d=this.dest.index,e=this.type,f=a.getItemFromIndex(c),g=a.getItemFromIndex(this.getParentIndex(c)),h=a.getItemFromIndex(d),i=b.TileItem.BinTileType;switch(this.destTile=h,e){case i.EXPONENT:return this._handleExponentSwap(g,f,h);case i.BASE:return this._handleBaseSwap(g,f,h)}},_handleExponentSwap:function(a,c,d){var e=c.get("exponent"),f=MathInteractives.Common.Components.Models.EquationManager.CommandFactory.EXIT_CODE,g=d.get("exponent");return(d.get("type")!==b.TileItem.SolveTileType.PARENTHESIS&&d.get("type")!==b.TileItem.SolveTileType.BIG_PARENTHESIS||-1!==this.allowedExponents.indexOf(e))&&(c.get("type")!==b.TileItem.SolveTileType.PARENTHESIS&&c.get("type")!==b.TileItem.SolveTileType.BIG_PARENTHESIS||-1!==this.allowedExponents.indexOf(g))?g===e?(c.trigger("change:exponent",c,e),
f.NO_OPERATION):(c.set("exponent",g),d.set("exponent",e),this._handleEmptyTile(a,c),f.SUCCESS):f.OUT_OF_RANGE_EXPONENT},_handleBaseSwap:function(a,b,c){var d=b.get("base"),e=MathInteractives.Common.Components.Models.EquationManager.CommandFactory.EXIT_CODE,f=c.get("base");return f===d?(b.trigger("change:base",b,d),e.NO_OPERATION):(b.set("base",f),c.set("base",d),this._handleEmptyTile(a,b),e.SUCCESS)},_handleEmptyTile:function(a,c){var d=null,e=b.TileItem.BinTileType;c.get("type")===e.BASE_EXPONENT&&c.isEmpty()&&this.isNotAlone(a,c)&&(this.removedTile=c,a.isFirstChild(c)&&(d=a.nextTile(c),d.get("bDenominator")===c.get("bDenominator")&&(this.removedOperator=d.get("operator"),d.set("operator",null),this.nextTile=d)),a.remove(c))},_undoExponentSwap:function(a,b,c){var d=b.get("exponent");b.set("exponent",null),this.removedTile&&(a.add(this.removedTile,{at:c}),this.removedTile.set("exponent",d)),this._undoEmptyTile()},_undoBaseSwap:function(a,b,c){var d=b.get("base");b.set("base",null),this.removedTile&&(a.add(this.removedTile,{at:c}),this.removedTile.set("base",d)),this._undoEmptyTile()},_undoEmptyTile:function(){this.removedOperator&&this.nextTile.set("operator",this.removedOperator)},_setAllowedExponents:function(a){var c=b.EquationComponent.Operations;0===(a.allowedOperation&c.PARENTHESIS_EXP_ALL)?this.allowedExponents=[1]:this.allowedExponents=[-3,-2,-1,0,1,2,3,null]}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.ShiftParenthesesCommand=a.BaseCommand.extend({defaults:{},_commandStack:[],initialize:function(){},execute:function(c,d,e){var f=new a.CommandFactory.COMMANDTOCLASS.ADD_TILE_COMMAND,g=new a.CommandFactory.COMMANDTOCLASS.DELETE_TILE_COMMAND,h=d.getItemFromIndex(e.source.index),i=b.CommandFactory.EXIT_CODE,j=h.get("coefficient"),k=e.source,l=e.dest;return e.type=a.TileItem.BinTileType.PARENTHESIS,e.source=l,e.coefficient=j,f.execute(c,d,e)?(this._commandStack.push(f),e.source=k,g.execute(c,d,e)?(this._commandStack.push(g),i.SUCCESS):i.FAILURE):i.FAILURE},undo:function(a){this._commandStack.pop().undo(a),this._commandStack.pop().undo(a)}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager;a.CommandFactory=MathInteractives.Common.Player.Models.Base.extend({defaults:{modelRef:null,allowedOperation:null,maxPrimeLimit:null,undoStack:null},initialize:function(){this.set("undoStack",[])},setData:function(a){this.set("modelRef",a.modelRef),this.set("allowedOperation",a.allowedOperation),this.set("maxPrimeLimit",a.maxPrimeLimit)},resetData:function(){this.set("modelRef",null),this.set("allowedOperation",null),this.set("maxPrimeLimit",null),this.resetUndoStack()},resetUndoStack:function(){this.set("undoStack",[])},fireCommand:function(){var b,c,d,e,f,g;b=new a.CommandFactory.TileLocation("0.1",!0,3),c=new a.CommandFactory.TileLocation("0.0",!0,1),d={source:b,dest:c},f=new a.CommandFactory.Rules(this.get("allowedOperation"),this.get("maxPrimeLimit")),g=new a.CombineCommand,e=g.execute(f,this.get("modelRef"),d),g.undo(this.get("modelRef"))},execute:function(b,c,d){var e=new a.CommandFactory.COMMANDTOCLASS[b],f=a.CommandFactory.EXIT_CODE,g=null;return(g=e.execute(c,this.get("modelRef"),d))!==f.SUCCESS?g:(this.get("undoStack").push(e),g)},undo:function(){var a=this.get("undoStack").pop();a&&a.undo(this.get("modelRef"))},getIfOperationAllowed:function(){var b=a.EquationComponent.Operations;return(this.get("allowedOperation")&b.BREAK_BASE_EXP_1)!==b.BREAK_BASE_EXP_1?!1:!0}},{SEPARATOR:".",COMMANDS:{REPOSITION:"REPOSITION_COMMAND",COMBINE:"COMBINE_COMMAND",BREAK_BASE:"BREAK_BASE_COMMAND",BREAK_EXPONENT:"BREAK_EXPONENT_COMMAND",ADD_TILE:"ADD_TILE_COMMAND",DELETE_TILE:"DELETE_TILE_COMMAND",REPLACE_TILE:"REPLACE_TILE_COMMAND",SWAP_TILE:"SWAP_TILE_COMMAND",BUILD_REPOSITION_INDIVIDUAL_TILE:"BUILD_REPOSITION_INDIVIDUAL_TILE_COMMAND",BUILD_REPOSITION:"BUILD_REPOSITION_COMMAND",SHIFT_PARENTHESES:"SHIFT_PARENTHESES_COMMAND",APPLY_EXPONENT:"APPLY_EXPONENT_COMMAND",CHANGE_SIGN:"CHANGE_SIGN_COMMAND"},COMMANDTOCLASS:{REPOSITION_COMMAND:a.RepositionCommand,COMBINE_COMMAND:a.CombineCommand,BREAK_BASE_COMMAND:a.BreakBaseCommand,BREAK_EXPONENT_COMMAND:a.BreakExponentCommand,ADD_TILE_COMMAND:a.AddTileCommand,DELETE_TILE_COMMAND:a.DeleteTileCommand,REPLACE_TILE_COMMAND:a.ReplaceTileCommand,SWAP_TILE_COMMAND:a.SwapTileCommand,BUILD_REPOSITION_INDIVIDUAL_TILE_COMMAND:a.BuildRepositionIndividualTileCommand,BUILD_REPOSITION_COMMAND:a.BuildRepositionCommand,SHIFT_PARENTHESES_COMMAND:a.ShiftParenthesesCommand,APPLY_EXPONENT_COMMAND:a.ApplyExponentCommand,CHANGE_SIGN_COMMAND:a.ChangeSignCommand},EXIT_CODE:{FAILURE:0,SUCCESS:1,OUT_OF_RANGE_EXPONENT:2,NO_OPERATION:3,NOT_SAME_PARENT_COMBINE:4,TILE_VALUE_EXCEEDING_COMBINE:5,BASE_VALUE_EXCEEDING_COMBINE:6,INVALID_COMBINE_WITH_MARQUEE:7},Rules:function(a,b){this.allowedOperation=a,this.primeNumberLimit=b},TileLocation:function(a,b,c){this.index=a,this.numOfTiles=c,this.isDenominator=b},EVENTS:{BIG_PARENTHESIS_ADDED:"big-parenthesis-added",BIG_PARENTHESIS_REMOVED:"big-parenthesis-removed"}})}(),function(a){"use strict";var b=a.Common.Components.Models.EquationManager;b.EquationManager=a.Common.Player.Models.Base.extend({defaults:{allowedOperation:4095,allowManagerLevelOperations:8191,maxPrimeLimit:9,tutorialLessons:null,tutorialMode:!0,currentTutorialLessonNumber:0,mode:null,buildModeParenthesisSize:null,equationLatexStack:[],numOfTilesInNumDen:null,currentAccView:null}},{MODES:{BuildMode:0,SolveMode:1},OPERATION:{REPOSITION_TILE:1,CLICK_EXP:2,MARQUEE_SELECT_AND_COMBINE:4,COMBINE_SAME_BASE:8,ZERO_EXP:16,DIVIDE_EQUAL_TERMS_HAVING_BASE_EXP_1_BASE_EXP_ANY:32,DIVIDE_SIMILAR_TERMS_WITH_SAME_EXP:64,PRIME_TO_COMPOSITE_EXP_ANY:128,COMPOSITE_TO_PRIME:256,BREAK_BASE:512}})}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager,c=MathInteractives.Common.Utilities.Models.Rect,d=(MathInteractives.Common.Utilities.Models.Point,MathInteractives.Common.Utilities.Models.BrowserCheck);a.EquationManager=MathInteractives.Common.Player.Views.Base.extend({equationView:null,commandFactory:null,marqueeSelectedItemsIndex:[],marqueeSelectedItems:[],parenthesisExponentTooltips:[],applyExponentBtnViews:[],changeSignBtnViews:[],counter:0,arrCounter:[],marqueeDir:null,timerId:null,_lstTutorialTargetViewIndex:[],_tutorialMarqueeFirstElementIndex:null,_tutorialMarqueeLastElementIndex:null,currentHoveredTile:null,isDragging:null,isPosParensEnabled:!0,isNegParensEnabled:!0,_isDropped:!1,getIsDropped:function(){return this._isDropped},setIsDropped:function(a){this._isDropped=a},$draggableContainment:null,$equationContainer:null,$overlayDiv:null,_strDroppables:null,setDroppables:function(a){a!==this._strDroppables&&(this._strDroppables=a,this.onDroppablesChange())},getIdPrefix:function(){return this.idPrefix},_tutorialMode:!1,tileSelected:null,selectedTile:null,accTutSourceData:{},accTutDestData:{},animationOn:!1,isSpaceKeyAllowed:!0,marqueeExponents:[],_isTouch:null,_isAcc:!0,isAcc:function(){return this._isAcc},setIsAcc:function(a){this._isAcc=a},setCurrentAccView:function(a){this.model.set("currentAccView",a)},getCurrentAccView:function(){return this.model.get("currentAccView")},isTouch:function(){return null===this._isTouch&&this._setIsTouch(),this._isTouch},initialize:function(){this.initializeDefaultProperties();this.model;this.parent=this.options.parent,void 0!==this.options.tutorialMode&&null!==this.options.tutorialMode&&(this._tutorialMode=this.options.tutorialMode),void 0!==this.options.idPrefix&&null!==this.options.idPrefix&&(this.idPrefix=this.options.idPrefix),this.options.strDroppables?this._strDroppables=this.options.strDroppables:this._strDroppables="*",this.options.draggableContainment&&(this.$draggableContainment=this.options.draggableContainment),this.setElement(this.options.element),this.$equationContainer=this.$el.find(".equation-container"),this.$overlayDiv=this.$el.find(".overlay-div"),this.showHideOverlayDiv(!1),this.player=this.options.player,this.filePath=this.options.filePath,this.manager=this.options.manager,this.setIsAcc(this.isAccessible()),this.marqueeContainer=this.options.marqueeDiv||this.$equationContainer||this.$el,this.marqueeView=this._generateMarquee(),this.createCommandFactory({}),$.support.touch||this.createContextMenu(),this.$el.attr("tabindex",-1),this.el.focus()},_setIsTouch:function(){var a=MathInteractives.Common.Utilities.Models.BrowserCheck;this._isTouch=a.isAndroid||a.isIOS},createCommandFactory:function(a){a=a||{},this.commandFactory=new b.CommandFactory(a)},render:function(){this.equationView.createView(),this._attachEvents(),this._tutorialMode||(this.unloadScreen("expression-text"),this.loadScreen("expression-text")),$.support.touch||(this.model.set("currentAccView",null),this.attachAccessibilityEvents())},createContextMenu:function(){var a=MathInteractives.Common.Interactivities.ExponentAccordion.Views.DerivedContextMenu;this.tileCtxMenu=a.initContextMenu({el:this.player.$el,prefix:this.idPrefix,elements:[],screenId:"em-tile-context-menu",contextMenuCount:10,manager:this.manager,thisView:this}),this.listenTo(this.model,"change:currentAccView",this.currentAccViewChangeHandler)},setFocusToNumerator:function(a,b){var c;b?(c=this.equationView,this.model.set("currentAccView",c),c.buildStartAcc()):(c=this.equationView.getViewFromIndex(a),this.model.set("currentAccView",c),c.startAccNumerator())},dropBinTileUsingContextMenu:function(a,b,c,d){var e;d?(e=this.equationView.getViewFromIndex(a),this.model.set("currentAccView",e),e.spaceToDropTile(!0)):b?(e=this.equationView,this.model.set("currentAccView",e),e.spaceToDropTile(!0)):(e=this.equationView.getViewFromIndex(a),this.model.set("currentAccView",e),e.spaceToDropTile(!0,c))},attachAccessibilityEvents:function(){var b,c=this;this.$el.off("keydown.mine").on("keydown.mine",function(d){var e=d.keyCode?d.keyCode:d.charCode;c.animationOn||"block"===$("#"+c.idPrefix+"animation-progress-div").css("display")||(c._tutorialMode?9===e&&d.shiftKey!==!0?(d.preventDefault(),null==c.tileSelected&&(c.getCurrentAccView()&&c.getCurrentAccView().removeAccDiv(),c.setFocus("solve-mode-replay-btn"))):9===e&&d.shiftKey===!0?(d.preventDefault(),null==c.tileSelected&&(c.getCurrentAccView()&&c.getCurrentAccView().removeAccDiv(),c.setFocus("main-activity-area-container"))):32===e?(d.preventDefault(),c.$el.trigger("mousedown").trigger("mouseup").trigger("click"),c.isSpaceKeyAllowed&&(c.isSpaceKeyAllowed=!1,c.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),c.equationView.tutorialSpacePressed(c.getCurrentAccView(),c.accTutSourceData,c.accTutDestData))):27===e&&(d.preventDefault(),c.isMarqueeSelectedForOp?(c.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),c.getCurrentAccView().removeAccDiv(),c.isMarqueeSelectedForOp=!1,c.tileSelected=null,c.setCurrentAccView(c.marqueeSelectedItems[0]),c.marqueeView.focusAcc()):c.tileSelected?(c.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),b=c.tileSelected,c.getCurrentAccView().removeAccDiv(),c.tileSelected=null,b.startAcc()):(c.getCurrentAccView()&&c.getCurrentAccView().removeAccDiv(),c.equationView.startAcc())):(9===e&&d.shiftKey!==!0?(d.preventDefault(),null===c.getCurrentAccView()?c.equationView.startAcc():c.equationView.continueAcc(c.getCurrentAccView())):9===e&&d.shiftKey===!0&&(d.preventDefault(),c.equationView.goPreviousAcc(c.getCurrentAccView())),32===e&&0===c.marqueeSelectedItems.length&&(d.preventDefault(),c.$el.trigger("mousedown").trigger("mouseup").trigger("click"),c.isSpaceKeyAllowed&&(c.isSpaceKeyAllowed=!1,c.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),c.equationView.spacePressed(c.getCurrentAccView()))),27===e&&(d.preventDefault(),c.isMarqueeSelectedForOp?(c.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),c.getCurrentAccView().removeAccDiv(),c.isMarqueeSelectedForOp=!1,c.tileSelected=null,c.setCurrentAccView(c.marqueeSelectedItems[0]),c.marqueeView.focusAcc()):c.tileSelected?(c.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),b=c.tileSelected,c.getCurrentAccView().removeAccDiv(),c.tileSelected=null,b.startAcc()):(c.getCurrentAccView()&&c.getCurrentAccView().removeAccDiv(),c.equationView.startAcc()))))}),this.$el.off("keyup.mine").on("keyup.mine",function(a){var b=a.keyCode?a.keyCode:a.charCode;32===b&&(c.isSpaceKeyAllowed=!0)}),this.player.$el.off("mousedown.mine").on("mousedown.mine",function(a){c.getCurrentAccView()&&a.which})},getContainerToAppend:function(){return this.$(".workspace-expression-area")},getLeftOffsetEquationView:function(){if(this._tutorialMode){var a=this.equationView.arrTileViews[0].model.get("type");return a===b.TileItem.SolveTileType.BASE_EXPONENT||a===b.TileItem.SolveTileType.BASE_ONLY?{left:4,width:-16}:{left:5,width:7}}return"function"==typeof this.getLeftOffsetEV?this.getLeftOffsetEV():{left:2,width:0}},accCombineOnFraction:function(a){var c=b.TileItem.BinTileType,d=this.equationView.getViewFromIndex("0"),e=d.model.get("type");this._tutorialMode?this.accTutDestData.sourceView.startAcc():(e===c.BIG_PARENTHESIS?d=this.equationView.getViewFromIndex("0.0"):e!==c.FRACTION&&(d=this.equationView),a===!1?d.arrTileViews[0].startAcc(!0):d.getNextDenoTileAcc())},events:{keydown:"keydownHandler"},setData:function(b,c){this.resetData();var d=MathInteractives.Common.Components.Models.EquationManager,e=new d.EquationComponent(b.equationData),f=null,g=null,h=null;if(this.equationView=new a.EquationView({model:e,equationManager:this,player:b.player,filePath:b.filePath,manager:b.manager,idPrefix:b.idPrefix}),c!==!0&&(this._tutorialMode||(f=this.equationView.model.getEquationInLatexForm(),this.model.get("equationLatexStack").push(f),g=this.equationView.getTileContentInHtmlForm(),h=this.equationView.getAccString(a.EquationManager.DATA),this.trigger(a.EquationManager.EVENTS.NEW_EXPRESSION_START,{equationHtml:g,equationAccString:h}))),!b.equationViewContainer)throw new Error("Provide EquationView container");this.equationView.setEquationContainer(b.equationViewContainer);var i={modelRef:this.equationView.model,allowedOperation:b.cmdFactoryData.allowedOperation||this.model.get("allowedOperation"),maxPrimeLimit:b.cmdFactoryData.maxPrimeLimit||this.model.get("maxPrimeLimit")};this.commandFactory.setData(i)},resetData:function(){this.equationView&&(this.equationView.reset(),this.equationView=null),this.marqueeSelectedItemsIndex=[],this.marqueeSelectedItems=[],this.commandFactory.resetData(),this._removeAllTooltips(),this.model.set("currentAccView",null),this.tileSelected=null,this.selectedTile=null},refresh:function(){this.equationView&&this.equationView.refresh()},enableDroppableEquationView:function(a){this.equationView.attachDettachDroppable(a)},_generateMarquee:function(){if(this.player){var b=MathInteractives.Common.Components.Views.EquationManager.Marquee,c=b.createMarquee({idPrefix:this.idPrefix,manager:this.manager,filePath:this.filePath,player:this.player,equationManager:this,marqueeContainer:this.marqueeContainer,selectorClass:a.EquationManager.TILE_DUMMY_CLASS});return this.listenTo(c,b.EVENTS.start,this._marqueeStartHandler),this.listenTo(c,b.EVENTS.ChangeSelectorClass,this._changeSelectorClass),this.listenTo(c,b.EVENTS.end,this._onMarqueeDrawn),c.disableMarquee(),c}},_onMarqueeDrawn:function(b,c,d){this.marqueeSelectedItems;this._groupSelectedTileItems(b.optionalParams.$marquee),this._hideMarqueeSelectedItems(),this._isInvalidMarqueeForTutorial()?(this.marqueeView.marqueeContainerMouseDownHandler(b.originalEvent),this.marqueeView.marqueeMouseUpHandler(b.originalEvent,!1,!0)):(this.$(".fake-marquee").remove(),this.trigger(a.EquationManager.EVENTS.MARQUEE_DRAWN),this.allEmptyInMarquee()&&this.removeMarquee())},_changeSelectorClass:function(b,c){0===this.$el.find(".current-draggable").length&&(this._marqueeEndHandler(b,c),this.marqueeSelectedItems=this._validateMarqueeItems(this.marqueeSelectedItems,b)||[],this.marqueeView.model.set("selectorClass",a.EquationManager.TILE_CLASS))},_marqueeStartHandler:function(b){this.trigger(a.EquationManager.EVENTS.MARQUEE_START),this._showMarqueeSelectedItems(),this.marqueeSelectedItems=[],this.marqueeSelectedItemsIndex=[],this.marqueeStartX=b.originalEvent.clientX,this.marqueeStartY=b.originalEvent.clientY;var c=this.$el.find("."+a.EquationManager.TILE_CLASS);c.removeClass(a.EquationManager.TILE_CLASS)},_marqueeEndHandler:function(a,b){this.endClientLeft=a.clientX,this.endClientTop=a.clientY;var c=(this.endClientLeft-this.startClientLeft,this.endClientTop-this.startClientTop,b),d=(this.equationView,new MathInteractives.Common.Utilities.Models.Rect(c[0].getBoundingClientRect()));d.getMiddle();a.marqueeStartX=this.marqueeStartX,a.marqueeStartY=this.marqueeStartY,this.equationView.getElementsInsideMarquee(a,c)},_hideMarqueeSelectedItems:function(){this.$(".marquee-selected").css({visibility:"hidden"})},_showMarqueeSelectedItems:function(){this.$(".marquee-selected").css({visibility:""})},allEmptyInMarquee:function(){var a=0,b=this.marqueeSelectedItems;for(a=0;a<b.length;a++)if(b[a]instanceof Backbone.View&&!b[a].model.isEmpty())return!1;return!0},_validateMarqueeItems:function(b,c){if(0!==b.length){var d=0,e=a.EquationManager.TILE_CLASS,f=[],g=this.marqueeView.model.get("ignoreClass"),h=c.clientX>c.marqueeStartX?"ltr":"rtl",i="ltr"===h?1:"rtl"===h?-1:null,j="ltr"===h?0:"rtl"===h?b.length-1:null,k=b[j].parent;for(d=j;this._validateMarqueeLoopCond(h,b,d)&&b[d].parent===k;d+=i)if(!b[d].$el.hasClass(g)&&(f.push(b[d]),b[d].$el.addClass(e),d>0&&this._addOperatorToMarquee(b[d]),!this._validAdjacentTile(h,b,d))){"rtl"===h&&this._removeOperatorFromMarquee(b[d]);break}return"ltr"===h?f:"rtl"===h?f.reverse():null}},_addOperatorToMarquee:function(b){if(b){var c=this.$(this.getOperatorViewOfTileItem(b)),d=a.EquationManager.TILE_CLASS;0!==c.length&&c.addClass(d)}},_removeOperatorFromMarquee:function(b){var c=this.$(this.getOperatorViewOfTileItem(b)),d=a.EquationManager.TILE_CLASS;0!==c.length&&c.removeClass(d)},_validAdjacentTile:function(a,b,c){return"ltr"===a?b[c+1]&&b[c+1]===b[c].getNextTile():"rtl"===a?b[c-1]&&b[c-1]===b[c].getPrevTile():void 0},_validateMarqueeLoopCond:function(a,b,c){return"ltr"===a?c<b.length:"rtl"===a?c>=0:void 0},removeFromArray:function(a,b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},_groupSelectedTileItems:function(b){var c=$("<div/>"),d=null,e=(this.marqueeSelectedItems,this.$("."+a.EquationManager.TILE_CLASS)),f=e.length;this.marqueeExponents=[],c.css({position:"absolute","z-index":0,left:"0px"}),0!==f&&(this.marqueeView.groupSelectedElements(c),this.marqueeView.makeGroupDraggable(this.marqueeSelectedItems[0],this.marqueeSelectedItemsIndex,this));for(var g=0;f>g;g++){d=$(e[g]);var h=d.clone(!1).removeClass("marquee-selected");this._saveMarqueeExponents(h),this.$el.find(".current-draggable").attr("style",""),c.append(h),h.position({my:"left top",at:"left top",of:d,collision:"none"})}},_saveMarqueeExponents:function(a){var c=b.TileItem.BinTileType,d=(this.marqueeSelectedItems,a.data("tiletype"));d===c.BASE_EXPONENT?this.marqueeExponents.push(a.find(".exponent > .exponent-value")):d===c.PARENTHESIS?this.marqueeExponents.push(a.find("> .exponent > .exponent-value")):d===c.BASE_ONLY&&this.marqueeExponents.push(null)},pushElementToSelection:function(a,b){var c,d;this.marqueeSelectedItems.push(b),c=this.marqueeSelectedItems[0].parent,d=this.marqueeSelectedItems.length,c===this.marqueeSelectedItems[d-1].parent&&this.marqueeSelectedItemsIndex.push(a)},removeMarquee:function(){this._showMarqueeSelectedItems(),this.marqueeSelectedItems=[],this.marqueeView.$marqueeDiv.empty(),this.marqueeView.collapseMarquee(),this.trigger(a.EquationManager.EVENTS.MARQUEE_REMOVED)},isTileViewInsideMarquee:function(a){var b,c=this.marqueeSelectedItems,d=0;if(-1!==c.indexOf(a))return!0;for(;d<c.length;d++)if(b=c[d],b instanceof Backbone.View&&b.hasChildView(a,!0))return!0;return!1},isTileViewInsideMarqueeFixed:function(a){var b=this.getAllMarqueeViews();return b.indexOf(a)>-1},getAllMarqueeViews:function(){var a=[],b=0;for(b=0;b<this.marqueeSelectedItems.length;b++)Array.prototype.push.apply(a,this.marqueeSelectedItems[b].getChildViews());return a},getAllBaseViews:function(a){var c=[],d=b.TileItem.BinTileType;return Array.prototype.push.apply(c,this.equationView.getChildViews()),_.filter(c,function(b){return b.model.get("type")===d.BASE_EXPONENT||b.model.get("type")===d.BASE_ONLY?void 0===a?!0:b.model.get("bDenominator")===a:!1})},getOperatorViewOfTileItem:function(a){var b=a.parent.getOperatorFromTileItem(a);return b},getBuildModeParenthesisSize:function(){return this.model.get("buildModeParenthesisSize")},_removeAllTooltips:function(){var a=0;for(a=0;a<this.parenthesisExponentTooltips.length;a++)this.parenthesisExponentTooltips[a].remove(),this.parenthesisExponentTooltips[a].$el.remove(),this.applyExponentBtnViews[a].remove(),this.applyExponentBtnViews[a].$el.off().remove(),this.changeSignBtnViews.length&&(this.changeSignBtnViews[a].remove(),this.changeSignBtnViews[a].$el.off().remove());this.arrCounter=[],this.parenthesisExponentTooltips=[],this.applyExponentBtnViews=[],this.changeSignBtnViews=[],this.counter=0},adjustContainment:function(a){if(this.model.get("adjustContainment")&&this.$draggableContainment){var b=a instanceof c?a.getWidth():a.outerWidth(),d=6,e=b/2+d,f=this.$equationContainer.width();this.$draggableContainment.css({width:f+2*e,left:-e}),this.$equationContainer.css("max-width",f)}},resetContainment:function(){this.model.get("adjustContainment")&&this.$draggableContainment&&(this.$draggableContainment.css({width:"",left:""}),this.$equationContainer.css("max-width",""))},showHideOverlayDiv:function(a){a?this.$overlayDiv&&this.$overlayDiv.show():this.$overlayDiv&&this.$overlayDiv.hide()},registerMouseOverTile:function(a,b,c){this.currentHoveredTile&&this.currentHoveredTile!==a&&this.currentHoveredTile.onMouseOut(b,c),this.currentHoveredTile=a,this.showHideBorder(!1)},isTileRemovable:function(b,d){var e=a.EquationManager.Operations.DELETE_TILE&this.model.get("allowManagerLevelOperations");if(e){var f=new c(this.el.getBoundingClientRect());return f.isPointInRect(d)?!1:(this.showHideBorder(!0),!0)}return!1},showHideBorder:function(a){a?this.$el.addClass("delete-border"):this.$el.removeClass("delete-border")},getCurrentEquationJSON:function(){return this.equationView?JSON.parse(JSON.stringify(this.equationView.model)):null},undo:function(){var b=this;this.$el.css("visibility","hidden"),window.clearTimeout(this.timerId),this.$(".new-created-tile").removeClass("new-created-tile"),this.commandFactory.undo(),this.removeHighlightTiles(),setTimeout(function(){b.$el.css("visibility","")},0),this._tutorialMode||(this.model.get("equationLatexStack").pop(),this.trigger(a.EquationManager.EVENTS.REMOVE_STEP))},isZeroGlowAllowed:function(){return!0},onBaseClick:function(c,d){var e,f=b.CommandFactory,g=new f.TileLocation(c.parent.getIndex(c)),d={source:g},h=a.EquationManager.EVENTS,i=c.model.get("base");this.commandFactory.getIfOperationAllowed()!==!1&&(!MathInteractives.Common.Utilities.Models.MathUtils.isPrime(i)||1!==Math.abs(i)&&i/Math.abs(i)!==1)&&(this.trigger(h.ATTEMPT_OPERATION),this._checkNumberOfTilesPermitted(c.model.get("bDenominator"))&&(this.restrictFirstTileAnimation=!0,c.$el.css({visibility:"hidden"}),e=this.fireCommand(f.COMMANDS.BREAK_BASE,d),c.$el.css({visibility:"visible"}),this._animateTiles(e)),this.removeMarquee())},onExponentClick:function(c,d,e){var f=a.EquationManager.EVENTS,g=c.model.get("base"),h=c.model.get("exponent");if(this.trigger(f.ATTEMPT_OPERATION),this.trigger(f.PARENTHESIS_EXPONENT_CLICK),e)return void this._showParenthesisTooltip(d);var i=b.CommandFactory,j=new i.TileLocation(c.parent.getIndex(c)),k={source:j};(1!==Math.abs(h)||-1===g||1===g)&&((0===h||1===Math.abs(g)||this._checkNumberOfTilesPermitted(c.model.get("bDenominator")))&&(this.restrictFirstTileAnimation=!0,c.$el.css({visibility:"hidden"}),k.sourceExp=h,this.fireCommand(i.COMMANDS.BREAK_EXPONENT,k),0!==h&&-1!==g&&1!==g&&this._animateTiles(!0)),this.removeMarquee())},_animateTiles:function(b){if(b){var c,d=(this.firstTile.offset().left,this),e=this.$(".animated-tiles"),f=a.EquationManager.EVENTS;e.position({my:"left top",at:"left top",of:this.firstTile,collision:"none"}),e.css({visibility:"",opacity:0}),this.trigger(f.FANNING_ANIMATION_START),c=this._tutorialMode?.5:1,e.animate({left:0,opacity:c},1e3,_.once($.proxy(d.tilesAnimationComplete,d)))}},tilesAnimationComplete:function(){var a=this;setTimeout(function(){a.$(".animated-tiles").css({left:"",opacity:""}).removeClass("animated-tiles"),a.$(".invisible-operators").css({visibility:"",opacity:0}).animate({opacity:1},150,_.once($.proxy(a.operatorsAnimationComplete,a)))},100)},operatorsAnimationComplete:function(){var b=this,c=a.EquationManager.EVENTS;setTimeout(function(){b.$(".invisible-operators").css({opacity:""}).removeClass("invisible-operators"),b.$(".disabled_operator").css({opacity:""}),b.trigger(c.FANNING_ANIMATION_END)},100)},repositionBorderAdded:function(a){this._tutorialMode&&a.removeClass("white-border-left white-border white-border-right")},onAddTile:function(c){var d,e,f,g,h,i,j,k=a.EquationManager.Operations.ADD_TILE_TO_CANVAS&&this.model.get("allowManagerLevelOperations"),l=a.EquationManager.EVENTS;if(this.trigger(l.ATTEMPT_OPERATION),k){if(!this._isValidDropElementForTutorial(c))return!1;d=b.CommandFactory,e=new d.TileLocation(c.index,c.isDestDeno),f=c.sourceTile,g=f.data(),h=g.tiletype,i=b.TileItem.BinTileType,j={},j.source=e,j.type=h,j.isLeft=c.isLeft,j.operator=c.operator,h===i.BASE?j.base=g.tilevalue:h===i.EXPONENT?j.exponent=g.tilevalue:h===i.PARENTHESIS&&(j.coefficient=g.tilevalue),this.fireCommand(d.COMMANDS.ADD_TILE,j),this.removeMarquee(),this.getEquationStatusModifyBin()}},onDeleteTile:function(c){var d=a.EquationManager.EVENTS;if(this.trigger(d.ATTEMPT_OPERATION),!this._isValidDropElementForTutorial(c))return!1;var e=a.EquationManager.Operations.DELETE_TILE&&this.model.get("allowManagerLevelOperations");if(e){var f=b.CommandFactory,g=c.sourceTile,h=new f.TileLocation(g.parent.getIndex(g),g.model.get("bDenominator"),c.numOfTiles),i={};this.removeMarquee(),i.source=h,i.type=c.tiletype,this.fireCommand(f.COMMANDS.DELETE_TILE,i),this.getEquationStatusModifyBin()}},onRepositionTile:function(c){var d=a.EquationManager.EVENTS;if(this.trigger(d.ATTEMPT_OPERATION),!this._isValidDropElementForTutorial(c))return!1;var e=this.model.get("allowManagerLevelOperations"),f=a.EquationManager.Operations,g=c.strOperator,h=a.EquationManager.EVENTS,i=!1;if("*"===g&&f.REORDER_MULTIPLICATION&&e||"+"===g&&f.REORDER_ADDITION&&e){var j,k=b.CommandFactory,l=c.sourceTile,m=l.model.get("bDenominator"),n=c.isDestDeno,o=new k.TileLocation(l.parent.getIndex(l),m,c.numOfTiles),p=new k.TileLocation(c.index,n),q=c.isLeft,r={source:o,dest:p,isLeft:q,operator:g},s=this.equationView.model.getItemFromIndex(c.index.substring(0,c.index.lastIndexOf(".")));m!==n&&(s.get("type")===b.TileItem.SolveTileType.PARENTHESIS?(this.trigger(h.INVALID_COMBINE_WITHIN_DIFF_PARENT),i=!0):this._checkNumberOfTilesPermitted(n)===!1&&(i=!0)),i===!1&&(j=this.fireCommand(k.COMMANDS.REPOSITION,r),j===k.EXIT_CODE.NOT_SAME_PARENT_COMBINE&&(this.trigger(h.INVALID_COMBINE_WITHIN_DIFF_PARENT),i=!0,j=0))}return j&&this.removeMarquee(),j},onCombineTiles:function(c){var d,e=b.CommandFactory,f=a.EquationManager.EVENTS,g=c.sourceTile,h=c.destTile,i=new e.TileLocation(g.parent.getIndex(g),g.model.get("bDenominator"),c.numOfTiles),j=new e.TileLocation(h.parent.getIndex(h),h.model.get("bDenominator")),k={source:i,dest:j};return this.trigger(f.ATTEMPT_OPERATION),this._isValidDropElementForTutorial(c)?(d=this.fireCommand(e.COMMANDS.COMBINE,k),e.EXIT_CODE.SUCCESS===d?this.removeMarquee():e.EXIT_CODE.NOT_SAME_PARENT_COMBINE===d?(this.trigger(f.INVALID_COMBINE_WITHIN_DIFF_PARENT),d=0):e.EXIT_CODE.FAILURE===d?(this.trigger(f.INVALID_COMBINE_WITHIN_SAME_PARENT),d=0):e.EXIT_CODE.TILE_VALUE_EXCEEDING_COMBINE===d?(this.trigger(f.INVALID_COMBINE_FOR_TILE_VALUE_EXCEEDING),d=0):e.EXIT_CODE.BASE_VALUE_EXCEEDING_COMBINE===d?(this.trigger(f.INVALID_COMBINE_FOR_BASE_VALUE_EXCEEDING),d=0):e.EXIT_CODE.INVALID_COMBINE_WITH_MARQUEE===d&&(this.trigger(f.INVALID_COMBINE_FOR_MARQUEE),d=0),d):!1},_checkNumberOfTilesPermitted:function(b){var c,d=this.model.get("numOfTilesInNumDen"),e=this.equationView.model;return d?(c=e.getBasesAtGivenLocation(b),c.length<d?!0:(this.trigger(a.EquationManager.EVENTS.MAX_LIMIT_CROSSED_TOOLTIP),!1)):!0},tileAdded:function(a){var c=b.EquationManager.MODES,d=b.TileItem.BinTileType,e="new-created-tile",f=a.model.get("type"),g=0;if(this.model.get("mode")===c.SolveMode)if(a.$exponent&&a.$exponent.addClass(e),f===d.BASE_EXPONENT||f===d.BASE_ONLY)a.$base.addClass(e);else if(f===d.FRACTION)for(g=0;g<a.arrTileViews.length;g++)this.tileAdded(a.arrTileViews[g])},fireCommand:function(c,d){var e,f,g=null,h=null,i=b.CommandFactory,j=new i.Rules(this.commandFactory.get("allowedOperation"),this.commandFactory.get("maxPrimeLimit")),k=a.EquationManager.EVENTS,l=this;return this.$(".new-created-tile").removeClass("new-created-tile"),f=this.commandFactory.execute(c,j,d),f===i.EXIT_CODE.SUCCESS&&(this._tutorialMode?c===i.COMMANDS.BREAK_EXPONENT&&0!==d.sourceExp||c===i.COMMANDS.BREAK_BASE?this.trigger(k.TUTORIAL_BREAK_COMMAND,d):this.trigger(k.TUTORIAL_ADD_STEP,d):(g=this.equationView.model.getEquationInLatexForm(),this.model.get("equationLatexStack").push(g),h=this.equationView.getTileContentInHtmlForm(),e=this.equationView.getAccString(a.EquationManager.DATA),d.equationHtml=h,d.equationAccString=e,this.trigger(k.ADD_STEP,d)),this.trigger(k.COMMAND_FIRED,f),window.clearTimeout(this.timerId),this.removeHighlightTiles(),window.setTimeout(function(){l.trigger(k.CHECK_PURE_SIMPLE)},150)),this.hideAllTooltips(),f},removeHighlightTiles:function(){var a=this;this.timerId=setTimeout(function(){a.$(".new-created-tile").removeClass("new-created-tile")},5e3)},removeHighlightTilesImmediate:function(){this.$(".new-created-tile").removeClass("new-created-tile")},_attachEvents:function(){var a=this;this.$el.scroll(function(){a.marqueeView.model.set("scrollAmt",this.scrollLeft)}),this.attachMouseWheelHandler(),this.equationView.attachEvents(),this.$overlayDiv&&this.$overlayDiv.on("mousedown",function(a){return a.stopPropagation(),a.preventDefault(),!1})},attachMouseWheelHandler:function(){this.marqueeView.namespace;d.isAndroid||d.isIOS||this.$el.on("wheel",$.proxy(this.mousewheelHandler,this))},mousewheelHandler:function(a){a.preventDefault();var b=this.$el,c=40,d=b.scrollLeft(),e=a.originalEvent,f=$.Event("mousemove");c=e.deltaY<0?-c:+c,f.which=e.which,f.pageX=e.pageX,f.pageY=e.pageY,f.clientX=e.clientX,f.clientY=e.clientY,b.scrollLeft(d+c),this.marqueeView.model.set("scrollAmt",b.scrollLeft()),this.$(".ui-draggable-dragging").removeData("cur-droppable"),b.trigger(f)},hideMarquee:function(){this.removeMarquee(),this.marqueeView.disableMarquee(),this.marqueeSelectedItems=[]},showMarquee:function(){this.marqueeView.enableMarquee()},detachListenersOnMarqueeContainment:function(){this.marqueeView.detachListenersOnContainment()},onTileDrop:function(a,b){},reInitialise:function(a){this.equationView&&(this.equationView.arrTileViews=[],this.equationView.createView())},onDroppablesChange:function(){},_tutorialPlayer:null,createTutorialPlayer:function(){var a,b,c;a={},c=this.el.id,b=$("<div></div>",{id:c+"-cover","class":c.slice(this.idPrefix.length)+"-cover"}).appendTo(this.$el),this._tutorialPlayer=new MathInteractives.Common.Components.Theme2.Views.TutorialPlayer({el:b,player:this.player});var d=this.model,e=d.get("currentTutorialLessonNumber"),f=d.get("tutorialLessons")||[],g=f[e];g&&(this._tutorialPlayer.steps=g.steps)},playTutorial:function(){this._tutorialPlayer.off("parsedStepRequired").on("parsedStepRequired",$.proxy(this.parseEventJsonForTutorial,this)),this._tutorialPlayer.play()},parseEventJsonForTutorial:function(a){
var b,c,d={};a&&(d.action=a.action,a.source&&(b=this._getParsedLocation(a.source),d.target=b.target,d.offset=b.offset),a.destination&&(c=this._getParsedLocation(a.destination),d.nextTarget=c.target,d.nextOffset=c.offset)),this._tutorialPlayer.trigger("stepParsed",d)},_getParsedLocation:function(a){a=a||"",a=a.split("#");var b=this.equationView.getViewFromIndex(a[0]),c=b._getTutorialMouseEventPoint(a[1]);return{target:c.element,offset:c.offset}},disableTiles:function(a){this.equationView&&this.equationView.disableTiles(a),this.marqueeView&&(this.marqueeView.disableMarquee(),this.marqueeView._detachListenersOnMarqueeContainment())},enableDisableTilesItems:function(a,b){var c,d=0;if(a){d=a.length;for(var e=0;d>e;e++)c=a[e],c&&this.equationView.enableDisableTilesItem(c,b)}},getViewFromIndex:function(a){return this.equationView.getViewFromIndex(a)},deActivateEventOnAllTiles:function(a){this.equationView&&this.equationView.deActivateEventOnTiles(a),this.detachEventOnAllApplyExponent(),this.detachEventOnAllChangeSign()},activateEventOnTiles:function(a){var b,c={},d=0;if(a){d=a.length;for(var e=0;d>e;e++)c=a[e],c&&(b=this.getViewFromIndex(c.index),b&&b.attachEventOnView(c.simulateAction,c.offset,c.menuIndex))}},_isValidDropElementForTutorial:function(a){var b=this._lstTutorialTargetViewIndex.length,c=null,d=this._getCurrentDropIndex(a);if(!this._tutorialMode)return!0;if(!a)return!1;for(var e=0;b>e;e++)if(c=this._lstTutorialTargetViewIndex[e],c===d)return a.sourceTile&&(a.sourceTile.data?a.sourceTile.data("isValidDrop",!0):a.sourceTile.$el&&a.sourceTile.$el.data("isValidDrop",!0)),!0;return d===!0?(a.sourceTile&&(a.sourceTile.data?a.sourceTile.data("isValidDrop",!0):a.sourceTile.$el&&a.sourceTile.$el.data("isValidDrop",!0)),!0):!1},_isInvalidMarqueeForTutorial:function(){if(this._tutorialMode){var a=this.marqueeSelectedItemsIndex,b=a.length;if(a[0]!==this._tutorialMarqueeFirstElementIndex||a[b-1]!==this._tutorialMarqueeLastElementIndex)return!0}return!1},_getCurrentDropIndex:function(a){var b=null;if(a){if(b=a.destTile)return a.destTile.parent.getIndex(a.destTile);if(a.isDropOnMarquee)return!0;if(a.isTooltipClick)return!0}return"-1"},setTutorialTargetViewIndex:function(a){a&&(this._lstTutorialTargetViewIndex=a)},setTutorialMarqueeTargetsIndex:function(a,b){a&&(this._tutorialMarqueeFirstElementIndex=a,this._tutorialMarqueeLastElementIndex=b)},getExponentId:function(){var a=this.arrCounter.indexOf(-1);return-1!==a?(this.arrCounter[a]=a,a):(this.arrCounter[this.counter]=this.counter,this.counter++)},parenthesisRemoved:function(a,b){var c=this.parenthesisExponentTooltips[a];b?this._removeAllTooltips():(this.arrCounter[a]=-1,this.parenthesisExponentTooltips[a].remove(),this.parenthesisExponentTooltips[a].$el.remove(),this.applyExponentBtnViews[a].remove(),this.applyExponentBtnViews[a].$el.off().remove(),this.changeSignBtnViews.length&&(this.changeSignBtnViews[a].remove(),this.changeSignBtnViews[a].$el.off().remove()),c.$el.off(),c.remove())},parenthesisAdded:function(a,b,c){c&&(this._removeAllTooltips(),this.arrCounter[0]=this.counter,this.counter+=1),this.createTooltip(b,a)},increamentCounter:function(){this.counter++},createTooltip:function(a,b){var c={elementEl:this.idPrefix+"exponent-"+a,idPrefix:this.idPrefix,manager:this.manager,_player:this.player,type:MathInteractives.Common.Components.Theme2.Views.Tooltip.TYPE.FORM_VALIDATION,arrowType:MathInteractives.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.RIGHT_MIDDLE,path:this.filePath,isTts:!1,isArrow:!0,closeOnDocumentClick:!0,backgroundColor:"#6D6D6D",borderColor:"#ffffff",containerEleId:"tooltip-demo-container",position:"right-middle",dynamicArrowPosition:!0};c.text=this._getExponentTooltipHtml(a),this.parenthesisExponentTooltips[a]=MathInteractives.Common.Components.Views.BoundedTooltip.generateBoundedTooltip(c),this._generateButtonsInsideTooltip(a,b)},getExponentClickedTooltip:function(a){var b=this.arrCounter.indexOf(a);return this.parenthesisExponentTooltips[b]},_showParenthesisTooltip:function(b){var c=this.getExponentClickedTooltip(b),d=a.EquationManager.EVENTS;if("none"===c.$el.css("display")){this.hideAllTooltips(),c.showTooltip();var e={tooltip:c};this.applyExponentBtnViews[b]&&(e.applyExponent=this.applyExponentBtnViews[b]),this.changeSignBtnViews[b]&&(e.changeSign=this.changeSignBtnViews[b]),this.trigger(d.TOOLTIP_VISIBLE,e)}},hideAllTooltips:function(){for(var b=0,c=a.EquationManager.EVENTS;b<this.parenthesisExponentTooltips.length;b++)this.parenthesisExponentTooltips[b]&&this.parenthesisExponentTooltips[b].hideTooltip();this.trigger(c.TOOLTIP_HIDE)},_getExponentTooltipHtml:function(a){var b=$("<div></div>").attr({id:this.idPrefix+"exponent-tooltip-buttons-container-"+a,"class":"exponent-tooltip-buttons-container"});$("<div></div>").attr({id:this.idPrefix+"apply-exponent-button-"+a,"class":"apply-exponent-button"}).appendTo(b),$("<div></div>").attr({id:this.idPrefix+"change-sign-button-"+a,"class":"change-sign-button"}).appendTo(b);return b},_generateButtonsInsideTooltip:function(a,b){var c,d=this,e=MathInteractives.global.Theme2.Button;this.applyExponentBtnViews.length,this.changeSignBtnViews.length;c={idPrefix:this.idPrefix,player:this.player,manager:this.manager,path:this.filePath,data:{id:this.idPrefix+"apply-exponent-button-"+a,text:this.getMessage("exponent-parenthesis-tooltip","apply-exponent"),type:MathInteractives.global.Theme2.Button.TYPE.TEXT,baseClass:"white-button",textColor:"#007ebf"}},this.applyExponentBtnViews[a]=new e.generateButton(c),this._createAccDivsOfButtons(c.data.id,c.data.text,511),this.applyExponentBtnViews[a].$el.off("keydown").on("keydown",function(a){var b=a.keyCode?a.keyCode:a.charCode;if(9===b&&d._tutorialMode)a.preventDefault();else if(27===b){a.preventDefault();var c=d.getCurrentAccView();c.removeAccDiv(),c.startAcc(),d.hideAllTooltips()}else 9===b&&d.currentLevel<=2&&a.preventDefault()}),c.data.id=this.idPrefix+"change-sign-button-"+a,c.data.text=this.getMessage("exponent-parenthesis-tooltip","change-sign"),c.data.width=173,this.changeSignBtnViews[a]=new e.generateButton(c),this._createAccDivsOfButtons(c.data.id,c.data.text,512),this.changeSignBtnViews[a].$el.off("keydown").on("keydown",function(a){var b=a.keyCode?a.keyCode:a.charCode;if(9===b&&d._tutorialMode)a.preventDefault();else if(27===b){a.preventDefault();var c=d.getCurrentAccView();c.removeAccDiv(),c.startAcc(),d.hideAllTooltips()}})},_createAccDivsOfButtons:function(a,b,c){var d={elementId:a.replace(this.idPrefix,""),tabIndex:c,acc:b};this.createAccDiv(d)},attachEventOnMenuItem:function(a,b,c){"0"===a?this._attachEventOnApplyExponent(b,c):"1"===a&&this._attachEventOnChangeSign(b,c)},_attachEventOnApplyExponent:function(a,b){var c=(this.applyExponentBtnViews.length,this),d=this._getCounterApplyExponent(a);-1!==d&&(this.applyExponentBtnViews[d].setButtonState(MathInteractives.global.Theme2.Button.BUTTON_STATE_ACTIVE),this.applyExponentBtnViews[d].$el.off("click.tutApplyExponent").on("click.tutApplyExponent",null,{view:b},function(a){c.applyExponentClick(a),c.solveModeSetFocusOnTooltip()}))},_getCounterApplyExponent:function(a){for(var b=this.applyExponentBtnViews.length,c=null,d=0;b>d;d++){var e=this.applyExponentBtnViews[d];if(e&&(c=e.el)){var f=parseInt(c.id.replace(this.idPrefix+"apply-exponent-button-",""),10);if(f===a)return d}}return-1},detachEventOnAllApplyExponent:function(){for(var a=this.applyExponentBtnViews.length,b=0;a>b;b++)this.applyExponentBtnViews[b].$el.off("click"),this.applyExponentBtnViews[b].setButtonState(MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED)},_attachEventOnChangeSign:function(a,b){var c=(this.changeSignBtnViews.length,this),d=this._getCounterChangeSign(a);-1!==d&&(this.changeSignBtnViews[d].setButtonState(MathInteractives.global.Theme2.Button.BUTTON_STATE_ACTIVE),this.changeSignBtnViews[d].$el.off("click.tutChangeSign").on("click.tutChangeSign",null,{view:b},function(a){c.changeSignClick(a),c.solveModeSetFocusOnTooltip()}))},_getCounterChangeSign:function(a){for(var b=this.changeSignBtnViews.length,c=null,d=0;b>d;d++){var e=this.changeSignBtnViews[d];if(e&&(c=e.el)){var f=parseInt(c.id.replace(this.idPrefix+"change-sign-button-",""),10);if(f===a)return d}}return-1},detachEventOnAllChangeSign:function(){for(var a=this.changeSignBtnViews.length,b=0;a>b;b++)this.changeSignBtnViews[b].$el.off("click"),this.changeSignBtnViews[b].setButtonState(MathInteractives.global.Theme2.Button.BUTTON_STATE_DISABLED)},applyExponentClick:function(c){var d,e=c.data.view,f=e.parent.getIndex(e),g=b.CommandFactory,h=a.EquationManager.EVENTS,i=this;this.trigger(h.ATTEMPT_OPERATION);var g=b.CommandFactory,j=new g.TileLocation(f),k={source:j};this.$el.css("visibility","hidden"),d=this.fireCommand(g.COMMANDS.APPLY_EXPONENT,k),window.setTimeout(function(){i.$el.css("visibility","")},0),g.EXIT_CODE.TILE_VALUE_EXCEEDING_COMBINE===d?(this.trigger(h.INVALID_COMBINE_FOR_TILE_VALUE_EXCEEDING),d=0):c.which||window.setTimeout(function(){i.solveModeSetFocusOnTooltip()},0),this.removeMarquee()},changeSignClick:function(c){var d=c.data.view,e=d.parent,f=b.CommandFactory,g=b.TileItem.BinTileType,h=d.parent.getIndex(d),i=new f.TileLocation(h),j={source:i},k=a.EquationManager.EVENTS,l=this;this.trigger(k.ATTEMPT_OPERATION),e&&e.model.get("type")===g.FRACTION?e.onChildParenthesisChangeSign(d):(this.$el.css("visibility","hidden"),setTimeout(function(){l.$el.css("visibility","")},0),this.fireCommand(f.COMMANDS.CHANGE_SIGN,j),c.which||window.setTimeout(function(){l.solveModeSetFocusOnTooltip()},0)),this.removeMarquee()},enableAllOperator:function(a){this.equationView&&this.equationView.enableAllOperator(a)},keydownHandler:function(b){if(this.isAccessible()&&(b.preventDefault(),this.equationView)){var c=this.marqueeSelectedItems,d=(this.marqueeSelectedItemsIndex,c.length,this.equationView.arrTileViews,a.EquationManager.KEY),e=(a.EquationManager.EVENTS,this._tutorialMode),f=null,g=[d.RIGHTARROW,d.LEFTARROW,d.ESCAPE,d.TAB,d.SPACE];if(-1!==g.indexOf(b.which)&&(b.which!==d.RIGHTARROW&&b.which!==d.LEFTARROW||!this.isMarqueeSelectedForOp))if(this.setMarqueeDir(b),f=this.marqueeDir,!e||e&&this._isInvalidMarqueeForTutorial(),b.which===d.LEFTARROW||b.which===d.RIGHTARROW)this.handleMarqueeAcc(b);else{if(this.isSecondSpacePress(b))return this.equationView.spacePressed(this.getCurrentAccView()),void b.stopImmediatePropagation();this.isSpacePressTut(b)&&this.spacePressTutHandler(b)}}},handleMarqueeAcc:function(b){var c=this.marqueeSelectedItems,d=this.marqueeSelectedItemsIndex,e=c.length,f=(this.equationView.arrTileViews,a.EquationManager.KEY),g=(a.EquationManager.EVENTS,a.EquationManager.TILE_CLASS),h=MathInteractives.Common.Components.Theme2.Models.TutorialPlayer.METHOD_ENUM_INVERSE,i=this._tutorialMode,j=null,k=null,l=!1,m=null,n="custom-droppable-disabled",o=[f.RIGHTARROW,f.LEFTARROW];if(-1!==o.indexOf(b.which)&&(!this._tutorialMode||this.accTutSourceData.operation===h._promptUserToMarquee)){if(this.setMarqueeDir(b),m=this.marqueeDir,(!i||i&&this._isInvalidMarqueeForTutorial())&&this._showMarqueeSelectedItems(),b.shiftKey&&b.which===f.RIGHTARROW&&this.isTypeAllowedInMarquee()){if(this.isMarqueeSelectedForOp)return;if("ltr"===m||1>=e){if(j=c.length>0?this.getAdjacentTile(m):this.getCurrentAccView(),!j||j.model.isOne()||j.$el.hasClass(n))return void this.drawMarquee();c.push(j),l=!0,d.push(j.parent.getIndex(j)),j.$el.addClass(g),this.scrollToTile(j),this._addOperatorToMarquee(j)}else"rtl"===m&&(k=c.shift(),l=!1,d.shift(),k.$el.removeClass(g),this.scrollToTile(k.getNextTile()),this._removeOperatorFromMarquee(k.getNextTile()))}else if(b.shiftKey&&b.which===f.LEFTARROW&&this.isTypeAllowedInMarquee()){if(this.isMarqueeSelectedForOp)return;if("rtl"===m||1>=e){if(j=c.length>0?this.getAdjacentTile(m):this.getCurrentAccView(),!j||j.model.isOne()||j.$el.hasClass(n))return void this.drawMarquee();this._addOperatorToMarquee(c[0]),c.unshift(j),l=!0,d.unshift(j.parent.getIndex(j)),j.$el.addClass(g),this.scrollToTile(j)}else"ltr"===m&&(k=c.pop(),l=!1,d.pop(),k.$el.removeClass(g),this._removeOperatorFromMarquee(k),this.scrollToTile(k.getPrevTile()))}this.$(".marquee-selected").eq(0).hasClass("operator-container")&&this.$(".marquee-selected").eq(0).removeClass("marquee-selected"),this.marqueeSelectedItems.length>0&&(this.drawMarquee(),l?this.setMarqueeText(j,l):this.setMarqueeText(k,l),i&&!this._isInvalidMarqueeForTutorial()&&(this.setFocus(this.$el.attr("id").replace(this.idPrefix,"")),this.trigger(a.EquationManager.EVENTS.MARQUEE_DRAWN)))}},scrollToTile:function(a){var b=this.$el,c=a.$el,d=c.offset(),e=d.left,f=e+c.width(),g=b.scrollLeft(),h=20;0>e?b.scrollLeft(g+(e-h)):f>b.width()&&b.scrollLeft(g+f-b.width()+h)},isSecondSpacePress:function(b){var c=a.EquationManager.KEY;return b.which===c.SPACE&&this.isMarqueeSelectedForOp},spacePressTutHandler:function(a){var c=b.EquationManager.MODES,d=this.model.get("mode");if(d===c.BuildMode&&this.marqueeSelectedItems.length>0){this.getCurrentAccView().removeAccDiv();var e=this.marqueeView.$marqueeDiv.find(".selected-elements-cover");e.text(this.tutorialCustomTileString),this.marqueeView.focusAcc()}},isSpacePressTut:function(b){var c=a.EquationManager.KEY;return this._tutorialMode&&b.which===c.SPACE},startFirstSpaceOpTut:function(){var a=this.accTutDestData,c=a.sourceView,d=c.model.get("type"),e=b.TileItem.BinTileType;d===e.MARQUEE?c.focusAcc():document.activeElement===this.marqueeView.$marqueeDiv[0]&&(this.isMarqueeSelectedForOp=!0,this.tileSelected=!0,this.tutorialCustomTileString="",c.startAcc())},removeMarqueeAcc:function(b){var c=a.EquationManager.TILE_CLASS;this.removeMarquee(),this.$("."+c).removeClass(c),this.marqueeSelectedItems=[],this.isMarqueeSelectedForOp=!1,b&&(this.$el[0].focus(),this.getCurrentAccView()&&this.getCurrentAccView().revertFocus())},stopSpaceSelect:function(){this.isMarqueeSelectedForOp=!1,this.tileSelected=null},isTypeAllowedInMarquee:function(){var a=this.getCurrentAccView(),c=b.TileItem.BinTileType,d=[c.BASE_EXPONENT,c.PARENTHESIS,c.BASE_ONLY];return this.getCurrentAccView()?d.indexOf(a.model.get("type"))>-1:void 0},drawMarquee:function(){var a=this.marqueeView;1===this.marqueeSelectedItems.length&&this.getCurrentAccView().removeAccDiv(),a.$marqueeDiv.empty(),a._attachListenersOnMarqueeDiv(),a.drawMarqueeOn(this.marqueeSelectedItems),this._groupSelectedTileItems(a.$marqueeDiv),this._hideMarqueeSelectedItems(),a.marqueeFocusin(),document.activeElement!==a.$marqueeDiv[0]&&a.focusAcc()},setMarqueeDir:function(b){var c=a.EquationManager.KEY;1===this.marqueeSelectedItems.length&&(this.marqueeDir=b.which===c.RIGHTARROW?"ltr":b.which===c.LEFTARROW?"rtl":null)},addMarqueeClasses:function(a){a.$el.addClass("marquee-selected"),this._addOperatorToMarquee(a)},getAdjacentTile:function(a){var b=null,c=this.marqueeSelectedItems;return"ltr"===a?(b=_.last(c).getNextTile(),b?_.last(c).model.get("bDenominator")!==b.model.get("bDenominator")?null:b:null):"rtl"===a?(b=c[0].getPrevTile(),b?c[0].model.get("bDenominator")!==b.model.get("bDenominator")?null:b:null):void 0},currentAccViewChangeHandler:function(){var a=this.getCurrentAccView();if(a)return this._tutorialMode?this.updateCtxMenuRowsTut():this.updateCtxMenuRows(),this.tileSelected?void this.setCtxElems([]):void(a&&a.accDiv&&this.setCtxElems([a.accDiv]))},updateCtxMenuRows:function(){var c=this.model,d=c.get("isParenthesesAllowed"),e=this.getCurrentAccView(),f=a.EquationManager.CTX_ITEM_ID,g=b.TileItem.BinTileType,h=b.EquationManager.MODES,i=this.model.get("mode"),j=this,k=null,l=[];e&&(k=e.model.get("type"),this.ignoreAllCtxRows(),i===h.BuildMode?(d&&k!==g.BIG_PARENTHESIS&&(this.isPosParensEnabled&&l.push(f.ADD_POS_PARENS),this.isNegParensEnabled&&l.push(f.ADD_NEG_PARENS),e.isInsideParentheses()&&l.push(f.REMOVE_PARENS)),this.toShowDeleteRow()&&l.push(f.DELETE_TILE)):((k===g.BASE_EXPONENT||k===g.BASE_ONLY&&!e.model.isOne())&&(this.isNumeratorEmpty()||l.push(f.COMBINE_NUM),this.isDenominatorEmpty()||l.push(f.COMBINE_DEN),l.push(f.BREAK_BASE)),k===g.BASE_EXPONENT&&l.push(f.BREAK_EXP),(k!==g.BASE_ONLY&&k!==g.BIG_PARENTHESIS||k===g.BASE_ONLY&&!e.model.isOne())&&l.push(f.REPOS_ACROSS_VINCULUM)),l=_.map(l,function(a,b){return j.idPrefix+a}),this.tileCtxMenu.editContextMenu(l,!1))},updateCtxMenuRowsTut:function(){var c=this.model,d=(c.get("isParenthesesAllowed"),this.getCurrentAccView(),a.EquationManager.CTX_ITEM_ID),e=b.TileItem.BinTileType,f=MathInteractives.Common.Components.Theme2.Models.TutorialPlayer.METHOD_ENUM_INVERSE,g=(b.EquationManager.MODES,this.model.get("mode"),this.accTutSourceData),h=this.accTutDestData,i=null,j=null,k=null,l=null,m=this,n=[];this.ignoreAllCtxRows(),_.isEmpty(g)||(i=g.sourceView,j=i.model.get("type")),_.isEmpty(h)||(k=h.sourceView,l=k.model.get("type")),1===g.offset&&g.isBin===!1&&g.operation===f._promptUserToClick&&j!==e.BIG_PARENTHESIS&&j!==e.PARENTHESIS?0===i.model.get("exponent")||1===Math.abs(i.model.get("base"))?n.push(d.APPLY_EXP):n.push(d.BREAK_EXP):0===g.offset&&g.isBin===!1&&g.operation===f._promptUserToClick?n.push(d.BREAK_BASE):j===e.BASE_EXPONENT&&g.operation===f._promptUserToDrag&&l===e.BASE_EXPONENT?k.model.get("bDenominator")?n.push(d.COMBINE_DEN):n.push(d.COMBINE_NUM):j!==e.BASE_ONLY||g.operation!==f._promptUserToDrag||l!==e.BASE_EXPONENT||k.model.get("bDenominator")||n.push(d.COMBINE_NUM),n=_.map(n,function(a,b){return m.idPrefix+a}),this.tileCtxMenu.editContextMenu(n,!1)},isNumeratorEmpty:function(){var a=b.TileItem.BinTileType,c=this.equationView,d=null,e=null;return c?(e=c.model.get("tileArray"),d=e.at(0).get("type")===a.BIG_PARENTHESIS?e.at(0).at(0).get("tileArray"):e.at(0).get("type")===a.FRACTION?e.at(0):e,0===d.where({bDenominator:!1}).length):!0},isDenominatorEmpty:function(){var a=b.TileItem.BinTileType,c=this.equationView,d=null,e=null;return c?(e=c.model.get("tileArray"),d=e.at(0).get("type")===a.BIG_PARENTHESIS?e.at(0).at(0).get("tileArray"):e.at(0).get("type")===a.FRACTION?e.at(0):e,0===d.where({bDenominator:!0}).length):!0},ignoreAllCtxRows:function(){var b=[],c=a.EquationManager.CTX_ITEM_ID,d=this;b=_.map(c,function(a,b,c){return d.idPrefix+a}),this.tileCtxMenu.editContextMenu(b,!0)},buildModeSetFocusOnTooltip:function(){this.trigger(a.EquationManager.EVENTS.BUILD_SET_FOCUS_ON_TOOLTIP)},solveModeSetFocusOnTooltip:function(){this.trigger(a.EquationManager.EVENTS.SOLVE_SET_FOCUS_ON_TOOLTIP)},toShowDeleteRow:function(){var a=this.getCurrentAccView(),c=b.TileItem.BinTileType,d=a.model.get("type"),e=b.EquationComponent.Operations,f=0!==(this.model.get("allowedOperation")&e.PARENTHESIS_EXP_ALL);return d===c.BASE_EXPONENT&&(a.accTileType===c.BASE&&!a.model.isEmpty(c.BASE)||a.accTileType===c.EXPONENT&&!a.model.isEmpty(c.EXPONENT))||(d===c.PARENTHESIS||d===c.BIG_PARENTHESIS)&&!a.model.isEmpty(c.EXPONENT)&&f},setCtxElems:function(a){var b=this.tileCtxMenu;b.enableDisableContextMenu(b.model.get("elements"),!1),b.enableDisableContextMenu(a.slice(),!1),b.enableDisableContextMenu(a.slice(),!0)},setMarqueeText:function(a,b){if(a){var c=this.marqueeView.$marqueeDiv.find(".selected-elements-cover");c?this._tutorialMode?c.text(a.getSelfAccString(!0)+"."+this.tutorialCustomTileString):b?c.text(a.getSelfAccString(!0)+" "+this.getAccMessage("extra-messages",5)):c.text(a.getSelfAccString(!0)+" "+this.getAccMessage("extra-messages",6)):c.text("")}},removeCurrentAccDiv:function(){this.getCurrentAccView()&&this.getCurrentAccView().removeAccDiv()}},{TILE_CLASS:"marquee-selected",TILE_DUMMY_CLASS:"base",NUMERATOR_MARQUEE_CLASS:"marquee-numerator",DENOMINATOR_MARQUEE_CLASS:"marquee-denominator",EVENTS:{NEW_EXPRESSION_START:"new-expression-start",ADD_STEP:"add-step",REMOVE_STEP:"remove-step",MARQUEE_DRAWN:"marquee-drawn",MARQUEE_REMOVED:"marquee-removed",COMMAND_FIRED:"command-fired",TILE_DRAGGING_START:"tile-dragging-start",TILE_MOUSE_DOWN:"tile-mouse-down",MARQUEE_START:"marquee-start",PARENTHESIS_EXPONENT_CLICK:"parenthesis-exponent-click",MARQUEE_DRAG_START:"marquee-drag-start",CHECK_PURE_SIMPLE:"check-pure-simple",MAX_LIMIT_CROSSED_TOOLTIP:"max-limit-crossed-tooltip",INVALID_COMBINE_WITHIN_SAME_PARENT:"invalid-combine-within-same-parent",INVALID_COMBINE_WITHIN_DIFF_PARENT:"invalid-combine-within-diff-parent",INVALID_COMBINE_FOR_TILE_VALUE_EXCEEDING:"invalid-combine-for-tile-value-exceeding",INVALID_COMBINE_FOR_BASE_VALUE_EXCEEDING:"invalid-combine-for-base-value-exceeding",INVALID_COMBINE_FOR_MARQUEE:"invalid-combine-for-marquee",TUTORIAL_ADD_STEP:"tutorial-add-step",ATTEMPT_OPERATION:"attempt-operation",REVERT_START:"revert-start",REVERT_END:"revert-end",TOOLTIP_VISIBLE:"tooltip-visible",TOOLTIP_HIDE:"tooltip-hide",BUILD_TAB:"build-tab",BUILD_SHIFT_TAB:"build-shift-tab",SOLVE_TAB:"solve-tab",SOLVE_SHIFT_TAB:"solve-shift-tab",MARQUEE_HIDE_ACC:"marquee-hide-acc",BUILD_SET_FOCUS_ON_TOOLTIP:"build-set-focus-on-tooltip",SOLVE_SET_FOCUS_ON_TOOLTIP:"solve-set-focus-on-tooltip",TUTORIAL_STEP_CHANGE:"tutorial-step-change",FANNING_ANIMATION_START:"fanning-animation-start",FANNING_ANIMATION_END:"fanning-animation-end",TUTORIAL_BREAK_COMMAND:"tutorial-break-command"},Operations:{ADD_TILE_TO_CANVAS:1,SETUP_DIVISION:2,SETUP_MULTIPLICATION:4,SETUP_PARENTHESIS:8,RAISE_TERM_TO_POWER:16,NEGATIVE_MULTIPLIER:32,REORDER_ADDITION:64,REORDER_MULTIPLICATION:128,DRAG_TERMS_INSIDE_PARENTHESIS:256,MOVE_EXP_BASE_INDEPENDENTLY:512,MOVE_BASE_EXP_UNIT:1024,MOVE_EXP_TO_DENOMINATOR:2048,DELETE_TILE:4096},KEY:{TAB:9,SPACE:32,ENTER:13,ESCAPE:27,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40,DELETE:68,ROTATE_CLOCKWISE:82,ROTATE_ANTI_CLOCKWISE:69},CTX_ITEM_ID:{DELETE_TILE:"em-tile-context-menu-0",ADD_NEG_PARENS:"em-tile-context-menu-1",ADD_POS_PARENS:"em-tile-context-menu-2",REMOVE_PARENS:"em-tile-context-menu-3",COMBINE_NUM:"em-tile-context-menu-4",COMBINE_DEN:"em-tile-context-menu-5",BREAK_BASE:"em-tile-context-menu-6",BREAK_EXP:"em-tile-context-menu-7",APPLY_EXP:"em-tile-context-menu-8",REPOS_ACROSS_VINCULUM:"em-tile-context-menu-9"},DATA:"data"})}(),function(){"use strict";var a=null,b=MathInteractives.Common.Components.Views.EquationManager,c=MathInteractives.Common.Components.Models.EquationManager,d=MathInteractives.Common.Utilities.Models.Rect,e=MathInteractives.Common.Utilities.Models.Point;b.Marquee=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,$marqueeContainer:null,namespace:null,$marqueeDiv:null,_marqueeOriginalPosition:null,equationManager:null,isDrawing:!1,isDragging:!1,_isAcc:!0,initialize:function(){var a=this.model,d=a.get("marqueeContainer"),e=null,f=this.options.equationManager,g=c.TileItem.BinTileType;b.Marquee.bDocumentEventAttached||(b.Marquee.bDocumentEventAttached=!0),this.idPrefix=a.get("idPrefix"),this.manager=a.get("manager"),this.filePath=a.get("filePath"),this.player=a.get("player"),this._isAcc=this.isAccessible(),f&&(this.equationManager=f),this.model.set("type",g.MARQUEE),e="string"==typeof d?this.$(d):d,this.marqueeContainerSelector=""===e[0].id?Math.random().toPrecision(1):e[0].id,this.namespace=this.idPrefix+this.marqueeContainerSelector,this.$marqueeContainer=e,this.$marqueeDiv=this.createMarqueeDiv(),this.createCtxMenu(),this._attachListenersOnMarqueeContainment(),this._attachListenersOnMarqueeDiv(),this.attachEventsAcc()},createMarqueeDiv:function(){var a=this.namespace,b=this.$marqueeContainer,d=this.model.get("zIndex"),e=$("<div>",{"class":a+"marquee-div marquee-div"});return this._isAcc&&e.attr("tabindex",-1),e.css({position:"absolute","z-index":d}),e.css(c.Marquee.MARQUEE_STYLE_DRAGGING),b.append(e),e},createCtxMenu:function(){var a=MathInteractives.Common.Interactivities.ExponentAccordion.Views.DerivedContextMenu;this.ctxMenu=null,this.ctxMenu=a.initContextMenu({el:this.player.$el,prefix:this.idPrefix,elements:[this.$marqueeDiv],screenId:"marquee-context-menu",contextMenuCount:7,manager:this.manager,thisView:this}),this.equationManager._tutorialMode?this.updateCtxMenuRowsTut():this.updateCtxMenuRows()},_attachListenersOnMarqueeContainment:function(){var a=this,b=this.namespace,c=this.$marqueeDiv,d=this.$marqueeContainer;MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;MathInteractives.Common.Utilities.Models.Utils.EnableTouch(c),d.off("mousedown."+b).on("mousedown."+b,function(b){a.marqueeContainerMouseDownHandler(b)}),this.applyHandCursorToElem(c),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(d,{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE})},_attachListenersOnMarqueeDiv:function(){this.$marqueeDiv.off("keydown.acc").on("keydown.acc",$.proxy(this.keydownHandler,this))},attachEventsAcc:function(){if(this.isAccessible()){var a=MathInteractives.global.ContextMenu,c=b.EquationManager.EVENTS,d={HIDE:a.CONTEXTMENU_HIDE,OPEN:a.CONTEXTMENU_OPEN,SELECT:a.CONTEXTMENU_SELECT},e="marquee";this.$marqueeDiv.off(d.HIDE).on(d.HIDE,$.proxy(this.ctxMenuHideHandler,this)),this.$marqueeDiv.off(d.SELECT).on(d.SELECT,$.proxy(this.ctxMenuSelectHandler,this)),this.equationManager._tutorialMode&&this.listenTo(this.equationManager,c.TUTORIAL_STEP_CHANGE,this.updateCtxMenuRowsTut),this.$marqueeDiv.off("focusin."+e).on("focusin."+e,$.proxy(this.marqueeFocusin,this)),this.$marqueeDiv.off("focusout."+e).on("focusout."+e,$.proxy(this.marqueeFocusout,this))}},_detachListenersOnMarqueeContainment:function(){var a=this.namespace,b=null,c=null;b=this.$marqueeDiv,c=this.$marqueeContainer,c.off("mousedown."+a),b.off("mousedown."+a),c.off("mouseup."+a),b.off("mouseup."+a)},_detachAllExceptMouseDown:function(){var a=this.namespace,b=null,c=null;b=this.$marqueeDiv,c=this.$marqueeContainer,c.off("mouseup."+a),b.off("mouseup."+a)},detachListenersOnContainment:function(){this._detachListenersOnMarqueeContainment()},_getPoint:function(a){var b={x:a.pageX+this.model.get("scrollAmt"),y:a.pageY};return b},marqueeContainerMouseDownHandler:function(b){if(!this.isDragging){this.resetCursor(),this.isDrawing=!0;var c=this.$marqueeDiv,d=MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile,e=b;if(d||1===b.which){for(this._marqueeMouseUpAndMoveEvents(),d&&(e=b.originalEvent,e.touches&&e.touches.length>0&&(e=e.touches[0]),this._marqueeTouchEndAndMoveEvents()),this.collapseMarquee(e);c[0].hasChildNodes();)c[0].removeChild(c[0].lastChild);c.show(),this.dragging=!0,this.startPoint=this._getPoint(e),this.trigger(a.EVENTS.start,a.createCustomEventObject(e)),b.preventDefault()}}},marqueeMouseDownHandler:function(b){this.trigger(a.EVENTS.MARQUEE_MOUSEDOWN),b.stopPropagation(),b.preventDefault()},_detachUpAndMoveEvents:function(){var a=this.namespace;$(document).off("mouseup."+a),$(document).off("mousemove."+a),MathInteractives.Common.Utilities.Models.Utils.DisableTouch(this.player.$el)},_marqueeMouseUpAndMoveEvents:function(){var a=this.namespace,b=this;$(document).off("mouseup."+a).on("mouseup."+a,function(a){var c;c=b.marqueeMouseUpHandler(a,!0,!1)}),$(document).on("mousemove."+a,function(a){a.preventDefault(),a.stopPropagation(),b.marqueeMouseMoveHandler(a)})},_marqueeTouchEndAndMoveEvents:function(){var a,b,c=this.namespace,d=this;a=function(a){a.stopPropagation(),$(document).off("mouseup."+c);var b;b=d.marqueeMouseUpHandler(a,!0,!1)},b=function(a){a.preventDefault(),a.stopPropagation(),d.marqueeMouseMoveHandler(a)},MathInteractives.Common.Utilities.Models.Utils.DisableTouch(this.player.$el),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.player.$el)},marqueeMouseMoveHandler:function(b){var e=b;MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile&&(e=b.originalEvent,e.touches&&e.touches.length>0&&(e=e.touches[0]));var f,g,h,i,j,k,l,m,n,o,p=this.model.get("scrollAmt"),q=this._getPoint(e),r=q.x,s=q.y,t=this.startPoint,u=t.x,v=t.y,w=Math.abs(r-u),x=Math.abs(s-v),y=30,z=15,A=4;f=this.$marqueeDiv,i=this.$marqueeContainer,j=i.offset(),k=j.left+p,l=j.top,n=i.height(),m=i.width(),o=new d(this.equationManager.$el[0].getBoundingClientRect()),h=u>r?u-w:u,g=v>s?v-x:v,k>r?(h=k,w=u-k):r>k+m&&(w=k+m-u-A),l>s?(g=l,x=v-l):s>l+n&&(x=l+n-v-A),r-p>o.getRight()-y?this.equationManager.$el.scrollLeft(p+z):r-p<o.getLeft()+y&&this.equationManager.$el.scrollLeft(p-z),f.css({width:Math.round(w),height:Math.round(x),top:Math.round(g-l)+0+"px",left:Math.round(h-k)+0+"px"}),b.originalEvent&&b.originalEvent.isSimulated?f.css(c.Marquee.FAKE_MARQUEE_STYLE.DRAGGING):f.css(c.Marquee.MARQUEE_STYLE_DRAGGING),this.trigger(a.EVENTS.move,a.createCustomEventObject(e)),b.preventDefault()},marqueeMouseUpHandler:function(b,c,e){if(e||this.dragging){var f,g=this.$marqueeContainer,h=g.offset(),i=this.$marqueeDiv;if(this.applyHandCursorToElem(i),this.isDrawing=!1,b.isSimulated||b.originalEvent.isSimulated)return f=i.clone().removeAttr("class").addClass("fake-marquee").insertAfter(i),this.collapseMarquee(b),b.preventDefault(),void this._detachUpAndMoveEvents();this.trigger(a.EVENTS.ChangeSelectorClass,b,i),this.dragging&&(this.dragging=!1);var j=this,k=[],l=j.model.get("selectorClass"),m=j.model.get("ignoreClass"),n=j.model.get("tolerance"),o="string"==typeof l?$("."+l):l,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x={top:0,left:0,height:0,width:0},y=!0,z=null;o.each(function(a){p=$(this),p.hasClass(m)||(q=p.offset(),r=q.top,s=q.left,t=p.outerHeight(),u=p.outerWidth(),v={top:r,left:s,height:t,width:u},w=j._checkIsInsideMarquee(v,n),p.data().isInsideMarquee=w,y&&w?(x.top=r,x.left=s,x.height=t,x.width=u,y=!1,k.push(p)):w&&(k.push(p),x=j._adjustMarqueeBounds(x,v)))}),x.top=x.top-h.top,x.left=x.left-h.left;var A=this._getMarqueeData();z=j._resizeMarquee(x,k,c,b),this.$groupCover&&this.$groupCover.css({height:this.$marqueeDiv.outerHeight(),width:this.$marqueeDiv.outerWidth()}),this.marqueeInitRect=new d(i[0].getBoundingClientRect()),c&&j.trigger(a.EVENTS.end,a.createCustomEventObject(b,k,{marqueeData:A,$marquee:i})),b.preventDefault(),this._detachUpAndMoveEvents()}},_getMarqueeData:function(){var a=this.$marqueeDiv,b={height:a.outerHeight(),width:a.outerWidth(),position:a.position(),offset:a.offset()};return b},_adjustMarqueeBounds:function(a,b){var c=b.top,d=b.left,e=b.height,f=b.width;return c>=a.top&&d>=a.left?(a.height=c+e>a.top+a.height?c+e-a.top:a.height,a.width=d+f>a.left+a.width?d+f-a.left:a.width):(c<=a.top&&d<=a.left&&(a.height=a.top+a.height-c,a.width=a.left+a.width-d,a.top=c,a.left=d),c>=a.top&&d<=a.left&&(a.height=a.top+a.height<c+e?c+e-a.top:a.height,a.width=a.left+a.width-d,a.left=d),c<=a.top&&d>=a.left&&(a.height=e<a.height?a.top+a.height-c:e,a.width=a.left+a.width<d+f?d+f-a.left:a.width,a.top=c)),a},_checkIsInsideMarquee:function(a,b){if(a){var c=!1,d=this.$marqueeDiv,e=d.offset(),f=e.top,g=e.left,h=d.outerHeight(),i=d.outerWidth(),j=e.top+h,k=e.left+i,l=a.top,m=a.left,n=a.height,o=a.width,p=n*o,q=l+n,r=m+o,s=0,t=0,u={height:0,width:0},v=0;return s=Math.max(Math.min(j,q)-Math.max(f,l),0),t=Math.max(Math.min(k,r)-Math.max(g,m),0),u.height=s,u.width=t,v=u.height*u.width,r>g&&k>m&&q>f&&j>l&&v/p>b&&(c=!0),c}},_resizeMarquee:function(b,c,d,e){var f=this,g=this.$marqueeDiv,h=null,i=this.model.get("paddingTop"),j=this.model.get("paddingRight"),k=this.model.get("paddingBottom"),l=this.model.get("paddingLeft"),m=this.model.get("marqueeDefaultOffset"),n=null,o=0,p=0;if(b){p?(o=p,g.css({top:Math.round(b.top-h+m.top),left:Math.round(b.left-h+m.left)+o,height:Math.round(b.height?b.height+2*h:0),width:Math.round(b.width?b.width+2*h:0)})):g.css({top:Math.round(b.top-i+m.top),left:Math.round(b.left-l+m.left),height:Math.round(b.height?b.height+(i+k)-1:0),width:Math.round(b.width?b.width+(l+j)-1:0)+p}),(1===b.height||1===b.width)&&g.css({outline:"none"});var q=this._getMarqueeData(),r=[],s=null;s=c.length,n=a.createCustomEventObject(e,c,{marqueeData:q,elementPositions:r}),d&&f.trigger(a.EVENTS.resize,n)}return n},_getElementData:function(a){var b=a.offset(),c=this.$marqueeDiv.offset(),d={relativeTop:b.top-c.top,relativeLeft:b.left-c.left};return d},isDisabled:!1,disableMarquee:function(){var a=this.$marqueeDiv;this.hideMarquee(),this._detachListenersOnMarqueeContainment(),this.isDisabled=!0,a.is(".ui-draggable")&&a.draggable("disable"),a.is(".ui-droppable")&&a.droppable("disable");
},enableMarquee:function(){this.isDisabled=!1,this.showMarquee(),this._attachListenersOnMarqueeContainment(),this._attachListenersOnMarqueeDiv()},hideMarquee:function(){this.$marqueeDiv.hide()},showMarquee:function(){this.$marqueeDiv.show()},collapseMarquee:function(a){var b=this.$marqueeDiv;this.marqueeInitRect=null,this._resizeMarquee({top:0,left:0,width:0,height:0},!1,!0,a),b.css({border:"none","background-color":"rgba(0, 0, 0, 0);"}),setTimeout(function(){b.off(),b.is(".ui-draggable")&&b.draggable("destroy"),b.is(".ui-droppable")&&b.droppable("destroy")},10)},customFitMarqueeToBounds:function(a,b){this._resizeMarquee(a,b,!1)},drawMarqueeOn:function(a){var b=0,d=null,e=null,f=this.$marqueeContainer.offset(),g=null,h=null;for(b=0;b<a.length;b++)h=a[b].$el,g=h.offset(),d={left:g.left-f.left,top:g.top-f.top,width:h.outerWidth(),height:h.outerHeight()},d.right=d.left+d.width,d.bottom=d.top+d.height,e||(e=$.extend({},d)),e={left:Math.min(e.left,d.left),top:Math.min(e.top,d.top),right:Math.max(e.right,d.right),bottom:Math.max(e.bottom,d.bottom)},e.width=e.right-e.left,e.height=e.bottom-e.top;this.customFitMarqueeToBounds(e,a),this.$marqueeDiv.css(c.Marquee.MARQUEE_STYLE_AFTER_RELEASE)},updatePaperObjects:function(a){this.model.set("paperObjects",a)},groupSelectedElements:function(a){var b=this.$marqueeDiv,c=this,d=this.namespace;MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;this.$groupCover=$("<div/>"),b.append(a),b.append(this.$groupCover),this.$groupCover.attr("class","selected-elements-cover").css({position:"absolute",height:b.outerHeight(),width:b.outerWidth(),top:"0px",left:"0px","z-index":0}),this._isAcc&&this.$groupCover.attr("tabindex",-1),b.css(MathInteractives.Common.Components.Models.EquationManager.Marquee.MARQUEE_STYLE_AFTER_RELEASE),b.off("mousedown."+d).on("mousedown."+d,function(a){c.marqueeMouseDownHandler(a)}),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(b)},makeGroupDraggable:function(a,d,f){var g,h=this,i=d.length,j=c.TileItem.BinTileType,k=b.EquationManager.EVENTS,l=this.equationManager.model.get("mode"),m=c.EquationManager.MODES;this.$marqueeDiv.on("mousedown",function(a){f.adjustContainment($(this)),a.stopPropagation()}),this.$marqueeDiv.on("mouseup",function(a){f.resetContainment()}),this.$marqueeDiv.draggable({scroll:!0,scrollSensitivity:50,distance:10,scrollSpeed:MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?40:30,containment:f.$draggableContainment,revert:function(a){if(h.$marqueeDiv.css({cursor:"default"}),this.data("isDropped")===!0)return!1;var b=h.equationManager.isTileRemovable(h,g);return b?!1:(h.equationManager.showHideOverlayDiv(!0),f.trigger(k.REVERT_START),!0)},zIndex:1,cursorAt:{left:h.$marqueeDiv.width()/2,top:h.$marqueeDiv.height()/2},start:function(c,d){var j=c.originalEvent?c.originalEvent:c,k=b.EquationManager.EVENTS;f.equationView.attachDetachDraggable(-1,!0),h.isDragging=!0,g=new e({left:j.clientX,top:j.clientY}),$(this).addClass("current-draggable"),l===m.SolveMode?d.helper.data({"cur-draggable":a,length:i,prevLocationData:a.model.get("bDenominator")}):d.helper.data({"cur-draggable":a,length:i}),f.trigger(k.MARQUEE_DRAG_START)},drag:function(a,b){var c=a.originalEvent?a.originalEvent:a;g.setPoint({left:c.clientX,top:c.clientY});var d=$(this).data("cur-droppable");d&&d.onMouseOver(a,b)},stop:function(b,c){if(h.isDragging=!1,f.equationView.attachDetachDraggable(-1,!1),c.helper.removeData("cur-draggable"),$(this).removeClass("current-draggable"),l===m.SolveMode&&(c.helper.removeData("prevLocationData"),c.helper.removeData("length"),$(this).data("isDropped")||h.invertExponentText(!0)),!$(this).data("isDropped")){var d=b.originalEvent?b.originalEvent:b,g=new e({left:d.clientX,top:d.clientY}),j=f.isTileRemovable(h,g);if(j){var n={sourceTile:a,numOfTiles:i};f.onDeleteTile(n)}}$(this).removeData("isDropped"),f.resetContainment(),f.showHideOverlayDiv(!1),f.refresh(),f.trigger(k.REVERT_END),f.setIsDropped(!1),f.refresh()}}).attr({"data-tiletype":j.MARQUEE}),this.$marqueeDiv.droppable({accept:"*",tolerance:"pointer",greedy:!0,scope:"marquee-scope",drop:function(b,c){return f.getIsDropped()?void 0:(h.onTileDrop(b,c,{marqueeSourceItem:a,length:i}),h.$el.removeClass("white-border-left white-border-right white-border"),f.setIsDropped(!0),!0)},over:function(a,b){h.onMouseOver(a,b),b.draggable.data("cur-droppable",h)},out:function(a,b){h.onMouseOut(a,b),b.draggable.removeData("cur-droppable")}}),this.createCtxMenu(),this.attachEventsAcc()},onMouseOver:function(a,b){this.equationManager.registerMouseOverTile(this,a,b),this.$marqueeDiv.addClass("hover-class")},onMouseOut:function(a,b){this.$marqueeDiv.removeClass("hover-class")},onTileDrop:function(a,b,d){var e=b.helper.data(),f=e.tiletype,g=d.marqueeSourceItem,h=d.length,i=c.TileItem.BinTileType,j={};f===i.PARENTHESIS&&(j={sourceTile:b.helper,index:g.parent.getIndex(g),numOfTiles:h,isDropOnMarquee:!0},this.equationManager.onAddTile(j),b.draggable.data("isDropped",!0))},deleteTilesAcc:function(){var a=this.equationManager.marqueeSelectedItems,b={sourceTile:a[0],numOfTiles:a.length};this.equationManager.onDeleteTile(b),this.setFocus("droppable-region")},addParenthesesAcc:function(a){var b={},d=this.equationManager.marqueeSelectedItems[0];b.sourceTile={tileType:c.TileItem.BinTileType.PARENTHESIS,tilevalue:a},b.numOfTiles=this.equationManager.marqueeSelectedItems.length,b.index=d.parent.getIndex(d),b.isDestDeno=d.model.get("bDenominator"),b.isDropOnMarquee=!0,this.equationManager.onAddTile(b,!0),this.equationManager.buildModeSetFocusOnTooltip()},breakGroup:function(){for(var a=this.$marqueeDiv[0];a.hasChildNodes();)a.removeChild(a.lastChild)},getOriginalOffset:function(){return this._marqueeOriginalPosition},applyHandCursorToElem:function(a){if(!this.equationManager.isTouch()){var b,c;b="mouseenter",c="mouseleave",a.on(b,$.proxy(this._setOpenCursor,this)),a.on(c,$.proxy(this._setDefaultCursor,this)),a.on("mousedown",$.proxy(this._setClosedCursor,this)),a.on("mouseup",$.proxy(this._setOpenCursor,this)),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(a)}},_setOpenCursor:function(){if(!this.equationManager.isTouch()){var a=this.$marqueeDiv;a.hasClass("current-draggable")||a.css({cursor:"url('"+this.getImagePath("open-hand")+"'), move"})}},_setClosedCursor:function(){if(!this.equationManager.isTouch()){var a=this.$marqueeDiv;a.hasClass("current-draggable")||a.css({cursor:"url('"+this.getImagePath("closed-hand")+"'), move"})}},_setDefaultCursor:function(){if(!this.equationManager.isTouch()){var a=this.$marqueeDiv;a.hasClass("current-draggable")||a.css({cursor:"default"})}},resetCursor:function(){if(!this.equationManager.isTouch()){var a,b,c=this.$marqueeDiv;a="mouseenter",b="mouseleave",c.off(a,this._setOpenCursor),c.off(b,this._setDefaultCursor),c.off("mousedown",this._setClosedCursor),c.off("mouseup",this._setOpenCursor),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(c)}},invertExponentText:function(a){var b,c,d=this.equationManager.marqueeExponents,e=this.equationManager.marqueeSelectedItems;for(b=0;b<d.length;b++)c=d[b],c&&e[b]&&0!==e[b].model.get("exponent")&&(a?c.html(e[b].getValueText("exponent")):c.html(e[b].invertText(c.text())))},updateCtxMenuRows:function(){var a=this.equationManager,d=c.EquationManager.MODES,e=a.model.get("mode"),f=a.model.get("isParenthesesAllowed"),g=null,h=b.Marquee.CTX_ITEM_ID,i=this,j=[];0!==a.marqueeSelectedItems.length&&(g=a.marqueeSelectedItems[0].model.get("bDenominator"),j=_.map(h,function(a,b,c){return i.idPrefix+a}),this.ctxMenu.editContextMenu(j,!0),j=[],e===d.BuildMode?(a.allEmptyInMarquee()||j.push(h.DELETE_TILE),f&&(this.equationManager.isPosParensEnabled&&j.push(h.ADD_POS_PARENS),this.equationManager.isNegParensEnabled&&j.push(h.ADD_NEG_PARENS))):(!a.isNumeratorEmpty()&&(!g&&this.tilesAvailableForCombine()||g)&&j.push(h.COMBINE_NUM),!a.isDenominatorEmpty()&&(g&&this.tilesAvailableForCombine()||!g)&&j.push(h.COMBINE_DEN),this.toShowMoveAcrossVinculum()&&j.push(h.REPOS_ACROSS_VINCULUM)),j=_.map(j,function(a,b){return i.idPrefix+a}),this.ctxMenu.editContextMenu(j,!1))},tilesAvailableForCombine:function(a){var b=this.equationManager,c=b.marqueeSelectedItems[0].model.get("bDenominator");return a?0!==_.difference(_.uniq(b.getAllBaseViews()),_.uniq(b.getAllMarqueeViews())).length:0!==_.difference(_.uniq(b.getAllBaseViews(c)),_.uniq(b.getAllMarqueeViews())).length},toShowMoveAcrossVinculum:function(){var a=c.TileItem.BinTileType,b=this.equationManager.equationView.model,d=b.at(0).get("type");return d===a.FRACTION||d===a.BIG_PARENTHESIS},updateCtxMenuRowsTut:function(){var a=this.equationManager,d=c.EquationManager.MODES,e=a.model.get("mode"),f=b.Marquee.CTX_ITEM_ID,g=a.accTutSourceData,h=a.accTutDestData,i=null,j=null,k=null,l=null,m=c.TileItem.BinTileType,n=MathInteractives.Common.Components.Theme2.Models.TutorialPlayer.METHOD_ENUM_INVERSE,o=this,p=[];_.isEmpty(h)||(i=h.sourceView,j=i.model.get("type")),_.isEmpty(g)||(k=g.sourceView,l=k.model.get("type")),p=_.map(f,function(a,b,c){return o.idPrefix+a}),this.ctxMenu.editContextMenu(p,!0),p=[],e===d.BuildMode&&j===m.MARQUEE&&g.operation===n._promptUserToDrag?p.push(f.ADD_NEG_PARENS):e!==d.SolveMode||j!==m.BASE_EXPONENT||g.operation!==n._promptUserToDrag||l!==m.MARQUEE||i.model.get("bDenominator")||p.push(f.COMBINE_NUM),p=_.map(p,function(a,b){return o.idPrefix+a}),this.ctxMenu.editContextMenu(p,!1)},keydownHandler:function(a){a.preventDefault(),a.stopPropagation();var c=b.EquationManager.KEY,d=this.equationManager;if(this.$marqueeDiv.is(":visible"))switch(a.which){case c.LEFTARROW:case c.RIGHTARROW:this.equationManager.handleMarqueeAcc(a);break;case c.ESCAPE:if(d._tutorialMode){this.handleEscMarqueeTutorial();break}case c.TAB:if(d._tutorialMode){this.handleTabMarqueeTutorial();break}this.equationManager.removeMarqueeAcc(!0);break;case c.SPACE:this._handleSpaceMarqueeAcc(a)}},_handleSpaceMarqueeAcc:function(a){this.isFirstSpacePress(a)&&(this.equationManager._tutorialMode?this.startFirstSpaceOpTut(a):this.startFirstSpaceOp(a))},isFirstSpacePress:function(a){var c=b.EquationManager.KEY,d=this.equationManager;return a.which===c.SPACE&&!d.isMarqueeSelectedForOp&&d.marqueeSelectedItems.length>0},startFirstSpaceOp:function(){var a=this.equationManager,d=c.EquationManager.MODES,e=a.model.get("mode"),f=a.marqueeSelectedItems;e!==d.BuildMode&&this.tilesAvailableForCombine(!0)&&(a.trigger(b.EquationManager.EVENTS.TILE_DRAGGING_START),a.isMarqueeSelectedForOp=!0,a.tileSelected=!0,a.tutorialCustomTileString="",f[0].continueAcc())},startFirstSpaceOpTut:function(){var a=this.equationManager,d=c.EquationManager.MODES,e=a.model.get("mode"),f=a.accTutSourceData,g=a.accTutDestData,h=null,i=null,j=null,k=null;e!==d.BuildMode&&(a._isInvalidMarqueeForTutorial()||(_.isEmpty(g)||(h=g.sourceView,i=h.model.get("type")),_.isEmpty(f)||(j=f.sourceView,k=j.model.get("type")),a.trigger(b.EquationManager.EVENTS.TILE_DRAGGING_START),a.isMarqueeSelectedForOp=!0,a.tileSelected=!0,a.tutorialCustomTileString="",h.startAcc(!0),this.$marqueeDiv.trigger("dragstart")))},handleTabMarqueeTutorial:function(){var a=this.equationManager,b=c.EquationManager.MODES,d=a.model.get("mode");d===b.BuildMode?this.setFocus("tutorial-replay-btn"):this.setFocus("tutorial-solve-mode-replay-btn")},handleEscMarqueeTutorial:function(){var a=this.equationManager,b=c.EquationManager.MODES,d=a.model.get("mode");d===b.BuildMode?this.setFocus("tutorial-droppable-region"):this.setFocus("workspace-scrollable"),a._isInvalidMarqueeForTutorial()&&a.removeMarqueeAcc()},ctxMenuHideHandler:function(){this.$marqueeDiv.find(".selected-elements-cover").focus()},ctxMenuSelectHandler:function(a,b){var c=b.currentTarget.id,d=parseInt(c.substring(c.lastIndexOf("-")+1),10);switch(d){case 0:this.deleteTilesAcc();break;case 1:this.addParenthesesAcc(-1);break;case 2:this.addParenthesesAcc(1);break;case 4:this.combineCtxAcc(!1);break;case 5:this.combineCtxAcc(!0);break;case 6:this.moveAcrossVinculumAcc(),this.equationManager.removeMarqueeAcc()}},moveAcrossVinculumAcc:function(){var a,b=this.equationManager,d=b.marqueeSelectedItems,e=d[0].model.get("bDenominator"),f=d[0].parent,g=c.TileItem.SolveTileType,h={};f.model.get("type")!==g.FRACTION&&(f=f.parent),a=f.getNumeratorLength(f.arrTileViews),e?h.index=f.getIndex(f.arrTileViews[a-1]):h.index=f.getIndex(f.arrTileViews[f.arrTileViews.length-1]),h.sourceTile=d[0],h.isDestDeno=!e,h.isLeft=!1,h.numOfTiles=d.length,h.strOperator="*",b.onRepositionTile(h),b.solveModeSetFocusOnTooltip()},combineCtxAcc:function(a){var d=this.equationManager;c.EquationManager.MODES,d.model.get("mode"),d.marqueeSelectedItems;d.trigger(b.EquationManager.EVENTS.TILE_DRAGGING_START),d.isMarqueeSelectedForOp=!0,d.tileSelected=!0,d.tutorialCustomTileString="",d.accCombineOnFraction(a),this.$marqueeDiv.trigger("dragstart")},focusAcc:function(){var a=this.$marqueeDiv.find(".selected-elements-cover");a.length>0&&a.focus()},marqueeFocusin:function(a){if(!MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile&&(this.focusRect&&this.focusRect.remove(),this._isAcc)){this.focusRect=$('<div class="marquee-focus-rect"></div>').appendTo(this.$marqueeDiv);var b=this.$marqueeDiv,c=this.focusRect,d=4;c.css({width:b.width()+d,height:b.height()+d,outline:"rgb(170, 170, 170) dotted 2px"}),c.position({my:"center",at:"center",of:b}),this.setMarqueeText()}},marqueeFocusout:function(a){this.focusRect&&this.focusRect.remove()},setMarqueeText:function(){var a=this.equationManager,b=a.marqueeSelectedItems,c=this.$marqueeDiv.find(".selected-elements-cover"),d=0,e="";if(c.length>0){for(d=0;d<b.length;d++)e+=b[d].getSelfAccString(),d!==b.length-1&&(e+=" "+this.getMessage("base-exp-pair",2)+" ");c.text(e)}}},{createMarquee:function(a){if(a){var b=new MathInteractives.Common.Components.Models.EquationManager.Marquee(a),c=new MathInteractives.Common.Components.Views.EquationManager.Marquee({model:b,el:a.player.$el,equationManager:a.equationManager});return c}},EVENTS:{MARQUEE_MOUSEDOWN:"marquee-mousedown",resize:"marquee-resize",move:"marquee-move",start:"marquee-select-start",end:"marquee-end",ChangeSelectorClass:"change-selector-class"},FRACTION_CLASSES:{NUMERATOR:"fraction-component-numerator",DENOMINATOR:"fraction-component-denominator"},createCustomEventObject:function(a,b,c){return{originalEvent:a,selectedItems:b,optionalParams:c}},bDocumentEventAttached:!1,CTX_ITEM_ID:{DELETE_TILE:"marquee-context-menu-0",ADD_NEG_PARENS:"marquee-context-menu-1",ADD_POS_PARENS:"marquee-context-menu-2",REMOVE_PARENS:"marquee-context-menu-3",COMBINE_NUM:"marquee-context-menu-4",COMBINE_DEN:"marquee-context-menu-5",REPOS_ACROSS_VINCULUM:"marquee-context-menu-6"}}),a=b.Marquee}(),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager;a.FormExpressionEquationManager=a.EquationManager.extend({takenBases:[],allBases:[],takenParNum:[],takenParDen:[],baseLocations:[],isSelectedTileExponent:!1,tutorialCustomTileString:"",initialize:function(){a.FormExpressionEquationManager.__super__.initialize.apply(this,arguments)},attachAccessibilityEvents:function(){var b=this;MathInteractives.Common.Components.Theme2.Models.TutorialPlayer.METHOD_ENUM_INVERSE;this.$el.off("keydown.mine").on("keydown.mine",function(c){var d=c.keyCode?c.keyCode:c.charCode;if(b._tutorialMode){if(b.animationOn||"block"===$("#"+b.idPrefix+"animation-progress-div").css("display"))return;if(9===d&&c.shiftKey!==!0)c.preventDefault(),b.accTutSourceData.isBin&&b.accTutSourceData.sourceView&&null===b.selectedTile&&"2"!==b.accTutSourceData.index.charAt(0)?(b.getCurrentAccView().removeAccDiv(),b.trigger(a.FormExpressionEquationManager.EVENTS.TUT_SPACE_PRESSED_GO_TO_BIN,b.accTutSourceData)):(b.getCurrentAccView().removeAccDiv(),b.setFocus("tutorial-replay-btn"));else if(9===d&&c.shiftKey===!0)c.preventDefault();else if(32===d)c.preventDefault(),b.$el.trigger("mousedown").trigger("mouseup").trigger("click"),b.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),b.equationView.tutorialBuildSpacePressed(b.getCurrentAccView(),b.accTutSourceData);else if(27===d){c.preventDefault();var e=b.selectedTile;b.getCurrentAccView()&&b.getCurrentAccView().removeAccDiv(),e?(b.selectedTile=null,b.setFocus(e.attr("id").replace(b.idPrefix,""))):b.equationView.buildStartAcc()}}else if(9===d&&c.shiftKey!==!0)c.preventDefault(),null===b.getCurrentAccView()?b.equationView.buildStartAcc():b.equationView.buildContinueAcc(b.getCurrentAccView());else if(9===d&&c.shiftKey===!0)c.preventDefault(),b.equationView.buildGoPreviousAcc(b.getCurrentAccView());else if(32===d)b.trigger(a.FormExpressionEquationManager.EVENTS.TILE_DRAGGING_START),c.preventDefault(),b.$el.trigger("mousedown").trigger("mouseup").trigger("click"),b.equationView.buildSpacePressed(b.getCurrentAccView());else if(27===d){c.preventDefault();var e=b.selectedTile;b.getCurrentAccView()&&b.getCurrentAccView().removeAccDiv(),e?(b.selectedTile=null,b.setFocus(e.attr("id").replace(b.idPrefix,""))):b.equationView.buildStartAcc()}}),this.player.$el.off("mousedown.mine").on("mousedown.mine",function(a){b.getCurrentAccView()&&a.which})},setFocusToExponentBigParenthesis:function(a,b){var c=this.equationView.getViewFromIndex(a);this.model.set("currentAccView",c),this.isSelectedTileExponent=b,c.startAcc()},getContainerToAppend:function(){return this.$el},onRepositionTile:function(a){},onRepositionIndividualTile:function(a){},onReplaceTile:function(a){var c=b.CommandFactory,d=a.sourceTile,e=a.destTile,f=(d.data(),d.attr("data-tiletype")),g=parseInt(d.attr("data-tilevalue"),10),h=b.TileItem.BinTileType,i=new c.TileLocation(e.parent.getIndex(e),e.model.get("bDenominator")),j={},k=!0,l=!1;if(d.data("cur-draggable")&&(k=!1),!this._isValidDropElementForTutorial(a))return!1;if(k)if(f===h.BASE){if(j.base=g,j.type=f,!this.isBasePresent(j.base,!0,e.model.get("base")))return!1}else f===h.EXPONENT&&(j.exponent=g,j.type=f);return j.source=i,l=this.fireCommand(c.COMMANDS.REPLACE_TILE,j)},onSwapTile:function(a){var c=b.CommandFactory,d=a.sourceTile,e=a.destTile,f={},g=!1;return this._isValidDropElementForTutorial(a)?(f.source=new c.TileLocation(d.parent.getIndex(d),1,d.model.get("bDenominator")),f.dest=new c.TileLocation(e.parent.getIndex(e),1,e.model.get("bDenominator")),f.type=a.type,g=this.fireCommand(c.COMMANDS.SWAP_TILE,f)):!1},onCombineTiles:function(a,c,d){var e=a.data(),f=c.parent.getIndex(c),g=c.model.get("bDenominator");return this._isValidDropElementForTutorial(e)?void(e.tiletype===b.TileItem.BinTileType.PARENTHESES?(e.isDenominator=g,this.onAddTile(e,f)):(e.tiletype===b.TileItem.BinTileType.BASE?e.base=e.tilevalue:e.tiletype===b.TileItem.BinTileType.EXPONENT&&(e.exponent=e.tilevalue),e.type=e.tiletype)):!1},onShiftParenthesis:function(c){var d,e=b.CommandFactory,f=c.sourceTile,g=c.destTile,h={},i=!1,j=f.model.get("bDenominator"),k=g.model.get("bDenominator");return this._isValidDropElementForTutorial(c)?(h.source=new e.TileLocation(f.parent.getIndex(f),1,j),h.dest=new e.TileLocation(g.parent.getIndex(g),1,k),d=g.parent.getIndex(g).split("."),d.pop(),this.equationView.model.getItemFromIndex(d.join(".")).get("type")===b.TileItem.BinTileType.PARENTHESIS?(this.trigger(a.FormExpressionEquationManager.EVENTS.NESTED_PARENTHESIS_CASE),!1):j!==k&&this.isParenthesisDroppable(g.model.get("bDenominator"),1)===!1?!1:i=this.fireCommand(e.COMMANDS.SHIFT_PARENTHESES,h)):!1},undo:function(){this.commandFactory.undo(),this.getEquationStatusModifyBin()},setData:function(b,c){this.resetData();var d=MathInteractives.Common.Components.Models.EquationManager,e=new d.EquationComponent(b.equationData),f=null;if(this.equationView=new a.EquationView({model:e,equationManager:this,player:b.player,filePath:b.filePath,manager:b.manager,idPrefix:b.idPrefix}),c!==!0&&(f=this.equationView.model.getEquationInLatexForm(),this.model.get("equationLatexStack").push(f)),!b.equationViewContainer)throw new Error("Provide EquationView container");this.equationView.setEquationContainer(b.equationViewContainer);var g={modelRef:this.equationView.model,allowedOperation:b.cmdFactoryData.allowedOperation||this.model.get("allowedOperation"),maxPrimeLimit:b.cmdFactoryData.maxPrimeLimit||this.model.get("maxPrimeLimit")};this.commandFactory.setData(g)},resetData:function(){this.equationView&&(this.equationView.reset(),this.equationView=null),this.marqueeSelectedItemsIndex=[],this.marqueeSelectedItems=[],this.commandFactory.resetData(),this._removeAllTooltips(),this.model.set("currentAccView",null),this.tileSelected=null,this.selectedTile=null},fireCommand:function(c,d){var e,f=null,g=null,h=b.CommandFactory,i=new h.Rules(this.commandFactory.get("allowedOperation"),this.commandFactory.get("maxPrimeLimit"));return e=this.commandFactory.execute(c,i,d),e&&(this.getEquationStatusModifyBin(),f=this.equationView.model.getEquationInLatexForm(),this.model.get("equationLatexStack").push(f),g=this.equationView.getTileContentInHtmlForm(),this.trigger(a.EquationManager.EVENTS.COMMAND_FIRED,e)),e},isParenthesisExponentDraggable:function(){return!0},getEquationStatusModifyBin:function(){var b=this.equationView.model,c=b.getAllBases(),d=b.getAllBaseLocations(),e=b.getAllParenthesis();this.trigger(a.FormExpressionEquationManager.EVENTS.STACK_STATUS,this.commandFactory.get("undoStack")),this.baseLocations=d,this.allBases=c,this.trigger(a.FormExpressionEquationManager.EVENTS.DISABLE_ENABLE_BIN_BASES,c),this.trigger(a.FormExpressionEquationManager.EVENTS.DISABLE_ENABLE_BIN_PARENTHESIS,e),this.trigger(a.FormExpressionEquationManager.EVENTS.DONE_BUTTON_STATUS)},getTileStatus:function(){var a=this.equationView.model;return a.getTileStatus()},setBaseArray:function(a){this.takenBases=a},getBaseArray:function(){return this.takenBases},resetTileCounters:function(){this.takenBases=[],this.takenParNum=[],this.takenParDen=[],this.baseLocations=[]},setParArray:function(a){var b;for(this.takenParDen=[],this.takenParNum=[],b=0;b<a.length;b++)a[b]%2===0?this.takenParDen.push(a[b]/2):this.takenParNum.push(a[b])},isParenthesisDroppable:function(b,c){return(void 0===c||null===c)&&(c=1),b===!0?this.takenParDen.length+c>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_PARENTHESIS_DEN?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_PARENTHESIS_REACHED),!1):!0:this.takenParNum.length+c>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_PARENTHESIS_NUM?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_PARENTHESIS_REACHED),!1):!0},isBasePresent:function(b,c,d){var e;return 0===this.takenBases.length?!0:-1===this.takenBases.indexOf(b)?c&&(e=_.countBy(this.allBases,function(a){return a===d?"presence":"others"}),e.presence<=1)?!0:(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_UNIQUE_BASES_LIMIT_REACHED),!1):!0},checkBaseLocations:function(b,c,d){var e,f,g=this.baseLocations,h=0,i=0,j=0,k=0;for(d=d?d:0,e=0;e<g.length;e++)f=g[e],f===!1?h++:f===!0?i++:1===f?j++:k++;return b===!1&&h+c+j+d>a.FormExpressionEquationManager.NUM_OF_TILES.NUMERATOR?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_BASE_REACHED_IN_NUM_DEN),!1):b===!0&&i+c+k+d>a.FormExpressionEquationManager.NUM_OF_TILES.DENOMINATOR?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_BASE_REACHED_IN_NUM_DEN),!1):!0},checkParenthesisExponent:function(){return this.equationView.model.checkParentesisExponent()},_validateBuildModeReposition:function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p=c.index,q=d.index,r=c.isDenominator,s=d.isDenominator,t=c.numOfTiles,u=this.equationView.model;if(l=u.getItemFromIndex(p),o=u.getItemFromIndex(q),m=this._getParentTiles(u,p),n=this._getParentTiles(u,q),j=m.get("tileArray"),k=n.get("tileArray"),e=l.get("type"),f=o.get("type"),g=m.get("type"),h=n.get("type"),i=this._isAnyTileOtherThanBaseExpPresent(p,t),r!==s){if(h===b.TileItem.BinTileType.PARENTHESIS){if(i>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_NESTED_PARENTHESIS)return this.trigger(a.FormExpressionEquationManager.EVENTS.NESTED_PARENTHESIS_CASE),!1;if(null===o.get("base")&&null===o.get("exponent"))return t>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_BASES_INSIDE_PARENTHESIS?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_TERMS_ALLOWED_IN_PARENTHESIS),!1):this.checkBaseLocations(s,t,-1);if(t+k.length>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_BASES_INSIDE_PARENTHESIS)return this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_TERMS_ALLOWED_IN_PARENTHESIS),!1}return f===b.TileItem.BinTileType.BASE_EXPONENT&&null===o.get("base")&&null===o.get("exponent")?this.checkBaseLocations(s,t,-1):i>0?(t=this._baseExpTilesInMarquee(p,t),this.isParenthesisDroppable(s,i)===!0?this.checkBaseLocations(s,t):!1):this.checkBaseLocations(s,t)}if(j===k)return!0;if(h===b.TileItem.BinTileType.PARENTHESIS){if(i>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_NESTED_PARENTHESIS)return this.trigger(a.FormExpressionEquationManager.EVENTS.NESTED_PARENTHESIS_CASE),!1;if(null===o.get("base")&&null===o.get("exponent"))return t>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_BASES_INSIDE_PARENTHESIS?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_TERMS_ALLOWED_IN_PARENTHESIS),!1):this.checkBaseLocations(s,0,-1);if(t+k.length>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_BASES_INSIDE_PARENTHESIS)return this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_TERMS_ALLOWED_IN_PARENTHESIS),!1}return g===b.TileItem.BinTileType.PARENTHESIS?t===j.length?this.checkBaseLocations(s,1):this.checkBaseLocations(s,0):void 0},_validateBuildModeIndividualReposition:function(c,d,e){var f,g,h,i,j,k,l,m,n,o=c.index,p=d.index,q=c.isDenominator,r=d.isDenominator,s=1,t=this.equationView.model,u=!1;return l=t.getItemFromIndex(o),m=this._getParentTiles(t,o),n=this._getParentTiles(t,p),j=m.get("tileArray"),k=n.get("tileArray"),f=l.get("type"),g=n.get("type"),h=m.get("type"),i=n.get("type"),null!==l.get("base")&&null!==l.get("exponent")||f!==b.TileItem.BinTileType.BASE_EXPONENT||(u=!0),q===r?j===k?u===!0?!0:this.checkBaseLocations(r,s):i===b.TileItem.BinTileType.PARENTHESIS&&s+k.length>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_BASES_INSIDE_PARENTHESIS?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_TERMS_ALLOWED_IN_PARENTHESIS),!1):h===b.TileItem.BinTileType.PARENTHESIS&&s===j.length?this.checkBaseLocations(r,s):u===!0?this.checkBaseLocations(r,0):this.checkBaseLocations(r,s):i===b.TileItem.BinTileType.PARENTHESIS&&s+k.length>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_BASES_INSIDE_PARENTHESIS?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_TERMS_ALLOWED_IN_PARENTHESIS),!1):this.checkBaseLocations(r,s)},validateTileAddition:function(c){var d,e,f,g=c.index,h=this.equationView.model,i=1,j=c.isDenominator;return e=this._getParentTiles(h,g),d=e.get("tileArray"),f=e.get("type"),f===b.TileItem.BinTileType.PARENTHESIS&&i+d.length>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_BASES_INSIDE_PARENTHESIS?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_TERMS_ALLOWED_IN_PARENTHESIS),!1):this.checkBaseLocations(j,i)},validateMarqueeAndParenthesisAddition:function(b){var c=b.index,d=(this.equationView.model,b.numOfTiles);return d>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_BASES_INSIDE_PARENTHESIS?(this.trigger(a.FormExpressionEquationManager.EVENTS.MAX_TERMS_ALLOWED_IN_PARENTHESIS),!1):this._isAnyTileOtherThanBaseExpPresent(c,d)>a.FormExpressionEquationManager.NUM_OF_TILES.MAX_NESTED_PARENTHESIS?(this.trigger(a.FormExpressionEquationManager.EVENTS.NESTED_PARENTHESIS_CASE),!1):!0},_baseExpTilesInMarquee:function(a,c){var d,e,f,g=[],h=0;for(d=0;c>d;d++)g=a.split("."),e=parseInt(g[g.length-1],10),g.pop(),g.push(""+(e+d)),f=this.equationView.model.getItemFromIndex(g.join(".")),h+=f.getChildBases(b.TileItem.BinTileType.BASE_EXPONENT);return h},_isAnyTileOtherThanBaseExpPresent:function(a,c){var d,e,f=[],g=0;for(d=0;c>d;d++)f=a.split("."),e=parseInt(f[f.length-1],10),f.pop(),f.push(""+(e+d)),this.equationView.model.getItemFromIndex(f.join(".")).get("type")!==b.TileItem.BinTileType.BASE_EXPONENT&&g++;return g},_getParentTiles:function(a,b){return b=this.getParentIndex(b),a.getItemFromIndex(b)},getParentIndex:function(a){if(1===a.length)return"";var b=a.lastIndexOf(".");return a.substring(0,b)}},{EVENTS:{DISABLE_ENABLE_BIN_BASES:"disable-enable-bin-bases",DISABLE_ENABLE_BIN_PARENTHESIS:"disable-enable-bin-parenthesis",STACK_STATUS:"stack-status",MAX_UNIQUE_BASES_LIMIT_REACHED:"max-base-limit-reached",MAX_BASE_REACHED_IN_NUM_DEN:"max-base-reached-in-num-den",DONE_BUTTON_STATUS:"done-btn-status",NESTED_PARENTHESIS_CASE:"nested-parenthesis-case",MAX_PARENTHESIS_REACHED:"max-parenthesis-reached",MAX_TERMS_ALLOWED_IN_PARENTHESIS:"max-terms-allowed-in-parenthesis",UPDATE_EQUATION_DATA:"update-equation-data",TUT_SPACE_PRESSED_GO_TO_BIN:"tut-space-pressed-go-to-bin"},NUM_OF_TILES:{NUMERATOR:3,DENOMINATOR:3,MAX_PARENTHESIS_NUM:2,MAX_PARENTHESIS_DEN:2,MAX_NESTED_PARENTHESIS:0,MAX_BASES_INSIDE_PARENTHESIS:2}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager.TileItem;a.EquationComponent=a.TileItem.extend({defaults:$.extend(!0,{},b.prototype.defaults,{type:b.SolveTileType.EQUATION_COMPONENT}),operatorStack:[],postfixModels:[],initialize:function(){a.EquationComponent.__super__.initialize.apply(this,arguments);var b,c=0,d=[],e=a.TileItem;for(null===this.get("tileArray")&&this.set("tileArray",[]),b=this.get("tileArray"),c=0;c<b.length;c++)d[c]=e.createTileItem(b[c]);this.set("tileArray",new Backbone.Collection(d))},getItemFromIndex:function(a){var b,c,d=this.get("tileArray");return a?(b=a.split("."),c=parseInt(b[0],10),b.splice(0,1),d.at(c)?this.get("tileArray").at(c).getItemFromIndex(b.join(".")):null):""===a?this:null},getEquationInLatexForm:function(){var a=this.get("tileArray"),b=a.length,c=0,d=null,e="";for(c=0;b>c;c++)d=a.models[c],e+=d.getTileContentInLatexForm();return{equationLatexString:e}},printExpr:function(){var a=this.get("tileArray"),b=0,c="";for(b=0;b<a.length;b++)c+=a.at(b).printExpr();return c}},{Operations:{REPOSITION_TILE:1,CLICK_EXP:2,MARQUEE_SELECT_AND_COMBINE:4,COMBINE_SAME_BASE:8,BREAK_BASE_EXP_1:16,ZERO_EXP_DIRECT_CONVERT:32,ZERO_EXP_SHOW:64,DIVIDE_EQUAL_TERMS_HAVING_BASE_EXP_1_BASE_EXP_ANY:128,DIVIDE_SIMILAR_TERMS_WITH_SAME_EXP:256,PRIME_TO_COMPOSITE_EXP_ANY:512,BREAK_BASE_EXP_ANY:1024,PARENTHESIS_EXP_ALL:2048},ALLOWED_EXPONENTS:[-3,-2,-1,2,3]})}(),function(a){"use strict";var b=a.Common.Components.Models.EquationManager;b.BaseTile=b.TileItem.extend({defaults:$.extend(!0,{},b.TileItem.prototype.defaults,{type:b.TileItem.SolveTileType.BASE_ONLY,isDraggable:!0,isDroppable:!0,ignoreMarquee:!1}),initialize:function(){},getItemFromIndex:function(a){return""===a?this:null},getTileContentInLatexForm:function(){var a=this.get("operator"),b="",c=this.get("base");return"*"===a&&(a="\\cdot "),b+=a||"",b+=c},printExpr:function(){var a="";return a=this.get("operator")||"",a+=this.get("base")},getIndexFromItem:function(a){return-1},getAllBases:function(){var a=this.get("base");return null!==a&&this.isOne()===!1?[a]:[]},isNegativeExpPresent:function(){return!0},isParenthesisPresent:function(){return!1},isOne:function(){return 1===this.get("base")&&!this.get("isDraggable")},isExpAbsOne:function(){return!1}})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManager;b.BaseExpTile=b.TileItem.extend({defaults:$.extend(!0,{},b.TileItem.prototype.defaults,{type:b.TileItem.SolveTileType.BASE_EXPONENT}),initialize:function(){b.BaseExpTile.__super__.initialize.apply(this,arguments)},getItemFromIndex:function(a){return""===a?this:null},printExpr:function(){var a="";return a=this.get("operator")||"",a=a+this.get("base")+"^"+this.get("exponent")},getTileContentInLatexForm:function(){var a=this.get("operator"),b="",c=this.get("base"),d=this.get("exponent");return"*"===a&&(a="\\cdot "),b+=a||"",b+=c,null!==d&&((d>9||0>d)&&(d="{"+d+"}"),b+="^"+d),b},getAllBases:function(){var a=this.get("base");return null!==a?[a]:[];
},getIndexFromItem:function(a){return-1},isNegativeExpPresent:function(){return this.get("exponent")<=0?!1:!0},isParenthesisPresent:function(){return!1},isExpAbsOne:function(){return 1===Math.abs(this.get("exponent"))}},{TILE_TYPES:{BASE:0,EXPONENT:1,BASE_EXPONENT:2}})}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager;a.ParenthesisTile=a.TileItem.extend({defaults:$.extend(!0,{},a.TileItem.prototype.defaults,{arrChilds:null,type:a.TileItem.SolveTileType.PARENTHESIS}),operatorStack:[],postfixModels:[],initialize:function(){a.ParenthesisTile.__super__.initialize.apply(this,arguments);var b,c=[],d=[];if(null===this.get("tileArray")&&this.set("tileArray",[]),c=this.get("tileArray"),c instanceof Array){for(b=0;b<c.length;b++)d[b]=a.TileItem.createTileItem(c[b]);this.set("tileArray",new Backbone.Collection(d))}},onRemoveTiles:function(){0===this.get("tileArray").length&&this.collection.remove(this)},getItemFromIndex:function(a){var b,c;return a?(b=a.split("."),c=parseInt(b[0],10),b.splice(0,1),this.get("tileArray").at(c).getItemFromIndex(b.join("."))):""===a?this:null},getIndexOfItem:function(a){for(var b=0,c=this.get("tileArray");b<c.length;b++)return a.getLeft()>c.models[b].get("rectTerm").getLeft()?this.get("tileArray").at(b).getIndexOfItem(a):this;return null},getAllParenthesis:function(){var b,c,d,e=this.get("tileArray"),f=[],g=a.TileItem.SolveTileType;for(this.get("bDenominator")?f.push(2*this.get("coefficient")):f.push(this.get("coefficient")),b=0;b<e.length;b++)c=e.at(b),d=c.get("type"),d!==g.BASE_EXPONENT&&d===g.BASE_ONLY&&(f=f.concat(c.getAllParenthesis()));return f},isParenthesisPresent:function(){return!0},checkParentesisExponent:function(){return null===this.get("exponent")?!1:!0},printExpr:function(){var a=0,b=this.get("exponent"),c=this.get("tileArray"),d=this.get("operator")||"";for(d+=this.get("coefficient"),d+="(",a=0;a<c.models.length;a++)d+=c.at(a).printExpr();return d=d+")^"+b},hasFractionChild:function(){var b=this.get("tileArray").where({type:a.TileItem.SolveTileType.FRACTION});return 0===b.length?!1:!0},getTileContentInLatexForm:function(){var a,b=this.get("operator"),c="",d=this.get("tileArray"),e=this.get("exponent");for("*"===b&&(b="\\cdot "),c+=b||"",c+="\\left(",a=0;a<d.length;a++)c+=d.models[a].getTileContentInLatexForm();return c+="\\right)",null!==e&&((e>9||0>e)&&(e="{"+e+"}"),c+="^"+e),c},isEmpty:function(b){var c=!0,d=this.get("tileArray"),e=a.TileItem.BinTileType,f=this.get("exponent"),g=0;if(null!==f&&void 0!==f&&(c=!1),b===e.EXPONENT)return c;for(g=0;g<d.length;g++)d.at(g).isEmpty()||(c=!1);return c},isNegativeExpPresent:function(){return this.get("exponent")<=0?!1:!0}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager;a.BigParenthesisTile=a.ParenthesisTile.extend({defaults:$.extend(!0,{},a.TileItem.prototype.defaults,{arrChilds:null,type:a.TileItem.SolveTileType.BIG_PARENTHESIS}),operatorStack:[],postfixModels:[],initialize:function(){a.BigParenthesisTile.__super__.initialize.apply(this,arguments);var b,c=[],d=[];if(null===this.get("tileArray")&&this.set("tileArray",[]),c=this.get("tileArray"),c instanceof Array){for(b=0;b<c.length;b++)d[b]=a.TileItem.createTileItem(c[b]);this.set("tileArray",new Backbone.Collection(d))}},getAllParenthesis:function(){var b,c,d,e=this.get("tileArray"),f=a.TileItem.SolveTileType,g=[];for(b=0;b<e.length;b++)c=e.at(b),d=c.get("type"),d!==f.BASE_EXPONENT&&d!==f.BASE_ONLY&&(g=g.concat(c.getAllParenthesis()));return g},isParenthesisPresent:function(){return!0},checkParentesisExponent:function(){if(null===this.get("exponent"))return!1;var b,c,d,e=this.get("tileArray"),f=a.TileItem.SolveTileType;for(b=0;b<e.length;b++)if(c=e.at(b),d=c.get("type"),d!==f.BASE_EXPONENT&&d!==f.BASE_ONLY&&c.checkParentesisExponent()===!1)return!1;return!0},isNegativeExpPresent:function(){if(this.get("exponent")<=0)return!1;var a,b,c=this.get("tileArray");for(a=0;a<c.length;a++)if(b=c.at(a),b.isNegativeExpPresent()===!1)return!1;return!0}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager;a.FractionTile=a.TileItem.extend({defaults:$.extend(!0,{},a.TileItem.prototype.defaults,{type:a.TileItem.SolveTileType.FRACTION}),operatorStack:[],postfixModels:[],initialize:function(){a.FractionTile.__super__.initialize.apply(this,arguments);var b,c=[],d=[];if(null===this.get("tileArray")&&this.set("tileArray",[]),c=this.get("tileArray"),c instanceof Array){for(b=0;b<c.length;b++)d[b]=a.TileItem.createTileItem(c[b]);this.set("tileArray",new Backbone.Collection(d))}},getItemFromIndex:function(a){var b,c,d=this.get("tileArray");return a?(b=a.split("."),c=parseInt(b[0],10),b.splice(0,1),d.at(c)?this.get("tileArray").at(c).getItemFromIndex(b.join(".")):null):""===a?this:null},getIndexOfItem:function(a){for(var b=0,c=this.get("tileArray");b<c.length;b++)return a.getLeft()>c.models[b].get("rectTerm").getLeft()?this.get("tileArray").at(b).getIndexOfItem(a,b):this;return null},getAllParenthesis:function(){var b,c,d,e=this.get("tileArray"),f=a.TileItem.SolveTileType,g=[];for(b=0;b<e.length;b++)c=e.at(b),d=c.get("type"),d!==f.BASE_EXPONENT&&d!==f.BASE_ONLY&&(g=g.concat(c.getAllParenthesis()));return g},printExpr:function(){var a=0,b=(this.get("exponent"),this.get("tileArray")),c=this.get("operator")||"";for(a=0;a<b.length&&b.at(a).get("bDenominator")===!1;a++)c+=b.at(a).printExpr();for(c+="\n---------------------------------\n";a<b.length;a++)c+=b.at(a).printExpr();return c},getTileContentInLatexForm:function(){var a,b=this.get("operator"),c="",d=this.get("tileArray");for("*"===b&&(b="\\cdot "),c+=b||"",c+="\\frac{",a=0;a<d.length;a++)d.models[a].get("bDenominator")||(c+=d.models[a].getTileContentInLatexForm());for(c+="}{",a=0;a<d.length;a++)d.models[a].get("bDenominator")&&(c+=d.models[a].getTileContentInLatexForm());return c+="}"},isNumeratorEmpty:function(){var a=this.get("tileArray"),b=a.where({bDenominator:!1}),c=b.length;return 0===c},isDenominatorEmpty:function(){var a=this.get("tileArray"),b=a.where({bDenominator:!0}),c=b.length;return 0===c}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManager,b=MathInteractives.Common.Components.Views.EquationManager,c=MathInteractives.Common.Utilities.Models.Rect,d=MathInteractives.Common.Utilities.Models.Point;b.TileView=MathInteractives.Common.Player.Views.Base.extend({arrTileViews:null,$arrOperatorViews:null,equationManager:null,parent:null,isDragging:!1,level:null,getLevel:function(){return this.level},setLevel:function(a,b){if(a!==this.level){var c=this.level;this.level=a,b&&this.onLevelChange(c)}},$base:null,$exponent:null,curHoveredTile:null,isTileDelete:!1,initialize:function(){var a=this.options;this.player=a.player,this.filePath=a.filePath,this.manager=a.manager,this.idPrefix=a.idPrefix,this.parent=a.parent,this.equationManager=this.options.equationManager,this.curHoveredTile=null,null!==this.parent&&void 0!==this.parent&&this.setLevel(this.parent.getLevel()+1),this.render()},render:function(){throw new Error("Render not implemented")},createView:function(){throw new Error("createView not implemented")},getIndex:function(a){var b=this.arrTileViews.indexOf(a);return this.parent.getIndex(this)+"."+b},stopListeningEvents:function(a){if(a)for(var b=0;b<this.arrTileViews.length;b++)this.arrTileViews[b].stopListeningEvents(!0);this.stopListening()},getViewFromIndex:function(a){var b,c=a.indexOf(".");return c=-1===c?this.arrTileViews.length:c,b=parseInt(a.substring(0,c)),a.length>1?(a=a.substring(c+1,a.length),""===a?this.arrTileViews[b]:this.arrTileViews[b].getViewFromIndex(a)):this.arrTileViews[b]},getTreeHeight:function(){return 1},hasChildView:function(a,b){var c=this.arrTileViews,d=0;if(-1!==c.indexOf(a))return!0;if(b)for(;d<c.length;d++)if(c[d].hasChildView(a))return!0;return!1},getChildViews:function(){var a=[this],b=0;if(this.arrTileViews&&this.arrTileViews.length>0)for(b=0;b<this.arrTileViews.length;b++)Array.prototype.push.apply(a,this.arrTileViews[b].getChildViews());return _.uniq(a)},refresh:function(){var a=this.arrTileViews,b=0;if(a)for(b=0;b<a.length;b++)a[b].refresh()},isEmptyInView:function(){return!1},fillRects:function(){this.model.set("rectTerm",new c({left:0,top:0,width:0,height:0})),this.model.set("rectBase",new c({left:0,top:0,width:0,height:0})),this.model.set("rectExponent",new c({left:0,top:0,width:0,height:0}))},changeOperatorArray:function(a,b){var c,d,e,f;c=this.model.get("tileArray"),d=c.indexOf(a),f=this.$arrOperatorViews[d],f&&(f.remove(),f.off()),e=this.createOperator(a.get("operator")),null!==e&&(e.insertBefore(this.arrTileViews[d].el),this.$arrOperatorViews[d]=e)},onLevelChange:function(a){throw new Error("Not Implemented onLevelChange")},attachEvents:function(){},attachEventsAcc:function(){var a=MathInteractives.global.ContextMenu,b={HIDE:a.CONTEXTMENU_HIDE,OPEN:a.CONTEXTMENU_OPEN,SELECT:a.CONTEXTMENU_SELECT};this.accDiv.off(b.HIDE).on(b.HIDE,$.proxy(this.ctxMenuHideHandler,this)),this.accDiv.off(b.OPEN).on(b.OPEN,$.proxy(this.ctxMenuOpenHandler,this)),this.accDiv.off(b.SELECT).on(b.SELECT,$.proxy(this.ctxMenuSelectHandler,this))},detachEventsAcc:function(){this.accDiv.off(MathInteractives.global.ContextMenu.CONTEXTMENU_HIDE),this.accDiv.off(MathInteractives.global.ContextMenu.CONTEXTMENU_OPEN)},ctxMenuHideHandler:function(a,b){},ctxMenuOpenHandler:function(a,b){},resetGreedyChild:function(a){var b=a||this.$el,c=b.draggable("option").scope,d=($.ui.ddmanager.droppables[c]||[]).slice();$.each(d,function(){this.greedyChild&&(this.greedyChild=!1)})},setGreedyChilds:function(a){for(var b=a||this.$el,c=b.droppable("option").scope,d=$.ui.ddmanager.droppables[c]||[],e=0;e<d.length;e++)$.contains(d[e].element[0],b[0])&&(d[e].greedyChild=!0)},onMouseDown:function(a){var b=new d({left:a.clientX,top:a.clientY}),e=null,f=this.arrTileViews||null,g=0;if(null!==f)for(;g<f.length;g++)if(e=new c(f[g].el.getBoundingClientRect()),e=e.inflateRect(10,10),e.isPointInRect(b))return this.$el.draggable("disable"),!0;return!1},onMouseUp:function(a){this.$el.draggable("enable")},onMouseOver:function(b,e){var f=this.arrTileViews,g=0,h=a.TileItem.MultiplicationThresold,i=a.TileItem.AdditionThresold,j=b.originalEvent,k=new d({left:j.clientX,top:j.clientY}),l=null,m=null,n=e.helper.data("cur-draggable");for(this.equationManager.registerMouseOverTile(this,b,e),this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),g=0;g<f.length;g++)if(f[g]!==n){if(l=new c(f[g].el.getBoundingClientRect()),l=l.inflateRect(h,0),l.isPointInRect(k)){m=f[g],k.getLeft()<l.getMiddle().getLeft()?m.$el.addClass("white-border-left"):m.$el.addClass("white-border-right");break}if(l=l.inflateRect(i,0),l.isPointInRect(k)){m=f[g],k.getLeft()<l.getMiddle().getLeft()?m.$el.addClass("white-border-left"):m.$el.addClass("white-border-right");break}}null!==m?(this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=m):(this.$el.removeClass("white-border-left white-border-right").addClass("white-border"),this.curHoveredTile=null)},onMouseOut:function(a,b){this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),this.$el.removeClass("white-border-left white-border-right white-border")},onTileDrop:function(b,e){var f,g,h,i=this.arrTileViews,j=0,k=a.TileItem.MultiplicationThresold,l=a.TileItem.AdditionThresold,m=b.originalEvent,n=new d({left:m.clientX,top:m.clientY}),o=null,p=null,q=-1,r=!0,s="*",t=e.helper.data("cur-draggable"),u=e.helper.data("length"),v=1;for(u&&(v=u),this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),j=0;j<i.length;j++)if(i[j]!==t){if(o=new c(i[j].el.getBoundingClientRect()),o=o.inflateRect(k,0),o.isPointInRect(n)){p=i[j],n.getLeft()<o.getMiddle().getLeft()?(q=j,r=!0):(q=j,r=!1);break}if(o=o.inflateRect(l,0),o.isPointInRect(n)){p=i[j],n.getLeft()<o.getMiddle().getLeft()?(q=j,r=!0):(q=j,r=!1),s="+";break}}this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=null,null!==p?(f=t.parent.getIndex(t),g=t.model.get("bDenominator"),h=this.model.get("bDenominator"),this.equationManager.onRepositionTile(f,g,this.parent.getIndex(this)+"."+q,h,v,s)):this.equationManager.onCombineTiles(t,this,v)},getOperatorFromTileItem:function(a){if(this.arrTileViews){var b=this.arrTileViews.indexOf(a);return this.$arrOperatorViews[b]}return null},isMarqueeDrawing:function(){return this.equationManager.marqueeView.isDrawing},getValueText:function(a){var b=this.model.get(a);return null!==b&&void 0!==b?0>b?"&minus;"+Math.abs(b):b.toString():b},invertText:function(a){var b="";return-1===a.indexOf(b)?b+a:a.substr(b.length)},_getClosedHandCss:function(){return this.equationManager.isTouch()?{}:{cursor:"url('"+this.getImagePath("closed-hand")+"'), move"}},_getOpenHandCss:function(){return this.equationManager.isTouch()?{}:{cursor:"url('"+this.getImagePath("open-hand")+"'), move"}},_getDefaultCursorCss:function(){return this.equationManager.isTouch()?{}:{cursor:"default"}},_getTutorialMouseEventPoint:function(a){a=Number(a);var b=this.el,c=b.getBoundingClientRect(),d=(c.top,c.left,c.height),e=c.width,f=0,g=0,h=10;switch(a){case 2:f-=h,g+=d/2;break;case 3:f+=e+h,g+=d/2;break;case 4:f+=e/2,g-=h;break;case 5:f+=e/2,g+=d+h;break;case 6:f-=h-1,g-=h-1;break;case 7:g+=d+h-1,f+=e+h-1}return{offset:{x:f,y:g},element:b}},disableTiles:function(a){var b,c,d=this.arrTileViews,e=0;if(d&&(e=d.length),e>0&&a)for(var f=0;e>f;f++)b=d[f],b.disableTiles(a),c=this.getOperatorFromTileItem(b),c&&c.addClass("disabled_operator");else this.$el.is(".ui-droppable")&&this.$el.droppable("disable").addClass("custom-droppable-disabled").find(".new-created-tile").removeClass("new-created-tile")},enableDisableTilesItem:function(a,b){var c,d,e=null,f=!1;a&&(c=a.split("|"),e=this.getViewFromIndex(c[0]),e&&(f=e.$exponent?e.$exponent.is(".ui-draggable"):!0,e._enableDisableTile(c[1],b,f),d=this.getOperatorFromTileItem(e),d&&(b?d.removeClass("disabled_operator"):d.addClass("disabled_operator"))))},_enableDisableTile:function(a,b,c){},deActivateEventOnTiles:function(a){var b,c=this.arrTileViews,d=0;if(c&&(d=c.length),d>0&&a)for(var e=0;d>e;e++)b=c[e],b.deActivateEventOnTiles(a)},enableAllOperator:function(a){var b,c,d=this.arrTileViews,e=0;if(d&&(e=d.length),e>0&&a)for(var f=0;e>f;f++)b=d[f],b.enableAllOperator(a),c=this.getOperatorFromTileItem(b),c&&c.removeClass("disabled_operator")},attachEventOnView:function(a,b,c){},getNextTile:function(){if(this.parent){var a=this.parent.arrTileViews.indexOf(this);return this.parent.arrTileViews[a+1]?this.parent.arrTileViews[a+1]:void 0}},getPrevTile:function(){if(this.parent){var a=this.parent.arrTileViews.indexOf(this);return this.parent.arrTileViews[a-1]?this.parent.arrTileViews[a-1]:void 0}},addHoverClassExponent:function(a){this.$exponent.hasClass("no-hover")||this.$exponent.addClass("hover"),a.stopPropagation()},removeHoverClassExponent:function(a){this.$exponent.hasClass("no-hover")||this.$exponent.removeClass("hover")},isInsideParentheses:function(){var b=this.parent,c=a.TileItem.BinTileType;return this.model.get("type")===c.PARENTHESIS?!0:b?b.isInsideParentheses():!1},attachDetachDraggable:function(b,c){var d,e=this.arrTileViews;if(this.equationManager.model.get("mode")===a.EquationManager.MODES.SolveMode&&!this.equationManager._tutorialMode)for(d=0;d<e.length;d++)e[d].attachDetachDraggable(b,c)},hideAccDiv:function(){this.accDiv&&this.accDiv.css("visibility","hidden")},removeAccDiv:function(){this.accDiv&&this.accDiv.remove()}},{createTileItemView:function(c,d,e,f,g,h,i){var j,k=a.TileItem.SolveTileType,l={model:c,parent:d,equationManager:e,player:f,filePath:g,manager:h,idPrefix:i};switch(c.get("type")){case k.BASE_EXPONENT:j=new b.BaseExpTileView(l);break;case k.PARENTHESIS:j=new b.ParenthesisTileView(l);break;case k.FRACTION:j=new b.FractionTileView(l);break;case k.BIG_PARENTHESIS:j=new b.BigParenthesisTileView(l);break;case k.BASE_ONLY:j=new b.BaseTileView(l);break;default:throw new Error("Invalid tile type")}return j},CLASSES:{TermContainer:"term-container",BASE:"base",EXPONENT:"exponent",BASE_ONLY:"base-only",Bracket:"bracket",PARENTHESIS:"parenthesis",BASE_EXPONENT:"base-exponent",COEFFICIENT:"coefficient",LeftBracket:"left-bracket",RightBracket:"right-bracket",FRACTION:"fraction-component",NUMERATOR:"numerator",DENOMINATOR:"denominator",VINICULUM:"viniculum",Level:"level",OperatorContainer:"operator-container",Operator:"operator","*":"multiplication","+":"addition","-":"addition","/":"multiplication"},scroll:{SENSITIVITY:50,SPEED:$.support.touch?40:function(){var a=MathInteractives.Common.Utilities.Models.BrowserCheck;return a.isIE||a.isIE11?!0:!1}()?60:30,ENABLE:!0}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager,c=MathInteractives.Common.Utilities.Models.Rect,d=MathInteractives.Common.Utilities.Models.Point;a.EquationView=a.TileView.extend({equationManager:null,_iTreeHeight:null,$equationViewDiv:null,tileDroppedString:"",customTutorialString:"",initialize:function(){null===this.arrTileViews&&(this.arrTileViews=[]),null===this.$arrOperatorViews&&(this.$arrOperatorViews=[]),this.setLevel(-1),a.EquationView.__super__.initialize.apply(this,arguments),this.listenEvents()},render:function(){var b=this.model.get("tileArray"),c=0;for(c;c<b.length;c++)this.arrTileViews[c]=a.TileView.createTileItemView(b.at(c),this,this.equationManager,this.player,this.filePath,this.manager,this.idPrefix)},setEquationContainer:function(a){this.setElement(a)},reset:function(){this.$el.empty()},createView:function(){this.$equationViewDiv=$("<div></div>").attr("id",this.equationManager.getIdPrefix()+"workspace-expression-area-equation-view").addClass("equation-view-component").addClass("level"+this.getLevel()),this.$el.append(this.$equationViewDiv),this.$el.addClass("equation-view").addClass("level"+this.getLevel());var a,b=0,c=this.arrTileViews;for(b=0;b<c.length;b++)a=c[b].createView(),this.$equationViewDiv.append(a);this.createOperatorView()},createOperatorView:function(){var b,c,d,e=0;this.getLevel(),a.TileView.CLASSES;for(e=0;e<this.arrTileViews.length;e++)c=this.arrTileViews[e],d=c.model.get("operator"),null!==d?(b=this.createOperator(d),b.insertBefore(c.$el),this.$arrOperatorViews[e]=b):this.$arrOperatorViews[e]=null},createOperator:function(b){var b,c,d=this.getLevel(),e=a.TileView.CLASSES,f=$("<div></div>");return null!==b?(c=$("<div></div>").addClass(e.OperatorContainer+" "+e.Level+d),("+"===b||"-"===b)&&f.text(b),f.addClass(e.Operator+" "+e[b]+" "+e.Level+(d+1)).appendTo(c),c):null},getTreeHeight:function(){var a=0,b=0,c=0;for(a=0;a<this.arrTileViews.length;a++)b=this.arrTileViews[a].getTreeHeight(),b>c&&(c=b);return this.setTreeHeight(c),c+1},refreshTreeHeight:function(){this.getTreeHeight()},refresh:function(){this.curHoveredTile&&(this.curHoveredTile.$el.removeClass("white-border-left white-border-right"),this.curHoveredTile=null),a.EquationView.__super__.refresh.apply(this,arguments)},attachDettachDroppable:function(a){this.makeDroppable(a)},listenEvents:function(){this.listenTo(this.model.get("tileArray"),"add",this.onAddTile),this.listenTo(this.model.get("tileArray"),"remove",this.onRemoveTile)},onAddTile:function(b,c,d){var e,f=null!==d.at&&void 0!==d.at?parseInt(d.at,10):this.arrTileViews.length,g=(this.model.get("tileArray"),a.TileView.createTileItemView(b,this,this.equationManager,this.player,this.filePath,this.manager,this.idPrefix)),h=g.createView(),i=this.arrTileViews.length,j=b.get("isAnimate");this.equationManager.restrictFirstTileAnimation===!1&&j&&h.css({visibility:"hidden"}).addClass("animated-tiles"),0===f?this.$equationViewDiv.prepend(h):0===i?this.$equationViewDiv.append(h):h.insertAfter(this.arrTileViews[f-1].$el),this.equationManager.restrictFirstTileAnimation===!0&&(this.equationManager.firstTile=h),e=this.createOperator(g.model.get("operator")),null!==e?(j===!0&&this.equationManager.restrictFirstTileAnimation===!1&&e.css("visibility","hidden").addClass("invisible-operators"),e.insertBefore(g.$el),this.$arrOperatorViews.splice(f,0,e)):this.$arrOperatorViews.splice(f,0,null),b.set("isAnimate",!1),this.equationManager.restrictFirstTileAnimation=!1,g.attachEvents(),this.equationManager.tileAdded(g),this.arrTileViews.splice(f,0,g),this._iTreeHeight=this.getItemTreeHeight()},onRemoveTile:function(a,c,d){var e=d.index,f=this.arrTileViews[e],g=this.$arrOperatorViews[e];f.model.get("operator");this.equationManager.model.get("mode")===b.EquationManager.MODES.SolveMode&&(a.get("type")===b.TileItem.SolveTileType.PARENTHESIS||a.get("type")===b.TileItem.SolveTileType.BIG_PARENTHESIS)&&(a.get("type")===b.TileItem.SolveTileType.BIG_PARENTHESIS?this.equationManager.parenthesisRemoved(parseInt(f.$exponent.attr("id").replace(this.equationManager.getIdPrefix()+"exponent-","")),!0):this.equationManager.parenthesisRemoved(parseInt(f.$exponent.attr("id").replace(this.equationManager.getIdPrefix()+"exponent-","")))),null!==this.$arrOperatorViews[e]&&this.$arrOperatorViews[e].remove(),this.$arrOperatorViews.splice(e,1),f.stopListeningEvents(!0),setTimeout(function(){g&&g.remove(),f.$el.remove()},0),this.arrTileViews.splice(e,1),this._iTreeHeight=this.getItemTreeHeight()},getItemTreeHeight:function(){var a,b=0,c=0,d=0;for(b=0;b<this.arrTileViews.length;b++)a=this.arrTileViews[b],d=a.getTreeHeight(),d>c&&(c=d);return c},attachEvents:function(){var a=0,b=this.arrTileViews;for(a=0;a<b.length;a++)b[a].attachEvents();this.makeDroppable(!0)},makeDroppable:function(a){if(a){var b=this;this.$el.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(a,c){b.equationManager.getIsDropped()||(b.onTileDrop(a,c),b.$el.removeClass("white-border-left white-border-right white-border"),c.draggable.removeData("cur-droppable"),b.equationManager.setIsDropped(!0))},over:function(a,c){b.onMouseOver(a,c),c.draggable.data("cur-droppable",b)},out:function(a,c){b.onMouseOut(a,c),c.draggable.removeData("cur-droppable")}})}else this.$el.droppable("destroy")},onMouseOver:function(a,e){var f,g,h,i=this.arrTileViews,j=0,k=b.TileItem.MultiplicationThresold,l=b.TileItem.AdditionThresold,m=a.originalEvent?a.originalEvent:a,n=new d({left:m.clientX,top:m.clientY}),o=null,p=null,q=e.helper.data(),r=q["cur-draggable"],s=this.equationManager.model.get("mode"),t=b.EquationManager.MODES,u=q.tiletype,v=b.TileItem.BinTileType;if(this.equationManager.registerMouseOverTile(this,a,e),s===t.SolveMode){for(this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),j=0;j<i.length;j++)if(f=i[j],f!==r){if(o=new c(f.el.getBoundingClientRect()),o=o.inflateRect(k,0),o.isPointInRect(n)){p=f,n.getLeft()<o.getMiddle().getLeft()?p.$el.addClass("white-border-left"):p.$el.addClass("white-border-right");break}if(o=o.inflateRect(l,0),o.isPointInRect(n)){p=f,n.getLeft()<o.getMiddle().getLeft()?p.$el.addClass("white-border-left"):p.$el.addClass("white-border-right");break}}null!==p?(this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=p):(this.hasChildView(r,!0)||void 0===r.$el?(g=i[0],h=i[i.length-1],g&&(x=new c(g.el.getBoundingClientRect()),r!==g&&n.getLeft()<x.getLeft()?(g.$el.removeClass("white-border-right white-border").addClass("white-border-left "),p=g):h&&(y=new c(h.el.getBoundingClientRect()),r!==h&&n.getLeft()>y.getRight()&&(h.$el.removeClass("white-border-left white-border").addClass("white-border-right "),p=h)))):this.$el.removeClass("white-border-left white-border-right").addClass("white-border"),this.curHoveredTile=p)}else if(s===t.BuildMode){var w=!1;if(r||(w=!0),u===v.PARENTHESIS)return;for(this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),j=0;j<i.length;j++)if(f=i[j],f!==r&&!f.isEmpty()){if(o=new c(f.el.getBoundingClientRect()),o=o.inflateRect(k,0),o.isPointInRect(n)){p=f,n.getLeft()<o.getMiddle().getLeft()?p.$el.addClass("white-border-left"):p.$el.addClass("white-border-right");break}if(o=o.inflateRect(l,0),o.isPointInRect(n)){p=f,n.getLeft()<o.getMiddle().getLeft()?p.$el.addClass("white-border-left"):p.$el.addClass("white-border-right");break}}if(null!==p)this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=p;else{if(this.$el.removeClass("white-border-left white-border-right white-border"),w||!w){var g=i[0],x=new c(g.el.getBoundingClientRect()),h=i[i.length-1],y=new c(h.el.getBoundingClientRect());!g.isEmpty()&&n.getLeft()<x.getLeft()?(g.$el.removeClass("white-border-right white-border").addClass("white-border-left "),p=g):!h.isEmpty()&&n.getLeft()>y.getRight()&&(h.$el.removeClass("white-border-left white-border").addClass("white-border-right "),p=h)}this.curHoveredTile=p}}p&&this.equationManager.repositionBorderAdded(p.$el)},onMouseOut:function(a,b){this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),this.$el.removeClass("white-border-left white-border-right white-border")},onTileDrop:function(a,e){var f,g,h=this.arrTileViews,i=0,j=b.TileItem.MultiplicationThresold,k=b.TileItem.AdditionThresold,l=a.originalEvent,m=new d({left:l.clientX,top:l.clientY}),n=null,o=null,p=-1,q=!0,r="*",s=e.helper.data(),t=s["cur-draggable"],u=s.tiletype,v=e.helper.data("length"),w=this.model.get("bDenominator"),x=1,y=this.equationManager.model.get("mode"),z=b.EquationManager.MODES,A=b.TileItem.BinTileType,B=!1;if(v&&(x=v),this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile&&(this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=null),this.resetGreedyChild(e.draggable),y===z.SolveMode){for(i=0;i<h.length;i++)if(f=h[i],f!==t){if(n=new c(f.el.getBoundingClientRect()),n=n.inflateRect(j,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1);break}if(n=n.inflateRect(k,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1),r="+";break}}if(null===o){var C=h[0],D=new c(C.el.getBoundingClientRect()),E=h[h.length-1],F=new c(E.el.getBoundingClientRect());t!==C&&m.getLeft()<D.getLeft()?(o=C,p=0,q=!0):t!==E&&m.getLeft()>F.getRight()&&(o=E,p=h.length-1,q=!1)}null!==o?(g={sourceTile:t,index:p.toString(),isDestDeno:w,numOfTiles:x,strOperator:r,isLeft:q},B=this.equationManager.onRepositionTile(g),B&&e.draggable.data("isDropped",!0)):this.hasChildView(t,!0)||(g={sourceTile:t,destTile:this,numOfTiles:x},B=this.equationManager.onCombineTiles(g),B&&e.draggable.data("isDropped",!0))}else if(y===z.BuildMode){var G=t?!1:!0;for(i=0;i<h.length;i++)if(f=h[i],f!==t){if(n=new c(f.el.getBoundingClientRect()),n=n.inflateRect(j,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1);break}if(n=n.inflateRect(k,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1),r="+";break}}if(null===o&&(G||!G)){var C=h[0],D=new c(C.el.getBoundingClientRect());if(m.getLeft()<D.getLeft())o=C,q=!0;else{var E=h[h.length-1],F=new c(E.el.getBoundingClientRect());m.getLeft()>F.getRight()&&(o=E,q=!1)}p=h.indexOf(o)}G?o&&!o.isEmpty()?(u===A.BASE||u===A.EXPONENT)&&(g={sourceTile:e.helper,index:p.toString(),isDestDeno:w,strOperator:r,isLeft:q},B=this.equationManager.onAddTile(g),B&&e.draggable.data("isDropped",!0)):e.draggable.data("isDropped",!1):o&&!o.isEmpty()&&(u===A.BASE||u===A.EXPONENT?(g={sourceTile:t,tiletype:u,destTile:o,numOfTiles:v,strOperator:r,isLeft:q},B=this.equationManager.onRepositionIndividualTile(g),B&&e.draggable.data("isDropped",!0)):u!==A.MARQUEE||this.equationManager.isTileViewInsideMarquee(o)||(g={sourceTile:t,destTile:o,numOfTiles:v,strOperator:r,isLeft:q},B=this.equationManager.onRepositionTile(g),B&&e.draggable.data("isDropped",!0)))}},getIndex:function(a){var b=this.arrTileViews.indexOf(a);return b.toString()},getElementsInsideMarquee:function(a,b){var d,e,f=new c(b[0].getBoundingClientRect()),g=f.getMiddle(),h=0;for(e=this.arrTileViews.length;e>h;h++)d=new c(this.arrTileViews[h].$el[0].getBoundingClientRect()),g=d.getMiddle(),this.arrTileViews[h].getElementsInsideMarquee(a,b)},getTileContentInHtmlForm:function(){var a,b,c=this.arrTileViews,d=c.length,e="";for(e+="<div class='header-expression-container'><div class='header-expression'>",a=0;d>a;a++)b=c[a],e+=b.getTileContentInHtmlForm();return e+="</div></div>"},getTileAccesibilityText:function(){var a,b,c=this.arrTileViews,d=c.length,e="";for(a=0;d>a;a++)b=c[a],e+=b.getTileAccesibilityText();return e+=""},startAcc:function(){if(this.isAccessible())if(this.equationManager.tileSelected)this.spacePressed(this);else{var a=this.$(".equation-view-component"),b=a.position(),c=a.height(),d=a.width(),e=$('<div class="acc-eq"></div>'),f=this.equationManager.getLeftOffsetEquationView(),g=f.left,h=f.width;this.removeAccDiv(),e.css({position:"absolute",top:b.top-3,left:b.left+g,width:d-h,height:c,outline:"2px dotted #aaa","font-size":0,"pointer-events":"none"}),this.equationManager._tutorialMode?e.text(this.getAccString()+this.customTutorialString):e.text(this.getAccString()+this.getMessage("base-exp-pair",26)),this.equationManager.getContainerToAppend().append(e),this.equationManager.setCurrentAccView(this),this.accDiv=e,e.attr("tabindex",-1),e[0].focus()}},buildStartAcc:function(){var a=this.$(".equation-view-component"),b=a.position(),c=a.height(),d=a.width(),e=$('<div class="acc-eq"></div>');this.removeAccDiv(),e.css({position:"absolute",top:b.top,left:b.left,width:d,height:c,outline:"2px dotted #aaa","font-size":0,"pointer-events":"none"}),null!==this.equationManager.selectedTile?e.text(this.getAccMessage("base-exp-pair",13)):(this.equationManager._tutorialMode?e.text(this.tileDroppedString+this.getAccString()+this.customTutorialString):e.text(this.tileDroppedString+this.getAccString()+this.getMessage("base-exp-pair",5)),this.tileDroppedString=""),this.equationManager.getContainerToAppend().append(e),this.equationManager.setCurrentAccView(this),this.accDiv=e,e.attr("tabindex",-1),e[0].focus()},continueAcc:function(b){if(b===this)this.removeAccDiv(),this.equationManager.trigger(a.EquationManager.EVENTS.SOLVE_TAB);else{var c=b;c.continueAcc(b)}},buildContinueAcc:function(b){if(b===this){if(this.equationManager.selectedTile)return;this.removeAccDiv(),this.equationManager.trigger(a.EquationManager.EVENTS.BUILD_TAB)}else{var c=b;c.buildContinueAcc(b)}},getContainerToAppend:function(){return this.$(".equation-view-component")},startAccOnNextTile:function(){var b=this.equationManager;this.removeAccDiv(),b.isMarqueeSelectedForOp?this.arrTileViews.length===b.marqueeSelectedItems.length?b.stopSpaceSelect():this.startAcc():b.tileSelected?this.arrTileViews.length<2?(b.tileSelected=null,b.getCurrentAccView().startAcc()):this.startAcc():(b.setCurrentAccView(null),b.trigger(a.EquationManager.EVENTS.SOLVE_TAB))},buildStartAccOnNextTile:function(){this.accDiv&&this.removeAccDiv(),this.equationManager.setCurrentAccView(null),this.equationManager.trigger(a.EquationManager.EVENTS.BUILD_TAB)},goPreviousAcc:function(b){if(b)if(b===this)this.removeAccDiv(),this.equationManager.setCurrentAccView(null),this.equationManager.trigger(a.EquationManager.EVENTS.SOLVE_SHIFT_TAB);else{var c=b;c.goPreviousAcc(b)}else this.removeAccDiv(),this.equationManager.trigger(a.EquationManager.EVENTS.SOLVE_SHIFT_TAB)},buildGoPreviousAcc:function(b){if(b)if(b===this){if(this.equationManager.selectedTile)return;this.removeAccDiv(),this.equationManager.setCurrentAccView(null),this.equationManager.trigger(a.EquationManager.EVENTS.BUILD_SHIFT_TAB)}else{var c=b;c.buildGoPreviousAcc(b)}else this.removeAccDiv(),this.equationManager.trigger(a.EquationManager.EVENTS.BUILD_SHIFT_TAB)},spacePressed:function(a){a&&(a===this?(this.removeAccDiv(),this.arrTileViews[0].startAcc(!0)):a.spacePressed());
},buildSpacePressed:function(a){a&&(null===this.equationManager.selectedTile?a===this?(this.removeAccDiv(),this.arrTileViews[0].buildStartAcc()):a.buildSpacePressed():a.spaceToDropTile())},tutorialBuildSpacePressed:function(a,b){this.equationManager.selectedTile?(a.removeAccDiv(),a.spaceToDropTile()):a===this&&b.isBin===!1&&b.sourceView&&(a.removeAccDiv(),b.sourceView.startAcc())},tutorialSpacePressed:function(a,c,d){var e=b.TileItem.BinTileType;if(a===this)if(c.sourceView.model.get("type")===e.MARQUEE){this.removeAccDiv();var f=c.sourceView.$el.find(".selected-elements-cover");f.text(this.equationManager.tutorialCustomTileString),c.sourceView.focusAcc()}else{var g=c.sourceView.startAcc();g!==!1&&this.removeAccDiv()}else this.equationManager.tileSelected?d.sourceView.tutorialSpacePressed(!0):9===c.operation?(this.equationManager.tutorialCustomTileString="",c.sourceView.tutorialSpacePressed(!1),d.sourceView.startAcc()):c.sourceView.tutorialSpacePressed(-1)},spaceToDropTile:function(b){var c,d,e,f=this.arrTileViews.length,g=this.arrTileViews,h=0,i=null,j=this.equationManager.selectedTile,k=j.data(),l=k.tiletype,m=k.tilevalue,n=[],o=!1;for(c={index:f-1+"",isDestDeno:!1,isLeft:!1,sourceTile:j,strOperator:"*"};f>h;h++)i=g[h].getTileItemIndex(l),null!==i.emptyTile&&(d=this.equationManager.equationView.getViewFromIndex(i.tileIndex),i.itemToReplace=d,n.push(i));for(h=0;h<n.length;h++)if((n[h].emptyTile===l||"BASE_EXPONENT"===n[h].emptyTile)&&"PARENTHESIS"!==l){c.destTile=n[h].itemToReplace,e=this.equationManager.onReplaceTile(c),b||this.removeAccDiv(),o=!0;break}if(o===!1){if("PARENTHESIS"===l){for(h=0;f>h;h++)if(!this._isParenthesisPresent(h)){c.index=h+"";break}if(h===f)return this.equationManager.trigger(a.FormExpressionEquationManager.EVENTS.NESTED_PARENTHESIS_CASE),b||this.removeAccDiv(),this.equationManager.selectedTile=null,!1}e=this.equationManager.onAddTile(c),b||this.removeAccDiv()}this.equationManager.selectedTile=null,this.equationManager.isSelectedTileExponent=!1,this.equationManager.equationView.tileDroppedString=this.getAccMessage("base-exp-pair",12,[m]),this.equationManager.buildModeSetFocusOnTooltip()},_isParenthesisPresent:function(a){var b=this.arrTileViews;return"PARENTHESIS"===b[a].model.get("type")?!0:!1},shiftTabHandler:function(){this.equationManager.tileSelected?this.arrTileViews[this.arrTileViews.length-1].shiftTabHandler(!1):this.startAcc()},buildShiftTabHandler:function(){this.buildStartAcc()},removeAccDiv:function(){this.accDiv&&this.accDiv.remove()},startExpToggle:function(){return!1},getAccString:function(b){var c,d="";for(c=0;c<this.arrTileViews.length;c++)d+=this.arrTileViews[c].getAccString();return b===a.EquationManager.DATA?this.getMessage("base-exp-pair",25)+" "+d.trim()+".":this.getMessage("base-exp-pair",6)+" "+d.trim()+"."},isPresentAsParent:function(){return!1}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager,c=MathInteractives.Common.Utilities.Models.Rect,d=MathInteractives.Common.Utilities.Models.Point;a.FractionTileView=a.TileView.extend({$numeratorDiv:null,$denominatorDiv:null,$vinculumLine:null,_iNumTreeHeight:null,_iDenmTreeHeight:null,_$div1:null,$base:null,initialize:function(){this.arrTileViews=[],this.$arrOperatorViews=[],this._iNumTreeHeight=0,this._iDenmTreeHeight=0,a.FractionTileView.__super__.initialize.apply(this,arguments),this.listenEvents()},render:function(){var b=this.model.get("tileArray"),c=0;for(c=0;c<b.length;c++)this.arrTileViews[c]=new a.TileView.createTileItemView(b.at(c),this,this.equationManager,this.player,this.filePath,this.manager,this.idPrefix)},createView:function(){var c,d,e=a.TileView.CLASSES,f=0,g=(this.equationManager,null),h=null,i=1,j=b.TileItem.BinTileType;for(this.$base=$("<div></div>").addClass(e.BASE),this.$numeratorDiv=$("<div></div>",{"class":e.FRACTION+"-"+e.NUMERATOR+" "+e.Level+this.getLevel()}),this.$denominatorDiv=$("<div></div>").addClass(e.FRACTION+"-"+e.DENOMINATOR),this.$vinculumLine=$("<div></div>").addClass(e.FRACTION+"-"+e.VINICULUM),$("<div></div>").addClass("inner").appendTo(this.$vinculumLine),this.$base.append(this.$numeratorDiv).append(this.$vinculumLine).append(this.$denominatorDiv),this.$el.append(this.$base),this.$el.addClass(e.FRACTION).addClass(e.Level+this.getLevel()),f=0;f<this.arrTileViews.length&&(d=this.arrTileViews[f],d.model.get("bDenominator")===!1);f++)c=d.createView(),this.$numeratorDiv.append(c);for(;f<this.arrTileViews.length;f++)d=this.arrTileViews[f],d.model.get("bDenominator")===!0&&(c=d.createView(),this.$denominatorDiv.append(c));return this._iNumTreeHeight=this.getNumeratorTreeHeight(),this._iDenmTreeHeight=this.getDenominatorTreeHeight(),this.createOperatorView(),g=MathInteractives.Common.Components.templates.baseTile({base:i,"base-class":e.BASE,baseTileType:j.BASE_ONLY,idPrefix:this.idPrefix,level:e.Level+1}),h=$(g),this._onDenominatorHeightChange(),this.$el},createOperatorView:function(){var b,c,d,e=0;this.getLevel(),a.TileView.CLASSES;for(e=0;e<this.arrTileViews.length&&(c=this.arrTileViews[e],d=c.model.get("operator"),c.model.get("bDenominator")===!1);e++)null!==d?(b=this.createOperator(d),b.insertBefore(c.$el),this.$arrOperatorViews[e]=b):this.$arrOperatorViews[e]=null;for(;e<this.arrTileViews.length;e++)c=this.arrTileViews[e],d=c.model.get("operator"),c.model.get("bDenominator")===!0&&(null!==d?(b=this.createOperator(d),b.insertBefore(c.$el),this.$arrOperatorViews[e]=b):this.$arrOperatorViews[e]=null)},createOperator:function(b){var b,c,d=this.getLevel(),e=a.TileView.CLASSES,f=$("<div></div>");return null!==b?(c=$("<div></div>").addClass(e.OperatorContainer+" "+e.Level+d),("+"===b||"-"===b)&&f.text(b),f.addClass(e.Operator+" "+e[b]+" "+e.Level+(d+1)).appendTo(c),c):null},isEmpty:function(){return!1},getTreeHeight:function(){var a=0,b=0,c=0;for(a=0;a<this.arrTileViews.length;a++)b=this.arrTileViews[a].getTreeHeight(),b>c&&(c=b);return c+1},refresh:function(){this._iNumTreeHeight=this.getNumeratorTreeHeight(),this._onNumeratorHeightChange(),this._iDenmTreeHeight=this.getDenominatorTreeHeight(),this._onDenominatorHeightChange(),this.curHoveredTile&&(this.curHoveredTile.$el.removeClass("white-border-left white-border-right"),this.curHoveredTile=null),a.FractionTileView.__super__.refresh.apply(this,arguments)},listenEvents:function(){this.listenTo(this.model.get("tileArray"),"add",this.onAddTile),this.listenTo(this.model.get("tileArray"),"remove",this.onRemoveTile),this.listenTo(this.model,"change:operator",this._onOperatorChange)},_onOperatorChange:function(a,b){this.parent.changeOperatorArray(a,b)},onAddTile:function(b,c,d){var e,f=null!==d.at&&void 0!==d.at?parseInt(d.at,10):this.arrTileViews.length,g=(this.model.get("tileArray"),a.TileView.createTileItemView(b,this,this.equationManager,this.player,this.filePath,this.manager,this.idPrefix)),h=g.createView(),i=this.getNumeratorLength(this.arrTileViews),j=this.arrTileViews.length-i,k=b.get("isAnimate");this.equationManager.restrictFirstTileAnimation===!1&&k&&h.css({visibility:"hidden"}).addClass("animated-tiles"),0===f?b.get("bDenominator")===!1?this.$numeratorDiv.prepend(h):this.$denominatorDiv.prepend(h):b.get("bDenominator")===!1&&0===i?this.$numeratorDiv.append(h):b.get("bDenominator")===!0&&0===j?this.$denominatorDiv.append(h):f===i&&b.get("bDenominator")===!0?this.$denominatorDiv.prepend(h):h.insertAfter(this.arrTileViews[f-1].$el),this.equationManager.restrictFirstTileAnimation===!0&&(this.equationManager.firstTile=h),e=this.createOperator(g.model.get("operator")),null!==e?(k===!0&&this.equationManager.restrictFirstTileAnimation===!1&&e.css("visibility","hidden").addClass("invisible-operators"),e.insertBefore(g.$el),this.$arrOperatorViews.splice(f,0,e)):this.$arrOperatorViews.splice(f,0,null),b.set("isAnimate",!1),this.equationManager.restrictFirstTileAnimation=!1,g.attachEvents(),this.equationManager.tileAdded(g),this.arrTileViews.splice(f,0,g),this.$numeratorDiv.removeClass("tree-height-"+this._iNumTreeHeight),this.$denominatorDiv.removeClass("tree-height-"+this._iDenmTreeHeight),this._iNumTreeHeight=this.getNumeratorTreeHeight(),this._onNumeratorHeightChange(),this._iDenmTreeHeight=this.getDenominatorTreeHeight(),this._onDenominatorHeightChange()},onRemoveTile:function(a,c,d){var e=d.index,f=this.arrTileViews[e],g=null,h=(f.model.get("operator"),this);this.equationManager.model.get("mode")===b.EquationManager.MODES.SolveMode&&(a.get("type")===b.TileItem.SolveTileType.PARENTHESIS||a.get("type")===b.TileItem.SolveTileType.BIG_PARENTHESIS)&&(a.get("type")===b.TileItem.SolveTileType.BIG_PARENTHESIS?this.equationManager.parenthesisRemoved(parseInt(f.$exponent.attr("id").replace(this.equationManager.getIdPrefix()+"exponent-","")),!0):this.equationManager.parenthesisRemoved(parseInt(f.$exponent.attr("id").replace(this.equationManager.getIdPrefix()+"exponent-","")))),null!==h.$arrOperatorViews[e]&&(g=this.$arrOperatorViews[e]),this.$arrOperatorViews.splice(e,1),this.arrTileViews.splice(e,1),this.$numeratorDiv.removeClass("tree-height-"+this._iNumTreeHeight),this.$denominatorDiv.removeClass("tree-height-"+this._iDenmTreeHeight),this._iNumTreeHeight=this.getNumeratorTreeHeight(),this._onNumeratorHeightChange(),this._iDenmTreeHeight=this.getDenominatorTreeHeight(),this._onDenominatorHeightChange(),f.stopListeningEvents(!0),g&&g.remove(),setTimeout(function(){f.$el.remove()},0)},_onNumeratorHeightChange:function(){},_onDenominatorHeightChange:function(){this.$vinculumLine.removeClass("dragging"),0===this._iDenmTreeHeight?(this.$vinculumLine.css("visibility","hidden"),this.parent.$el.addClass("no-denominator")):(this.$vinculumLine.css("visibility",""),this.parent.$el.removeClass("no-denominator"))},getNumeratorLength:function(a){var b,c=0,d=a.length;for(b=0;d>b;b++)a[b].model.get("bDenominator")===!1&&c++;return c},getNumeratorTreeHeight:function(){var a,b=0,c=0,d=0;for(b=0;b<this.arrTileViews.length&&(a=this.arrTileViews[b],a.model.get("bDenominator")===!1);b++)d=a.getTreeHeight(),d>c&&(c=d);return c},getDenominatorTreeHeight:function(){var a,b=0,c=0,d=0;for(b=0;b<this.arrTileViews.length;b++)a=this.arrTileViews[b],a.model.get("bDenominator")===!0&&(d=a.getTreeHeight(),d>c&&(c=d));return c},attachEvents:function(){var a=0,b=this;for(a=0;a<this.arrTileViews.length;a++)this.arrTileViews[a].attachEvents();this.$el.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(a,c){b.equationManager.getIsDropped()||(b.onTileDrop(a,c),b.$el.removeClass("white-border-left white-border-right white-border"),c.draggable.removeData("cur-droppable"),b.equationManager.setIsDropped(!0))},over:function(a,c){b.onMouseOver(a,c),c.draggable.data("cur-droppable",b)},out:function(a,c){b.onMouseOut(a,c),c.draggable.removeData("cur-droppable")}})},_onExponentDoubleClick:function(a){},onMouseOver:function(a,e){var f,g,h,i,j,k,l,m=this.arrTileViews,n=0,o=b.TileItem.MultiplicationThresold,p=b.TileItem.AdditionThresold,q=a.originalEvent?a.originalEvent:a,r=new d({left:q.clientX,top:q.clientY}),s=null,t=null,u=e.helper.data(),v=u["cur-draggable"],w=u.prevLocationData,x=this.getNumeratorLength(m),y=m.length-x,z=u.length||1,A=new c(this.$numeratorDiv[0].getBoundingClientRect()),B=(new c(this.$denominatorDiv[0].getBoundingClientRect()),!(r.getTop()<=A.getBottom())),C=this.equationManager.model.get("mode"),D=b.EquationManager.MODES,E=u.tiletype,F=b.TileItem.BinTileType,G=this.$vinculumLine[0].getBoundingClientRect().top+2;if(this.equationManager.registerMouseOverTile(this,a,e),C===D.SolveMode){for((E===F.BASE_EXPONENT||E===F.PARENTHESIS||E===F.MARQUEE)&&(0===G?w=h=v.model.get("bDenominator"):null===w||void 0===w?w=h=v.model.get("bDenominator"):(h=G>r.getTop()?!1:!0,h!==w&&(E===F.MARQUEE?this.equationManager.marqueeView.invertExponentText():v.invertExponentText(!1))),e.helper.data("prevLocationData",h)),v&&v.model&&(f=v.model.get("bDenominator")),this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right hover-border"),n=0;n<m.length;n++)if(g=m[n],g!==v&&!this.equationManager.isTileViewInsideMarquee(g)){if(s=new c(g.el.getBoundingClientRect()),s=s.inflateRect(o,0),s.isPointInRect(r)){t=g,r.getLeft()<s.getMiddle().getLeft()?t.$el.addClass("white-border-left"):t.$el.addClass("white-border-right");break}if(s=s.inflateRect(p,0),s.isPointInRect(r)){t=g,r.getLeft()<s.getMiddle().getLeft()?t.$el.addClass("white-border-left"):t.$el.addClass("white-border-right");break}}null!==t?(this.$el.removeClass("white-border-left white-border-right hover-border"),this.curHoveredTile=t,(!f&&0===y||f&&y===z&&-1!==m.indexOf(v))&&(B?this.equationManager._tutorialMode||this.$vinculumLine.css("visibility","").addClass("dragging"):this.$vinculumLine.css("visibility","hidden"))):(this.hasChildView(v,!0)||void 0===v.$el?(this.$el.removeClass("white-border-left white-border-right hover-border"),!f&&0===y||f&&y===z&&-1!==m.indexOf(v)?B?this.equationManager._tutorialMode||this.$vinculumLine.css("visibility","").addClass("dragging"):(this.$vinculumLine.css("visibility","hidden"),i=m[0],k=m[x-1],i&&(j=new c(i.el.getBoundingClientRect()),v!==i&&r.getLeft()<j.getLeft()?(i.$el.removeClass("white-border-right white-border").addClass("white-border-left "),t=i):k&&(l=new c(k.el.getBoundingClientRect()),v!==k&&r.getLeft()>l.getRight()&&(k.$el.removeClass("white-border-left white-border").addClass("white-border-right "),t=k)))):B?(i=m[x],k=m[this.arrTileViews.length-1],i&&(j=new c(i.el.getBoundingClientRect()),v!==i&&r.getLeft()<j.getLeft()?(i.$el.removeClass("white-border-right white-border").addClass("white-border-left "),t=i):k&&(l=new c(k.el.getBoundingClientRect()),v!==k&&r.getLeft()>l.getRight()&&(k.$el.removeClass("white-border-left white-border").addClass("white-border-right "),t=k)))):(i=m[0],k=m[x-1],i&&(j=new c(i.el.getBoundingClientRect()),v!==i&&r.getLeft()<j.getLeft()?(i.$el.removeClass("white-border-right white-border").addClass("white-border-left "),t=i):k&&(l=new c(k.el.getBoundingClientRect()),v!==k&&r.getLeft()>l.getRight()&&(k.$el.removeClass("white-border-left white-border").addClass("white-border-right "),t=k))))):this.$el.removeClass("white-border-left white-border-right").addClass("hover-border"),this.curHoveredTile=t)}else if(C===D.BuildMode){var H=!1;if(v||(H=!0),E===F.PARENTHESIS)return;for(this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),n=0;n<m.length;n++)if(g=m[n],g!==v&&!g.isEmpty()&&!g.isEmptyInView()){if(s=new c(g.el.getBoundingClientRect()),s=s.inflateRect(o,0),s.isPointInRect(r)){t=g,r.getLeft()<s.getMiddle().getLeft()?t.$el.addClass("white-border-left"):t.$el.addClass("white-border-right");break}if(s=s.inflateRect(p,0),s.isPointInRect(r)){t=g,r.getLeft()<s.getMiddle().getLeft()?t.$el.addClass("white-border-left"):t.$el.addClass("white-border-right");break}}if(null!==t)this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=t;else{if(this.$el.removeClass("white-border-left white-border-right white-border"),H||!H)if(B){var i=m[x],j=new c(i.el.getBoundingClientRect()),k=m[this.arrTileViews.length-1],l=new c(k.el.getBoundingClientRect());!i.isEmpty()&&!i.isEmptyInView()&&r.getLeft()<j.getLeft()?(i.$el.removeClass("white-border-right white-border").addClass("white-border-left "),t=i):!k.isEmpty()&&!k.isEmptyInView()&&r.getLeft()>l.getRight()&&(k.$el.removeClass("white-border-left white-border").addClass("white-border-right "),t=k)}else{var i=m[0],j=new c(i.el.getBoundingClientRect()),k=m[x-1],l=new c(k.el.getBoundingClientRect());!i.isEmpty()&&!i.isEmptyInView()&&r.getLeft()<j.getLeft()?(i.$el.removeClass("white-border-right white-border").addClass("white-border-left "),t=i):!k.isEmpty()&&!k.isEmptyInView()&&r.getLeft()>l.getRight()&&(k.$el.removeClass("white-border-left white-border").addClass("white-border-right "),t=k)}this.curHoveredTile=t}}t&&this.equationManager.repositionBorderAdded(t.$el)},onMouseOut:function(e,f){var g=this.arrTileViews,h=e.originalEvent?e.originalEvent:e,i=new d({left:h.clientX,top:h.clientY}),j=f.helper.data(),k=j["cur-draggable"],l=!0,m=this.getNumeratorLength(g),n=g.length-m,o=j.length||1,p=new c(this.$numeratorDiv[0].getBoundingClientRect()),q=!(i.getTop()<=p.getBottom()),r=this.equationManager.model.get("mode"),s=b.EquationManager.MODES;a.FractionTileView.__super__.onMouseOut.apply(this,arguments),this.$numeratorDiv.removeClass("white-border"),this.$denominatorDiv.removeClass("white-border"),r===s.SolveMode&&(l=k.model.get("bDenominator"),(l&&!q&&n===o&&-1!==g.indexOf(k)||0===n&&!q)&&this.$vinculumLine.css("visibility","hidden"))},onTileDrop:function(a,e){var f,g,h=this.arrTileViews,i=0,j=b.TileItem.MultiplicationThresold,k=b.TileItem.AdditionThresold,l=a.originalEvent,m=new d({left:l.clientX,top:l.clientY}),n=null,o=null,p=-1,q=!0,r="*",s=this.getNumeratorLength(h),t=h.length-s,u=e.helper.data(),v=u["cur-draggable"],w=u.tiletype,x=u.length,y=new c(this.$numeratorDiv[0].getBoundingClientRect()),z=(new c(this.$denominatorDiv[0].getBoundingClientRect()),!(m.getTop()<=y.getBottom())),A=1,B=this.equationManager.model.get("mode"),C=b.EquationManager.MODES,D=b.TileItem.BinTileType,E=!1;if(x&&(A=x),this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile&&(this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=null),this.resetGreedyChild(e.draggable),B===C.SolveMode){for(this.$numeratorDiv.removeClass("white-border"),this.$denominatorDiv.removeClass("white-border"),i=0;i<h.length;i++)if(f=h[i],f!==v){if(n=new c(f.el.getBoundingClientRect()),n=n.inflateRect(j,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1);break}if(n=n.inflateRect(k,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1),r="+";break}}if(null===o)if(0!==s||z)if(0===t&&z)p=s-1,o=this,q=!1;else if(z){var F=h[s],G=new c(F.el.getBoundingClientRect()),H=h[this.arrTileViews.length-1],I=new c(H.el.getBoundingClientRect());v!==F&&m.getLeft()<G.getLeft()?(o=F,p=s,q=!0):v!==H&&m.getLeft()>I.getRight()&&(o=H,p=s+t-1,q=!1)}else{var F=h[0],G=new c(F.el.getBoundingClientRect()),H=h[s-1],I=new c(H.el.getBoundingClientRect());v!==F&&m.getLeft()<G.getLeft()?(o=F,p=0,q=!0):v!==H&&m.getLeft()>I.getRight()&&(o=H,p=s-1,q=!1)}else p=0,o=this;null===o||this.equationManager.isTileViewInsideMarquee(o)?this.hasChildView(v,!0)||this.equationManager.isTileViewInsideMarquee(this)||(g={sourceTile:v,destTile:this,numOfTiles:A},E=this.equationManager.onCombineTiles(g),E&&e.draggable.data("isDropped",!0)):(g={sourceTile:v,index:this.parent.getIndex(this)+"."+p,isDestDeno:z,numOfTiles:A,strOperator:r,isLeft:q},E=this.equationManager.onRepositionTile(g),E&&e.draggable.data("isDropped",!0))}else if(B===C.BuildMode){var J=!1;for(v||(J=!0),i=0;i<h.length;i++){if(f=h[i],n=new c(f.el.getBoundingClientRect()),n=n.inflateRect(j,0),n.isPointInRect(m)){if(f===v||f.isEmptyInView())continue;o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1);break}if(n=n.inflateRect(k,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1),r="+";break}}if(null===o&&(J||!J)){if(z){var F=this.arrTileViews[s],G=new c(F.el.getBoundingClientRect());if(m.getLeft()<G.getLeft()&&!F.isEmpty())o=F,q=!0;else{var H=this.arrTileViews[this.arrTileViews.length-1],I=new c(H.el.getBoundingClientRect());m.getLeft()>I.getRight()&&!H.isEmpty()&&(o=H,q=!1)}}else{var F=this.arrTileViews[0],G=new c(F.el.getBoundingClientRect());if(m.getLeft()<G.getLeft()&&!F.isEmpty())o=F,q=!0;else{var H=this.arrTileViews[s-1],I=new c(H.el.getBoundingClientRect());m.getLeft()>I.getRight()&&!H.isEmpty()&&(o=H,q=!1)}}w===D.PARENTHESIS&&o===v&&(o=null),p=h.indexOf(o)}J?o&&!o.isEmpty()?(w===D.BASE||w===D.EXPONENT)&&(z=o.model.get("bDenominator"),g={sourceTile:e.helper,index:this.parent.getIndex(this)+"."+p,isDestDeno:z,strOperator:r,isLeft:q},E=this.equationManager.onAddTile(g),E&&e.draggable.data("isDropped",!0)):e.draggable.data("isDropped",!1):!o||o.isEmpty()||o.isEmptyInView()||(w===D.BASE||w===D.EXPONENT?(g={sourceTile:v,tiletype:w,destTile:o,numOfTiles:x,strOperator:r,isLeft:q},E=this.equationManager.onRepositionIndividualTile(g),E&&e.draggable.data("isDropped",!0)):w!==D.MARQUEE||this.equationManager.isTileViewInsideMarquee(o)||(g={sourceTile:v,destTile:o,numOfTiles:x,strOperator:r,isLeft:q},E=this.equationManager.onRepositionTile(g),E&&e.draggable.data("isDropped",!0)))}},onChildParenthesisChangeSign:function(a){var b,c,d,e=this.arrTileViews,f=a.model,g=f.get("bDenominator"),h=!g,i=this.getNumeratorLength(e),j=e.length-i,k=!1;h?0===j?(c=i-1,k=!0):c=i+j-1:0===i?(c=0,k=!0):c=i-1,b={sourceTile:a,index:this.parent.getIndex(this)+"."+c,isDestDeno:h,numOfTiles:1,strOperator:"*",isLeft:!1,isTooltipClick:!0},d=this.equationManager.onRepositionTile(b)},getElementsInsideMarquee:function(b,e){var f,g,h=new c(e[0].getBoundingClientRect()),i=h.getMiddle(),j=0,k=new c(this.$vinculumLine[0].getBoundingClientRect()),l=null,m=a.EquationManager.NUMERATOR_MARQUEE_CLASS,n=a.EquationManager.DENOMINATOR_MARQUEE_CLASS,o=k.get("top")<b.marqueeStartY,p=new d({left:b.marqueeStartX,top:b.marqueeStartY});for(k.isPointInRect(p)&&(o=b.clientY>b.marqueeStartY?!0:!1),"hidden"===this.$vinculumLine.css("visibility")&&(o=!1),j=0,g=this.arrTileViews.length;g>j;j++)f=new c(this.arrTileViews[j].$el[0].getBoundingClientRect()),i=f.getMiddle(),l=this.arrTileViews[j].model,l.get("bDenominator")===o&&this.arrTileViews[j].getElementsInsideMarquee(b,e);e.removeClass(n).removeClass(m),o?e.addClass(n):e.addClass(m)},getTileContentInHtmlForm:function(){var a,c,d,e=this.model,f=e.get("operator"),g=(e.get("exponent"),this.arrTileViews),h="",i=!0,j=!0,k=this.parent.model.get("type")===b.TileItem.SolveTileType.BIG_PARENTHESIS?!0:!1;for("*"===f&&(h+="<div class='operator-data-tab'></div>"),c=k?"<div class='fraction-data-tab adjust-bottom'><div class='numerator'>":"<div class='fraction-data-tab'><div class='numerator'>",h+=c,a=0;a<g.length;a++)g[a].model.get("bDenominator")||(h+=g[a].getTileContentInHtmlForm(),i=!1);for(i===!0&&(h=h.replace(c,"<div class='fraction-data-tab'><div class='numerator numerator-empty'>1")),h+="</div><div class='vincullum'></div>",d="<div class='denominator'>",h+=d,a=0;a<g.length;a++)g[a].model.get("bDenominator")&&(h+=g[a].getTileContentInHtmlForm(),j=!1);return j===!0&&(h=h.replace(d,"<div class='denominator denominator-empty'>")),h+="</div></div>"},_getTutorialMouseEventPoint:function(b){b=Number(b);var c,d,e,f,g,h,i=0,j=0;return 0===b?(c=this.el,d=c.getBoundingClientRect(),g=d.height,h=d.width,e=d.top,f=d.left,j+=g/2,i+=h/2,{offset:{x:i,y:j},element:c}):a.FractionTileView.__super__._getTutorialMouseEventPoint.apply(this,arguments)},startAcc:function(){this.getNextTileAcc()},buildStartAcc:function(){this.arrTileViews.length>0&&this.arrTileViews[0].buildStartAcc()},buildContinueAcc:function(a){$(document.activeElement).hasClass("acc-num")?(this.removeAccDiv(),this.startAccDenominator()):$(document.activeElement).hasClass("acc-den")&&(this.removeAccDiv(),this.parent.startExpToggle()===!1&&this.startAccNumerator())},getNextTileAcc:function(){this.arrTileViews.length>0&&this.arrTileViews[0].startAcc(!0)},startAccOnNextTile:function(){var b=this.equationManager;this.accDiv&&this.removeAccDiv(),b.isMarqueeSelectedForOp?this.arrTileViews.length<b.marqueeSelectedItems.length?b.stopSpaceSelect():this.startAcc():b.tileSelected?this.arrTileViews.length<2?(b.tileSelected=null,b.getCurrentAccView().startAcc()):this.startAcc():(b.setCurrentAccView(null),b.trigger(a.EquationManager.EVENTS.SOLVE_TAB))},buildStartAccOnNextTile:function(){this.accDiv&&this.removeAccDiv(),this.equationManager.setCurrentAccView(null),this.equationManager.trigger(a.EquationManager.EVENTS.BUILD_TAB)},getNextDenoTileAcc:function(){if(!this.model.isDenominatorEmpty()){var a=this.getNumeratorLength(this.arrTileViews),b=this.arrTileViews[a];b.startAcc(!0)}},getContainerToAppend:function(a){return a?this.$denominatorDiv:this.$numeratorDiv},goPreviousAcc:function(a){this.parent.shiftTabHandler()},buildGoPreviousAcc:function(){$(document.activeElement).hasClass("acc-den")?(this.removeAccDiv(),this.startAccNumerator()):$(document.activeElement).hasClass("acc-num")&&(this.removeAccDiv(),this.parent.startExpToggle()===!1&&this.startAccDenominator())},shiftTabHandler:function(){this.equationManager.tileSelected?this.arrTileViews[this.arrTileViews.length-1].shiftTabHandler(!1):this.parent.shiftTabHandler()},spaceToDropTile:function(b,c){var d,e,f,g,h=this.arrTileViews.length,i=this.arrTileViews,j=this.parent.getIndex(this),k=this.getNumeratorLength(this.arrTileViews),l=0,m=0,n=null,o=this.equationManager.selectedTile,p=o.data(),q=p.tiletype,r=p.tilevalue;for(d={index:j+"."+(k-1),isDestDeno:!1,isLeft:!1,sourceTile:o,strOperator:"*"},b?c?(l=m=k,d.index=j+"."+(h-1),d.isDestDeno=!0,f=h):(l=m=0,f=k):$(document.activeElement).hasClass("acc-num")?(l=m=0,f=k):$(document.activeElement).hasClass("acc-den")&&(l=m=k,d.index=j+"."+(h-1),d.isDestDeno=!0,f=h);f>m;m++)if(n=i[m].getTileItemIndex(q),null!==n.emptyTile){e=this.equationManager.equationView.getViewFromIndex(n.tileIndex);break}if(n.emptyTile!==q&&"BASE_EXPONENT"!==n.emptyTile||"PARENTHESIS"===q){if("PARENTHESIS"===q){for(m=l;f>m;m++)if(!this._isParenthesisPresent(m)){d.index=j+"."+m;break}if(m===f)return this.equationManager.trigger(a.FormExpressionEquationManager.EVENTS.NESTED_PARENTHESIS_CASE),b||this.removeAccDiv(),this.equationManager.buildModeSetFocusOnTooltip(),this.equationManager.selectedTile=null,!1}g=this.equationManager.onAddTile(d),b||this.removeAccDiv()}else d.destTile=e,g=this.equationManager.onReplaceTile(d),b||this.removeAccDiv();this.equationManager.selectedTile=null,this.equationManager.isSelectedTileExponent=!1,this.equationManager.equationView.tileDroppedString=this.getAccMessage("base-exp-pair",12,[r]),this.equationManager.buildModeSetFocusOnTooltip()},_isParenthesisPresent:function(a){var b=this.arrTileViews;return"PARENTHESIS"===b[a].model.get("type")?!0:!1},buildShiftTabHandler:function(){this.parent.buildShiftTabHandler()},startAccNumerator:function(){var a=this.$numeratorDiv,b=a.position(),c=a.height(),d=a.width(),e=$('<div class="acc-num"></div>');this.removeAccDiv(),e.css({position:"absolute",top:b.top+8,left:b.left+10,width:d,height:c,outline:"2px dotted #aaa","pointer-events":"none","font-size":"0px"}),e.text(this.getAccMessage("base-exp-pair",14)),this.$base.append(e),this.equationManager.setCurrentAccView(this),this.accDiv=e,e.attr("tabindex",-1),e[0].focus()},startAccDenominator:function(){if(this.model.isDenominatorEmpty())return this.currentAccLevel=1,void this.getNextTileAcc();var a=this.$denominatorDiv,b=a.position(),c=a.height(),d=a.width(),e=$('<div class="acc-den"></div>');this.removeAccDiv(),e.css({position:"absolute",top:b.top+3,left:b.left+10,width:d,height:c,outline:"2px dotted #aaa","pointer-events":"none","font-size":"0px"}),e.text(this.getAccMessage("base-exp-pair",15)),this.$base.append(e),this.equationManager.setCurrentAccView(this),this.accDiv=e,e.attr("tabindex",-1),e[0].focus()},removeAccDiv:function(){this.accDiv&&this.accDiv.remove()},getAccString:function(){var a,b="";for(a=0;a<this.arrTileViews.length;a++)b+=this.arrTileViews[a].getAccString();return" "+b.trim()},isPresentAsParent:function(){return!0}},{})}(),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager,c=MathInteractives.Common.Utilities.Models.Rect,d=MathInteractives.Common.Utilities.Models.Point,e=a.TileView.scroll;a.ParenthesisTileView=a.TileView.extend({$coefficient:null,$leftBracket:null,$rightBracket:null,_iTreeHeight:null,parenthesisExponentId:null,_touchStartHandler:null,_touchMoveHandler:null,_touchEndHandler:null,_lastTap:null,setTreeHeight:function(a){if(this._iTreeHeight!==a){var b=this._iTreeHeight;this._iTreeHeight=a,this.onTreeHeightChange(b)}},initialize:function(){this.arrTileViews=[],this.$arrOperatorViews=[],this.setTreeHeight(1),a.BaseExpTileView.__super__.initialize.apply(this,arguments),this.listenEvents()},render:function(){var b=this.model.get("tileArray"),c=0;for(c=0;c<b.length;c++)this.arrTileViews[c]=a.TileView.createTileItemView(b.at(c),this,this.equationManager,this.player,this.filePath,this.manager,this.idPrefix)},events:{"mouseenter .parenthesis.exponent":"addHoverClassExponent","mouseleave .parenthesis.exponent":"removeHoverClassExponent","mouseenter .coefficient":"addHoverClassCoefficient","mouseleave .coefficient":"removeHoverClassCoefficient"},createView:function(){var c,d,e,f,g,h,i,j=a.TileView.CLASSES,k=this.model.get("exponent"),l=this.getValueText("exponent"),m=this.model.get("coefficient"),n=this.getValueText("coefficient"),o=0,p=this.getLevel(),q=j.Level,r=b.TileItem.BinTileType;if(i=this.equationManager.equationView.model.getIndexFromItem(this.model),m&&0>m&&(this.$coefficient=$("<div></div>").addClass(j.COEFFICIENT+" "+j.PARENTHESIS+" "+q+this.getLevel()),f=$("<div></div>").addClass("coefficient-value").html(n).appendTo(this.$coefficient),this.$coefficient.append(this.createBoxTileView()),g=$("<div></div>").addClass("acc-div acc-read-elem math-utilities-manager-access").appendTo(this.$coefficient)),this.$leftBracket=$("<div></div>").addClass(j.Bracket+" "+j.LeftBracket+" "+q+p),this.$rightBracket=$("<div></div>").addClass(j.Bracket+" "+j.RightBracket+" "+q+p),this.$base=$("<div></div>").addClass(j.BASE+" "+j.PARENTHESIS+" "+q+this.getLevel()),c=$("<div></div>").addClass("acc-div acc-read-elem math-utilities-manager-access").appendTo(this.$base),this.$exponent=$("<div></div>").addClass(j.EXPONENT+" "+q+p+" "+j.PARENTHESIS).attr({"data-tiletype":r.EXPONENT}),this.equationManager.model.get("mode")===b.EquationManager.MODES.SolveMode){var s=parseInt(this.equationManager.getExponentId());this.model.get("type")===b.TileItem.SolveTileType.BIG_PARENTHESIS?(this.equationManager.parenthesisAdded(this,0,!0),s=0):this.equationManager.parenthesisAdded(this,s),this.$exponent.attr("id",this.equationManager.getIdPrefix()+"exponent-"+s),this.parenthesisExponentId=s}for(e=$("<div></div>").addClass("exponent-value").appendTo(this.$exponent),null!==k&&void 0!==k?e.html(l):this.$exponent.addClass("empty"),0===k&&this.equationManager.isZeroGlowAllowed()&&this.$exponent.addClass("zero-glow"),this.$exponent.append(this.createBoxTileView()),d=$("<div></div>").addClass("acc-div acc-read-elem math-utilities-manager-access").html(k).appendTo(this.$exponent),(null===k||void 0===k||""===k)&&this.$exponent.addClass("empty"),m&&0>m&&this.$base.append(this.$coefficient),this.$base.append(this.$leftBracket),o=0;o<this.arrTileViews.length;o++)h=this.arrTileViews[o].createView(),this.$base.append(h);return this.$el.append(this.$base),this.$el.append(this.$exponent),this.$base.append(this.$rightBracket),this.$el.addClass(j.TermContainer+" "+q+p+" "+j.PARENTHESIS).attr("data-tiletype",r.PARENTHESIS),this.createOperatorView(),this.refreshTreeHeight(),this.$el},createBoxTileView:function(){return $('<div class="box"> <div class="inside-divs"></div> <div class="inside-divs"></div> <div class="inside-divs"></div> <div class="inside-divs"></div> <div class="inside-divs"></div> <div class="inside-divs"></div> </div>')},createOperatorView:function(){var b,c,d,e=0;this.getLevel(),a.TileView.CLASSES;for(e=0;e<this.arrTileViews.length;e++)d=this.arrTileViews[e],c=d.model.get("operator"),null!==c?(b=this.createOperator(c),b.insertBefore(d.$el),this.$arrOperatorViews[e]=b):this.$arrOperatorViews[e]=null},createOperator:function(b){var b,c,d=this.getLevel(),e=a.TileView.CLASSES,f=$("<div></div>");return null!==b?(c=$("<div></div>").addClass(e.OperatorContainer+" "+e.Level+d),("+"===b||"-"===b)&&f.text(b),f.addClass(e.Operator+" "+e[b]+" "+e.Level+(d+1)).appendTo(c),c):null},invertExponentText:function(a){var b=this.$exponent.find(".exponent-value");
0!==this.model.get("exponent")&&(a?b.html(this.getValueText("exponent")):b.html(this.invertText(b.text())))},isEmpty:function(){return!1},createHelper:function(){var a=$("<div></div>").addClass("parentheses-drag-helper"),b=($("<div></div>").addClass("parentheses-drag-helper-value").appendTo(a),$("<div></div>").css({display:"block"}).appendTo(a));this.createBoxTileView().appendTo(b);return a},getDraggbleHelper:function(){var a=b.TileItem.BinTileType,c=this.model.get("coefficient"),d=this.createHelper(),e=d.find(".parentheses-drag-helper-value");return c&&0>c?e.html("&minus;( )"):e.html("( )"),d.attr({"data-tiletype":a.PARENTHESIS,"data-tilevalue":c}),d.css({cursor:"url('"+this.getImagePath("closed-hand")+"'), move"}),d},showHideContentAfterDrag:function(a){a?(this.$coefficient&&this.$coefficient.css("visibility",""),this.$leftBracket.css("visibility",""),this.$rightBracket.css("visibility",""),this.$exponent.css("visibility","")):(this.$coefficient&&this.$coefficient.css("visibility","hidden"),this.$leftBracket.css("visibility","hidden"),this.$rightBracket.css("visibility","hidden"),this.$exponent.css("visibility","hidden"))},getTreeHeight:function(){var a=0,b=0,c=0;for(a=0;a<this.arrTileViews.length;a++)b=this.arrTileViews[a].getTreeHeight(),b>c&&(c=b);return this.setTreeHeight(c),c+1},refreshTreeHeight:function(){this.getTreeHeight()},refreshCursorAt:function(){var a=this.equationManager.model.get("mode"),c=b.EquationManager.MODES,d=this;a===c.SolveMode&&window.setTimeout(function(){d.$el.is(".ui-draggable")&&d.$el.draggable("option","cursorAt",{left:d.$el.width()/2,top:d.$el.height()/2})},0)},refresh:function(){this.curHoveredTile&&(this.curHoveredTile.$el.removeClass("white-border-left white-border-right"),this.curHoveredTile=null),a.ParenthesisTileView.__super__.refresh.apply(this,arguments)},listenEvents:function(){this.listenTo(this.model.get("tileArray"),"add",this.onAddTile),this.listenTo(this.model.get("tileArray"),"remove",this.onRemoveTile),this.listenTo(this.model,"change:exponent",this._onExponentChange),this.listenTo(this.model,"change:operator",this._onOperatorChange)},onTreeHeightChange:function(a){this.$el.removeClass("depth-"+a).addClass("depth-"+this._iTreeHeight)},_onOperatorChange:function(a,b){this.parent.changeOperatorArray(a,b)},onAddTile:function(c,d,e){var f,g=null!==e.at&&void 0!==e.at?e.at:d.length-1,h=(this.model.get("tileArray"),a.TileView.createTileItemView(c,this,this.equationManager,this.player,this.filePath,this.manager,this.idPrefix)),i=h.createView(),j=(this.equationManager.model.get("mode"),b.EquationManager.MODES,c.get("isAnimate"));this.equationManager.restrictFirstTileAnimation===!1&&j&&i.css({visibility:"hidden"}).addClass("animated-tiles"),0===g?i.insertAfter(this.$leftBracket):i.insertAfter(this.arrTileViews[g-1].$el),this.equationManager.restrictFirstTileAnimation===!0&&(this.equationManager.firstTile=i),f=this.createOperator(h.model.get("operator")),null!==f?(j===!0&&f.css("visibility","hidden").addClass("invisible-operators"),f.insertBefore(h.$el),this.$arrOperatorViews.splice(g,0,f)):this.$arrOperatorViews.splice(g,0,null),c.set("isAnimate",!1),this.equationManager.restrictFirstTileAnimation=!1,h.attachEvents(),this.equationManager.tileAdded(h),this.arrTileViews.splice(g,0,h),this.refreshCursorAt(),this.refreshTreeHeight()},onRemoveTile:function(a,c,d){var e,f=d.index,g=this.arrTileViews[f];g.model.get("operator"),this.equationManager.model.get("mode"),b.EquationManager.MODES;null!==this.$arrOperatorViews[f]&&(e=this.$arrOperatorViews[f]),this.$arrOperatorViews.splice(f,1),g.stopListeningEvents(!0),setTimeout(function(){e&&e.remove(),g.$el.remove()},0),this.arrTileViews.splice(f,1),this.refreshCursorAt(),this.refreshTreeHeight()},attachEvents:function(){var a=0,c=this,d=this.equationManager.model.get("mode"),e=b.EquationManager.MODES;b.BaseExpTile.TILE_TYPES,this.equationManager.getBuildModeParenthesisSize();for(this.$exponent.off("click").on("click",$.proxy(this._onExponentClick,this)),$.support.touch?(this.equationManager.isTouch()&&(delete this.events["mouseenter .parenthesis.exponent"],delete this.events["mouseleave .parenthesis.exponent"],delete this.events["mouseenter .coefficient"],delete this.events["mouseleave .coefficient"],this.delegateEvents(this.events)),MathInteractives.Common.Utilities.Models.Utils.addTouchAndHoldHandler(this,this.$exponent,600,this.addHoverClassExponent,this.removeHoverClassExponent,"exponent-hold"),this.$coefficient&&MathInteractives.Common.Utilities.Models.Utils.addTouchAndHoldHandler(this,this.$coefficient,600,this.addHoverClassCoefficient,this.removeHoverClassCoefficient,"coefficient-hold"),this._touchStartHandler=$.proxy(this._onTouchStart,this),this._touchEndHandler=$.proxy(this._onTouchEnd,this),this._touchMoveHandler=$.proxy(this._onTouchMove,this),this.el.addEventListener("touchstart",this._touchStartHandler,!1),this.$el.off("mousedown").on("mousedown",function(a){return c.onMouseDown(a)}),this.$el.off("mouseup").on("mouseup",function(a){return c.onMouseUp(a)})):(this.$el.off("mousedown").on("mousedown",function(a){return c.onMouseDown(a)}),this.$el.off("mouseup").on("mouseup",function(a){return c.onMouseUp(a)})),this.applyHandCursorToElem(this.$exponent),this.applyHandCursorToElem(this.$leftBracket),this.applyHandCursorToElem(this.$rightBracket),this.$coefficient&&this.applyHandCursorToElem(this.$coefficient),a=0;a<this.arrTileViews.length;a++)this.arrTileViews[a].attachEvents();d===e.BuildMode&&this.attachEventsOnExponent(),this.attachEventsOnTile(),this.$el.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(a,b){c.equationManager.getIsDropped()||(c.onTileDrop(a,b),c.$el.removeClass("white-border-left white-border-right white-border"),b.draggable.removeData("cur-droppable"),c.equationManager.setIsDropped(!0))},over:function(a,b){c.onMouseOver(a,b),b.draggable.data("cur-droppable",c)},out:function(a,b){c.onMouseOut(a,b),b.draggable.removeData("cur-droppable")}})},_onTouchStart:function(a){var b=a.changedTouches,c=b[0],d=document.createEvent("MouseEvent"),e=$.Event("mouseenter");this._lastTap=c.target,d.initMouseEvent("mousedown",!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),c.target.dispatchEvent(d),$(c.target).trigger(e),this.el.addEventListener("touchmove",this._touchMoveHandler,!1),this.el.addEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onTouchMove:function(a){var b=a.changedTouches,c=b[0],d=0,e=document.createEvent("MouseEvent");e.initMouseEvent("mousemove",!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,d,null),c.target.dispatchEvent(e),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onTouchEnd:function(a){var b=a.changedTouches,e=b[0],f=0,g=this.isDragging,h=document.createEvent("MouseEvent"),i=$.Event("mouseleave"),j=new d({left:e.clientX,top:e.clientY}),k=new c(this._lastTap.getBoundingClientRect());h.initMouseEvent("mouseup",!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,f,null),e.target.dispatchEvent(h),$(e.target).trigger(i),e.target===this._lastTap&&!g&&k.isPointInRect(j)&&(h=document.createEvent("MouseEvent"),h.initMouseEvent("click",!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(h)),this._lastTap=null,this.el.removeEventListener("touchmove",this._touchMoveHandler,!1),this.el.removeEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},attachEventsOnTile:function(){var c=this,f=this.$el.is(".ui-draggable"),g=this.equationManager.model.get("mode"),h=b.EquationManager.MODES,i=this.equationManager.getBuildModeParenthesisSize(),j=a.EquationManager.EVENTS;f?this.$el.draggable("enable"):this.$el.draggable({scroll:e.ENABLE,scrollSensitivity:e.SENSITIVITY,scrollSpeed:e.SPEED,distance:10,zIndex:1,containment:this.equationManager.$draggableContainment,cursorAt:g===h.SolveMode?{left:this.$el.width()/2,top:this.$el.height()/2}:{left:i.width/2,top:i.height/2},helper:function(){return g===h.SolveMode?c.$el:c.getDraggbleHelper()},revert:function(a){if(this.data("isDropped")===!0)return!1;var b=a.originalEvent?a.originalEvent:a,e=new d({left:b.clientX,top:b.clientY}),f=c.equationManager.isTileRemovable(c,e);return f?!1:(c.equationManager.trigger(j.REVERT_START),!0)},start:function(b,d){c.equationManager.equationView.attachDetachDraggable(c.cid,!0),c.isDragging=!0,g===h.SolveMode?(d.helper.data("prevLocationData",null),$(this).addClass("current-draggable")):c.showHideContentAfterDrag(!1),c.equationManager.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),c.$exponent.css({top:"","box-shadow":""}),d.helper.data({"cur-draggable":c})},drag:function(a,b){var c=$(this).data("cur-droppable"),e=a.originalEvent?a.originalEvent:a;new d({left:e.clientX,top:e.clientY});c&&c.onMouseOver(a,b)},stop:function(a,b){c.equationManager.equationView.attachDetachDraggable(c.cid,!1),setTimeout(function(){c.isDragging=!1},10),c._onDraggingStop(a,b,$(this)),c.equationManager.refresh(),c.equationManager.trigger(j.REVERT_END),c.equationManager.setIsDropped(!1)}})},_detachEvents:function(){this.$exponent.off("click"),this.$el.off("mousedown"),this.$el.off("mouseup"),$.support.touch&&(this.el.removeEventListener("touchstart",this._touchStartHandler,!1),this._touchStartHandler=null,this._touchMoveHandler=null,this._touchEndHandler=null),this.$el.is(".ui-draggable")&&this.$el.draggable("destroy"),this.$el.addClass("no-hover")},attachEventsOnExponent:function(){var c,f=this,g=this.$exponent.is(".ui-draggable"),h=this.equationManager.model.get("mode"),i=b.EquationManager.MODES,j=a.EquationManager.EVENTS,k=!1;this.equationManager.isParenthesisExponentDraggable()&&(null!==this.model.get("exponent")?g?this.$exponent.draggable("enable"):this.$exponent.draggable({scroll:e.ENABLE,scrollSensitivity:e.SENSITIVITY,scrollSpeed:e.SPEED,helper:"clone",cursorAt:{left:this.$exponent.width()/2,top:this.$exponent.height()/2},containment:this.equationManager.$draggableContainment,revert:function(a){return this.data("isDropped")===!0?!1:(k=f.equationManager.isTileRemovable(f,c),k?!1:(f.equationManager.trigger(j.REVERT_START),!0))},start:function(b,e){f.equationManager.equationView.attachDetachDraggable(f.cid,!0),k=!1;var g=b.originalEvent?b.originalEvent:b;f.isDragging=!0,c=new d({left:g.clientX,top:g.clientY}),e.helper.data({"cur-draggable":f}).css({"z-index":"3"}),f.$exponent.addClass("empty"),h===i.BuildMode&&f.equationManager.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START)},drag:function(a,b){var d=$(this).data("cur-droppable"),e=a.originalEvent?a.originalEvent:a;c.setPoint({left:e.clientX,top:e.clientY}),d&&d.onMouseOver(a,b)},stop:function(a,e){if(f.equationManager.equationView.attachDetachDraggable(f.cid,!1),f.isDragging=!1,e.helper.data("cur-draggable",f).css({"z-index":"auto"}),!$(this).data("isDropped")){f.$exponent.removeClass("empty").find(".exponent-value").html(f.getValueText("exponent"));var g,h=a.originalEvent?a.originalEvent:a;c=new d({left:h.clientX,top:h.clientY}),k&&(g={sourceTile:f,tiletype:b.TileItem.BinTileType.EXPONENT,numOfTiles:1},f.equationManager.onDeleteTile(g))}$(this).removeData("isDropped"),f.equationManager.trigger(j.REVERT_END),f.equationManager.refresh(),f.equationManager.setIsDropped(!1),k=!1}}):g&&this.$exponent.draggable("disable"))},_detachEventOnExponent:function(){this.$exponent.is(".ui-draggable")&&this.$exponent.draggable("destroy"),this.$exponent.addClass("no-hover")},_onDraggingStop:function(a,c,e){var f=this.equationManager.model.get("mode"),g=b.EquationManager.MODES,h=e.data(),i=h.isDropped;if(c.helper.removeData("cur-draggable"),e.removeClass("current-draggable"),e.removeData("isDropped"),f===g.SolveMode&&(c.helper.removeData("prevLocationData"),h.isDropped||this.invertExponentText(!0)),!i){var j=a.originalEvent?a.originalEvent:a,k=new d({left:j.clientX,top:j.clientY}),l=this.equationManager.isTileRemovable(this,k);if(l){var m={sourceTile:this,tiletype:b.TileItem.BinTileType.PARENTHESIS,numOfTiles:1};this.equationManager.onDeleteTile(m)}else this.showHideContentAfterDrag(!0)}this.equationManager.resetContainment()},onMouseDown:function(a){var e,f,g,h=a.originalEvent?a.originalEvent:a,i=h,j=null,k=new c(this.$leftBracket[0].getBoundingClientRect()),l=new c(this.$rightBracket[0].getBoundingClientRect()),m=new c(this.$exponent[0].getBoundingClientRect()),n=this.arrTileViews||null,o=this.equationManager.model.get("mode"),p=b.EquationManager.MODES,q=this.equationManager.getBuildModeParenthesisSize(),r=0;if(i="touchstart"===i.type?i.touches[0]:i,e=new d({left:i.clientX,top:i.clientY}),g=m.isPointInRect(e),this.$coefficient&&(f=new c(this.$coefficient[0].getBoundingClientRect())),g||k.isPointInRect(e)||l.isPointInRect(e)||f&&f.isPointInRect(e))return h.stopPropagation&&h.stopPropagation(),h.preventDefault&&h.preventDefault(),this.equationManager.removeMarquee(),g?o===p.BuildMode?(this.equationManager.adjustContainment(this.$exponent),this.attachEventsOnExponent()):(this.equationManager.adjustContainment(this.$el),this.attachEventsOnTile()):(this.attachEventsOnTile(),o===p.BuildMode?this.equationManager.adjustContainment(new c({left:0,top:0,width:q.width,height:q.height})):this.equationManager.adjustContainment(this.$el)),!1;if(null!==n)for(;r<n.length;r++)if(j=new c(n[r].el.getBoundingClientRect()),j=j.inflateRect(10,10),j.isPointInRect(e))return this.$el.draggable("disable"),!0;return this.$el.draggable("disable"),this.refreshCursorAt(),!0},onMouseUp:function(a){this.equationManager.model.get("mode"),b.EquationManager.MODES;this.$el.draggable("enable"),this.equationManager.resetContainment()},onMouseOver:function(a,e){var f,g=this.arrTileViews,h=0,i=b.TileItem.MultiplicationThresold,j=b.TileItem.AdditionThresold,k=a.originalEvent?a.originalEvent:a,l=new d({left:k.clientX,top:k.clientY}),m=null,n=null,o=!1,p=e.helper.data(),q=p["cur-draggable"],r=this.equationManager.model.get("mode"),s=b.EquationManager.MODES,t=p.tiletype,u=b.TileItem.BinTileType;if(this.equationManager.registerMouseOverTile(this,a,e),r===s.SolveMode){for(o=q.model.get("bDenominator"),this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),h=0;h<g.length;h++)if(f=g[h],f!==q){if(m=new c(f.el.getBoundingClientRect()),m=m.inflateRect(i,0),m.isPointInRect(l)){n=f,l.getLeft()<m.getMiddle().getLeft()?n.$el.addClass("white-border-left"):n.$el.addClass("white-border-right");break}if(m=m.inflateRect(j,0),m.isPointInRect(l)){n=f,l.getLeft()<m.getMiddle().getLeft()?n.$el.addClass("white-border-left"):n.$el.addClass("white-border-right");break}}null!==n?(this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=n):(this.hasChildView(q,!0)||void 0===q.$el||this.$el.removeClass("white-border-left white-border-right").addClass("white-border"),this.curHoveredTile=n)}else if(r===s.BuildMode){var v,w,x=!1,y=new c(this.$exponent[0].getBoundingClientRect());if(q||(x=!0),this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),this.$exponent.removeClass("hover-border"),t===u.PARENTHESIS)return;if(t===u.EXPONENT&&y.isPointInRect(l))return this.$exponent.addClass("hover-border"),void(this.curHoveredTile=null);for(h=0;h<g.length;h++)if(f=g[h],f!==q&&!f.isEmpty()){if(m=new c(f.el.getBoundingClientRect()),m=m.inflateRect(i,0),m.isPointInRect(l)){n=f,l.getLeft()<m.getMiddle().getLeft()?n.$el.addClass("white-border-left"):n.$el.addClass("white-border-right");break}if(m=m.inflateRect(j,0),m.isPointInRect(l)){n=f,l.getLeft()<m.getMiddle().getLeft()?n.$el.addClass("white-border-left"):n.$el.addClass("white-border-right");break}}if(null!==n)this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=n;else{if(this.$el.removeClass("white-border-left white-border-right white-border"),x||!x){var z=g[0],A=new c(z.el.getBoundingClientRect()),B=g[g.length-1],C=new c(B.el.getBoundingClientRect());v=new c(this.$leftBracket[0].getBoundingClientRect()),w=new c(this.$rightBracket[0].getBoundingClientRect()),z!==q&&!z.isEmpty()&&l.getLeft()<A.getLeft()&&l.getLeft()>v.getRight()?(z.$el.removeClass("white-border-right white-border").addClass("white-border-left "),n=z):B!==q&&!B.isEmpty()&&l.getLeft()>C.getRight()&&l.getLeft()<w.getLeft()&&(B.$el.removeClass("white-border-left white-border").addClass("white-border-right "),n=B)}this.curHoveredTile=n}}n&&this.equationManager.repositionBorderAdded(n.$el)},onMouseOut:function(a,b){this.curHoveredTile&&this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),this.$el.removeClass("white-border-left white-border-right white-border"),this.$exponent.removeClass("hover-border")},onTileDrop:function(a,e){var f,g,h=this.arrTileViews,i=0,j=b.TileItem.MultiplicationThresold,k=b.TileItem.AdditionThresold,l=a.originalEvent,m=new d({left:l.clientX,top:l.clientY}),n=null,o=null,p=-1,q=!0,r="*",s=e.helper.data(),t=s["cur-draggable"],u=s.tiletype,v=e.helper.data("length"),w=this.model.get("bDenominator"),x=1,y=b.TileItem.BinTileType,z=this.equationManager.model.get("mode"),A=b.EquationManager.MODES,B=!1,C=b.CommandFactory.EXIT_CODE;if(this.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile&&(this.curHoveredTile.$el.removeClass("white-border-left white-border-right white-border"),this.curHoveredTile=null),v&&(x=v),this.resetGreedyChild(e.draggable),z===A.SolveMode){for(i=0;i<h.length;i++)if(f=h[i],f!==t){if(n=new c(f.el.getBoundingClientRect()),n=n.inflateRect(j,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1);break}if(n=n.inflateRect(k,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1),r="+";break}}null===o||this.equationManager.isTileViewInsideMarquee(o)?this.hasChildView(t,!0)||this.equationManager.isTileViewInsideMarquee(this)||(g={sourceTile:t,destTile:this,numOfTiles:x},B=this.equationManager.onCombineTiles(g),B&&e.draggable.data("isDropped",!0)):(g={sourceTile:t,index:this.parent.getIndex(this)+"."+p,isDestDeno:w,numOfTiles:x,strOperator:r,isLeft:q},B=this.equationManager.onRepositionTile(g),B&&e.draggable.data("isDropped",!0))}else{var D,E,F=!1,G=new c(this.$exponent[0].getBoundingClientRect());for(this.$exponent.removeClass("hover-border"),t||(F=!0),i=0;i<h.length;i++){if(f=h[i],n=new c(f.el.getBoundingClientRect()),n=n.inflateRect(j,0),n.isPointInRect(m)){if(f===t){o=null;break}o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1);break}if(n=n.inflateRect(k,0),n.isPointInRect(m)){o=f,m.getLeft()<n.getMiddle().getLeft()?(p=i,q=!0):(p=i,q=!1),r="+";break}}if(null===o&&(F||!F)){if(u===y.EXPONENT&&G.isPointInRect(m))return void(F?(g={sourceTile:e.helper,destTile:this},B=this.equationManager.onReplaceTile(g),(B===C.SUCCESS||B===C.NO_OPERATION)&&e.draggable.data("isDropped",!0)):t!==this&&(g={sourceTile:t,destTile:this,type:u},B=this.equationManager.onSwapTile(g),(B===C.SUCCESS||B===C.NO_OPERATION)&&e.draggable.data("isDropped",!0)));var H=h[0],I=new c(H.el.getBoundingClientRect());if(D=new c(this.$leftBracket[0].getBoundingClientRect()),E=new c(this.$rightBracket[0].getBoundingClientRect()),!H.isEmpty()&&m.getLeft()<I.getLeft()&&m.getLeft()>D.getRight())o=H,q=!0;else{var J=h[h.length-1],K=new c(J.el.getBoundingClientRect());!J.isEmpty()&&m.getLeft()>K.getRight()&&m.getLeft()<E.getLeft()&&(o=J,q=!1)}p=h.indexOf(o)}F?o&&!o.isEmpty()&&(u===y.BASE||u===y.EXPONENT)&&(w=o.model.get("bDenominator"),g={sourceTile:e.helper,index:this.parent.getIndex(this)+"."+p.toString(),isDestDeno:w,strOperator:r,isLeft:q},B=this.equationManager.onAddTile(g),B&&e.draggable.data("isDropped",!0)):o&&!o.isEmpty()&&(u===y.BASE||u===y.EXPONENT?(g={sourceTile:t,tiletype:u,destTile:o,numOfTiles:v,strOperator:r,isLeft:q},B=this.equationManager.onRepositionIndividualTile(g),B&&e.draggable.data("isDropped",!0)):u!==y.MARQUEE||this.equationManager.isTileViewInsideMarquee(o)||(g={sourceTile:t,destTile:o,numOfTiles:v,strOperator:r,isLeft:q},B=this.equationManager.onRepositionTile(g),B&&e.draggable.data("isDropped",!0)))}},_onExponentClick:function(a){if(!this.isDragging){var c,d=this.equationManager.model.get("mode"),e=b.EquationManager.MODES;d===e.SolveMode&&(c=this.$exponent.attr("id").replace(this.equationManager.getIdPrefix()+"exponent-","")),this.equationManager.onExponentClick(this,parseInt(c),!0)}},_onExponentMouseDown:function(a){this.isDragging||this.$exponent.css({top:5,"box-shadow":"none"})},_onExponentMouseUp:function(a){this.$exponent.css({top:"","box-shadow":""})},_onExponentChange:function(a,c){var d=this.$exponent.find(".exponent-value"),e=this.getValueText("exponent");void 0===c||null===c||""===c?this.$exponent.addClass("empty"):(d.html(e),this.$exponent.removeClass("empty")),this.equationManager.isZeroGlowAllowed()&&(0===c&&this.$exponent?this.$exponent.addClass("zero-glow"):this.$exponent&&this.$exponent.removeClass("zero-glow")),this.equationManager.model.get("mode")===b.EquationManager.MODES.BuildMode&&this.attachEventsOnExponent()},addHoverClassCoefficient:function(a){this.$coefficient&&!this.$el.hasClass("no-hover")&&this.$coefficient.addClass("hover")},removeHoverClassCoefficient:function(a){this.$coefficient&&!this.$el.hasClass("no-hover")&&this.$coefficient.removeClass("hover")},getElementsInsideMarquee:function(a,b){var c=0,d=this.arrTileViews;if(this.isParenthesisInMarquee(b))this.equationManager.pushElementToSelection(this.parent.getIndex(this),this);else for(c=0;c<d.length;c++)this.arrTileViews[c].getElementsInsideMarquee(a,b)},isParenthesisInMarquee:function(a){var b=new c(this.$el.find(".base")[0].getBoundingClientRect()),d=null,e=new c(a[0].getBoundingClientRect()),f=b.getMiddle(),g=.5;return this.$coefficient&&(d=new c(this.$el.find(".coefficient")[0].getBoundingClientRect()),b.set("left",b.getLeft()+d.getWidth()),b.set("width",b.getWidth()-d.getWidth()),f=b.getMiddle()),e.isPointInRect(f)&&this.eitherBracketInside(a)&&e.getWidth()>g*b.getWidth()&&e.getHeight()>g*b.getHeight()},eitherBracketInside:function(a){var b=new c(a[0].getBoundingClientRect()),d=new c(this.$leftBracket[0].getBoundingClientRect()),e=new c(this.$rightBracket[0].getBoundingClientRect()),f=d.getMiddle(),g=e.getMiddle();return b.isPointInRect(f)||b.isPointInRect(g)},marqueeStartedOutside:function(a){var b=new c(this.$leftBracket[0].getBoundingClientRect()),d=new c(this.$rightBracket[0].getBoundingClientRect()),e=a.marqueeStartX;return e<b.getLeft()||e>d.getRight()},isRectInside:function(a,b){return a.getLeft()<b.getLeft()&&a.getRight()>b.getRight()&&a.getBottom()>b.getBottom()&&a.getTop()<b.getTop()},applyHandCursorToElem:function(b){if(!b.hasClass("empty")||b.hasClass("exponent")){var c,d,e=this;this.equationManager.isTouch()?(c="touchstart",d="touchend"):(c="mouseenter",d="mouseleave"),b.on(c,function(a){return e.isMarqueeDrawing()?!1:void($(this).hasClass("current-draggable")||b.css(e._getOpenHandCss()))}),b.on(d,function(){return e.isMarqueeDrawing()?!1:void($(this).hasClass("current-draggable")||b.css(e._getDefaultCursorCss()))}),b.on("mousedown",function(){b.css(e._getClosedHandCss()),e.equationManager.trigger(a.EquationManager.EVENTS.TILE_MOUSE_DOWN)}),b.on("mouseup",function(){b.css(e._getOpenHandCss())})}},getTileContentInHtmlForm:function(){var a,c=this.model,d=c.get("operator"),e=c.get("exponent"),f=c.get("coefficient"),g=this.arrTileViews,h=this.model.get("type")===b.TileItem.SolveTileType.BIG_PARENTHESIS?!0:!1,i="";for("*"===d&&(i+="<div class='operator-data-tab'><div></div></div>"),h&&(i+="<span class='big-parenthesis-container'><span class='open-parenthesis-data-tab'></span>"),-1===f?i+="<span><span>-1(</span>":h||(i+="<span><span>(</span>"),a=0;a<g.length;a++)i+=g[a].getTileContentInHtmlForm();return i+=h?"<span class='big-parenthesis-close-container'><span class='close-parenthesis-data-tab'></span>":"<span>)</span>",0>e&&(e=h?'<span class="minus-sign-exponent minus-sign-exponent-big-parenthesis">&minus;</span>'+Math.abs(e):'<span class="minus-sign-exponent">&minus;</span>'+Math.abs(e)),i+=h?"<div class='big-parenthesis-exponent-data-tab'>"+e+"</div></span></span>":"<div class='parenthesis-exponent-data-tab exponent-data-tab'>"+e+"</div></span>"},_getTutorialMouseEventPoint:function(b){b=Number(b);var c,d,e,f,g,h,i=0,j=0;return 0===b?(c=this.el,d=c.getBoundingClientRect(),g=d.height,h=d.width,e=d.top,f=d.left,j+=g/2,i+=h/2,{offset:{x:i,y:j},element:c}):1===b?(c=this.$exponent[0],d=c.getBoundingClientRect(),g=d.height,h=d.width,e=d.top,f=d.left,j+=g/2,i+=h/2,{offset:{x:i,y:j},element:c}):a.ParenthesisTileView.__super__._getTutorialMouseEventPoint.apply(this,arguments)},deActivateEventOnTiles:function(b){a.ParenthesisTileView.__super__.deActivateEventOnTiles.apply(this,arguments),this._detachEvents(),this._detachEventOnExponent()},attachEventOnView:function(a,c,d){var e=this.equationManager.model.get("mode"),f=b.EquationManager.MODES,g=this;switch($.support.touch&&(this._touchStartHandler=$.proxy(this._onTouchStart,this),this._touchEndHandler=$.proxy(this._onTouchEnd,this),this._touchMoveHandler=$.proxy(this._onTouchMove,this),this.el.addEventListener("touchstart",this._touchStartHandler,!1)),a){case 1:case 7:1===c&&(this.$exponent.off("click").on("click",$.proxy(this._onExponentClick,this)),this.$el.off("mousedown").on("mousedown",function(a){return g._onExpMouseDown(a)})),d&&this.equationManager.attachEventOnMenuItem(d,this.parenthesisExponentId,this);break;case 2:case 8:break;case 3:case 9:this.$el.on("mousedown",function(a){return g.onMouseDown(a)}),this.$el.on("mouseup",function(a){return g.onMouseUp(a)}),e===f.SolveMode&&(1===c?this.attachEventsOnExponent():this.attachEventsOnTile());break;case 6:this.$el.on("mousedown",function(a){return g.onMouseDown(a)}),this.$el.on("mouseup",function(a){return g.onMouseUp(a)})}},_onExpMouseDown:function(a){var b=new d({left:a.clientX,top:a.clientY}),e=new c(this.$exponent[0].getBoundingClientRect());return e.isPointInRect(b)?(a.stopPropagation(),a.preventDefault(),this.equationManager.removeMarquee(),!1):!0},_enableDisableTile:function(a,c,d){var e=b.TileItem.BinTileType,f="",g=this.$el;if(a)switch(a){case e.BASE:c&&this.$base.removeClass("no-hover"),this.$base.removeClass("inactive"),g.hasClass("custom-droppable-disabled")||c||this.$base.addClass("inactive").removeClass("new-created-tile");break;case e.EXPONENT:c&&this.$exponent.removeClass("no-hover"),this.$exponent.removeClass("inactive"),g.hasClass("custom-droppable-disabled")||c||this.$exponent.addClass("inactive").removeClass("new-created-tile")}else c&&this.$base.find(".no-hover").removeClass("no-hover");f=!c&&this.$base.hasClass("inactive")&&this.$exponent.hasClass("inactive")?"disable":"enable",d?g.is(".ui-draggable")&&g.draggable(f):(g.is(".ui-droppable")&&g.droppable(f),a!==e.EXPONENT&&(g.find(".inactive").removeClass("inactive"),g.find(".custom-droppable-disabled").removeClass("custom-droppable-disabled"),"enable"!==f&&g.addClass("custom-droppable-disabled").find(".new-created-tile").removeClass("new-created-tile")))},disableTiles:function(b){a.ParenthesisTileView.__super__.disableTiles.apply(this,arguments),this.$base.removeClass("inactive").addClass("inactive").removeClass("new-created-tile"),this.$exponent.removeClass("inactive").addClass("inactive").removeClass("new-created-tile"),this.$el.find(".custom-droppable-disabled").removeClass("custom-droppable-disabled")},attachDetachDraggable:function(a,c){var d,e=this.arrTileViews,f=c?"disable":"enable",g=c?"enable":"disable";if(this.equationManager.model.get("mode")===b.EquationManager.MODES.SolveMode&&!this.equationManager._tutorialMode){for(d=0;d<e.length;d++)e[d].attachDetachDraggable(a,c);if(a&&a===this.cid)return void(this.$el.is(".ui-droppable")&&this.$el.droppable(g));this.$el.is(".ui-draggable")&&this.$el.draggable(f),this.$el.is(".ui-droppable")&&this.$el.droppable(g)}},startAcc:function(a){this.equationManager.tileSelected||this.equationManager.isMarqueeSelectedForOp&&this.equationManager.isTileViewInsideMarquee(this)?a?this.getNextTileAcc():this.goPreviousAcc():this.startAccExp()},buildStartAcc:function(){this.startAcc(!0)},continueAcc:function(a){this.removeAccDiv(),this.getNextTileAcc()},buildContinueAcc:function(){this.removeAccDiv(),this.arrTileViews.length>0&&this.arrTileViews[0].buildStartAcc()},startAccExp:function(){var a=this.$exponent,c=a.position(),d=a.height(),e=a.width(),f=$('<div class="acc-par"></div>'),g=this.equationManager.model.get("mode"),h=b.EquationManager.MODES,i="";f.css({position:"absolute",top:c.top+2,left:c.left+4,width:e+3,height:d+4,outline:"2px dotted #aaa","font-size":0,"pointer-events":"none"}),this.removeAccDiv(),g===h.BuildMode?(i=this.getExpAccString()+this.getChildrenAccString(),f.text(i)):f.text(this.getTileAccString()),this.$el.append(f),this.accDiv=f,this.equationManager.setCurrentAccView(this),f.attr("tabindex",-1),f[0].focus(),this.equationManager.model.trigger("change:currentAccView"),this.attachEventsAcc()},getNextTileAcc:function(){this.arrTileViews.length>0&&this.arrTileViews[0].startAcc(!0)},startAccOnNextTile:function(){var a=this.getNextTile();this.currentAccLevel=null,void 0!=a?a.startAcc(!0):this.parent.startAccOnNextTile()},buildStartAccOnNextTile:function(){var a=this.getNextTile();this.currentAccLevel=null,void 0!=a?a.buildStartAcc():this.parent.buildStartAccOnNextTile()},getContainerToAppend:function(){return this.$el},goPreviousAcc:function(){var a=this.getPrevTile();this.removeAccDiv(),void 0!=a?a.shiftTabHandler(!1):this.parent.shiftTabHandler(!0)},buildGoPreviousAcc:function(){var a=this.getPrevTile();this.removeAccDiv(),void 0!=a?a.buildShiftTabHandler(!1):this.parent.buildShiftTabHandler(!0)},shiftTabHandler:function(a){if(a)this.startAcc(!1);else{var b=this.arrTileViews.length;b>0&&this.arrTileViews[b-1].shiftTabHandler(!1)}},buildShiftTabHandler:function(a){if(a)this.buildStartAcc();else{var b=this.arrTileViews.length;b>0&&this.arrTileViews[b-1].buildFocusDecider()}},buildSpacePressed:function(){},spacePressed:function(){this.hideAccDiv(),this.$exponent.trigger("click"),this.equationManager.applyExponentBtnViews[this.parenthesisExponentId].$el.hasClass("disabled")?this.equationManager.changeSignBtnViews[this.parenthesisExponentId].$el.hasClass("disabled")||this.setFocus("change-sign-button-"+this.parenthesisExponentId):this.setFocus("apply-exponent-button-"+this.parenthesisExponentId)},tutorialSpacePressed:function(){this.spacePressed()},removeAccDiv:function(){this.accDiv&&(this.detachEventsAcc(),this.accDiv.remove())},revertFocus:function(){var a=this.equationManager.model.get("mode"),c=b.EquationManager.MODES;this.removeAccDiv(),a===c.BuildMode?this.buildStartAcc(!0):this.startAcc(!0)},ctxMenuOpenHandler:function(){this.hideAccDiv()},ctxMenuHideHandler:function(a,b){a&&a.stopPropagation(),this.revertFocus()},ctxMenuSelectHandler:function(a,c){a.stopPropagation();var d=c.currentTarget.id,e=parseInt(d.substring(d.lastIndexOf("-")+1),10),f={};switch(e){case 0:this.removeAccDiv(),f.tiletype=b.TileItem.BinTileType.EXPONENT,f.numOfTiles=1,f.sourceTile=this,this.equationManager.onDeleteTile(f),this.equationManager.buildModeSetFocusOnTooltip();break;case 1:case 2:this.addParenthesesAcc();break;case 3:this.removeParenthesesAcc();break;case 9:this.moveAccrossVinculum()}},moveAccrossVinculum:function(){var a,c=this.model.get("bDenominator"),d=this.parent,e=b.TileItem.SolveTileType,f={};d.model.get("type")!==e.FRACTION&&(d=d.parent),a=d.getNumeratorLength(d.arrTileViews),c?f.index=d.getIndex(d.arrTileViews[a-1]):f.index=d.getIndex(d.arrTileViews[d.arrTileViews.length-1]),f.sourceTile=this,f.isDestDeno=!c,f.isLeft=!1,f.numOfTiles=1,f.strOperator="*",this.equationManager.onRepositionTile(f),this.equationManager.solveModeSetFocusOnTooltip()},removeParenthesesAcc:function(){var a={};this.removeAccDiv(),
a.tiletype=b.TileItem.BinTileType.PARENTHESIS,a.numOfTiles=1,a.sourceTile=this,this.equationManager.onDeleteTile(a),this.setFocus("droppable-region")},addParenthesesAcc:function(b){this.equationManager.trigger(a.FormExpressionEquationManager.EVENTS.NESTED_PARENTHESIS_CASE),this.equationManager.buildModeSetFocusOnTooltip()},getTileItemIndex:function(a){for(var b=this.arrTileViews,c=this.model.get("exponent"),d=0,e=null,f=null;d<b.length;d++)if(f=b[d].getTileItemIndex(a),null!==f.emptyTile&&(f.emptyTile===a||"BASE_EXPONENT"===f.emptyTile))return f;return"EXPONENT"===a&&null===c?(e="EXPONENT",{tileIndex:this.parent.getIndex(this),emptyTile:e}):f},getAccString:function(){var a,c="",d=b.TileItem.SolveTileType,e=this.model,f=e.get("exponent");for(e.get("operator")?c=this.getMessage("base-exp-pair",2):this.parent.model.get("type")===d.FRACTION&&e.get("bDenominator")&&(c=this.getMessage("base-exp-pair",1)),-1===this.model.get("coefficient")&&(c+=" "+this.model.get("coefficient")+" "+this.getMessage("base-exp-pair",2)),a=0;a<this.arrTileViews.length;a++)c+=this.arrTileViews[a].getAccString();return c=this.getMessage("base-exp-pair",17,[c,null!==f?f:this.getMessage("base-exp-pair",4)])," "+c.trim()},getSelfAccString:function(){var a="",b=this.model.get("exponent"),c=0;for(c=0;c<this.arrTileViews.length;c++)a+=this.arrTileViews[c].getAccString();return this.getMessage("base-exp-pair",17,[a,null!==b?b:this.getMessage("base-exp-pair",4)])},getExpAccString:function(){var a=this.model,b=a.get("exponent"),c=a.get("coefficient");return 1===c?this.getMessage("base-exp-pair",10,[null!==b?b:this.getMessage("base-exp-pair",4)]):this.getMessage("base-exp-pair",11,[null!==b?b:this.getMessage("base-exp-pair",4)])},getChildrenAccString:function(){var a,b,c="";for(a=0;a<this.arrTileViews.length;a++)b=this.arrTileViews[a],c+=" "+b.getOperatorAccString()+" "+b.getBaseAccString()+" "+b.getExpAccString();return c},getTileAccString:function(){var a=this.getMessage("base-exp-pair",10,[this.model.get("exponent")]);return a+=this.isPresentAsParent()?this.model.get("bDenominator")?this.getMessage("base-exp-pair",30):this.getMessage("base-exp-pair",29):this.getMessage("base-exp-pair",31),this.equationManager._tutorialMode?a+" "+this.getMessage("base-exp-pair",32):a+" "+this.getMessage("base-exp-pair",20)},isPresentAsParent:function(){return this.parent.isPresentAsParent()}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager,c=MathInteractives.Common.Utilities.Models.Rect,d=MathInteractives.Common.Utilities.Models.Point,e=a.TileView.scroll;a.BigParenthesisTileView=a.ParenthesisTileView.extend({initialize:function(){a.BigParenthesisTileView.__super__.initialize.apply(this,arguments),this.$el.addClass("big-parenthesis")},listenEvents:function(){this.listenTo(this.model,"change:exponent",this._onExponentChange)},attachEvents:function(){var a=0,c=this,d=this.equationManager.model.get("mode"),e=b.EquationManager.MODES;b.BaseExpTile.TILE_TYPES;for($.support.touch?(MathInteractives.Common.Utilities.Models.Utils.addTouchAndHoldHandler(this,this.$exponent,600,this.addHoverClassExponent,this.removeHoverClassExponent,"exponent-hold"),this._touchStartHandler=$.proxy(this._onTouchStart,this),this._touchEndHandler=$.proxy(this._onTouchEnd,this),this._touchMoveHandler=$.proxy(this._onTouchMove,this),this.el.addEventListener("touchstart",this._touchStartHandler,!1),this.$el.off("mousedown").on("mousedown",function(a){return c._onExpMouseDown(a)}),this.$el.off("mouseup").on("mouseup",function(a){return c._onExpMouseUp(a)})):(this.$el.off("mousedown").on("mousedown",function(a){return c._onExpMouseDown(a)}),this.$el.off("mouseup").on("mouseup",function(a){return c._onExpMouseUp(a)})),d===e.BuildMode?this.applyHandCursorToElem(this.$exponent):this.$exponent.css({cursor:"pointer"}),a=0;a<this.arrTileViews.length;a++)this.arrTileViews[a].attachEvents();d===e.BuildMode?this.attachEventsOnExponent():this.$exponent.off("click").on("click",$.proxy(this._onExponentClick,this)),this.$exponent.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(a,b){c.onTileDrop(a,b),b.draggable.removeData("cur-droppable")},over:function(a,b){c.onMouseOver(a,b),b.draggable.data("cur-droppable",c)},out:function(a,b){c.onMouseOut(a,b),b.draggable.removeData("cur-droppable")}})},_onTouchStart:function(a){var b=a.changedTouches,c=b[0],d=document.createEvent("MouseEvent"),e=$.Event("mouseenter");this._lastTap=c.target,d.initMouseEvent("mousedown",!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),c.target.dispatchEvent(d),$(c.target).trigger(e),this.el.addEventListener("touchmove",this._touchMoveHandler,!1),this.el.addEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onTouchMove:function(a){var b=a.changedTouches,c=b[0],d=0,e=document.createEvent("MouseEvent");e.initMouseEvent("mousemove",!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,d,null),c.target.dispatchEvent(e),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onTouchEnd:function(a){var b=a.changedTouches,e=b[0],f=0,g=this.isDragging,h=document.createEvent("MouseEvent"),i=$.Event("mouseleave"),j=new d({left:e.clientX,top:e.clientY}),k=new c(this._lastTap.getBoundingClientRect());h.initMouseEvent("mouseup",!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,f,null),e.target.dispatchEvent(h),$(e.target).trigger(i),e.target===this._lastTap&&!g&&k.isPointInRect(j)&&(h=document.createEvent("MouseEvent"),h.initMouseEvent("click",!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(h)),this._lastTap=null,this.el.removeEventListener("touchmove",this._touchMoveHandler,!1),this.el.removeEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},attachEventsOnExponent:function(){var c,f=this,g=this.$exponent.is(".ui-draggable"),h=a.EquationManager.EVENTS.ADD_STEP,i=!1;null!==this.model.get("exponent")?g?this.$exponent.draggable("enable"):this.$exponent.draggable({scroll:e.ENABLE,scrollSensitivity:e.SENSITIVITY,scrollSpeed:e.SPEED,helper:"clone",containment:this.equationManager.$draggableContainment,cursorAt:{left:this.$exponent.width()/2,top:this.$exponent.height()/2},revert:function(a){return this.data("isDropped")===!0?!1:(i=f.equationManager.isTileRemovable(f,c),i?!1:(f.equationManager.trigger(h.REVERT_START),!0))},start:function(b,e){var g=b.originalEvent?b.originalEvent:b;i=!1,c=new d({left:g.clientX,top:g.clientY}),e.helper.data({"cur-draggable":f}).css({"z-index":"3"}),f.$exponent.addClass("empty").find(".exponent-value").html(),f.equationManager.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),this.isDraggaing=!0},drag:function(a,b){var d=$(this).data("cur-droppable"),e=a.originalEvent?a.originalEvent:a;c.setPoint({left:e.clientX,top:e.clientY}),f.equationManager.isTileRemovable(b.helper,c),d&&d.onMouseOver(a,b)},stop:function(a,e){if(e.helper.data("cur-draggable",f).css({"z-index":"auto"}),!$(this).data("isDropped")){f.$exponent.removeClass("empty").find(".exponent-value").html(f.getValueText("exponent"));var g,j=a.originalEvent?a.originalEvent:a;c=new d({left:j.clientX,top:j.clientY}),i&&(g={sourceTile:f,tiletype:b.TileItem.BinTileType.EXPONENT,numOfTiles:1},f.equationManager.onDeleteTile(g))}$(this).removeData("isDropped"),f.equationManager.trigger(h.REVERT_END),f.equationManager.setIsDropped(!1),f.equationManager.refresh(),this.isDragging=!1,i=!1}}):g&&this.$exponent.draggable("disable")},_onExpMouseDown:function(a){var b=new d({left:a.clientX,top:a.clientY}),e=new c(this.$exponent[0].getBoundingClientRect());return e.isPointInRect(b)?(a.stopPropagation(),a.preventDefault(),this.equationManager.removeMarquee(),!1):!0},_onExpMouseUp:function(a){this.equationManager.showMarquee()},onMouseOver:function(a,e){var f=this.equationManager.model.get("mode"),g=b.EquationManager.MODES;if(this.equationManager.registerMouseOverTile(this,a,e),f===g.BuildMode){var h=a.originalEvent?a.originalEvent:a,i=new d({left:h.clientX,top:h.clientY}),j=e.helper.data(),k=j.tiletype,l=b.TileItem.BinTileType,m=new c(this.$exponent[0].getBoundingClientRect());this.$exponent.removeClass("hover-border"),k===l.EXPONENT&&m.isPointInRect(i)&&this.$exponent.addClass("hover-border")}},onMouseOut:function(a,b){this.$exponent.removeClass("hover-border")},onTileDrop:function(a,e){var f,g=a.originalEvent,h=new d({left:g.clientX,top:g.clientY}),i=e.helper.data(),j=i["cur-draggable"],k=i.tiletype,l=b.TileItem.BinTileType,m=this.equationManager.model.get("mode"),n=b.EquationManager.MODES,o=!1,p=b.CommandFactory.EXIT_CODE;if(m===n.BuildMode){var q=!1,r=new c(this.$exponent[0].getBoundingClientRect());this.$exponent.removeClass("hover-border"),j||(q=!0),k===l.EXPONENT&&r.isPointInRect(h)&&(q?(f={sourceTile:e.helper,destTile:this},o=this.equationManager.onReplaceTile(f)):(f={sourceTile:j,destTile:this,type:k},o=this.equationManager.onSwapTile(f)),(o===p.SUCCESS||o===p.NO_OPERATION)&&e.draggable.data("isDropped",!0))}},_onExponentClick:function(a){if(!this.isDragging){var c,d=this.equationManager.model.get("mode"),e=b.EquationManager.MODES;d===e.SolveMode&&(c=this.$exponent.attr("id").replace(this.equationManager.getIdPrefix()+"exponent-","")),this.equationManager.onExponentClick(this,parseInt(c),!0)}},_onExponentMouseDown:function(a){this.isDragging||this.$exponent.css({top:5,"box-shadow":"none"})},_onExponentMouseUp:function(a){this.$exponent.css({top:"","box-shadow":""})},attachEventOnView:function(a,c,d){var e=(this.equationManager.model.get("mode"),b.EquationManager.MODES,this);switch($.support.touch&&(MathInteractives.Common.Utilities.Models.Utils.addTouchAndHoldHandler(this,this.$exponent,600,this.addHoverClassExponent,this.removeHoverClassExponent,"exponent-hold"),this._touchStartHandler=$.proxy(this._onTouchStart,this),this._touchEndHandler=$.proxy(this._onTouchEnd,this),this._touchMoveHandler=$.proxy(this._onTouchMove,this),this.el.addEventListener("touchstart",this._touchStartHandler,!1)),a){case 1:case 7:1===c&&(this.$exponent.off("click").on("click",$.proxy(this._onExponentClick,this)),this.$el.off("mousedown").on("mousedown",function(a){return e._onExpMouseDown(a)})),d&&this.equationManager.attachEventOnMenuItem(d,this.parenthesisExponentId,this);break;case 2:case 8:break;case 3:case 9:this.$el.off("mousedown").on("mousedown",function(a){return e._onExpMouseDown(a)}),this.$el.off("mouseup").on("mouseup",function(a){return e._onExpMouseUp(a)});break;case 6:this.$el.off("mousedown").on("mousedown",function(a){return e._onExpMouseDown(a)}),this.$el.off("mouseup").on("mouseup",function(a){return e._onExpMouseUp(a)})}},_onExponentChange:function(a,c){var d=this.$exponent.find(".exponent-value"),e=this.getValueText("exponent");void 0===c||null===c||""===c?(d.html(),this.$exponent.addClass("empty")):(d.html(e),this.$exponent.removeClass("empty")),this.equationManager.model.get("mode")===b.EquationManager.MODES.BuildMode&&this.attachEventsOnExponent()},applyHandCursorToElem:function(c){if(c.hasClass("exponent")){var d,e,f=this;this.equationManager.isTouch()?(d="touchstart",e="touchend"):(d="mouseenter",e="mouseleave"),c.on(d,function(a){return f.isMarqueeDrawing()?!1:void($(this).hasClass("current-draggable")||(c.data("tiletype")===b.TileItem.BinTileType.EXPONENT&&f.equationManager.model.get("mode")===b.EquationManager.MODES.SolveMode?c.css("cursor","pointer"):c.css(f._getOpenHandCss()),$(this).hasClass("empty")&&c.css(f._getDefaultCursorCss())))}),c.on(e,function(){return f.isMarqueeDrawing()?!1:void($(this).hasClass("current-draggable")||$(this).hasClass("empty")&&c.css(f._getDefaultCursorCss()))}),c.on("mousedown",function(){c.css(f._getClosedHandCss()),$(this).hasClass("empty")&&c.css(f._getDefaultCursorCss()),f.equationManager.trigger(a.EquationManager.EVENTS.TILE_MOUSE_DOWN)}),c.on("mouseup",function(){c.css(f._getOpenHandCss()),$(this).hasClass("empty")&&c.css(f._getDefaultCursorCss())})}},getElementsInsideMarquee:function(a,b){var c,d=new MathInteractives.Common.Utilities.Models.Rect(b[0].getBoundingClientRect()),e=(d.getMiddle(),0),f=this.arrTileViews,g=this.arrTileViews[0],h=_.last(this.arrTileViews),i=(new MathInteractives.Common.Utilities.Models.Rect(g.el.getBoundingClientRect()),new MathInteractives.Common.Utilities.Models.Rect(h.el.getBoundingClientRect()),new MathInteractives.Common.Utilities.Models.Rect(this.$el[0].getBoundingClientRect()));i.getMiddle();for(c=f.length;c>e;e++)this.arrTileViews[e].getElementsInsideMarquee(a,b)},disableTiles:function(b){a.ParenthesisTileView.__super__.disableTiles.apply(this,arguments),this.$el.find(".inactive").removeClass("inactive"),this.$base.removeClass("inactive").addClass("inactive").removeClass("new-created-tile"),this.$exponent.removeClass("inactive").addClass("inactive").removeClass("new-created-tile")},startAcc:function(){this.startAccExp()},startAccExp:function(){var a=this.$exponent,c=a.position(),d=a.height(),e=a.width(),f=$('<div class="acc-big-par"></div>'),g=this.equationManager.model.get("mode"),h=b.EquationManager.MODES,i="";f.css({position:"absolute",top:c.top+2,left:c.left+4,width:e+3,height:d+4,outline:"2px dotted #aaa","font-size":0,"pointer-events":"none"}),this.equationManager.isSelectedTileExponent?f.text(this.getMessage("base-exp-pair",16)):(i=this.getMessage("base-exp-pair",7,[this.model.get("exponent")]),g===h.SolveMode&&(i+=this.equationManager._tutorialMode?" "+this.getMessage("base-exp-pair",32):" "+this.getMessage("base-exp-pair",20)),f.text(i)),this.$el.append(f),this.accDiv=f,this.equationManager.setCurrentAccView(this),f.attr("tabindex",-1),f[0].focus(),this.attachEventsAcc()},buildStartAcc:function(){this.startAcc()},continueAcc:function(a){this.removeAccDiv(),this.getNextTileAcc()},buildContinueAcc:function(a){this.removeAccDiv(),this.arrTileViews.length>0&&(this.equationManager.selectedTile?this.arrTileViews[0].startAccNumerator():this.arrTileViews[0].buildStartAcc())},getNextTileAcc:function(){this.arrTileViews.length>0&&this.arrTileViews[0].startAcc()},startAccOnNextTile:function(){this.accDiv&&this.removeAccDiv(),this.equationManager.setCurrentAccView(null),this.equationManager.trigger(a.EquationManager.EVENTS.SOLVE_TAB)},buildStartAccOnNextTile:function(){this.accDiv&&this.removeAccDiv(),this.equationManager.setCurrentAccView(null),this.equationManager.trigger(a.EquationManager.EVENTS.BUILD_TAB)},getContainerToAppend:function(){return this.$el},goPreviousAcc:function(a){this.removeAccDiv(),this.parent.shiftTabHandler()},buildGoPreviousAcc:function(){this.removeAccDiv(),this.equationManager.selectedTile?this.arrTileViews[0].startAccDenominator():this.parent.buildShiftTabHandler()},shiftTabHandler:function(){this.startAcc()},buildShiftTabHandler:function(){this.buildStartAcc()},buildSpacePressed:function(){},tutorialSpacePressed:function(){this.spacePressed()},removeAccDiv:function(){this.accDiv&&this.accDiv.remove()},startExpToggle:function(){return this.equationManager.isSelectedTileExponent?void this.buildStartAcc():!1},spaceToDropTile:function(a){var b=this.equationManager.selectedTile,c={sourceTile:b,destTile:this};this.equationManager.onReplaceTile(c),this.equationManager.selectedTile=null,this.equationManager.isSelectedTileExponent=!1,this.removeAccDiv(),this.equationManager.equationView.tileDroppedString=this.getAccMessage("base-exp-pair",12,[b.attr("data-tilevalue")]),this.equationManager.buildModeSetFocusOnTooltip()},getAccString:function(){var a,b="",c=this.model.get("exponent");for(a=0;a<this.arrTileViews.length;a++)b+=this.arrTileViews[a].getAccString();return b+=" "+this.getMessage("base-exp-pair",3,[null!==c?c:this.getMessage("base-exp-pair",4)])}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager,c=MathInteractives.Common.Utilities.Models.Rect,d=MathInteractives.Common.Utilities.Models.Point,e=a.TileView.scroll;a.BaseTileView=a.TileView.extend({initialize:function(){a.BaseTileView.__super__.initialize.apply(this,arguments)},render:function(){},events:{"mouseenter .base-container":"addHoverClassBase","mouseleave .base-container":"removeHoverClassBase"},createView:function(){var c=a.TileView.CLASSES,d=null,e=null,f=this.model.get("base"),g=this.getValueText("base"),h=b.TileItem.BinTileType;return e=MathInteractives.Common.Components.templates.baseTile({base:g,"base-class":c.BASE,baseTileType:h.BASE_ONLY,idPrefix:this.idPrefix,level:c.Level+this.getLevel()}),d=$(e),this.$base=d.find(".base-container"),(null===f||void 0===f||""===f)&&this.$base.addClass("empty"),this.$el.append(d).addClass(c.TermContainer).addClass(c.BASE_ONLY).addClass(c.Level+this.getLevel()).attr("data-tiletype",h.BASE_ONLY),this.model.get("isDraggable")||this.$el.find(".box").hide(),this.model.get("ignoreMarquee")&&(this.$el.addClass("ignore-marquee"),this.$el.addClass("lone-one")),this.$el},isEmpty:function(){var a=this.model;return null===a.get("base")?!0:!1},hasChildView:function(a){return!1},getBaseValue:function(){return this.model.get("base")},stopListeningEvents:function(a){this.stopListening()},attachEvents:function(){var a=this;this.equationManager.model.get("mode"),b.EquationManager.MODES,b.BaseExpTile.TILE_TYPES,this.model.get("base");$.support.touch&&(this.equationManager.isTouch()&&(delete this.events["mouseenter .base-container"],delete this.events["mouseleave .base-container"],this.delegateEvents(this.events)),MathInteractives.Common.Utilities.Models.Utils.addTouchAndHoldHandler(this,this.$base,600,this.addHoverClassBase,this.removeHoverClassBase,"base-hold"),this._touchStartHandler=$.proxy(this._onTouchStart,this),this._touchEndHandler=$.proxy(this._onTouchEnd,this),this.el.addEventListener("touchstart",this._touchStartHandler,!1)),this.applyHandCursorToElem(this.$base),this.listenTo(this.model,"change:operator",this._onOperatorChange),this.listenTo(this.model,"change:base",this._onBaseChange),this.$el.on("mousedown",function(b){return a._onMouseDownTile(b)}),this.$el.on("mouseup",function(b){return a._onMouseUpTile(b)}),this.attachEventsOnTile(),this.model.get("isDroppable")&&this.$el.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(b,c){if(!a.equationManager.getIsDropped()){var d=a.onTileDrop(b,c);return a.$el.removeClass("white-border-left white-border-right white-border"),c.draggable.removeData("cur-droppable"),a.equationManager.setIsDropped(!0),d}return!1},over:function(b,c){a.onMouseOver(b,c),c.draggable.data("cur-droppable",a)},out:function(b,c){a.onMouseOut(b,c),c.draggable.removeData("cur-droppable")}})},disablingMarquee:!1,attachEventsOnTile:function(){var b=this,c=this.$el.is(".ui-draggable"),d=a.EquationManager.EVENTS;this.model.get("isDraggable")&&(null!==this.model.get("base")?c?this.$el.draggable("enable"):this.$el.draggable({scroll:e.ENABLE,scrollSensitivity:e.SENSITIVITY,distance:10,scrollSpeed:e.SPEED,revert:function(a){return b.equationManager.trigger(d.REVERT_START),!0},zIndex:1,helper:"original",containment:b.equationManager.$draggableContainment,cursorAt:{left:this.$el.width()/2,top:this.$el.height()/2},start:function(c,d){b.equationManager.equationView.attachDetachDraggable(b.cid,!0),b.isDragging=!0,d.helper.addClass("current-draggable"),d.helper.data({"cur-draggable":b}),b.equationManager.marqueeView.isDisabled||(b.disablingMarquee=!0,b.equationManager.marqueeView.disableMarquee()),b.equationManager.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START)},drag:function(a,b){var c=$(this).data("cur-droppable");c&&c.onMouseOver(a,b)},stop:function(a,c){b.equationManager.equationView.attachDetachDraggable(b.cid,!1),b.equationManager.trigger(d.REVERT_END);var e=$(this);b.isDragging=!1,c.helper.removeData(["cur-draggable","cur-droppable"]),e.removeClass("current-draggable"),b.equationManager.resetContainment(),b.disablingMarquee&&(b.equationManager.marqueeView.enableMarquee(),b.disablingMarquee=!1),b.equationManager.refresh(),b.equationManager.setIsDropped(!1)}}):c&&this.$el.draggable("disable"),$.fn.EnableTouch(this.$el))},onMouseOver:function(a,b){this.equationManager.registerMouseOverTile(this,a,b),this.$el.removeClass("white-border-left white-border-right"),this.$base.addClass("hover-border")},onMouseOut:function(a,b){this.$el.removeClass("white-border"),this.$base.removeClass("hover-border")},_onMouseDownTile:function(a){var b=this.$el.is(".ui-draggable"),e=new c(this.el.getBoundingClientRect()),f=new d({left:a.clientX,top:a.clientY});return this.equationManager.adjustContainment(this.$el),e.isPointInRect(f)?(a.stopPropagation(),a.preventDefault(),this.equationManager.removeMarquee(),this.attachEventsOnTile(),!1):void(b&&this.$el.draggable("disable"))},_onMouseUpTile:function(a){this.equationManager.resetContainment(),this.attachEventsOnTile()},_onTouchStart:function(a){var b=a.changedTouches,c=b[0],d=$.Event("mouseenter");$(c.target).trigger(d),this.el.addEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onTouchEnd:function(a){var b=a.changedTouches,c=b[0],d=$.Event("mouseleave");$(c.target).trigger(d),this.el.removeEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},deActivateEventOnTiles:function(){var a=this.equationManager.model.get("mode"),c=b.EquationManager.MODES;this.$el.off("mousedown"),this.$el.off("mouseup"),this.$el.addClass("no-hover"),a===c.SolveMode&&this.detachEventsOnTile()},detachEventsOnTile:function(){var a=this.$el.is(".ui-draggable"),b=this.model;a&&null!==b.get("base")&&this.$el.draggable("destroy")},onTileDrop:function(a,e){var f=e.helper.data(),g=f["cur-draggable"],h=1,i=(new c(this.el.getBoundingClientRect()),a.originalEvent?a.originalEvent:a),j=(new d({left:i.originalEvent.clientX,top:i.originalEvent.clientY}),f.tiletype,b.TileItem.BinTileType,this.equationManager.model.get("mode")),k=b.EquationManager.MODES,l=!1,m=(b.CommandFactory.EXIT_CODE,{});f.length&&(h=f.length),this.resetGreedyChild(e.draggable),this.$el.removeClass("white-border-left white-border-right hover-border"),this.$base.removeClass("hover-border"),j===k.BuildMode||g&&!this.equationManager.isTileViewInsideMarquee(this)&&(m={sourceTile:g,destTile:this,numOfTiles:h},l=this.equationManager.onCombineTiles(m),l&&e.draggable.data("isDropped",!0))},_onOperatorChange:function(a,b){this.parent.changeOperatorArray(a,b)},_onBaseChange:function(a,b){var c=this.$base.find(".base-value"),d=this.getValueText("base");void 0===b||null===b||""===b?(c.html(),this.$base.addClass("empty")):(c.html(d),this.$base.removeClass("empty")),this.attachEventsOnTile()},refresh:function(){this.$base&&this.$base.removeClass("hover-border")},getElementsInsideMarquee:function(a,b){var c,d=new MathInteractives.Common.Utilities.Models.Rect(b[0].getBoundingClientRect()),e=null;c=new MathInteractives.Common.Utilities.Models.Rect(this.el.getBoundingClientRect()),e=c.getMiddle(),d.isPointInRect(e)&&this.equationManager.pushElementToSelection(this.parent.getIndex(this),this)},addHoverClassBase:function(){this.model.isOne()||this.$el.hasClass("no-hover")||this.$base.addClass("hover")},removeHoverClassBase:function(){this.model.isOne()||this.$el.hasClass("no-hover")||this.$base.removeClass("hover")},applyHandCursorToElem:function(b){var c,d,e=this;this.equationManager.isTouch()?(c="touchstart",d="touchend"):(c="mouseenter",d="mouseleave"),b.on(c,function(){e.model.isOne()||e.isMarqueeDrawing()||e.$el.hasClass("ui-draggable-dragging")||$(this).hasClass("empty")||b.css(e._getOpenHandCss())}),b.on(d,function(){e.model.isOne()||e.isMarqueeDrawing()||e.$el.hasClass("ui-draggable-dragging")||b.css(e._getDefaultCursorCss())}),b.on("mousedown",function(){e.model.isOne()||$(this).hasClass("empty")||(b.css(e._getClosedHandCss()),e.equationManager.trigger(a.EquationManager.EVENTS.TILE_MOUSE_DOWN))}),b.on("mouseup",function(){e.model.isOne()||$(this).hasClass("empty")||b.css(e._getOpenHandCss())})},_getTutorialMouseEventPoint:function(b){b=Number(b);var c,d,e,f,g,h,i=0,j=0;return-1===b?(c=this.el,d=c.getBoundingClientRect(),g=d.height,h=d.width,e=d.top,f=d.left,j+=g/2,i+=h/2,{offset:{x:i,y:j},element:[c,this.$(".base")[0],this.$(".exponent")[0]]}):0===b?(c=this.$(".base")[0],d=c.getBoundingClientRect(),g=d.height,h=d.width,e=d.top,f=d.left,j+=g/2,i+=h/2,{offset:{x:i,y:j},element:c}):1===b?(c=this.$(".exponent")[0],d=c.getBoundingClientRect(),g=d.height,h=d.width,e=d.top,f=d.left,j+=g/2,i+=h/2,{offset:{x:i,y:j},element:c}):a.BaseExpTileView.__super__._getTutorialMouseEventPoint.apply(this,arguments)},getTileContentInHtmlForm:function(){var a=this.model,b=a.get("operator"),c=a.get("base"),d="",e=c;return 0>e&&(c='<span class="minus-sign-base">&minus;</span>'+Math.abs(e)),"*"===b&&(d+="<div class='operator-data-tab'><div></div></div>"),d+=0>e?"<span class='base-exp-data-tab'>("+c+")</span>":"<span class='base-exp-data-tab'>"+c+"</span>"},_enableDisableTile:function(a,b,c){var d=b?"enable":"disable",e=this.$el;c&&(e.is(".ui-draggable")&&e.draggable(d),e.removeClass("custom-droppable-disabled"),e.find(".inactive").removeClass("inactive")),b&&e.removeClass("no-hover")},disableTiles:function(b){a.BaseTileView.__super__.disableTiles.apply(this,arguments),this.$el.removeClass("custom-droppable-disabled"),this.$base.removeClass("inactive").addClass("inactive").removeClass("new-created-tile")},attachEventOnView:function(a,c,d){this.equationManager.model.get("mode"),b.EquationManager.MODES;switch($.support.touch&&(this._touchStartHandler=$.proxy(this._onTouchStart,this),this._touchEndHandler=$.proxy(this._onTouchEnd,this),this.el.addEventListener("touchstart",this._touchStartHandler,!1)),a){case 1:case 2:case 8:break;case 3:case 9:this.$el.on("mousedown",$.proxy(this._onMouseDownTile,this)),this.$el.on("mouseup",$.proxy(this._onMouseUpTile,this)),this.attachEventsOnTile();break;case 6:this.$el.on("mousedown",$.proxy(this._onMouseDownTile,this)),this.$el.on("mouseup",$.proxy(this._onMouseUpTile,this))}},attachDetachDraggable:function(a,c){if(this.equationManager.model.get("mode")===b.EquationManager.MODES.SolveMode&&!this.equationManager._tutorialMode){var d=c?"disable":"enable",e=c?"enable":"disable";if(a&&a===this.cid)return void(this.$el.is(".ui-droppable")&&this.$el.droppable(e));this.$el.is(".ui-draggable")&&this.$el.draggable(d),this.$el.is(".ui-droppable")&&this.$el.droppable(e)}},enableAllOperator:function(){},startAcc:function(a){if(0!==this.$el.width()&&0!==this.$el.height())if(this.equationManager.tileSelected&&this.equationManager.tileSelected===this||this.equationManager.isMarqueeSelectedForOp&&this.equationManager.isTileViewInsideMarquee(this))a?this.getNextTileAcc():this.goPreviousAcc();else{var b=this.$(".base-container"),c=b.position(),d=b.height(),e=b.width(),f=$('<div class="acc-bo"></div>');f.css({position:"absolute",top:c.top+2,left:c.left+3,width:e+2,height:d+4,outline:"2px dotted #aaa","font-size":0,"pointer-events":"none"}),this.equationManager._tutorialMode?f.text(this.getTileAccString()+this.equationManager.tutorialCustomTileString):f.text(this.getTileAccString()),this.$(".base-inner").append(f),this.accDiv=f,this.equationManager.setCurrentAccView(this),f.attr("tabindex",-1),f[0].focus(),this.attachEventsAcc(),this.equationManager.model.trigger("change:currentAccView")}},continueAcc:function(){this.removeAccDiv(),this.getNextTileAcc()},getNextTileAcc:function(){var a=this.getNextTile();void 0!=a?a.startAcc(!0):this.parent.startAccOnNextTile()},goPreviousAcc:function(){var a=this.getPrevTile();this.removeAccDiv(),void 0!=a?a.shiftTabHandler(!1):this.parent.shiftTabHandler(!0)},buildFocusDecider:function(){this.buildStartAcc()},shiftTabHandler:function(){this.startAcc(!1)},buildShiftTabHandler:function(a){this.buildStartAcc()},buildSpacePressed:function(){},spacePressed:function(){var a=this.equationManager.tileSelected,b=this.equationManager.isMarqueeSelectedForOp;this.model.get("isDraggable")?null!=a||b?(this.removeAccDiv(),this.accCombineTiles(),this.equationManager.solveModeSetFocusOnTooltip(),this.equationManager.isMarqueeSelectedForOp=!1,this.equationManager.tileSelected=null):(this.equationManager.tileSelected=this,this.continueAcc()):null!=a&&(this.removeAccDiv(),this.equationManager.removeMarqueeAcc(),this.equationManager.solveModeSetFocusOnTooltip(),this.equationManager.isMarqueeSelectedForOp=!1,this.equationManager.tileSelected=null)},tutorialSpacePressed:function(a){-1!==a&&(a?(this.removeAccDiv(),this.accCombineTiles(),this.equationManager.solveModeSetFocusOnTooltip(),this.equationManager.removeMarqueeAcc(),this.equationManager.tileSelected=null,this.equationManager.isMarqueeSelectedForOp=!1):(this.removeAccDiv(),this.equationManager.tileSelected=this,this.$el.trigger("dragstart")))},removeAccDiv:function(){this.accDiv&&(this.detachEventsAcc(),this.accDiv.remove())},revertFocus:function(){this.removeAccDiv(),this.startAcc()},accCombineTiles:function(){var a=this.equationManager,b=a.tileSelected,c=a.isMarqueeSelectedForOp,d={};c?(d.sourceTile=a.marqueeSelectedItems[0],d.numOfTiles=a.marqueeSelectedItems.length,a.removeMarqueeAcc()):b&&(d.sourceTile=a.tileSelected,d.numOfTiles=1),d.destTile=this,a.onCombineTiles(d)},ctxMenuOpenHandler:function(){this.hideAccDiv()},ctxMenuHideHandler:function(a,b){a&&a.stopPropagation(),this.revertFocus()},ctxMenuSelectHandler:function(a,b){a.stopPropagation();var c=b.currentTarget.id,d=parseInt(c.substring(c.lastIndexOf("-")+1),10);switch(d){case 4:this.accCombineTermsCtx(!1);break;case 5:this.accCombineTermsCtx(!0);break;case 9:this.moveAccrossVinculum()}},moveAccrossVinculum:function(){var a,c=this.model.get("bDenominator"),d=this.parent,e=b.TileItem.SolveTileType,f={};d.model.get("type")!==e.FRACTION&&(d=d.parent),a=d.getNumeratorLength(d.arrTileViews),c?f.index=d.getIndex(d.arrTileViews[a-1]):f.index=d.getIndex(d.arrTileViews[d.arrTileViews.length-1]),f.sourceTile=this,f.isDestDeno=!c,f.isLeft=!1,f.numOfTiles=1,f.strOperator="*",this.equationManager.onRepositionTile(f),this.equationManager.solveModeSetFocusOnTooltip()},accCombineTermsCtx:function(a){this.removeAccDiv(),this.equationManager.tileSelected=this,this.equationManager.tutorialCustomTileString="",this.equationManager.accCombineOnFraction(a)},getAccString:function(a){var c="",d=b.TileItem.SolveTileType;return this.model.get("operator")?c=this.getMessage("base-exp-pair",2):this.parent.model.get("type")===d.FRACTION&&this.model.get("bDenominator")&&(c=this.getMessage("base-exp-pair",1)),c=c+" "+this.model.get("base")," "+c.trim()},getSelfAccString:function(){return this.model.get("isDraggable")?this.model.get("base"):this.model.get("base")+" "+this.getAccMessage("base-exp-pair",28)},getTileAccString:function(){var a=b.TileItem.SolveTileType,c=this.parent.model,d="";return d=this.model.get("isDraggable")?this.model.get("base"):this.model.get("base")+". "+this.getAccMessage("base-exp-pair",28),c.get("type")===a.PARENTHESIS&&(d+=1===this.parent.arrTileViews.length?" "+this.getMessage("base-exp-pair",19):" "+this.getMessage("base-exp-pair",18)),d+=this.isPresentAsParent()?this.model.get("bDenominator")?this.getMessage("base-exp-pair",30):this.getMessage("base-exp-pair",29):this.getMessage("base-exp-pair",31)},isPresentAsParent:function(){return this.parent.isPresentAsParent()}})}(),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManager,b=MathInteractives.Common.Components.Models.EquationManager,c=MathInteractives.Common.Utilities.Models.Rect,d=MathInteractives.Common.Utilities.Models.Point,e=a.TileView.scroll;a.BaseExpTileView=a.TileView.extend({initialize:function(){a.BaseExpTileView.__super__.initialize.apply(this,arguments)},render:function(){},
_touchStartHandler:null,_touchMoveHandler:null,_touchEndHandler:null,_lastTap:null,events:{"mouseenter .base-container":"addHoverClassBase","mouseenter .exponent-container":"addHoverClassExponent","mouseleave .base-container":"removeHoverClassBase","mouseleave .exponent-container":"removeHoverClassExponent"},createView:function(){var c=a.TileView.CLASSES,d=null,e=null,f=this.model.get("base"),g=this.getValueText("base"),h=this.model.get("exponent"),i=this.getValueText("exponent"),j=b.TileItem.BinTileType;return e=MathInteractives.Common.Components.templates.baseExpTile({base:g,exponent:i,"base-class":c.BASE,"exponent-class":c.EXPONENT,"base-exponent-class":c.BASE_EXPONENT,baseTileType:j.BASE,expTileType:j.EXPONENT,idPrefix:this.idPrefix,level:c.Level+this.getLevel()}),d=$(e),this.$base=d.find(".base-container"),this.$exponent=d.find(".exponent-container"),(null===f||void 0===f||""===f)&&this.$base.addClass("empty"),(null===h||void 0===h||""===h)&&this.$exponent.addClass("empty"),0===h&&this.equationManager.isZeroGlowAllowed()&&this.$exponent.addClass("zero-glow"),this.$el.append(d).addClass(c.TermContainer).addClass(c.BASE_EXPONENT).addClass(c.Level+this.getLevel()).attr("data-tiletype",j.BASE_EXPONENT),this.$el},invertExponentText:function(a){var b=this.$exponent.find(".exponent-value");0!==this.model.get("exponent")&&(a?b.html(this.getValueText("exponent")):b.html(this.invertText(b.text())))},isEmpty:function(){var a=this.model;return null===a.get("base")&&null===a.get("exponent")?!0:!1},isEmptyInView:function(){return this.$base.hasClass("empty")&&this.$exponent.hasClass("empty")?!0:!1},hasChildView:function(a){return!1},getBaseValue:function(){return this.model.get("base")},getExponentValue:function(){return this.model.get("exponent")},stopListeningEvents:function(a){this.stopListening()},attachEvents:function(){var a=this,c=this.equationManager.model.get("mode"),d=b.EquationManager.MODES;b.BaseExpTile.TILE_TYPES,this.model.get("base"),this.model.get("exponent");this.$base.on("click",$.proxy(this._onBaseClick,this)),this.$exponent.on("click",$.proxy(this._onExponentClick,this)),this.listenTo(this.model,"change:operator",this._onOperatorChange),this.listenTo(this.model,"change:exponent",this._onExponentChange),this.listenTo(this.model,"change:base",this._onBaseChange),this.applyHandCursorToElem(this.$base),this.applyHandCursorToElem(this.$exponent),c===d.SolveMode&&this.applyCloseCursorToElem(this.$el),$.support.touch?(this.equationManager.isTouch()&&(delete this.events["mouseenter .base-container"],delete this.events["mouseenter .exponent-container"],delete this.events["mouseleave .base-container"],delete this.events["mouseleave .exponent-container"],this.delegateEvents(this.events)),MathInteractives.Common.Utilities.Models.Utils.addTouchAndHoldHandler(this,this.$base,600,this.addHoverClassBase,this.removeHoverClassBase,"base-hold"),MathInteractives.Common.Utilities.Models.Utils.addTouchAndHoldHandler(this,this.$exponent,600,this.addHoverClassExponent,this.removeHoverClassExponent,"base-hold"),this._touchStartHandler=$.proxy(this._onTouchStart,this),this._touchEndHandler=$.proxy(this._onTouchEnd,this),this._touchMoveHandler=$.proxy(this._onTouchMove,this),this.el.addEventListener("touchstart",this._touchStartHandler,!1),this.$el.on("mousedown",function(b){return a._onMouseDownTile(b)}),this.$el.on("mouseup",function(b){return a._onMouseUpTile(b)})):(this.$el.on("mousedown",function(b){return a._onMouseDownTile(b)}),this.$el.on("mouseup",function(b){return a._onMouseUpTile(b)})),c===d.BuildMode?(this.attachEventsOnBase(),this.attachEventsOnExponent()):c===d.SolveMode&&this.attachEventsOnTile(),this.$el.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(b,c){if(!a.equationManager.getIsDropped()){var d=a.onTileDrop(b,c);return a.$el.removeClass("white-border-left white-border-right white-border"),c.draggable.removeData("cur-droppable"),a.equationManager.setIsDropped(!0),d}return!1},over:function(b,c){a.onMouseOver(b,c),c.draggable.data("cur-droppable",a)},out:function(b,c){a.onMouseOut(b,c),c.draggable.removeData("cur-droppable")}})},disablingMarquee:!1,attachEventsOnTile:function(){var c=this,d=this.equationManager.model.get("mode"),f=b.EquationManager.MODES,g=this.$el.is(".ui-draggable"),h=this.model,i=a.EquationManager.EVENTS;null!==h.get("base")&&null!==h.get("exponent")?g?this.$el.draggable("enable"):this.$el.draggable({scroll:e.ENABLE,distance:10,scrollSensitivity:e.SENSITIVITY,scrollSpeed:e.SPEED,revert:function(a){return c.equationManager.trigger(i.REVERT_START),this.data("isDropped")?!1:!0},zIndex:1,helper:d===f.BuildMode?"clone":"original",containment:this.equationManager.$draggableContainment,cursorAt:{left:this.$el.width()/2,top:this.$el.height()/2},start:function(b,e){c.equationManager.equationView.attachDetachDraggable(c.cid,!0),c.isDragging=!0,e.helper.addClass("current-draggable"),e.helper.data({"cur-draggable":c}),d===f.SolveMode&&e.helper.data("prevLocationData",null),c.equationManager.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),c.$exponent.css({top:"","box-shadow":""}),c.equationManager.marqueeView.isDisabled||(c.disablingMarquee=!0,c.equationManager.marqueeView.disableMarquee())},drag:function(a,b){var c=$(this).data("cur-droppable");c&&c.onMouseOver(a,b)},stop:function(a,b){c.equationManager.equationView.attachDetachDraggable(c.cid,!1);var e=$(this);setTimeout(function(){c.isDragging=!1},10),d===f.SolveMode&&(b.helper.removeData("prevLocationData"),e.data("isDropped")||c.invertExponentText(!0)),b.helper.removeData(["cur-draggable","cur-droppable"]),e.removeClass("current-draggable"),c.equationManager.resetContainment(),c.disablingMarquee&&(c.equationManager.marqueeView.enableMarquee(),c.disablingMarquee=!1),c.equationManager.refresh(),c.equationManager.trigger(i.REVERT_END),c.equationManager.setIsDropped(!1)}}):g&&this.$el.draggable("disable")},attachEventsOnBase:function(){var c,f=this,g=this.$base.is(".ui-draggable"),h=this.equationManager.model.get("mode"),i=b.EquationManager.MODES,j=a.EquationManager.EVENTS,k=!1;null!==this.model.get("base")?g?this.$base.draggable("enable"):this.$base.draggable({scroll:e.ENABLE,scrollSensitivity:e.SENSITIVITY,scrollSpeed:e.SPEED,helper:"clone",cursorAt:{left:this.$base.width()/2,top:this.$base.height()/2},containment:this.equationManager.$draggableContainment,revert:function(a){return f.helper.css(f._getDefaultCursorCss()),this.data("isDropped")===!0?!1:(k=f.equationManager.isTileRemovable(f,c),k?!1:(f.equationManager.showHideOverlayDiv(!0),f.equationManager.trigger(j.REVERT_START),!0))},start:function(b,e){f.equationManager.equationView.attachDetachDraggable(f.cid,!0),k=!1;var g=b.originalEvent?b.originalEvent:b;f.isDragging=!0,c=new d({left:g.clientX,top:g.clientY}),f.helper=e.helper,e.helper.addClass("current-draggable"),e.helper.data({"cur-draggable":f}).css({"z-index":"3"}),f.$base.addClass("empty"),h===i.BuildMode&&f.equationManager.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),f.$el.droppable("disable")},drag:function(a,b){var d=$(this).data("cur-droppable"),e=a.originalEvent?a.originalEvent:a;c.setPoint({left:e.clientX,top:e.clientY}),d&&d.onMouseOver(a,b)},stop:function(a,e){if(f.equationManager.equationView.attachDetachDraggable(f.cid,!1),f.isDragging=!1,e.helper.css({"z-index":"auto"}),e.helper.removeClass("current-draggable"),!$(this).data("isDropped")){f.$base.removeClass("empty");var g=a.originalEvent?a.originalEvent:a;if(c=new d({left:g.clientX,top:g.clientY}),k){var h={sourceTile:f,tiletype:b.TileItem.BinTileType.BASE,numOfTiles:1};f.equationManager.onDeleteTile(h)}}$(this).removeData(["cur-draggable","isDropped"]),f.equationManager.showHideOverlayDiv(!1),f.$el.droppable("enable"),f.equationManager.trigger(j.REVERT_END),f.equationManager.refresh(),f.equationManager.setIsDropped(!1),k=!1}}):g&&this.$base.draggable("disable")},attachEventsOnExponent:function(){var c,f=this,g=this.$exponent.is(".ui-draggable"),h=this.equationManager.model.get("mode"),i=b.EquationManager.MODES,j=a.EquationManager.EVENTS,k=!1;null!==this.model.get("exponent")?g?this.$exponent.draggable("enable"):this.$exponent.draggable({scroll:e.ENABLE,scrollSensitivity:e.SENSITIVITY,scrollSpeed:e.SPEED,helper:"clone",cursorAt:{left:this.$exponent.width()/2,top:this.$exponent.height()/2},containment:this.equationManager.$draggableContainment,revert:function(a){return f.helper.css(f._getDefaultCursorCss()),this.data("isDropped")===!0?!1:(k=f.equationManager.isTileRemovable(f,c),k?!1:(f.equationManager.showHideOverlayDiv(!0),f.equationManager.trigger(j.REVERT_START),!0))},start:function(b,e){f.equationManager.equationView.attachDetachDraggable(f.cid,!0),k=!1,f.isDragging=!0,e.helper.addClass("current-draggable"),f.helper=e.helper;var g=b.originalEvent?b.originalEvent:b;c=new d({left:g.clientX,top:g.clientY}),e.helper.data({"cur-draggable":f}).css({"z-index":"3"}),f.$exponent.addClass("empty"),h===i.BuildMode&&f.equationManager.trigger(a.EquationManager.EVENTS.TILE_DRAGGING_START),f.$el.droppable("disable")},drag:function(a,b){var d=$(this).data("cur-droppable"),e=a.originalEvent?a.originalEvent:a;c.setPoint({left:e.clientX,top:e.clientY}),d&&d.onMouseOver(a,b)},stop:function(a,e){if(f.equationManager.equationView.attachDetachDraggable(f.cid,!1),f.isDragging=!1,e.helper.css({"z-index":"auto"}),e.helper.removeClass("current-draggable"),!$(this).data("isDropped")){f.$exponent.removeClass("empty");var g,h=a.originalEvent?a.originalEvent:a;c=new d({left:h.clientX,top:h.clientY}),k&&(g={sourceTile:f,tiletype:b.TileItem.BinTileType.EXPONENT,numOfTiles:1},f.equationManager.onDeleteTile(g))}$(this).removeData(["cur-draggable","isDropped"]),f.equationManager.showHideOverlayDiv(!1),f.$el.droppable("enable"),f.equationManager.trigger(j.REVERT_END),f.equationManager.refresh(),f.equationManager.setIsDropped(!1),k=!1}}):g&&this.$exponent.draggable("disable")},onMouseOver:function(a,e){var f=this.equationManager.model.get("mode"),g=b.EquationManager.MODES;if(this.equationManager.registerMouseOverTile(this,a,e),f===g.BuildMode){var h=b.TileItem.BinTileType,i=e.helper.data("cur-draggable"),j=new c(this.$base[0].getBoundingClientRect()),k=new c(this.$exponent[0].getBoundingClientRect()),l=a.originalEvent?a.originalEvent:a,m=new d({left:l.clientX,top:l.clientY}),n=e.helper.data("tiletype");this.$base.removeClass("hover-border"),this.$exponent.removeClass("hover-border"),i!==this&&(j.isPointInRect(m)&&n===h.BASE?this.$base.addClass("hover-border"):k.isPointInRect(m)&&n===h.EXPONENT?this.$exponent.addClass("hover-border"):n===h.PARENTHESIS?(this.$base.addClass("hover-border"),this.$exponent.addClass("hover-border")):this.isEmpty()&&n===h.MARQUEE&&(this.$base.addClass("hover-border"),this.$exponent.addClass("hover-border")))}else this.$el.removeClass("white-border-left white-border-right"),this.$base.addClass("hover-border"),this.$exponent.addClass("hover-border")},_onTouchStart:function(a){var b=a.changedTouches,c=b[0],d=document.createEvent("MouseEvent"),e=$.Event("mouseenter");this._lastTap=c.target,d.initMouseEvent("mousedown",!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),c.target.dispatchEvent(d),$(c.target).trigger(e),this.el.addEventListener("touchmove",this._touchMoveHandler,!1),this.el.addEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onTouchMove:function(a){var b=a.changedTouches,c=b[0],d=0,e=document.createEvent("MouseEvent");e.initMouseEvent("mousemove",!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,d,null),c.target.dispatchEvent(e),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onTouchEnd:function(a){var b=a.changedTouches,e=b[0],f=0,g=this.isDragging,h=document.createEvent("MouseEvent"),i=$.Event("mouseleave"),j=new d({left:e.clientX,top:e.clientY}),k=new c(this._lastTap.getBoundingClientRect());h.initMouseEvent("mouseup",!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,f,null),e.target.dispatchEvent(h),$(e.target).trigger(i),e.target===this._lastTap&&!g&&k.isPointInRect(j)&&(h=document.createEvent("MouseEvent"),h.initMouseEvent("click",!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(h)),this._lastTap=null,this.el.removeEventListener("touchmove",this._touchMoveHandler,!1),this.el.removeEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onMouseDownTile:function(a){var e,f,g,h=this.equationManager.model.get("mode"),i=b.EquationManager.MODES,j=new c(this.$base[0].getBoundingClientRect()),k=new c(this.$exponent[0].getBoundingClientRect()),l=a.originalEvent?a.originalEvent:a,m=this.$base.is(".ui-draggable"),n=this.$exponent.is(".ui-draggable"),o=this.$el.is(".ui-draggable");return l="touchstart"===l.type?l.touches[0]:l,e=new d({left:l.clientX,top:l.clientY}),f=j.isPointInRect(e),g=k.isPointInRect(e),f||g?(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),this.equationManager.removeMarquee(),h===i.SolveMode?(this.attachEventsOnTile(),this.equationManager.adjustContainment(this.$el)):(this.attachEventsOnBase(),this.attachEventsOnExponent(),f?this.equationManager.adjustContainment(this.$base):g&&this.equationManager.adjustContainment(this.$exponent)),!1):(h===i.SolveMode?o&&this.$el.draggable("disable"):(f&&m&&this.$base.draggable("disable"),n&&n&&this.$exponent.draggable("disable")),!0)},_onMouseUpTile:function(a){var c=this.equationManager.model.get("mode"),d=b.EquationManager.MODES,a=a.originalEvent?a.originalEvent:a;this.equationManager.resetContainment(),c===d.SolveMode?this.attachEventsOnTile():(this.attachEventsOnBase(),this.attachEventsOnExponent())},deActivateEventOnTiles:function(){var a=this.equationManager.model.get("mode"),c=b.EquationManager.MODES;this.$base.off("click"),this.$exponent.off("click"),this.$el.off("mousedown"),this.$el.off("mouseup"),$.support.touch&&(this.el.removeEventListener("touchstart",this._touchStartHandler,!1),this.el.removeEventListener("touchend",this._touchEndHandler,!1),this._touchStartHandler=null,this._touchMoveHandler=null,this._touchEndHandler=null),a===c.BuildMode?(this.detachEventsOnBase(),this.detachEventsOnExponent()):a===c.SolveMode&&this.detachEventsOnTile(),this.$base.addClass("no-hover"),this.$exponent.addClass("no-hover")},detachEventsOnTile:function(){var a=this.$el.is(".ui-draggable"),b=this.model;a&&null!==b.get("base")&&null!==b.get("exponent")&&this.$el.draggable("destroy")},detachEventsOnBase:function(){var a=this.$base.is(".ui-draggable");this.model;a&&null!==this.model.get("base")&&this.$base.draggable("destroy")},detachEventsOnExponent:function(){var a=this.$exponent.is(".ui-draggable");this.model;a&&null!==this.model.get("exponent")&&this.$exponent.draggable("destroy")},onMouseOut:function(a,b){this.$el.removeClass("white-border"),this.$base.removeClass("hover-border"),this.$exponent.removeClass("hover-border")},onTileDrop:function(a,e){var f=e.helper.data(),g=f["cur-draggable"],h=1,i=new c(this.$base[0].getBoundingClientRect()),j=new c(this.$exponent[0].getBoundingClientRect()),k=a.originalEvent?a.originalEvent:a,l=new d({left:k.originalEvent.clientX,top:k.originalEvent.clientY}),m=f.tiletype,n=b.TileItem.BinTileType,o=this.equationManager.model.get("mode"),p=b.EquationManager.MODES,q=!0,r=!1,s=b.CommandFactory.EXIT_CODE,t={};f.length&&(h=f.length),this.resetGreedyChild(e.draggable),this.$el.removeClass("white-border-left white-border-right white-border"),this.$base.removeClass("hover-border"),this.$exponent.removeClass("hover-border"),o===p.BuildMode?(this.$base.removeClass("hover-border"),this.$exponent.removeClass("hover-border"),g&&(q=!1),q?m===n.BASE&&i.isPointInRect(l)?(t={sourceTile:e.helper,destTile:this},r=this.equationManager.onReplaceTile(t),(r===s.SUCCESS||r===s.NO_OPERATION)&&e.draggable.data("isDropped",!0)):m===n.EXPONENT&&j.isPointInRect(l)?(t={sourceTile:e.helper,destTile:this},r=this.equationManager.onReplaceTile(t),(r===s.SUCCESS||r===s.NO_OPERATION)&&e.draggable.data("isDropped",!0)):m===n.PARENTHESIS&&(t={sourceTile:e.helper,index:this.parent.getIndex(this),isDestDeno:this.model.get("bDenominator")},r=this.equationManager.onAddTile(t),r&&e.draggable.data("isDropped",!0)):g!==this&&(m===n.BASE&&i.isPointInRect(l)?(t={sourceTile:g,destTile:this,type:m},r=this.equationManager.onSwapTile(t),(r===s.SUCCESS||r===s.NO_OPERATION)&&e.draggable.data("isDropped",!0)):m===n.EXPONENT&&j.isPointInRect(l)?(t={sourceTile:g,destTile:this,type:m},r=this.equationManager.onSwapTile(t),(r===s.SUCCESS||r===s.NO_OPERATION)&&e.draggable.data("isDropped",!0)):m===n.PARENTHESIS?(t={sourceTile:g,destTile:this,isDestDeno:this.model.get("bDenominator")},r=this.equationManager.onShiftParenthesis(t),r&&e.draggable.data("isDropped",!0)):m===n.MARQUEE&&!this.equationManager.isTileViewInsideMarquee(this)&&this.isEmpty()&&(t={sourceTile:g,destTile:this,isDestDeno:this.model.get("bDenominator"),isLeft:!0,numOfTiles:h},r=this.equationManager.onRepositionTile(t),r&&e.draggable.data("isDropped",!0)))):g&&!this.equationManager.isTileViewInsideMarquee(this)&&(t={sourceTile:g,destTile:this,numOfTiles:h},r=this.equationManager.onCombineTiles(t),r&&e.draggable.data("isDropped",!0))},_onOperatorChange:function(a,b){this.parent.changeOperatorArray(a,b)},_onBaseChange:function(a,c){var d=this.$base.find(".base-value"),e=this.getValueText("base");void 0===c||null===c||""===c?(d.html(),this.$base.addClass("empty")):(d.html(e),this.$base.removeClass("empty")),this.equationManager.model.get("mode")===b.EquationManager.MODES.BuildMode&&this.attachEventsOnBase()},_onExponentChange:function(a,c){var d=this.$exponent.find(".exponent-value"),e=this.getValueText("exponent");void 0===c||null===c||""===c?(d.html(),this.$exponent.addClass("empty")):(d.html(e),this.$exponent.removeClass("empty")),this.equationManager.isZeroGlowAllowed()&&(0===c&&this.$exponent?this.$exponent.addClass("zero-glow"):this.$exponent&&this.$exponent.removeClass("zero-glow")),this.equationManager.model.get("mode")===b.EquationManager.MODES.BuildMode&&this.attachEventsOnExponent()},_onBaseClick:function(a){this.isDragging||this.equationManager.onBaseClick(this)},_onExponentClick:function(a){this.isDragging||this.equationManager.onExponentClick(this)},_onExponentMouseDown:function(a){this.isDragging||this.$exponent.css({top:5,"box-shadow":"none"})},_onExponentMouseUp:function(a){this.$exponent.css({top:"","box-shadow":""})},refresh:function(){this.$base&&this.$base.removeClass("hover-border"),this.$exponent&&this.$exponent.removeClass("hover-border")},getElementsInsideMarquee:function(a,b){this.isTileInMarquee(b)&&this.equationManager.pushElementToSelection(this.parent.getIndex(this),this)},isTileInMarquee:function(a){var b=new c(this.$el[0].getBoundingClientRect()),d=new c(a[0].getBoundingClientRect()),e=b.getMiddle(),f=.5;return d.isPointInRect(e)&&d.getWidth()>f*b.getWidth()&&d.getHeight()>f*b.getHeight()},applyHandCursorToElem:function(b){var c=this,d="mouseenter",e="mouseleave";b.on(d,function(){c.isMarqueeDrawing()||c.$el.hasClass("ui-draggable-dragging")||$(this).hasClass("empty")||(b.css(c._getOpenHandCss()),c.$el.parents(".ui-draggable-dragging").length>0&&b.css(c._getClosedHandCss()))}),b.on(e,function(){c.isMarqueeDrawing()||c.$el.hasClass("ui-draggable-dragging")||b.css(c._getDefaultCursorCss())}),b.on("mousedown",function(){$(this).hasClass("empty")||(b.css(c._getClosedHandCss()),c.equationManager.trigger(a.EquationManager.EVENTS.TILE_MOUSE_DOWN))}),b.on("mouseup",function(){$(this).hasClass("empty")||b.css(c._getOpenHandCss())})},addHoverClassBase:function(){this.$base.hasClass("no-hover")||this.$base.addClass("hover")},removeHoverClassBase:function(){this.$base.hasClass("no-hover")||this.$base.removeClass("hover")},applyCloseCursorToElem:function(a){var b=this;a.on("mousedown",function(a){$(a.target).hasClass("empty")||(b.$exponent.css(b._getClosedHandCss()),b.$base.css(b._getClosedHandCss()))}),a.on("mouseup",function(a){$(a.target).hasClass("empty")||(b.$exponent.css(b._getOpenHandCss()),b.$base.css(b._getOpenHandCss()))})},_getTutorialMouseEventPoint:function(b){b=Number(b);var c,d,e,f,g,h,i=0,j=0;return-1===b?(c=this.el,d=c.getBoundingClientRect(),g=d.height,h=d.width,e=d.top,f=d.left,j+=g/2,i+=h/2,{offset:{x:i,y:j},element:[c,this.$(".base")[0],this.$(".exponent")[0]]}):0===b?(c=this.$(".base")[0],d=c.getBoundingClientRect(),g=d.height,h=d.width,e=d.top,f=d.left,j+=g/2,i+=h/2,{offset:{x:i,y:j},element:c}):1===b?(c=this.$(".exponent")[0],d=c.getBoundingClientRect(),g=d.height,h=d.width,e=d.top,f=d.left,j+=g/2,i+=h/2,{offset:{x:i,y:j},element:c}):a.BaseExpTileView.__super__._getTutorialMouseEventPoint.apply(this,arguments)},getTileContentInHtmlForm:function(){var a,b=this.model,c=b.get("operator"),d=b.get("base"),e=b.get("exponent"),f="";return 0>d&&(a='<span class="minus-sign-base">&minus;</span>'+Math.abs(d)),0>e&&(e='<span class="minus-sign-exponent">&minus;</span>'+Math.abs(e)),"*"===c&&(f+="<div class='operator-data-tab'><div></div></div>"),f+=0>d?"<span class='base-exp-data-tab'>("+a+")<div class='exponent-data-tab'>"+e+"</div></span>":"<span class='base-exp-data-tab'>"+d+"<div class='exponent-data-tab'>"+e+"</div></span>"},_enableDisableTile:function(a,c,d){var e=b.TileItem.BinTileType,f="",g=this.$el;if(a)switch(a){case e.BASE:c&&this.$base.removeClass("no-hover"),this.$base.removeClass("inactive"),g.hasClass("custom-droppable-disabled")||c||this.$base.addClass("inactive").removeClass("new-created-tile");break;case e.EXPONENT:c&&this.$exponent.removeClass("no-hover"),this.$exponent.removeClass("inactive"),g.hasClass("custom-droppable-disabled")||c||this.$exponent.addClass("inactive").removeClass("new-created-tile")}else c&&(this.$base.removeClass("no-hover"),this.$exponent.removeClass("no-hover"));f=!c&&this.$base.hasClass("inactive")&&this.$exponent.hasClass("inactive")?"disable":"enable",d?g.is(".ui-draggable")&&g.draggable(f):(g.is(".ui-droppable")&&g.droppable(f),g.removeClass("custom-droppable-disabled"),"enable"!==f&&(g.find(".inactive").removeClass("inactive"),g.addClass("custom-droppable-disabled").find(".new-created-tile").removeClass("new-created-tile")))},attachEventOnView:function(a,c,d){var e=this.equationManager.model.get("mode"),f=b.EquationManager.MODES,g=this;switch($.support.touch&&(this._touchStartHandler=$.proxy(this._onTouchStart,this),this._touchEndHandler=$.proxy(this._onTouchEnd,this),this._touchMoveHandler=$.proxy(this._onTouchMove,this),this.el.addEventListener("touchstart",this._touchStartHandler,!1)),a){case 1:case 7:0===c?this.$base.on("click",$.proxy(this._onBaseClick,this)):this.$exponent.on("click",$.proxy(this._onExponentClick,this));break;case 2:case 8:break;case 3:case 9:this.$el.on("mousedown",function(a){return g._onMouseDownTile(a)}),this.$el.on("mouseup",function(a){return g._onMouseUpTile(a)}),e===f.BuildMode?0===c?this.attachEventsOnBase():this.attachEventsOnExponent():e===f.SolveMode&&(0===c?this.attachEventsOnBase():1===c?this.attachEventsOnExponent():this.attachEventsOnTile());break;case 6:this.$el.on("mousedown",$.proxy(this._onMouseDownTile,this)),this.$el.on("mouseup",$.proxy(this._onMouseUpTile,this))}},disableTiles:function(){var a=this.equationManager.model.get("mode"),c=b.EquationManager.MODES;a===c.BuildMode?(this.$base.is(".ui-draggable")&&this.$base.draggable("disable"),this.$exponent.is(".ui-draggable")&&this.$exponent.draggable("disable")):a===c.SolveMode&&this.$el.is(".ui-draggable")&&this.$el.draggable("disable"),this.$el.is(".ui-droppable")&&this.$el.droppable("disable").addClass("custom-droppable-disabled").find(".new-created-tile").removeClass("new-created-tile"),this.$el.find(".inactive").removeClass("inactive")},attachDetachDraggable:function(a,c){var d=c?"disable":"enable",e=c?"enable":"disable";if(this.equationManager.model.get("mode")===b.EquationManager.MODES.SolveMode&&!this.equationManager._tutorialMode){if(a&&a===this.cid)return void(this.$el.is(".ui-droppable")&&this.$el.droppable(e));this.$el.is(".ui-draggable")&&this.$el.draggable(d),this.$el.is(".ui-droppable")&&this.$el.droppable(e)}},enableAllOperator:function(){},startAcc:function(a){var c=this.$el,d=c.height(),e=c.width();if(0===e||0===d)return!1;if(this.equationManager.tileSelected&&this.equationManager.tileSelected===this||this.equationManager.isMarqueeSelectedForOp&&this.equationManager.isTileViewInsideMarquee(this))a?this.getNextTileAcc():this.goPreviousAcc();else{var f=c.position(),g=$('<div class="acc-be"></div>'),h=b.TileItem.BinTileType;g.css({position:"absolute",top:f.top+2,left:f.left+6,width:e,height:d,outline:"2px dotted #aaa","font-size":0,"pointer-events":"none"}),this.equationManager._tutorialMode?g.text(this.getTileAccString()+this.equationManager.tutorialCustomTileString):g.text(this.getTileAccString()),this.parent.getContainerToAppend(this.model.get("bDenominator")).append(g),this.accDiv=g,this.equationManager.setCurrentAccView(this),g.attr("tabindex",-1),g[0].focus(),this.accTileType=h.BASE_EXPONENT,this.attachEventsAcc(),this.equationManager.model.trigger("change:currentAccView")}},buildStartAcc:function(){this.buildStartAccBase()},buildStartAccBase:function(){var a=this.$base,c=a.position(),d=a.height(),e=a.width(),f=$('<div class="acc-base"></div>'),g=b.TileItem.BinTileType,h="";f.css({position:"absolute",top:c.top+2,left:c.left+3,width:e+2,height:d+4,outline:"2px dotted #aaa","font-size":0,"pointer-events":"none"}),h=this.getBaseAccString()+" "+this.getExpAccString()+" "+this.getParentExpAccString(),f.text(h.trim()),this.$(".base-exponent-inner").append(f),this.equationManager.setCurrentAccView(this),this.accDiv=f,f.attr("tabindex",-1),f[0].focus(),this.accTileType=g.BASE,this.attachEventsAcc(),this.equationManager.model.trigger("change:currentAccView")},buildStartAccExp:function(){var a=this.$exponent,c=a.position(),d=a.height(),e=a.width(),f=$('<div class="acc-exp"></div>'),g=b.TileItem.BinTileType,h="";f.css({position:"absolute",top:c.top+2,left:c.left-4,width:e+3,height:d+4,outline:"2px dotted #aaa","font-size":0,"pointer-events":"none"}),h=this.getExpAccString()+" "+this.getBaseAccString()+" "+this.getParentExpAccString(),f.text(h.trim()),this.$(".base-exponent-inner").append(f),this.equationManager.setCurrentAccView(this),this.accDiv=f,f.attr("tabindex",-1),f[0].focus(),this.accTileType=g.EXPONENT,this.equationManager.model.trigger("change:currentAccView"),this.attachEventsAcc()},continueAcc:function(a){this.removeAccDiv(),this.getNextTileAcc()},buildContinueAcc:function(a){if($(document.activeElement).hasClass("acc-base"))this.removeAccDiv(),this.buildStartAccExp();else{var b=this.getNextTile();this.removeAccDiv(),void 0!=b?b.buildStartAcc():this.parent.buildStartAccOnNextTile()}},getNextTileAcc:function(){var a=this.getNextTile();void 0!=a?a.startAcc(!0):this.parent.startAccOnNextTile()},goPreviousAcc:function(){var a=this.getPrevTile();this.removeAccDiv(),void 0!=a?a.shiftTabHandler(!1):this.parent.shiftTabHandler(!0)},buildGoPreviousAcc:function(){if($(document.activeElement).hasClass("acc-exp"))this.removeAccDiv(),this.buildStartAccBase();else{var a=this.getPrevTile();this.removeAccDiv(),void 0!=a?a.buildShiftTabHandler(!1):this.parent.buildShiftTabHandler(!0)}},buildFocusDecider:function(){this.buildStartAccExp()},shiftTabHandler:function(){this.startAcc(!1)},buildShiftTabHandler:function(a){this.buildStartAccExp()},buildSpacePressed:function(){},spacePressed:function(){var a=this.equationManager.tileSelected,b=this.equationManager.isMarqueeSelectedForOp;null==a&!b?(this.equationManager.tileSelected=this,this.continueAcc()):(this.removeAccDiv(),this.accCombineTiles(),this.equationManager.solveModeSetFocusOnTooltip(),this.equationManager.removeMarqueeAcc(),this.equationManager.tileSelected=null,this.equationManager.isMarqueeSelectedForOp=!1)},tutorialSpacePressed:function(a){-1!==a&&(a?(this.removeAccDiv(),this.accCombineTiles(),this.equationManager.solveModeSetFocusOnTooltip(),this.equationManager.removeMarqueeAcc(),this.equationManager.tileSelected=null,this.equationManager.isMarqueeSelectedForOp=!1):(this.removeAccDiv(),this.equationManager.tileSelected=this,this.$el.trigger("dragstart")))},removeAccDiv:function(){this.accDiv&&(this.detachEventsAcc(),this.accDiv.remove())},ctxMenuOpenHandler:function(){this.hideAccDiv()},ctxMenuHideHandler:function(a,b){a&&a.stopPropagation(),this.revertFocus()},revertFocus:function(){var a=b.TileItem.BinTileType;switch(this.removeAccDiv(),this.accTileType){case a.BASE:this.buildStartAccBase();break;case a.EXPONENT:this.buildStartAccExp();break;default:this.startAcc()}},ctxMenuSelectHandler:function(a,b){a.stopPropagation();var c=b.currentTarget.id,d=parseInt(c.substring(c.lastIndexOf("-")+1),10);switch(d){case 0:this.performAccDeleteTile();break;case 1:this.addAccParenthesis(-1);break;case 2:this.addAccParenthesis(1);break;case 3:this.removeAccParenthesis();break;case 4:this.accCombineTermsCtx(!1);break;case 5:this.accCombineTermsCtx(!0);break;case 6:this.accBreakBase();break;case 7:case 8:this.accBreakExponent();break;case 9:this.moveAccrossVinculum()}},moveAccrossVinculum:function(){var a,c=this.model.get("bDenominator"),d=this.parent,e=b.TileItem.SolveTileType,f={};d.model.get("type")!==e.FRACTION&&(d=d.parent),a=d.getNumeratorLength(d.arrTileViews),c?f.index=d.getIndex(d.arrTileViews[a-1]):f.index=d.getIndex(d.arrTileViews[d.arrTileViews.length-1]),f.sourceTile=this,f.isDestDeno=!c,f.isLeft=!1,f.numOfTiles=1,f.strOperator="*",this.equationManager.onRepositionTile(f),this.equationManager.solveModeSetFocusOnTooltip()},accCombineTermsCtx:function(a){this.removeAccDiv(),this.equationManager.tileSelected=this,this.equationManager.tutorialCustomTileString="",this.$el.trigger("dragstart"),this.equationManager.accCombineOnFraction(a)},accBreakBase:function(){this.removeAccDiv(),this.$base.trigger("click"),this.equationManager.solveModeSetFocusOnTooltip()},accBreakExponent:function(){this.removeAccDiv(),this.$exponent.trigger("click"),this.equationManager.solveModeSetFocusOnTooltip()},performAccDeleteTile:function(){var a={};this.removeAccDiv(),a.tiletype=this.accTileType,a.numOfTiles=1,a.sourceTile=this,this.equationManager.onDeleteTile(a),this.setFocus("droppable-region")},addAccParenthesis:function(a){var c={};c.sourceTile={tileType:b.TileItem.BinTileType.PARENTHESIS,tilevalue:a},c.index=this.parent.getIndex(this),c.isDestDeno=this.model.get("bDenominator");this.equationManager.onAddTile(c,!0);this.equationManager.buildModeSetFocusOnTooltip()},removeAccParenthesis:function(){var a={};this.removeAccDiv(),a.tiletype=b.TileItem.BinTileType.PARENTHESIS,a.numOfTiles=1,a.sourceTile=this.parent,this.equationManager.onDeleteTile(a),this.setFocus("droppable-region")},accCombineTiles:function(){var a=this.equationManager,b=a.tileSelected,c=a.isMarqueeSelectedForOp,d={};c?(d.sourceTile=a.marqueeSelectedItems[0],d.numOfTiles=a.marqueeSelectedItems.length,a.removeMarqueeAcc()):b&&(d.sourceTile=a.tileSelected,d.numOfTiles=1),d.destTile=this,this.equationManager.onCombineTiles(d)},getTileItemIndex:function(a){var b=this.model.get("base"),c=this.model.get("exponent"),d=null;switch(a){case"BASE":d=null===b?a:null;break;case"EXPONENT":d=null===c?a:null;break;default:d=null===c&&null===b?a:null}return{tileIndex:this.parent.getIndex(this),emptyTile:d}},getAccString:function(){var a="",c=b.TileItem.SolveTileType,d=this.model,e=d.get("base"),f=d.get("exponent");return d.get("operator")?a=this.getMessage("base-exp-pair",2):this.parent.model.get("type")===c.FRACTION&&d.get("bDenominator")&&(a=this.getMessage("base-exp-pair",1)),a=a+" "+this.getMessage("base-exp-pair",0,[e?e:this.getMessage("base-exp-pair",4),null!==f?f:this.getMessage("base-exp-pair",4)])," "+a.trim()},getSelfAccString:function(){var a=this.model.get("base"),b=this.model.get("exponent");return this.getMessage("base-exp-pair",0,[a?a:this.getMessage("base-exp-pair",4),null!==b?b:this.getMessage("base-exp-pair",4)]);
},getBaseAccString:function(){var a=this.model.get("base");return this.getMessage("base-exp-pair",8,[a?a:this.getMessage("base-exp-pair",4)])},getExpAccString:function(){var a=this.model.get("exponent");return this.getMessage("base-exp-pair",9,[null!==a?a:this.getMessage("base-exp-pair",4)])},getParentExpAccString:function(){var a=b.TileItem.SolveTileType,c=this.parent.model;return c.get("type")===a.PARENTHESIS?this.parent.getExpAccString():""},getOperatorAccString:function(){return this.model.get("operator")?this.getMessage("base-exp-pair",2):""},getTileAccString:function(){var a=b.TileItem.SolveTileType,c=this.parent.model,d="";return d=this.getMessage("base-exp-pair",0,[this.model.get("base"),this.model.get("exponent")]),c.get("type")===a.PARENTHESIS&&(d+=1===this.parent.arrTileViews.length?" "+this.getMessage("base-exp-pair",19):" "+this.getMessage("base-exp-pair",18)),d+=this.isPresentAsParent()?this.model.get("bDenominator")?this.getMessage("base-exp-pair",30):this.getMessage("base-exp-pair",29):this.getMessage("base-exp-pair",31)},isPresentAsParent:function(){return this.parent.isPresentAsParent()}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.baseExpTile=a(function(a,b,c,d,e){function f(a,b){return'\r\n        <div class="acc-div acc-read-elem math-utilities-manager-access"></div>\r\n    '}function g(a,b){var d,e,f="";return f+='\r\n        <div class="acc-div acc-read-elem math-utilities-manager-access">',(e=c.base)?d=e.call(a,{hash:{},data:b}):(e=a&&a.base,d=typeof e===l?e.call(a,{hash:{},data:b}):e),f+=m(d)+"</div>\r\n        "}function h(a,b){var d,e,f="";return f+=' \r\n        <div class="acc-div acc-read-elem math-utilities-manager-access">',(e=c.exponent)?d=e.call(a,{hash:{},data:b}):(e=a&&a.exponent,d=typeof e===l?e.call(a,{hash:{},data:b}):e),f+=m(d)+"</div>\r\n        "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j,k="",l="function",m=this.escapeExpression,n=this;return k+='\ufeff<div class="base-exponent-inner ',(j=c.level)?i=j.call(b,{hash:{},data:e}):(j=b&&b.level,i=typeof j===l?j.call(b,{hash:{},data:e}):j),k+=m(i)+'">\r\n    ',i=c["if"].call(b,b&&b.isAccessible,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(i||0===i)&&(k+=i),k+='\r\n    <div class="base-container ',(j=c["base-class"])?i=j.call(b,{hash:{},data:e}):(j=b&&b["base-class"],i=typeof j===l?j.call(b,{hash:{},data:e}):j),k+=m(i)+" ",(j=c.level)?i=j.call(b,{hash:{},data:e}):(j=b&&b.level,i=typeof j===l?j.call(b,{hash:{},data:e}):j),k+=m(i)+' " data-tiletype="',(j=c.baseTileType)?i=j.call(b,{hash:{},data:e}):(j=b&&b.baseTileType,i=typeof j===l?j.call(b,{hash:{},data:e}):j),k+=m(i)+'">\r\n        <div class="base-value">',(j=c.base)?i=j.call(b,{hash:{},data:e}):(j=b&&b.base,i=typeof j===l?j.call(b,{hash:{},data:e}):j),(i||0===i)&&(k+=i),k+='</div>\r\n        <div class="box">\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n        </div>\r\n        ',i=c["if"].call(b,b&&b.isAccessible,{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(i||0===i)&&(k+=i),k+='\r\n    </div>\r\n    <div class="exponent-container ',(j=c["exponent-class"])?i=j.call(b,{hash:{},data:e}):(j=b&&b["exponent-class"],i=typeof j===l?j.call(b,{hash:{},data:e}):j),k+=m(i)+" ",(j=c.level)?i=j.call(b,{hash:{},data:e}):(j=b&&b.level,i=typeof j===l?j.call(b,{hash:{},data:e}):j),k+=m(i)+'" data-tiletype="',(j=c.expTileType)?i=j.call(b,{hash:{},data:e}):(j=b&&b.expTileType,i=typeof j===l?j.call(b,{hash:{},data:e}):j),k+=m(i)+'">\r\n        <div class="exponent-value">',(j=c.exponent)?i=j.call(b,{hash:{},data:e}):(j=b&&b.exponent,i=typeof j===l?j.call(b,{hash:{},data:e}):j),(i||0===i)&&(k+=i),k+='</div>\r\n        <div class="box">\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n        </div>\r\n        ',i=c["if"].call(b,b&&b.isAccessible,{hash:{},inverse:n.noop,fn:n.program(5,h,e),data:e}),(i||0===i)&&(k+=i),k+="\r\n    </div>\r\n</div>"})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.baseTile=a(function(a,b,c,d,e){function f(a,b){return' \r\n    <div class="acc-div acc-read-elem math-utilities-manager-access"></div>\r\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this;return i+='\ufeff<div class="base-inner ',(h=c.level)?g=h.call(b,{hash:{},data:e}):(h=b&&b.level,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'">\r\n    ',g=c["if"].call(b,b&&b.isAccessible,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(g||0===g)&&(i+=g),i+='\r\n    <div class="base-container ',(h=c["base-class"])?g=h.call(b,{hash:{},data:e}):(h=b&&b["base-class"],g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+" ",(h=c.level)?g=h.call(b,{hash:{},data:e}):(h=b&&b.level,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+' " data-tiletype="',(h=c.baseTileType)?g=h.call(b,{hash:{},data:e}):(h=b&&b.baseTileType,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'">\r\n        <div class="base-value">',(h=c.base)?g=h.call(b,{hash:{},data:e}):(h=b&&b.base,g=typeof h===j?h.call(b,{hash:{},data:e}):h),(g||0===g)&&(i+=g),i+='</div>\r\n        <div class="box">\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n        </div>\r\n    </div>\r\n</div>'})}();