!function(){"use strict";MathInteractives.Common.Components.Models.Pan=Backbone.Model.extend({defaults:function(){return{id:null,rows:null,columns:null,height:null,width:null,positionClass:null,droppedElements:[]}}})}(),function(){"use strict";MathInteractives.Common.Components.Models.PanBalanceEquation=Backbone.Model.extend({defaults:function(){return{coefficient:null,variable:"x",constantA:null,constantB:null}},getEquationString:function(){var a="",b=this.get("coefficient"),c=this.get("variable"),d=this.get("constantA"),e=this.get("constantB");return 0===b?null:(a+=1===b?c:b+c,0!==d&&(a+=0>d?" - "+d:" + "+d),a+=" = "+e)},getVariableValue:function(){var a=(this.get("constantB")-this.get("constantA"))/this.get("coefficient");return a}})}(),function(){"use strict";MathInteractives.Common.Components.Models.PanBalance=Backbone.Model.extend({defaults:function(){return{equationData:{a:4,b:11,c:-1},isDraggable:!1,enableDispenser:!1,isFilled:!0,dispenserData:[],leftPanWeight:0,rightPanWeight:0,currentPansData:null,showX:!1,xValue:0,prependID:"",isAnimation:!1,stepRotateObject:{rotate:0}}},xValue:null,initialize:function(){var a=this.getEquationData(),b={left:{a:a.a,b:a.b,c:0},right:{a:0,b:0,c:a.c}};null===this.getCurrentPansData()&&this.setCurrentPansData(b),this.on("change:xValue",$.proxy(this._xValueChange,this))},getEquationData:function(){return this.get("equationData")},setEquationData:function(a){this.set("equationData",a)},getXValue:function(){return this.get("showX")?this.get("xValue"):"<i>x</i>"},getShowX:function(){return this.get("showX")},setShowX:function(a){this.set("showX",a),this.trigger("pan-showX-change")},setXValue:function(a){this.set("xValue",a)},getLeftPanWeight:function(){return this.get("leftPanWeight")},setLeftPanWeight:function(a){var b=a.a*this.get("xValue")+a.b;this.set("leftPanWeight",b)},getRightPanWeight:function(){return this.get("rightPanWeight")},setRightPanWeight:function(a){var b=a.a*this.get("xValue")+a.b+a.c;this.set("rightPanWeight",b)},getCurrentPansData:function(){return this.get("currentPansData")},setCurrentPansData:function(a){this.set("currentPansData",a),this.setLeftPanWeight(a.left),this.setRightPanWeight(a.right),this.trigger("pan-data-change")},getHeavierPan:function(){var a="RIGHT";return this.getLeftPanWeight()>this.getRightPanWeight()?a="LEFT":this.getLeftPanWeight()===this.getRightPanWeight()&&(a="CENTRE"),this.get("showX")||(a="CENTRE"),a},_xValueChange:function(){this.setCurrentPansData(this.getCurrentPansData())}})}(),function(){"use strict";MathInteractives.Common.Components.Views.PanBalance=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,isDraggable:!1,isFilled:!0,currentAngle:0,xAddedTill_R:{row:3,col:0},startOthertilesFrom_R:{row:0,col:0},xAddedTill_L:{row:3,col:0},startOthertilesFrom_L:{row:0,col:0},enableDispenser:!1,isAnimation:!1,droppedTileId:0,stepRotateObject:{rotate:0},trashCanID:null,containmentID:null,isPanDisabled:!1,prependID:null,initialize:function(){this.prependID=this.model.get("prependID"),this.idPrefix=this.model.get("idPrefix"),this.idPrefix=this.idPrefix+this.prependID,this.manager=this.model.get("manager"),this.filePath=this.model.get("path"),this.isDraggable=this.model.get("isDraggable"),this.dispenserData=this.model.get("dispenserData"),this.isFilled=this.model.get("isFilled"),this.enableDispenser=this.model.get("enableDispenser"),this.defaultData=this.model.get("defaultData"),this.trashCanID=this.model.get("trashCanID"),this.containmentID=this.model.get("containmentID"),this.render()},render:function(){var a={idPrefix:this.idPrefix},b=MathInteractives.Common.Components.templates.panBalance(a).trim();this.$el.append(b),this._setBackgroundImage(".left-pan,.right-pan,.small-rod,.base,.center-rod"),this._attachEvents(),this.renderDispenser(),this.model.get("isDraggable")&&(this._initializeDroppableContainers(),this.defaultData&&this._renderDefaultTiles(this.defaultData)),this._activateTrashCan(this.trashCanID)},_resetData:function(a,b){this.xAddedTill_R={row:3,col:0},this.startOthertilesFrom_R={row:b.rowCount-1,col:0},this.xAddedTill_L={row:3,col:0},this.startOthertilesFrom_L={row:a.rowCount-1,col:0}},_attachEvents:function(){this.model.on("pan-data-change",$.proxy(this.eventHandlers._panDataChangeEvent,this)),this.model.on("pan-showX-change",$.proxy(this.eventHandlers._panShowXChangeEvent,this))},_setBackgroundImage:function(a){if(a){var b=this.filePath.getImagePath("pan-balance");this.$(a).css({"background-image":"url("+b+")"})}},animatePanBalance:function(a){var b=0;switch(a){case"LEFT":b=-5;break;case"RIGHT":b=5}var c=1e3,d=this,e=parseInt(this.$(".center-rod").css("width").split("px")[0]),f=e/2,g=d.$(".center-rod"),h=d.$(".left-pan-wrapper"),i=d.$(".right-pan-wrapper"),j=null,k=null,l=[];this.model.set("isAnimation",!0),this.model.set("stepRotateObject",$.extend({},{rotate:this.currentAngle})),$(this.model.get("stepRotateObject")).stop().animate({rotate:b},{step:function(a){j=Math.sin(Math.PI/180*a)*f,h.css("top",-j+"px"),i.css("top",j+"px"),g.css({"-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)",transform:"rotate("+a+"deg)"}),k=$("<span></span>"),$("body").append(k),l.push(k.get(0)),d.currentAngle=a},complete:function(){d.model.set("isAnimation",!1),$(l).remove()},duration:c})},renderPan:function(){if(!this.enableDispenser){var a,b,c,d=this.model.getCurrentPansData(),e=d.left,f=d.right,g=this.$(".left-tile-container .static-container"),h=this.$(".right-tile-container .static-container");!this.isDraggable&&this.isFilled&&(b=this._calculateRowsCols(Math.abs(e.a),Math.abs(e.b)+Math.abs(e.c)),c=this._calculateRowsCols(Math.abs(f.a),Math.abs(f.b)+Math.abs(f.c)),this._resetData(b,c),a=this._createTilesContainer(b),this.addElementsToPan(a,e.a,b,!0,"LEFT"),this.addElementsToPan(a,e.b,b,!1,"LEFT"),this.addElementsToPan(a,e.c,b,!1,"LEFT"),g.show().html(a),a=this._createTilesContainer(c),this.addElementsToPan(a,f.a,c,!0,"RIGHT"),this.addElementsToPan(a,f.b,c,!1,"RIGHT"),this.addElementsToPan(a,f.c,c,!1,"RIGHT"),h.show().html(a),this._adjustTablePosition(),this._displayEquation())}},_createTilesContainer:function(a){var b,c,d,e,f=a,g=f.rowCount,h=f.colCount,i=$("<div>",{"class":"pan-table"});for(d=0;g>d;d++)for(b=$("<div>",{"class":"pan-row row-"+d}),i.append(b),e=0;h>e;e++)c=$("<div>",{"class":"pan-cell cell-"+e}),b.append(c);return i},_calculateRowsCols:function(a,b){var c,d,e,f=3;return e=a>b?a:b,c=e>3?f:e,d=Math.ceil(a/c)+Math.ceil(b/c),d>5&&(d=5),{colCount:d,rowCount:c}},addElementsToPan:function(a,b,c,d,e){var f,g,h="coefficients",i=0,j=1,k=c.rowCount;c.colCount;if(d&&(h="coefficients-x",j=this.model.getXValue()),0>b&&(j=0===j?0:"string"==typeof j?"-"+j:-1*j,b=Math.abs(b)),d&&0!==b){for(var l=0,m=k-1;b>i;i++){0>m&&(l++,m=k-1);var n=$("<div>",{"class":h+" xCoefficient"});n.html(j),a.find(".row-"+m+" .cell-"+l).append(n),m--}"LEFT"===e?(this.xAddedTill_L={row:m+1,col:l},this.startOthertilesFrom_L={row:k-1,col:l+1}):(this.xAddedTill_R={row:m+1,col:l},this.startOthertilesFrom_R={row:k-1,col:l+1})}else{"LEFT"===e?(f=this.xAddedTill_L.row-1,g=this.xAddedTill_L.col):(f=this.xAddedTill_R.row-1,g=this.xAddedTill_R.col);for(var l="LEFT"===e?this.startOthertilesFrom_L.col:this.startOthertilesFrom_R.col,m="LEFT"===e?this.startOthertilesFrom_L.row:this.startOthertilesFrom_R.row;b>i;i++){0>m&&(l++,m=k-1);var n=$("<div>",{"class":h});n.html(j),l>4?(a.find(".row-"+f+" .cell-"+g).append(n),f--):a.find(".row-"+m+" .cell-"+l).append(n),m--}"LEFT"===e?this.startOthertilesFrom_L={row:m,col:l}:this.startOthertilesFrom_R={row:m,col:l}}},_adjustTablePosition:function(){var a=this.$(".left-tile-container .static-container"),b=this.$(".right-tile-container .static-container"),c=b.find(".pan-table"),d=a.find(".pan-table");c.css({top:b.height()-c.height()}),d.css({top:a.height()-d.height()})},_displayEquation:function(){var a=this.model.getCurrentPansData(),b=a.left,c=a.right,d=this.$(".left-pan .pan-data"),e=this.$(".right-pan .pan-data"),f="",g="";f=0===b.a?"":b.a+"<i>x</i>",1===Math.abs(b.a)&&(f="<i>x</i>",b.a<0&&(f="-<i>x</i>")),f+=0===b.b?"":b.b>0?" + "+b.b:" - "+Math.abs(b.b),f+=0===b.c?"":b.c>0?" + "+b.c:" - "+Math.abs(b.c),g=0===c.a?"":c.a+"<i>x</i>",1===Math.abs(c.a)&&(g="<i>x</i>",c.a<0&&(g="-<i>x</i>")),g+=0===c.b?"":c.b>0?" + "+c.b:" - "+Math.abs(c.b),g+=0===c.c?"":c.c>0?" + "+c.c:" - "+Math.abs(c.c),0===c.a&&0===c.b&&(g=Number(g.replace(/\s/g,""))),0===b.a&&0===b.b&&(f=Number(f.replace(/\s/g,""))),d.html(f),e.html(g)},setPansData:function(a){var b={left:{},right:{}};b.left.a=a.left.a||0,b.left.b=a.left.b||0,b.left.c=a.left.c||0,b.right.a=a.right.a||0,b.right.b=a.right.b||0,b.right.c=a.right.c||0,this.model.setCurrentPansData(b)},setXValue:function(a){this.model.setXValue(a)},showX:function(a){this.model.setShowX(a)},isAnimationOn:function(){return this.model.get("isAnimation")},eventHandlers:{_panDataChangeEvent:function(){this.renderPan(),this.model.getShowX()||(this.currentAngle=0),this.animatePanBalance(this.model.getHeavierPan())},_panShowXChangeEvent:function(){var a=this.model.getXValue(),b=this.model.getCurrentPansData();a=b.left.a>0?a:"string"==typeof a?"-"+a:-1*a,this.$(".left-tile-container .xCoefficient").html(a),a=b.right.a>0?a:"string"==typeof a?"-"+a:-1*a,this.$(".right-tile-container .xCoefficient").html(a),this.animatePanBalance(this.model.getHeavierPan())}},renderDispenser:function(a){if(this.enableDispenser){var b,c=this,d=MathInteractives.Common.Components.Views.PanBalance,e=a?a:this.dispenserData,f=e.length,g=0,h=(this.$(".dispenser-container").show(),this.$(".dispenser-row-1")),i=this.$(".dispenser-row-2"),j={revert:"invalid",zIndex:999,helper:"clone",start:function(a,b){c.trigger(d.TILE_DRAG)},containment:c._getContainmentSelector()},k=null;for(this.$(".dynamic-container");f>g;g++)b="Num"===e[g].type&&e[g].value>1?i:h,k=this._createDraggableTiles(b,e[g],this.idPrefix+"dispenser-tile-",g,!0),$.fn.EnableTouch(".pan-draggable-dispenser-tile"),k.draggable(j)}},_createDraggableTiles:function(a,b,c,d,e){var f=e?e:!1,g=b.isDisabled?b.isDisabled:this._getIsDisabled(),h=b.isVarNegative?b.isVarNegative:!1,i=MathInteractives.Common.Components.Views.PanBalance,j=b.text,k=b.type,l=b.value,m=MathInteractives.Common.Components.Views.Button.TYPE.DRAGGABLE_BLUE,n=46,o=n,p=this.filePath,q=c,r=null;"undefined"!=typeof d&&(q+=d),r=c+" pan-draggable-dispenser-tile draggable-tile"+k;var s=$("<div>",{id:q,"class":r}),t=null;o="Num"===k?n*Math.abs(l):54,f&&-1===j.indexOf(i.NEGATIVE_TILE_INDICATOR)&&("Var"===k&&(h&&(j=i.NEGATIVE_TILE_INDICATOR+j),j="<i>"+j+"</i>"),"Num"===k&&h&&(j=i.NEGATIVE_TILE_INDICATOR+j)),t={id:q,type:m,path:p,text:j,width:o,isDisabled:g},a.append(s);this._generateTileButton(t);return s.data({value:l,type:k,text:j,isVarNegative:h,isDisabled:g})},_generateTileButton:function(a){var b=MathInteractives.global.Button.generateButton(a);return a.isDisabled&&(b.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),b.setDraggableIcon(!a.isDisabled)),b},_initializeDroppableContainers:function(){var a=this,b=this.$(".dynamic-container"),c=null,d=MathInteractives.Common.Components.Views.PanBalance;c=this._createTilesContainer({rowCount:3,colCount:0}),b.find(".dynamic-wrapper").append(c),b.show().droppable({drop:function(b,c){var e=$(this).find(".dynamic-wrapper"),f=e.data().pos,g=c.draggable.data(),h={value:g.value,type:g.type,text:g.text,isVarNegative:g.isVarNegative},i=c.helper.clone(),j=null,k=!0;if(i.removeClass("ui-draggable-dragging").data(h),j=a._handleTilesPositionInContainer(e,i),j&&!e.parents(".pan-wrapper").hasClass(i.attr("panContainer")+"-pan-wrapper")){c.helper.hasClass("pan-dropped")&&c.draggable.remove(),a._makeTileDraggableAfterDrop(j);var l=c.helper.remove(),m=a.$("."+l.attr("panContainer")+"-pan-wrapper").find(".dynamic-wrapper"),n=Number(l.attr("rowNo"));a.animateDynamicPan(),l.attr("panContainer")&&a._arrangeTilesInPan(m,n)}else $(j).remove(),c.draggable.draggable("option","revert",!0),k=!1;k&&("right"===f?a.trigger(d.RIGHT_PAN_DROP,h):a.trigger(d.LEFT_PAN_DROP,h),a.trigger(d.PAN_DROP,h))}})},_handleTilesPositionInContainer:function(a,b,c){var d=c?c:!1,e=MathInteractives.Common.Components.Views.PanBalance.CONSTANT_PADDING_VALUE,f=this,g=(a.find(".pan-draggable-dispenser-tile"),2),h=null,i=null,j=b.data().isDisabled?b.data().isDisabled:this._getIsDisabled(),k=b.data().value,l=b.data().type,m=b.data().text,n=b.data().isVarNegative,o=this._getDroppedTileId(),p=this.idPrefix+"dropped-tile-"+o,q={type:l,text:m,value:k,isVarNegative:n,isDisabled:j},r=null,s=null;for("Var"===b.data().type&&(k=1);g>=0;g--)if(h=a.find(".row-"+g),r=f._isRowFull(h,k),i=r.isRowFull,!i)return s=f._createDraggableTiles(h,q,p,"",d),s.addClass("pan-draggable-dispenser-tile pan-dropped").attr({colNo:r.colNo,rowNo:g,panContainer:a.data().pos}),"Num"===l&&s.css({"margin-left":e*Math.abs(k)+"px","margin-right":e*Math.abs(k)+"px"}),f._incrementDroppedTileId(),j===!1&&s.on("dblclick",function(){f._doubleClickOnTileHandler($(this))}),s},_doubleClickOnTileHandler:function(a){if(!this._getIsDisabled()){var b=a.data().type,c=a.data().value,d=a.data().text,e=a.data().isVarNegative,f=a.data().isDisabled,g={value:c,type:b,text:d,isVarNegative:e,isDisabled:f},h=MathInteractives.Common.Components.Views.PanBalance;if("Num"===b&&c>1){var i=this,d=a.data().text,j=null,k=null,l={type:b,text:"1",value:1},m=a.attr("panContainer"),n=i.$("."+m+"-pan-wrapper").find(".dynamic-wrapper");for(a.remove(),j=0;c>j;j++){var o=$("<div>");o.data(l),k=i._handleTilesPositionInContainer(n,o),i._makeTileDraggableAfterDrop(k)}}this.trigger(h.DOUBLE_CLICK_TILE,g)}},_makeTileDraggableAfterDrop:function(a,b){var c=b?b:!1,d=this,e=MathInteractives.Common.Components.Views.PanBalance,f={revert:"invalid",zIndex:999,helper:"clone",start:function(a,b){$(this).css({visibility:"hidden"}),d.trigger(e.TILE_DRAG)},stop:function(a,b){$(this).css({visibility:"visible"})},containment:d._getContainmentSelector()};return $.fn.EnableTouch(".pan-draggable-dispenser-tile"),a.draggable(f),c?a.draggable("disable"):void 0},_isRowFull:function(a,b){var c=5,d=0,e=!1,f=a.find(".pan-draggable-dispenser-tile"),g=null;return f.each(function(){g=$(this);var a=Math.abs(g.data().value);"Var"===g.data().type&&(a=1),g.hasClass("ui-draggable-dragging")||(d+=a)}),d+=Math.abs(b),d>c&&(e=!0),{isRowFull:e,colNo:d}},_incrementDroppedTileId:function(){this.droppedTileId++},_getDroppedTileId:function(){return this.droppedTileId},_toggleDisableTiles:function(a,b,c){if("undefined"!=typeof a){var d=c?c:!1,e=this,f=b?b:this._getIsDisabled(),g=a,h=a.leftPan?a.leftPan:[],i=h.length,j=a.rightPan?a.rightPan:[],k=j.length,l=null,m=null,n=this.$(".left-pan-wrapper").find(".dynamic-container"),o=this.$(".right-pan-wrapper").find(".dynamic-container");for(l=0;i>l;l++){var p=$("<div>");h[l].isDisabled=f,p.data(h[l]),m=e._handleTilesPositionInContainer(n,p,d),m.attr("panContainer","left"),m=e._makeTileDraggableAfterDrop(m,f)}for(l=0;k>l;l++){var p=$("<div>");j[l].isDisabled=f,p.data(j[l]),m=e._handleTilesPositionInContainer(o,p,d),m.attr("panContainer","right"),m=e._makeTileDraggableAfterDrop(m,f)}g.position?e.animatePanBalance(g.position):e.animateDynamicPan()}},_renderDefaultTiles:function(a){var b=null;b="undefined"==typeof a.isDisabled?this._getIsDisabled():a.isDisabled;var c=this;c.clearPans(),c._toggleDisableTiles(a,b,!0)},_activateTrashCan:function(a){var b=this;$("#"+a).off("drop").on("drop",function(a,c){if(!c.draggable.hasClass("pan-dropped"))return void c.draggable.draggable("option","revert",!0);c.helper.hasClass("pan-dropped")&&c.draggable.remove();var d=MathInteractives.Common.Components.Views.PanBalance,e=c.draggable.data(),f={value:e.value,type:e.type,text:e.text,isVarNegative:e.isVarNegative},g=c.helper.remove(),h=b.$("."+g.attr("panContainer")+"-pan-wrapper").find(".dynamic-wrapper"),i=Number(g.attr("rowNo"));b.animateDynamicPan(),b._arrangeTilesInPan(h,i),b.trigger(d.TRASH_DROP,f)})},_getEquation:function(a,b){if("undefined"!=typeof a){var c=b?b:!1,d=MathInteractives.Common.Components.Views.PanBalance.VARIABLE_LABEL,e=this.$("."+a+"-pan-wrapper").find(".dynamic-container"),f=e.find(".pan-draggable-dispenser-tile"),g=[],h=null,i=0,j=0,k=null,l=null,m=null,n="",o=!0;if(f.each(function(){k=$(this),l=k.data(),m={value:l.value,type:l.type,text:l.text,isVarNegative:l.isVarNegative},"Num"===m.type&&(l.isVarNegative&&(m.value=-1*m.value),g.push(m.value))}),h=$(g),h.each(function(a,b){i+=b}),0>i&&(o=!1),j=this.getVariableCount(a),c){var p={constant:i,variable:j};return p}return 0===j?n=i.toString():0===i?(1===j?j="":-1===j&&(j="-"),n=j+'<span class="italic">'+d+"</span>"):(1===j?j="":-1===j&&(j="-"),n=o?j+'<span class="italic">'+d+"</span> + "+i:j+'<span class="italic">'+d+"</span> - "+Math.abs(i)),n}},_getContainmentSelector:function(){var a=this.containmentID;return"string"==typeof a?a="#"+a:"object"==typeof a&&(a=a),a},_arrangeTilesInPan:function(a,b,c){var d=this,e=c?c:this._getIsDisabled(),f=b,g=a,h=null,i=null,j=null,k=null;for(k=--f;k>-1;k--){var l=g.find(".row-"+k).children();l.each(function(){i=$(this),h={type:i.data().type,text:i.data().text,value:i.data().value,isVarNegative:i.data().isVarNegative,isDisabled:e},i.remove(),j=d._handleTilesPositionInContainer(g,i.data(h)),d._makeTileDraggableAfterDrop(j)})}},_getTileDataForPan:function(a){var b=this.$("."+a+"-pan-wrapper").find(".dynamic-container"),c=(b.find(".pan-row"),[]),d=MathInteractives.Common.Components.Views.PanBalance,e=null,f=null,g=null,h=null;return $(b.find(".pan-row").get().reverse()).each(function(){f=$(this).find(".pan-draggable-dispenser-tile"),f.each(function(){e=$(this),g=e.data(),"Var"===g.type&&(g.text=$(g.text).html()?$(g.text).html():g.text),h={type:g.type,text:g.text.toString().replace(d.NEGATIVE_TILE_INDICATOR,""),value:g.value,isVarNegative:g.isVarNegative,isDisabled:g.isDisabled},c.push(h)})}),c},_setIsDisabled:function(a){a?this.isPanDisabled=a:this.isPanDisabled=!1},_getIsDisabled:function(){return this.isPanDisabled},_getSpecificTypeTileCount:function(a,b,c){if("undefined"!=typeof b&&"undefined"!=typeof a){var d=this.getSaveState(),e=d[a+"Pan"],f=e.length,g=null,h=null,i=0,j=!1,k=c?c:!1;for(g=0;f>g;g++)h=e[g],k||(j=h.isVarNegative?h.isVarNegative:!1),h.type===b&&(j?i--:i++);return i}},renderDefaultTiles:function(a){a&&this._renderDefaultTiles(a)},disableDraggable:function(){this.$(".ui-draggable").draggable("disable"),this._setIsDisabled(!0);var a=this.getSaveState();this._renderDefaultTiles(a)},enableDraggable:function(){this.$(".ui-draggable").draggable("enable"),this._setIsDisabled(!1);var a=this.getSaveState();this._renderDefaultTiles(a)},showPanLabel:function(a,b){if("undefined"!=typeof a){var c=this.$("."+a+"-pan-wrapper").find(".pan-label"),d=null;d="undefined"==typeof b?this._getEquation(a):b,c.show().html(d)}},hidePanLabel:function(){this.$(".pan-label").hide()},showDispenser:function(){this.$(".dispenser-container").show()},hideDispenser:function(){this.$(".dispenser-container").hide()},isPanEmpty:function a(b){var c=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),d=c.find(".pan-draggable-dispenser-tile"),a=!1;return 0===d.length&&(a=!0),a},getPanWeight:function(a){var b=this.$("."+a+"-pan-wrapper").find(".dynamic-container"),c=b.find(".pan-draggable-dispenser-tile"),d=0,e=null,f=null;return c.each(function(){e=$(this);var a=1;e.data().isVarNegative&&(a=-1),e.hasClass("ui-draggable-dragging")||(f=e.data().value,d+=f*a)}),d},animateDynamicPan:function(){var a="LEFT",b=this.getPanWeight("left"),c=this.getPanWeight("right");c>b&&(a="RIGHT"),b===c&&(a="CENTER"),this.animatePanBalance(a)},clearPans:function(){this.$(".dynamic-wrapper").find(".pan-draggable-dispenser-tile").remove(),this.animateDynamicPan()},getVariableCount:function(a){return this._getSpecificTypeTileCount(a,"Var")},getAbsoluteVariableCount:function(a){return this._getSpecificTypeTileCount(a,"Var",!0)},getConstantsCount:function(a){return this._getSpecificTypeTileCount(a,"Num")},getEquationCoefficients:function(a){return this._getEquation(a,!0)},modifyDispenser:function(a){var b=this.$(".dispenser-container").find(".pan-draggable-dispenser-tile");b.remove(),this.renderDispenser(a)},getSaveState:function(){var a=this,b=null;return b={leftPan:a._getTileDataForPan("left"),rightPan:a._getTileDataForPan("right"),isDisabled:a._getIsDisabled()}}},{LEFT_PAN_DROP:"left_pan_drop",RIGHT_PAN_DROP:"right_pan_drop",PAN_DROP:"pan_drop",TRASH_DROP:"trash_drop",DOUBLE_CLICK_TILE:"double_click_tile",TILE_DRAG:"tile_drag",NEGATIVE_TILE_INDICATOR:"–",VARIABLE_LABEL:"x",CONSTANT_PADDING_VALUE:4,createPanBalance:function(a){var b;if(a){b="#"+a.containerId;var c=new MathInteractives.Common.Components.Models.PanBalance(a),d=new MathInteractives.Common.Components.Views.PanBalance({el:b,model:c});return d}},Position:{LEFT:0,CENTRE:1,RIGHT:2}}),MathInteractives.global.PanBalance=MathInteractives.Common.Components.Views.PanBalance}(),function(){"use strict";var a=null;MathInteractives.Common.Components.Views.PanBalanceDraggableTile=MathInteractives.Common.Player.Views.Base.extend({_backgroundPositions:null,isSelected:!1,initialize:function(a){this.filePath=a.filePath,this.tileData=a.buttonData,this.viewClassName=a.viewClassName,this.dataType=a.dataType,this.dataText=a.dataText,this.dataValue=a.dataValue,this._generateBackgroundPosition(),this.render(),a.buttonData.isDisabled?this.disableTile():this.enableTile()},render:function(){var a=this.tileData,b=this.viewClassName,c=this,d=c.$el,e=MathInteractives.Common.Components.templates.panBalanceDraggableTile({idPrefix:a.id}).trim();d.append(e),d.find(".pan-balance-draggable-tile-wrapper").css({width:a.width+"px",height:a.height+"px"}),82===a.width?(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER).addClass("text-var-container"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART).addClass("text-var"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW).addClass("var-tile-right-shadow"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW).addClass("var-tile-bottom-shadow")):(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER).removeClass("text-var-container"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART).removeClass("text-var"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW).removeClass("var-tile-right-shadow"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW).removeClass("var-tile-bottom-shadow"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW).addClass("num-tile-right-shadow"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW).addClass("num-tile-bottom-shadow")),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_LEFT_SHADOW).css({"background-image":'url("'+c.filePath.getImagePath("shadow-left")+'")',"background-position":"-17px -1058px"}),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW).css({"background-image":'url("'+c.filePath.getImagePath("shadow-right")+'") ',"background-position":"-593px -383px"}),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW).css({"background-image":'url("'+c.filePath.getImagePath("shadow-middle")+'")',"background-position":"0px -3901px"}),a.dataIsVarNegative===!0?(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_LEFT_PART).addClass("red-tiles-left"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_RIGHT_PART).addClass("red-tiles-right"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART).addClass("red-tiles-middle"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER).addClass("red-tile")):(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_LEFT_PART).addClass("green-tiles-left"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_RIGHT_PART).addClass("green-tiles-right"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART).addClass("green-tiles-middle"),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER).addClass("green-tile")),d.find(".red-tiles-left").css({"background-image":'url("'+c.filePath.getImagePath("red-tile-left-right")+'")',"background-position":"0px -3647px"}),d.find(".red-tiles-right").css({"background-image":'url("'+c.filePath.getImagePath("red-tile-left-right")+'")',"background-position":"-50px -1085px"}),d.find(".red-tiles-middle").css({"background-image":'url("'+c.filePath.getImagePath("red-tile-middle")+'")',"background-position":"0px -3647px"}),d.find(".green-tiles-left").css({"background-image":'url("'+c.filePath.getImagePath("green-tile-left-right")+'")',"background-position":"0 -814px"}),d.find(".green-tiles-right").css({"background-image":'url("'+c.filePath.getImagePath("green-tile-left-right")+'")',"background-position":"0 -814px"}),d.find(".green-tiles-middle").css({"background-image":'url("'+c.filePath.getImagePath("green-tile-middle")+'")',"background-position":"0px -1462px"}),d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_DOTS).css({background:'url("'+c.filePath.getImagePath("buttons-icons")+'")',"background-position":"-258px -399px"}),this._applyBackgroundPosition("active"),"Var"===this.dataType?a.dataIsVarNegative?(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT).addClass("negative-var"),d.find(".negative-var").html(a.text)):(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT).addClass("positive-var"),d.find(".positive-var").html(a.text)):a.dataIsVarNegative?(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT).addClass("positive-num"),d.find(".positive-num").text(a.text)):(d.find("."+b.PAN_BALANCE_DRAGGABLE_TILE_TEXT).addClass("negative-num"),d.find(".negative-num").text(a.text))},attachEvents:function(){var a=$("#"+this.tileData.id),b=MathInteractives.Common.Utilities.Models.Utils;a.off("mouseover.tile").on("mouseover.tile",$.proxy(this._onMouseOver,this)),a.off("mouseout.tile").on("mouseout.tile",$.proxy(this._onMouseOut,this)),b.EnableTouch(a,{specificEvents:b.SpecificEvents.DRAGGABLE})},detachEvents:function(){var a=$("#"+this.tileData.id);a.off("mouseover.tile"),a.off("mouseout.tile"),MathInteractives.Common.Utilities.Models.Utils.DisableTouch(a)},_generateBackgroundPosition:function(){var a={active:{},hover:{},down:{}};a.active[0]=0,a.hover[0]=94,a.down[0]=94,a.active[1]=0,a.hover[1]=47,a.down[1]=47,a.active[2]=47,a.hover[2]=141,a.down[2]=141,this._backgroundPositions=a},_applyBackgroundPosition:function(a){var b=this._backgroundPositions[a],c=$("#"+this.tileData.id);c.find(".red-tiles-left").css("background-position","-50px -"+(b[0]+1085)+"px"),c.find(".red-tiles-middle").css("background-position","0px -"+(b[1]+3647)+"px"),c.find(".red-tiles-right").css("background-position","-50px -"+(b[2]+1085)+"px"),c.find(".green-tiles-left").css("background-position","0px -"+(b[0]+814)+"px"),c.find(".green-tiles-middle").css("background-position","0px -"+(b[1]+1462)+"px"),c.find(".green-tiles-right").css("background-position","0px -"+(b[2]+814)+"px")},_onMouseOver:function(a){var b=$(a.target);b.hasClass("pan-balance-draggable-tile-right-shadow")||b.hasClass("pan-balance-draggable-tile-bottom-shadow")||(this._applyBackgroundPosition("hover"),this.$el.find("div").addClass("hover"))},_onMouseOut:function(){this._applyBackgroundPosition("active"),this.$el.find("div").removeClass("hover")},_onMouseDown:function(){this._applyBackgroundPosition("down")},disableTile:function(){this.hideDraggableTileShadow(),this.hideDraggableTileDots(),this.detachEvents()},enableTile:function(){this.showDraggableTileDots(),this.showDraggableTileShadow(),this.attachEvents()},hideDraggableTileShadow:function(){var a=this.$el;a.find(".shadow").hide()},showDraggableTileShadow:function(){var a=this.$el;a.find(".shadow").show()},hideDraggableTileDots:function(){var a=this.tileData;$("#"+a.id).find(".pan-balance-draggable-tile-dots").hide(),"Var"===this.dataType?this.$el.find(".pan-balance-draggable-tile-text").css({height:"37px","line-height":"35px"}):this.$el.find(".pan-balance-draggable-tile-text").css({height:"37px","line-height":"37px"})},showDraggableTileDots:function(){var a=this.tileData;$("#"+a.id).find(".pan-balance-draggable-tile-dots").show(),this.$el.find(".pan-balance-draggable-tile-text").css({height:"25px","line-height":"25px"})},showBorder:function(a,b){var c=this.tileData,d=c.dataIsVarNegative,e=this.$(".pan-balance-draggable-tile-text-container"),f=null,g=MathInteractives.Common.Utilities.Models.BrowserCheck;return f=d?"red-tile-border":"green-tile-border",g.isFirefox&&(f=d?"red-tile-border-shadow":"green-tile-border-shadow"),e.hasClass(f)?(e.removeClass(f),this.isSelected=!1):(e.addClass(f),this.isSelected=!0),this.isSelected},removeBorder:function(a,b){var c=this.tileData,d=c.dataIsVarNegative,e=this.$(".pan-balance-draggable-tile-text-container"),f=d?"red-tile-border":"green-tile-border",g=MathInteractives.Common.Utilities.Models.BrowserCheck;return g.isFirefox&&(f=d?"red-tile-border-shadow":"green-tile-border-shadow"),e.removeClass(f),this.isSelected=!1,!1},addBorder:function(a){var b=this.tileData,c=b.dataIsVarNegative,d=this.$(".pan-balance-draggable-tile-text-container"),e=c?"red-tile-border":"green-tile-border",f=MathInteractives.Common.Utilities.Models.BrowserCheck;f.isFirefox&&(e=c?"red-tile-border-shadow":"green-tile-border-shadow"),d.addClass(e);var g=this.$el;g.find(".shadow").show(),this.isSelected=!0}},{hideDraggableTileShadow:function(a){a.find(".shadow").hide()},showDraggableTileShadow:function(a){a.find(".shadow").show()},setPulseEffect:function(a,b,c){var d=b,e=c;e?d.css({"box-shadow":"0px 0.732px 5px 1.5px rgba(31, 135, 99,"+a+")","-moz-box-shadow":"0px 0.732px 5px 1.5px rgba(31, 135, 99,"+a+")","-webkit-box-shadow":"0px 0.732px 5px 1.5px rgba(31, 135, 99,"+a+")"}):d.css({"box-shadow":"0px 0.732px 5px 1.5px rgba(152,0, 78,"+a+")","-moz-box-shadow":"0px 0.732px 5px 1.5px rgba(152,0, 78,"+a+")","-webkit-box-shadow":"0px 0.732px 5px 1.5px rgba(152,0, 78,"+a+")"})},showPulse:function(b,c,d){var e=c,d=d,f=b.find(".pan-balance-draggable-tile-text-container");a.hideDraggableTileShadow(b),$({step:.3}).animate({step:1},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){$({step:1}).animate({step:.3},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){$({step:.3}).animate({step:1},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){$({step:1}).animate({step:.3},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){$({step:.3}).animate({step:1},{step:function(b){a.setPulseEffect(b,f,e)},complete:function(){d&&d()},duration:500})},duration:500})},duration:500})},duration:500})},duration:500})},hidePulse:function(a){var b=a.find(".pan-balance-draggable-tile-text-container");b.css({"box-shadow":"none","-moz-box-shadow":"none","-webkit-box-shadow":"none"})},showHighlightedPulse:function(a,b){var c=a.find(".pan-balance-draggable-tile-text-container"),d=b;d?c.css({"box-shadow":"0px 0.732px 5px 1.5px rgb(31, 135, 99)","-moz-box-shadow":"0px 0.732px 5px 1.5px rgb(31, 135, 99)","-webkit-box-shadow":"0px 0.732px 5px 1.5px rgb(31, 135, 99)"}):c.css({"box-shadow":"0px 0.732px 5px 1.5px rgb(152,0, 78)","-moz-box-shadow":"0px 0.732px 5px 1.5px rgb(152,0, 78)","-webkit-box-shadow":"0px 0.732px 5px 1.5px rgb(152,0, 78)"})}}),a=MathInteractives.Common.Components.Views.PanBalanceDraggableTile}(),function(){"use strict";MathInteractives.Common.Components.Models.PanBalanceStructured=Backbone.Model.extend({defaults:function(){return{equationData:{a:4,b:11,c:-1},isDraggable:!1,enableDispenser:!1,isFilled:!0,dispenserData:[{type:"Var",text:"x",value:1,isVarNegative:!0},{type:"Num",text:"1",value:1,isVarNegative:!0},{type:"Var",text:"x",value:0},{type:"Num",text:"1",value:1}],leftPanWeight:0,rightPanWeight:0,currentPansData:null,showX:!1,xValue:0,prependID:"",forceAnimate:!1,isAnimation:!1,stepRotateObject:{rotate:0},draggableVariableValue:1,tabIndex:null,panTilesTabIndexes:new Object,equationToModel:null,negativeTiles:!0}},xValue:null,initialize:function(){var a=this.getEquationData(),b={left:{a:a.a,b:a.b,c:0},right:{a:0,b:0,c:a.c}};null===this.getCurrentPansData()&&this.setCurrentPansData(b),this.on("change:xValue",$.proxy(this._xValueChange,this));
},getEquationData:function(){return this.get("equationData")},setEquationData:function(a){this.set("equationData",a)},getXValue:function(){return this.get("showX")?this.get("xValue"):"<i>x</i>"},getShowX:function(){return this.get("showX")},setShowX:function(a){this.set("showX",a),this.trigger("pan-showX-change")},setXValue:function(a){this.set("xValue",a)},getLeftPanWeight:function(){return this.get("leftPanWeight")},setLeftPanWeight:function(a){var b=a.a*this.get("xValue")+a.b;this.set("leftPanWeight",b)},getRightPanWeight:function(){return this.get("rightPanWeight")},setRightPanWeight:function(a){var b=a.a*this.get("xValue")+a.b+a.c;this.set("rightPanWeight",b)},getCurrentPansData:function(){return this.get("currentPansData")},setCurrentPansData:function(a){this.set("currentPansData",a),this.setLeftPanWeight(a.left),this.setRightPanWeight(a.right),this.trigger("pan-data-change")},getHeavierPan:function(a){var b=a?a:this.get("showX"),c="RIGHT";return this.getLeftPanWeight()>this.getRightPanWeight()?c="LEFT":this.getLeftPanWeight()===this.getRightPanWeight()&&(c="CENTRE"),this.getIsForceAnimation()||b||(c="CENTRE"),c},_xValueChange:function(){this.setCurrentPansData(this.getCurrentPansData())},setForceAnimate:function(a){return"undefined"==typeof a?void this.set("forceAnimate",!1):void this.set("forceAnimate",a)},getIsForceAnimation:function(){return this.get("forceAnimate")},setPanTilesTabIndexes:function(a){var b=$.extend(!0,{},a);this.set("panTilesTabIndexes",b)},getPanTilesTabIndexes:function(){return this.get("panTilesTabIndexes")}})}(),function(){"use strict";var a=null;MathInteractives.Common.Components.Views.PanBalanceStructured=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,isDraggable:!1,isFilled:!0,currentAngle:0,xAddedTill_R:{row:3,col:0},startOthertilesFrom_R:{row:0,col:0},xAddedTill_L:{row:3,col:0},startOthertilesFrom_L:{row:0,col:0},enableDispenser:!1,isAnimation:!1,droppedTileId:0,staticTileId:0,stepRotateObject:{rotate:0},trashCanID:null,containmentID:null,isPanDisabled:!1,prependID:null,forceAnimate:null,isFading:!1,draggableVariableValue:1,dispenserTiles:[],marqueeView:null,marqueeDragStartPoint:null,tabIndex:null,tileContainer:[],panTabIndexes:null,panPosition:null,currentDroppedTileSelected:null,currentSelectedDispenserTile:null,tilesToNullify:0,marqueeMoveOut:!1,initialize:function(){var a=this.model;this.prependID=a.get("prependID"),this.idPrefix=a.get("idPrefix"),this.idPrefix=this.idPrefix+this.prependID,this.manager=a.get("manager"),this.filePath=a.get("path"),this.player=a.get("player"),this.isDraggable=a.get("isDraggable"),this.dispenserData=a.get("dispenserData"),this.isFilled=a.get("isFilled"),this.enableDispenser=a.get("enableDispenser"),this.defaultData=a.get("defaultData"),this.trashCanID=a.get("trashCanID"),this.containmentID=a.get("containmentID"),this.marqueeContainer=a.get("marqueeContainer")?a.get("marqueeContainer"):this.$el,this.forceAnimate=a.get("forceAnimate"),this._setDraggableVariableValue(a.get("draggableVariableValue")),this.tabIndex=a.get("tabIndex"),this.panTabIndexes={leftPanVariable:{row3:this.tabIndex+25,row2:this.tabIndex+30,row1:this.tabIndex+35,row0:this.tabIndex+40},leftPanNumber:{row3:this.tabIndex+45,row2:this.tabIndex+65,row1:this.tabIndex+85,row0:this.tabIndex+115},rightPanVariable:{row3:this.tabIndex+137,row2:this.tabIndex+140,row1:this.tabIndex+145,row0:this.tabIndex+150},rightPanNumber:{row3:this.tabIndex+155,row2:this.tabIndex+175,row1:this.tabIndex+195,row0:this.tabIndex+215},leftTemporaryBin:{row2:this.tabIndex+255,row1:this.tabIndex+295,row0:this.tabIndex+335},rightTemporaryBin:{row2:this.tabIndex+375,row1:this.tabIndex+415,row0:this.tabIndex+455}},a.setPanTilesTabIndexes(this.panTabIndexes),this.render(),this.marqueeView=this._generateMarquee(),this.$(".pan-balance-draggable-tile-text-container").on("focusout",$.proxy(this.setDefaultTileAccText,this))},render:function(){var a={idPrefix:this.idPrefix},b=MathInteractives.Common.Components.templates.panBalanceStructured(a).trim();this.$el.append(b),this._setBackgroundImage(".left-pan,.right-pan,.small-rod,.base,.center-rod"),this._attachEvents(),this._createHackScreenForDispenser(),this.renderDispenser(),this.model.get("isDraggable")&&(this._initializeDroppableContainers(),this.defaultData&&this._renderDefaultTiles(this.defaultData),this._renderTemporaryTrashCan()),this._activateTrashCan(this.trashCanID)},setDefaultTileAccText:function(a){var b=this,c=null,d=b.dispenserTiles,e=!1,f=d.length,g=null,h=null,i=null;for(c=0;f>c;c++)g=d[c].$el.find(".pan-balance-draggable-tile-text-container").attr("id"),g=g.slice(b.idPrefix.length),e=d[c].isSelected,h=d[c].tileData.dataIsVarNegative?b.getAccMessage("negative",0)+" ":"",i=h+("Var"===d[c].dataType?"x":1),i+=" "+this.getAccMessage("tile",0),e&&(i+=" "+this.getAccMessage("tile",1)),this.setAccMessage(g,i)},_resetData:function(a,b){this.xAddedTill_R={row:3,col:0},this.startOthertilesFrom_R={row:b.rowCount-1,col:0},this.xAddedTill_L={row:3,col:0},this.startOthertilesFrom_L={row:a.rowCount-1,col:0}},_attachEvents:function(){this.model.on("pan-data-change",$.proxy(this.eventHandlers._panDataChangeEvent,this)),this.model.on("pan-showX-change",$.proxy(this.eventHandlers._panShowXChangeEvent,this)),this.model.on("pan-forceAnimate-change",$.proxy(this.eventHandlers._panForceAnimateChangeEvent,this))},_setBackgroundImage:function(a){if(a){var b=this.filePath.getImagePath("pan-balance");this.$(a).css({"background-image":"url("+b+")"})}},animatePanBalance:function(a){if(!this._skipAnimation){this.marqueeView&&this.marqueeView.disableMarquee();var b=0;switch(a){case"LEFT":b=-5;break;case"RIGHT":b=5}var c=1e3,d=this,e=parseInt(this.$(".center-rod").css("width").split("px")[0]),f=e/2,g=d.$(".center-rod"),h=d.$(".left-pan-wrapper"),i=d.$(".right-pan-wrapper"),j=null,k=null,l=[],m=!1;this.model.set("stepRotateObject",$.extend({},{rotate:this.currentAngle})),d.currentAngle===b?(this.isAnimationOn()===!0?m=!0:d.model.set("isAnimation",!1),d._getIsDisabled()||d.marqueeView&&d.marqueeView.enableMarquee()):m=!0,m&&(this.model.set("isAnimation",!0),$(this.model.get("stepRotateObject")).stop().animate({rotate:b},{step:function(a){j=Math.sin(Math.PI/180*a)*f,h.css("top",-j+"px"),i.css("top",j+"px"),g.css({"-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)",transform:"rotate("+a+"deg)"}),k=$("<span></span>"),$("body").append(k),l.push(k.get(0)),d.currentAngle=a},complete:function(){d.model.set("isAnimation",!1),$(l).remove(),d._getIsDisabled()||d.marqueeView&&d.marqueeView.enableMarquee()},duration:c}))}},renderPan:function(){if(!this.enableDispenser){var a,b,c,d,e=this,f=this.model.getCurrentPansData(),g=f.left,h=f.right,i=this.$(".left-tile-container .static-container"),j=this.$(".right-tile-container .static-container"),k=4;!this.isDraggable&&this.isFilled&&(c=this._calculateRowsCols(Math.abs(g.a),Math.abs(g.b)+Math.abs(g.c)),d=this._calculateRowsCols(Math.abs(h.a),Math.abs(h.b)+Math.abs(h.c)),this._resetData(c,d),a=this._createTilesContainer(c),g.a=g.a>k?k:g.a,i.show().empty().append(a),e.addElementsToPan(a,g.a,c,!0,"LEFT"),e.addElementsToPan(a,g.b,c,!1,"LEFT"),e.addElementsToPan(a,g.c,c,!1,"LEFT"),b=this._createTilesContainer(d),h.a=h.a>k?k:h.a,j.show().empty().append(b),e.addElementsToPan(b,h.a,d,!0,"RIGHT"),e.addElementsToPan(b,h.b,d,!1,"RIGHT"),e.addElementsToPan(b,h.c,d,!1,"RIGHT"),e._adjustTablePosition(),e._displayEquation())}},_createTilesContainer:function(a,b){var c,d,e,f,g=a,h=g.rowCount,i=g.colCount,j=b?b:$("<div>",{"class":"pan-table"});for(e=0;h>e;e++)for(c=$("<div>",{"class":"pan-row row-"+e}),j.append(c),f=0;i>f;f++)d=$("<div>",{"class":"pan-cell cell-"+f}),c.append(d);return j},_createStaticTileSlices:function(a){if(a){var b,c,d=3,e=a;for(c=0;d>c;c++)b=$("<div>",{"class":"static-tile static-cell-"+c}),e.append(b);return e}},_calculateRowsCols:function(a,b){var c,d,e,f=4;return e=a>b?a:b,c=e>3?f:e,d=Math.ceil(a/c)+Math.ceil(b/c),d>5&&(d=5),{colCount:d,rowCount:c}},addElementsToPan:function(a,b,c,d,e){var f,g,h=b,i=this,j="coefficients",k=0,l=1,m=c.rowCount;c.colCount,MathInteractives.Common.Components.Views.Button.TYPE.CUSTOM;if(d&&(j="coefficients-x",l=this.model.getXValue()),0>b&&(l=0===l?0:"string"==typeof l?"-"+l:-1*l,b=Math.abs(b)),d&&0!==b){for(var n=0,o=m-1;b>k;k++){0>o&&(n++,o=m-1);var p=({id:"static-"+i._getStaticTileId(),imagePathIds:["pan-balance-green-right","pan-balance-green-mid","pan-balance-green-left"]},$("<div>",{"class":j+" xCoefficient"})),q=0>h?"-":"+";a.find(".row-"+o+" .cell-"+n).append(p),i._createStaticTileButton(l,p,q),o--}"LEFT"===e?(this.xAddedTill_L={row:o+1,col:n},this.startOthertilesFrom_L={row:m-1,col:n+1}):(this.xAddedTill_R={row:o+1,col:n},this.startOthertilesFrom_R={row:m-1,col:n+1})}else{"LEFT"===e?(f=this.xAddedTill_L.row-1,g=this.xAddedTill_L.col):(f=this.xAddedTill_R.row-1,g=this.xAddedTill_R.col);for(var n="LEFT"===e?this.startOthertilesFrom_L.col:this.startOthertilesFrom_R.col,o="LEFT"===e?this.startOthertilesFrom_L.row:this.startOthertilesFrom_R.row;b>k;k++){0>o&&(n++,o=m-1);var p=$("<div>",{"class":j});if(4>=n){var q=0>l?"-":"+";a.find(".row-"+o+" .cell-"+n).append(p),i._createStaticTileButton(l,p,q)}o--}"LEFT"===e?this.startOthertilesFrom_L={row:o,col:n}:this.startOthertilesFrom_R={row:o,col:n}}},_adjustTablePosition:function(){var a=this.$(".left-tile-container .static-container"),b=this.$(".right-tile-container .static-container"),c=b.find(".pan-table"),d=a.find(".pan-table");c.css({top:b.height()-c.height()}),d.css({top:a.height()-d.height()})},_displayEquation:function(){var a=this.model.getCurrentPansData(),b=a.left,c=a.right,d=this.$(".left-pan .pan-data"),e=this.$(".right-pan .pan-data"),f="",g="",h=4;b.a=b.a>h?h:b.a,c.a=c.a>h?h:c.a,f=0===b.a?"":b.a+"<i>x</i>",1===Math.abs(b.a)&&(f="<i>x</i>",b.a<0&&(f="-<i>x</i>")),f+=0===b.b?"":b.b>0?" + "+b.b:" - "+Math.abs(b.b),f+=0===b.c?"":b.c>0?" + "+b.c:" - "+Math.abs(b.c),g=0===c.a?"":c.a+"<i>x</i>",1===Math.abs(c.a)&&(g="<i>x</i>",c.a<0&&(g="-<i>x</i>")),g+=0===c.b?"":c.b>0?" + "+c.b:" - "+Math.abs(c.b),g+=0===c.c?"":c.c>0?" + "+c.c:" - "+Math.abs(c.c),0===c.a&&0===c.b&&(g=Number(g.replace(/\s/g,""))),0===b.a&&0===b.b&&(f=Number(f.replace(/\s/g,""))),d.html(f),e.html(g)},setPansData:function(a){var b={left:{},right:{}};b.left.a=a.left.a||0,b.left.b=a.left.b||0,b.left.c=a.left.c||0,b.right.a=a.right.a||0,b.right.b=a.right.b||0,b.right.c=a.right.c||0,this.model.setCurrentPansData(b)},setXValue:function(a){this.model.setXValue(a)},showX:function(a){this.model.setShowX(a)},isAnimationOn:function(){return this.model.get("isAnimation")},forceAnimatePanBalance:function(){this.model.setForceAnimate(!0)},eventHandlers:{_panDataChangeEvent:function(){this.renderPan(),this.model.getIsForceAnimation()||this.model.getShowX()||(this.currentAngle=0),this.animatePanBalance(this.model.getHeavierPan())},_panShowXChangeEvent:function(){var a=this.model.getXValue(),b=this.model.getCurrentPansData();(b.left.a<0||b.right.a<0)&&0>a&&(a="(-"+Math.abs(a)+")"),a=b.left.a>0?a:"string"==typeof a?"-"+a:-1*a,this.$(".left-tile-container .xCoefficient .static-cell-1").html(a),a=b.right.a>0?a:"string"==typeof a?"-"+a:-1*a,this.$(".right-tile-container .xCoefficient .static-cell-1").html(a),this.animatePanBalance(this.model.getHeavierPan())}},_createStaticTileButton:function(a,b,c){if("undefined"!=typeof a&&b){var d=this,e="-"===c?"red":"green",f=d._createStaticTileSlices(b);return f.find(".static-cell-0").css({"background-image":'url("'+d.filePath.getImagePath("pan-balance-"+e+"-left-right")+'")'}),f.find(".static-cell-1").css({"background-image":'url("'+d.filePath.getImagePath("pan-balance-"+e+"-mid")+'")'}).html(a),void f.find(".static-cell-2").css({"background-image":'url("'+d.filePath.getImagePath("pan-balance-"+e+"-left-right")+'")'})}},_createHackScreenForDispenser:function(){var a,b=this,c=this.model.get("negativeTiles")===!1?1:0;this.loadScreen("pan-balance"),a={elementId:"-dispenser-container",tabIndex:b.tabIndex,acc:b.getAccMessage("dispenser",c)},this.createAccDiv(a)},renderDispenser:function(a){if(this.enableDispenser){this.dispenserTiles=[];var b,c=this,d=MathInteractives.Common.Components.Views.PanBalanceStructured,e=a?a:this.dispenserData,f=e.length,g=this.model.get("negativeTiles")===!1?2:0,h=(this.$(".dispenser-container").show(),this.$(".dispenser-row-1")),i=this.$(".dispenser-row-2"),j={revert:"invalid",zIndex:999,helper:"clone",start:function(a,b){var e=MathInteractives.Common.Utilities.Models.BrowserCheck;e.isFirefox?(b.helper.children().find(".green-tile-border-shadow").removeClass("green-tile-border-shadow"),b.helper.children().find(".red-tile-border-shadow").removeClass("red-tile-border-shadow")):(b.helper.children().find(".green-tile-border").removeClass("green-tile-border"),b.helper.children().find(".red-tile-border").removeClass("red-tile-border")),c._removeMarqueeOnTileDrag(),c.trigger(d.TILE_DRAG),$(this).draggable("option","revert","invalid"),b.helper.find(".green-tile-border").removeClass("green-tile-border"),b.helper.find(".red-tile-border").removeClass("red-tile-border")},cancel:".var-tile-right-shadow,.num-tile-right-shadow,.var-tile-bottom-shadow,.num-tile-bottom-shadow",containment:c._getContainmentSelector(),appendTo:c._getContainmentSelector()},k=null;for(this.$(".dynamic-container");f>g;g++)b=e[g].isVarNegative?h:i,this.model.get("negativeTiles")===!1&&this.$(h).remove(),k=this._createDraggableTiles(b,e[g],this.idPrefix+"dispenser-tile-",g,!0,!0),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$("."+d.TILE_CLASS),{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE|MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.STOP_PROPAGATION}),k.draggable(j),k.off("touchmove.forStopPropogation").on("touchmove.forStopPropogation",function(a){a.stopPropagation()}),c._makeContextMenuForDraggable(k,"dispenser",!1)}},_makeContextMenuForDraggable:function(a,b,c){var d,e=this,f={el:e.player.$el,prefix:e.idPrefix,contextMenuCount:5,manager:e.manager,thisView:e,nestedMenuData:{},elements:[a],screenId:"pan-balance-context-menu"},g="dispenser"===b;d=MathInteractives.global.ContextMenu.initContextMenu(f);var h=e._getIgnoreOptionsForTile(a,b,c);d.editContextMenu(h,!0),a.data({contextMenu:d}),a.on(MathInteractives.global.ContextMenu.CONTEXTMENU_SELECT,$.proxy(this._onContextMenuSelect,this,a,g)),a.on(MathInteractives.global.ContextMenu.CONTEXTMENU_HIDE,$.proxy(this._onContextMenuHide,this,a)),a.off("keyup.deleteFromPan").on("keyup.deleteFromPan",function(b){b=b?b:window.event;var c=b.keyCode?b.keyCode:b.which;68===c&&e._throwAwayTile(a)})},_onContextMenuHide:function(a,b,c){var d=a[0].id.slice(this.idPrefix.length)+"-draggable-tile-text-container";this.setFocus(d)},_onContextMenuSelect:function(a,b,c,d){var e,f=d.currentTarget.id,g=f.charAt(f.length-1),h=b===!0,i=!1;switch(g){case"0":e=this.$("#"+this.idPrefix+"-left-dynamic-wrapper");break;case"1":e=this.$("#"+this.idPrefix+"-right-dynamic-wrapper");break;case"2":e=null;break;case"3":e=this.$("#"+this.idPrefix+"-left-temporary-bin"),i=!0;break;case"4":e=this.$("#"+this.idPrefix+"-right-temporary-bin"),i=!0}e?(this._addTileInContainer(a,e,h,i),"3"===g?this.setFocus("-left-temporary-bin"):"4"===g&&this.setFocus("-right-temporary-bin")):this._throwAwayTile(a)},_createDraggableTiles:function(b,c,d,e,f,g){var h=f?f:!1,i=c.isDisabled?c.isDisabled:this._getIsDisabled(),j=c.isVarNegative?c.isVarNegative:!1,k=c.text,l=c.type,m="Var"===c.type?this.draggableVariableValue:c.value,n=MathInteractives.Common.Components.Views.Button.TYPE.CUSTOM,o=j?["pan-balance-red-draggable-left-right","pan-balance-red-draggable-mid"]:["pan-balance-green-draggable-left-right","pan-balance-green-draggable-mid"],p=41,q=82,r=this.filePath,s=d,t=null,u=null,r=this.filePath,v=null,w=this;"undefined"!=typeof e&&(s+=e),t=d+" "+a.TILE_CLASS+" draggable-tile"+l,t=g?t+" dispenser-tile":t,u=$("<div>",{id:s,"class":t}),"Num"===l&&(q=41),h&&-1===k.indexOf(a.NEGATIVE_TILE_INDICATOR)&&("Var"===l&&(j&&(k=a.NEGATIVE_TILE_INDICATOR+k),k="<i>"+k+"</i>"),"Num"===l&&j&&(k=a.NEGATIVE_TILE_INDICATOR+k)),v={id:s,type:n,path:r,text:k,width:q,imagePathIds:o,height:p,isDraggable:!0,isDisabled:i,dataIsVarNegative:j},b.append(u);var x=new MathInteractives.Common.Components.Views.PanBalanceDraggableTile({el:u,buttonData:v,filePath:r,viewClassName:a,dataType:l,dataText:k,dataValue:m});return g&&(this._createHackScreenForDispenserTiles({$draggableTile:u,dataText:c.text,tileNegative:v.dataIsVarNegative}),this.dispenserTiles.push(x),u.on("click",function(){if(!w._getIsDisabled()){var b,c=null,d=w.dispenserTiles,e=d.length,f=w.$(this).find(".pan-balance-draggable-tile-text-container").attr("id"),g=$(this).data("isVarNegative")?w.getAccMessage("negative",0)+" ":"",h=g+("Var"===$(this).data("type")?"x":1);for(f=f.slice(w.idPrefix.length),w.$("#"+w.idPrefix+f+"-acc-elem").blur(),c=0;e>c;c++)d[c]!==x&&(d[c].removeBorder(),w._changeDispenserTileAccMsg(d[c].$el,!1));b=x.showBorder(),w._changeDispenserTileAccMsg(x.$el,b),w._removeMarqueeOnTileDrag(),w.setFocus(f),w._setPanAccText(h),w._setTempBinAccText(),w.trigger(a.DISPENSER_TILE_CLICKED,{newTile:x}),w.currentSelectedDispenserTile=x}})),this._handleMarqueeShowHide(x.$el),u.data({value:m,type:l,text:k,isVarNegative:j,isDisabled:i})},_changeDispenserTileAccMsg:function(a,b){var c=a.find(".pan-balance-draggable-tile-text-container").attr("id"),d=a.data("isVarNegative")?this.getAccMessage("negative",0)+" ":"";c=c.slice(this.idPrefix.length),d+="Var"===a.data("type")?"x":1,d+=" "+this.getAccMessage("tile",0),d+=b?" "+this.getAccMessage("tile",1):" "+this.getAccMessage("tile",2),this.setAccMessage(c,d)},changeDispenserTileAccMsg:function(a,b){this._changeDispenserTileAccMsg(a,b)},_setPanAccText:function(a,b){var c,d,e,f,g,h,i=this,j=null,k=null,l=i._getCurrentSelectedDispenserTile(),m=i.getTileCountInPan("left"),n=i.getTileCountInPan("right");null===l?(i._enableDisableDroppedTile(!0),0===m&&!b||0===m&&b?j=i.getAccMessage("left-dynamic-pan",0):(j=i.getAccMessage("left-dynamic-pan",2),e=i._getAccTextForEquation("left"),b||(j=i.getAccMessage("pan-state","current-equation",[e])+" "+j)),0===n&&!b||0===n&&b?k=i.getAccMessage("right-dynamic-pan",0):(k=i.getAccMessage("right-dynamic-pan",2),f=i._getAccTextForEquation("right"),b||(k=i.getAccMessage("pan-state","current-equation",[f])+" "+k))):(i._enableDisableDroppedTile(!1),a||(d=l.data("isVarNegative")?i.getAccMessage("negative",0)+" ":"",a=d+("Var"===l.data("type")?"x":"1")),0===m&&!b||1===m&&b?j=i.getAccMessage("left-dynamic-pan",1,[a]):(c=i._getAccTextForEquation("left"),j=i.getAccMessage("left-dynamic-pan",3,[c,a])),0===n&&!b||1===n&&b?k=i.getAccMessage("right-dynamic-pan",1,[a]):(c=i._getAccTextForEquation("right"),k=i.getAccMessage("right-dynamic-pan",3,[c,a]))),b&&(g=void 0===e?i.getAccMessage("tile-delete-text",1,[b]):i.getAccMessage("tile-delete-text",0,[b,e]),j=g+j,h=void 0===f?i.getAccMessage("tile-delete-text",1,[b]):i.getAccMessage("tile-delete-text",0,[b,f]),k=h+k),i.setAccMessage("-left-dynamic-wrapper",j),i.setAccMessage("-right-dynamic-wrapper",k)},_getAccTextForEquation:function(a){var b,c,d,e,f=this.getEquationCoefficients(a);return 0===f.constant?b=1===f.variable?"x":-1===f.variable?this.getMessage("pan-equation-text","minus")+" x":this.getMessage("pan-equation-text",0,[f.variable]):0===f.variable?b=f.constant:(c=1===f.variable?"":-1===f.variable?this.getMessage("pan-equation-text","minus"):f.variable,f.constant<0?(e=this.getMessage("pan-equation-text","minus"),d=Math.abs(f.constant)):(e=this.getMessage("pan-equation-text","plus"),d=f.constant),b=this.getMessage("pan-equation-text",1,[c,e,d])),b},_enableDisableDroppedTile:function(a){var b=this;b.$(".pan-dropped").each(function(){var c=$(this).find(".pan-balance-draggable-tile-text-container").attr("id").slice(b.idPrefix.length);c&&(b.enableTab(c,a),a===!0&&(b._reassignTabIndexesToPanTiles(0,"left"),b._reassignTabIndexesToPanTiles(0,"right")))})},_createHackScreenForDispenserTiles:function(a){var b=a.$draggableTile.find(".pan-balance-draggable-tile-text-container").attr("id"),c=a.tileNegative?this.getAccMessage("negative",0)+" ":"";b=b.slice(this.idPrefix.length),c+="1"===a.dataText?"1":a.dataText,this.tabIndex+=2;var d={elementId:b,tabIndex:this.tabIndex,acc:c+" "+this.getAccMessage("tile",0)};this.createAccDiv(d)},_createHackScreenForPanTiles:function(a){var b,c=a.newTile.find(".pan-balance-draggable-tile-text-container").attr("id"),d=a.panPosition,e=a.newTile.data().type,f="Var"===e?"x":"1",g=a.newTile.attr("rowNo"),h=a.newTile.attr("colNo");a.newTile.data().isVarNegative&&(f=this.getAccMessage("negative",0)+" "+f),c=c.slice(this.idPrefix.length),b="left"===d?"Var"===e?this._getTabIndexForVar(g,"leftPanVariable"):this._getTabIndexForNum(g,h,"leftPanNumber",d):"Var"===e?this._getTabIndexForVar(g,"rightPanVariable"):this._getTabIndexForNum(g,h,"rightPanNumber",d);var i={elementId:c,tabIndex:b,acc:f+" "+this.getAccMessage("tile",0)};this.createAccDiv(i),null!==this._getCurrentSelectedDispenserTile()&&this.enableTab(c,!1)},_getTabIndexForVar:function(a,b){var c;switch(parseInt(a)){case 3:c=this.panTabIndexes[b].row3;break;case 2:c=this.panTabIndexes[b].row2;break;case 1:c=this.panTabIndexes[b].row1;break;case 0:c=this.panTabIndexes[b].row0}return c},_getTabIndexForNum:function(a,b,c,d){var e,f,g,h=0,i=this,j=i._getCurrentSelectedDispenserTile();if(null===j){i._reassignTabIndexesToPanTiles(parseInt(a)+1,d),h=0,f=this.$("."+d+"-tile-container").find(".Num-table").find(".row-"+a).children().length;for(var k=0;f-1>k;k++){var l=$(this.$("."+d+"-tile-container").find(".Num-table").find(".row-"+a).children()[k]);g=l.find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),this.setTabIndex(g,this.panTabIndexes[c]["row"+a]+h),h+=5}}switch(parseInt(a)){case 3:e=this._getTabIndexForNumAccordingToRowLen("row3",f,c);break;case 2:e=this._getTabIndexForNumAccordingToRowLen("row2",f,c);break;case 1:e=this._getTabIndexForNumAccordingToRowLen("row1",f,c);break;case 0:e=this._getTabIndexForNumAccordingToRowLen("row0",f,c)}return e},_getTabIndexForNumAccordingToRowLen:function(a,b,c){var d;switch(parseInt(b)){case 1:d=this.panTabIndexes[c][a];break;case 2:d=this.panTabIndexes[c][a]+5;break;case 3:d=this.panTabIndexes[c][a]+10;break;case 4:d=this.panTabIndexes[c][a]+15}return d},_reassignTabIndexesToPanTiles:function(a,b){for(var c,d,e,f=this,g=a;3>=g;g++){c=0,d=this.$("."+b+"-tile-container").find(".Num-table").find(".row-"+g).children().length;for(var h=0;d>h;h++){var i=$(this.$("."+b+"-tile-container").find(".Num-table").find(".row-"+g).children()[h]);e=i.find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),f.setTabIndex(e,f.panTabIndexes[b+"PanNumber"]["row"+g]+c),c+=5}}},_createHackScreenForTemporaryBinTiles:function(a){if(!this.isMarqueeDrop){var b,c,d,e=a.attr("panContainer"),f=a.attr("rowNo"),g="Var"===a.data().type?"x":"1",h=a.parent().children().length;a.data().isVarNegative&&(g=this.getAccMessage("negative",0)+" "+g),b="left"===e?"leftTemporaryBin":"rightTemporaryBin";for(var i=0;h>i;i++){c=$(a.parent().children()[i]).find(".pan-balance-draggable-tile-text-container").attr("id"),c=c.slice(this.idPrefix.length),d=this.panTabIndexes[b]["row"+f]+5*i;var j={elementId:c,tabIndex:d,acc:this.getAccMessage("temporaryTrashCanTile",0)+" "+g};this.createAccDiv(j)}}},_initializeDroppableContainers:function(){var b=this,c=this.$(".dynamic-container"),d=null,e=null,f=a.MAX_ROWS;a.MAX_COLS;d=this._createTilesContainer({rowCount:f,colCount:0}).addClass("Num-table"),e=this._createTilesContainer({rowCount:f,colCount:0}).addClass("Var-table"),c.find(".dynamic-wrapper").append(e).append(d),b._attachHandlerForClickAndClick(),c.show().droppable({drop:function(a,c){b._panDropHandler(a,c,$(this).find(".dynamic-wrapper"))}});var g=this.$(".left-tile-container"),h=this.$(".right-tile-container");this._createHackScreenForLeftDynamicPan(g),this._createHackScreenForRightDynamicPan(h),this._createHackScreenForAccessibilityPans(g),this._createHackScreenForAccessibilityPans(h),b._attachHandlersForAccessibilityHelperPans()},_attachHandlersForAccessibilityHelperPans:function(){var a=this,b=null,c="-left-accessibility-dynamic-wrapper",d="-right-accessibility-dynamic-wrapper",e="-left-accessibility-temporary-bin",f="-right-accessibility-temporary-bin",g=this.$("#"+this.idPrefix+c),h=this.$("#"+this.idPrefix+d),i=this.$("#"+this.idPrefix+e),j=this.$("#"+this.idPrefix+f),k="-left-dynamic-wrapper",l="-right-dynamic-wrapper",m="-left-temporary-bin",n="-right-temporary-bin",o=this.$("#"+this.idPrefix+k),p=this.$("#"+this.idPrefix+l),q=this.$("#"+this.idPrefix+m),r=this.$("#"+this.idPrefix+n);g.off("click").on("click",function(c){b=a.currentDroppedTileSelected,a._addTileInContainer(b,o,!1,!1),a._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin")}),h.off("click").on("click",function(c){b=a.currentDroppedTileSelected,a._addTileInContainer(b,p,!1,!1),a._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin")}),i.off("click").on("click",function(c){b=a.currentDroppedTileSelected,a._addTileInContainer(b,q,!1,!0),a.setFocus("-left-temporary-bin"),a._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin")}),j.off("click").on("click",function(c){b=a.currentDroppedTileSelected,a._addTileInContainer(b,r,!1,!0),a.setFocus("-right-temporary-bin"),a._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin")}),a.$("#"+a.idPrefix+k+"-acc-elem").off("keydown.pan-balance").on("keydown.pan-balance",$.proxy(a._setPanAccTextOnTab,a)),a.$("#"+a.idPrefix+l+"-acc-elem").off("keydown.pan-balance").on("keydown.pan-balance",$.proxy(a._setPanAccTextOnTab,a)),a.focusOut(k,function(){a._setPanAccText()}),a.focusOut(l,function(){a._setPanAccText()})},_setPanAccTextOnTab:function(a){a=a?a:window.event;var b=a.keyCode?a.keyCode:a.which;9===b&&this._setPanAccText()},_attachHandlerForClickAndClick:function(){var a=this,b=this.$(".dynamic-container");b.off("click").on("click",function(b){var c=a._getCurrentSelectedDispenserTile();c&&!a.isFading&&a._addTileInContainer(c,$(this).find(".dynamic-wrapper"),!0,!1)})},_detachHandlerForClickAndClick:function(){var a=this.$(".dynamic-container");a.off("click")},_addTileInContainer:function(a,b,c,d,e){var f=this,g={draggable:a,helper:a},h=d?f._onTemporaryBinDrop:f._panDropHandler;h.call(f,null,g,b,c,e)},_panDropHandler:function(b,c,d,e,f){if(c.draggable.hasClass("marquee-div"))return void this._marqueeDrop(b,c,d);var g,h=this,i="temporary-dropped",j=c.helper,k=c.draggable,l=d,m=l.data().pos,n=k.data(),o={value:n.value,type:n.type,text:n.text,isVarNegative:n.isVarNegative},p=c.helper.clone(),q=p.attr("panContainer"),r=Number(p.attr("rowNo")),s=q+"-pan-wrapper",t="ui-draggable-dragging",u=h.$("."+q+"-temporary-bin"),v=null,w=!0;h.panPosition=m,p.removeClass(t).data(o);var x=d.attr("id").slice(h.idPrefix.length),y=!1;if(k.hasClass(i))k.attr("pancontainer")===m?(v=h._handleTilesPositionInContainer(l,p),v?(h._createHackScreenForPanTiles({newTile:v,panPosition:v.attr("panContainer")}),h._makeTileDraggableAfterDrop(v),h._makeContextMenuForDraggable(v,v.attr("panContainer"),!0),h.animateDynamicPan(),k.remove(),y=h._nullifyTileAfterDrop(l,v),setTimeout(function(){h._arrangeTilesInTemporaryTrashCans(u,3)},1)):k.draggable("option","revert",!0)):k.draggable("option","revert",!0);else{if(v=h._handleTilesPositionInContainer(l,p),v&&!l.parents(".pan-wrapper").hasClass(s)){h._createHackScreenForPanTiles({newTile:v,panPosition:v.attr("panContainer")}),g="left"===m?this.$(".left-temporary-bin"):this.$(".right-temporary-bin");h.isTemporaryBinFull(g,v);if(q){var z=h.$("."+s).find(".dynamic-wrapper");z.find("#"+k[0].id).remove(),h._arrangeTilesInPan(z,r,!1,z.find("."+n.type+"-table"))}h._makeTileDraggableAfterDrop(v);var A="block"===this.$("#"+this.idPrefix+"-left-temporary-bin").css("display");h._makeContextMenuForDraggable(v,v.attr("panContainer"),A)}else{h.$("#"+h.idPrefix+x+"-acc-elem").blur();var B,C,D,E,F=n.isVarNegative?h.getAccMessage("negative",0)+" ":"",G=this.getEquationCoefficients(m),H=G.constant,I=G.variable;F+="Num"==n.type?"1":"x",D=h._getAccTextForEquation(m),E=h.getAccMessage("pan-state","current-equation",[D]),"right"===m?(B=h.getAccMessage("right",0),I>=a.MAX_VARIABLE&&H>=a.MAX_CONSTANT?C=h.getAccMessage("pan-state","full",[B,D]):I>=a.MAX_VARIABLE?C=h.getAccMessage("pan-state","variable-full")+" "+E:H>=a.MAX_CONSTANT&&(C=h.getAccMessage("pan-state","constant-full")+" "+E),h.setAccMessage("-right-dynamic-wrapper",C)):(B=h.getAccMessage("left",0),I>=a.MAX_VARIABLE&&H>=a.MAX_CONSTANT?C=h.getAccMessage("pan-state","full",[B,D]):I>=a.MAX_VARIABLE?C=h.getAccMessage("pan-state","variable-full")+" "+E:H>=a.MAX_CONSTANT&&(C=h.getAccMessage("pan-state","constant-full")+" "+E),h.setAccMessage("-left-dynamic-wrapper",C)),h.setFocus(x),$(v).remove(),v=null,k.draggable("option","revert",!0),w=!1}v&&(k.draggable(),k.draggable("option","revert",!0),y=h._nullifyTileAfterDrop(l,v,k.hasClass("dispenser-tile")),y!==a.TILE_NOT_NULLIFIED&&y!==a.TILE_NULLIFIED||e?e||y!==a.PAN_FULL||(v.remove(),k.draggable("option","revert",!0),j.hasClass("pan-dropped")&&k.remove()):(j.remove(),j.hasClass("pan-dropped")&&k.remove()),this._updateEquationForDynamicPanBalance(),this.animateDynamicPan())}if(w&&!f){var J,K,L,M,N,O,P=n.isVarNegative?h.getAccMessage("negative",0)+" ":"",F="",Q=h._getAccTextForEquation(m),R=h.getPanWeight("left"),S=h.getPanWeight("right"),T=h.getAccMessage("left",0),U=h.getAccMessage("right",0),V="",W=!1;R>S?(J=U,K=T,V=h.getAccMessage("balance",0,[K,J])):S>R?(J=T,K=U,V=h.getAccMessage("balance",0,[K,J])):(L=h.getEquationCoefficients("left"),M=h.getEquationCoefficients("right"),N=h.getEquationToModel(),0===M.variable&&M.constant===N.c&&L.variable===N.a&&L.constant===N.b&&"block"!=h.$("#"+h.idPrefix+"-left-temporary-bin").css("display")&&(W=!0),V=h.getAccMessage("balance",1)),F="Num"==n.type?"1":"x","right"===m?(W||(h.$("#"+h.idPrefix+x+"-acc-elem").blur(),O=h.getAccMessage("right-dynamic-pan",4,[P+F,Q]),y&&(O=h.getAccMessage("right-dynamic-pan",5,[F,F,Q])),O=O+" "+V,h.setAccMessage(x,O),h.setFocus(x)),h.trigger(a.RIGHT_PAN_DROP,o)):(W||(h.$("#"+h.idPrefix+x+"-acc-elem").blur(),O=h.getAccMessage("left-dynamic-pan",4,[P+F,Q]),y&&(O=h.getAccMessage("left-dynamic-pan",5,[F,F,Q])),O=O+" "+V,h.setAccMessage(x,O),h.setFocus(x)),h.trigger(a.LEFT_PAN_DROP,o)),h.trigger(a.PAN_DROP,o)}},_getTileBinTilesValue:function(b){for(var c=b.find("."+a.TILE_CLASS),d=c.length,e=null,f=null,g=0;d>g;g++)switch(f=$(c[g]).data().type){case"Var":e+=2;break;case"Num":e++}return e},_marqueeDrop:function(b,c,d){this.isOnDroppable=!0;var e=this,f=c.draggable.find("."+a.TILE_CLASS),g=d.data().pos,h=0,i=0,j=Math.abs(e.getVariableCount(g)),k=Math.abs(e.getConstantsCount(g)),l=null,m=d.hasClass("temporary-bin"),n=f.attr("pancontainer"),o=f.hasClass("temporary-dropped"),p=this.$("."+g+"-temporary-bin"),q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=this._getTileBinTilesValue(p),z=null,A=d.find("."+a.TILE_CLASS),B=(p.find("."+a.TILE_CLASS),a.BIN_CAPACITY);if(this.isMarqueeDrop=!0,f.each(function(){l=$(this),z=l.data(),"Var"===z.type?(h++,z.isVarNegative?x++:w++):(i++,z.isVarNegative?v++:u++)}),A.each(function(){l=$(this),z=l.data(),"Var"===z.type?z.isVarNegative?t++:s++:z.isVarNegative?r++:q++}),m&&n!==g||!m&&(i+k>16||h+j>4||n===g&&!o)||m&&o||o&&n!==g||y===B-1&&(x>0&&s>0||t>0&&w>0)||B/2-Math.round(y/2)<Math.min(x,s)||B/2-Math.round(y/2)<Math.min(t,w)||B-y<Math.min(v,q)||B-y<Math.min(r,u)||m&&!o&&y+v+u+2*(x+w)>24)c.draggable.draggable("option","revert",function(a){var b=$(this),c=b.offset(),d=c.left,f=c.top;$({left:d,top:f}).animate(e.marqueeView.getOriginalOffset(),{step:function(a,c){"top"===c.prop?f=a:d=a,
b.offset({left:d,top:f})},duration:500})}),e.trigger(a.MARQUEE_DROP,!1);else{this.tilesToNullify=0,c.draggable.draggable("option","revert","invalid");for(var C=f.length,D=0;C-1>D;D++)e._addTileInContainer($(f[D]),d,!1,m,!0);e._addTileInContainer($(f[D]),d,!1,m,!1),e._updateEquationForDynamicPanBalance(),e.marqueeView&&(e.marqueeView.collapseMarquee(),e.marqueeView.breakGroup()),e.trigger(a.MARQUEE_DROP,!0)}},_removeMarqueeOnTileDrag:function(){this.marqueeView&&(this.marqueeView.collapseMarquee(),this.marqueeView.breakGroup())},_getCurrentSelectedDispenserTile:function(a){var b=this.dispenserTiles,c=b.length,d=null;for(d=0;c>d;d++)if(b[d].isSelected===!0)return a?b[d]:b[d].$el;return null},_createHackScreenForLeftDynamicPan:function(a){if(!this.isMarqueeDrop){var b=a.find(".dynamic-wrapper").attr("id");b=b.slice(this.idPrefix.length);var c={elementId:b,tabIndex:this.tabIndex+12,acc:this.getAccMessage("left-dynamic-pan",0)};this.createAccDiv(c)}},enableDisableFocusOnPansAndTempBins:function(a){var b=this.$(".left-tile-container"),c=this.$(".right-tile-container"),d=b.find(".dynamic-wrapper").attr("id").slice(this.idPrefix.length),e=c.find(".dynamic-wrapper").attr("id").slice(this.idPrefix.length),f="-left-temporary-bin",g="-right-temporary-bin";this.enableTab(d,a),this.enableTab(e,a),this.enableTab(f,a),this.enableTab(g,a)},_createHackScreenForRightDynamicPan:function(a){if(!this.isMarqueeDrop){var b=a.find(".dynamic-wrapper").attr("id");b=b.slice(this.idPrefix.length);var c={elementId:b,tabIndex:this.tabIndex+128,acc:this.getAccMessage("right-dynamic-pan",0)};this.createAccDiv(c)}},_createHackScreenForAccessibilityPans:function(a){var b=a.find(".accessibility-dynamic-wrapper").show().attr("id");b=b.slice(this.idPrefix.length);var c={elementId:b,tabIndex:-1,acc:"Acc temp bin"};this.createAccDiv(c),this.enableTab(b,!1),a.find(".accessibility-dynamic-wrapper").hide()},_createHackScreenForAccessibilityTemporaryPans:function(a){var b="-"+a+"-accessibility-temporary-bin",c={elementId:b,tabIndex:-1,acc:"Temp Acc trash can"};this.createAccDiv(c),this.enableTab(b,!1)},createHackScreenForDynamicPans:function(){var a=this,b=this.$(".left-tile-container"),c=this.$(".right-tile-container");a._createHackScreenForLeftDynamicPan(b),a._createHackScreenForRightDynamicPan(c),a._createHackScreenForAccessibilityPans(b),a._createHackScreenForAccessibilityPans(c),a._attachHandlersForAccessibilityHelperPans()},_$currentBin:null,_$tileToNullify:null,_$tilesToNullify:[],_nullifyTileAfterDrop:function(b,c,d){var e=this,f=b.data().pos,g=a.MAX_ROWS,h=c.data().type,i=c.data().isVarNegative,j=Number(c.attr("rowNo")),k=b.find("."+h+"-table"),l=null,m=null,n=null,o=null;switch(h){case"Var":m=k.find("."+a.TILE_CLASS),m.each(function(a,b){var c=$(this),d=c.data().isVarNegative;return i!==d&&c.data().isFading!==!0?(l=c,e.tilesToNullify++,!1):void 0});break;case"Num":var p=!1;for(o=j;g>o;o++){var q=k.find(".row-"+o).children();if(p)break;$(q.get().reverse()).each(function(){var a=$(this),b=a.data().isVarNegative;return i!==b&&a.data().isFading!==!0?(l=a,p=!0,e.tilesToNullify++,!1):void 0})}break;default:return!1}return n="left"===f?this.$(".left-temporary-bin"):this.$(".right-temporary-bin"),e._$currentBin=n,l&&e._$tilesToNullify.push(l.clone(!0)),l&&l.length>0?(c.draggable("option","revert",!0),e.isTemporaryBinFull(e._$currentBin,e._$tilesToNullify[e._$tilesToNullify.length-1])?(e._$tilesToNullify.splice(0,1),c.remove(),a.PAN_FULL):(e._fadeAndRemoveTiles(l,c,function(){e.tilesToNullify--,0===e.tilesToNullify&&e._arrangeTilesInPan(b,3);for(var a=e._$tilesToNullify.length,c=0;a>c;c++)"block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display")&&e._addTileInContainer(e._$tilesToNullify[c],e._$currentBin,!1,!0),e._$tilesToNullify.splice(c,1),a=e._$tilesToNullify.length}),a.TILE_NULLIFIED)):a.TILE_NOT_NULLIFIED},_fadeAndRemoveTiles:function(b,c,d){var e=null,f=1,g=.1;b.data().isFading=!0,c.data().isFading=!0,b.draggable(),b.draggable("option","disable",!0),c.draggable(),c.draggable("option","disable",!0),this.isFading=!0,e=setInterval($.proxy(function(){b.css({opacity:f}),c.css({opacity:f}),0>=f&&(clearInterval(e),this.isFading=!1,b.remove(),c.remove(),this._updateEquationForDynamicPanBalance(),this.animateDynamicPan(),d&&d(),this.trigger(a.TILE_FADEOUT)),f-=g},this),a.FADE_TILES_DURATION)},_renderTemporaryTrashCan:function(){var b=a.MAX_ROWS-1,c=null,d=this.$(".temporary-bin"),e={rowCount:b,colCount:0},f="-left-temporary-bin",g="-right-temporary-bin",h=this;d.css({"background-image":'url("'+this.filePath.getImagePath("temporary-bin")+'")'}),c=this._createTilesContainer(e),d.append(c),this._makeTemporaryTrashCansDroppable(),this._createHackScreenForTemporaryTrashCans("left"),this._createHackScreenForTemporaryTrashCans("right"),this._createHackScreenForAccessibilityTemporaryPans("left"),this._createHackScreenForAccessibilityTemporaryPans("right"),h.$("#"+h.idPrefix+f+"-acc-elem").off("keydown.pan-balance").on("keydown.pan-balance",$.proxy(h._setPanAccTextOnTab,h)),h.$("#"+h.idPrefix+g+"-acc-elem").off("keydown.pan-balance").on("keydown.pan-balance",$.proxy(h._setPanAccTextOnTab,h)),h.focusOut(f,function(){h._setTempBinAccText()}),h.focusOut(g,function(){h._setTempBinAccText()})},_makeTemporaryTrashCansDroppable:function(){var a=this,b=this.$(".temporary-bin"),c={drop:function(b,c){a._onTemporaryBinDrop(b,c,$(this))}};b.droppable(c)},_onTemporaryBinDrop:function(b,c,d,e){if(c.draggable.hasClass("marquee-div"))return void this._marqueeDrop(b,c,d);var f,g,h,i=this,j="temporary-dropped",k=(this.$(".temporary-bin"),null),l=null,m=null,n=null,o=!1,p=null;if(l=c.draggable,p=l.data(),m=d,n=l.attr("pancontainer"),h=i.$("."+n+"-pan-wrapper").find(".dynamic-container"),l.hasClass(j))l.draggable("option","revert",!0);else{if(m.data().pos!==n)return void l.draggable("option","revert",!0);k=i._temporaryBinDropHandler(m,l),k?(l.hasClass("pan-dropped")&&l.remove(),h.find(".dynamic-wrapper #"+l[0].id).remove(),setTimeout(function(){i._arrangeTilesInPan(h.find(".dynamic-wrapper"),Number(l.attr("rowNo")))},1),i._createHackScreenForTemporaryBinTiles(k),i._makeTileDraggableAfterDrop(k),i.animateDynamicPan(),i._makeContextMenuForDraggable(k,k.attr("panContainer"),!0),i._addHoverEffectToNewTileInTemporaryTrashCan(k),l.draggable(),l.draggable("option","revert","invalid"),o=!0):l.draggable("option","revert",!0),o&&!e&&(f=k.data("isVarNegative")?i.getAccMessage("negative",0)+" ":"",g=f+("Var"===k.data("type")?"x":1),i._setTempBinAccText(g,null,k.attr("panContainer")),i.trigger(a.TRASH_DROP,p))}},_createHackScreenForTemporaryTrashCans:function(a){var b="-"+a+"-temporary-bin",c="left"===a?this.tabIndex+242:this.tabIndex+367,d="left"===a?this.getAccMessage("left",0):this.getAccMessage("right",0),e={elementId:b,tabIndex:c,acc:this.getAccMessage("temporary-trash-can",0,[d])};this.createAccDiv(e)},_temporaryBinDropHandler:function(b,c){var d=this,e=a.MAX_ROWS-2,f=null,g=null,h=c.data().isDisabled?c.data().isDisabled:this._getIsDisabled(),i=c.data().value,j=c.data().type,k=c.data().text,l=c.data().isVarNegative,m=this._getDroppedTileId(),n=this.idPrefix+"dropped-tile-"+m,o={type:j,text:k,value:i,isVarNegative:l,isDisabled:h},p=b,q=null,r=null;for("Var"===c.data().type&&(i=2);e>=0;e--)if(f=p.find(".row-"+e),q=d._isRowFull(f,i,j,!0),g=q.isRowFull,!g)return r=d._createDraggableTiles(f,o,n,"",!0),r.addClass(a.TILE_CLASS+" temporary-hover pan-dropped temporary-dropped dropped-in-bin").attr({colNo:q.colNo,rowNo:e,panContainer:b.data().pos}),d._incrementDroppedTileId(),r;0>e&&c.draggable("option","revert",!0)},_addHoverEffectToNewTileInTemporaryTrashCan:function(a){if(a){var b="temporary-hover",c=MathInteractives.Common.Utilities.Models.BrowserCheck;c.isIOS||c.isAndroid?(a.on("touchend",function(){$(this).addClass(b)}),a.on("touchstart",function(a){var c=$(a.target);c.hasClass("pan-balance-draggable-tile-right-shadow")||c.hasClass("pan-balance-draggable-tile-bottom-shadow")||$(this).removeClass(b)})):(a.on("mouseover",function(a){var c=$(a.target);c.hasClass("pan-balance-draggable-tile-right-shadow")||c.hasClass("pan-balance-draggable-tile-bottom-shadow")||$(this).removeClass(b)}),a.on("mouseout",function(){$(this).addClass(b)}))}},_arrangeTilesInTemporaryTrashCans:function(a,b,c,d){var e=this,f=c?c:this._getIsDisabled(),g=b,h=a,i=null,j=null,k=null,l=null;for(l=--g;l>-1;l--){var m=d?d.find(".row-"+l).children():h.find(".row-"+l).children();m.each(function(){j=$(this),i={type:j.data().type,text:j.data().text,value:j.data().value,isVarNegative:j.data().isVarNegative,isDisabled:f},j.remove(),k=e._temporaryBinDropHandler(h,j.data(i)),e._createHackScreenForTemporaryBinTiles(k),e._makeTileDraggableAfterDrop(k),e._makeContextMenuForDraggable(k,k.attr("panContainer"),!0),e._addHoverEffectToNewTileInTemporaryTrashCan(k)})}},_handleTilesPositionInContainer:function(b,c,d){var e=d?d:!1,f=4,g=this,h=a.MAX_ROWS-1,i=null,j=null,k=c.data().isDisabled?c.data().isDisabled:this._getIsDisabled(),l=c.data().value,m=c.data().type,n=c.data().text,o=c.data().isVarNegative,p=this._getDroppedTileId(),q=this.idPrefix+"dropped-tile-"+p,r={type:m,text:n,value:l,isVarNegative:o,isDisabled:k},s=b.find("."+m+"-table"),t=null,u=null;for("Var"===c.data().type&&(l=1,f=1);h>=0;h--)if(i=s.find(".row-"+h),t=g._isRowFull(i,l,m),j=t.isRowFull,!j)return u=g._createDraggableTiles(i,r,q,"",e),u.addClass(a.TILE_CLASS+" pan-dropped").attr({colNo:t.colNo,rowNo:h,panContainer:b.data().pos}),g._incrementDroppedTileId(),u},_doubleClickOnTileHandler:function(b){if(!this._getIsDisabled()){var c=b.data().type,d=b.data().value,e=b.data().text,f=b.data().isVarNegative,g=b.data().isDisabled,h={value:d,type:c,text:e,isVarNegative:f,isDisabled:g};if("Num"===c&&d>1){var i=this,e=b.data().text,j=null,k=null,l={type:c,text:"1",value:1},m=b.attr("panContainer"),n=i.$("."+m+"-pan-wrapper").find(".dynamic-wrapper");for(b.remove(),j=0;d>j;j++){var o=$("<div>");o.data(l),k=i._handleTilesPositionInContainer(n,o),i._makeTileDraggableAfterDrop(k),i._makeContextMenuForDraggable(k,"_doubleClickOnTileHandler")}}this.trigger(a.DOUBLE_CLICK_TILE,h)}},_makeTileDraggableAfterDrop:function(b,c){var d=c?c:!1,e=this,f="temporary-dropped",g=null,h=null;return g={revert:function(){e.$(".ui-draggable-dragging").remove(),e._deleteOnRevertHandler($(this)),e._attachHandlerForClickAndClick()},zIndex:9999,helper:"clone",start:function(b,c){e._removeMarqueeOnTileDrag(),e.trigger(a.TILE_DRAG),$(this).css({visibility:"hidden"}),e._detachHandlerForClickAndClick()},stop:function(a,b){var c=$(this);c.css({visibility:"visible"}),c.draggable(),c.draggable("option","revert",function(){e._deleteOnRevertHandler($(this))}),e._attachHandlerForClickAndClick()},cancel:".var-tile-right-shadow,.num-tile-right-shadow,.var-tile-bottom-shadow,.num-tile-bottom-shadow",containment:e._getContainmentSelector(),appendTo:e._getContainmentSelector()},b.hasClass(f)||(h={greedy:!0,drop:function(b,c){if(c.draggable.hasClass("marquee-div")){var d=$(this),f=d.attr("pancontainer"),g=d.parents(),h=null;return void g.each(function(){$(this).attr("data-pos")===f&&(h=$(this),e._marqueeDrop(null,c,h))})}var i,j=c.draggable,k=j.data(),l=j.attr("panContainer"),h=$(this),m=h.data(),n=h.attr("panContainer"),o=e.$("."+n+"-pan-wrapper").find(".dynamic-container"),p=Number(j.attr("rowno")),q=Number(h.attr("rowno")),r=c.helper,s=null;if(j.hasClass("temporary-dropped")){if(l!==n)return void j.draggable("option","revert",!0);if(k.type===m.type&&m.isVarNegative!==k.isVarNegative){var t=c.draggable.hasClass("pan-dropped")?c.draggable:c.helper;e._$tileToNullify=h.clone(!0),e._$currentBin="right"===n?e.$(".right-temporary-bin"):e.$(".left-temporary-bin"),e.isTemporaryBinFull(e._$currentBin,e._$tileToNullify)?c.draggable.draggable("option","revert",!0):(e._fadeAndRemoveTiles(h,t,function(){e._arrangeTilesInPan(o.find(".dynamic-wrapper"),q),e._arrangeTilesInTemporaryTrashCans(e.$("."+l+"-temporary-bin"),p),e._updateEquationForDynamicPanBalance(),e.animateDynamicPan(),"block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display")&&(e._addTileInContainer(e._$tileToNullify,e._$currentBin,!1,!0),e._$tileToNullify=null),"right"===n?e.trigger(a.RIGHT_PAN_DROP,t.data()):e.trigger(a.LEFT_PAN_DROP,t.data()),e.trigger(a.PAN_DROP,t.data())}),c.draggable.draggable("option","revert",""))}else s=e._handleTilesPositionInContainer(o,j),s?(s.attr("panContainer",n),e._createHackScreenForPanTiles({newTile:s,panPosition:s.attr("panContainer")}),j.remove(),e._arrangeTilesInTemporaryTrashCans(e.$("."+l+"-temporary-bin"),p),s=e._makeTileDraggableAfterDrop(s),e._makeContextMenuForDraggable(s,"_makeTileDraggableAfterDrop"),e._updateEquationForDynamicPanBalance(),e._nullifyTileAfterDrop(o,s),j.draggable(),j.draggable("option","revert","invalid"),e.animateDynamicPan(),"right"===n?e.trigger(a.RIGHT_PAN_DROP,j.data()):e.trigger(a.LEFT_PAN_DROP,j.data()),e.trigger(a.PAN_DROP,j.data())):j.draggable("option","revert",!0)}else if(j.hasClass("pan-dropped")){if(l===n)return void j.draggable("option","revert",!0);if(k.type===m.type&&m.isVarNegative!==k.isVarNegative){var t=c.draggable.hasClass("pan-dropped")?c.draggable:c.helper;e._$tileToNullify=h.clone(!0),e._$currentBin="right"===n?e.$(".right-temporary-bin"):e.$(".left-temporary-bin"),c.draggable.draggable("option","revert",!1),e.isTemporaryBinFull(e._$currentBin,e._$tileToNullify)?c.draggable.draggable("option","revert",!0):(e._fadeAndRemoveTiles(h,t,function(){e._arrangeTilesInPan(o.find(".dynamic-wrapper"),q),e._arrangeTilesInPan(e.$("."+l+"-pan-wrapper").find(".dynamic-wrapper"),p),e._updateEquationForDynamicPanBalance(),e.animateDynamicPan(),"block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display")&&(e._addTileInContainer(e._$tileToNullify,e._$currentBin,!1,!0),e._$tileToNullify=null),"right"===n?e.trigger(a.RIGHT_PAN_DROP,t.data()):e.trigger(a.LEFT_PAN_DROP,t.data()),e.trigger(a.PAN_DROP,t.data())}),c.draggable.draggable("option","revert",!1))}else{if(s=e._handleTilesPositionInContainer(o,j),!s)return void j.draggable("option","revert",!0);s.attr("panContainer",n),e._createHackScreenForPanTiles({newTile:s,panPosition:s.attr("panContainer")}),j.remove(),e._arrangeTilesInPan(e.$("."+l+"-pan-wrapper").find(".dynamic-wrapper"),p),s=e._makeTileDraggableAfterDrop(s),e._makeContextMenuForDraggable(s,"_makeTileDraggableAfterDrop"),e._updateEquationForDynamicPanBalance(),i=e._nullifyTileAfterDrop(o,s),j.draggable(),j.draggable("option","revert","invalid"),e.animateDynamicPan(),"right"===n?e.trigger(a.RIGHT_PAN_DROP,j.data()):e.trigger(a.LEFT_PAN_DROP,j.data()),e.trigger(a.PAN_DROP,j.data())}}else if(k.type===m.type&&m.isVarNegative!==k.isVarNegative){var t=c.draggable.hasClass("pan-dropped")?c.draggable:c.helper;c.draggable.draggable("option","revert",!1),e._$tileToNullify=h.clone(!0),e._$currentBin="right"===n?e.$(".right-temporary-bin"):e.$(".left-temporary-bin"),e.isTemporaryBinFull(e._$currentBin,e._$tileToNullify)?c.draggable.draggable("option","revert",!0):e._fadeAndRemoveTiles(h,t,function(){e._arrangeTilesInPan(o.find(".dynamic-wrapper"),p>q?p:q),e._updateEquationForDynamicPanBalance(),e.animateDynamicPan(),"block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display")&&(e._addTileInContainer(e._$tileToNullify,e._$currentBin,!1,!0),e._$tileToNullify=null),"right"===n?e.trigger(a.RIGHT_PAN_DROP,t.data()):e.trigger(a.LEFT_PAN_DROP,t.data()),e.trigger(a.PAN_DROP,t.data())})}else s=e._handleTilesPositionInContainer(o,j),s?(s.attr("panContainer",n),e._createHackScreenForPanTiles({newTile:s,panPosition:s.attr("panContainer")}),s=e._makeTileDraggableAfterDrop(s),e._makeContextMenuForDraggable(s,"_makeTileDraggableAfterDrop"),e._updateEquationForDynamicPanBalance(),i=e._nullifyTileAfterDrop(o,s),i===a.PAN_FULL&&(s.remove(),j.draggable("option","revert",!0),r.hasClass("pan-dropped")&&j.remove()),e.animateDynamicPan(),"right"===n?e.trigger(a.RIGHT_PAN_DROP,j.data()):e.trigger(a.LEFT_PAN_DROP,j.data()),e.trigger(a.PAN_DROP,j.data())):j.draggable("option","revert",!0)}},b.droppable(h)),b.draggable(g),b.off("click").on("click",$.proxy(e._tileClickHandler,e,b)),b.off("touchmove.forStopPropogation").on("touchmove.forStopPropogation",function(a){a.stopPropagation()}),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$("."+a.TILE_CLASS),{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE|MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.STOP_PROPAGATION}),d&&b.draggable("disable"),b},isTemporaryBinFull:function(b,c){for(var d,e,f,g=a.MAX_ROWS-2,h=this,i=c.data().value,j=c.data().type;g>=0;g--)if(e=b.find(".row-"+g),i="Var"===j?2:1,f=h._isRowFull(e,i,j,!0),d=f.isRowFull,!d)return d;return!0},_tileClickHandler:function(a,b){var c,d,e,f,g,h=this,i=h._getTileContainer(a),j=i.attr("data-pos");this._removeMarqueeOnTileDrag(),this.trigger("tile_click"),c=a.data("isVarNegative")?h.getAccMessage("negative",0)+" ":"",d=c+("Var"===a.data("type")?"x":"1"),h.currentDroppedTileSelected=a,i.hasClass("temporary-bin")?"left"===j?(this.$("#"+this.idPrefix+"-left-accessibility-dynamic-wrapper").show(),f=$(a).find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),g=this.getTabIndex(f),h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null,g),h._setAccTextForAccDynamicWrapper("left",d),this.focusIn("-left-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null,g),h.player._refreshDOM()}),this.focusOut("-left-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null)}),this.setFocus("-left-accessibility-dynamic-wrapper")):(this.$("#"+this.idPrefix+"-right-accessibility-dynamic-wrapper").show(),f=$(a).find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),g=this.getTabIndex(f),h._setAccTextForAccDynamicWrapper("right",d),h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null,g),this.focusIn("-right-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null,g),h.player._refreshDOM()}),this.focusOut("-right-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null)}),this.setFocus("-right-accessibility-dynamic-wrapper")):(e=h.getAccMessage(j,0),"left"===j?(this.$("#"+this.idPrefix+"-right-accessibility-dynamic-wrapper").show(),f=$(a).find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),g=this.getTabIndex(f),"block"===this.$("#"+this.idPrefix+"-left-temporary-bin").css("display")?(this.$("#"+this.idPrefix+"-left-accessibility-temporary-bin").show(),h.setAccMessage("-left-accessibility-temporary-bin",h.getAccMessage("temporary-trash-can",2,[d,e])),h._setAccTextForAccDynamicWrapper("right",d),h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin",g),this.focusIn("-right-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin",g),h.player._refreshDOM()}),this.focusOut("-right-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin")}),this.focusIn("-left-accessibility-temporary-bin",function(){h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin",g),h.player._refreshDOM()}),this.focusOut("-left-accessibility-temporary-bin",function(){h._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper","-left-accessibility-temporary-bin")})):(h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null,g),h._setAccTextForAccDynamicWrapper("right",d),this.focusIn("-right-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null,g),h.player._refreshDOM()}),this.focusOut("-right-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-right-accessibility-dynamic-wrapper",null)})),this.setFocus("-right-accessibility-dynamic-wrapper")):(this.$("#"+this.idPrefix+"-left-accessibility-dynamic-wrapper").show(),f=$(a).find(".pan-balance-draggable-tile-text-container").attr("id").slice(this.idPrefix.length),g=this.getTabIndex(f),"block"===this.$("#"+this.idPrefix+"-right-temporary-bin").css("display")?(this.$("#"+this.idPrefix+"-right-accessibility-temporary-bin").show(),h.setAccMessage("-right-accessibility-temporary-bin",h.getAccMessage("temporary-trash-can",2,[d,e])),h._setAccTextForAccDynamicWrapper("left",d),h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin",g),this.focusIn("-left-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin",g),h.player._refreshDOM()}),this.focusOut("-left-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin")}),this.focusIn("-right-accessibility-temporary-bin",function(){h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin",g),h.player._refreshDOM()}),this.focusOut("-right-accessibility-temporary-bin",function(){h._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper","-right-accessibility-temporary-bin")})):(h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null,g),h._setAccTextForAccDynamicWrapper("left",d),this.focusIn("-left-accessibility-dynamic-wrapper",function(){h._setTabIndexToTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null,g),h.player._refreshDOM()}),this.focusOut("-left-accessibility-dynamic-wrapper",function(){h._disableTempAccessibilityDivs("-left-accessibility-dynamic-wrapper",null)})),this.setFocus("-left-accessibility-dynamic-wrapper")))},_setAccTextForAccDynamicWrapper:function(a,b){var c,d=this;switch(a){case"left":0===d.getPanWeight("left")?d.setAccMessage("-left-accessibility-dynamic-wrapper",d.getAccMessage("left-dynamic-pan",1),[b]):(c=d._getAccTextForEquation("left"),d.setAccMessage("-left-accessibility-dynamic-wrapper",d.getAccMessage("left-dynamic-pan",3),[c,b]));break;case"right":0===d.getPanWeight("right")?d.setAccMessage("-right-accessibility-dynamic-wrapper",d.getAccMessage("right-dynamic-pan",1),[b]):(c=d._getAccTextForEquation("right"),d.setAccMessage("-right-accessibility-dynamic-wrapper",d.getAccMessage("right-dynamic-pan",3),[c,b]))}},_setTabIndexToTempAccessibilityDivs:function(a,b,c){a&&this.setTabIndex(a,c+1),b&&this.setTabIndex(b,c+2)},_disableTempAccessibilityDivs:function(a,b){a&&this.enableTab(a,!1),b&&this.enableTab(b,!1)},hideTempAccessibilityDivs:function(){this.$("#"+this.idPrefix+"-left-accessibility-dynamic-wrapper").hide(),this.$("#"+this.idPrefix+"-right-accessibility-dynamic-wrapper").hide(),this.$("#"+this.idPrefix+"-left-accessibility-temporary-bin").hide(),this.$("#"+this.idPrefix+"-right-accessibility-temporary-bin").hide()},_enableDisablePanDroppedTiles:function(a,b){var c=this,d=c.idPrefix+"-"+a+"-dynamic-wrapper";c.$("#"+d).find(".pan-balance-draggable-tile-text-container").each(function(){var a=$(this).attr("id").slice(c.idPrefix.length);a&&c.enableTab(a,b)})},_enableDisableTemporaryBinDroppedTiles:function(a,b){var c=this,d=c.idPrefix+"-"+a+"-temporary-bin";c.$("#"+d).find(".pan-balance-draggable-tile-text-container").each(function(){var a=$(this).attr("id").slice(c.idPrefix.length);a&&c.enableTab(a,b)})},_handleMarqueeShowHide:function(a){var b=this;a.on("mousedown",function(a){a.stopPropagation(),b._removeMarqueeOnTileDrag(),b.trigger("tile_click")})},_deleteOnRevertHandler:function(b){if(b&&0!==$("#"+b[0].id).length){var c=b.attr("panContainer"),d=Number(b.attr("rowno")),e=this.$("."+c+"-pan-wrapper").find(".dynamic-container"),f=b.data(),g=f.value,h=f.type,i=f.text,j=f.isVarNegative,k=f.isDisabled,l={value:g?g:1,type:h?h:"Num",text:i?i:"2",isVarNegative:j?j:!1,isDisabled:k?k:!1},m=!1;b.remove();var n=this;n.marqueeMoveOut||(m=!0),m&&!n.marqueeMoveOut&&(setTimeout(function(){n._arrangeTilesInPan(e.find(".dynamic-wrapper"),d)},1),b.hasClass("temporary-dropped")&&setTimeout(function(){n._arrangeTilesInTemporaryTrashCans(n.$("."+c+"-temporary-bin"),d)},1),this._updateEquationForDynamicPanBalance(),this.animateDynamicPan(),this.trigger(a.TRASH_DROP,l))}},_isRowFull:function(b,c,d,e){var f=e?8:4,g=0,h=!1,i=b.find("."+a.TILE_CLASS),j=null;return e||"Var"===d&&(f=1),i.each(function(){j=$(this);var a=Math.abs(j.data().value);"Var"===j.data().type&&(a=e?2:1),j.hasClass("ui-draggable-dragging")||(g+=a)}),g+=Math.abs(c),g>f&&(h=!0),{isRowFull:h,colNo:g}},_incrementDroppedTileId:function(){this.droppedTileId++},_getDroppedTileId:function(){return this.droppedTileId},_incrementStaticTileId:function(){this.staticTileId++},_getStaticTileId:function(){return this.staticTileId},_toggleDisableTiles:function(a,b,c){if("undefined"!=typeof a){var d=c?c:!1,e=this,f=b?b:this._getIsDisabled(),g=a,h=a.leftPan?a.leftPan:[],i=h.length,j=a.rightPan?a.rightPan:[],k=j.length,l=a.leftTemporaryBin?a.leftTemporaryBin:[],m=l.length,n=a.rightTemporaryBin?a.rightTemporaryBin:[],o=n.length,p=null,q=null,r=this.$(".left-pan-wrapper").find(".dynamic-container"),s=this.$(".right-pan-wrapper").find(".dynamic-container"),t=this.$(".left-temporary-bin"),u=this.$(".right-temporary-bin");for(this.panTabIndexes=$.extend(!0,{},this.model.getPanTilesTabIndexes()),p=0;i>p;p++){var v=$("<div>");h[p].isDisabled=f,v.data(h[p]),q=e._handleTilesPositionInContainer(r,v,d),q.attr("panContainer","left"),f||e._createHackScreenForPanTiles({newTile:q,panPosition:q.attr("panContainer")}),q=e._makeTileDraggableAfterDrop(q,f),e._makeContextMenuForDraggable(q,q.attr("panContainer"),!0)}for(p=0;k>p;p++){var v=$("<div>");j[p].isDisabled=f,v.data(j[p]),q=e._handleTilesPositionInContainer(s,v,d),q.attr("panContainer","right"),f||e._createHackScreenForPanTiles({newTile:q,panPosition:q.attr("panContainer")}),q=e._makeTileDraggableAfterDrop(q,f),e._makeContextMenuForDraggable(q,q.attr("panContainer"),!0)}for(e._setPanAccText(),p=0;m>p;p++){var v=$("<div>");l[p].isDisabled=f,v.data(l[p]),q=e._temporaryBinDropHandler(t,v),e._makeTileDraggableAfterDrop(q,f),e._makeContextMenuForDraggable(q,"_toggleDisableTiles leftTemporaryBinDataArrayLength"),f||(e._addHoverEffectToNewTileInTemporaryTrashCan(q),e._createHackScreenForTemporaryBinTiles(q)),q.attr("panContainer","left")}for(p=0;o>p;p++){var v=$("<div>");n[p].isDisabled=f,v.data(n[p]),q=e._temporaryBinDropHandler(u,v),e._makeTileDraggableAfterDrop(q,f),e._makeContextMenuForDraggable(q,"_toggleDisableTiles rightTemporaryBinDataArrayLength"),f||(e._addHoverEffectToNewTileInTemporaryTrashCan(q),e._createHackScreenForTemporaryBinTiles(q)),q.attr("panContainer","right")}g.position?e.animatePanBalance(g.position):e.animateDynamicPan()}},_renderDefaultTiles:function(a){var b=null;b="undefined"==typeof a.isDisabled?this._getIsDisabled():a.isDisabled;var c=this;c.clearPans(),c._toggleDisableTiles(a,b,!0)},_activateTrashCan:function(a){var b=this;$("#"+a).off("drop").on("drop",function(a,c){b._onDropInTrashCan(a,c)})},_throwAwayTile:function(a){var b,c={draggable:a,helper:a},d=a.data("isVarNegative")?this.getAccMessage("negative",0)+" ":"",e=d+("Var"===a.data("type")?"x":"1");this._onDropInTrashCan(null,c),a.hasClass("dropped-in-bin")?(this._setTempBinAccText(null,e,a.attr("pancontainer")),b="left"===a.attr("pancontainer")?"-left-temporary-bin":"-right-temporary-bin",this.setFocus(b)):(this._setPanAccText(null,e,a.attr("pancontainer")),b="left"===a.attr("pancontainer")?"-left-dynamic-wrapper":"-right-dynamic-wrapper",this.setFocus(b))},_onDropInTrashCan:function(b,c){var d=this;if(c.draggable.hasClass("pan-dropped")){c.helper.hasClass("pan-dropped")&&c.draggable.remove();var e=c.draggable.data(),f={value:e.value,type:e.type,text:e.text,isVarNegative:e.isVarNegative},g=c.helper.remove(),h=d.$("."+g.attr("panContainer")+"-pan-wrapper").find(".dynamic-wrapper"),i=Number(g.attr("rowNo"));if(d.animateDynamicPan(),d._arrangeTilesInPan(h,i),c.draggable.hasClass("temporary-dropped")){var j=d.$("."+c.draggable.attr("panContainer")+"-temporary-bin"),k=Number(c.draggable.attr("rowNo"));d._arrangeTilesInTemporaryTrashCans(j,k)}d.trigger(a.TRASH_DROP,f)}},_getEquation:function(b,c){if("undefined"!=typeof b){var d=c?c:!1,e=a.VARIABLE_LABEL,f=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),g=f.find("."+a.TILE_CLASS),h=[],i=null,j=0,k=0,l=null,m=null,n=null,o="",p=!0;if(g.each(function(){l=$(this),l.hasClass("ui-draggable-dragging")||(m=l.data(),n={value:m.value,type:m.type,text:m.text,isVarNegative:m.isVarNegative},"Num"===n.type&&(m.isVarNegative&&(n.value=-1*n.value),h.push(n.value)))}),i=$(h),i.each(function(a,b){j+=b}),0>j&&(p=!1),k=this.getVariableCount(b),d){var q={constant:j,variable:k};return q}return 0===k?o=j.toString():0===j?(1===k?k="":-1===k&&(k="-"),o=k+'<span class="italic">'+e+"</span>"):(1===k?k="":-1===k&&(k="-"),o=p?k+'<span class="italic">'+e+"</span> + "+j:k+'<span class="italic">'+e+"</span> - "+Math.abs(j)),o}},_getContainmentSelector:function(){var a=this.containmentID;return"string"==typeof a?a="#"+a:"object"==typeof a&&(a=a),a},_arrangeTilesInPan:function(a,b,c,d){var e=this,f=c?c:this._getIsDisabled(),g=b,h=a,i=null,j=null,k=null,l=null,m=h.attr("data-pos");for(l=--g;l>-1;l--){var n=d?d.find(".row-"+l).children():h.find(".row-"+l).children();n.each(function(){j=$(this),i={type:j.data().type,text:j.data().text,value:j.data().value,isVarNegative:j.data().isVarNegative,isDisabled:f},j.remove(),k=e._handleTilesPositionInContainer(h,j.data(i)),e._createHackScreenForPanTiles({newTile:k,panPosition:k.attr("panContainer")}),e._makeTileDraggableAfterDrop(k);var a="block"===e.$("#"+e.idPrefix+"-left-temporary-bin").css("display");e._makeContextMenuForDraggable(k,k.attr("panContainer"),a)})}var o=e._getCurrentSelectedDispenserTile();null===o&&e._reassignTabIndexesToPanTiles(0,m)},_getTileDataForPan:function(b){var c=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),d=c.find(".pan-row"),e=[],f=null,g=null,h=null,i=null;return $(d.get().reverse()).each(function(){g=$(this).find("."+a.TILE_CLASS),g.each(function(){f=$(this),f.hasClass("ui-draggable-dragging")||(h=f.data(),"Var"===h.type&&(h.text=$(h.text).html()?$(h.text).html():h.text),i={type:h.type,text:h.text.toString().replace(a.NEGATIVE_TILE_INDICATOR,""),value:h.value,isVarNegative:h.isVarNegative,isDisabled:h.isDisabled},e.push(i))})}),e},_getTileDataForTemporaryBin:function(b){var c=this.$(".temporary-bins-container").find("."+b+"-temporary-bin"),d=c.find(".pan-row"),e=[],f=null,g=null,h=null,i=null;return $(d.get().reverse()).each(function(){g=$(this).find("."+a.TILE_CLASS),g.each(function(){f=$(this),f.hasClass("ui-draggable-dragging")||(h=f.data(),"Var"===h.type&&(h.text=$(h.text).html()?$(h.text).html():h.text),i={type:h.type,text:h.text.toString().replace(a.NEGATIVE_TILE_INDICATOR,""),value:h.value,isVarNegative:h.isVarNegative,isDisabled:h.isDisabled},e.push(i))})}),e},_setIsDisabled:function(a){a?this.isPanDisabled=a:this.isPanDisabled=!1},_getIsDisabled:function(){return this.isPanDisabled},_getSpecificTypeTileCount:function(a,b,c){if("undefined"!=typeof b&&"undefined"!=typeof a){var d=this.getSaveState(),e=d[a+"Pan"],f=e.length,g=null,h=null,i=0,j=!1,k=c?c:!1;for(g=0;f>g;g++)h=e[g],k||(j=h.isVarNegative?h.isVarNegative:!1),h.type===b&&(j?i--:i++);return i}},_updateEquationForDynamicPanBalance:function(a){var b=null,c=null;"undefined"==typeof a?(b=this.$(".left-pan-wrapper").find(".pan-label"),c=this._getEquation("left"),b.html(c),b=this.$(".right-pan-wrapper").find(".pan-label"),c=this._getEquation("right"),b.html(c)):(b=this.$("."+a+"-pan-wrapper").find(".pan-label"),
c=this._getEquation(a),b.html(c))},_setDraggableVariableValue:function(a){a&&(this.draggableVariableValue=a)},_getDraggableVariableValue:function(){return this.draggableVariableValue},_generateMarquee:function(){if(this.player){var b=MathInteractives.global.Marquee.createMarquee({idPrefix:this.idPrefix,manager:this.manager,filePath:this.filePath,player:this.player,marqueeContainer:this.marqueeContainer,selectorClass:a.TILE_CLASS,ignoreClass:"dispenser-tile"});return b.on(MathInteractives.global.Marquee.EVENTS.resize,$.proxy(this._marqueeResizeHandler,this)),b.on(MathInteractives.global.Marquee.EVENTS.start,$.proxy(this._marqueeStartHandler,this)),b.on(MathInteractives.global.Marquee.EVENTS.end,$.proxy(function(){setTimeout($.proxy(this._attachHandlerForClickAndClick,this),1)},this)),b.on(MathInteractives.global.Marquee.EVENTS.move,$.proxy(function(){this._detachHandlerForClickAndClick()},this)),b}},_marqueeResizeHandler:function(b){this.trigger(a.MARQUEE_RESIZE,b)},_marqueeStartHandler:function(b){var c=b.originalEvent,d={x:c.pageX,y:c.pageY};this.marqueeDragStartPoint=d,this.trigger(a.MARQUEE_START,b)},_getTileContainer:function(a){var b=null,c=null;return b=a.parents(".temporary-bin"),b.length?b:c=a.parents(".dynamic-wrapper")},getCurrentSelectedDispenserTileView:function(){return this._getCurrentSelectedDispenserTile(!0)},setDispenserTileSelected:function(a){return null===a.tileType?void(this.currentSelectedDispenserTile&&this.currentSelectedDispenserTile.removeBorder()):void this.$(".dispenser-wrapper").find(".dispenser-tile").each(function(){var b=$(this).data().type,c=$(this).data().isVarNegative;b===a.tileType&&c===a.isVarNegative&&$(this).trigger("click")})},highlightTiles:function(b,c,d,e){var f=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),g=f.find("."+c+"-table"),h=g.find("."+a.TILE_CLASS),i=null,d=d,j=h.length,k=!0;h[0]&&(k=$(h[0]).data().isVarNegative?!1:!0),h.each(function(a){i=$(this),a===j-1?e?(MathInteractives.Common.Components.Views.PanBalanceDraggableTile.showHighlightedPulse(i,k),d()):MathInteractives.Common.Components.Views.PanBalanceDraggableTile.showPulse(i,k,d):e?MathInteractives.Common.Components.Views.PanBalanceDraggableTile.showHighlightedPulse(i,k):MathInteractives.Common.Components.Views.PanBalanceDraggableTile.showPulse(i,k)})},hideHighlightOfTiles:function(b,c){var d=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),e=d.find("."+c+"-table"),f=e.find("."+a.TILE_CLASS),g=null;f.each(function(){g=$(this),MathInteractives.Common.Components.Views.PanBalanceDraggableTile.hidePulse(g)})},customFitMarqueeToBounds:function(a,b){return this.marqueeView?this.marqueeView.customFitMarqueeToBounds(a,b):void 0},setDraggableVariableValue:function(a){this._setDraggableVariableValue(a)},renderDefaultTiles:function(a){a&&this._renderDefaultTiles(a)},_skipAnimation:!1,disableDraggable:function(){var a=this;this.$(".ui-draggable").draggable("disable"),this._setIsDisabled(!0);var b=this.getSaveState();this._skipAnimation=!0,this._renderDefaultTiles(b),this._updateEquationForDynamicPanBalance(),this._skipAnimation=!1;var c=this.dispenserTiles.length;this.currentSelectedDispenserTile&&this.currentSelectedDispenserTile.removeBorder(),this.$(".dispenser-wrapper").find(".pan-balance-draggable-tile-text-container").each(function(){var b=$(this).attr("id").slice(a.idPrefix.length);a.enableTab(b,!1)});var d=this.$(".dispenser-container"),e=d.attr("id").slice(this.idPrefix.length);this.enableTab(e,!1),this.enableDisableFocusOnPansAndTempBins(!1);for(var f=0;c>f;f++)this.dispenserTiles[f].disableTile()},enableDraggable:function(){var a=this;this.$(".ui-draggable").draggable("enable"),this._setIsDisabled(!1);var b=this.getSaveState();this._renderDefaultTiles(b),this._updateEquationForDynamicPanBalance();var c=this.dispenserTiles.length;this.$(".dispenser-wrapper").find(".pan-balance-draggable-tile-text-container").each(function(){var b=$(this).attr("id").slice(a.idPrefix.length);a.enableTab(b,!0)});var d=this.$(".dispenser-container"),e=d.attr("id").slice(this.idPrefix.length);this.enableTab(e,!0),this.enableDisableFocusOnPansAndTempBins(!0);for(var f=0;c>f;f++)this.dispenserTiles[f].enableTile()},showPanLabel:function(a,b){if("undefined"!=typeof a){var c=this.$("."+a+"-pan-wrapper").find(".pan-label"),d=null;d="undefined"==typeof b?this._getEquation(a):b,c.show().html(d)}},hidePanLabel:function(){this.$(".pan-label").hide()},showDispenser:function(){this.$(".dispenser-container").css({top:"-120px"}).show()},hideDispenser:function(){this.$(".dispenser-container").hide()},animateDispenser:function(a,b){this.$(".dispenser-container").show().animate({top:"-45px"},{duration:"number"==typeof b?b:500,complete:function(){"function"==typeof a&&a()}})},showTemporaryTrashCans:function(){var a=this.$(".temporary-bin");a.fadeIn(),this._updateContextMenus(!0)},hideTemporaryTrashCans:function(){var a=this.$(".temporary-bin");a.hide(),this._updateContextMenus(!1)},_updateContextMenus:function(a){var b,c,d,e=this.$(".pan-dropped"),f=(e.length,this.idPrefix+"pan-balance-context-menu-"),g=[],h=[];for(b=0;5>b;b++)g.push(f+b);for(b=0;b<e.length;b++)c=$(e[b]),-1!==c[0].id.search(this.idPrefix)&&(d=c.data("contextMenu"),d.editContextMenu(g,!1),h=this._getIgnoreOptionsForTile(c,c.attr("pancontainer"),a),d.editContextMenu(h,!0))},_getIgnoreOptionsForTile:function(a,b,c){var d=this.idPrefix+"pan-balance-context-menu",e=[];switch(b){case"dispenser":e=[d+"-2",d+"-3",d+"-4"];break;case"left":e=[d+"-0",d+"-3",d+"-4"],c&&(e=[d+"-0",d+"-4"],a.hasClass("temporary-dropped")&&(e=[d+"-1",d+"-3",d+"-4"]));break;case"right":e=[d+"-1",d+"-3",d+"-4"],c&&(e=[d+"-1",d+"-3"],a.hasClass("temporary-dropped")&&(e=[d+"-0",d+"-3",d+"-4"]))}return e},isPanEmpty:function b(c){var d=this.$("."+c+"-pan-wrapper").find(".dynamic-container"),e=d.find("."+a.TILE_CLASS),b=!1;return 0===e.length&&(b=!0),b},getPanWeight:function(b){var c=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),d=c.find("."+a.TILE_CLASS),e=0,f=null,g=null;return d.each(function(){f=$(this);var a=1;f.data().isVarNegative&&(a=-1),f.hasClass("ui-draggable-dragging")||(g=f.data().value,e+=g*a)}),e},getTileCountInPan:function(b){var c=this.$("."+b+"-pan-wrapper").find(".dynamic-container"),d=c.find("."+a.TILE_CLASS);return d.length},getTileCountInTempBin:function(b){var c=this.$("."+b+"-temporary-bin"),d=c.find("."+a.TILE_CLASS);return d.length},_setTempBinAccText:function(a,b,c){var d=this,e="",f=null,g=null,h=null,i=d.getAccMessage("left",0),j=d.getAccMessage("right",0),k=d.getTileCountInTempBin("left"),l=d.getTileCountInTempBin("right");h=this._getCurrentSelectedDispenserTile(),h?(f=d.getAccMessage("temporary-trash-can",1,[i]),g=d.getAccMessage("temporary-trash-can",1,[j])):(f=k&&!b||b&&k>1?d.getAccMessage("temporary-trash-can",3,[i]):d.getAccMessage("temporary-trash-can",0,[i]),g=l&&!b||b&&l>1?d.getAccMessage("temporary-trash-can",3,[j]):d.getAccMessage("temporary-trash-can",0,[j])),b&&(e=d.getAccMessage("tile-delete-text",1,[b])),a&&(e=d.getAccMessage("temporary-trash-can",4,[a])),f=e+f,g=e+g,"left"===c?d.setAccMessage("-left-temporary-bin",f):"right"===c?d.setAccMessage("-right-temporary-bin",g):(d.setAccMessage("-left-temporary-bin",f),d.setAccMessage("-right-temporary-bin",g))},animateDynamicPan:function(){var a="LEFT",b=this.getPanWeight("left"),c=this.getPanWeight("right");c>b&&(a="RIGHT"),b===c&&(a="CENTER"),this.animatePanBalance(a)},clearPans:function(){this.$(".dynamic-wrapper").find("."+a.TILE_CLASS).remove(),this.$(".temporary-bins-container").find("."+a.TILE_CLASS).remove(),this._updateEquationForDynamicPanBalance(),this._setPanAccText(),this.animateDynamicPan()},getVariableCount:function(a){return this._getSpecificTypeTileCount(a,"Var")},getAbsoluteVariableCount:function(a){return this._getSpecificTypeTileCount(a,"Var",!0)},getConstantsCount:function(a){return this._getSpecificTypeTileCount(a,"Num")},getEquationCoefficients:function(a){return this._getEquation(a,!0)},modifyDispenser:function(b){var c=this.$(".dispenser-container").find("."+a.TILE_CLASS);c.remove(),this.renderDispenser(b)},getSaveState:function(){var a=this,b=null;return b={leftPan:a._getTileDataForPan("left"),rightPan:a._getTileDataForPan("right"),leftTemporaryBin:a._getTileDataForTemporaryBin("left"),rightTemporaryBin:a._getTileDataForTemporaryBin("right"),isDisabled:a._getIsDisabled()}},highlightTile:function(){},getEquationToModel:function(){return this.model.get("equationToModel")},setEquationToModel:function(a){this.model.set("equationToModel",a)},marqueeMovedOut:function(a){var b=a.length;this.marqueeMoveOut=!0;for(var c=0;b-1>c;c++)this._deleteOnRevertHandler(a[c]);this.marqueeMoveOut=!1,this._deleteOnRevertHandler(a[c]),this._removeMarqueeOnTileDrag()}},{LEFT_PAN_DROP:"left_pan_drop",RIGHT_PAN_DROP:"right_pan_drop",PAN_DROP:"pan_drop",TRASH_DROP:"trash_drop",DOUBLE_CLICK_TILE:"double_click_tile",TILE_DRAG:"tile_drag",TILE_FADEOUT:"tile_fadeout",MARQUEE_RESIZE:"pan_marquee_resize",MARQUEE_START:"pan_marquee_start",MARQUEE_DROP:"pan_marquee_drop",PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER:"pan-balance-draggable-tile-text-container",PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_LEFT_PART:"pan-balance-draggable-tile-text-container-left-part",PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_MIDDLE_PART:"pan-balance-draggable-tile-text-container-middle-part",PAN_BALANCE_DRAGGABLE_TILE_TEXT_CONTAINER_RIGHT_PART:"pan-balance-draggable-tile-text-container-right-part",PAN_BALANCE_DRAGGABLE_TILE_TEXT:"pan-balance-draggable-tile-text",PAN_BALANCE_DRAGGABLE_TILE_DOTS:"pan-balance-draggable-tile-dots",PAN_BALANCE_DRAGGABLE_TILE_LEFT_SHADOW:"pan-balance-draggable-tile-left-shadow",PAN_BALANCE_DRAGGABLE_TILE_RIGHT_SHADOW:"pan-balance-draggable-tile-right-shadow",PAN_BALANCE_DRAGGABLE_TILE_BOTTOM_SHADOW:"pan-balance-draggable-tile-bottom-shadow",TILE_CLASS:"pan-draggable-dispenser-tile",RED_TILE:"red-tile",GREEN_TILE:"green-tile",DISPENSER_TILE_CLICKED:"dispenser-tile-clicked",NEGATIVE_TILE_INDICATOR:"-",VARIABLE_LABEL:"x",CONSTANT_PADDING_VALUE:4,TILE_TYPE:{VAR:"Var",NUM:"Num"},MAX_ROWS:4,MAX_COLS:5,MAX_VARIABLE:4,MAX_CONSTANT:4,TILE_NOT_NULLIFIED:0,PAN_FULL:1,TILE_NULLIFIED:2,FADE_TILES_DURATION:17,BIN_CAPACITY:24,createPanBalance:function(a){var b;if(a){b="#"+a.containerId;var c=new MathInteractives.Common.Components.Models.PanBalanceStructured(a),d=new MathInteractives.Common.Components.Views.PanBalanceStructured({el:b,model:c});return d}},Position:{LEFT:0,CENTRE:1,RIGHT:2}}),MathInteractives.global.PanBalanceStructured=MathInteractives.Common.Components.Views.PanBalanceStructured,a=MathInteractives.Common.Components.Views.PanBalanceStructured}(),function(a){var b=null;a.Common.Components.Models.DragSelect=MathInteractives.Common.Player.Models.BaseInteractive.extend({defaults:function(){return{idPrefix:null,manager:null,filePath:null,player:null,marqueeContainer:null,selectorClass:null,ignoreClass:null,tolerance:.5,zIndex:10,marqueeDefaultOffset:{top:0,left:0},itemsDefaultOffset:{top:0,left:0},isForCanvas:!1,paperObjects:[],padding:5}}},{MARQUEE_STYLE_DRAGGING:{outline:"rgb(141, 141, 141) dashed 1px","background-color":"rgba(206, 206, 206, 0.4)"},MARQUEE_STYLE_AFTER_RELEASE:{outline:"rgb(141, 141, 141) dashed 1px","background-color":"rgb(206, 206, 206)"}}),b=a.Common.Components.Models.DragSelect}(MathInteractives),function(a){"use strict";var b=null;a.Common.Components.Views.DragSelect=MathInteractives.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,$marqueeContainer:null,namespace:null,$marqueeDiv:null,_marqueeOriginalPosition:null,initialize:function(){var a=this.model,b=a.get("marqueeContainer"),c=null;this.idPrefix=a.get("idPrefix"),this.manager=a.get("manager"),this.filePath=a.get("filePath"),c="string"==typeof b?this.$(b):b,this.marqueeContainerSelector=""===c[0].id?Math.random().toPrecision(1):c[0].id,this.namespace=this.idPrefix+this.marqueeContainerSelector,this.$marqueeContainer=c,this.$marqueeDiv=this.createMarqueeDiv(),this._attachListenersOnMarqueeContainment()},createMarqueeDiv:function(){var b=this.namespace,c=this.$marqueeContainer,d=this.model.get("zIndex"),e=$("<div>",{"class":b+"marquee-div marquee-div"});return e.css({position:"absolute","z-index":d}),e.css(a.Common.Components.Models.DragSelect.MARQUEE_STYLE_DRAGGING),c.append(e),e},_attachListenersOnMarqueeContainment:function(){var a=this,b=MathInteractives.Common.Utilities.Models.Utils,c=this.namespace,d=this.$marqueeDiv,e=this.$marqueeContainer;MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;e.off("mousedown."+c).on("mousedown."+c,function(b){a.marqueeMouseDownHandler(b)}),d.off("mousedown."+c).on("mousedown."+c,function(b){a.marqueeMouseDownHandler(b)}),e.off("mouseup."+c).on("mouseup."+c,function(b){var c;c=a.model.get("isForCanvas")?a.marqueeCanvasMouseUpHandler(b,!0):a.marqueeMouseUpHandler(b,!0,!1)}),d.off("mouseup."+c).on("mouseup."+c,function(b){var c;c=a.model.get("isForCanvas")?a.marqueeCanvasMouseUpHandler(b,!0):a.marqueeMouseUpHandler(b,!0,!1)}),b.EnableTouch(d,{specificEvents:b.SpecificEvents.MOUSEMOVE|b.SpecificEvents.STOP_PROPAGATION}),b.EnableTouch(e,{specificEvents:b.SpecificEvents.MOUSEMOVE|b.SpecificEvents.STOP_PROPAGATION})},_detachListenersOnMarqueeContainment:function(){var a=this.namespace,b=null,c=null;b=this.$marqueeDiv,c=this.$marqueeContainer,c.off("mousedown."+a),b.off("mousedown."+a),c.off("mouseup."+a),b.off("mouseup."+a),c.off("touchstart."+a),b.off("touchstart."+a),c.off("touchend."+a),b.off("touchend."+a)},_getPoint:function(a){var b={x:a.pageX,y:a.pageY};return b},marqueeMouseDownHandler:function(a){var c,d,e=this.namespace,f=this;MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile;if(!$(a.target).hasClass("selected-elements-cover")){for(c=this.$marqueeDiv,this.collapseMarquee();c[0].hasChildNodes();)c[0].removeChild(c[0].lastChild);c.show(),d=this.$marqueeContainer,this.dragging=!0,this.startPoint=this._getPoint(a),d.on("mousemove."+e,function(a){f.marqueeMouseMoveHandler(a)}),c.on("mousemove."+e,function(a){f.marqueeMouseMoveHandler(a)}),$(document).off("mouseup."+e).on("mouseup."+e,function(a){var b;b=f.model.get("isForCanvas")?f.marqueeCanvasMouseUpHandler(a,!0):f.marqueeMouseUpHandler(a,!0,!1)}),f.trigger(b.EVENTS.start,b.createCustomEventObject(a))}},marqueeMouseMoveHandler:function(c){var d,e,f,g,h,i=(this.idPrefix,this._getPoint(c)),j=i.x,k=i.y,l=this.startPoint,m=l.x,n=l.y,o=Math.abs(j-m),p=Math.abs(k-n);d=this.$marqueeDiv,g=this.$marqueeContainer,h=g.offset(),f=m>j?m-o:m,e=n>k?n-p:n,d.css({width:Math.round(o),height:Math.round(p),top:Math.round(e-h.top)+1+"px",left:Math.round(f-h.left)+1+"px"}),d.css(a.Common.Components.Models.DragSelect.MARQUEE_STYLE_DRAGGING),this.trigger(b.EVENTS.move,b.createCustomEventObject(c))},marqueeMouseUpHandler:function(a,c,d){if((d||this.dragging)&&!this.model.get("isForCanvas")){var e=this.namespace,f=this.$marqueeContainer,g=f.offset(),h=this.$marqueeDiv;this.dragging&&(f.off("mousemove."+e),f.off("mousemove"),h.off("mousemove."+e),h.off("mousemove"),this.dragging=!1,$(document).off("mouseup."+e));var i=this,j=[],e=this.namespace,k=i.model.get("selectorClass"),l=i.model.get("ignoreClass"),m=i.model.get("tolerance"),n="string"==typeof k?$("."+k):k,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w={top:0,left:0,height:0,width:0},x=!0,y=null;n.each(function(a){o=$(this),o.hasClass(l)||(p=o.offset(),q=p.top,r=p.left,s=o.outerHeight(),t=o.outerWidth(),u={top:q,left:r,height:s,width:t},v=i._checkIsInsideMarquee(u,m),o.data().isInsideMarquee=v,x&&v?(w.top=q,w.left=r,w.height=s,w.width=t,x=!1,j.push(o)):v&&(j.push(o),w=i._adjustMarqueeBounds(w,u)))}),w.top=w.top-g.top,w.left=w.left-g.left;var z=this._getMarqueeData();return c&&i.trigger(b.EVENTS.end,b.createCustomEventObject(a,j,{marqueeData:z})),y=i._resizeMarquee(w,j,c),d?y:void 0}},marqueeCanvasMouseUpHandler:function(a,c,d){if(d||this.dragging){var e=this.namespace,f=this.$marqueeContainer,g=f.offset(),h=this.$marqueeDiv;this.dragging&&(f.off("mousemove."+e),h.off("mousemove."+e),this.dragging=!1);for(var i=this,j=this.model,k=j.get("paperObjects"),l=k.length,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=j.get("tolerance"),u=j.get("itemsDefaultOffset"),v={top:0,left:0,height:0,width:0},w=!0,x=null,y=[],z=0;l>z;z++)x=k[z],r=x.bounds,m=g.top+r.y+u.top,n=g.left+r.x+u.left,o=r.height,p=r.width,q={top:m,left:n,height:o,width:p},s=i._checkIsInsideMarquee(q,t),w&&s?(v.top=m,v.left=n,v.height=o,v.width=p,w=!1,y.push(x)):s&&(v=i._adjustMarqueeBounds(v,q),y.push(x));v.top=v.top-g.top,v.left=v.left-g.left;var A=this._getMarqueeData();c&&i.trigger(b.EVENTS.end,b.createCustomEventObject(a,y,{marqueeData:A}));var B=i._resizeMarquee(v,y,c);return d?B:void 0}},_getMarqueeData:function(){var a=this.$marqueeDiv,b={height:a.outerHeight(),width:a.outerWidth(),position:a.position(),offset:a.offset()};return b},_adjustMarqueeBounds:function(a,b){var c=b.top,d=b.left,e=b.height,f=b.width;return c>=a.top&&d>=a.left?(a.height=c+e>a.top+a.height?c+e-a.top:a.height,a.width=d+f>a.left+a.width?d+f-a.left:a.width):(c<=a.top&&d<=a.left&&(a.height=a.top+a.height-c,a.width=a.left+a.width-d,a.top=c,a.left=d),c>=a.top&&d<=a.left&&(a.height=a.top+a.height<c+e?c+e-a.top:a.height,a.width=a.left+a.width-d,a.left=d),c<=a.top&&d>=a.left&&(a.height=a.top+a.height-c,a.width=a.left+a.width<d+f?d+f-a.left:a.width,a.top=c)),a},_checkIsInsideMarquee:function(a,b){if(a){var c=!1,b=b,d=this.$marqueeDiv,e=d.offset(),f=e.top,g=e.left,h=d.outerHeight(),i=d.outerWidth(),j=e.top+h,k=e.left+i,l=a.top,m=a.left,n=a.height,o=a.width,p=n*o,q=l+n,r=m+o,s=0,t=0,u={height:0,width:0},v=0;return s=Math.max(Math.min(j,q)-Math.max(f,l),0),t=Math.max(Math.min(k,r)-Math.max(g,m),0),u.height=s,u.width=t,v=u.height*u.width,r>g&&k>m&&q>f&&j>l&&v/p>b&&(c=!0),c}},_resizeMarquee:function(a,c,d){if(a){var e=this,f=null,g=this.$marqueeDiv,h=this.model.get("padding"),i=this.model.get("marqueeDefaultOffset"),j=null;g.css({top:Math.round(a.top-h+i.top),left:Math.round(a.left-h+i.left),height:Math.round(a.height?a.height+2*h:1),width:Math.round(a.width?a.width+2*h:1)}),(1===a.height||1===a.width)&&g.css({outline:"none"});var k=this._getMarqueeData(),l=[],j=null,m=null;if(!this.model.get("isForCanvas")){m=c.length;for(var n=0;m>n;n++)l.push(this._getElementData(c[n]))}j=b.createCustomEventObject(f,c,{marqueeData:k,elementPositions:l}),d&&e.trigger(b.EVENTS.resize,j)}return j},_getElementData:function(a){var b=a.offset(),c=this.$marqueeDiv.offset(),d={relativeTop:b.top-c.top,relativeLeft:b.left-c.left};return d},disableMarquee:function(){this.hideMarquee(),this._detachListenersOnMarqueeContainment()},enableMarquee:function(){this.showMarquee(),this._attachListenersOnMarqueeContainment()},hideMarquee:function(){this.$marqueeDiv.hide()},showMarquee:function(){this.$marqueeDiv.show()},collapseMarquee:function(){this._resizeMarquee({top:0,left:0,width:0,height:0},!1)},customFitMarqueeToBounds:function(a,b){return this._resizeMarquee(a,b,!1),this.model.get("isForCanvas")?this.marqueeCanvasMouseUpHandler(null,null,!0):this.marqueeMouseUpHandler(null,null,!0)},updatePaperObjects:function(a){this.model.set("paperObjects",a)},groupSelectedElements:function(b){var c=this.$marqueeDiv,d=$("<div/>");c.append(b),c.append(d),d.attr("class","selected-elements-cover").css({position:"absolute",height:c.outerHeight(),width:c.outerWidth(),top:0,left:0,"z-index":2,cursor:function(){return MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?"none":"pointer"}}),c.css(a.Common.Components.Models.DragSelect.MARQUEE_STYLE_AFTER_RELEASE)},makeGroupDraggable:function(){var a=this;this.$marqueeDiv.draggable({containment:this.$marqueeContainer,start:function(b,c){a._marqueeOriginalPosition=$(this).offset()}})},breakGroup:function(){for(var a=this.$marqueeDiv[0];a.hasChildNodes();)a.removeChild(a.lastChild)},getOriginalOffset:function(){return this._marqueeOriginalPosition}},{createMarquee:function(a){if(a){var b=MathInteractives.Common.Components,c=new b.Models.DragSelect(a),d=new b.Views.DragSelect({model:c,el:a.player.$el});return d}},EVENTS:{resize:"marquee-resize",move:"marquee-move",start:"marquee-select-start",end:"marquee-end"},createCustomEventObject:function(a,b,c){return{originalEvent:a,selectedItems:b,optionalParams:c}}}),b=a.Common.Components.Views.DragSelect,a.global.Marquee=b}(MathInteractives),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.panBalance=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div class="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'pan-balance-wrapper pan-balance-wrapper-main">\r\n\r\n    <div class="pan-wrapper left-pan-wrapper">\r\n        <div class="left-tile-container tile-container">\r\n            <div class="static-container"></div>\r\n            <div class="dynamic-container">\r\n                <div class="dynamic-wrapper" data-pos="left"></div>\r\n            </div>\r\n        </div>\r\n        <div class="pan left-pan">\r\n            <div class="pan-data typography-label">\r\n                <span class="pan-label"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="pan-wrapper right-pan-wrapper">\r\n        <div class="right-tile-container tile-container">\r\n            <div class="static-container"></div>\r\n            <div class="dynamic-container">\r\n            <div class="dynamic-wrapper" data-pos="right"></div>\r\n            </div>\r\n        </div>\r\n        <div class="pan right-pan">\r\n            <div class="pan-data typography-label">\r\n                <span class="pan-label"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="dispenser-container">\r\n        <div class="dispenser-wrapper">\r\n            <div class="dispenser-row-1"></div>\r\n            <div class="dispenser-row-2"></div>\r\n        </div>\r\n    </div>\r\n\r\n    \r\n    <div class="center-rod"></div>\r\n    <div class="base"></div>\r\n    <div class="small-rod left-small-rod"></div>\r\n    <div class="small-rod right-small-rod"></div>\r\n\r\n</div>\r\n'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.panBalanceStructured=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div class="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'pan-balance-structured-wrapper pan-balance-structured-wrapper-main">\r\n\r\n    <div class="pan-wrapper left-pan-wrapper">\r\n        <div class="left-tile-container tile-container">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-static-container" class="static-container"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-dynamic-container" class="dynamic-container">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-accessibility-dynamic-wrapper" class="accessibility-dynamic-wrapper" data-pos="left"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-dynamic-wrapper" class="dynamic-wrapper" data-pos="left"></div>\r\n            </div>\r\n        </div>\r\n        <div class="pan left-pan">\r\n            <div class="pan-data typography-label">\r\n                <span class="pan-label"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="pan-wrapper right-pan-wrapper">\r\n        <div class="right-tile-container tile-container">\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-static-container" class="static-container"></div>\r\n            <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-dynamic-container" class="dynamic-container">\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-accessibility-dynamic-wrapper" class="accessibility-dynamic-wrapper" data-pos="right"></div>\r\n                <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-dynamic-wrapper" class="dynamic-wrapper" data-pos="right"></div>\r\n            </div>\r\n        </div>\r\n        <div class="pan right-pan">\r\n            <div class="pan-data typography-label">\r\n                <span class="pan-label"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="dispenser-container" id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-dispenser-container">\r\n        <div class="dispenser-wrapper">\r\n            <div class="dispenser-row-1"></div>\r\n            <div class="dispenser-row-2"></div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n    <div class="center-rod"></div>\r\n    <div class="base"></div>\r\n    <div class="small-rod left-small-rod"></div>\r\n    <div class="small-rod right-small-rod"></div>\r\n\r\n    <div class="temporary-bins-container">\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-accessibility-temporary-bin" class="accessibility-temporary-bin" data-pos="left"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-left-temporary-bin" class="left-temporary-bin temporary-bin" data-pos="left"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-accessibility-temporary-bin" class="right-accessibility-temporary-bin accessibility-temporary-bin" data-pos="right"></div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-right-temporary-bin" class="right-temporary-bin temporary-bin" data-pos="right"></div>\r\n    </div>\r\n</div>\r\n'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.panBalanceDraggableTile=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div class="pan-balance-draggable-tile-wrapper">\r\n    <div class="pan-balance-draggable-tile-top-container">\r\n        <div class="pan-balance-draggable-tile-left-shadow shadow">\r\n        </div>\r\n        <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-draggable-tile-text-container" class="pan-balance-draggable-tile-text-container">\r\n            <div class="pan-balance-draggable-tile-text-container-left-part">\r\n            </div>\r\n            <div class="pan-balance-draggable-tile-text-container-middle-part">\r\n                <div class="pan-balance-draggable-tile-text">\r\n                </div>\r\n                <div class="pan-balance-draggable-tile-dots">\r\n                </div>\r\n            </div>\r\n            <div class="pan-balance-draggable-tile-text-container-right-part">\r\n            </div>\r\n        </div>\r\n        <div class="pan-balance-draggable-tile-right-shadow shadow">\r\n        </div>\r\n    </div>\r\n    <div class="pan-balance-draggable-tile-bottom-shadow shadow">\r\n    </div>\r\n</div>\r\n'})}();