!function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraph.GridGraphModel=Backbone.Model.extend({defaults:{_points:null,_plots:null,_images:null,circleDrag:null,positionBox:null,xCoOrdinateBase:null,xCoOrdinatePower:null,yCoOrdinatePower:null,yCoOrdinateBase:null,coOrdinateSeparator:null,path:null,markerBounds:null,_graphDisplayValues:null},initialize:function(){var a,b=this.attributes;b._points=[],b._plots=[],b._images=[],b.markerBounds={max:{x:null,y:null,"\\theta":null},min:{x:null,y:null,"\\theta":null}},b._graphDisplayValues={_graphDisplay:null,_graphsAxisLimits:null,_graphOrigin:null,_graphParameters:null,_zoomingFactor:null,_graphLimitTextBoxDomElement:null,_symbols:null},a=b._graphDisplayValues,a._graphDisplay={isCartesionCurrentGraphType:!0,isLabelShown:!0,isGridLineShown:!0,isAxisLinesShown:!0,isProjectorModeOn:!1,isXmarkerInRadians:!1,isYmarkerInRadians:!1,isPolarAngleInRadian:!0},a._graphsAxisLimits={defaultLimits:{xLower:null,xUpper:null,yLower:null,yUpper:null},currentLimits:{xLower:null,xUpper:null,yLower:null,yUpper:null},isXLastChangedLimit:null},a._graphOrigin={currentOrigin:null,defaultOrigin:null,doubleClickedPoint:null,isOriginPositionChanged:null},a._graphParameters={graphGridLine:null,yGridLine:null,xGridLine:null,totalVerticalLines:null,distanceBetweenTwoVerticalLines:null,totalHorizontalLines:null,distanceBetweenTwoHorizontalLines:null},a._zoomingFactor={previousZoomAngle:null,zoomLevel:null,zoomFactorForGraphParameterModification:null,xZoomFactorForGraphParameterModification:null,yZoomFactorForGraphParameterModification:null,doubleClickZoomAllow:!0,xCurrentFactor:null,yCurrentFactor:null,xZoomMultiplier:null,yZoomMultiplier:null,xTotalMultiplier:null,yTotalMultiplier:null},a._graphLimitTextBoxDomElement={xLower:null,xUpper:null,yLower:null,yUpper:null},a._symbols={xAxis:null,yAxis:null,xMarkerLines:null,yMarkerLines:null,xInnerGridLines:null,yInnerGridLines:null}},setModelAttribute:function(a){var b=this.attributes;b._points=[],b._plots=[],b.markerBounds=a.markerBounds,b._graphDisplayValues._graphDisplay=a.graphDisplay,b._graphDisplayValues._graphsAxisLimits.currentLimits.xLower=a.currentLimits.xLower,b._graphDisplayValues._graphsAxisLimits.currentLimits.xUpper=a.currentLimits.xUpper,b._graphDisplayValues._graphsAxisLimits.currentLimits.yLower=a.currentLimits.yLower,b._graphDisplayValues._graphsAxisLimits.currentLimits.yUpper=a.currentLimits.yUpper,b.markerBounds.max.x=a.currentLimits.xUpper,b.markerBounds.max.y=a.currentLimits.yUpper,b.markerBounds.min.x=a.currentLimits.xLower,b.markerBounds.min.y=a.currentLimits.yLower,b._graphDisplayValues._graphOrigin.currentOrigin.x=a.graphOrigin.currentOrigin.x,b._graphDisplayValues._graphOrigin.currentOrigin.y=a.graphOrigin.currentOrigin.y,b._graphDisplayValues._graphOrigin.isOriginPositionChanged=a.graphOrigin.isOriginPositionChanged,b._graphDisplayValues._graphParameters=a.graphParameters,b._graphDisplayValues._zoomingFactor=a.zoomingFactor}},{})}(window.MathInteractives),function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.MathFunctions=Backbone.Model.extend({},{checkIfNotADecimalNumber:function(a){return"number"==typeof a&&a%1===0},performMathematicalCalculations:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(void 0===b||void 0===c)return null;switch(e=NaN,f=c.length,g=0,h=null,h=void 0!==d&&"rad"===d.angle?1:0,b){case"+":for(e=0,g;f>g;g++){if(l=c[g],"number"!=typeof l){e=NaN;break}e+=l}break;case"-":if("number"!=typeof c[0])break;for(e=c[0],g=1;f>g;g++){if(l=c[g],"number"!=typeof l){e=NaN;break}e-=l}break;case"^":case"pow":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(0===c[0]&&0===c[1])break;if(!r.MathFunctions.checkIfNotADecimalNumber(c[1])){if(q=1/c[1],o=Math.abs(c[0]),p=c[0]>=0?1:-1,q%2===0&&-1===p)break;e=p*Math.pow(o,c[1]);break}e=Math.pow(c[0],c[1]);break;case"*":case"\\cdot":for(e=1,g;f>g;g++){if(l=c[g],"number"!=typeof l){e=NaN;break}e*=l}break;case"/":case"\\frac":if("number"!=typeof c[0]||"number"!=typeof c[1])break;e=c[0]/c[1];break;case"\\sqrt":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(0===c[0]||c[0]%2===0&&c[1]<0)break;if(0===c[0]){e=0;break}e=c[0]<0?1/Math.pow(Math.abs(c[1]),1/(-1*c[0])):Math.pow(Math.abs(c[1]),1/c[0]),c[1]<0&&(e=-e);break;case"\\ln":if("number"!=typeof c[0])break;e=Math.log(c[0]);break;case"\\log":if("number"!=typeof c[0])break;e=Math.log(c[0])/Math.LN10;break;case"\\log_":if("number"!=typeof c[0]||"number"!=typeof c[1])break;e=Math.log(c[1])/Math.log(c[0]);break;case"\\sin":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=Math.sin(k);break}e=Math.sin(c[0]);break;case"\\cos":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=Math.cos(k);break}e=Math.cos(c[0]);break;case"\\tan":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\sin",c,d)/r.MathFunctions.performMathematicalCalculations("\\cos",c,d);break;case"\\sec":if("number"!=typeof c[0])break;e=1/r.MathFunctions.performMathematicalCalculations("\\cos",c,d);break;case"\\csc":if("number"!=typeof c[0])break;e=1/r.MathFunctions.performMathematicalCalculations("\\sin",c,d);break;case"\\cot":if("number"!=typeof c[0])break;e=1/r.MathFunctions.performMathematicalCalculations("\\tan",c,d);break;case"\\arcsin":if("number"!=typeof c[0])break;e=Math.asin(c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arccos":if("number"!=typeof c[0])break;e=Math.acos(c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arctan":if("number"!=typeof c[0])break;e=Math.atan(c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arccsc":if("number"!=typeof c[0])break;e=Math.asin(1/c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arcsec":if("number"!=typeof c[0])break;e=Math.acos(1/c[0]),0===h&&(e=180*e/Math.PI);break;case"\\arccot":if("number"!=typeof c[0])break;e=Math.PI/2-Math.atan(c[0]),0===h&&(e=180*e/Math.PI);break;case"\\sinh":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=(Math.pow(Math.E,k)-Math.pow(Math.E,-k))/2;break}e=(Math.pow(Math.E,c[0])-Math.pow(Math.E,-c[0]))/2;break;case"\\cosh":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=(Math.pow(Math.E,k)+Math.pow(Math.E,-k))/2;break}e=(Math.pow(Math.E,c[0])+Math.pow(Math.E,-c[0]))/2;break;case"\\tanh":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=(Math.pow(Math.E,2*k)-1)/(Math.pow(Math.E,2*k)+1);break}e=(Math.pow(Math.E,2*c[0])-1)/(Math.pow(Math.E,2*c[0])+1);break;case"\\csch":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=2/(Math.pow(Math.E,k)-Math.pow(Math.E,-k));break}e=2/(Math.pow(Math.E,c[0])-Math.pow(Math.E,-c[0]));break;case"\\sech":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=2/(Math.pow(Math.E,k)+Math.pow(Math.E,-k));break}e=2/(Math.pow(Math.E,c[0])+Math.pow(Math.E,-c[0]));break;case"\\coth":if("number"!=typeof c[0])break;if(0===h){k=c[0]*Math.PI/180,e=(Math.pow(Math.E,2*k)+1)/(Math.pow(Math.E,2*k)-1);break}e=(Math.pow(Math.E,2*c[0])+1)/(Math.pow(Math.E,2*c[0])-1);break;case"\\arsinh":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\sqrt",[2,r.MathFunctions.performMathematicalCalculations("^",[c[0],2],d)+1],d),e=r.MathFunctions.performMathematicalCalculations("\\ln",[c[0]+e],d),0===h&&(e=180*e/Math.PI);break;case"\\arcosh":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\sqrt",[2,r.MathFunctions.performMathematicalCalculations("^",[c[0],2],d)-1],d),e=r.MathFunctions.performMathematicalCalculations("\\ln",[c[0]+e],d),0===h&&(e=180*e/Math.PI);break;case"\\artanh":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\frac",[1+c[0],1-c[0]],d),e=.5*r.MathFunctions.performMathematicalCalculations("\\ln",[e],d),0===h&&(e=180*e/Math.PI);break;case"\\arcsch":if("number"!=typeof c[0])break;e=1/c[0]+r.MathFunctions.performMathematicalCalculations("\\sqrt",[2,1/r.MathFunctions.performMathematicalCalculations("^",[c[0],2],d)+1],d),e=r.MathFunctions.performMathematicalCalculations("\\ln",[e],d),0===h&&(e=180*e/Math.PI);break;case"\\arsech":if("number"!=typeof c[0])break;e=1/c[0]+r.MathFunctions.performMathematicalCalculations("\\sqrt",[2,1/r.MathFunctions.performMathematicalCalculations("^",[c[0],2],d)-1],d),e=r.MathFunctions.performMathematicalCalculations("\\ln",[e],d),0===h&&(e=180*e/Math.PI);break;case"\\arcoth":if("number"!=typeof c[0])break;e=r.MathFunctions.performMathematicalCalculations("\\frac",[c[0]+1,c[0]-1],d),e=.5*r.MathFunctions.performMathematicalCalculations("\\ln",[e],d),0===h&&(e=180*e/Math.PI);break;case"!":if("number"!=typeof c[0]||c[0]<0)break;if(c[0]>170||!isFinite(c[0])){e=1/0;break}if(0===c[0]){e=1;break}e=r.MathFunctions.checkIfNotADecimalNumber(c[0])&&c[0]>0?r.MathFunctions.findFactorial(c[0]):c[0]*r.MathFunctions._gammaFunction(c[0]);break;case"\\%":if(1===c.length){if("number"!=typeof c[0]){e=NaN;break}e=c[0]/100}else{if("number"!=typeof c[0]||"number"!=typeof c[1]){e=NaN;break}e=c[1]*(c[0]/100)}break;case"\\gcd":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(c[0]=Math.floor(Math.abs(c[0])),c[1]=Math.floor(Math.abs(c[1])),0===c[0]){e=c[1],0===c[1]&&(e=0);break}if(0===c[1]){e=c[0];break}e=r.MathFunctions._calculateGcd(c[0],c[1]);break;case"\\lcm":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(c[0]=Math.floor(Math.abs(c[0])),c[1]=Math.floor(Math.abs(c[1])),0===c[0]){if(0===c[1]){e=NaN;break}e=0;break}if(0===c[1]){e=0;break}e=c[0]*c[1]/r.MathFunctions._calculateGcd(c[0],c[1]);break;case"\\ceil":if("number"!=typeof c[0])break;e=Math.ceil(c[0]);break;case"\\floor":if("number"!=typeof c[0])break;e=Math.floor(c[0]);break;case"\\round":if("number"!=typeof c[0])break;e=Math.round(c[0]);break;case"\\abs":if("number"!=typeof c[0])break;e=Math.abs(c[0]);break;case"\\min":if("number"!=typeof c[0]||"number"!=typeof c[1])break;e=Math.min(c[0],c[1]);break;case"\\max":if("number"!=typeof c[0]||"number"!=typeof c[1])break;e=Math.max(c[0],c[1]);break;case"\\mod":if(e=NaN,"number"!=typeof c[0]||"number"!=typeof c[1]||0===c[1])break;if(c[0]%c[1]===0){e=0;break}if(c[0]>0&&c[1]>0||c[0]<0&&c[1]<0){e=c[0]%c[1];break}if(c[0]<0&&c[1]>0||c[0]>0&&c[1]<0){e=c[1]+c[0]%c[1];break}break;case"\\nCr":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(c[0]<0||c[1]<0){e=0;break}if(c[0]=Math.floor(Math.abs(c[0])),c[1]=Math.floor(Math.abs(c[1])),c[0]<c[1]){e=0;break}e=r.MathFunctions.findFactorial(c[0])/(r.MathFunctions.findFactorial(c[1])*r.MathFunctions.findFactorial(c[0]-c[1]));break;case"\\nPr":if("number"!=typeof c[0]||"number"!=typeof c[1])break;if(c[0]<0||c[1]<0){e=0;break}if(c[0]=Math.floor(Math.abs(c[0])),c[1]=Math.floor(Math.abs(c[1])),c[0]<c[1]){e=0;break}e=r.MathFunctions.findFactorial(c[0])/r.MathFunctions.findFactorial(c[0]-c[1]);break;case"\\prod_":if("number"!=typeof c[1]||"number"!=typeof c[2])break;if(c[1]>c[2]){e=1;break}if(0===c[3]){e=0;break}if(i=Math.round(c[2])-Math.round(c[1])+1,j=1,"number"==typeof c[3])for(var s=Math.round(c[1]);s<=Math.round(c[2]);s++)j*=c[3];else for(var s=Math.round(c[1]);s<=Math.round(c[2]);s++)j*=c[3];for(;0!==i;)j*=c[3],i--;e=j;break;case"\\sum_":if("number"!=typeof c[1]||"number"!=typeof c[2])break;if(c[1]>c[2]||0===c[3]){e=0;break}for(m=Math.round(c[1])-Math.round(c[0])+1,n=0;0!==m;)n+=c[2],m--;e=n;break;case"\\exp":if("number"!=typeof c[0])break;e=Math.exp(c[0])}return e=r.MathFunctions._processResultForTrignometricFunctions(b,e)},getGUID:function(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(a()+a()+"-"+a()+"-4"+a().substr(0,3)+"-"+a()+"-"+a()+a()+a()).toLowerCase()},findFactorialString:"function findFactorial(number) {            var factorial = 1,                input_value;    if (number === 0 || number === 1) {        return factorial;    }    input_value = number;    while (input_value !== 1) {        factorial = factorial * input_value;        input_value--;    }    return factorial;};",findFactorial:function(a){var b,c=1;if(0===a||1===a)return c;for(b=a;1!==b;)c*=b,b--;return c},_calculateGcd:function(b,c){var d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return c?d.MathFunctions._calculateGcd(c,b%c):b},whileInOneLine:function(a,b,c,d){var c=a+"while("+b+"){"+c+"} return "+d,e=new Function("",c);return e()},_gammaFunctionString:"function gammaFunction(value) { var gammaCounter,gammaSum,gamma,arbitaryCounter = 7,gammaArray = [0.99999999999980993, 676.5203681218851, -1259.1392167224028, 771.32342877765313, -176.61502916214059, 12.507343278686905,-0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];    if (value < 0.5) {        return Math.PI / (Math.sin(Math.PI * value) * gammaFunction(1 - value));    }    else {        value -= 1;        gamma = gammaArray[0];        for (gammaCounter = 1; gammaCounter < arbitaryCounter + 2; gammaCounter++) {            gamma += gammaArray[gammaCounter] / (value + gammaCounter);        }        gammaSum = value + arbitaryCounter + 0.5;        return Math.sqrt(2 * Math.PI) * Math.pow(gammaSum, (value + 0.5)) * Math.exp(-gammaSum) * gamma;    }};",_gammaFunction:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,g=7,h=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];if(.5>b)return Math.PI/(Math.sin(Math.PI*b)*f.MathFunctions._gammaFunction(1-b));for(b-=1,e=h[0],c=1;g+2>c;c++)e+=h[c]/(b+c);return d=b+g+.5,Math.sqrt(2*Math.PI)*Math.pow(d,b+.5)*Math.exp(-d)*e},getSumString:function(){return"function sum(pivot, start, end, expression, param, constants) {var findFactorialString = '"+a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.MathFunctions.findFactorialString+"';var gammaFunctionString='"+a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.MathFunctions._gammaFunctionString+"'; function addStringFunctionDependency(functionCode) {            if (functionCode.search('findFactorial') > -1) {                functionCode = findFactorialString + functionCode;            }    if (functionCode.search('gammaFunction') > -1) {        functionCode = gammaFunctionString + functionCode;    }  return functionCode;}; start = addStringFunctionDependency(start) + '; return ' +start;            end = addStringFunctionDependency(end) + '; return ' + end;    expression = addStringFunctionDependency(expression) + '; return ' + expression;    var funcStartRange = new Function('param,constants', start);            var funcEndRange = new Function('param,constants', end);            var funcExpression = new Function(pivot+',param,constants', expression);            var startValue = funcStartRange(param, constants);            var endValue = funcEndRange(param, constants);           var result = 0;    if (!isFinite(startValue) || !isFinite(endValue)) {            return;        }        for(i = startValue;i<=endValue;i+= 1){                result +=funcExpression(i,param, constants);                if (!isFinite(result)) {                    return;                }            }         return result;        };"},getProdString:function(){return"function prod(pivot, start, end, expression, param, constants) {var findFactorialString = '"+a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.MathFunctions.findFactorialString+"';var gammaFunctionString='"+a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.MathFunctions._gammaFunctionString+"'; function addStringFunctionDependency(functionCode) {            if (functionCode.search('findFactorial') > -1) {                functionCode = findFactorialString + functionCode;            }    if (functionCode.search('gammaFunction') > -1) {        functionCode = gammaFunctionString + functionCode;    }  return functionCode;}; start = addStringFunctionDependency(start) + '; return ' +start;            end = addStringFunctionDependency(end) + '; return ' + end;    expression = addStringFunctionDependency(expression) + '; return ' + expression;  var funcStartRange = new Function('param,constants', start);            var funcEndRange = new Function('param,constants', end);            var funcExpression = new Function(pivot+',param,constants', expression);            var startValue = funcStartRange(param, constants);            var endValue = funcEndRange(param, constants);           var result = 1;   if (!isFinite(startValue) || !isFinite(endValue)) {            return;        }         for(i = startValue;i<=endValue;i+= 1){                result *=funcExpression(i,param, constants);                if (!isFinite(result)) {                    return;                }            }         return result;        };"},addStringFunctionDependency:function(a){return a.search("findFactorial")>-1&&(a=nameSpace.MathFunctions.findFactorialString+a),a.search("gammaFunction")>-1&&(a=nameSpace.MathFunctions._gammaFunctionString+a),a},sumProductPrototype:function(a,b,c,d,e,f){b=nameSpace.MathFunctions.addStringFunctionDependency(b)+"return "+b,c=nameSpace.MathFunctions.addStringFunctionDependency(c)+"return "+c,d=nameSpace.MathFunctions.addStringFunctionDependency(d)+"return "+d;var g=new Function("param,constants",b),h=new Function("param,constants",c),j=new Function(a+",param,constants",d),k=g(e,f),l=h(e,f),m=0;if(isFinite(k)&&isFinite(l)){for(i=k;i<l;i+=1)if(m+=j(i,e,f),!isFinite(m))return;return m}},decToFrac:function(a,b){},_processResultForTrignometricFunctions:function(a,b){var c=["\\sin","\\cos","\\tan","\\cot","\\sec","\\csc","\\sinh","\\cosh","\\tanh","\\coth","\\sech","\\csch"];return-1!==c.indexOf(a)&&(isNaN(b)||(b=Number(b.toFixed(10)))),b}})}(window.MathInteractives),function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Productions=Backbone.Model.extend({},{_terminalProductions:null,_nonTerminalProductions:null,productionTable:null,productionRules:null,_seperatedTokens:null,treeGenerationRules:null,_nonTerminalRules:null,_operatorsInPrecedenceOrder:null,_terminalRules:null,init:function(){null===a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Productions.productionRules&&a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Productions._populateProductionData()},getMaximumParameters:function(a){switch(a){case"^":case"\\log_":case"\\sqrt":case"\\gcd":case"\\lcm":case"\\min":case"\\max":case"\\mod":case"\\nCr":case"\\nPr":case"\\frac":return 2;case"+":case"-":case"\\cdot":case".":return 1/0;case"!":case"\\%":case"\\sin":case"\\cos":case"\\tan":case"\\csc":case"\\sec":case"\\cot":case"\\sinh":case"\\cosh":case"\\tanh":case"\\arcsin":case"\\arccos":case"\\arctan":case"\\log":case"\\ln":case"\\ceil":case"\\floor":case"\\round":case"\\abs":case"\\exp":case"do":return 1;case"\\sum":case"\\prod":return 4}},_populateProductionData:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;for(n.Productions._terminalProductions=["\\frac","(","[","var","const","digit","\\theta","{","\\sin","\\cos","\\tan","\\csc","\\sec","\\cot","\\arcsin","\\arccos","\\arctan","\\arccsc","\\arcsec","\\arccot","\\sinh","\\cosh","\\tanh","\\csch","\\sech","\\coth","\\log_","\\ln","\\log","\\sqrt","\\gcd","\\lcm","\\ceil","\\floor","\\round","\\abs","\\min","\\max","\\mod","\\nPr","\\nCr","\\exp","\\sum","\\prod"],n.Productions._terminalRules=["node.\\frac","node.do","node.do","terminal.var","terminal.const","terminal.digit","terminal.\\theta","node.do","node.\\sin","node.\\cos","node.\\tan","node.\\csc","node.\\sec","node.\\cot","node.\\arcsin","node.\\arccos","node.\\arctan","node.\\arccsc","node.\\arcsec","node.\\arccot","node.\\sinh","node.\\cosh","node.\\tanh","node.\\csch","node.\\sech","node.\\coth","node.\\log_","node.\\ln","node.\\log","node.\\sqrt","node.\\gcd","node.\\lcm","node.\\ceil","node.\\floor","node.\\round","node.\\abs","node.\\min","node.\\max","node.\\mod","node.\\nPr","node.\\nCr","node.\\exp","node.\\sum terminal.const","node.\\prod terminal.const"],n.Productions._seperatedTokens={"\\frac":["\\frac","{","E","}","{","E","}"],"(":["(","E",")"],"[":["[","E","]"],"var":["var"],"const":["const"],digit:["digit"],"\\theta":["\\theta"],"{":["{","E","}"],"\\sin":["\\sin","(","E",")"],"\\cos":["\\cos","(","E",")"],"\\tan":["\\tan","(","E",")"],"\\csc":["\\csc","(","E",")"],"\\sec":["\\sec","(","E",")"],"\\cot":["\\cot","(","E",")"],"\\arcsin":["\\arcsin","(","E",")"],"\\arccos":["\\arccos","(","E",")"],"\\arctan":["\\arctan","(","E",")"],"\\arccsc":["\\arccsc","(","E",")"],"\\arcsec":["\\arcsec","(","E",")"],"\\arccot":["\\arccot","(","E",")"],"\\sinh":["\\sinh","(","E",")"],"\\cosh":["\\cosh","(","E",")"],"\\tanh":["\\tanh","(","E",")"],"\\csch":["\\csch","(","E",")"],"\\sech":["\\sech","(","E",")"],"\\coth":["\\coth","(","E",")"],"\\log_":["\\log_","{","E","}","(","E",")"],"\\ln":["\\ln","(","E",")"],"\\log":["\\log","(","E",")"],"\\sqrt":["\\sqrt","[","E","]","{","E","}"],"\\gcd":["\\gcd","(","E",",","E",")"],"\\lcm":["\\lcm","(","E",",","E",")"],"\\ceil":["\\ceil","(","E",")"],"\\floor":["\\floor","(","E",")"],"\\round":["\\round","(","E",")"],"\\abs":["\\abs","(","E",")"],"\\min":["\\min","(","E",",","E",")"],"\\max":["\\max","(","E",",","E",")"],"\\mod":["\\mod","(","E",",","E",")"],"\\nPr":["\\nPr","(","E",",","E",")"],"\\nCr":["\\nCr","(","E",",","E",")"],"\\exp":["\\exp","(","E",")"],"\\sum":["\\sum","{","const","}","{","E","}","{","E","}","{","E","}"],"\\prod":["\\prod","{","const","}","{","E","}","{","E","}","{","E","}"]},n.Productions._operatorsInPrecedenceOrder=["+","\\cdot","^","!","\\%"],n.Productions._nonTerminalRules=["node.+","node.\\cdot","node.^","node.!","node.\\%"],n.Productions.productionTable={E:{}},b=0,c=n.Productions._terminalProductions.length,b;c>b;b++)n.Productions.productionTable.E[n.Productions._terminalProductions[b]]=[];for(n.Productions.treeGenerationRules=[],n.Productions.productionRules=[],e=0,f=n.Productions._operatorsInPrecedenceOrder.length,b=0,c=n.Productions._terminalProductions.length,g=Math.pow(2,f)-1,b=0;c>b;b++)for(k=n.Productions._terminalProductions[b],l=n.Productions._seperatedTokens[k][0],j=0;g>j;j++){for(h=[],m="",d="",e=0;f>e;e++)(j&Math.pow(2,e))>0&&("!"===n.Productions._operatorsInPrecedenceOrder[e]||"\\%"===n.Productions._operatorsInPrecedenceOrder[e]?h.unshift("("+n.Productions._operatorsInPrecedenceOrder[e]+")+"):h.unshift("("+n.Productions._operatorsInPrecedenceOrder[e]+",E)+"),m=m+"node."+n.Productions._operatorsInPrecedenceOrder[e]+" ");if(i=n.Productions._seperatedTokens[k].concat.apply(n.Productions._seperatedTokens[k],[h]),d=m+n.Productions._terminalRules[b],n.Productions.treeGenerationRules.push(d),n.Productions.productionRules.push(i),n.Productions.productionTable.E[l].push(n.Productions.productionRules.length-1),"{"===k||"["===k)break}n.Productions._getProductionTableAsString()},_getProductionTableAsString:function(){var b=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,c="",d=0,e=b.Productions.productionRules.length;for(d=0;e>d;d++)c+=d+" : "+b.Productions.productionRules[d].join("")+"   >>    "+b.Productions.treeGenerationRules[d]+"\n";$("#rules").text(c)}}),a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.EquationData=Backbone.Model.extend({units:null,equation:null,analysis:null,blind:!1,constants:null,plotSessionCount:null,autonomous:void 0,type:null,pointShape:"circle",parent:void 0,coordinateSystem:void 0,solution:null,profiles:[],id:null,labelData:void 0,isSaveRestoreData:!1,bannerData:null,drawStyle:null,thicknessOnFocus:null,initialize:function(){this.units={angle:"rad"},this.constants={},this.coordinateSystem="cartesian",this.profiles=[],this.blind=!1,this.color="black",this.thickness=3,this.thicknessOnFocus=this.thickness+1,this.opacity=1,this.plotSessionCount=0,this.autonomous=!1,this.isSaveRestoreData=!1,this.drawStyle={draggable:!1,dragHitThickness:15,dragHitColor:"#ff0000",dragHitAlpha:0},this.bannerData={bannerObject:null,visible:!1,bannerText:""},this.id=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.MathFunctions.getGUID(),this.analysis={rhsAuto:null,accText:null,order:null,FDFlag:null,functionCode:null},this.labelData={text:"A",visible:!1,labelObject:null},this.directives={FDFlagMethod:"calculator"}},toString:function(){return this.equation},directives:void 0,setEquation:function(a){this.equation=a,this.trigger("change-equation")},setConstants:function(a){this.constants=a,this.trigger("change-constants")},setUnits:function(a){var b=null;for(b in a)this.units[b]=a[b]},changePointsColor:function(a){this.color=a,this.trigger("change-points-color")},changeColor:function(a){this.color=a,this.trigger("change-color")},changeThickness:function(a){this.thickness=a,this.thicknessOnFocus=this.thickness+1,this.trigger("change-thickness")},hideGraph:function(){this.pathGroup&&(this.pathGroup.visible=!1),this.pointsGroup&&(this.pointsGroup.visible=!1),this.visible=!1},showGraph:function(){this.visible=!0,this.pathGroup&&(this.pathGroup.visible=!0),this.pointsGroup&&(this.pointsGroup.visible=!0)},toggleGraphView:function(){this.visible?this.hideGraph():this.showGraph()},dashedGraph:function(){"point"===this.type?(this.pointsGroup.strokeColor=this.color,this.pointsGroup.fillColor="#ffffff"):this.pathGroup.dashArray=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.EquationData.DASHED_ARRAY,this.dashArray=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.EquationData.DASHED_ARRAY},normalGraph:function(){"point"===this.type?(this.pointsGroup.fillColor=this.color,this.labelData.labelObject&&(this.labelData.labelObject.fillColor=this.color)):this.pathGroup.dashArray=[],this.dashArray=[]},toggleDashedGraph:function(){0!==this.dashArray.length?this.normalGraph():this.dashedGraph()},getData:function(){var a={};return a.equation=this.equation,a.color=this.color,a.thickness=this.thickness,a.styleType=this.styleType,a.visible=this.visible,a.points=this.points,a},setData:function(a){this.equation=a.equation,this.color=a.color,this.thickness=a.thickness,this.styleType=a.styleType,this.visible=a.visible,this.points=a.points,this.isSaveRestoreData=!0},removePlottedGraph:function(){this.pathGroup&&this.pathGroup.remove()},flushData:function(){delete this.A,delete this.B,delete this.C,delete this.errorCode,delete this.errorData,delete this.errorString,delete this.freeVars,delete this.functionVariable,delete this.isPolar,delete this.leftExpresstion,delete this.leftRoot,delete this.rightExpresstion,delete this.rightRoot,delete this.points,delete this.solution,delete this.type}},{DASHED_ARRAY:[10,4],minThickness:1,maxThickness:8}),a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.ParserAssist=Backbone.Model.extend({},{getEquationAccessibility:function(b){a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Productions.init();var c,d=new a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.EquationData;return d.equation=b,a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Parser.parseEquation(d),c=d.analysis.accText,d=null,c}}),a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Parser=Backbone.Model.extend({},{_deploy:!0,_constants:{"\\pi":Math.PI,e:Math.E},_debugFlag:{tokens:!1,rules:!1,tree:!1,power:!1,simplify:!1,expand:!1,convert2q:!1,solve:!1,plot:!1,info:!1,common:!1,error:!1},_INVERSIBLE_FUNCTIONS:["\\sin^{-1}","\\cos^{-1}","\\tan^{-1}","\\cot^{-1}","\\csc^{-1}","\\sec^{-1}","\\sinh^{-1}","\\cosh^{-1}","\\tanh^{-1}","\\coth^{-1}","\\csch^{-1}","\\sech^{-1}"],_INVERT_FUNCTIONS_IN_ORDER:["\\arcsin","\\arccos","\\arctan","\\arccot","\\arccsc","\\arcsec","\\arsinh","\\arcosh","\\artanh","\\arcoth","\\arcsch","\\arsech"],_productions:a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Productions,_mathFunctions:a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.MathFunctions,_NSTYLE:"background: #c00; color: #fff",_HSTYLE:"background: #cc0; color: #fff",_BLUE_STYLE:"background: #004; color: #fff",_YSTYLE:"background: #0c0; color: #fff",_borderColor:"#C1C1C1",_isBlank:function(a){return void 0===a?!1:(a=a.trim(),""===a)},_preProcessLatexSumProduct:function(a,b,c,d,e,f,g){var h,i,j=0;for(h=0;h<a.length;h++)if(")"===a.charAt(h)){if(0===j){if("("===a.charAt(0)){b=a.substring(1,h-1);break}b=a.substring(0,h);break}j--}else"("===a.charAt(h)&&j++;return void 0===g||""===g?((-1!==e.indexOf(d)||-1!==f.indexOf(d))&&(i=!0),c+"{"+d+"}{"+e+"}{"+f+"}{"+b+"}"+a.substring(h,a.length)):((-1!==e.indexOf(d)||-1!==g.indexOf(d))&&(i=!0),c+"{"+d+"}{"+e+"}{"+g+"}{"+b+"}"+a.substring(h,a.length))},_preProcessSumProductCase:function(b,c){if(void 0!==b&&null!==b){c.pivot=void 0;var d,e,f,g,h,i,j,k=/(\\sum)|(\\prod)/g,l=/^[a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|z|A-Z]$/,m=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,n=!1,o=/(\\sum|\\prod)[\_][\{]([A-Za-z])[\=]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^\!]+)([\}])[\^]([0-9A-Za-z]|[\{](([\{][0-9a-zA-Z\+\_\.\-\\()\[\]\^\!][\}])+|[0-9a-zA-Z\+\_\.\-\\()\[\]\^\!]+)[\}])([\(]([0-9a-zA-Z\s\+\_\.\-\\{}()\[\]\^\!]+)[\)])/g,p=/(\\sum|\\prod)[\_][\{]([A-Za-z])[\=]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^\!]+)([\}])[\^]([0-9A-Za-z]|[\{](([\{][0-9a-zA-Z\+\_\.\-\\()\[\]\^][\}])+|[0-9a-zA-Z\+\_\.\-\\()\[\]\^\!]+)[\}])([0-9a-zA-Z\s\+\_\.\-\\{}()\[\]\^\!]+)/g,q=/(\\sum|\\prod)[\^]([0-9A-Za-z]|[\{](([\{][0-9a-zA-Z\+\_\.\-\\()\[\]\^\!][\}])+|[0-9a-zA-Z\+\_\.\-\\()\[\]\^\!]+)[\}])[\_][\{]([A-Za-z])[\=]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^\!]+)([\}])([\(]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^]+)[\)])[^\^]/g,r=/(\\sum|\\prod)[\^]([0-9A-Za-z]|[\{](([\{][0-9a-zA-Z\+\_\.\-\\()\[\]\^\!][\}])+|[0-9a-zA-Z\+\_\.\-\\()\[\]\^\!]+)[\}])[\_][\{]([A-Za-z])[\=]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^\!]+)([\}])([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^]+)/g,s=function(a,b,f,g,h,i,j,k,l,n){return n=null,c.pivot=f,d=l,e=d.substring(1,d.length-1),m.Parser._preProcessLatexSumProduct(d,e,b,f,g,i,j)},t=function(a,b,f,g,h,i,j,k,l){return c.pivot=f,d=l,e=d,m.Parser._preProcessLatexSumProduct(d,e,b,f,g,i,j)},u=function(a,b,f,g,h,i,j,k,l,n){return c.pivot=i,d=n,e=d.substring(0,d.length),m.Parser._preProcessLatexSumProduct(d,e,b,i,j,f,g)},v=function(a,b,f,g,h,i,j,k,l){return c.pivot=i,d=l,e=d.substring(0,d.length),m.Parser._preProcessLatexSumProduct(d,e,b,i,j,f,g)};for(g=null!==b.match(k)?b.match(k).length:0,f=0;g>f;f++)b=b.replace(o,s),b=b.replace(p,t),b=b.replace(q,u),b=b.replace(r,v);if(n)return c.canBeSolved=!1,void(c.errorCode="CannotUnderstandThis");if(void 0===c.pivot&&(h=b.indexOf("\\sum"),-1!==h?(j="\\sum",j=j.length):(h=b.indexOf("\\prod"),-1!==h&&(j="\\prod",j=j.length+1)),-1!==h))for(i=b.length,f=h+j;i>f;f++)if(null!==b.charAt(f).match(l)&&"="===b.charAt(f+1)){c.pivot=b.charAt(f);break}return b}},_checkSumProductCase:function(b,c){var d,e,f,g,h=b.length,i=!1,j=!1,k=!1,l=!1,m=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,n=0,o="",p="",q=!1,r=!1,s="",t="",u="";for(d=0;h>d;d++)if(e=b.charAt(d),i===!0)if(0===n&&r===!1&&"_"===e)j=!0,k=!1;else if(0===n&&q===!1&&"^"===e)j=!1,k=!0;else if(m.ParsingProcedures._isOpeningBracket(e)?n++:m.ParsingProcedures._isClosingBracket(e)&&n--,j===!0)o+=e,0===n&&(r=!0,j=!1);else if(k===!0)p+=e,0===n&&(q=!0,k=!1);else{if(0===n&&"+"===e){i=!1,l=!1,s=e;continue}if(-1===n){i=d===h-1?!0:!1,l=!1,s=e;continue}if(t+=e,f=t.lastIndexOf("\\sum"),-1!==f&&f===t.length-4)return c.canBeSolved=!1,void(c.errorCode="CannotUnderstandThis");if(g=t.lastIndexOf("\\prod"),-1!==g&&g===t.length-5)return c.canBeSolved=!1,void(c.errorCode="CannotUnderstandThis")}else""!==t&&(u+=m.Parser._prepareSumProductLatex(p,o,t,c),t="",o="",p="",j=!1,q=!1,r=!1,k=!1,n=0),""!==s&&(u+=s,s=""),u+=e,l===!1&&m.Parser._checkSumProductCondition(u)&&(i=!0,l=!0);return i===!0&&(u+=m.Parser._prepareSumProductLatex(p,o,t,c),""!==s&&(u+=s,s="")),u},_checkSumProductCondition:function(a){var b=a.lastIndexOf("\\sum"),c=a.lastIndexOf("\\prod"),d=a.length;return-1===b&&-1===c?!1:-1!==b&&b===d-4?!0:-1!==c&&c===d-5?!0:!1},_prepareSumProductLatex:function(a,b,c,d){var e,f="";return"{"===b.charAt(0)&&(b=b.substring(1,b.length-1)),
e=b.split("="),f+="{"+e[0]+"}{"+e[1]+"}",d.pivot=e[0],"{"===a.charAt(0)&&(a=a.substring(1,a.length-1)),f+="{"+a+"}",f+="{"+c+"}",-1!==e[1].indexOf(d.pivot)||-1!==a.indexOf(d.pivot)?(d.canBeSolved=!1,void(d.errorCode="CannotUnderstandThis")):f},parseEquation:function(b){if(!b.blind){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;if(c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,c.Parser._deploy||paper.install(window),c.Parser._isBlank(b.equation))return b.canBeSolved=!1,b.type="error",b.errorCode="Blank",void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if(void 0===b.units&&(b.units={angle:"deg"}),b.type="error",b.range=null,b.solution=null,b.errorData=[],b.analysis={},d=b.equation,b.canBeSolved=!0,c.Parser._showConsole(c.Parser._debugFlag.common,"Processing equation "+d,[]),d=d.replace(/\\space/gi,""),d=d.replace(/\\left/gi,""),d=d.replace(/\\right/gi,""),d=d.replace(/\$/gi,""),d=d.replace(/\s/gi,""),d=d.replace(/\\cdot/gi,"\\cdot "),d=d.replace(/\\pi/gi,"\\pi "),d=d.replace(/\\le/gi,"\\le "),d=d.replace(/\\ge/gi,"\\ge "),d=d.replace(/\\theta/gi,"\\theta "),d=c.Parser._splitRangeFromSolution(d,b),b.canBeSolved!==!1){if(d=c.Parser._checkSumProductCase(d,b),b.canBeSolved===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured in sum pivot case",["#ff0000"]);if(c.Parser._preProcessLatexForErrors(d,b),b.canBeSolved===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured in syntax of latex",["#ff0000"]);if(e=/(.+?)=(.+)/gi,f=e.exec(d),c.Parser._showConsole(c.Parser._debugFlag.common,d,[]),b.leftExpression={constants:{},freevars:{}},b.rightExpression={constants:{},freevars:{}},null===f?(b.leftExpression.expression=d,c.Parser._showConsole(c.Parser._debugFlag.common,"Eqaution is an expression",[])):(b.leftExpression.expression=f[1],b.rightExpression.expression=f[2]),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("leftPreProcess"),c.Parser._preProcessExpression(b.leftExpression),c.Parser._deploy||(b.profiles[0]=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("leftPreProcess"),y=$("#pre-process-latex-left"),z=$("<div></div>"),y.append(z),z.attr("id","left-preprocess-latex-expression").append(b.leftExpression.expression).css({border:"1px solid","border-color":c.Parser._borderColor,padding:"5px 5px 5px 5px"}),y.parent().css({border:"1px solid black"})),c.Parser._showConsole(c.Parser._debugFlag.tokens,"Left expression after preprocessing :: ",[]),c.Parser._showConsole(c.Parser._debugFlag.tokens,b.leftExpression,[]),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("leftTokenGeneration"),c.Parser._parseExpression(b.leftExpression,b),b.analysis||(b.analysis={}),c.Parser._deploy||(b.profiles[1]=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("leftTokenGeneration")),b.canBeSolved===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if("point"!==b.type){if(c.Parser._displayArrayOfObjects(b.leftExpression.tokens,"tokens-display-container-left","#777700","white"),void 0===b.rightExpression.expression)if(3===b.leftExpression.tokens.length){if("digit"===b.leftExpression.tokens[1].type&&"("===b.leftExpression.tokens[0].value&&")"===b.leftExpression.tokens[2].value)return b.type="number",void("-"===b.leftExpression.tokens[1].sign?b.solution=-1*Number(b.leftExpression.tokens[1].value):b.solution=Number(b.leftExpression.tokens[1].value))}else if(1===b.leftExpression.tokens.length&&"digit"===b.leftExpression.tokens[0].type)return b.type="number",void("-"===b.leftExpression.tokens[0].sign?b.solution=-1*Number(b.leftExpression.tokens[0].value):b.solution=Number(b.leftExpression.tokens[0].value));g=[],h=null;for(h in b.leftExpression.freevars)-1===g.indexOf(h)&&g.push(h);if(void 0!==b.rightExpression.expression){if(b.analysis.rhsAuto=!1,c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("rightPreProcess"),c.Parser._preProcessExpression(b.rightExpression),c.Parser._deploy||(b.profiles[0]+=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("rightPreProcess")),c.Parser._showConsole(c.Parser._debugFlag.tokens,"right expression after preprocessing :: ",[]),c.Parser._showConsole(c.Parser._debugFlag.tokens,b.rightExpression,[]),c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("rightTokenGeneration"),c.Parser._parseExpression(b.rightExpression,b),c.Parser._deploy||(b.profiles[1]+=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("rightTokenGeneration")),b.canBeSolved===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);h=null;for(h in b.rightExpression.freevars)-1===g.indexOf(h)&&g.push(h)}else{if(0===g.length)b.analysis.rhsAuto=!0,b.rightExpression.expression="0";else{if(1!==g.length)return b.canBeSolved=!1,b.errorstring="Cant understand this",b.errorCode="Complicated",void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if("x"!==g[0])return b.canBeSolved=!1,b.errorCode="Complicated",b.errorString="Cant understand this",void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);g.push("y"),b.analysis.rhsAuto=!0,b.rightExpression.expression="y"}if(c.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("rightPreProcess"),c.Parser._preProcessExpression(b.rightExpression),c.Parser._deploy||(b.profiles[0]+=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("rightPreProcess"),a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("rightTokenGeneration")),c.Parser._parseExpression(b.rightExpression,b),c.Parser._deploy||(b.profiles[1]+=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("rightTokenGeneration")),b.canBeSolved===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"])}if("graphing"===b.directives.FDFlagMethod&&c.Parser._getFracDecAnalysis(b),b.canBeSolved===!1)return void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if(c.Parser._deploy||(A=$("#pre-process-latex-right"),B=$("<div></div>"),A.append(B),B.attr("id","right-preprocess-latex-expression").append(b.rightExpression.expression).css({border:"1px solid","border-color":c.Parser._borderColor,padding:"5px 5px 5px 5px"})),q=-1!==g.indexOf("r"),r=-1!==g.indexOf("x")||-1!==g.indexOf("y"),s=[],q&&r){for(t=0,u=g.length,t;u>t;t++)"r"!==g[t]&&s.push(g[t]);for(g=s,v=0,w=b.leftExpression.tokens.length,x=null,v;w>v;v++)x=b.leftExpression.tokens[v],"r"===x.value&&(x.type="const");for(w=b.rightExpression.tokens.length,v=0;w>v;v++)x=b.rightExpression.tokens[v],"r"===x.value&&(x.type="const")}if(q===!0&&r===!1?b.isPolar=!0:b.isPolar=!1,c.Parser._displayArrayOfObjects(b.rightExpression.tokens,"tokens-display-container-right","#777700","white"),g.length>2&&(b.canBeSolved=!1,b.errorCode="MoreFreeVariables",b.errorString=c.EquationEnums.ERROR_TOO_MANY_FREE_VARIABLES,c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"])),c.Parser._showConsole(c.Parser._debugFlag.common,"%c[READY]Final equation is "+b,[c.Parser._YSTYLE]),c.Parser._showConsole(c.Parser._debugFlag.common,b,[]),i=!1,void 0===b.constants&&(i=!0),c.Parser._checkIfOnlyNumbersAndConstantsPresent(b),b.canBeSolved!==!1){if(c.Parser._substituteConstants(b.leftExpression,b,i),c.Parser._substituteConstants(b.rightExpression,b,i),!b.canBeSolved)return this._mergeConstantsErrorData(b),void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if(c.Parser._printTokens(b.leftExpression,"Left expression "),c.Parser._printTokens(b.rightExpression,"Right expression "),c.Parser._showConsole(c.Parser._debugFlag.common,"%c[STAGE1 - Success]Token Generation Complete",[c.Parser._YSTYLE]),$("#production-rules-display").html(""),$.isEmptyObject(b.leftExpression.freevars)&&$.isEmptyObject(b.rightExpression.freevars)&&(b.type="expression"),c.Parser._generateAnalysis(b),b.canBeSolved===!1)return b.type="error",void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);if("expression"===b.type)return c.Parser._showConsole(c.Parser._debugFlag.common,"The equation is solved",[]),c.Parser._showConsole(c.Parser._debugFlag.common,b.solution,[]),c.Parser._showConsole(c.Parser._debugFlag.common,b.solution,[]),void c.Parser._showConsole(c.Parser._debugFlag.common,b,[]);if(c.Parser._calculateMaxPowerOfVariable(b),b.canBeSolved===!1)return b.type="error",void c.Parser._showConsole(c.Parser._debugFlag.error,"%cError occured :: ",["#ff0000"]);j=[],k=null,l=0;for(k in b.freeVars)l++,c.Parser._showConsole(c.Parser._debugFlag.common,"checking complexity of freevar "+k+">> "+b.freeVars[k],[]),"number"==typeof b.freeVars[k]&&b.freeVars[k]<=2&&j.push(k);if(1===l){if(0===j.length)return b.canBeSolved=!1,b.errorCode="Complicated",c.Parser._showConsole(c.Parser._debugFlag.error,"%c ERROR: complicated equation. Cant solve"),void(b.type="error");c.Parser._showConsole(c.Parser._debugFlag.info,"%c INFO %c: Equation will yield solutions",[c.Parser._BLUE_STYLE,void 0]),b.freeVars[j[0]]>1?b.type="quadratic":(b.type="linear",(1===b.freeVars.x||1===b.freeVars.y)&&(b.type="plot"))}else b.type="plot";if(j.length<=2){for(n=!1,o=0,p=j.length,o;p>o;o++)c.Parser._showConsole(c.Parser._debugFlag.common,c.Parser._getFunctionVariablePrecedenceIndex(m)+">>"+c.Parser._getFunctionVariablePrecedenceIndex(j[o]),[]),n=void 0===m?!0:c.Parser._getFunctionVariablePrecedenceIndex(m)<c.Parser._getFunctionVariablePrecedenceIndex(j[o])?!0:!1,n===!0&&(m=j[o]);b.functionVariable=m,j.length>1&&null!==b.range&&void 0!==b.range&&-1!==j.indexOf(b.range.variable)&&("y"===b.range.variable?b.functionVariable=m="x":b.functionVariable=m="y"),"y"===m?b.paramVariable="x":b.paramVariable="y",null!==b.range&&b.paramVariable!==b.range.variable&&(b.canBeSolved=!1,b.errorCode="ComplicatedRange"),c.Parser._showConsole(c.Parser._debugFlag.common,"%c[STAGE5 - SUCCESS] Chosen function variable is "+m,[c.Parser._YSTYLE])}else b.canBeSolved=!1,b.errorCode="MoreFreeVariables",b.errorString=c.EquationEnums.ERROR_TOO_MANY_FREE_VARIABLES,c.Parser._showConsole(c.Parser._debugFlag.error,"%c[STAGE5 - FAIL]TOO many free variables...it should NOT have been be detected so late",[c.Parser._NSTYLE])}}}}},_checkIfOnlyNumbersAndConstantsPresent:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;c=e.Parser._containsOnlyNumbersAndConstants(b.leftExpression.tokens),d=e.Parser._containsOnlyNumbersAndConstants(b.rightExpression.tokens),c===!0&&d===!0&&-1!==b.equation.indexOf("=")&&(b.canBeSolved=!1,e.Parser._substituteConstants(b.leftExpression,b,!1),e.Parser._substituteConstants(b.rightExpression,b,!1),this._mergeConstantsErrorData(b),b.errorCode="OnlyNumbers")},_getFracDecAnalysis:function(b){var c,d,e,f=function(d){var e,f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,h=["\\pi","e","x","y"],i=1,j=[],k=!1,l="Syntax Error in FracDec",m=d.length,n=!1;if(void 0!==d&&0!==m){if(2>m)return void c(d);if("\\fracdec"!==d[0].value){for(e=0;m>e;e++)if(f=d[e],"\\fracdec"!==f.value){if(g.ParsingProcedures._isValidBracket(f.value))n&&g.ParsingProcedures.recordBracket(j,f.value);else if(j.length>0&&-1!==h.indexOf(f.value))return b.canBeSolved=!1,b.errorString=l,void(b.errorCode="FracDecError")}else n=!0;return"decimal"}for(;m>i;){if(1===i&&!g.ParsingProcedures._isValidBracket(d[i].value)){k=!0;break}if(g.ParsingProcedures.recordBracket(j,d[i].value),-1!==h.indexOf(d[i].value)){k=!0,l="No π or e allowed in fracdec";break}if(i++,0===j.length)break}return k=k?k:j.length>0?l="No π or e allowed in fracdec":!1,k?(b.canBeSolved=!1,b.errorString=l,void(b.errorCode="FracDecError")):i<d.length?"decimal":"frac"}};c=function(a){var c=0;if(a)for(;c<a.length;)if("\\fracdec"!==a[c].value)c++;else{if(a.length>c+1){if("("!==a[c+1].value)return b.canBeSolved=!1,void(b.errorCode="CannotUnderstandThis");a[c+1].sign=a[c].sign}a.splice(c,1)}},d=f(b.leftExpression.tokens),"frac"===d&&b.rightExpression&&b.rightExpression.tokens&&(e=f(b.rightExpression.tokens)),c(b.leftExpression.tokens),c(b.rightExpression.tokens),b.analysis.FDFlag=e?e:d},_mergeConstantsErrorData:function(a){var b,c,d;if(a.errorData=[],void 0!==a.leftExpression.errorData)for(b=0,c=a.leftExpression.errorData.length,b;c>b;b++)d=a.leftExpression.errorData[b],-1===a.errorData.indexOf(d)&&a.errorData.push(d);if(void 0!==a.rightExpression.errorData)for(b=0,c=a.rightExpression.errorData.length,b;c>b;b++)d=a.rightExpression.errorData[b],-1===a.errorData.indexOf(d)&&a.errorData.push(d)},_containsOnlyNumbersAndConstants:function(a){var b,c,d=a.length,e=!0;for(b=0;d>b;b++)if(c=a[b],"digit"!==c.type&&"opr"!==c.type){if("const"!==c.type){e=!1;break}if("e"===c.value||"\\pi"===c.value){e=!1;break}}return e},_isCommaFunction:function(a){var b=["\\lcm","\\gcd","\\min","\\nPr","\\nCr","\\mod"];return-1!==b.indexOf(a)},_parseAndSetRange:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return b.length<2?(c.canBeSolved=!1,void(c.errorCode="ComplicatedRange")):(e.RangeProductionRules.generateRules(),d=e.Parser._recursiveDescentParser(c,b,0,0,[void 0],!0),void 0===d&&(c.canBeSolved=!1),c.canBeSolved===!1?void(c.errorCode="ComplicatedRange"):void(c.range=e.Parser._setRangeFromSequenceString(d,b,c)))},_setRangeFromSequenceString:function(b,c,d){var e,f,g,h,i,j,k=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,l={min:null,max:null,variable:null};return e=k.RangeProductionRules.solution[b[0]],f=e.split(" "),g=f.length,2===g?(-1===f[0].indexOf("var")?(l.variable=f[1],h=f[0],i=-1!==f[0].indexOf("min")):(l.variable=f[0],h=f[1],i=-1!==f[1].indexOf("min")),i?l.min=k.Parser._createMinMaxObject(h,c):l.max=k.Parser._createMinMaxObject(h,c)):(l.variable=f[1],-1!==f[0].indexOf("min")?(l.min=k.Parser._createMinMaxObject(f[0],c),l.max=k.Parser._createMinMaxObject(f[2],c)):(l.min=k.Parser._createMinMaxObject(f[2],c),l.max=k.Parser._createMinMaxObject(f[0],c)),l.min.value>=l.max.value&&(d.canBeSolved=!1)),j=l.variable.split("."),l.variable=c[Number(j[j.length-1])].value,l},_createMinMaxObject:function(a,b){var c,d,e={include:-1!==a.indexOf("equal"),value:null};return c=a.split("."),d=b[c[c.length-1]],e.value=Number(d.value),"-"===d.sign&&(e.value*=-1),e},_splitRangeFromSolution:function(b,c){var d,e=/(\\\})/,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,g=b.split("\\{");if(g[1]){if(g[1].indexOf("\\}")!==g[1].length-2||b.indexOf("\\}")!==b.length-2)return c.canBeSolved=!1,void(c.errorCode="CannotUnderstandThis");if(g[1]=g[1].replace(e,""),d=f.Parser._generateTokens(g[1],c),c.canBeSolved===!1)return;f.Parser._parseAndSetRange(d,c)}return""===g[0]&&(c.canBeSolved=!1,c.errorCode="CannotUnderstandThis"),g[0]},_preProcessLatexForErrors:function(a,b){var c,d,e,f,g,h=/[\\a-zA-Z0-9]*[\^][a-zA-Z0-9](([0-9]+)|([\.]))/g;if(-1!==a.indexOf("---"))return b.canBeSolved=!1,void(b.errorCode="CannotUnderstandThis");if(c=a.match(h),null!==c)for(e=c.length,g=/\\[a-zA-Z0-9]+[\^][a-zA-Z0-9][0-9]+(([\.]?[0-9])*)/g,d=0;e>d;d++)if(f=g.exec(c[d]),null===f)return b.canBeSolved=!1,void(b.errorCode="CannotUnderstandThis");return-1!==a.indexOf("!!")?(b.canBeSolved=!1,void(b.errorCode="CannotUnderstandThis")):void 0},_getFunctionVariablePrecedenceIndex:function(a){switch(a){case"y":return 3;case"x":return 2;default:return 0}},_shiftAllRightTokensToLeft:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,g=b.rightExpression.tokens,h=g.length,i=0;for(i;h>i;i++)c=g[i],d=f.Parser._getFactoryToken(),d.value="+",d.isValid=!0,d.type="opr",d.sign="+",b.leftExpression.tokens.push(d),"-"===c.sign?c.sign="+":c.sign="-",b.leftExpression.tokens.push(c);e=f.Parser._getFactoryToken(),e.value="0",e.isValid=!0,e.type="digit",e.sign="+",b.rightExpression.tokens=[],b.rightExpression.tokens.push(e),f.Parser._showConsole(f.Parser._debugFlag.common,"Shifted all right tokens to left ----------------------------------------------",[]),f.Parser._showConsole(f.Parser._debugFlag.common,b,[])},_preProcessExpression:function(a){if(void 0!==a){a.expression=a.expression.replace(/\-\-/g,"+"),a.expression=a.expression.replace(/\\times/g,"\\cdot ");var b,c,d,e,f,g="\\cdot ",h=g.length,i=/(\(|\[|\{|\+|\\cdot\s|,)/,j=0,k=/\\text\{fracdec}/g,l=/\\text\{abs}/g,m=/\\l((ceil)|(floor))/g,n=/\\r(ceil|floor)/g,o=/(\\sin\^\{\-1\}|\\cos\^\{\-1\}|\\tan\^\{\-1\}|\\cot\^\{\-1\}|\\csc\^\{\-1\}|\\sec\^\{\-1\}|\\sinh\^\{\-1\}|\\cosh\^\{\-1\}|\\tanh\^\{\-1\}|\\coth\^\{\-1\}|\\csch\^\{\-1\}|\\sech\^\{\-1\})/g,p=/\\sqrt\{/g,q="\\sqrt[2]{",r=/\\log_([\{]([0-9a-zA-Z\+\_\.\!\%\-\\()\[\]\^]+)[\}])(([0-9]+[\.]?[0-9]*)|([\.][0-9]+)[A-Za-z]*(\\theta)?(\\pi\s)?|\\theta|\\pi\s|[A-Za-z])/g,s=/\\log_([0-9]|[A-Za-z])([\(]([0-9a-zA-Z\+\_\.\!\%\-\\{}()\[\]\^]+)[\)])/g,t=/\\log_([0-9]|[A-Za-z])(([0-9]+[\.]?[0-9]*)|([\.][0-9]+)[A-Za-z]*(\\theta)?(\\pi\s)?|\\theta|\\pi\s|[A-Za-z])/g,u=/\\prod_\{[A-Za-z]=(([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[\.][0-9]+)|([\-]?\\theta|[\-]?\\pi|[\-]?[A-Za-z])[A-Za-z]*(\\theta)*(\\pi)*|[\-]?\\theta|[\-]?\\pi|[\-]?[a-zA-Z])\}\^([0-9]|[A-Za-z])/g,v=/\\sum_\{[A-Za-z]=(([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[\.][0-9]+)|([\-]?\\theta|[\-]?\\pi|[\-]?[A-Za-z])[A-Za-z]*(\\theta)*(\\pi)*|[\-]?\\theta|[\-]?\\pi|[\-]?[a-zA-Z])\}\^([0-9]|[A-Za-z])/g,w=/(\\log|\\ln)((([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[\.][0-9]+)|([\-]?[A-Za-z])|([\-]?(\\theta))|([\-]?(\\pi\s)))[A-Za-z]*(\\theta)*(\\pi\s)*|[\-]?\\theta|[\-]?\\pi\s|[\-]?[a-zA-Z])/g,x=/(\\sinh|\\cosh|\\tanh|\\csch|\\sech|\\coth)((([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[\.]?[0-9]+)|([\-]?[A-Za-z]+)|([\-]?(?:\\pi\s)+)|([\-]?(?:\\theta)+))((\\theta)*(\\pi\s)*[A-Za-z]*)|([\-]?[\w]))/g,y=/(\\sin|\\cos|\\tan|\\csc|\\sec|\\cot|\\arcsin|\\arccos|\\arctan|\\arccsc|\\arcsec|\\arccot)([\-]?[h])([^\w\d\(\^]|$)/g,z=/(\\sin|\\cos|\\tan|\\csc|\\sec|\\cot|\\arcsin|\\arccos|\\arctan|\\arccsc|\\arcsec|\\arccot)((([\-]?(?:\\theta\s)+)|([\-]?(?:\\pi\s)+)|([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[\.]?[0-9]+)|([\-]?[A-Za-z]+))([A-Za-z]*(\\pi\s)*)(\\theta\s)*|([\-]?[\w]))/g,A=/(([\-]?[0-9]*[\.]?[0-9]*[A-Za-z]*(\\theta)*(\\pi\s)*)[\^][\{]([\-]?[0-9]*[\.]?[0-9]*[A-Za-z]*(\\theta)*(\\pi\s)*)[\}])([\\][\%])/g,B=/(([0-9]*[\.]?[0-9]*[A-Za-z]*(\\theta)*(\\pi\s)*)[\^]([0-9]+[\.]?[0-9]*[A-Za-z]*(\\theta)*(\\pi\s)*))([\\][\%])/g,C=/([\(|\)|\{|\}|\[|\]|\+|\-|\/|\%|\*|\^|])?((([\-]?[\.][0-9]+)|([\-]?[A-Za-z])|([\-]?(\\theta))|([\-]?(\\pi\s))|([\-]?[0-9]+[\.]?[0-9]*)))[\\][\%]([\\][\%])/g,D=/([\(|\)|\{|\}|\[|\]|\+|\-|\/|\%|\*|\^])?([\(]+(([\-]?[\.][0-9]+)|([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[A-Za-z])|([\-]?(\\theta))|([\-]?(\\pi\s)))([\\][\%][\)])+)([\\][\%]([\\][\%]+))/g,E=/((([\-]?[0-9]+[\.]?[0-9]*)|([\-]?(\\theta))|([\-]?(\\pi\s))|([\-]?[\.][0-9]+)|([\-]?[a-zA-Z]))[\!])([\/^]([\{]|[0-9A-Za-z]))/g,F=/(\\log_)(([0-9A-Za-z])|[\{]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^]+|(?:[\-]?(\\pi\s)))[\}])[\^](([0-9A-Za-z])|[\{]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^]+|(?:[\-]?(\\pi\s)))[\}])(([\-]?[\.][0-9]+)|([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[A-Za-z])|([\-]?(\\theta))|([\-]?(\\pi\s)))/g,G=/(\\sin|\\cos|\\tan|\\csc|\\sec|\\cot|\\sinh|\\cosh|\\tanh|\\csch|\\sech|\\coth|\\arcsin|\\arccos|\\arctan|\\arccsc|\\arcsec|\\arccot|\\log|\\ln)[\^]([0-9A-Za-z])(([\-]?[\.][0-9]+)|([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[A-Za-z])|([\-]?(\\theta))|([\-]?(\\pi\s)))/g,H=/(\\sin|\\cos|\\tan|\\csc|\\sec|\\cot|\\sinh|\\cosh|\\tanh|\\csch|\\sech|\\coth|\\arcsin|\\arccos|\\arctan|\\arccsc|\\arcsec|\\arccot|\\log|\\ln)[\^]([\{]([0-9a-zA-Z\+\_\.\-\\{}()\[\]\^]+|(?:[\-]?(\\pi\s)))[\}])(([\-]?[\.][0-9]+)|([\-]?[0-9]+[\.]?[0-9]*)|([\-]?[A-Za-z])|([\-]?(\\theta))|([\-]?(\\pi\s)))/g,I=this;for(a.expression=a.expression.replace(o,function(a){var b=I._INVERSIBLE_FUNCTIONS.indexOf(a);return I._INVERT_FUNCTIONS_IN_ORDER[b]}),a.expression=a.expression.replace(k,"\\fracdec"),a.expression=a.expression.replace(l,"\\abs"),a.expression=a.expression.replace(m,function(a,b){return"\\"+b+"("}),a.expression=a.expression.replace(n,")"),a.expression=a.expression.replace(p,q),a.expression=a.expression.replace(r,function(a,b,c,d){return"\\log_"+b+"("+d+")"}),a.expression=a.expression.replace(s,function(a,b,c){return"\\log_{"+b+"}"+c}),a.expression=a.expression.replace(t,function(a,b,c){return"\\log_{"+b+"}("+c+")"}),a.expression=a.expression.replace(u,function(a,b,c,d,e,f,g,h){return"\\prod_{n="+b+"}^{"+h+"}"}),a.expression=a.expression.replace(v,function(a,b,c,d,e,f,g,h){return"\\sum_{n="+b+"}^{"+h+"}"}),a.expression=a.expression.replace(w,function(a,b,c){return b+"("+c+")"}),a.expression=a.expression.replace(x,function(a,b,c){return b+"("+c+")"}),a.expression=a.expression.replace(y,function(a,b,c,d){return void 0===d||""===d?b+"("+c+")":b+"("+c+")"+d}),a.expression=a.expression.replace(z,function(a,b,c){return"h"===c?b+c:b+"("+c+")"}),a.expression=a.expression.replace(A,function(a,b,c){return c=null,"("+b+")\\%"}),a.expression=a.expression.replace(B,function(a,b,c){return c=null,"("+b+")\\%"}),a.expression=a.expression.replace(C,function(a,b,c){return void 0===b||""===b?"("+c+"\\%)\\%":b+"("+c+"\\%)\\%"}),d=1,f=function(a,b,c,e,f,g,h,i,j,k,l,m,n,o){return o.length>d&&(d=o.length),void 0===b||""===b?"("+c+"\\%)\\%":b+"("+c+"\\%)\\%"};0!==d;)a.expression=a.expression.replace(D,f),d--;for(a.expression=a.expression.replace(E,function(a,b,c,d,e,f,g,h,i,j,k){return"("+b+")"+k}),a.expression=a.expression.replace(F,function(a,b,c,d,e,f,g,h,i,j,k){var l="";return l=void 0===e||""===e?b+"{"+c+"}^{":b+"{"+e+"}^{",void 0===i||""===i?l+g+"}("+k+")":l+i+"}("+k+")"}),a.expression=a.expression.replace(G,function(a,b,c,d){return b+"^"+c+"("+d+")"}),a.expression=a.expression.replace(H,function(a,b,c,d,e,f){return b+"^"+c+"("+f+")"}),j=0;j<a.expression.length;j++)if(b=a.expression.charAt(j),"-"===b){if(0===j)continue;if(c=a.expression.charAt(j-1)," "===c&&(j>h&&(e=a.expression.substring(j-h,j)===g),e))continue;if(i.test(c))continue;a.expression=a.expression.substring(0,j)+"+-"+a.expression.substring(j+1,a.expression.length)}}},_processError:function(a){var b=window.open("","","width=200,height=200"),c=b.document;c.write("The error is :: <strong>"+a.errorString+"</strong>\n"),c.write("The error data is :: <strong>"+a.errorData+"</strong>\n")},_getValueOfConstantFromEquationData:function(a,b){return null===a||void 0===a?null:void 0===a.constants?null:void 0===a.constants[b]?null:a.constants[b]},_calculateMaxPowerOfVariable:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,e=null,f=null,g=null,h=!1,i=!1;e=d.Parser._getFreeVarPower(b.leftRoot,b.leftExpression.freevars);for(f in b.leftExpression.freevars)b.leftExpression.freevars[f]=e[f];g=null,b.freeVars={};for(g in b.leftExpression.freevars)g in b.freeVars?"c"!==b.freeVars[g]&&(b.freeVars[g]<b.leftExpression.freevars[g]||"c"===b.leftExpression.freevars[g])&&(b.freeVars[g]=b.leftExpression.freevars[g]):b.freeVars[g]=b.leftExpression.freevars[g];f=null;for(f in b.freeVars)if(c=b.freeVars[f],"c"!==c&&c!==1/0&&!isNaN(c)){i=!0;break}if(i!==!0)return b.canBeSolved=!1,b.errorCode="Complicated",void(b.errorString=d.EquationEnums.ERROR_COMPLICATED);f=null;for(f in b.freeVars)if(c=b.freeVars[f],"c"!==c&&c!==1/0&&!isNaN(c)&&2>=c&&0!==c){h=!0;break}return d.Parser._showConsole(d.Parser._debugFlag.common,"Max power",[]),d.Parser._showConsole(d.Parser._debugFlag.common,b.freeVars,[]),h===!1?(b.canBeSolved=!1,b.errorCode="NoneVariablesQuadratic",void(b.errorString=d.EquationEnums.ERROR_VARIABLE_HAS_TO_BE_QUADRATIC)):void 0},_substituteConstants:function(b,c,d){var e,f,g,h=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,i=[],j=!1;for(f=0;f<b.tokens.length;f++)e=void 0,g=!1,"const"===b.tokens[f].type&&(h.Parser._showConsole(h.Parser._debugFlag.common,"substituting value of constant "+b.tokens[f].value,[]),void 0===e&&(e=h.Parser._constants[b.tokens[f].value]),void 0===e?(d||void 0===c.constants[b.tokens[f].value])&&b.tokens[f].value!==c.pivot&&(g=!0,j=!0):(b.tokens[f].value=e,b.tokens[f].type="digit")),g&&-1===i.indexOf(b.tokens[f].value)&&i.push(b.tokens[f].value);j&&(b.errorData=i,c.errorCode="ConstantDeclaration",c.canBeSolved=!1,c.errorString=h.EquationEnums.ERROR_CONSTANTS_NOT_DEFINED,h.Parser._showConsole(h.Parser._debugFlag.common,"I found a constant that didnt have value specified ",[]),h.Parser._showConsole(h.Parser._debugFlag.common,c.errorData,[]))},_getBracketBounds:function(b,c){var d,e,f,g,h=b[c].value,i=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(null===b||void 0===b)return-1;if(0===b.length)return i.Parser._showConsole(i.Parser._debugFlag.common,"Empty tokens",[]),-1;if(b.length<c+1)return i.Parser._showConsole(i.Parser._debugFlag.common,"invalid start index "+c,[]),-1;for(i.Parser._showConsole(i.Parser._debugFlag.common,"Finding end token for "+h,[]),"{"===h?d="}":"("===h?d=")":i.Parser._showConsole(i.Parser._debugFlag.common,"Invalid Start Token "+h,[]),e=0,f=b.length,g=null,g=c+1;f>g;g++)if(i.Parser._showConsole(i.Parser._debugFlag.common,b[g].value+" >> "+h,[]),b[g].value===h)e++;else if(b[g].value===d&&(e--,-1===e))return g;return i.Parser._showConsole(i.Parser._debugFlag.common,"Cant find end token",[]),-1},_getFactoryToken:function(){var a={};return a.toString=function(){return"("+this.value+" "+this.type+" "+this.sign+")"},a},_processFunctionPowers:function(b){var c,d,e,f,g,h,i,j,k,l,m=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,n=null;for(c=0;c<b.length;c++)l=!1,d=b[c],0!==c&&(e=b[c-1],"func"===e.type?l=!0:(n=m.Parser._checkLogToBasePowerCase(b.slice(0,c)),null!==n&&(l=!0)),"^"===d.value&&l&&(f=m.Parser._getFunctionTokens(b.slice(c+1)),g=m.Parser._getFunctionTokens(b.slice(c+1+f.length)),h=m.Parser._getFactoryToken(),i=m.Parser._getFactoryToken(),h.type=i.type="delim",h.isValid=i.isValid=!0,h.sign=i.sign="+",h.value="(",i.value=")",j=b.slice(0,c-1),k=b.slice(c+f.length+1+g.length,b.length),null!==n?(b=j.slice(0,j.length-n.length-2),b.push(h),b=b.concat(n)):(b=j,b.push(h),b.push(e)),b=b.concat(g),b.push(i),b.push(d),b=b.concat(f),b=b.concat(k)));return b},_checkLogToBasePowerCase:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,f=b.length,g=0,h=null;for(c=f-1;c>=0;c--)if(d=b[c],e.ParsingProcedures._isOpeningBracket(d.value))g++;else if(e.ParsingProcedures._isClosingBracket(d.value))g--;else if(0===g){"\\log_"===d.value&&(h=b.slice(c,f));break}return h},_getFunctionTokens:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,f=b.length,g=0,h=[];for(c=0;f>c&&(d=b[c],h.push(d),e.ParsingProcedures._isOpeningBracket(d.value)?g++:e.ParsingProcedures._isClosingBracket(d.value)&&g--,0!==g);c++);return h},_generateTokens:function(b,c){var d,e,f,g,h,i,j,k,l=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,m=[],n=0,o="",p=[/^\\[a-z|\%|\_]+[\s]?$/i,/^[\[|\]|\}|\{|\(|\)|\,|\\{|\\}]$/i,/^[x|y]{1}$/,/^[\+|\-|\^|\!|<|\>]{1}$/,/^(([\.][0-9]+)|([0-9]+[\.]?[0-9]*))$/,/^[a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|z|A-Z]$/],q=["func","delim","var","opr","digit","const"],r=!1,s=null,t=!1;for("string"==typeof b?(d=b,j=!0):(d=b.expression,j=!1),h=d.length,l.Parser._showConsole(l.Parser._debugFlag.common,"parse expression called",[]),d=d.trim();h>n;){for(l.Parser._showConsole(l.Parser._debugFlag.tokens,">>"+d.charAt(n)+"<<",[]),o+=d.charAt(n),l.Parser._showConsole(l.Parser._debugFlag.tokens,"Analysing token "+o,[]),g=!1,i=0,k=p.length,i;k>i;i++){if(l.Parser._showConsole(l.Parser._debugFlag.tokens,"checking with token "+p[i]+" >>"+o+"<<",[]),f=p[i].test(o),f===!0){if(g=!0,void 0===e&&(e=l.Parser._getFactoryToken()),l.Parser._showConsole(l.Parser._debugFlag.tokens,"MATCH "+o+" with regex "+p[i],[]),e.value=o,e.isValid=!0,e.type=q[i],e.sign="+",void 0!==s&&null!==s?e.index=d.indexOf(o,s.index+1):e.index=d.indexOf(o),"func"===e.type)switch(-1!==o.indexOf("\\%")&&o.length>"\\%".length&&(g=!1,e.value="\\%",o="\\%"),o){case"\\cdot ":e.value="\\cdot",e.type="opr";break;case"\\pi":case"\\pi ":e.value="\\pi",e.type="const";break;case"\\%":e.value="\\%",e.type="opr";break;case"\\theta ":case"\\theta":e.value="\\theta",e.type="const";break;case"\\ge":case"\\ge ":e.value="\\ge";break;case"\\le":case"\\le ":e.value="\\le"}break}l.Parser._showConsole(l.Parser._debugFlag.tokens,"NO!! match "+p[i]+" >>"+o,[])}if(g===!1&&l.Parser._showConsole(l.Parser._debugFlag.tokens,"couldnt find a match for "+o+" in all possibilities",[]),void 0===f&&g===!1){l.Parser._showConsole(l.Parser._debugFlag.tokens,"This expression is invalid",[]),r=!1;break}if(g===!1?void 0!==e?r=!0:(l.Parser._showConsole(l.Parser._debugFlag.tokens,"will continue searching...",[]),r=!1):(n===h-1&&void 0!==e?(l.Parser._showConsole(l.Parser._debugFlag.tokens,"this is the last token it seems...finalizing..",[]),r=!0,n++):r=!1,l.Parser._showConsole(l.Parser._debugFlag.tokens,"will confirm the match",[])),r===!0){if(void 0!==e){if(l.Parser._showConsole(l.Parser._debugFlag.tokens,">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>TOKEN FOUND "+e.value,[]),j===!1&&("var"===e.type?(void 0===b.freevars&&(b.freevars={}),void 0===b.freevars[e.value]&&(l.Parser._showConsole(l.Parser._debugFlag.tokens,"---------------------recording var "+e.value+"-------------------------",[]),b.freevars[e.value]=0)):"const"===e.type&&(void 0===b.constants&&(b.constants={}),void 0===b.constants[e.value]&&(l.Parser._showConsole(l.Parser._debugFlag.tokens,"------------------ recording constant "+e.value+"--------------------",[]),b.constants[e.value]=1))),"-"===e.value){if(n===h)return c.canBeSolved=!1,void(c.errorCode="Complicated");t=!0}else t&&(t=!1,e.sign="-"),"const"===e.type&&(c.containsConstant=!0),m.push(e);o="",s=e,e=void 0}}else if(n++,j===!1&&n>=h&&void 0===e)return c.canBeSolved=!1,void(c.errorCode="Complicated")}return m},_checkIfFunctionParanthesis:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,f=b.length,g=0,h=!1;for(c=f-1;c>=0;c--)if(d=b[c],e.ParsingProcedures._isClosingBracket(d.value))g++;else if(e.ParsingProcedures._isOpeningBracket(d.value)&&(g--,0===g&&0!==c)){if("^"===b[c-1].value&&"func"===b[c-2].type){h=!0;break}if("func"===b[c-1].type)h=!0;else if("delim"===b[c-1].type)continue;break}return h},_processPointEquation:function(b,c){var d,e,f,g,h=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,i=[],j=b.length;if("("===b[0].value&&")"===b[j-1].value){for(c.solution=[],i.push(b[0]),d=1;j>d;d++)if(f=b[d-1],e=b[d],")"===f.value&&","===e.value||")"===e.value&&d===j-1){if(d===j-1)i.push(e);else if(h.Parser._checkIfFunctionParanthesis(b.slice(0,d))){i.push(e);continue}if(g=h.Parser._checkIfPoint(i,c),c.canBeSolved===!1||void 0===g)return;c.solution.push(g),i=[]}else i.push(e);return i.length>0&&c.solution.length>0?(c.canBeSolved=!1,void(c.errorCode="CannotUnderstandThis")):void(c.solution.length>0&&(c.type="point"))}},_checkIfPoint:function(b,c){var d,e,f,g,h,i,j,k,l=[],m=[],n=!0,o=b.length,p=0,q=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,r=-1,s=!1;if("("===b[0].value&&")"===b[o-1].value){for(d=1;o-1>d;d++){if(e=b[d],"func"===e.type)q.Parser._isCommaFunction(e.value)&&p++;else if(","===e.value){if(0===p){r=e.index,n=!1;continue}p--}n?l.push(e):m.push(e)}if(!n&&(f=new a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.EquationData,g=new a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.EquationData,f.equation=c.leftExpression.expression.substring(b[0].index+1,r),void 0!==c.pivot&&(f.pivot=g.pivot=c.pivot),f.constants=g.constants=c.constants,f.units=g.units=c.units,q.Parser.parseEquation(f),"number"===f.type||"ConstantDeclaration"===f.errorCode||"expression"===f.type?("ConstantDeclaration"===f.errorCode&&(s=!0),
g.equation=c.leftExpression.expression.substring(r+1,b[o-1].index),q.Parser.parseEquation(g),"number"===g.type||"expression"===g.type?k=[f.solution,g.solution]:"ConstantDeclaration"===g.errorCode?s=!0:(c.canBeSolved=!1,c.errorCode="CannotUnderstandThis")):(c.canBeSolved=!1,c.errorCode="CannotUnderstandThis"),s)){if(c.canBeSolved=!1,c.errorCode="ConstantDeclaration",c.errorData=[],void 0!==f.errorData)for(h=0,i=f.errorData.length,h;i>h;h++)j=f.errorData[h],-1===c.errorData.indexOf(j)&&c.errorData.push(j);if(void 0!==g.errorData)for(h=0,i=g.errorData.length,h;i>h;h++)j=g.errorData[h],-1===c.errorData.indexOf(j)&&c.errorData.push(j)}return k}},_parseExpression:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;d=e.Parser._generateTokens(b,c),c.containsConstant!==!0&&(c.containsConstant=!1),c.canBeSolved!==!1&&(e.Parser._processPointEquation(d,c),c.canBeSolved!==!1&&"point"!==c.type&&(d=e.Parser._processFunctionPowers(d),d=e.Parser._addInvisibleCdotToTokens(d),e.Parser._adjustPostFixOperatorPowers(d),$("#left-column-container").width($("#button-container").width()+$("#equation").width()+$(".mathquill-editable").width()+50),b.tokens=d))},_adjustPostFixOperatorPowers:function(b){var c,d,e,f,g,h,i=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,j=["^","!","\\%"];for(c=0;c<b.length;c++)if(e=b[c],f=[],-1!==j.indexOf(e.value)&&0!==c)for(i.Parser._showConsole(i.Parser._debugFlag.common,"Checking for power sign at "+c,[]),d=c-1;d>=0;d--)if(g=b[d],"delim"!==g.type){if(i.Parser._showConsole(i.Parser._debugFlag.common,"Current left token is "+g+" stack is "+f,[]),!(f.length>0||"var"!==g.type&&"const"!==g.type&&"digit"!==g.type)){i.Parser._showConsole(i.Parser._debugFlag.common,"terminal found ignoring the sign "+g,[]),e.sign=g.sign,g.sign="+";break}}else if(0===f.length&&(h=!0),i.Parser._showConsole(i.Parser._debugFlag.common,"Recording bracket "+g.value,[]),i.ParsingProcedures.recordBracket(f,g.value),h===!0&&0===f.length){i.Parser._showConsole(i.Parser._debugFlag.common,"stealing the sign of "+g,[]),e.sign=g.sign,g.sign="+";break}},_printTokens:function(b,c){var d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;d.Parser._showConsole(d.Parser._debugFlag.common,"******************************************************************",[]),d.Parser._showConsole(d.Parser._debugFlag.common,c+" All Tokens Are "+b.tokens,[]),d.Parser._showConsole(d.Parser._debugFlag.common,"******************************************************************",[])},_addInvisibleCdotToTokens:function(b){var c,d,e,f,g,h,i,j,k=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,l=["var","const","func"],m=["("],n={"var":{tokenTypes:["var","const","digit"],tokenValues:[")","!","}"]},"const":{tokenTypes:["var","const","digit"],tokenValues:["}",")","!","\\%"]},func:{tokenTypes:["var","const","digit"],tokenValues:[")","!","}","\\%"]},"(":{tokenTypes:["var","const","digit"],tokenValues:[")","!","}"]}},o=0,p=/^([0-9]+[\.])$/,q=k.Parser._getFactoryToken();for(q.type="opr",q.value="\\cdot",q.sign="+",q.isValid=!0,o=1;o<b.length;o++)if(c=b[o-1],d=b[o],e=-1!==l.indexOf(d.type),f=-1!==m.indexOf(d.value),(e||f)&&(i=e?d.type:d.value,-1!==n[i].tokenTypes.indexOf(c.type)||-1!==n[i].tokenValues.indexOf(c.value))){if("digit"===c.type&&null!==c.value.match(p))continue;if("("===d.value&&"}"===c.value){if(j=k.Parser._isFractionBrace(b.slice(0,o)),!j)continue;if(null!==k.Parser._checkLogToBasePowerCase(b.slice(0,o)))continue}g=b.slice(0,o),g.push(q),h=b.slice(o,b.length),b=g.concat(h),o++}return b},_isFractionBrace:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,f=b.length,g=0;for(c=f-1;c>=0;c--)if(d=b[c],e.ParsingProcedures._isOpeningBracket(d.value))g++;else if(e.ParsingProcedures._isClosingBracket(d.value))g--;else if(0===g&&("\\frac"===d.value||"\\sqrt"===d.value))return!0;return!1},_getFreeVarPower:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,r={};if(b.isTerminal){j=null;for(j in c)o=0,b.value===j&&(o=1),r[j]=o}else{for(d=[],e=0,f=b.params.length,e;f>e;e++)d.push(q.Parser._getFreeVarPower(b.params[e],c));switch(b.name){case"+":for(g=0,h=d.length,g;h>g;g++){i=d[g],j=null;for(j in i)j in r?"c"!==r[j]&&("c"===i[j]||r[j]<i[j])&&(r[j]=i[j]):r[j]=i[j]}break;case"\\cdot":for(g=0,h=d.length,g;h>g;g++){i=d[g],j=null;for(j in i)j in r?"c"!==r[j]&&("c"===i[j]?r[j]=i[j]:r[j]+=i[j]):r[j]=i[j]}break;case"^":case"\\frac":j=null;for(j in d[1])0!==d[1][j]?r[j]="c":r[j]=d[0][j];k=!1,j=null;for(j in r)"c"===r[j]&&(k=!0),"^"===b.name&&r[j]<0&&(k=!0);if("^"===b.name){j=null;for(j in d[0])k&&d[1][j]>0?r[j]="c":d[0][j]>0&&(b.params[1].isTerminal===!0&&"digit"===b.params[1].type?(p=Number(q.TreeProcedures._getValueFromParam(b.params[1])),r[j]=0>p?"c":0===r[j]?p:r[j]*p):r[j]="c")}else{j=null;for(j in d[0])"c"!==r[j]&&(r[j]=d[0][j])}break;default:for(l=0,m=d.length,l;m>l;l++){n=d[l],j=null;for(j in n)n[j]>0||"c"===n[j]?r[j]="c":r[j]=0}}}return r},_displayArrayOfObjects:function(b,c,d,e){var f,g,h,i,j,k=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(k.Parser._deploy!==!0)if(void 0!==b){for(void 0===e&&(e="black"),void 0===d&&(d="#777700"),f=$("#"+c),f.parent().css({border:"1px solid black"}),f.css({border:"1px solid","border-color":k.Parser._borderColor,position:"relative","overflow-x":"hidden"}),g=0,h=b.length,g;h>g;g++)i=b[g],j=$("<div>"+i+"</div>"),j.attr("class","tokens"),f.append(j);$(".tokens").css({"float":"left",border:"1px solid black",margin:"5px",padding:"5px","background-color":d,color:e,"font-weight":"bold"})}else k.Parser._showConsole(k.Parser._debugFlag.common,"The objects provided is undefined",[])},_generateAnalysis:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,g=b.leftExpression.tokens,h=b.rightExpression.tokens;if(f.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("leftProductionRules"),e=f.Parser._recursiveDescentParser(b,g,0,0,[void 0],!1),f.Parser._deploy||(b.profiles[2]=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("leftProductionRules")),b.canBeSolved!==!1&&(f.Parser._displayArrayOfObjects(e,"production-rules-display-left","#777700","white"),f.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("rightProductionRules"),c=f.Parser._recursiveDescentParser(b,h,0,0,[void 0],!1),f.Parser._deploy||(b.profiles[2]+=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("rightProductionRules")),b.canBeSolved!==!1)){if(f.Parser._displayArrayOfObjects(c,"production-rules-display-right","#777700","white"),void 0===e||void 0===c)return b.canBeSolved=!1,b.errorCode="CannotUnderstandThis",void f.Parser._showConsole(f.Parser._debugFlag.common,"%c[STAGE2 - FAIL]Left Prediction Rules Failed",[f.Parser._NSTYLE]);if(f.Parser._showConsole(f.Parser._debugFlag.common,"%c[STAGE2 - Success]Prediction rules Generated Left:"+e,[f.Parser._YSTYLE]),f.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("generateTree"),b.leftRoot=f.TreeProcedures.generateTree(e,0,b.units),b.rightRoot=f.TreeProcedures.generateTree(c,0,b.units),f.Parser._deploy||(b.profiles[3]=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("generateTree")),"graphing"===b.directives.FDFlagMethod&&"frac"===b.analysis.FDFlag&&("\\frac"===b.leftRoot.name||"do"===b.leftRoot.name&&"\\frac"===b.leftRoot.params[0].name)&&(b.analysis.FDFlag="decimal","do"===b.leftRoot.name?f.Parser._checkIfFracHasNonFracChilds(b.leftRoot.params[0],b):f.Parser._checkIfFracHasNonFracChilds(b.leftRoot,b)),"calculator"===b.directives.FDFlagMethod&&(b.analysis.FDFlag=0===f.Parser._getAnalysisForFD(b.leftRoot)?"frac":"decimal"),f.Parser._deploy||a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("simplify"),b.leftRoot.isTerminal||b.leftRoot.simplify(b),b.rightRoot&&!b.rightRoot.isTerminal&&b.rightRoot.simplify(b),f.Parser._deploy||(b.profiles[4]=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getProcessingTime("simplify")),b.leftRoot.isTerminal&&"digit"===b.leftRoot.type&&b.rightRoot&&!b.analysis.rhsAuto&&b.rightRoot.isTerminal&&"digit"===b.rightRoot.type)return b.canBeSolved=!1,b.errorString="Try adding some free variables",void(b.errorCode="CannotUnderstandThis");if(f.Parser._showConsole(f.Parser._debugFlag.common,"%c[STAGE4 - SUCCESS]Tree Simplified",[f.Parser._YSTYLE]),f.Parser._deploy||f.Parser._printLatex(b.leftRoot,4,!0),"expression"!==b.type&&f.TreeProcedures.combineLeftRightTree(b),d=b.leftRoot,void 0===b.leftRoot)return b.canBeSolved=!1,b.errorCode="CannotUnderstandThis",void f.Parser._showConsole(f.Parser._debugFlag.common,"%c[STAGE3 - FAIL]Left Equation Tree Generation Failed",[f.Parser._NSTYLE]);f.Parser._showConsole(f.Parser._debugFlag.common,"%c[STAGE3 - Success]Equation Tree Generated",[f.Parser._YSTYLE]),f.Parser._deploy||f.Parser._printLatex(d,3,!0),"expression"===b.type&&(b.solution=f.TreeProcedures._substituteParamVariableAndGetValue(b.leftRoot,b.constants)),f.Parser._deploy||f.TreeProcedures._toLatex(d)}},_checkIfFracHasNonFracChilds:function(b,c){if("frac"!==c.analysis.FDFlag){var d,e,f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(!b.isTerminal)if("\\frac"===b.name){for(f=b.params,e=f.length,d=0;e>d;d++)if(g.Parser._checkIfFracHasNonFracChilds(f[d],c),"frac"===c.analysis.FDFlag)return}else c.analysis.FDFlag="frac"}},_getAnalysisForFD:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,g=1;if(b.isTerminal)return"digit"===b.type?-1!==b.value.toString().indexOf(".")?NaN:1:"const"===b.type&&("e"===b.value||"\\pi"===b.value)?NaN:1;if(f.TreeProcedures.isOperator(b.name)||"do"===b.name){for(d=b.params.length,c=0;d>c;c++)if(e=f.Parser._getAnalysisForFD(b.params[c]),g=e*g,isNaN(g))return NaN;return g}return"\\frac"===b.name?0:NaN},_showRules:function(){var a=window.open("","","width=700,height=700"),b=$("<textarea>"+$("#rules").text()+"</textarea>");b.css({width:"600px",height:"600px"}),$(a.document.body).append(b)},_printLatex:function(b,c,d){var e,f,g,h,i,j,k,l,m=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;m.Parser._deploy!==!0&&(e={0:"Preprocessing",1:"Token Generation",2:"Create Production Rules",3:"Generate Equation Tree",4:"Simplify",5:"Find Equation Solvability",6:"Expand Equation",7:"Convert to Quadratic Form",8:"Solve"},f=$("<div></div>"),h=$("#display-outter-container"),h.append(f),g=$("<div></div>"),g.attr("id","header"+c).css({"font-weight":"bold"}).html(e[c]),f.attr("id","stage-number"+c).append(g).css({border:"1px solid black",padding:"10px 5px 5px 10px",margin:"25px 5px 5px 5px"}),i=m.TreeProcedures._toLatex(b),j=$("<span></span>"),j.attr("id","stage"+c).css({border:"1px solid","border-color":m.Parser._borderColor,margin:"5px 5px 5px 5px",padding:"5px 5px 5px 5px"}),f.append(j),$("#stage"+c).append(i).mathquill(),f.append("<br/>"),d&&(k=$("<canvas></canvas>"),k.attr("id","canvas-stage"+c).css({border:"1px solid","border-color":m.Parser._borderColor}),f.append(k),l=["canvas-stage"+c],m.Parser._displayTree(b,l),m.Parser._showConsole(m.Parser._debugFlag.common,"The latex string is "+i,[])))},_recursiveDescentParser:function(b,c,d,e,f,g){if(b.canBeSolved!==!1&&0!==c.length){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,z=c[d],A=d,B=y.ParsingProcedures.getPredictionStacksForToken(z,"E",g);if(void 0===B&&(y.Parser._showConsole(y.Parser._debugFlag.common,"############################### ERROR ##########################",[]),y.Parser._showConsole(y.Parser._debugFlag.common,"no rules found for E ->"+z.value,[])),h=d,i=0,l=0,p=[],q=[],void 0===B)return b.canBeSolved=!1,void(b.errorCode="CannotUnderstandThis");for(y.Parser._showConsole(y.Parser._debugFlag.rules,"----------------------Begin recursion "+e+"------------------ with lookahead "+f,[]),k=0;k<B.length;k++)if(r=[],j=[],g?(y.ParsingProcedures.cloneStringStack(y.RangeProductionRules.rangeRules[B[k]],j),y.Parser._showConsole(y.Parser._debugFlag.rules,"for "+B[k]+" rules are "+y.RangeProductionRules.rangeRules[B[k]],[])):(y.ParsingProcedures.cloneStringStack(y.Parser._productions.productionRules[B[k]],j),y.Parser._showConsole(y.Parser._debugFlag.rules,"for "+B[k]+" rules are "+y.Parser._productions.productionRules[B[k]],[])),r.push(B[k]),y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[Predict "+e+"] Level "+e+" by rule "+B[k]+" Processing prediction "+j,[y.Parser._HSTYLE]),h=d,i=0,o=!0,s=!1,u=y.ParsingProcedures.isStackInfinite(j),u!==!0||y.ParsingProcedures.verifyStackWithLookahead(j,f)!==!1){for(;i<j.length;){if(n=y.ParsingProcedures.peekInPredictionStack(j,i),z=c[h],y.Parser._showConsole(y.Parser._debugFlag.rules,z+" <> "+n+" >> "+y.ParsingProcedures.isTokenSame(z,n),[]),y.ParsingProcedures.isTokenSame(z,n))r.push(z);else if(y.ParsingProcedures.isNonTerminal(n)){if(y.Parser._showConsole(y.Parser._debugFlag.rules,"TErminal Node...going in...stack so far "+r,[]),w=y.ParsingProcedures.pushAllLookAheads(f,j,i+1),y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[PAUSE "+e+"]",[y.Parser._BLUE_STYLE]),t=y.Parser._recursiveDescentParser(b,c,h,e+1,f,g),b.canBeSolved===!1)return;for(m=0;w>m;m++)f.pop();if(y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[RESUME "+e+"]>>>>Recursion level "+e+" resumes with solution "+t,[y.Parser._BLUE_STYLE]),void 0===t){y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[FAIL "+e+"] prediction "+j+" is invalid...REJECTING at "+r,[y.Parser._NSTYLE]),o=!1;break}for(y.Parser._showConsole(y.Parser._debugFlag.rules," recursion will resume from index "+t.tokenPointer,[]),h=t.tokenPointer,l=0;l<t.length;l++)r.push(t[l])}else{if(!(u&&s&&y.ParsingProcedures.isTermInfinite(j[i]))){o=!1,y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[FAIL "+e+"] STack match failed...DISCARDING stack!!! "+j,[y.Parser._NSTYLE]);break}v=j[i],i>=j.length?(y.Parser._showConsole(y.Parser._debugFlag.rules,"Finished chasing recursive term "+v+" from total stack :"+j,[]),s=!1):(o=!0,y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[ACCEPT "+e+"]Stack matched so far...dumping ALL infinite term and breaking: "+j+" recursionIndex :: "+e,[y.Parser._YSTYLE]))}if(i++,h++,u&&y.ParsingProcedures.isTermInfinite(j[i]))if(x=c[h],y.Parser._showConsole(y.Parser._debugFlag.rules,"trying to match peek from "+j[i]+" >> "+y.ParsingProcedures._getPeekValue(j[i])+" with next token "+x,[]),void 0!==x)if(y.ParsingProcedures._getPeekValue(j[i])!==c[h].value){if(s===!1){o=!1,y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[FAIL "+e+"] "+j[i]+" is NOT used...DISCARDING stack!!! "+j,[y.Parser._NSTYLE]);break}if(i+1>=j.length){if(y.ParsingProcedures.checkWithLookAhead(c[h],f)){o=!0;break}o=!1,y.Parser._showConsole(y.Parser._debugFlag.rules," All recursive terms are used and exhausted...breaking the chain for stack "+j+" and lookahead "+f,[]);break}y.Parser._showConsole(y.Parser._debugFlag.rules,"match FAILED so moving on to "+j[i+1],[]),s=!0,y.ParsingProcedures.expandRecursiveStack(j,i+1),i++}else y.Parser._showConsole(y.Parser._debugFlag.rules,"match success expanding "+j[i],[]),s=!0,y.ParsingProcedures.expandRecursiveStack(j,i);else y.Parser._showConsole(y.Parser._debugFlag.rules,"All tokens are over...No need to expand stack "+j,[]);if(h>=c.length&&i<j.length){y.Parser._showConsole(y.Parser._debugFlag.common,"Checking when tokens are over and stack is not: recursive is "+u,[]),u?s&&i===j.length-1?(y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[ACCEPT "+e+"] prediction accepted "+j,[y.Parser._YSTYLE]),o=!0):(o=!1,y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[FAIL "+e+"]Tokens are finished but there are unexpanded recursive terms...rejecting the prediction "+j+" at index "+i,[y.Parser._NSTYLE]),y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[FAIL]There was an error in syntax of equation. We could not find "+j[i],[y.Parser._NSTYLE])):(y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[FAIL "+e+"]Tokens are finished when prediction stack is NOT...REJECTING the prediction",[y.Parser._NSTYLE]),o=!1);break}if(i>=j.length&&h<c.length){y.Parser._showConsole(y.Parser._debugFlag.rules,"Prediction Stack over: Checking with lookahead "+c[h]+" <> "+f,[]),y.ParsingProcedures.checkWithLookAhead(c[h],f)?(y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[ACCEPT "+e+"]Prediction stack finished and lookahead matches...ACCEPTING the prediction by rule "+B[k],[y.Parser._YSTYLE]),o=!0):(y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[FAIL "+e+"]Prediction stack finished and lookahead doesnt match...REJECTING the prediction by rule "+B[k],[y.Parser._NSTYLE]),o=!1);break}}if(o===!0){y.Parser._showConsole(y.Parser._debugFlag.rules,"checking if the accepted solution is final :: "+y.ParsingProcedures.checkWithLookAhead(z,f),[]),y.Parser._showConsole(y.Parser._debugFlag.rules,"checking if the accepted solution is final :: "+y.ParsingProcedures.checkWithLookAhead(z,f),[]),y.Parser._showConsole(y.Parser._debugFlag.rules,"Prediction accepted is "+r,[]),r.tokenPointer=h-1,q.push(r);break}}else y.Parser._showConsole(y.Parser._debugFlag.rules,"%c[FAIL "+e+"]Rejecting STACk "+j+" because we cant pursue same GOAL again...",[y.Parser._NSTYLE]);if(y.Parser._showConsole(y.Parser._debugFlag.rules,q.length+" Solutions found ....",[]),y.Parser._showConsole(y.Parser._debugFlag.rules,"----------------------End recursion "+e+"------------------"),q.length>1)for(y.Parser._showConsole(y.Parser._debugFlag.common,"=================================ACCEPTED PREDICTIONS ARE MORE THAN ONE!!!!==================================after "+A,[]),m=0;m<q.length;m++)y.Parser._showConsole(y.Parser._debugFlag.common,"Prediction is "+q[m],[]);else if(1===q.length)return q[0]}},_displayTree:function(b,c){var d,e,f,g,h=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,i=0,j=[],k=null;if(d=window.innerWidth-($("#button-container").width()+$("#equation").width()+$(".mathquill-editable").width()+100),$("#canvasContainer").width(d),e=[],"object"==typeof c)e=c;else for(f=1;f<arguments.length;f++)e[f-1]=arguments[f];for(g=e.length;g>i;i++)"string"==typeof e[i]&&(j[i]=new paper.PaperScope,k=document.getElementById(e[i]),j[i].setup(k),h.Parser._nodeDisplay(b,!0,j[i],k))},_nodeDisplay:function(b,c,d,e){var f,g,h,i,j,k,l=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,m=0,n=0,o=l.Parser._getTextWidth($("<div></div>").html(b.toString()),!0),p=[0],q=0;if(c){for(g=[],b.isTerminal||(n=b.params.length),l.Parser._nodeCounter(b,q.toString(),g,p),l.Parser._totalNodeCounter(g),h=null,f=0;n>f;f++)h=l.Parser._getTextWidth($("<div></div>").html(b.params[f].toString()),!0),h>o&&(o=h);for(i=1,f=0;f<g.length;f++)2===g[f].name.length&&(i+=g[f].totalNode);j=p[0]*(100+o)+100,k=30*i,$(e).height(k),$(e).width(j),paper=d,paper.view.viewSize=[j,k],l.Parser._textOnCanvas(b.toString(),m.toString(),o,g),l.Parser._subnodeDisplay(b,m.toString(),o,g),l.Parser._textOnCanvas(b.toString(),m.toString(),o,g),l.Parser._arrowGenerator(),paper.view.draw()}},_nodeCounter:function(b,c,d,e){var f,g,h=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,i=0;if(b.isTerminal)f={name:c,childNode:0,totalNode:0},d.push(f);else{for(i=0,g=b.params.length;g>i;i++)h.Parser._nodeCounter(b.params[i],c+i,d,e);"0"!==c&&(f={name:c,childNode:g,totalNode:0},d.push(f)),e[0]++}},_totalNodeCounter:function(a){for(var b,c,d,e,f,g=0,h=a.length;h>g;g++){for(b=a[g].name,e=b.length,d=b.substring(0,e-1),c=g+1;h>c;c++)if(a[c].name===d){0!==a[g].totalNode?a[c].totalNode+=a[g].totalNode:(f=a[g].childNode,0===f&&(f=1),a[c].totalNode=a[c].totalNode+f);break}0===a[g].childNode&&(a[g].totalNode=1)}},_subnodeDisplay:function(b,c,d,e){var f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,h=0,i=0;if(!b.isTerminal&&(f=b.params.length,0!==f))for(;f>h;h++)g.Parser._subnodeDisplay(b.params[h],c+h,d,e),i=b.params[h].toString(),g.Parser._textOnCanvas(i,c+h,d,e)},_textOnCanvas:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,u=c.length,v=0;for(h=(u-1)*(100+d);u>v;v++)switch(v){case 0:i=20;break;default:for(k=c.substring(0,v+1),l=k.length,o=k[l-1],p=parseInt(o,10),f=0,f=p-1;f>=0;f--)for(m=k.split(""),m[l-1]=f.toString(),n=m.join(""),g=0,g=0;g<e.length;g++)if(e[g].name===n){i+=30*e[g].totalNode;break}}j=d+30,q=new Path.Rectangle({point:[h,i-12],size:[j,20],strokeWidth:2,strokeColor:"#000000"}),q.subNodeRoot=c,r=t.Parser._getTextWidth($("<div></div>").html(b),!0),s=(j-r)/2,b=new PointText({point:[h+s,i],content:b,fontSize:12,fillColor:"black"})},_arrowGenerator:function(){for(var a,b,c,d=paper.project.activeLayer.children,e=d.length,f=0,g=new Point,h=new Point,i=new Point;e>f;f++)if(f%2===0)for(a=d[f].subNodeRoot,a=a.substring(0,a.length-1),b=f;e>b;b++)d[b].subNodeRoot===a&&(g.x=(d[f].segments[0].point.x+d[f].segments[1].point.x)/2,g.y=(d[f].segments[0].point.y+d[f].segments[1].point.y)/2,h.x=(d[b].segments[2].point.x+d[b].segments[3].point.x)/2,h.y=(d[b].segments[2].point.y+d[b].segments[3].point.y)/2,g.y!==h.y?(i.x=(h.x+g.x)/2,i.y=h.y,c=new Path({segments:[i,[i.x,g.y],g],strokeWidth:2,strokeColor:"#000000"})):c=new Path({segments:[g,h],strokeWidth:2,strokeColor:"#000000"}))},_getTextWidth:function(a,b){b&&$("body").append(a);var c,d=a.html(),e="<span>"+d+"</span>";return a.html(e),c=a.find("span:first").width(),a.html(d),b&&a.detach(),c},_showConsole:function(a,b,c){a=b=c=void 0}}),a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.TreeProcedures=Backbone.Model.extend({},{_mathFunctions:a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.MathFunctions,_productions:a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Productions,_toLatex:function(b){var c,d,e,f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(b.isTerminal!==!1)return"+"===b.sign?b.value:b.value<0?-1*b.value:b.sign+b.value;for(c=[],e=0;e<b.params.length;e++)c.push(g.TreeProcedures._toLatex(b.params[e])),g.Parser._showConsole(g.Parser._debugFlag.common,c,[]);switch(d="","-"===b.sign&&(d="-"),b.name){case"do":return d+=c[0];case"^":return d+=b.params[0].isTerminal===!0?c[0]:g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[0].name)?"\\left("+c[0]+"\\right)":c[0],d+=b.params[1].isTerminal===!0?"^"+c[1]:g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[1].name)?"^\\left("+c[1]+"\\right)":"^"+c[1];case"+":for(d+=c[0],f=1;f<c.length;f++)d+="+"+c[f];return d;case"\\cdot":for(d+=b.params[0].isTerminal===!1&&g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[0].name)?"\\left("+c[0]+"\\right)":c[0],f=1;f<c.length;f++)d+=b.params[f].isTerminal===!0?"\\cdot "+c[f]:g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[f].name)?"\\cdot \\left("+c[f]+"\\right)":"\\cdot "+c[f];return d;case"\\frac":return d+="\\frac {"+c[0]+"}{"+c[1]+"}";case"\\sqrt":return d="",d+=b.params[0].isTerminal===!1?"\\sqrt [\\left("+c[0]+"\\right)]":"\\sqrt ["+c[0]+"]",d=b.params[1].isTerminal===!1?d+" {\\left("+c[1]+"\\right)}":d+" {"+c[1]+"}";case"\\log_":return d="",d+=b.params[0].isTerminal===!1?"\\log_{\\left("+c[0]+"\\right)}":"\\log_{"+c[0]+"}",d=d+" \\left("+c[1]+"\\right)";case"\\log":case"\\ln":case"\\sin":case"\\cos":case"\\tan":case"\\csc":case"\\sec":case"\\cot":case"\\arcsin":case"\\arccos":case"\\arctan":case"\\arccsc":case"\\arcsec":case"\\arccot":case"\\sinh":case"\\cosh":case"\\tanh":case"\\csch":case"\\sech":case"\\coth":return d+=b.params[0].isTerminal===!1?b.name+" \\left("+c[0]+"\\right)":b.name+" "+c[0];case"\\ceil":case"\\floor":case"\\round":case"\\abs":case"\\exp":return d+=b.name+" \\left("+c[0]+"\\right)";case"!":return d="",d=b.params[0].isTerminal===!1?"\\left("+c[0]+"\\right)!":c[0]+"!";case"\\lcm":case"\\gcd":case"\\mod":case"\\min":case"\\max":case"\\nCr":case"\\nPr":return d+=b.params[0].isTerminal===!1?b.name+" \\left( \\left( "+c[0]+"\\right) , ":b.name+" \\left( "+c[0]+" , ",d+=b.params[1].isTerminal===!1?" \\left( "+c[1]+"\\right) \\right)":c[1]+"\\right)";case"\\prod":case"\\sum":return d+=b.params[0].isTerminal===!1?b.name+"{n=\\left("+c[0]+"\\right)}^":b.name+"{n="+c[0]+"}^",d+=b.params[1].isTerminal===!1?"{ \\left("+c[1]+"\\right)}":"{"+c[1]+"}",d+=b.params[2].isTerminal===!1?" \\left("+c[2]+"\\right)":c[2];case"\\%":return d+=b.params[0].isTerminal?b.params[0].value+b.name:c[0]+b.name}},_toAccessible:function(b){var c,d,e,f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(b.isTerminal!==!1)return"+"===b.sign?b.value:b.value<0?-1*b.value:b.sign+b.value;for(c=[],e=0;e<b.params.length;e++)c.push(g.TreeProcedures._toAccessible(b.params[e])),g.Parser._showConsole(g.Parser._debugFlag.common,c,[]);switch(d="","-"===b.sign&&(d=" negative "),b.name){case"do":return d+=c[0];case"^":return d+=b.params[0].isTerminal===!0?c[0]:g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[0].name)?"( "+c[0]+" )":c[0],d+=b.params[1].isTerminal===!0?" to the power "+c[1]:g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[1].name)?" to the power ("+c[1]+" )":" to the power "+c[1];case"+":for(d+=c[0],f=1;f<c.length;f++)d+=" + "+c[f];return d;case"\\cdot":for(d+=b.params[0].isTerminal===!1&&g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[0].name)?"("+c[0]+")":c[0],f=1;f<c.length;f++)d+=b.params[f].isTerminal===!0?" into "+c[f]:g.ParsingProcedures.getOperatorPrecedenceIndex(b.name)>g.ParsingProcedures.getOperatorPrecedenceIndex(b.params[f].name)?" into ("+c[f]+")":" into "+c[f];return d;case"\\frac":return d+=c[0]+" upon "+c[1];case"\\sqrt":return d="",d+=c[0]+" th root ",d+=c[1];case"\\log_":return d="",d+="log to the base "+c[0],d=d+" ("+c[1]+")";case"\\log":case"\\ln":case"\\sin":case"\\cos":case"\\tan":case"\\csc":case"\\sec":case"\\cot":case"\\arcsin":case"\\arccos":case"\\arctan":case"\\arccsc":case"\\arcsec":case"\\arccot":case"\\sinh":case"\\cosh":case"\\tanh":case"\\csch":case"\\sech":case"\\coth":case"\\ceil":case"\\floor":case"\\round":case"\\abs":case"\\exp":return d+=b.params[0].isTerminal?b.name.substring(1)+" "+c[0]:b.name.substring(1)+" of "+c[0];case"!":return d="",d=c[0]+" factorial ";case"\\lcm":case"\\gcd":case"\\mod":case"\\min":case"\\max":case"\\nCr":case"\\nPr":return d+=g.TreeProcedures._getAccessibleName(b.name)+" of "+c[0]+" & "+c[1];case"\\prod":case"\\sum":return d+=b.name+"{n=\\left("+c[0]+"\\right)}^",d+=b.params[1].isTerminal===!1?"{ \\left("+c[1]+"\\right)}":"{"+c[1]+"}",d+=b.params[2].isTerminal===!1?" \\left("+c[2]+"\\right)":c[2];case"\\%":return d+=c[0]+" percent"}},_getAccessibleName:function(a){var b={"\\lcm":"least common multiplier","\\gcd":"greatest common divisor","\\mod":"modulas","\\min":"minimum","\\max":"maximum","\\nCr":"combinations","\\nPr":"permutations","\\ceil":"ceil value","\\floor":"floor value","\\round":"rounded value","\\abs":"absolute value","\\exp":"exponential value"};return void 0===b[a]?"":b[a]},_clone:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(b.isTerminal===!0)c=f.TreeProcedures._getParseTreeTerminalObject(void 0,b.type,b.sign,b.units),c.isEmpty=b.isEmpty,c.value=b.value;else{for(c=f.TreeProcedures._getParseTreeNodeObject(void 0,b.name,b.sign,void 0),d=[],e=0;e<b.params.length;e++)c._addParam(f.TreeProcedures._clone(b.params[e]));c.allTermsDigits=b.allTermsDigits,c.isEmpty=b.isEmpty}return c},convertToSolvableForm:function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;for(c=b.leftRoot,d=b.functionVariable,e=b.paramVariable,c.expand(d,b),y.Parser._showConsole(y.Parser._debugFlag.common,"%c[STAGE6 - Complete]Expansion Complete",[y.Parser._YSTYLE]),y.Parser._deploy||y.Parser._printLatex(c,6,!0),y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"%c[CHECKPOINT] after expansion... "+y.TreeProcedures._toLatex(c),[y.Parser._BLUE_STYLE]),c.isTerminal===!1&&"+"===c.name?k=y.TreeProcedures._extractAllParams(c):(k=[],k.push(y.TreeProcedures._clone(c)),y.TreeProcedures._removeAllParams(c)),l=[],m=[],n=[];k.length>0;){if(f=y.TreeProcedures._getFunctionVariableSegregationIndex(k[0],d),void 0===f)return void y.Parser._showConsole(y.Parser._debugFlag.common,"%c[FAIL - STAGE7]CANT CONVERT THIS EQUATION TO SOLVABLE FORM>>> SOMETHING IS WRONG",[y.Parser._NSTYLE]);switch(y.Parser._showConsole(y.Parser._debugFlag.convert2q,"Segregation index is "+f,[]),f){case 2:g=k.shift(),y.TreeProcedures._commonOutFunctionVariable(g,d),l.push(g);break;case 1:g=k.shift(),y.TreeProcedures._commonOutFunctionVariable(g,d),m.push(g);break;case 0:n.push(k.shift());break;default:return void y.Parser._showConsole(y.Parser._debugFlag.common,"%c[FAIL - STAGE7]CANT CONVERT THIS EQUATION TO SOLVABLE FORM>>> SOMETHING IS WRONG",[y.Parser._NSTYLE])}}if(l.length>0){if(r=y.TreeProcedures._getParseTreeNodeObject(void 0,"\\cdot","+",void 0),o=y.TreeProcedures._getParseTreeNodeObject(r,"^","+",void 0),p=y.TreeProcedures._getParseTreeTerminalObject(o,"var","+"),p.value=d,q=y.TreeProcedures._getParseTreeTerminalObject(o,"digit","+"),q.value=2,l.length>1)for(h=y.TreeProcedures._getParseTreeNodeObject(r,"+","+",void 0);l.length>0;)h._addParam(l.shift());else h=l.shift(),r._addParam(h);h.isTerminal===!1&&h.simplify(b)}if(m.length>0){if(s=y.TreeProcedures._getParseTreeNodeObject(void 0,"\\cdot","+",void 0),p=y.TreeProcedures._getParseTreeTerminalObject(s,"var","+"),p.value=d,m.length>1)for(i=y.TreeProcedures._getParseTreeNodeObject(s,"+","+",void 0);m.length>0;)i._addParam(m.shift());else i=m.shift(),s._addParam(i);i.isTerminal===!1&&i.simplify(b)}if(n.length>0){if(n.length>1)for(j=y.TreeProcedures._getParseTreeNodeObject(void 0,"+","+",void 0);n.length>0;)j._addParam(n.shift());else j=n.shift();j.isTerminal===!1&&j.simplify(b)}for(u=[r,s,j],v=0,t=0;t<u.length;t++)void 0!==u[t]&&(v++,w=u[t]);if(v>0)for(y.TreeProcedures._convertTreeNodeTo(c,"+"),t=0;t<u.length;t++)void 0!==u[t]&&c._addParam(u[t]);else y.TreeProcedures._convertTreeNodeTo(c,w);b.A=h,b.B=i,b.C=j,b.analysis.functionCode=y.TreeProcedures._getMobileFunction(b),b.analysis.paramVariableOrder=void 0!==b.A?2:1,void 0!==h?y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"A:"+y.TreeProcedures._toLatex(h),[]):y.Parser._showConsole(y.Parser._debugFlag.common,"A:undefined",[]),void 0!==i?y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"B:"+y.TreeProcedures._toLatex(i),[]):y.Parser._showConsole(y.Parser._debugFlag.common,"B:undefined",[]),void 0!==j?y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"C:"+y.TreeProcedures._toLatex(j),[]):y.Parser._showConsole(y.Parser._debugFlag.common,"C:undefined",[]),y.Parser._deploy||y.Parser._showConsole(y.Parser._debugFlag.common,"%c[STAGE7 - SUCCESS]Converted to quadratic form "+y.TreeProcedures._toLatex(c),[y.Parser._YSTYLE]),y.Parser._showConsole(y.Parser._debugFlag.common,b,[]),y.Parser._deploy||y.Parser._printLatex(c,7,!1),("linear"===b.type||"quadratic"===b.type)&&(x=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.TreeProcedures.solveEquation(b),y.Parser._showConsole(y.Parser._debugFlag.info,"%c INFO%c: finding solutions for eqution "+x,[y.Parser._BLUE_STYLE,void 0]))},_getMobileFunction:function(b){var c,d,e,f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return c=void 0!==b.A?g.TreeProcedures._toMobileFunction(b.A,b):0,d=void 0!==b.B?g.TreeProcedures._toMobileFunction(b.B,b):0,void 0!==b.C&&(e=g.TreeProcedures._toMobileFunction(b.C,b)),f="var solution,a = ("+c+"),b=("+d+"), c=("+e+");solution = []; a !== 0 ? (solution[0] = (-b + Math.sqrt(b*b - 4*a*c))/(2*a),solution[1] = (-b - Math.sqrt(b*b - 4*a*c))/(2*a)) :(solution[0] = -c/b,solution[1] = solution[0]); return solution;",
f.search("findFactorial")>-1&&(f=g.MathFunctions.findFactorialString+f),f.search("gammaFunction")>-1&&(f=g.MathFunctions._gammaFunctionString+f),f.search("sum")>-1&&(f=g.MathFunctions.getSumString()+f),f.search("prod")>-1&&(f=g.MathFunctions.getProdString()+f),f},_toMobileFunction:function b(c,d,e){var f,g,h,i,j,k,l,m,n=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(void 0!==c){if(f="",c.isTerminal)if("var"===c.type){if(c.value===d.paramVariable)return"-"===c.sign?"(param*-1)":"param"}else if("const"===c.type)switch(c.value){case"\\pi":f="Math.PI";break;case"e":f="Math.E";break;case"\\theta":f='constants["\\\\theta"]';break;default:f=e&&e===c.value?c.value:"constants['"+c.value+"']"}else f=c.value;else{for(g=[],h=e,("\\sum"===c.name||"\\prod"===c.name)&&(h=c.params[0].value),l=0;l<c.params.length;l++)g[l]=b(c.params[l],d,h);switch("rad"===d.units.angle?(j="angle="+g[0]+",",k=""):(j="angle="+g[0]+",angle = angle*Math.PI /180,",k=",angle = angle*Math.PI /180"),m="",c.name){case"+":for(i="+",f=g[0],l=1;l<g.length;l++)f+=i+g[l];break;case"\\cdot":for(i="*",f=g[0],l=1;l<g.length;l++)f+=i+g[l];break;case"^":case"pow":f="raised=0,absBase=0,sign=0,num="+g[0]+",pow="+g[1]+",num===0&&pow===0?NaN:pow%1!==0?(raised=1/pow,absBase=Math.abs(num),sign=num>=0?1:-1,raised%2===0 && sign ===-1?Math.pow(num,pow):sign*Math.pow(absBase,pow)):Math.pow(num,pow)";break;case"\\frac":f=g[0]+"/"+g[1];break;case"\\sqrt":f="num=("+g[1]+"),pow = "+g[0]+",result=(isFinite(num)&&isFinite(pow)&&pow%2===0&&num<0)?NaN:pow<0?(1/Math.pow(Math.abs(num),(1/-pow))):Math.pow(Math.abs(num),1/pow),num<0?result*-1:result";break;case"\\ln":f="Math.log("+g[0]+")";break;case"\\log":f="Math.log("+g[0]+")/Math.LN10";break;case"\\log_":f="Math.log("+g[1]+")/Math.log("+g[0]+")";break;case"\\sin":case"\\cos":f=j+n.TreeProcedures.getMathFunction(c.name)+"(angle)";break;case"\\tan":f=j+"Math.sin(angle)/Math.cos(angle)";break;case"\\sec":f=j+"1/Math.cos(angle)";break;case"\\csc":f=j+"1/Math.sin(angle)";break;case"\\cot":f=j+"Math.cos(angle)/Math.sin(angle)";break;case"\\sinh":f=j+"(Math.pow(Math.E, angle) - Math.pow(Math.E, -angle)) / 2";break;case"\\cosh":f=j+"(Math.pow(Math.E, angle) + Math.pow(Math.E, -angle)) / 2";break;case"\\tanh":f=j+"Math.pow(Math.E, 2 * angle) - 1) / (Math.pow(Math.E, 2 * angle) + 1";break;case"\\csch":f=j+"2 / (Math.pow(Math.E, angle) - Math.pow(Math.E, -angle))";break;case"\\sech":f=j+"2 / (Math.pow(Math.E, angle) + Math.pow(Math.E, -angle))";break;case"\\coth":f=j+"Math.pow(Math.E, 2 * angle) + 1) / (Math.pow(Math.E, 2 * angle) - 1";break;case"\\arcsin":f="angle = "+g[0]+",Math.asin(angle)"+k;break;case"\\arccos":f="angle = "+g[0]+",Math.acos(angle)"+k;break;case"\\arctan":f="angle = "+g[0]+",Math.atan(angle)"+k;break;case"\\arccsc":f="angle = "+g[0]+",Math.asin(1/angle)"+k;break;case"\\arcsec":f="angle = "+g[0]+",Math.acos(1/angle)"+k;break;case"\\arccot":f="angle = "+g[0]+",Math.PI/2 - Math.atan(angle)"+k;break;case"\\arsinh":f="num = "+g[0]+",Math.log(num + Math.pow(num*num + 1 ,1/2))";break;case"\\arcosh":f="num = "+g[0]+",Math.log(Math.pow(num*num - 1 ,1/2))";break;case"\\artanh":f="num = "+g[0]+",Math.pow(num*num - 1 ,1/2)";break;case"\\arcsch":f="num = "+g[0]+",1/num + Math.sqrt(1/(num*num + 1))";break;case"\\arsech":f="num = "+g[0]+",1/num + Math.sqrt(1/(num*num - 1))";break;case"\\arcoth":f="num = "+g[0]+",0.5* Math.log((num+1)/(num-1))";break;case"!":f="num = "+g[0]+",num>170||!isFinite(num)?Infinity:num === 0?1:num%1===0 && num > 0?(findFactorial(num)):num*gammaFunction(num)";break;case"\\gcd":case"\\lcm":f=g[0];break;case"\\ceil":f="Math.ceil("+g[0]+")";break;case"\\floor":f="Math.floor("+g[0]+")";break;case"\\round":f="Math.round("+g[0]+")";break;case"\\abs":f="Math.abs("+g[0]+")";break;case"\\min":f="Math.min("+g[0]+","+g[1]+")";break;case"\\max":f="Math.max("+g[0]+","+g[1]+")";break;case"\\mod":f="num0="+g[0]+",num1="+g[1]+",num1===0?NaN:num0>0 === num1>0?num0%num1:num1+num0%num1";break;case"\\nCr":f="num0="+g[0]+",num1="+g[1]+",num0<0||num1<0?0:(num0 = Math.floor(Math.abs(num0)),num1 = Math.floor(Math.abs(num1)),num0<num1?0:findFactorial(num0)/(findFactorial(num1) - findFactorial(num0 - num1)))";break;case"\\nPr":f="num0="+g[0]+",num1="+g[1]+",num0<0||num1<0?0:(num0 = Math.floor(Math.abs(num0)),num1 = Math.floor(Math.abs(num1)),num0<num1?0:findFactorial(num0)/findFactorial(num0 - num1))";break;case"\\exp":f="Math.exp("+g[0]+")";break;case"\\sum":f='sum("'+c.params[0].value+'","'+g[1]+'","'+g[2]+'","'+g[3]+'",param,constants)';break;case"\\prod":f='prod("'+c.params[0].value+'","'+g[1]+'","'+g[2]+'","'+g[3]+'",param,constants)';break;default:f=0}}return f="-"===c.sign?"-("+f+")":"("+f+")"}},getMathFunction:function(a){switch(a){case"\\sin":return"Math.sin";case"\\cos":return"Math.cos";case"\\tan":return"Math.tan"}},solveEquation:function(b,c){var d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return b.isPolar===!0?d.TreeProcedures._solvePolar():d.TreeProcedures._solveCartesian(b,c)},_solvePolar:function(){},_solveCartesian:function(b,c){var d,e,f,g,h,i,j=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(j.Parser._debugFlag.solve&&j.Parser._showConsole(j.Parser._debugFlag.common,"For paramValue = "+c,[]),void 0!==b.A&&(d=j.TreeProcedures._substituteParamVariableAndGetValue(b.A,b.constants,b.paramVariable,c)),j.Parser._showConsole(j.Parser._debugFlag.solve,"A="+d,[]),void 0!==b.B&&(e=j.TreeProcedures._substituteParamVariableAndGetValue(b.B,b.constants,b.paramVariable,c)),j.Parser._showConsole(j.Parser._debugFlag.solve,"B="+e,[]),void 0!==b.C&&(j.Parser._deploy||j.Parser._showConsole(j.Parser._debugFlag.convert2q,"C is "+j.TreeProcedures._toLatex(b.C),[]),f=j.TreeProcedures._substituteParamVariableAndGetValue(b.C,b.constants,b.paramVariable,c)),j.Parser._showConsole(j.Parser._debugFlag.solve,"C="+f,[]),void 0===d){if(j.Parser._showConsole(j.Parser._debugFlag.convert2q,"cant use quadratic formula since a = 0",[]),void 0===e)return void j.Parser._showConsole(j.Parser._debugFlag.common,"%c[FAIL - STAGE7]Cant process this equation",[j.Parser._NSTYLE]);g=h=void 0===f?void 0:-f/e}else j.Parser._showConsole(j.Parser._debugFlag.convert2q,"Using quadratic formula since a != 0",[]),void 0===e&&(e=0),void 0===f&&(f=0),i=e*e-4*d*f,0>i?(g=h="undefined",j.Parser._showConsole(j.Parser._debugFlag.convert2q,"Solution is complex",[])):(g=(-e+Math.sqrt(i))/(2*d),h=0===i?g:(-e-Math.sqrt(i))/(2*d));return g=Number(g),h=Number(h),[g,h]},_substituteParamVariableAndGetValue:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(o.Parser._showConsole(o.Parser._debugFlag.convert2q,"Substituting param "+d+" with value "+e,[]),b.isTerminal===!0)return"digit"===b.type?"-"===b.sign?-1*Number(b.value):Number(b.value):"var"===b.type?b.value===d?"-"===b.sign?-1*Number(e):Number(e):void o.Parser._showConsole(o.Parser._debugFlag.common,"%c[FAIL-STAGE8]Unknown freevar occured "+b.value,[o.Parser._NSTYLE]):void 0!==o.Parser._constants[b.value]?"-"===b.sign?-1*o.Parser._constants[b.value]:o.Parser._constants[b.value]:void 0!==c[b.value]?"-"===b.sign?-1*c[b.value]:c[b.value]:void o.Parser._showConsole(o.Parser._debugFlag.common,"%c[FAIL-STAGE8]unsubstituted constant occured "+b.value,[o.Parser._NSTYLE]);switch(f=[],h="-"===b.sign?-1:1,b.name){case"\\sum":case"\\prod":if(k=c[b.params[0].value],l=o.TreeProcedures._substituteParamVariableAndGetValue(b.params[1],c,d,e),m=o.TreeProcedures._substituteParamVariableAndGetValue(b.params[2],c,d,e),isNaN(l)||isNaN(m)||void 0===l||void 0===m||!isFinite(m)||!isFinite(l))return void 0;for(n=l;m>=n;n++){if(c[b.params[0].value]=n,g=o.TreeProcedures._substituteParamVariableAndGetValue(b.params[3],c,d,e),void 0===g)return void o.Parser._showConsole(o.Parser._debugFlag.common,"%c[FAIL-STAGE8]Cant Calculate value of "+b.name,[o.Parser._NSTYLE]);f.push(g)}j="\\sum"===b.name?o.TreeProcedures._mathFunctions.performMathematicalCalculations("+",f,o.TreeProcedures._getUnits(b)):o.TreeProcedures._mathFunctions.performMathematicalCalculations("\\cdot",f,o.TreeProcedures._getUnits(b));break;default:for(i=0;i<b.params.length;i++){if(g=o.TreeProcedures._substituteParamVariableAndGetValue(b.params[i],c,d,e),void 0===g)return void o.Parser._showConsole(o.Parser._debugFlag.common,"%c[FAIL-STAGE8]Cant Calculate value of "+b.name,[o.Parser._NSTYLE]);f.push(g)}j=o.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,f,o.TreeProcedures._getUnits(b))}return null===j?void 0:h*j},_commonOutFunctionVariable:function(b,c){var d,e,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,g=!1;if(b.isTerminal){if(b.value===c)return b.value=1,b.type="digit",1}else switch(b.name){case"+":for(d=0;d<b.params.length;d++)e=f.TreeProcedures._commonOutFunctionVariable(b.params[d],c);break;case"\\cdot":for(d=0;d<b.params.length;d++)e=f.TreeProcedures._commonOutFunctionVariable(b.params[d],c),1===e&&(g=!0);if(g===!0)return 1;break;case"\\frac":return f.TreeProcedures._commonOutFunctionVariable(b.params[0],c);case"^":return f.TreeProcedures._commonOutFunctionVariable(b.params[0],c)}},_add:function(b,c){var d,e,f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;for(b.isTerminal===!1&&"+"===b.name?(d=b,c.isTerminal===!1&&"+"===c.name?(e=g.TreeProcedures._extractAllParams(c),c.incinerate()):e=[c]):c.isTerminal===!1&&"+"===c.name?(d=c,b.isTerminal===!1&&"+"===b.name?(e=g.TreeProcedures._extractAllParams(b),b.incinerate()):e=[b]):(d=g.TreeProcedures._getParseTreeNodeObject(void 0,"+","+",void 0),e=[b,c]),f=0;f<e.length;f++)d._addParam(e[f]);return d},multiply:function(b,c){var d,e,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(b.isTerminal===!1&&"\\cdot"===b.name)if(d=b,c.isTerminal===!0)d._addParam(c);else{for(e=0;e<c.params.length;e++)d._addParam(c.params[e]);c.incinerate()}else if(c.isTerminal===!1&&"\\cdot"===c.name)if(d=c,b.isTerminal===!0)d._addParam(b);else{for(e=0;e<b.params.length;e++)d._addParam(b.params[e]);b.incinerate()}else d=f.TreeProcedures._getParseTreeNodeObject(void 0,"\\cdot","+",void 0),d._addParam(b),d._addParam(c);return d},updateFreeVars:function(){},combineLeftRightTree:function(b){var c,d,e,f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(void 0!==b.rightRoot){if(g.Parser._showConsole(g.Parser._debugFlag.common,"Right tree is "+b.rightRoot,[]),g.TreeProcedures.negateTree(b.rightRoot),b.rightRoot.isTerminal===!0&&0===g.TreeProcedures._getValueFromParam(b.rightRoot)&&b.leftRoot.isTerminal===!1)return;b.leftRoot=g.TreeProcedures._add(b.leftRoot,b.rightRoot),b.rightRoot=g.TreeProcedures._getParseTreeTerminalObject(void 0,"digit","+",b.units),b.rightRoot.value="0"}for(c in b.rightExpression.freevars)d=b.leftExpression.freevars[c],e=b.rightExpression.freevars[c],f=d?"c"===d?d:"c"===e?e:d>e?d:e:e,b.leftExpression.freevars[c]=f,delete b.rightExpression.freevars[c]},negateTree:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,e=b.isTerminal===!1&&"+"===b.name;if(e===!0)for(c=0;c<b.params.length;c++)d.TreeProcedures.negateTree(b.params[c]);else"+"===b.sign?b.sign="-":b.sign="+"},generateTree:function(b,c,d){function e(a){if(void 0!==a.parentNode){var b=a.parentNode.params.indexOf(a),c=a.parentNode.params[b+1];return void 0===c?a.parentNode:c}}if(void 0!==b){for(var f,g,h,i,j=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,k=[];c<b.length;){if(h=b[c],j.Parser._showConsole(j.Parser._debugFlag.tree,"...Processing object "+h,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"...Current Parent is "+g,[]),"number"==typeof h){if(i=j.ParsingProcedures.getStackCode(k),g=j.TreeProcedures._getNodeForRule(g,h,i,d),void 0===f)for(f=g;void 0!==f.parentNode;)f=f.parentNode;j.Parser._showConsole(j.Parser._debugFlag.tree,"rule returned "+g,[])}else if("func"===h.type)j.Parser._showConsole(j.Parser._debugFlag.tree,"ignoring func token "+h,[]),h.value===g.name?(j.Parser._showConsole(j.Parser._debugFlag.tree,"%cCHECK...function name matches with currentNode "+h+"<>"+g,[j.Parser._YSTYLE]),g.sign=h.sign):j.Parser._showConsole(j.Parser._debugFlag.tree,"%cFAIL...function name does not match with currentNode "+h+"<>"+g,[j.Parser._NSTYLE]);else if("delim"===h.type){if(j.Parser._showConsole(j.Parser._debugFlag.tree,"skipping delimiter "+h,[]),","===h.value&&!j.Parser._isCommaFunction(g.name))for(;!j.Parser._isCommaFunction(g.name);)g=e(g);for(j.ParsingProcedures.recordBracket(k,h.value),"do"===g.name&&(g.sign=h.sign);g.liberationCode>j.ParsingProcedures.getStackCode(k)&&(j.Parser._showConsole(j.Parser._debugFlag.common,"Current node type "+g.type,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"shifting up parent because "+g+" is Delimiter found... parent shift from "+g+" to "+g.parentNode,[]),g=e(g),void 0!==g););}else if("opr"===h.type){if(j.Parser._showConsole(j.Parser._debugFlag.tree,"skipping operator "+h,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"Operator found...shifting parent from "+g+" to "+g.parentNode+h,[]),h.value!==g.name){do j.Parser._showConsole(j.Parser._debugFlag.tree,h.value+"<> "+g.name,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"!!!!!!!!!!!!!!!!!!! current operator does not match the current node !!!!!!!!!!!!! SHOULD SHIFT parent up to!!"+g.parentNode,[]),g=e(g);while(void 0!==g&&h.value!==g.name)}else j.Parser._showConsole(j.Parser._debugFlag.tree,"Operator "+g.value+" confirms with the parent >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>",[]);void 0!==g&&h.value===g.name?(j.Parser._showConsole(j.Parser._debugFlag.tree,"%cCHECK...OPERATOR name matches with currentNode "+h+"<>"+g,[j.Parser._YSTYLE]),g.sign=h.sign):j.Parser._showConsole(j.Parser._debugFlag.common,"%cFAIL...OPERATOR name does not match with currentNode "+h+"<>"+g,[j.Parser._NSTYLE])}else if("digit"===h.type||"const"===h.type||"var"===h.type){if(g.isTerminal===!1)return void j.Parser._showConsole(j.Parser._debugFlag.tree,"!!!!!!!!!!!!!!!! ERROR terminal expected found NODE------------",[]);j.Parser._showConsole(j.Parser._debugFlag.tree,"+++ found terminal "+h+" will be filled into shell "+g,[]),g.sign=h.sign,g.value=h.value,g.type=h.type,g.isEmpty=!1}else j.Parser._showConsole(j.Parser._debugFlag.tree,"!!!!!!!!!!!!!!!!!!!!!!!!!!! DONT KNOW WHAT TO DO WITH "+h,[]);if(void 0!==g)for(j.Parser._showConsole(j.Parser._debugFlag.tree,"Checking stackcode "+g+" "+g.liberationCode+" <> "+j.ParsingProcedures.getStackCode(k),[]);g.isEmpty===!1&&j.TreeProcedures.isOperator(g.name)===!1&&(j.Parser._showConsole(j.Parser._debugFlag.tree,"Current node type "+g.type,[]),j.Parser._showConsole(j.Parser._debugFlag.tree,"shifting up parent because "+g+" is NOT EMPTY parent shift from "+g+" to "+e(g),[]),g=e(g),void 0!==g););if(c++,void 0===g)break}return f}},isOperator:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return-1!==c.TreeProcedures._productions._operatorsInPrecedenceOrder.indexOf(b)},_getNodeForRule:function(b,c,d,e){var f,g,h,i,j=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,k=j.TreeProcedures._productions.treeGenerationRules[c],l=k.split(" "),m=b;if(l.length>0&&("node.\\sum"===l[0]||"node.\\prod"===l[0])){for(i=0;i<l.length;i++)f=l[i].split("."),"node"===f[0]?m=j.TreeProcedures._getParseTreeNodeObject(m,f[1],"+",d):void 0===h?h=j.TreeProcedures._getParseTreeTerminalObject(m,f[1],"+",e):j.TreeProcedures._getParseTreeTerminalObject(m,f[1],"+",e),void 0===g&&(g=m);m=h}else for(i=0;i<l.length;i++)f=l[i].split("."),m="node"===f[0]?j.TreeProcedures._getParseTreeNodeObject(m,f[1],"+",d):j.TreeProcedures._getParseTreeTerminalObject(m,f[1],"+",e),void 0===g&&(g=m);return j.Parser._showConsole(j.Parser._debugFlag.common,"------ Rule "+c+" Processing complete---------------",[]),j.Parser._showConsole(j.Parser._debugFlag.common,"returning "+m,[]),m},_getParseTreeTerminalObject:function(b,c,d,e){var f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return g.Parser._showConsole(g.Parser._debugFlag.common,"Generating Node with parent "+b+" and type "+c,[]),void 0===d&&(d="+"),f={toString:function(){return"["+this.sign+this.value+" "+this.type+"]"},isTerminal:!0,type:c,sign:d,value:void 0,units:e,isEmpty:!0,incinerate:function(){this.value="incinerated (X)",delete this.isTerminal,delete this.type,delete this.isEmpty,delete this.units,delete this.parentNode},parentNode:b},void 0!==b&&b.isEmpty===!0&&b._addParam(f),f},getFunctionVariablePowerInTerm:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(b.isTerminal)return 0;switch(b.name){case"+":case"-":c.Parser._showConsole(c.Parser._debugFlag.common,"%c[FAIL ]This term should have occured when looking  for power of function variable",[c.Parser._NSTYLE]);break;case"\\cdot":}},_getFunctionVariableSegregationIndex:function(b,c){var d,e,f=0,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(void 0===c)return void g.Parser._showConsole(g.Parser._debugFlag.common,"Cant segregate with unknown fVar",[]);if(b.isTerminal===!0)return c===b.value?1:0;switch(b.name){case"+":for(d=0;d<b.params.length;d++)if(e=g.TreeProcedures._getFunctionVariableSegregationIndex(b.params[d],c),0===d)f=e;else if(e!==f)return;return f;case"\\cdot":for(d=0;d<b.params.length;d++){if(e=g.TreeProcedures._getFunctionVariableSegregationIndex(b.params[d],c),void 0===e)return;e>0&&(f+=e)}return f;case"\\frac":return e=g.TreeProcedures._getFunctionVariableSegregationIndex(b.params[0],c),g.Parser._showConsole(g.Parser._debugFlag.convert2q,"fraction with numerator fvar power "+e,[]),e;case"^":return b.params[1].isTerminal===!1||"digit"!==b.params[1].type?(g.Parser._showConsole(g.Parser._debugFlag.convert2q,"No point in checking when power is complicated for "+b+" power is "+b.params[1],[]),0):(e=g.TreeProcedures._getFunctionVariableSegregationIndex(b.params[0],c),g.Parser._showConsole(g.Parser._debugFlag.convert2q,"power: fVar "+e+" my power "+b.params[1],[]),void 0===e?void 0:e>0?e*g.TreeProcedures._getValueFromParam(b.params[1]):0);default:return 0}},_findSameOperatorAndMerge:function(b){var c,d,e,f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if("+"!==b.name&&"\\cdot"!==b.name&&"-"!==b.name)return void g.Parser._showConsole(g.Parser._debugFlag.common,"Cant merge function "+b,[]);for(g.Parser._showConsole(g.Parser._debugFlag.common,"Merging operator "+b,[]),d=[],e=0,f=null,e=0;e<b.params.length;e++)if(f=b.params[e],f.name===b.name)for(c=g.TreeProcedures._extractAllParams(f),b._removeParam(f),e--;c.length>0;)d.push(c.shift());if(d.length>0)for(;d.length>0;)b._addParam(d.shift())},_getParseTreeNodeObject:function(b,c,d,e){var f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return g.Parser._showConsole(g.Parser._debugFlag.common,"Generating function "+c+" with parent "+b,[]),void 0===d&&(d="+"),f={toString:function(){return"+"===this.sign?this.name+"()":this.sign+this.name+"()"},params:[],isTerminal:!1,name:c,isEmpty:!0,sign:d,allTermsDigits:void 0,liberationCode:e,maxParams:g.TreeProcedures._productions.getMaximumParameters(c),_addParam:function(a){return this.params.length>=this.maxParams?void g.Parser._showConsole(g.Parser._debugFlag.common,"!!!!!!!! ERROR I CANT ACCEPT THIS CHILD",[]):(a.parentNode=this,this.params.push(a),g.Parser._showConsole(g.Parser._debugFlag.common,"Adding param "+a.name+" to "+this.name+" at index "+(this.params.length-1),[]),void(this.params.length===this.maxParams&&(g.Parser._showConsole(g.Parser._debugFlag.common,"---Function "+this.name+" is full---",[]),this.isEmpty=!1)))},_removeParam:function(a,b){var c,d,e;return c="number"==typeof a?a:this.params.indexOf(a),-1===c||c>=this.params.length?void g.Parser._showConsole(g.Parser._debugFlag.common,"Cant remove object at index "+c,[]):(d=this.params.splice(c,1),e=d[0],void 0===b&&(b=!0),b!==!0?e:void e.incinerate())},convertToTerminal:function(a){this.isTerminal=!0,this.value=a.value,this.isEmpty=a.isEmpty,this.type=a.type,this.units=a.units,this.sign=a.sign,this.toString=function(){return"["+this.sign+this.value+" "+this.type+"]"},void 0!==a.parentNode&&a.parentNode._removeParam(a),delete this.params,delete this.name,delete this.liberationCode,delete this.maxParams,delete this._removeParam,delete this.toEquation,delete this._addParam,delete this.simplify},incinerate:function(){this.name="incinerated (+)",delete this.params,delete this.isTerminal,delete this.isEmpty,delete this.liberationCode,delete this.parentNode,delete this.maxParams},toEquation:function(){},expand:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;switch(this.name){case"+":for(k=0;k<this.params.length;k++)this.params[k].isTerminal===!1&&this.params[k].expand(b,c);y.TreeProcedures._findSameOperatorAndMerge(this),l=!0;break;case"\\cdot":if(y.TreeProcedures._getAdditionGroupCount(this.params)>0){for(m=[],n=0;n<this.params.length;)"+"===this.params[n].name?m.push(this._removeParam(this.params[n],!1)):n++;if(m.length>1)for(;m.length>1;)o=y.TreeProcedures._expandMultiplication(m.shift(),m.shift(),this.sign),m.unshift(o);else o=m[0];y.Parser._showConsole(y.Parser._debugFlag.expand,"Remaining non plus params count is "+this.params.length,[]),this.params.length>0&&(this.params.length>1?(w=y.TreeProcedures._getParseTreeNodeObject(void 0,"\\cdot","+",void 0),y.TreeProcedures._adoptAllParams(this,w),o=y.TreeProcedures._expandMultiplication(w,o,this.sign)):(o=y.TreeProcedures._expandMultiplication(this.params[0],o,this.sign),y.TreeProcedures._removeAllParams(this))),y.Parser._showConsole(y.Parser._debugFlag.expand,"Addition group is "+o,[]),y.TreeProcedures._convertTreeNodeTo(this,"+"),y.TreeProcedures._adoptAllParams(o,this)}else y.Parser._showConsole(y.Parser._debugFlag.expand,"Nothing to expand",[]);y.TreeProcedures._findSameOperatorAndMerge(this);break;case"^":if(i=this.params[0],i.isTerminal===!1&&i.expand(c),j=this.params[1],y.Parser._showConsole(y.Parser._debugFlag.expand,"Expanding ^ with params "+this.params,[]),"+"===i.name&&j.isTerminal===!0){if(y.Parser._showConsole(y.Parser._debugFlag.expand,"Possible expansion of "+i+" at degree "+j,[]),"2"===j.value){if(y.TreeProcedures._hasFreeVariable(this,b)===!1)return void y.Parser._showConsole(y.Parser._debugFlag.expand,"No function variable found in my params....Expansion is futile",[]);if(p=y.TreeProcedures._extractAllParams(i),y.TreeProcedures._convertTreeNodeTo(this,"+"),y.TreeProcedures._removeAllParams(this),r=y.TreeProcedures._seperateTermsWithFreeVariable(p,b),y.Parser._showConsole(y.Parser._debugFlag.expand,"Terms with free Variable "+b+" are "+r,[]),y.Parser._showConsole(y.Parser._debugFlag.expand,"Terms WITHOUT free Variable "+b+" are "+p,[]),0===r.length)y.Parser._showConsole(y.Parser._debugFlag.expand,"##############ERROR THIS SHOULDNT HAPPEN...@#@#######",[]);else{if(t=y.TreeProcedures._getParseTreeTerminalObject(void 0,"digit","+"),t.value=2,r.length>0)for(i=y.TreeProcedures._getParseTreeNodeObject(void 0,"+",void 0,void 0),k=0;k<r.length;k++)y.Parser._showConsole(y.Parser._debugFlag.expand,"Adding param "+r[k],[]),i._addParam(r[k]);else i=r[0];if(p.length>0)for(j=y.TreeProcedures._getParseTreeNodeObject(void 0,"+",void 0,void 0),k=0;k<p.length;k++)j._addParam(p[k]);else j=p[0];s=y.TreeProcedures._getParseTreeNodeObject(void 0,"^",void 0,void 0),s._addParam(y.TreeProcedures._clone(i)),s._addParam(y.TreeProcedures._clone(t)),y.Parser._showConsole(y.Parser._debugFlag.expand,"expansion term 1 generated "+s,[]),s.sign=y.TreeProcedures._multiplySigns(s.sign,this.sign),this._addParam(s),s=y.TreeProcedures._getParseTreeNodeObject(void 0,"^",void 0,void 0),s._addParam(y.TreeProcedures._clone(j)),s._addParam(y.TreeProcedures._clone(t)),y.Parser._showConsole(y.Parser._debugFlag.expand,"expansion term 2 generated "+s,[]),s.sign=y.TreeProcedures._multiplySigns(s.sign,this.sign),this._addParam(s),s=y.TreeProcedures.multiply(i,j),s=y.TreeProcedures.multiply(s,t),s.sign=y.TreeProcedures._multiplySigns(s.sign,this.sign),this._addParam(s),l=!0}}}else if("\\cdot"===i.name&&j.isTerminal&&"digit"===j.type){for(q=this._removeParam(j,!1),y.TreeProcedures._convertTreeNodeTo(this,"\\cdot"),p=y.TreeProcedures._extractAllParams(i),y.TreeProcedures._removeAllParams(this),i.incinerate();p.length>0;)v=y.TreeProcedures._getParseTreeNodeObject(void 0,"^","+",void 0),v._addParam(p.shift()),v._addParam(y.TreeProcedures._clone(q)),this._addParam(v);q.incinerate(),l=!0}break;case"\\frac":if(d=this.params[0],d.isTerminal===!1&&d.expand(b),"+"===d.name){for(l=!0,this.name="+",this.maxParams=y.TreeProcedures._productions.getMaximumParameters(this.name),f=this.params[1],this._removeParam(d,!1),this._removeParam(f,!1),e=d.params.length;d.params.length>0;)x=this.sign,g=d.params[0],d._removeParam(g,!1),h=0===d.params.length?f:y.TreeProcedures._clone(f),u=y.TreeProcedures._getParseTreeNodeObject(this,"\\frac"),u._addParam(g),u._addParam(h),u.sign=x,u.simplify(c),this._addParam(u);d.incinerate()}}l===!0&&this.simplify(c)},simplify:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,f=!0;if(e.Parser._showConsole(e.Parser._debugFlag.simplify,"Simplifying "+this,[]),"\\sum"===this.name||"\\prod"===this.name)return void e.TreeProcedures.simplifySumProd(this,b);for(d=this.params.length,c=d-1;c>=0;c--)e.Parser._showConsole(e.Parser._debugFlag.common,"...processing "+this.params[c],[]),this.params[c].isTerminal!==!0?(this.params[c].simplify(b),(this.params[c].isTerminal===!1||"digit"!==this.params[c].type)&&(e.Parser._showConsole(e.Parser._debugFlag.simplify,this.params[c]+" is not digit",[]),f=!1)):"digit"!==this.params[c].type&&(e.Parser._showConsole(e.Parser._debugFlag.simplify,this.params[c]+" is not digit",[]),f=!1);this.allTermsDigits=f,e.Parser._showConsole(e.Parser._debugFlag.simplify,"all terms digit flag is "+this.allTermsDigits+" for function "+this,[]),e.TreeProcedures._performNumericalOptimizations(this,b),e.TreeProcedures._performStructuralOptimizations(this,b)},parentNode:b},void 0!==b&&b.isEmpty===!0&&b._addParam(f),f},_isInversibleFunction:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return-1!==c.Parser._INVERSIBLE_FUNCTIONS.indexOf(b)},_isNodeSimple:function c(a){var b,d=!0;if(a.isTerminal)d=d&&"var"!==a.type;else for(b=0;b<a.params.length;b++)if(d=d&&c(a.params[b]),!d)return d;return d},simplifySumProd:function(b,c){var d,e,f,g,h,i,j,k,l=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;!b||!b.params||b.params.length<4||(d=b.params[1],e=b.params[2],f=b.params[3],d.isTerminal||d.simplify(),e.isTerminal||e.simplify(),f.isTerminal||f.simplify(),l.TreeProcedures._isNodeSimple(d)&&l.TreeProcedures._isNodeSimple(e)&&l.TreeProcedures._isNodeSimple(f)&&d.isTerminal&&"digit"===d.type&&e.isTerminal&&"digit"===e.type&&(g=l.TreeProcedures._toMobileFunction(f,c,b.params[0].value),g.search("param")>-1||(h="return "+l.TreeProcedures._toMobileFunction(b,c)+";",h.search("findFactorial")>-1&&(h=l.MathFunctions.findFactorialString+h),h.search("gammaFunction")>-1&&(h=l.MathFunctions._gammaFunctionString+h),h.search("sum")>-1&&(h=l.MathFunctions.getSumString()+h),h.search("prod")>-1&&(h=l.MathFunctions.getProdString()+h),i=new Function("param,constants",h),j=i(0,c.constants),k=l.TreeProcedures._getParseTreeTerminalObject(void 0,"digit","+",b.params[0].units),k.value=j,b.convertToTerminal(k))))},_getLeftChild:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return b.isTerminal?null:"do"===b.params[0].name?c.TreeProcedures._getLeftChild(b.params[0]):b.params[0]},_getRightChild:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return b.isTerminal?null:"do"===b.params[1].name?c.TreeProcedures._getLeftChild(b.params[1]):b.params[1]},_getInversibleFunctionReplacement:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return c=d.Parser._INVERSIBLE_FUNCTIONS.indexOf(b),-1!==c?d.Parser._INVERT_FUNCTIONS_IN_ORDER[c]:null},_preNumericalStructuralOptimizations:function(b){var c,d,e,f,g,h,i=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;switch(b.name){case"^":if(c=i.TreeProcedures._getLeftChild(b),null!==c&&i.TreeProcedures._isInversibleFunction(c.name)&&(d=i.TreeProcedures._getRightChild(b),null!==d&&-1===i.TreeProcedures._getValueFromParam(d)&&(f=i.TreeProcedures._getInversibleFunctionReplacement(c.name),null!==f)))for(e=i.TreeProcedures._extractAllParams(c),i.TreeProcedures._convertTreeNodeTo(b,f),b.sign=i.TreeProcedures._multiplySigns(b.sign,c.sign),i.TreeProcedures._removeAllParams(b),g=0,h=e.length,g;h>g;g++)b._addParam(e[g])}},_performStructuralOptimizations:function(b,c){var d,e,f,g,h,i,j,k,l,m,n=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,o=!1;switch(b.name){case"^":"^"===b.params[0].name?(h=b._removeParam(1,!1),e=b.params[0]._removeParam(0,!1),f=b.params[0]._removeParam(0,!1),b._removeParam(0),h=n.TreeProcedures.multiply(h,f),b._addParam(e),b._addParam(h),o=!0):"\\%"===b.params[0].name&&(j=n.TreeProcedures._getNumberOfPercentChilds(b),i=b.params[1],k=n.TreeProcedures._getPercentChild(b.params[0]),d=k.sign,l=Math.pow(.01,j),l=Math.pow(l,i.value),l*=k.value,m=n.TreeProcedures._getParseTreeTerminalObject(void 0,"digit",d,void 0),m.value=l,n.TreeProcedures._removeAllParams(b),b.convertToTerminal(m));break;case"do":n.Parser._showConsole(n.Parser._debugFlag.simplify,"optimizing "+b+" with params "+b.params,[]),g=n.TreeProcedures._extractAllParams(b),d=b.sign,n.TreeProcedures._convertTreeNodeTo(b,g[0]),d=n.TreeProcedures._multiplySigns(d,g[0].sign),"+"===g[0].name&&"-"===d?n.TreeProcedures.negateTree(b):b.sign=d;break;case"!":"\\%"===b.params[0].name&&(j=n.TreeProcedures._getNumberOfPercentChilds(b),k=n.TreeProcedures._getPercentChild(b.params[0]),d=k.sign,l=Math.pow(.01,j),l=n.TreeProcedures._mathFunctions.performMathematicalCalculations("!",[l],n.TreeProcedures._getUnits(b)),l*=k.value,m=n.TreeProcedures._getParseTreeTerminalObject(void 0,"digit",d,void 0),m.value=l,n.TreeProcedures._removeAllParams(b),b.convertToTerminal(m))}o&&n.TreeProcedures._performNumericalOptimizations(b,c)},_getNumberOfPercentChilds:function(b){var c,d,e,f=0,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(b.isTerminal===!1)for(c=0,d=b.params.length,c;d>c;c++)e=b.params[c],"\\%"===e.name&&(f++,f+=g.TreeProcedures._getNumberOfPercentChilds(e));return f},_getPercentChild:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return"\\%"===b.params[0].name?c.TreeProcedures._getPercentChild(b.params[0]):b.params[0]},_expandMultiplication:function(b,c,d){var e,f,g,h,i,j,k,l,m=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(m.Parser._showConsole(m.Parser._debugFlag.common,"multiplying "+b+" to "+c,[]),"+"!==b.name&&"+"!==c.name)return m.Parser._showConsole(m.Parser._debugFlag.expand,"Both terms are not + series...just multiplying",[]),m.TreeProcedures.multiply(b,c);if(g=!1,h=!1,"+"===b.name?(e=m.TreeProcedures._extractAllParams(b),f=b,g=!0):(e=[b],g=!1),"+"===c.name?(i=m.TreeProcedures._extractAllParams(c),h=!0,void 0===f?f=c:c.incinerate()):(i=[c],h=!1),m.Parser._showConsole(m.Parser._debugFlag.expand,"term1 params "+e,[]),m.Parser._showConsole(m.Parser._debugFlag.expand,"term2 params "+e,[]),void 0===f)return void m.Parser._showConsole(m.Parser._debugFlag.expand,"Parent node not found...skip expand multiplication",[]);for(j=0;j<e.length;j++)for(k=0;k<i.length;k++)l=m.TreeProcedures.multiply(m.TreeProcedures._clone(e[j]),m.TreeProcedures._clone(i[k])),l.sign=m.TreeProcedures._multiplySigns(d,l.sign),m.Parser._showConsole(m.Parser._debugFlag.expand,">>>"+l,[]),f._addParam(l);if(g)for(;e.length>0;)e[0].incinerate(),e.shift();if(h)for(;i.length>0;)i[0].incinerate(),i.shift();return f},_extractAllParams:function(a){for(var b=[];a.params.length>0;)b.push(a._removeParam(a.params[0],!1));return b},_removeAllParams:function(a,b){for(void 0===b&&(b=!0);a.params.length>0;)a._removeParam(a.params[0],b);
},_getAdditionGroupCount:function(a){var b=0,c=0;for(c=0;c<a.length;c++)"+"===a[c].name&&b++;return b},_adoptAllParams:function(b,c){var d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(b===c)return void d.Parser._showConsole(d.Parser._debugFlag.common,"Skipping adopting your own params -_-",[]);for(;b.params.length>0;)c._addParam(b._removeParam(0,!1))},_seperateTermsWithFreeVariable:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,f=[];for(d=0;d<b.length;d++)e.TreeProcedures._hasFreeVariable(b[d],c)===!0?(e.Parser._showConsole(e.Parser._debugFlag.common,"term "+b[d]+" have freevar "+c,[]),f.push(b[d]),b.splice(d,1),d--):e.Parser._showConsole(e.Parser._debugFlag.common,"term "+b[d]+"  doesnt have freevar "+c,[]);return f},_hasFreeVariable:function d(a,b){if(a.isTerminal===!0)return"var"===a.type&&a.value===b;var c,e;for(e=0;e<a.params.length;e++)if(c=d(a.params[e],b),c===!0)return!0;return!1},_convertTreeNodeTo:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(b.isTerminal===!0)return void e.Parser._showConsole(e.Parser._debugFlag.common,"Cant convert terminal to a NODE",[]);if(e.Parser._showConsole(e.Parser._debugFlag.common,"Converting the tree node "+b+" from "+b.name+" to "+c,[]),"string"==typeof c)b.name=c,b.maxParams=e.TreeProcedures._productions.getMaximumParameters(c);else if(c.isTerminal===!1)for(b.name=c.name,b.sign=c.sign,b.maxParams=e.TreeProcedures._productions.getMaximumParameters(b.name),d=e.TreeProcedures._extractAllParams(c),e.TreeProcedures._removeAllParams(b);d.length>0;)b._addParam(d.shift());else b.convertToTerminal(c);b.maxParams===1/0&&(b.isEmpty=!0)},_getUnits:function(b){var c=b.params[0],d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return c.isTerminal===!0?c.units:d.TreeProcedures._getUnits(c)},_getAllParamsValues:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,e=[],f=0,g=b.params.length;for(f;g>f;f++)c=b.params[f],c.isTerminal?e.push(d.TreeProcedures._getValueFromParam(c)):d.Parser._showConsole(d.Parser._debugFlag.common,"%c[FAIL ]The Node provided is not terminal",[d.Parser._NSTYLE]);return e},_getValueFromParam:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return b.isTerminal?(c=Number(b.value),isNaN(c)?b.value:"-"===b.sign&&0!==c?-1*c:c):(d.Parser._showConsole(d.Parser._debugFlag.common,"Value for a non terminal node was asked"+b.name,[]),null)},_multiplySigns:function(a,b){return"+"===a&&"+"===b?"+":"+"===a||"+"===b?"-":"+"},_getAdditionValue:function(b){var c,d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,e=null,f=b.params.length,g=0;for(g;f>g;g++)c=b.params[g],c.isTerminal&&"digit"===c.type&&(null===e&&(e=0),e+=d.TreeProcedures._getValueFromParam(c));return e},_performPercentOptimizations:function(b){var c,d,e,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,g=b.parentNode;return void 0===g?f.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,[f.TreeProcedures._getValueFromParam(b.params[0])],f.TreeProcedures._getUnits(b)):"+"!==g.name?"^"===g.name||"!"===g.name?void 0:f.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,[f.TreeProcedures._getValueFromParam(b.params[0])],f.TreeProcedures._getUnits(b)):(e=f.TreeProcedures._getAdditionValue(g),void 0===g.onlyPercent&&(null===e?g.onlyPercent=!0:g.onlyPercent=!1),c=g.onlyPercent===!0?f.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,[f.TreeProcedures._getValueFromParam(b.params[0])],f.TreeProcedures._getUnits(b)):f.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,[e,f.TreeProcedures._getValueFromParam(b.params[0])],f.TreeProcedures._getUnits(b)),"-"===b.sign&&(c*=-1),d=f.TreeProcedures._extractAllParams(b,!1),b.convertToTerminal(d[0]),b.sign=d[0].sign,b.value=c,d[0].incinerate(),void 0)},_performNumericalOptimizations:function(b,c){if(b.isTerminal!==!0){var d,e,f,g,h,i,j,k,l,m,n,o=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(o.Parser._showConsole(o.Parser._debugFlag.simplify,"solving---------------"+b+" with maxparams "+b.maxParams,[]),g=1,"-"===b.sign&&(g=-1),b.maxParams===1/0){for(h=0,h=0;h<b.params.length;h++)if(i=b.params[h],i.isTerminal===!0&&"digit"===i.type)if(o.Parser._showConsole(o.Parser._debugFlag.simplify,"processing digit "+i,[]),void 0===d)d=o.TreeProcedures._getValueFromParam(b.params[h]),o.Parser._showConsole(o.Parser._debugFlag.simplify,"for operator "+b.name+" Result init to "+d,[]),f=b.params[h];else{switch(b.name){case"+":d+=o.TreeProcedures._getValueFromParam(b.params[h]);break;case"-":d-=o.TreeProcedures._getValueFromParam(b.params[h]);break;case"\\cdot":d*=o.TreeProcedures._getValueFromParam(b.params[h])}b._removeParam(i),h--}else o.Parser._showConsole(o.Parser._debugFlag.simplify,"param "+i+" is not terminal",[]),g=1;"\\cdot"===b.name,void 0!==d&&(d*=g),1===b.params.length&&(e=!0),void 0!==f&&(o.Parser._showConsole(o.Parser._debugFlag.simplify,"Reduced to result "+d,[]),f.value=d,f.sign="+")}else if(o.Parser._showConsole(o.Parser._debugFlag.common,b+" all terms digits flag is "+b.allTermsDigits,[]),b.allTermsDigits===!0){switch(o.Parser._showConsole(o.Parser._debugFlag.simplify,"!!!Processing function "+b.name+" with params "+b.params,[]),b.name){case"\\%":d=o.TreeProcedures._performPercentOptimizations(b);break;case"do":e=!1;break;default:d=o.TreeProcedures._mathFunctions.performMathematicalCalculations(b.name,o.TreeProcedures._getAllParamsValues(b),o.TreeProcedures._getUnits(b)),null===d&&o.Parser._showConsole(o.Parser._debugFlag.simplify,"Dont know how to process function "+b,[])}if(void 0!==d){for(d*=g,b.params[0].value=d,b.params[0].type="digit",b.params[0].sign="+";b.params.length>1;)b._removeParam(b.params[1]);e=!0}}else switch(o.Parser._showConsole(o.Parser._debugFlag.simplify,"Not all terms are digits in function "+b+" params are "+b.params,[]),b.name){case"\\frac":b.params[0].isTerminal===!1&&"\\frac"===b.params[0].name?(o.Parser._showConsole(o.Parser._debugFlag.common,"SImplifying fraction in numerator",[]),j=b.params[0],k=b.params[1],b._removeParam(j,!1),b._removeParam(k,!1),b._addParam(j.params[0]),l=o.TreeProcedures.multiply(k,j.params[1]),b._addParam(l),l.simplify(c)):o.Parser._showConsole(o.Parser._debugFlag.simplify,"Cant simplify frac any further",[])}e===!0&&(m=b.params[0],o.Parser._showConsole(o.Parser._debugFlag.simplify,"node "+b+" has only param left "+m,[]),n=m.isTerminal===!0||"+"===b.name||"\\cdot"===b.name,n===!0&&(o.Parser._showConsole(o.Parser._debugFlag.simplify,"CONVERTING last node from "+b+" to "+m,[]),o.Parser._showConsole(o.Parser._debugFlag.simplify,"before conversion it was "+b,[]),m.isTerminal?b.convertToTerminal(m):(o.TreeProcedures._convertTreeNodeTo(b,m),m.incinerate()),o.Parser._showConsole(o.Parser._debugFlag.simplify,"after conversion it is  "+b,[]))),o.Parser._showConsole(o.Parser._debugFlag.simplify,"Finished solving---------------"+b,[])}}}),a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.ParsingProcedures=Backbone.Model.extend({},{_validOpeningBrackets:["(","{","["],_validClosingBrackets:[")","}","]"],_recursiveTokenRegEx:/^\((.+)\)\+$/i,_productions:a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Productions,peekInPredictionStack:function(b,c){if(!(c>b.length)){var d=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return d.ParsingProcedures._getPeekValue(b[c])}},_getPeekValue:function(b){var c,d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(void 0!==b)return e.ParsingProcedures._recursiveTokenRegEx.test(b)?(e.Parser._showConsole(e.Parser._debugFlag.common,"peek term is recursive..."+b,[]),c=b.match(e.ParsingProcedures._recursiveTokenRegEx),e.Parser._showConsole(e.Parser._debugFlag.common,"matches "+c,[]),d=c[1].split(","),e.Parser._showConsole(e.Parser._debugFlag.common,"tokens are "+d,[]),d[0]):b},expandRecursiveStack:function(b,c){var d,e,f,g,h=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;for(h.Parser._showConsole(h.Parser._debugFlag.common,"Expanding prediction stack "+b+" at index "+c,[]),d=b[c],e=d.match(h.ParsingProcedures._recursiveTokenRegEx),f=e[1].split(","),h.Parser._showConsole(h.Parser._debugFlag.common,"Expanded terms are "+f,[]),g=f.length-1;g>=0;g--)b.splice(c,0,f[g]);h.Parser._showConsole(h.Parser._debugFlag.common,"now prediction stack is "+b,[])},isStackInfinite:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return c.ParsingProcedures.isTermInfinite(b[b.length-1])},isTermInfinite:function(b){if(void 0===b)return!1;var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return c.Parser._showConsole(c.Parser._debugFlag.common,"checking for recursive term "+b+" result is "+this._recursiveTokenRegEx.test(b),[]),c.ParsingProcedures._recursiveTokenRegEx.test(b)},verifyStackWithLookahead:function(b,c){var d,e,f=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(f.Parser._showConsole(f.Parser._debugFlag.common,"*******************verifying stack "+b+" with lookahead "+c,[]),void 0===c||0===c.length)return!0;for(e=c.length-1;e>0;e--){if(d=c[e],f.Parser._showConsole(f.Parser._debugFlag.common,d+" <> "+b[b.length-1],[]),f.ParsingProcedures._isClosingBracket(d))return!0;if(b[b.length-1]===d)return!1;if(f.ParsingProcedures.getOperatorPrecedenceIndex(f.ParsingProcedures._getPeekValue(b[b.length-1]))<f.ParsingProcedures.getOperatorPrecedenceIndex(f.ParsingProcedures._getPeekValue(d)))return f.Parser._showConsole(f.Parser._debugFlag.common,">>>>>>>>>>>!!!!!!>>>>>>>> REJECTING THE STACK because "+b[b.length-1]+" should not be precededed by "+d,[]),!1}return!0},getOperatorPrecedenceIndex:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,d=c.Productions._operatorsInPrecedenceOrder.indexOf(b);return c.Parser._showConsole(c.Parser._debugFlag.common,"checking operator precedence index for operator "+b+" index is "+d,[]),d},isTokenSame:function(a,b){return a.value===b||a.type===b?!0:!1},cloneStringStack:function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c]},pushAllLookAheads:function(a,b,c){var d,e=0;for(d=b.length-1;d>=c;d--)e++,a.push(b[d]);return e},checkWithLookAhead:function(b,c){var d,e,f,g=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(g.Parser._showConsole(g.Parser._debugFlag.rules,"------------------------------------------------------------------------------",[]),g.Parser._showConsole(g.Parser._debugFlag.rules,"checking token "+b+" from Lookahead stack "+c,[]),void 0===c)return!1;for(f=c.length-1;f>=0&&(d=g.ParsingProcedures._getPeekValue(c[f]),e=g.ParsingProcedures.isTermInfinite(c[f]),void 0!==d);f--)if(g.ParsingProcedures._isClosingBracket(b.value)){if(e===!1)return g.ParsingProcedures.isTokenSame(b,d)}else{if(g.ParsingProcedures._isClosingBracket(d))return g.ParsingProcedures.isTokenSame(b,d);if(!e)return g.Parser._showConsole(g.Parser._debugFlag.common,c[f]+" is not recursive...checking normally now",[]),g.ParsingProcedures.isTokenSame(b,d);if(g.Parser._showConsole(g.Parser._debugFlag.common,"checkign with recursive "+g.ParsingProcedures._getPeekValue(c[f]),[]),g.ParsingProcedures.isTokenSame(b,d))return!0}return!1},isNonTerminal:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return c.Parser._showConsole(c.Parser._debugFlag.common,"checking "+b,[]),"E"===b},_isSpecialTerminal:function(a){return"var"===a||"const"===a||"digit"===a?!0:!1},getPredictionStacksForToken:function(b,c,d){var e,f,g,h=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return g=h.ParsingProcedures._isSpecialTerminal(b.type)?b.type:b.value,h.Parser._showConsole(h.Parser._debugFlag.common,"token value is "+g,[]),e=d?h.RangeProductionRules.rangeRulesTable[c]:h.ParsingProcedures._productions.productionTable[c],h.Parser._showConsole(h.Parser._debugFlag.common,"node objects "+e,[]),f=e[g],h.Parser._showConsole(h.Parser._debugFlag.common,"valid rules "+f,[]),f},recordBracket:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;if(e.ParsingProcedures._isValidBracket(c)){if(0===b.length)return b.push(c),void e.Parser._showConsole(e.Parser._debugFlag.common,"Updating bracket stack "+b,[]);d=b[b.length-1],e.ParsingProcedures._isOppositeBracket(d,c)?(e.Parser._showConsole(e.Parser._debugFlag.common,"Opposites found "+d+"<>"+c,[]),b.pop()):(e.Parser._showConsole(e.Parser._debugFlag.common,"pushing in stack "+c,[]),b.push(c)),e.Parser._showConsole(e.Parser._debugFlag.common,"Updating bracket stack "+b,[])}},_isValidBracket:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return-1!==c.ParsingProcedures._validOpeningBrackets.indexOf(b)||-1!==c.ParsingProcedures._validClosingBrackets.indexOf(b)},_isOpeningBracket:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return-1!==c.ParsingProcedures._validOpeningBrackets.indexOf(b)},_isClosingBracket:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return-1!==c.ParsingProcedures._validClosingBrackets.indexOf(b)},_isOppositeBracket:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;return e.ParsingProcedures._isValidBracket(b)===!1||e.ParsingProcedures._isValidBracket(c)===!1?void e.Parser._showConsole(e.Parser._debugFlag.common,"Wrong bracket Pair "+b+" <> "+c,[]):e.ParsingProcedures._isOpeningBracket(b)?(d=e.ParsingProcedures._validOpeningBrackets.indexOf(b),e.ParsingProcedures._validClosingBrackets[d]===c):(d=e.ParsingProcedures._validClosingBrackets.indexOf(b),e.ParsingProcedures._validOpeningBrackets[d]===c)},getStackCode:function(a){return a.length}}),a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.RangeProductionRules=Backbone.Model.extend({},{rangeRules:null,rangeRulesTable:null,solution:null,generateRules:function(){var b,c,d,e=["var","digit"],f=["\\le","\\ge","<",">"],g={"\\le":"<","\\ge":">"},h=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,i=f.length,j=null;for(h.RangeProductionRules.rangeRulesTable={E:{"var":[],digit:[]}},h.RangeProductionRules.rangeRules=[],h.RangeProductionRules.solution=[],b=0;i>b;b++)c=f[b],j=[],j.push(e[0]),j.push(c),j.push(e[1]),h.RangeProductionRules._createAndPushRule(j),h.RangeProductionRules.solution.push(h.RangeProductionRules._setSequenceRules(c,1,!0)),j=[],j.push(e[1]),j.push(c),j.push(e[0]),h.RangeProductionRules._createAndPushRule(j),h.RangeProductionRules.solution.push(h.RangeProductionRules._setSequenceRules(c,1)),h.RangeProductionRules._getRulesForSeperatorCombination(c),void 0!==g[c]&&(d=g[c],h.RangeProductionRules._getRulesForSeperatorCombination(c,d),h.RangeProductionRules._getRulesForSeperatorCombination(d,c));h.Parser._showConsole(h.Parser._debugFlag.common,"rules :: "),h.Parser._showConsole(h.Parser._debugFlag.common,h.RangeProductionRules.rangeRules),h.Parser._showConsole(h.Parser._debugFlag.common,"rules table :: "),h.Parser._showConsole(h.Parser._debugFlag.common,h.RangeProductionRules.rangeRulesTable)},_setSequenceRules:function(a,b,c){var d;switch(a){case"\\le":d=1===b?c?"var."+(b-1)+" max.equal."+(b+1):"min.equal.0 var."+(b+1):"max.equal."+(b+1);break;case"\\ge":d=1===b?c?"var."+(b-1)+" min.equal."+(b+1):"max.equal.0 var."+(b+1):"min.equal."+(b+1);break;case"<":d=1===b?c?"var."+(b-1)+" max."+(b+1):"min.0 var."+(b+1):"max."+(b+1);break;case">":d=1===b?c?"var."+(b-1)+" min."+(b+1):"max.0 var."+(b+1):"min."+(b+1)}return d},_getRulesForSeperatorCombination:function(b,c){var d,e=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine,f=["digit","var","digit"];void 0===c&&(c=b),f.splice(1,0,b),f.splice(3,0,c),e.RangeProductionRules._createAndPushRule(f),d=e.RangeProductionRules._setSequenceRules(b,1),d+=" "+e.RangeProductionRules._setSequenceRules(c,3),e.RangeProductionRules.solution.push(d)},_createAndPushRule:function(b){var c=a.Common.Components.Models.MathUtilitiesGraph.EquationEngine;c.RangeProductionRules.rangeRules.push(b),c.RangeProductionRules.rangeRulesTable.E[b[0]].push(c.RangeProductionRules.rangeRules.length-1)}}),a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.EquationEnums=Backbone.Model.extend({},{ERROR_TOO_MANY_FREE_VARIABLES:"Too many free variables.",ERROR_CONSTANTS_NOT_DEFINED:"Constants are not defined",ERROR_COMPLICATED:"Its complicated",ERROR_SYNTAX_ERROR:"Equation has syntax error",ERROR_VARIABLE_HAS_TO_BE_QUADRATIC:"Atleast one variable has to be quadratic"})}(window.MathInteractives);var geomFunctions={isDebugMode:!1,distance:function(a,b){return Math.sqrt((b.y-a.y)*(b.y-a.y)+(b.x-a.x)*(b.x-a.x))},distance2:function(a,b,c,d){return Math.sqrt((d-b)*(d-b)+(c-a)*(c-a))},hypotenuse:function(a,b){return 0===a&&0===b?0:Math.abs(a)>Math.abs(b)?Math.abs(a)*Math.sqrt(b/a*(b/a)+1):Math.abs(b)*Math.sqrt(a/b*(a/b)+1)},areaOfEllipse:function(a,b){var c;return c=Math.PI*a*b},areaOfArcSegament:function(a){var b,c,d,e;return c=geomFunctions.areaOfArcSector(a),e=[[a.x1,a.y1],[a.a,a.b],[a.x3,a.y3],[a.x1,a.y1]],d=geomFunctions.areaOfIrregularPolygon(e),b=d+c},areaOfArcSector:function(a){var b,c;return b=geomFunctions.getArcAngle(a),c=b/360*(Math.PI*a.r*a.r)},intersectionOfLines:function(a,b,c,d,e,f,g,h){var i=(a-c)*(f-h)-(b-d)*(e-g);if(0!==i){var j=((a*d-b*c)*(e-g)-(a-c)*(e*h-f*g))/i,k=((a*d-b*c)*(f-h)-(b-d)*(e*h-f*g))/i;return[j,k]}},intersectionOfCircles:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n={},o={},p=[],g=geomFunctions.distance2(a,b,c,d);return g>e+f?p:g<Math.abs(e-f)?p:(h=(e*e-f*f+g*g)/(2*g),i=(f*f-e*e+g*g)/(2*g),m=Math.sqrt(e*e-h*h),o.a=b-d,o.b=-(a-c),o.c=-o.b*b-o.a*a,k=geomFunctions.getPointAtADistance(o.a,o.b,o.c,a,b,h),l=geomFunctions.getPointAtADistance(o.a,o.b,o.c,c,d,i),j=k[0][0].toFixed(3)===l[0][0].toFixed(3)&&k[0][1].toFixed(3)===l[0][1].toFixed(3)||k[0][0].toFixed(3)===l[1][0].toFixed(3)&&k[0][1].toFixed(3)===l[1][1].toFixed(3)?k[0]:k[1],n.a=-o.b,n.b=o.a,n.c=-o.a*j[0]+o.b*j[1],p=geomFunctions.getPointAtADistance(n.a,n.b,n.c,j[0],j[1],m))},onSegment:function(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)},orientation:function(a,b,c){var d=(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y);return 0==d?0:d>0?1:2},doSegmentIntersect:function(a,b,c,d){var e=geomFunctions.orientation(a,b,c),f=geomFunctions.orientation(a,b,d),g=geomFunctions.orientation(c,d,a),h=geomFunctions.orientation(c,d,b);return e!=f&&g!=h?!0:0==e&&geomFunctions.onSegment(a,c,b)?!0:0==f&&geomFunctions.onSegment(a,d,b)?!0:0==g&&geomFunctions.onSegment(c,a,d)?!0:0==h&&geomFunctions.onSegment(c,b,d)?!0:!1},calculateLineOutCode:function(a,b,c,d,e,f,g){var h=0,i=1,j=2,k=4,l=8;return("undefined"==typeof g||null===g)&&(g=0),c+g>=a?h|=i:a>=d-g&&(h|=j),e+g>=b?h|=k:b>=f-g&&(h|=l),h},doesLineIntersectRectangle:function(a,b,c,d,e,f,g,h){var i;return(i=geomFunctions.doSegmentIntersect({x:a,y:b},{x:c,y:d},{x:e,y:g},{x:f,y:g}))?!0:(i=geomFunctions.doSegmentIntersect({x:a,y:b},{x:c,y:d},{x:f,y:g},{x:f,y:h}))?!0:(i=geomFunctions.doSegmentIntersect({x:a,y:b},{x:c,y:d},{x:f,y:h},{x:e,y:h}))?!0:(i=geomFunctions.doSegmentIntersect({x:a,y:b},{x:c,y:d},{x:e,y:h},{x:e,y:g}),i?!0:!1)},lineClipWithRectangle:function(a,b,c,d,e,f,g,h){for(var i,j,k,l=geomFunctions.calculateLineOutCode(a,b),m=geomFunctions.calculateLineOutCode(c,d),n=!1,o=1,p=2,q=4,r=8;;){if(!(l|m)){n=!0;break}if(l&m)break;k=l?l:m,k&r?(i=a+(c-a)*(h-b)/(d-b),j=h):k&q?(i=a+(c-a)*(g-b)/(d-b),j=g):k&p?(j=b+(d-b)*(f-a)/(c-a),i=f):k&o&&(j=b+(d-b)*(e-a)/(c-a),i=e),k==l?(a=i,b=j,l=ComputeOutCode(a,b)):(c=i,d=j,m=ComputeOutCode(c,d))}return n?{x0:a,y0:b,x1:c,y1:d}:void 0},intersectionOfLineAndCircle:function(a,b,c,d,e,f){var g,h,i,j;return g=geomFunctions.getProjectionOfPointOnLine(a,b,d,e,f),i=geomFunctions.distance2(a,b,g[0],g[1]),i>c?void 0:(h=Math.sqrt(c*c-i*i),j=geomFunctions.getPointAtADistance(d,e,f,g[0],g[1],h))},getPointAtADistance:function(a,b,c,d,e,f){var g,h,i,j=[[],[]];return g=-b,h=a,i=Math.sqrt(g*g+h*h),g/=i,h/=i,j[0][0]=d+g*f,j[0][1]=e+h*f,j[1][0]=d-g*f,j[1][1]=e-h*f,j},mean:function(a,b){return a>0==b>0?a+(b-a)/2:(a+b)/2},getProjectionOfPointOnLine:function(a,b,c,d,e){var f=-c*b+d*a,g=c*c+d*d,h=[(-e*c+d*f)/g,(-c*f-d*e)/g];return h},reflectPointAroundLine:function(a,b,c,d,e){var f=this.getProjectionOfPointOnLine(a,b,c,d,e),g=f[0]-a,h=f[1]-b;return f[0]+=g,f[1]+=h,f},areaOfIrregularPolygon:function(a){var b,c=0,d=0,e=0;for(b=0;b<a.length-1;b++)c+=a[b][0]*a[b+1][1];for(b=0;b<a.length-1;b++)d+=a[b][1]*a[b+1][0];return e=Math.abs(c-d)/2},getArcAngle:function(a){var b,c,d=this.getPositiveAngle(a.from),e=this.getPositiveAngle(a.via),f=this.getPositiveAngle(a.to);return a.x1===a.x3&&a.y3===a.y3?360:(d>f?(b=f,c=d):(b=d,c=f),e>b&&c>e?180*(c-b)/Math.PI:180*(2*Math.PI-(c-b))/Math.PI)},getPointOnArcFromOffset:function(a,b,c){var d,e=geomFunctions.getArcAngle(a),f=e/360*2*Math.PI*a.r;return b*=f,d=360*b/(2*Math.PI*a.r),1===c?geomFunctions.rotatePoint(a.x1,a.y1,a.a,a.b,d,!0):3===c?geomFunctions.rotatePoint(a.x3,a.y3,a.a,a.b,d,!0):void 0},isPointProjectionOnArc:function(a,b){var c,d,e=Math.atan2(b[1]-a.b,b[0]-a.a),f=geomFunctions.getPositiveAngle(a.from),g=geomFunctions.getPositiveAngle(a.via),h=geomFunctions.getPositiveAngle(a.to),e=geomFunctions.getPositiveAngle(e);if(f>h?(c=h,d=f):(c=f,d=h),g>c&&d>g){if(!(e>c&&d>e))return!1}else if(e>c&&d>e)return!1;return!0},getPositiveAngle:function(a){return 0>a&&(a+=2*Math.PI),a},reflectLineAroundLine:function(a,b,c,d,e,f){return[a*(Math.pow(e,2)-Math.pow(d,2))-2*b*d*e,b*(Math.pow(d,2)-Math.pow(e,2))-2*a*d*e,c*(Math.pow(d,2)+Math.pow(e,2))-2*f*(d*a+e*b)]},dilateLine:function(a,b,c,d,e,f){var g=-a*e+b*d,h=a*a+b*b,i=[(-c*a+b*g)/h,(-a*g-b*c)/h];return this.dilatePoint(i[0],i[1],d,e,f)},getRotatedImageMatrix:function(a,b,c){var d,e,f,g,h,i;return e=[[1,0,0],[0,1,0],[-b[0],-b[1],1]],h=-c.angle*Math.PI/180,f=[[Math.cos(h),Math.sin(h),0],[-Math.sin(h),Math.cos(h),0],[0,0,1]],g=[[1,0,0],[0,1,0],[b[0],b[1],1]],i=[[a._a,a._c,0],[a._b,a._d,0],[a._tx,a._ty,1]],i=this.matrixMultiplication(i,e),i=this.matrixMultiplication(i,f),i=this.matrixMultiplication(i,g),d=a.set(i[0][0],i[0][1],i[1][0],i[1][1],i[2][0],i[2][1])},getTranslatedImageMatrix:function(a,b){var c,d,e,f;return e=b.dx,f=b.dy,d=[[1,0,0],[0,1,0],[e,f,1]],rasterImageMatrix=[[a._a,a._c,0],[a._b,a._d,0],[a._tx,a._ty,1]],rasterImageMatrix=this.matrixMultiplication(rasterImageMatrix,d),c=a.set(rasterImageMatrix[0][0],rasterImageMatrix[0][1],rasterImageMatrix[1][0],rasterImageMatrix[1][1],rasterImageMatrix[2][0],rasterImageMatrix[2][1])},getDilatedImageMatrix:function(a,b,c,d){var e,f,g,h,i;return e=this.dilatePoint(b[0],b[1],c[0],c[1],d),f=[[1,0,0],[0,1,0],[-b[0],-b[1],1]],h=[[d.ratio,0,0],[0,d.ratio,0],[0,0,1]],g=[[1,0,0],[0,1,0],[b[0],b[1],1]],i=[[a._a,a._c,0],[a._b,a._d,0],[a._tx,a._ty,1]],i=this.matrixMultiplication(i,f),i=this.matrixMultiplication(i,h),i=this.matrixMultiplication(i,g),f=[[1,0,0],[0,1,0],[e[0]-b[0],e[1]-b[1],1]],i=this.matrixMultiplication(i,f),a.set(i[0][0],i[0][1],i[1][0],i[1][1],i[2][0],i[2][1]),a},getReflectedImageMatrix:function(a,b,c){var d,e,f,g,h,i,j,k;return d=[[1,0,0],[0,1,0],[-c[0],-c[1],1]],i=-b.a/b.b,j=Math.atan(i),e=[[Math.cos(j),Math.sin(j),0],[-Math.sin(j),Math.cos(j),0],[0,0,1]],f=[[1,0,0],[0,-1,0],[0,0,1]],g=[[Math.cos(j),-Math.sin(j),0],[Math.sin(j),Math.cos(j),0],[0,0,1]],h=[[1,0,0],[0,1,0],[c[0],c[1],1]],k=[[a._a,a._c,0],[a._b,a._d,0],[a._tx,a._ty,1]],k=this.matrixMultiplication(k,d),k=this.matrixMultiplication(k,e),k=this.matrixMultiplication(k,f),k=this.matrixMultiplication(k,g),k=this.matrixMultiplication(k,h),a.set(k[0][0],k[0][1],k[1][0],k[1][1],k[2][0],k[2][1]),a},matrixMultiplication:function(a,b){var c,d,e,f=[[0,0,0],[0,0,0],[0,0,0]];for(c=0;3>c;c++)for(d=0;3>d;d++)for(e=0;3>e;e++)f[c][d]+=a[c][e]*b[e][d];return f},getPolarCoordinate:function(a,b,c){var d=Math.sqrt(a*a+b*b),e=Math.atan2(b,a);return c&&(e=180*e/Math.PI),[d,e]},dotProduct:function(a,b,c,d){return a*c+b*d},getSegmentParam:function(a,b,c,d,e,f){var g=this.hypotenuse(e-c,f-d);if(0===g)return 0;var h=this.dotProduct((a-c)/g,(b-d)/g,(e-c)/g,(f-d)/g);return h},midPoint:function(a,b){return[(b[0]+a[0])/2,(b[1]+a[1])/2]},midPoint2:function(a,b,c,d){return[(a+c)/2,(b+d)/2]},closestPointOnSegment:function(a,b,c,d,e,f){var g=this.getSegmentParam(a,b,c,d,e,f);return 0>=g?[c,d]:g>=1?[e,f]:[c+g*(e-c),d+g*(f-d)]},getPointOffset:function(a,b,c,d,e,f){var g,h,i,j;return g=geomFunctions.distance2(a,b,c,d),h=geomFunctions.distance2(a,b,e,f),i=geomFunctions.distance2(c,d,e,f),j=i>g&&i>h?-h/g:h/g},getPointPositionFromOffset:function(a,b,c,d,e){var f,g,h,i,j=[];return f=geomFunctions.distance2(a,b,c,d),0>e?(g=-e*f,h=f+g):(g=e*f,h=e>1?g-f:f-g),h>g?(i=h/f,j[0]=(1-i)*c+i*a,j[1]=(1-i)*d+i*b):(i=g/f,j[0]=(1-i)*a+i*c,j[1]=(1-i)*b+i*d),j},pointAtADistanceFromMidPoint:function(a,b,c,d,e){var f=geomFunctions.midPoint2(a,b,c,d),g=Math.atan2(a-c,d-b),h=[f[0]+e*Math.cos(g),f[1]+e*Math.sin(g)];return h},pointAtADistanceFromMidPointWithBetterName:function(a,b,c,d,e,f,g,h,i){var j=geomFunctions.midPoint2(a,b,c,d),k=geomFunctions.midPoint2(e,f,g,h),l=Math.atan2(j[1]-k[1],j[0]-k[0]),m=[j[0]+i*Math.cos(l),j[1]+i*Math.sin(l)];return m},distanceToSegment:function(a,b,c,d,e,f){var g=this.closestPointOnSegment(a,b,c,d,e,f);return this.hypotenuse(a-g[0],b-g[1])},getParameterOfParabola:function(a,b,c,d,e,f){var g,h,i;return g=Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2)),h=Math.atan((b-d)/(a-c)),i=(Math.cos(h)*(f-d)-Math.sin(h)*(e-c))/(2*g)},getParameterOfHyperbola:function(a,b,c,d,e,f,g,h,i,j){var k=Math.sqrt(Math.pow(e-g,2)+Math.pow(f-h,2)),l=Math.sqrt(Math.pow(e-i,2)+Math.pow(f-j,2)),m=Math.atan((Math.cos(d)*(f-b)-Math.sin(d)*(e-a))/c);return l>k?m:-Math.PI+m},getParameterOfEllipse:function(a,b,c,d,e,f,g,h,i,j,k){var l,m=Math.sqrt(Math.pow(f-h,2)+Math.pow(g-i,2)),n=Math.sqrt(Math.pow(f-j,2)+Math.pow(g-k,2));return l=Math.atan(a*(Math.cos(e)/(f-b)-Math.sin(e)/(g-c))/(d*(Math.cos(e)/(g-c)+Math.sin(e)/(f-b)))),n>m?l:0>l?(geomFunctions.traceConsole(3.14+l),3.14+l):-3.14+l},angleBetweenPoints:function(a,b,c,d,e,f,g){var h=Math.atan2(f-d,e-c)-Math.atan2(b-d,a-c);return g?180*h/Math.PI:h},smallerAngleBetweenPoints:function(a,b,c,d,e,f,g){var h;return h=this.angleBetweenPoints(a,b,c,d,e,f,!1),Math.abs(h)>Math.PI&&(h=h>0?2*Math.PI-h:2*Math.PI+h),g?180*h/Math.PI:h},rotatePoint:function(a,b,c,d,e,f,g){f&&(e=e*Math.PI/180),g&&(e*=-1);var h=Math.cos(e),i=Math.sin(e);return[c+(a-c)*h-(b-d)*i,d+(a-c)*i+(b-d)*h]},rotateLine:function(a,b,c,d,e,f,g){var c;return g&&(f=f*Math.PI/180),cos=Math.cos(f),sin=Math.sin(f),[a*cos-b*sin,a*sin+b*cos,a*d+b*e+c-(a*d+b*e)*cos-(a*e-b*d)*sin]},getPolarCoordinates:function(a,b,c,d,e){var f,g,h;return f=a-c,g=b-d,theta=Math.atan2(g,f),theta<0&&(theta+=2*Math.PI),e===!0&&(theta=180*theta/Math.PI),h=this.distance2(a,b,c,d),[h,theta]},getCartesianCoordinates:function(a,b,c,d,e){var f=[];return e===!0&&(d=d*Math.PI/180),f[0]=a+c*Math.cos(d),f[1]=b+c*Math.sin(d),f},translatePoint:function(a,b,c,d){var e=d?-1:1;return"polar"===c.coordinateSystem?this.rotatePoint(a+c.r,b,a,b,c.angle,!0,d):[a+c.dx*e,b+c.dy*e]},getTriangleCircumCentre:function(a,b,c,d,e,f){var g=2*(a*(d-f)+c*(f-b)+e*(b-d)),h=((a*a+b*b)*(d-f)+(c*c+d*d)*(f-b)+(e*e+f*f)*(b-d))/g,i=((a*a+b*b)*(e-c)+(c*c+d*d)*(a-e)+(e*e+f*f)*(c-a))/g;return[h,i]},getTriangleIncentre:function(a,b,c,d,e,f){var g=this.distance2(a,b,c,d),h=this.distance2(a,b,e,f),i=this.distance2(e,f,c,d),j=g+h+i;return[(g*e+h*c+i*a)/j,(g*f+h*d+i*b)/j]},dilatePoint:function(a,b,c,d,e){var f,g;return f=c-(c-a)*e.ratio,g=d-(d-b)*e.ratio,[f,g]},getXYInterceptsOfLine:function(a,b,c){var d,e;return d=0===a?null:-c/a,e=0===b?null:-c/b,{xIntercept:d,yIntercept:e}},getCanvasCoordinates:function(a){var b=a.event.target,c=$(b),d=(c.offset(),[a.point.x,a.point.y]);return d},traceConsole:function(a){this.isDebugMode===!0},calculatePerimeter:function(a){var b,c,d,e,f,g,h=0,i=[],j="x",k="y";for(b=Object.keys(a[0]).length,c=.5*b,e=0;c>e;e++)j+=e,k+=e,f=a[0][j],g=a[0][k],i.push([f,g]),j="x",k="y";for(i.push(i[0]),e=0;c>e;e++)d=geomFunctions.distance2(i[e][0],i[e][1],i[e+1][0],i[e+1][1]),h+=d;return h}},CurveDerivativeTracker=Backbone.Model.extend({_points:void 0,_arrOrderNo:void 0,currentDerivatives:void 0,flipState:void 0,initialize:function(){this._points=[],this._arrOrderNo=[],this.currentDerivatives=[],this.flipState=[],this.curveAffinity=[]},trackPoint:function(a){var b,c,d,e,f,g;for(orderCounter=0;orderCounter<4&&(breakAfter=void 0===this._arrOrderNo[orderCounter],0===orderCounter?(b="",breakAfter&&(this._arrOrderNo[orderCounter]=[]),this._arrOrderNo[orderCounter].push(a)):(breakAfter&&(this._arrOrderNo[orderCounter]=[]),c=this._arrOrderNo[orderCounter-1],e=this._getPointDiff(c),1===orderCounter&&(f=180*Math.atan2(e[1],e[0])/Math.PI,Math.abs(f)>85&&(g=f>0?+(1/0):-(1/0),this.curveAffinity[this.curveAffinity.length-1]!==g&&(geomFunctions.traceConsole("Curve now leads to "+g),this.curveAffinity.push(g)))),this._arrOrderNo[orderCounter].push(e),this.flipState[orderCounter]=this._getFlipState(this._arrOrderNo[orderCounter]),b+=this.printPoint(c[c.length-1])+">>"),d=this._arrOrderNo[orderCounter],this.currentDerivatives[orderCounter]=d[d.length-1],!breakAfter);orderCounter++);geomFunctions.traceConsole("Order Derivatives "+this.printPoint(this.currentDerivatives[0])+" >> "+this.printPoint(this.currentDerivatives[1])+" >> "+this.printPoint(this.currentDerivatives[2])+" >> "+this.printPoint(this.currentDerivatives[3])),void 0!==this.currentDerivatives[1]},_getFlipState:function(a){var b=a[a.length-1],c=a[a.length-2];if(void 0!==c){var d=b[0]>=0?1:-1,e=c[0]>=0?1:-1,f=[];return f[0]=0>d*e&&Math.abs(b[0])>1&&Math.abs(c[0])>1,d=b[1]>=0?1:-1,e=c[1]>=0?1:-1,f[1]=0>d*e&&Math.abs(b[1])>1&&Math.abs(c[1])>1,f}},printPoint:function(a){return void 0!==a?a[0].toFixed(2)+","+a[1].toFixed(2):void 0},_radToDeg:function(a){return 180*a/Math.PI},_getPointDiff:function(a){var b=a[a.length-1],c=a[a.length-2];return[b[0]-c[0],b[1]-c[1]]},clear:function(){for(;this._points.length>0;)this._points.pop();for(;this._arrOrderNo.length>0;)this._arrOrderNo.pop();for(;this.currentDerivatives.length>0;)this.currentDerivatives.pop();for(;this.flipState.length>0;)this.flipState.pop()}}),getCanvasCoordinates=function(a){var b=a.event.target,c=$(b),d=(c.offset(),[a.point.x,a.point.y]);return d};!function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraph.plotterModel=Backbone.Model.extend({_equations:null,_equationsMap:null,_annotationPaths:null,incompleteAnnotations:null,_firstPoint:null,pathThickness:null,initialize:function(){this._equations=[],this._equationsMap={},this.incompleteAnnotations=[]}},{BASEPATH:null})}(window.MathInteractives),function(a){"use strict";a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile=Backbone.Model.extend({},{profiler:{},getStartTime:function(a){var b=(new Date).getTime();this.profiler[a]={id:"",start:0,end:0,processingTime:0},this.profiler[a].start=b},getProcessingTime:function(a){var b=(new Date).getTime();return this.profiler[a].end=b,this.profiler[a].processingTime=b-this.profiler[a].start,this.profiler[a].processingTime}})}(window.MathInteractives),function(a){"use strict";a.Common.Components.Views.MathUtilitiesGraph.GridGraph=Backbone.View.extend({ID:null,settingsOption:{XLowerTextBox:"x-lower-text-box",XUpperTextBox:"x-upper-text-box",YLowerTextBox:"y-lower-text-box",YUpperTextBox:"y-upper-text-box",graphTypeButton:"change-graph-type",zoomInButton:"zoom-graph",zoomOutButton:"zoom-out-graph",restoreDefaultZooming:"restore-default-zoom",gridLineDisplayButton:"toggle-grid-line-display",labelLineDisplayButton:"toggle-label-display",axesLinesDisplayButton:"toggle-axes-display",equalizeAxisScaleButton:"equalize-axis",projectorModeButton:"toggle-projector-mode",xAxisLabelInRadian:"change-x-axis-label-to-radian",xAxisLabelInDegree:"change-x-axis-label-to-degree",yAxisLabelInRadian:"change-y-axis-label-to-radian",yAxisLabelInDegree:"change-y-axis-label-to-degree",polarAngleInDegree:"change-polar-angle-label-to-degree",
polarAngleInRadian:"change-polar-angle-label-to-radian",polarAngleLinesButton:"toggle-polar-angle-label-style",xAxisLableStyleButton:"toggle-x-axis-label-style",yAxisLabelStyleButton:"toggle-y-axis-label-style"},events:{click:"_functionAttacher",keyup:"_functionAttacher",mousewheel:"_functionAttacher"},_isGraphDefaultZoomBehaviourAllowed:null,_isGraphDefaultPanBehaviourAllowed:null,_isGestureProgress:!0,snapToGridFlag:void 0,isDragInProgress:void 0,_gridMode:null,resetGridMode:function(){this._gridMode="Graph"},getGridMode:function(){return this._gridMode},setGridMode:function(a){this._gridMode=a},isSnapToGridEnabled:function(){return this.snapToGridFlag},setSnapSnapToGridFlag:function(a){this.snapToGridFlag=a},_isGridRefreshPaused:void 0,pauseGridRefresh:function(){this._isGridRefreshPaused=!0},resumeGridRefresh:function(){this._isGridRefreshPaused=!1},_functionAttacher:function(b,c){var d,e,f=this.ID,g=this.settingsOption,h=$(b.target).attr("data-setting-option");switch(b.type){case"click":switch(h){case g.graphTypeButton:this._graphTypeChange();break;case g.gridLineDisplayButton:this._gridLineDisplayChange();break;case g.labelLineDisplayButton:this._labelDisplayChange();break;case g.axesLinesDisplayButton:this._axisDisplayChange();break;case g.projectorModeButton:this._projectorModeChange();break;case g.equalizeAxisScaleButton:this._equalizeAxisScales();break;case g.xAxisLabelInRadian:this._xAxisMarkerLineStyle(!0);break;case g.xAxisLabelInDegree:this._xAxisMarkerLineStyle(!1);break;case g.yAxisLabelInRadian:this._yAxisMarkerLineStyle(!0);break;case g.yAxisLabelInDegree:this._yAxisMarkerLineStyle(!1);break;case g.polarAngleInDegree:this._polarAngleLineMarkerStyle(!1);break;case g.polarAngleInRadian:this._polarAngleLineMarkerStyle(!0);break;case g.polarAngleLinesButton:this._polarAngleLineMarkerStyleToggle();break;case g.xAxisLableStyleButton:this._xAxisMarkerStyleToggle();break;case g.yAxisLabelStyleButton:this._yAxisMarkerStyleToggle();break;case g.zoomInButton:this._zoomInButtonClicked();break;case g.restoreDefaultZooming:this._restoreDefaultZoomingClicked();break;case g.zoomOutButton:this._zoomOutButtonClicked();break;case g.XLowerTextBox:case g.XUpperTextBox:case g.YLowerTextBox:case g.YUpperTextBox:break;default:this._setTextBoxValues()}break;case"keyup":switch(d=b.keyCode,e=[37,38,39,40,13,9,20,27,33,34,35,36,45],h){case g.XLowerTextBox:case g.XUpperTextBox:-1===e.indexOf(d)&&this._graphAxisLimitChangedByUserInput(!0,e);break;case g.YLowerTextBox:case g.YUpperTextBox:-1===e.indexOf(d)&&this._graphAxisLimitChangedByUserInput(!1,e)}break;case"mousewheel":switch(b.target.id){case f.canvasId:a.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Profile.getStartTime("graph"),this._isGraphDefaultZoomBehaviourAllowed===!0&&"Graph"===this._gridMode&&(this._zoomGraph(c,!0),b.preventDefault())}break;case"dblclick":switch(b.target.id){case f.canvasId:}}},_changeStyleOfEqualizeAxisButton:function(a){a===!0?this.trigger("graph:un-equalize"):this.trigger("graph:equalize")},_shapePan:null,_projectLayers:null,_paperScope:null,_canvasSize:null,markerBounds:null,_polarLineAngleMarker:null,_zoomFactors:[1,2,5],PI:"π",MINIMUM_THRESHOLD_LINE_DISTANCE:15,_gridGraphModelObject:null,_customZoomInMultiplier:null,_customZoomOutMultiplier:null,_backgroundColor:"white",initialize:function(){var b,c,d,e;b=this.options.option,this.disableLineTooltip=this.options.option.disableLineTooltip,this._gridGraphModelObject=new a.Common.Components.Models.MathUtilitiesGraph.GridGraphModel,this.ID={canvasId:null,XLowerTextBox:null,XUpperTextBox:null,YLowerTextBox:null,YUpperTextBox:null,graphTypeButton:null,zoomInButton:null,zoomOutButton:null,restoreDefaultZooming:null,gridLineDisplayButton:null,labelLineDisplayButton:null,axesLinesDisplayButton:null,equalizeAxisScaleButton:null,projectorModeButton:null,xAxisLabelInRadian:null,xAxisLabelInDegree:null,yAxisLabelInRadian:null,yAxisLabelInDegree:null,polarAngleInDegree:null,polarAngleInRadian:null,polarAngleLinesButton:null,xAxisLableStyleButton:null,yAxisLabelStyleButton:null},this._projectLayers={gridLayer:null,shapeLayer:null,pointLayer:null,imageLayer:null,serviceLayer:null},this._canvasSize={height:null,width:null},this.markerBounds={max:{x:null,y:null,"\\theta":null},min:{x:null,y:null,"\\theta":null}},this._polarLineAngleMarker={degree:[],radian:[]},this._gridGraphModelObject.set("_points",[]),this._gridGraphModelObject.set("_plots",[]),this._gridGraphModelObject.set("_images",[]),this._defaultClassVariblesValue(),this._updateClassVariablesValue(b),b.zoomInMultiplier&&(this._customZoomInMultiplier=b.zoomInMultiplier),b.zoomOutMultiplier&&(this._customZoomOutMultiplier=b.zoomOutMultiplier),this.isDragInProgress=!1,this.snapToGridFlag=!1,this._gridMode="Graph",this._polarAngleLinesMarkerArrayGenerator(),this._canvasSetUp(),b.backgroundColor&&(this._backgroundColor=new this._paperScope.Color(b.backgroundColor[0],b.backgroundColor[1],b.backgroundColor[2],b.backgroundColor[3])),this._canvasTool(),this.render(),e=this,this._onShapeRollOver=function(a){e.isDragInProgress||"Graph"===e._gridMode&&(c=a.target,$(a.event.target).is("canvas")&&(d=c.equation,d.drawStyle.draggable&&d.trigger("roll-over",d)))},this._onShapeRollOut=function(a){e.isDragInProgress||"Graph"===e._gridMode&&$(a.event.target).is("canvas")&&(c=a.target,d=c.equation,d.drawStyle.draggable&&d.trigger("roll-out",d))}},render:function(){this._cartesionSymbolGenerator(),this._restoreDefaultZoom()},_defaultClassVariblesValue:function(){var a,b,c,d,e,f;this._paperScope;f=this._gridGraphModelObject,b=f.get("_graphDisplayValues"),a=this._canvasSize,c=b._graphOrigin,d=b._graphsAxisLimits,e=b._graphParameters,a.height=800,a.width=1244,d.defaultLimits.xLower=d.currentLimits.xLower=-10,d.defaultLimits.xUpper=d.currentLimits.xUpper=10,d.defaultLimits.yLower=d.currentLimits.yLower=-10,d.defaultLimits.yUpper=d.currentLimits.yUpper=10,e.graphGridLine=4,e.xGridLine=4,e.yGridLine=4,this._shapePan=!1,this._isGraphDefaultZoomBehaviourAllowed=!0,this._isGraphDefaultPanBehaviourAllowed=!0,this.graphShiftDistance=this._GRAPH_MAXIMUM_SHIFT_DISTANCE,this.graphShiftDistanceAfterDrag=this.graphShiftDistance,this.isDrawingsDraggable=!1,this.isTooltipForPoint=!0},_updateClassVariablesValue:function(a){var b,c,d,e,f,g;f=this._gridGraphModelObject,g=f.get("_graphDisplayValues"),d=this._canvasSize,b=g._graphLimitTextBoxDomElement,c=this.ID,e=g._graphsAxisLimits,c.canvasId=a.canvasId,c.XLowerTextBox=a.XLowerTextBox,c.XUpperTextBox=a.XUpperTextBox,c.YLowerTextBox=a.YLowerTextBox,c.YUpperTextBox=a.YUpperTextBox,c.graphTypeButton=a.graphTypeButton,c.zoomInButton=a.zoomInButton,c.zoomOutButton=a.zoomOutButton,c.restoreDefaultZooming=a.restoreDefaultZooming,c.gridLineDisplayButton=a.gridLineDisplayButton,c.labelLineDisplayButton=a.labelLineDisplayButton,c.axesLinesDisplayButton=a.axesLinesDisplayButton,c.equalizeAxisScaleButton=a.equalizeAxisScaleButton,c.projectorModeButton=a.projectorModeButton,c.xAxisLabelInRadian=a.xAxisLabelInRadian,c.xAxisLabelInDegree=a.xAxisLabelInDegree,c.yAxisLabelInRadian=a.yAxisLabelInRadian,c.yAxisLabelInDegree=a.yAxisLabelInDegree,c.polarAngleInRadian=a.polarAngleInRadian,c.polarAngleInDegree=a.polarAngleInDegree,c.yAxisLabelStyleButton=a.yAxisLabelStyleButton,c.xAxisLableStyleButton=a.xAxisLableStyleButton,c.polarAngleLinesButton=a.polarAngleLinesButton,b.xLower=document.getElementById(c.XLowerTextBox),b.xUpper=document.getElementById(c.XUpperTextBox),b.yLower=document.getElementById(c.YLowerTextBox),b.yUpper=document.getElementById(c.YUpperTextBox),"number"==typeof a.canvasHeight&&"number"==typeof a.canvasWidth&&(d.height=a.canvasHeight,d.width=a.canvasWidth),"number"==typeof a.xAxisMinValue&&"number"==typeof a.xAxisMaxValue&&(e.defaultLimits.xLower=e.currentLimits.xLower=a.xAxisMinValue,e.defaultLimits.xUpper=e.currentLimits.xUpper=a.xAxisMaxValue),void 0!==a._isGraphDefaultZoomBehaviourAllowed&&(this._isGraphDefaultZoomBehaviourAllowed=a.isGraphDefaultZoomBehaviourAllowed),void 0!==a._isGraphDefaultPanBehaviourAllowed&&(this._isGraphDefaultPanBehaviourAllowed=a.isGraphDefaultPanBehaviourAllowed),a.isDrawingsDraggable&&(this.isDrawingsDraggable=!0),(a.isTooltipForPoint||a.isTooltipForPoint===!1)&&(this.isTooltipForPoint=a.isTooltipForPoint),a.stopDoubleClickZoom&&(g._zoomingFactor.doubleClickZoomAllow=!a.stopDoubleClickZoom)},_canvasSetUp:function(){var a,b,c,d,e=this._gridGraphModelObject.get("_graphDisplayValues");a=document.getElementById(this.ID.canvasId),b=this._canvasSize.height,c=this._canvasSize.width,300===$(a).width()&&150===$(a).height()?$(a).width(c).height(b):(this._canvasSize.width=$(a).width(),this._canvasSize.height=$(a).height()),this._paperScope=new paper.PaperScope,this._paperScope.install($("#"+this.ID.canvasId)),this._paperScope.setup(a),d=this,e._graphOrigin.defaultOrigin=new this._paperScope.Point(a.width/2,a.height/2);var f=this._paperScope;this._gridGraphModelObject.get("_graphDisplayValues")._graphOrigin.defaultOrigin=new f.Point(this._canvasSize.width/2,this._canvasSize.height/2),this._projectLayers.gridLayer=f.project.activeLayer,this._projectLayers.imageLayer=new f.Layer,this._projectLayers.shapeLayer=new f.Layer,this._projectLayers.pointLayer=new f.Layer,this._projectLayers.labelLayer=new f.Layer,this._projectLayers.bannerLayer=new f.Layer,this._projectLayers.annotationLayer=new f.Layer,this._projectLayers.serviceLayer=new f.Layer,this._projectLayers.gridLayer.activate(),d=this,this._pinchCounter=1,a.addEventListener("gesturechange",function(a){d._isGraphDefaultZoomBehaviourAllowed===!0&&d._pinchZoom(a)}),a.addEventListener("gesturestart",function(){d._isGestureProgress=!1}),a.addEventListener("gestureend",function(){d._isGestureProgress=!0}),a.addEventListener("touchstart",function(a){null===d._touchDoubleTapCounter?d._touchDoubleTapCounter=(new Date).getTime():(new Date).getTime()-d._touchDoubleTapCounter>d._DOUBLE_TAP_THRESHOLD?d._touchDoubleTapCounter=null:(d._touchDoubleTapCounter=null,d._graphDoubleClick(a))})},_selectionRect:null,_touchDoubleTapCounter:null,_DOUBLE_TAP_THRESHOLD:600,_pinchCounter:null,_pinchZoom:function(a){a.scale>1?(5===this._pinchCounter&&(this._zoomGraph(1,!0,!0),this._pinchCounter=0),this._pinchCounter++):(5===this._pinchCounter&&(this._zoomGraph(-1,!0,!0),this._pinchCounter=0),this._pinchCounter++)},_canvasTool:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=this._zoomingFactor,t=!1,u=this._paperScope;c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),f=this._canvasSize.width,g=this._canvasSize.height,s=d._zoomingFactor,a=this,b=d._graphOrigin,this._projectLayers.shapeLayer.onMouseDown=function(b){a.activateScope(),a.trigger("grid-mousedown",b),a._isGraphDefaultPanBehaviourAllowed===!0&&"Graph"===a._gridMode&&a._isGestureProgress&&(a._projectLayers.shapeLayer.activate(),e=u.project.activeLayer.hitTest(b.point,{stroke:!0,type:u.Group}),void 0!==e?("stroke"===e.type&&(t=!0),t=null===e?!1:null!==e.item&&"group"===e.item._parent.type?!0:!1):t=!1,a._shapePan=t,t===!0&&this.disableLineTooltip===!0?(a._projectLayers.shapeLayer.activate(),a._traceMouseDownHandle.apply(a,[b,e.item._parent]),a._projectLayers.gridLayer.activate()):a.off("grid-graph-mousedrag",q).on("grid-graph-mousedrag",q).off("grid-graph-mouseup",p).on("grid-graph-mouseup",p))},this._paperScope.tool.minDistance=1,this._projectLayers.shapeLayer.onMouseDrag=function(b){a.activateScope(),a._isGraphDefaultPanBehaviourAllowed===!0&&"Graph"===a._gridMode&&a._isGestureProgress&&a._shapePan===!0&&this.disableLineTooltip===!0&&(a._projectLayers.shapeLayer.activate(),a._traceMouseDragHandle.apply(a,[b,e.item._parent]),a._projectLayers.gridLayer.activate())},i=function(d){if(a.activateScope(),a._isGraphDefaultPanBehaviourAllowed===!0&&"Graph"===a._gridMode&&a._isGestureProgress)a._shapePan===!0&&a.disableLineTooltip!==!0?(a._projectLayers.shapeLayer.activate(),a._traceMouseDragHandle.apply(a,[d,e.item._parent]),a._projectLayers.gridLayer.activate()):(b.currentOrigin.x+=d.delta.x,b.currentOrigin.y+=d.delta.y,a._graphTypeSelector(),b.isOriginPositionChanged=!0,a._graphLimitChangesDuringDragging(),a._deltaAngle(),a._previousMaxValue=a._getGraphPointCoordinates([f,g/2])[0],(0!==c.get("_plots").length||0!==c.get("_images").length)&&(0!==c.get("_plots").length&&(a._layerDrag(a._projectLayers.shapeLayer,d.delta),a._layerDrag(a._projectLayers.labelLayer,d.delta),a._layerDrag(a._projectLayers.annotationLayer,d.delta)),0!==c.get("_images").length&&a._layerDrag(a._projectLayers.imageLayer,d.delta),clearTimeout($.data(a,"timer")),$.data(a,"timer",setTimeout(function(){a.trigger("graph:zoom-pan"),a._paperScope.view.draw()},150))),0!==c.get("_points").length&&a._repositionPoints());else if("SelectionRect"===a._gridMode){var h=a._selectionRect._startPoint,i=a._getMinXMinYFromPoints(d.point,h),j=Math.abs(d.point.x-a._selectionRect._startPoint.x),k=Math.abs(d.point.y-a._selectionRect._startPoint.y);a._selectionRect.remove(),a._selectionRect=null,a._selectionRect=new a._paperScope.Path.Rectangle(i,{width:j,height:k}),a._selectionRect.style={strokeColor:"black",strokeWidth:2},a._selectionRect._startPoint=h}},j=this._projectLayers.gridLayer,j.name="grid",k=this._projectLayers.shapeLayer,k.name="shape",l=this,m=this._projectLayers.pointLayer,m.name="point",n=this._projectLayers.bannerLayer,n.name="banner",o=this._projectLayers.imageLayer,o.name="image",this._addLayerClickDoubleClickEvents(m),this._addLayerClickDoubleClickEvents(this._projectLayers.shapeLayer),this._addLayerClickDoubleClickEvents(n),this._addLayerClickDoubleClickEvents(this._projectLayers.gridLayer),this._addLayerClickDoubleClickEvents(o),this._paperScope.tool.onMouseDrag=function(b){"undefined"==typeof a.$el.attr("ogCursor")&&a._isGraphDefaultPanBehaviourAllowed===!0&&(a.$el.attr("ogCursor",a.$el.find("canvas").css("cursor")),a.$el.find("canvas").trigger("interactivegraphpanningstart"),a.$el.find("canvas").css("cursor","move")),a.trigger("grid-graph-mousedrag",b),a.trigger("draw-annotation",b)},this._paperScope.tool.onMouseDown=function(b){a.trigger("grid-graph-mousedown",b),a.trigger("annotation-start",b)},this._paperScope.tool.onMouseUp=function(c){a.$el.attr("ogCursor")&&(a.$el.find("canvas").css("cursor",a.$el.attr("ogCursor")),a.$el.find("canvas").trigger("interactivegraphpanningstop"),a.$el.removeAttr("ogCursor")),a.activateScope(),3!==c.event.which&&(l.isDragInProgress=!1,s.previousZoomAngle=a._angleBetweenTwoPoints(b.currentOrigin,b.defaultOrigin),h=Math.sqrt(Math.pow(c.delta.x,2)+Math.pow(c.delta.y,2)),0!==h&&(h>a._GRAPH_MAXIMUM_SHIFT_DISTANCE?(a.graphShiftDistance=a._GRAPH_MAXIMUM_SHIFT_DISTANCE,a.graphShiftDistanceAfterDrag=a.graphShiftDistance):(a.graphShiftDistance=h,a.graphShiftDistanceAfterDrag=a.graphShiftDistance)),null!==a._gridGraphModelObject.get("circleDrag")&&(a._gridGraphModelObject.get("circleDrag").visible=!1,a.$(".drag-tooltip").remove()),a.trigger("grid-graph-mouseup",c),a.trigger("annotation-end",c))},!("ontouchstart"in window),p=function(){if("SelectionRect"===this._gridMode&&this._selectionRect){var a=this._selectionRect.bounds;this._selectionRect.remove(),this._selectionRect=null,this.trigger("selection-rect-complete",a)}this.off("grid-graph-mousedrag",q)},q=function(a){i(a)},this.on("grid-layer-mousedown",function(b){"SelectionRect"===a._gridMode&&(a._selectionRect=new this._paperScope.Path.Rectangle(b.point,{width:1,height:1}),a._selectionRect.strokeColor="black",a._selectionRect.strokeWidth=2,a._selectionRect._startPoint=b.point),this.on("grid-graph-mousedrag",q),this.on("grid-graph-mouseup",p)}),r=function(c){a._isGraphDefaultPanBehaviourAllowed===!0&&"Graph"===a._gridMode&&a._isGestureProgress&&(a.trigger("graph:zoom-pan"),a._paperScope.view.draw(),a._shapePan=!1),b.doubleClickedPoint=c.point},this.on("grid-layer-mouseup",r),this.on("grid-layer-doubleclick",$.proxy(this._graphDoubleClick,this))},_getMinXMinYFromPoints:function(a,b){var c={x:null,y:null};return c.x=a.x<=b.x?a.x:b.x,c.y=a.y<=b.y?a.y:b.y,c},refreshView:function(){this._isGridRefreshPaused||this._paperScope.view.draw()},_addLayerClickDoubleClickEvents:function(a){var b,c,d,e,f,g,h,i,j,k=200;e=this,h=function(c){if(3!==c.event.which&&("Graph"===e._gridMode||"SelectionRect"===e._gridMode)){"image"!==a.name&&"service"!==a.name;var h,j,l,m;b&&clearInterval(b),h=function(){b&&(d=void 0,clearInterval(b)),e.isDragInProgress=!1,e.off("grid-graph-mouseup",h)},j=c.target,l=j.parent,m=void 0===j.equation?l.equation:j.equation,m&&m.trigger("drag-begin",e._getGraphPointCoordinates(getCanvasCoordinates(c)),m),(!m||m.drawStyle.draggable)&&(f=getCanvasCoordinates(c),g=[f[0]-l.position.x,f[1]-l.position.y],e.on("grid-graph-mouseup",h),e.isDragInProgress=!0,b=setInterval(function(){i(c)},k/2))}},i=function(h){var i,j,k,l,m,n;clearInterval(b),b=void 0,i=h.target,e.trigger(a.name+"-layer-mousedown",h),"grid"!==a.name&&(j=i.parent,k=getCanvasCoordinates(h),m=function(b){d=i;var h,j,k,m,n;c&&(clearInterval(c),c=void 0),void 0!==b.event&&(l||(l=f),j=i.parent,k=getCanvasCoordinates(b),m=k[0]-l[0],n=k[1]-l[1],h=void 0===i.equation?j.equation:i.equation,k[0]-=g[0],k[1]-=g[1],e.snapToGridFlag&&"point"===a.name&&(k=e.getClosestCanvasPoint(k)),h&&h.trigger("pre-drag",e._getGraphPointCoordinates(k),h,k),j.position.x=k[0],j.position.y=k[1],l=k,this._paperScope.view.draw(),h&&h.trigger("post-drag",h))},n=function(b){if(3!==b.event.which){var c,d,f,h,j,l;e.off("grid-graph-mousedrag",m),e.off("grid-graph-mouseup",n),h=getCanvasCoordinates(b),d=h[0]-k[0],f=h[1]-k[1],j=.1,Math.abs(d)<j&&Math.abs(f)<j||(c=void 0===i.equation?i.parent.equation:i.equation,h[0]-=g[0],h[1]-=g[1],e.snapToGridFlag&&"point"===a.name&&(h=e.getClosestCanvasPoint(h)),c.trigger("pre-relocate",e._getGraphPointCoordinates(h),c,h),e.isDragInProgress=!1,l=e._getGraphPointCoordinates(h),"point"===c.type&&(c.points=[l],c.trigger("change-equation")),c&&c.trigger("post-relocate",l,c))}},e.on("grid-graph-mousedrag",m),e.on("grid-graph-mouseup",n))},("grid"===a.name||e.isDrawingsDraggable===!0)&&(a.onMouseDown=h),a.onDoubleClick=function(d){if(3!==d.event.which&&"Graph"===e._gridMode){var f;b&&(clearInterval(b),b=void 0),c&&(clearInterval(c),c=void 0),e.isDragInProgress=!1,f=d.target,e.trigger(a.name+"-layer-doubleclick",d)}},j=function(b){c&&(clearInterval(c),c=void 0),e.isDragInProgress=!1,d!==b.target&&(e.trigger(a.name+"-layer-mouseup",b),e.trigger(a.name+"-layer-click",b),e._paperScope.view.draw())},a.onClick=function(b){3!==b.event.which&&("Graph"===e._gridMode||"point"===a.name||"tabletDrawing"===e._gridMode)&&(c&&(clearInterval(c),c=void 0),c=setInterval(function(){j(b)},k))}},_onShapeRollOver:void 0,_onShapeRollOut:void 0,_setPathRollOverListeners:function(a){a.onMouseEnter=this._onShapeRollOver,a.onMouseLeave=this._onShapeRollOut},_removePathRollOverListeners:function(a){a.onMouseEnter=void 0,a.onMouseLeave=void 0},_labelDisplayChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isLabelShown=!b._graphDisplay.isLabelShown,this._graphTypeSelector()},_axisDisplayChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isAxisLinesShown=!b._graphDisplay.isAxisLinesShown,this._graphTypeSelector()},_gridLineDisplayChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isGridLineShown=!b._graphDisplay.isGridLineShown,this._graphTypeSelector()},_projectorModeChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isProjectorModeOn=!b._graphDisplay.isProjectorModeOn,this._cartesionSymbolGenerator(),this._graphTypeSelector()},graphZoomIn:function(){this.isDragInProgress||this._zoomInButtonClicked()},_zoomInButtonClicked:function(){if(!this.isDragInProgress){var a,b,c,d=1,e=this;a=this._customZoomInMultiplier?this._customZoomInMultiplier:(this._MAXIMUM_ZOOM_LEVEL_FACTOR-this._MINIMUM_ZOOM_LEVEL_FACTOR)/this._ZOOM_LEVEL_INCREMENT_STEPS,b=function(){e._zoomGraph(1,!0)},c=setInterval(function(){b(),d++,d>a&&clearInterval(c)},.1)}},graphZoomOut:function(){this.isDragInProgress||this._zoomOutButtonClicked()},_zoomOutButtonClicked:function(){if(!this.isDragInProgress){var a,b,c,d=1,e=this;a=this._customZoomOutMultiplier?this._customZoomOutMultiplier:(this._MAXIMUM_ZOOM_LEVEL_FACTOR-this._MINIMUM_ZOOM_LEVEL_FACTOR)/this._ZOOM_LEVEL_INCREMENT_STEPS,b=function(){e._zoomGraph(-1,!0)},c=setInterval(function(){b(),d++,d>a&&clearInterval(c)},.1)}},_graphDoubleClick:function(a){this.activateScope();var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=1;j=this._gridGraphModelObject,k=j.get("_graphDisplayValues"),q=k._zoomingFactor.doubleClickZoomAllow,this._shapePan||q===!1||(b=this,c=(this._MAXIMUM_ZOOM_LEVEL_FACTOR-this._MINIMUM_ZOOM_LEVEL_FACTOR)/this._ZOOM_LEVEL_INCREMENT_STEPS,e=k._graphOrigin,d=a.point,g=e.currentOrigin,i=e.defaultOrigin,h=k._zoomingFactor,m=this._canvasSize.height,n=this._canvasSize.width,e.isOriginPositionChanged=!0,o=this._getGraphPointCoordinates([d.x,d.y]),f=function(){b._zoomGraph(1,!1)},l=setInterval(function(){p=b._originShiftFactorForDoubleClick(o),b.graphShiftDistance=p.distance,h.previousZoomAngle=p.angle,f(),r++,r>c&&(clearInterval(l),b.graphShiftDistance=b.graphShiftDistanceAfterDrag)},.1))},_xAxisMarkerStyleToggle:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isXmarkerInRadians=!b._graphDisplay.isXmarkerInRadians,this._graphTypeSelector()},_xAxisMarkerLineStyle:function(a){var b,c;b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),c._graphDisplay.isXmarkerInRadians=a,this._graphTypeSelector()},_yAxisMarkerStyleToggle:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isYmarkerInRadians=!b._graphDisplay.isYmarkerInRadians,this._graphTypeSelector()},_yAxisMarkerLineStyle:function(a){var b,c;b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),c._graphDisplay.isYmarkerInRadians=a,this._graphTypeSelector()},_graphTypeChange:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isCartesionCurrentGraphType=!b._graphDisplay.isCartesionCurrentGraphType,this._graphTypeSelector()},_polarAngleLineMarkerStyleToggle:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isPolarAngleInRadian=!b._graphDisplay.isPolarAngleInRadian,this._graphTypeSelector()},_polarAngleLineMarkerStyle:function(a){var b,c;b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),c._graphDisplay.isPolarAngleInRadian=a,this._graphTypeSelector()},defaultGraphZoom:function(){this._restoreDefaultZoomingClicked()},_restoreDefaultZoomingClicked:function(){this._restoreDefaultZoom(),this._deltaAngle(),this._changeStyleOfEqualizeAxisButton(!1)},_restoreDefaultZoom:function(){this.activateScope();var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;o=this._gridGraphModelObject,i=o.get("_graphDisplayValues"),m=this._canvasSize,l=m.width,k=m.height,j=i._graphsAxisLimits,e=j.defaultLimits,f=i._zoomingFactor,p=i._graphParameters,g=this._zoomFactors,h=i._graphOrigin,q=i._graphDisplay,n=this.markerBounds,a=e.xLower,c=e.xUpper,b=e.yLower,d=e.yUpper,f.xCurrentFactor=f.yCurrentFactor=g[1],f.xZoomMultiplier=f.yZoomMultiplier=1,f.xTotalMultiplier=f.yTotalMultiplier=g[1],p.yGridLine=4,p.xGridLine=4,f.zoomLevel=1,h.isOriginPositionChanged=!1,j.isXLastChangedLimit=!0,f.zoomFactorForGraphParameterModification=1,f.xZoomFactorForGraphParameterModification=1,f.yZoomFactorForGraphParameterModification=1,this._axisMarkerMultiplierAdjuster(a,c,b,d),this._equalizeAxisScales()},_MINIMUM_ZOOM_LEVEL_FACTOR:-1.5,_MAXIMUM_ZOOM_LEVEL_FACTOR:1.5,_ZOOM_LEVEL_INCREMENT_STEPS:.5,_GRAPH_MAXIMUM_SHIFT_DISTANCE:50,graphShiftDistance:null,graphShiftDistanceAfterDrag:null,isDrawingsDraggable:null,isTooltipForPoint:null,_zoomGraph:function(a,b,c){this.activateScope();var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;(!this.isDragInProgress||c)&&("annotation-mode"!==this._gridMode||c)&&"Graph"===this._gridMode&&(b=void 0,q=this._gridGraphModelObject,r=q.get("_graphDisplayValues"),m=r._graphParameters,n=r._graphOrigin,o=this._canvasSize.height,p=this._canvasSize.width,d=m.distanceBetweenTwoHorizontalLines,e=m.distanceBetweenTwoVerticalLines,f=m.graphGridLine,v=m.xGridLine,w=m.yGridLine,h=n.currentOrigin,i=n.defaultOrigin,j=r._zoomingFactor,g=this._zoomFactors,u=this.graphShiftDistance,0!==a&&(a>0?(n.isOriginPositionChanged===!0?(k=j.previousZoomAngle-Math.PI,t=new this._paperScope.Point(h.x+Math.cos(k)*u,h.y-Math.sin(k)*u),this._delta=new this._paperScope.Point(n.currentOrigin.x-t.x,n.currentOrigin.y-t.y),n.currentOrigin=t,this._previousMaxValue=this._getGraphPointCoordinates([p,o/2])[0]):this._delta=new this._paperScope.Point(0,0),j.zoomLevel-=this._ZOOM_LEVEL_INCREMENT_STEPS,j.zoomLevel<=this._MINIMUM_ZOOM_LEVEL_FACTOR&&(j.zoomLevel=this._MAXIMUM_ZOOM_LEVEL_FACTOR),j.zoomLevel===this._MAXIMUM_ZOOM_LEVEL_FACTOR&&(this._xAxisZoomFactorModifier(!1),this._yAxisZoomFactorModifier(!1)),v=m.xGridLine,w=m.yGridLine,j.zoomFactorForGraphParameterModification=f/(f-j.zoomLevel),j.xZoomFactorForGraphParameterModification=v/(v-j.zoomLevel),j.yZoomFactorForGraphParameterModification=w/(w-j.zoomLevel)):(h.x!==i.x||h.y!==i.y?(l=Math.sqrt(Math.pow(h.x-i.x,2)+Math.pow(h.y-i.y,2)),u=.1*l,10>=l?(t=i,this._delta=new this._paperScope.Point(n.currentOrigin.x-t.x,n.currentOrigin.y-t.y),n.currentOrigin=t,this._previousMaxValue=this._getGraphPointCoordinates([p,o/2])[0]):(k=this._angleBetweenTwoPoints(h,i),j.previousZoomAngle=k,k=j.previousZoomAngle,t=new this._paperScope.Point(h.x+Math.cos(k)*u,h.y-Math.sin(k)*u),this._delta=new this._paperScope.Point(n.currentOrigin.x-t.x,n.currentOrigin.y-t.y),n.currentOrigin=t,this._previousMaxValue=this._getGraphPointCoordinates([p,o/2])[0])):this._delta=new this._paperScope.Point(0,0),j.zoomLevel+=this._ZOOM_LEVEL_INCREMENT_STEPS,j.zoomLevel>=this._MAXIMUM_ZOOM_LEVEL_FACTOR&&(j.zoomLevel=this._MINIMUM_ZOOM_LEVEL_FACTOR),j.zoomLevel===this._MINIMUM_ZOOM_LEVEL_FACTOR&&(this._xAxisZoomFactorModifier(!0),this._yAxisZoomFactorModifier(!0)),v=m.xGridLine,w=m.yGridLine,j.zoomFactorForGraphParameterModification=f/(f-j.zoomLevel),j.xZoomFactorForGraphParameterModification=v/(v-j.zoomLevel),j.yZoomFactorForGraphParameterModification=w/(w-j.zoomLevel)),this._graphTypeSelector(),this._graphLimitChangesDuringDragging(),this._deltaAngle(),0!==q.get("_plots").length&&this._shapeZoom(),0!==q.get("_points").length&&this._repositionPoints(),s=this,clearTimeout($.data(this,"timer")),$.data(this,"timer",setTimeout(function(){(0!==q.get("_plots").length||0!==q.get("_images").length)&&(s._shapeRedraw(),s._paperScope.view.draw()),s.$el.find("canvas").trigger("interactivegraphzoomcomplete")},100)),this._paperScope.view.draw()))},_xAxisZoomFactorModifier:function(a){var b,c,d,e;if(d=this._gridGraphModelObject,e=d.get("_graphDisplayValues"),b=e._zoomingFactor,c=this._zoomFactors,a===!0)switch(b.xCurrentFactor){case c[0]:b.xCurrentFactor=c[1],b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=4;break;case c[1]:b.xCurrentFactor=c[2],b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=5;break;case c[2]:b.xCurrentFactor=c[0],b.xZoomMultiplier=10*b.xZoomMultiplier,b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=4}else switch(b.xCurrentFactor){case c[0]:b.xCurrentFactor=c[2],b.xZoomMultiplier=b.xZoomMultiplier/10,b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=5;break;case c[1]:b.xCurrentFactor=c[0],b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=4;break;case c[2]:b.xCurrentFactor=c[1],b.xTotalMultiplier=b.xCurrentFactor*b.xZoomMultiplier,e._graphParameters.xGridLine=4}},_yAxisZoomFactorModifier:function(a){var b,c,d,e;if(d=this._gridGraphModelObject,e=d.get("_graphDisplayValues"),b=e._zoomingFactor,c=this._zoomFactors,a===!0)switch(b.yCurrentFactor){case c[0]:b.yCurrentFactor=c[1],b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=4;break;case c[1]:b.yCurrentFactor=c[2],b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=5;break;case c[2]:b.yCurrentFactor=c[0],b.yZoomMultiplier=10*b.yZoomMultiplier,b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=4}else switch(b.yCurrentFactor){case c[0]:b.yCurrentFactor=c[2],b.yZoomMultiplier=b.yZoomMultiplier/10,b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=5;break;case c[1]:b.yCurrentFactor=c[0],b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=4;break;case c[2]:b.yCurrentFactor=c[1],b.yTotalMultiplier=b.yCurrentFactor*b.yZoomMultiplier,e._graphParameters.yGridLine=4}},_angleBetweenTwoPoints:function(a,b){var c,d,e;return c=Math.abs(a.y-b.y),d=Math.abs(a.x-b.x),e=Math.atan(d/c),e=a.y<b.y?a.x<b.x?3*Math.PI/2+e:a.x>b.x?3*Math.PI/2-e:3*Math.PI/2:a.y>b.y?a.x<b.x?Math.PI/2-e:a.x>b.x?Math.PI/2+e:Math.PI/2:a.x<b.x?0:a.x>b.x?Math.PI:0},_graphLimitChangesDuringDragging:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;m=this._gridGraphModelObject,n=m.get("_graphDisplayValues"),o=m.get("markerBounds"),i=n._graphParameters,a=i.graphGridLine,p=i.xGridLine,q=i.yGridLine,b=i.distanceBetweenTwoVerticalLines,c=i.distanceBetweenTwoHorizontalLines,d=n._graphOrigin.currentOrigin,j=n._zoomingFactor,k=n._graphsAxisLimits.currentLimits,e=this._canvasSize.height,f=this._canvasSize.width,d.y<0?(g=-1,h=-1):d.y>e?(g=1,h=1):(g=-1,h=1),k.yLower=this._getGraphPointCoordinates([d.x,e])[1],k.yUpper=this._getGraphPointCoordinates([d.x,0])[1],d.x<0?(g=1,h=1):d.x>f?(g=-1,h=-1):(g=-1,h=1),k.xUpper=this._getGraphPointCoordinates([f,d.y])[0],k.xLower=this._getGraphPointCoordinates([0,d.y])[0],l=this.markerBounds,l.max.x=k.xUpper,l.max.y=k.yUpper,l.min.x=k.xLower,l.min.y=k.yLower,o.max.x=k.xUpper,o.max.y=k.yUpper,o.min.x=k.xLower,o.min.y=k.yLower,this._setTextBoxValues()},_setTextBoxValues:function(){var a,b,c,d;c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),a=d._graphLimitTextBoxDomElement,b=d._graphsAxisLimits.currentLimits,null!==a.xLower&&null!==a.xUpper&&null!==a.yLower&&null!==a.yUpper&&(a.xLower.value=b.xLower,a.xUpper.value=b.xUpper,a.yLower.value=b.yLower,a.yUpper.value=b.yUpper)},_graphAxisLimitChangedByUserInput:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=[];b=void 0,p=this._gridGraphModelObject,q=p.get("_graphDisplayValues"),c=q._graphLimitTextBoxDomElement,n=this._canvasSize,o=q._graphOrigin,r=q._graphsAxisLimits,s=r.currentLimits,d=c.xLower.value,e=c.xUpper.value,f=c.yLower.value,g=c.yUpper.value,h=this._checkForNumericValue(d),i=this._checkForNumericValue(e),j=this._checkForNumericValue(f),k=this._checkForNumericValue(g),h===!0&&i===!0&&j===!0&&k===!0?(s.xLower!==parseFloat(d)||s.xUpper!==parseFloat(e)||s.yLower!==parseFloat(f)||s.yUpper!==parseFloat(g))&&(q._graphsAxisLimits.isXLastChangedLimit=a,q._zoomingFactor.zoomFactorForGraphParameterModification=1,q._zoomingFactor.xZoomFactorForGraphParameterModification=1,q._zoomingFactor.yZoomFactorForGraphParameterModification=1,this._axisMarkerMultiplierAdjuster(d,e,f,g),m=o.defaultOrigin,l=o.currentOrigin,q._zoomingFactor.previousZoomAngle=this._angleBetweenTwoPoints(l,m),this._graphTypeSelector(),0!==p.get("_plots").length&&this._shapeRedraw(),0!==p.get("_points").length&&this._repositionPoints(),this._deltaAngle(),o.isOriginPositionChanged=!0,Math.abs(q._graphParameters.distanceBetweenTwoVerticalLines-q._graphParameters.distanceBetweenTwoHorizontalLines)>.1?this._changeStyleOfEqualizeAxisButton(!0):this._changeStyleOfEqualizeAxisButton(!1)):(t=["","-"],-1===t.indexOf(d)&&-1===t.indexOf(e)&&-1===t.indexOf(f)&&-1===t.indexOf(g)&&this._setTextBoxValues())},_axisMarkerMultiplierAdjuster:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;if(y=this._gridGraphModelObject,z=y.get("_graphDisplayValues"),A=y.get("markerBounds"),
a=parseFloat(a),c=parseFloat(c),b=parseFloat(b),d=parseFloat(d),v=this._canvasSize.width/50,w=this._canvasSize.width/40,v<this.MINIMUM_THRESHOLD_LINE_DISTANCE&&(v=this.MINIMUM_THRESHOLD_LINE_DISTANCE,w=this.MINIMUM_THRESHOLD_LINE_DISTANCE+2),f=z._zoomingFactor,t=z._graphsAxisLimits,u=t.currentLimits,x=this.markerBounds,b>a&&d>c){if(u.xLower=a,u.xUpper=b,u.yLower=c,u.yUpper=d,x.max.x=b,x.max.y=d,x.min.x=a,x.min.y=c,A.max.x=b,A.max.y=d,A.min.x=a,A.min.y=c,j=z._graphParameters.graphGridLine,B=z._graphParameters.xGridLine,C=z._graphParameters.yGridLine,k=this._canvasSize.width,l=this._canvasSize.height,t.isXLastChangedLimit===!0||e)if(g=v,h=(v+w)/2,i=w,n=(b-a)*B,o=k/(n/f.xTotalMultiplier),g>o)for(;h>o;)this._xAxisZoomFactorModifier(!0),o=k/(n/f.xTotalMultiplier);else if(o>i)for(;o>g;)this._xAxisZoomFactorModifier(!1),o=k/(n/f.xTotalMultiplier);if(t.isXLastChangedLimit!==!0||e)if(p=v,q=w,r=(v+w)/2,m=(d-c)*C,s=l/(m/f.yTotalMultiplier),p>s)for(;q>s;)this._yAxisZoomFactorModifier(!0),s=l/(m/f.yTotalMultiplier);else if(s>q)for(;s>p;)this._yAxisZoomFactorModifier(!1),s=l/(m/f.yTotalMultiplier);this._distanceBetweenLinesCalculator(),this._originPositionOnGraph()}},_convertNumberTillRequiredDecimalPoint:function(a){return Math.abs(a)>1?a.toFixed(3):a.toFixed(10)},_checkForNumericValue:function(a){var b,c,d,e,f,g;if(b=a.toString(),b.length>0){for(d=!0,e=0,f=0,g=0;g<b.length;g++){if(c=b[g].charCodeAt(),!(c>=48&&57>=c||45===c||46===c)){d=!1;break}if(45===c?e+=1:46===c&&(f+=1),f>1||e>1){d=!1;break}}return 1===b.length&&45===c&&(d=!1),d}},_graphTypeSelector:function(){this._projectLayers.gridLayer.activate();var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isCartesionCurrentGraphType===!0?this._cartesianGraph():this._polarGraph()},getMarkerBounds:function(){return this.markerBounds},_equalizeAxisScales:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;n=this._gridGraphModelObject,o=n.get("_graphDisplayValues"),p=n.get("markerBounds"),q=this.markerBounds,k=this._canvasSize,l=o._graphsAxisLimits,i=o._graphParameters,a=i.graphGridLine,r=i.xGridLine,s=i.yGridLine,b=k.height,c=k.width,d=o._graphOrigin.currentOrigin,m=o._zoomingFactor,j=l.currentLimits,Math.abs(o._graphParameters.distanceBetweenTwoVerticalLines-o._graphParameters.distanceBetweenTwoHorizontalLines)>.1&&(l.isXLastChangedLimit===!0?(i.distanceBetweenTwoHorizontalLines=i.distanceBetweenTwoVerticalLines,i.totalHorizontalLines=b/i.distanceBetweenTwoHorizontalLines,d.y<0?(g=-1,h=-1):d.y>b?(g=1,h=1):(g=-1,h=1),m.yCurrentFactor=m.xCurrentFactor,m.yZoomMultiplier=m.xZoomMultiplier,m.yTotalMultiplier=m.xTotalMultiplier,j.yLower=g*(Math.abs(d.y-b)/i.distanceBetweenTwoHorizontalLines)/s*m.yTotalMultiplier,j.yUpper=h*(Math.abs(d.y-0)/i.distanceBetweenTwoHorizontalLines)/s*m.yTotalMultiplier):(i.distanceBetweenTwoVerticalLines=i.distanceBetweenTwoHorizontalLines,i.totalVerticalLines=c/i.distanceBetweenTwoVerticalLines,d.x<0?(e=1,f=1):d.x>c?(e=-1,f=-1):(e=-1,f=1),m.xCurrentFactor=m.yCurrentFactor,m.xZoomMultiplier=m.yZoomMultiplier,m.xTotalMultiplier=m.yTotalMultiplier,j.xUpper=f*(Math.abs(d.x-c)/i.distanceBetweenTwoVerticalLines/r)*m.xTotalMultiplier,j.xLower=e*(Math.abs(d.x-0)/i.distanceBetweenTwoVerticalLines)/r*m.xTotalMultiplier),this._changeStyleOfEqualizeAxisButton(!1),q.max.x=p.max.x=j.xUpper,q.max.y=p.max.y=j.yUpper,q.min.x=p.min.x=j.xLower,q.min.y=p.min.y=j.yLower,this._originPositionOnGraph(),this._graphTypeSelector(),0!==n.get("_plots").length&&this._shapeRedraw(),0!==n.get("_points").length&&this._repositionPoints(),this._setTextBoxValues())},_cartesionSymbolGenerator:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;s=this._gridGraphModelObject,t=s.get("_graphDisplayValues"),a=this._canvasSize.height,b=this._canvasSize.width,r=t._symbols,t._graphDisplay.isProjectorModeOn===!0?(c=2,d=new this._paperScope.Color(.8,.8,.8),e=new this._paperScope.Color(.4,.4,.4)):(c=1,d=new this._paperScope.Color(.9,.9,.9),e=new this._paperScope.Color(.7,.7,.7)),f=new this._paperScope.Path.Line({from:[0,0],to:[0,a],strokeColor:d,strokeWidth:1}),g=new this._paperScope.Path.Line({from:[0,0],to:[0,a],strokeColor:e,strokeWidth:1}),h=new this._paperScope.Symbol(f),i=new this._paperScope.Symbol(g),f.remove(),g.remove(),r.xInnerGridLines=h,r.xMarkerLines=i,j=new this._paperScope.Path.Line({from:[0,0],to:[b,0],strokeColor:d,strokeWidth:1}),k=new this._paperScope.Path.Line({from:[0,0],to:[b,0],strokeColor:e,strokeWidth:1}),l=new this._paperScope.Symbol(j),m=new this._paperScope.Symbol(k),j.remove(),k.remove(),r.yInnerGridLines=l,r.yMarkerLines=m,n=new this._paperScope.Path.Line({from:[0,0],to:[0,a],strokeColor:0,strokeWidth:c}),o=new this._paperScope.Path.Line({from:[0,0],to:[b,0],strokeColor:0,strokeWidth:c}),p=new this._paperScope.Symbol(n),q=new this._paperScope.Symbol(o),n.remove(),o.remove(),r.xAxis=p,r.yAxis=q},_distanceBetweenLinesCalculator:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;p=this._gridGraphModelObject,q=p.get("_graphDisplayValues"),a=this._canvasSize.height,b=this._canvasSize.width,n=q._graphsAxisLimits.currentLimits,o=q._graphParameters,r=q._zoomingFactor.zoomFactorForGraphParameterModification,s=q._zoomingFactor.xZoomFactorForGraphParameterModification,t=q._zoomingFactor.yZoomFactorForGraphParameterModification,c=n.xLower,d=n.xUpper,e=n.yLower,f=n.yUpper,g=o.graphGridLine,l=o.xGridLine,m=o.yGridLine,h=(d-c)/q._zoomingFactor.xTotalMultiplier*l,i=b/h,j=(f-e)/q._zoomingFactor.yTotalMultiplier*m,k=a/j,o.totalVerticalLines=h,o.distanceBetweenTwoVerticalLines=i,o.totalHorizontalLines=j,o.distanceBetweenTwoHorizontalLines=k},_originPositionOnGraph:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this._paperScope;o=this._canvasSize.height,p=this._canvasSize.width,h=this._gridGraphModelObject,e=h.get("_graphDisplayValues"),i=e._graphsAxisLimits.currentLimits,g=e._graphParameters,j=e._zoomingFactor.zoomFactorForGraphParameterModification,m=e._zoomingFactor.xZoomFactorForGraphParameterModification,n=e._zoomingFactor.yZoomFactorForGraphParameterModification,a=i.xLower,c=i.yUpper,f=g.graphGridLine,k=g.xGridLine,l=g.yGridLine,b=a>=0?0-a:Math.abs(a),d=0>=c?0-Math.abs(c):Math.abs(c),e._graphOrigin.currentOrigin=new q.Point(b/e._zoomingFactor.xTotalMultiplier*k*g.distanceBetweenTwoVerticalLines/m,d/e._zoomingFactor.yTotalMultiplier*l*g.distanceBetweenTwoHorizontalLines/n),this._previousMaxValue=this._getGraphPointCoordinates([p,o/2])[0]},_cartesianGraph:function(){this._paperScope.project.activeLayer.removeChildren();var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;if(A=this._gridGraphModelObject,B=A.get("_graphDisplayValues"),L=A.get("markerBounds"),P=new this._paperScope.Point(0,0),Q=new this._paperScope.Size(this._canvasSize.width,this._canvasSize.height),R=new this._paperScope.Shape.Rectangle(P,Q),R.fillColor=this._backgroundColor,w=this._canvasSize,x=B._graphParameters,z=B._zoomingFactor,y=B._symbols,B._graphDisplay.isGridLineShown===!0){if(a=0,b=w.height,c=w.width,d=x.graphGridLine,K=x.xGridLine,M=x.yGridLine,e=B._graphOrigin.currentOrigin,B._graphDisplay.isXmarkerInRadians===!1)for(f=x.distanceBetweenTwoVerticalLines/z.xZoomFactorForGraphParameterModification,g=x.totalVerticalLines*z.xZoomFactorForGraphParameterModification,e.x>=0?(h=e.x,i=parseInt(h/f,10),j=h-i*f,k=0,l=K-i%K):(m=Math.abs(e.x),n=parseInt(m/f,10),j=f-(m-n*f),k=0,l=n,0!==j&&l++),k=0;g>k;k++,l++)l%K===0?y.xMarkerLines.place(new this._paperScope.Point(j+k*f,b/2)):y.xInnerGridLines.place(new this._paperScope.Point(j+k*f,b/2));else for(H=x.distanceBetweenTwoHorizontalLines*K/(K/(K-2)),O=this._getRadianMarkers(H,!0),C=O.marker,N=C/Math.PI,K=/5/.test(N)?5:4,D=this._getCanvasPointCoordinates([C,0]),E=Math.abs(e.x-D[0]),F=E/K,G=c/F,F<this.MINIMUM_THRESHOLD_LINE_DISTANCE&&(C=O.maxMarker,N=C/Math.PI,K=/5/.test(N)?5:4,D=this._getCanvasPointCoordinates([C,0]),E=Math.abs(e.x-D[0]),F=E/K,G=c/F),f=F,g=G,e.x>=0?(h=e.x,i=parseInt(h/f,10),j=h-i*f,k=0,l=K-i%K):(m=Math.abs(e.x),n=parseInt(m/f,10),j=f-(m-n*f),k=0,l=n,0!==j&&l++),k=0;g>k;k++,l++)l%K===0?y.xMarkerLines.place(new this._paperScope.Point(j+k*f,b/2)):y.xInnerGridLines.place(new this._paperScope.Point(j+k*f,b/2));for(B._graphDisplay.isYmarkerInRadians===!1?(o=x.distanceBetweenTwoHorizontalLines/z.yZoomFactorForGraphParameterModification,p=x.totalHorizontalLines*z.yZoomFactorForGraphParameterModification,e.y>=0?(q=e.y,r=parseInt(q/o,10),s=q-r*o,t=M-r%M):(u=Math.abs(e.y),v=parseInt(u/o,10),s=o-(u-v*o),t=v,0!==s&&t++)):(H=x.distanceBetweenTwoHorizontalLines*M/(M/(M-2)),O=this._getRadianMarkers(H,!0),C=O.marker,N=C/Math.PI,M=/5/.test(N)?5:4,D=this._getCanvasPointCoordinates([0,C]),E=Math.abs(e.y-D[1]),I=E/M,J=b/I,I<this.MINIMUM_THRESHOLD_LINE_DISTANCE&&(C=O.maxMarker,N=C/Math.PI,M=/5/.test(N)?5:4,D=this._getCanvasPointCoordinates([0,C]),E=Math.abs(e.y-D[1]),I=E/M,J=b/I),o=I,p=J,e.y>=0?(q=e.y,r=parseInt(q/o,10),s=q-r*o,t=M-r%M):(u=Math.abs(e.y),v=parseInt(u/o,10),s=o-(u-v*o),t=v,0!==s&&t++)),k=0;p>k;k++,t++)t%M===0?y.yMarkerLines.place(new this._paperScope.Point(c/2,s+k*o)):y.yInnerGridLines.place(new this._paperScope.Point(c/2,s+k*o))}this._axisMarker()},_getMarkerLines:function(a){return a%5===0?5:4},_getRadianMarkers:function(a,b){var c,d,e,f,g,h,i,j,k,l,m;return c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),b===!0?(k=d._zoomingFactor.xTotalMultiplier,l=d._zoomingFactor.xCurrentFactor,m=d._zoomingFactor.xZoomMultiplier):(k=d._zoomingFactor.yTotalMultiplier,l=d._zoomingFactor.yCurrentFactor,m=d._zoomingFactor.yZoomMultiplier),5===k?(f=Math.ceil(k/Math.PI)*Math.PI,g=Math.floor(k/Math.PI)*Math.PI):5===l&&(1>m?(e=Math.log(1/m)/Math.LN10,f=Math.PI/(6*Math.pow(8,e-1)),g=Math.PI/(12*Math.pow(8,e-1))):(f=2*m*Math.PI,g=m*Math.PI)),2===k?(f=Math.PI,g=Math.PI/2):2===l&&(1>m?(e=Math.log(1/m)/Math.LN10,f=Math.PI/(12*Math.pow(8,e-1)),g=Math.PI/(3*Math.pow(8,e))):(f=m*Math.PI,g=5*(m/10)*Math.PI)),1===k?(f=Math.PI/3,g=Math.PI/3):1===l&&(1>m?(e=Math.log(1/m)/Math.LN10,f=Math.PI/(3*Math.pow(8,e)),g=Math.PI/(6*Math.pow(8,e))):(f=5*(m/10)*Math.PI,g=2*(m/10)*Math.PI)),h=this._getCanvasPointCoordinates([0,0]),i=b?this._getCanvasPointCoordinates([f,0]):this._getCanvasPointCoordinates([0,f]),j=Math.sqrt(Math.abs(Math.pow(h[0]-i[0],2)+Math.pow(h[1]-i[1],2))),j/2>=a?{marker:g,minMarker:g,maxMarker:f}:{marker:f,minMarker:g,maxMarker:f}},_graphStartingGridLines:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;return A=this._gridGraphModelObject,B=A.get("_graphDisplayValues"),w=this._canvasSize,x=B._graphParameters,z=B._zoomingFactor,y=B._symbols,a=0,b=w.height,c=w.width,d=x.graphGridLine,F=x.xGridLine,G=x.yGridLine,e=B._graphOrigin.currentOrigin,f=x.distanceBetweenTwoVerticalLines/z.xZoomFactorForGraphParameterModification,g=x.totalVerticalLines*z.xZoomFactorForGraphParameterModification,e.x>=0?(h=e.x,i=parseInt(h/f,10),j=h-i*f,k=0,l=F-i%F,C=parseInt(i/F,10)):(m=Math.abs(e.x),n=parseInt(m/f,10),j=f-(m-n*f),k=0,l=n,C=parseInt(n/F,10),0!==j&&l++),o=x.distanceBetweenTwoHorizontalLines/z.yZoomFactorForGraphParameterModification,p=x.totalHorizontalLines*z.yZoomFactorForGraphParameterModification,e.y>=0?(q=e.y,r=parseInt(q/o,10),s=q-r*o,t=G-r%G,D=parseInt(r/G,10)):(u=Math.abs(e.y),v=parseInt(u/f,10),s=f-(u-v*f),t=v,D=parseInt(v/G,10),0!==s&&t++),E=[j,l,C,s,t,D]},_polarGraph:function(){this._paperScope.project.activeLayer.removeChildren();var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa;if($=this._gridGraphModelObject,X=$.get("_graphDisplayValues"),da=new this._paperScope.Point(0,0),ea=new this._paperScope.Size(this._canvasSize.width,this._canvasSize.height),fa=new this._paperScope.Shape.Rectangle(da,ea),fa.fillColor="white",V=X._graphParameters,Z=X._zoomingFactor,W=this._canvasSize,_=X._graphDisplay.isLabelShown,aa=X._graphDisplay.isGridLineShown,a=V.distanceBetweenTwoVerticalLines/Z.xZoomFactorForGraphParameterModification,b=V.distanceBetweenTwoHorizontalLines/Z.yZoomFactorForGraphParameterModification,c=V.totalVerticalLines,d=W.width,e=W.height,f=V.graphGridLine,ba=V.xGridLine,ca=V.yGridLine,g=X._graphOrigin.currentOrigin,j=0,l=Math.sqrt(Math.pow(g.x-0,2)+Math.pow(g.y-0,2)),m=Math.sqrt(Math.pow(g.x-d,2)+Math.pow(g.y-0,2)),n=Math.sqrt(Math.pow(g.x-d,2)+Math.pow(g.y-e,2)),o=Math.sqrt(Math.pow(g.x-0,2)+Math.pow(g.y-e,2)),j=(k=(k=l>m?l:m)>n?k:n)>o?k:o,p=b>a?a:b,g.y<0?g.x<0?(x=Math.abs(g.y),y=Math.sqrt(Math.pow(g.x-0,2)+Math.pow(g.y-0,2)),w=2*Math.PI-Math.acos(x/y),u=Math.abs(g.x),v=Math.abs(g.y),i=y):g.x>d?(x=Math.abs(g.y),y=Math.sqrt(Math.pow(g.x-d,2)+Math.pow(g.y-0,2)),w=1.5*Math.PI-Math.acos(x/y),u=Math.abs(g.x)-d,v=Math.abs(g.y),i=y):(w=Math.PI/2,v=Math.abs(g.y),u=a/b*v,i=Math.abs(g.y)):g.y>e?g.x<0?(x=Math.abs(g.x),y=Math.sqrt(Math.pow(g.x-0,2)+Math.pow(g.y-e,2)),w=Math.acos(x/y),u=Math.abs(g.x),v=Math.abs(g.y)-e,i=y):g.x>d?(x=Math.abs(g.x)-d,y=Math.sqrt(Math.pow(g.x-d,2)+Math.pow(g.y-e,2)),w=Math.PI-Math.acos(x/y),u=Math.abs(g.x)-d,v=Math.abs(g.y)-e,i=y):(w=Math.PI/2,v=Math.abs(g.y)-e,u=a/b*v,i=Math.abs(g.y)-e):g.x<0?(w=0,u=Math.abs(g.x),v=u*b/a,i=Math.abs(g.x)):g.x>d?(w=0,u=Math.abs(g.x)-d,v=u*b/a,i=Math.abs(g.x)-d):(i=0,q=0,w=0,u=0,v=0),r=new this._paperScope.Point(g.x+u*Math.cos(w),g.y+v*Math.sin(w)),s=new this._paperScope.Point(g.x+(u+a)*Math.cos(w),g.y+(v+b)*Math.sin(w)),t=Math.sqrt(Math.pow(r.x-s.x,2)+Math.pow(r.y-s.y,2)),q=parseInt(i/t,10),i=q*t,u=a*q,v=b*q,z=i,A=u,B=v,X.isProjectorModeOn===!0?(C=new this._paperScope.Color(.8,.8,.8),D=new this._paperScope.Color(.4,.4,.4)):(C=new this._paperScope.Color(.9,.9,.9),D=new this._paperScope.Color(.7,.7,.7)),aa===!0)for(;j>=i;i+=p,u+=a,v+=b)h=q%ba===0?new this._paperScope.Path.Ellipse({point:[g.x-u,g.y-v],size:[2*u,2*v],strokeColor:D}):new this._paperScope.Path.Ellipse({point:[g.x-u,g.y-v],size:[2*u,2*v],strokeColor:C}),q++;for(X._graphDisplay.isProjectorModeOn===!0?(E=new this._paperScope.Color(.8,.8,.8),F=16,G=new this._paperScope.Color(.6,.6,.6)):(E=new this._paperScope.Color(.9,.9,.9),F=14,G=new this._paperScope.Color(.7,.7,.7)),Y=this._polarLineAngleMarker,H=X._graphDisplay.isPolarAngleInRadian===!0?Y.radian:Y.degree,I=0,g.x<d&&g.x>0&&g.y<e&&g.y>0?(J=3,K=3,L=2,M=6,g.x<=b*f*2||d-g.x<=b*f*2?(N=B+a*f*5-a,O=A+b*f*5-b):(N=B+a*f*3-a,O=A+b*f*3-b)):(J=4,K=1,L=1,M=3,N=B+a*f*6,O=A+b*f*6),U=0;360>U;U+=5)P=g.x+j*Math.cos(U*Math.PI/180),Q=g.y+j*Math.sin(U*Math.PI/180),U%K===0&&(aa===!0&&(h=new this._paperScope.Path.Line({from:g,to:[P,Q],strokeColor:E})),_===!0&&U%M===0&&(w=U*Math.PI/180,R=g.x+N*Math.cos(w),S=g.y+O*Math.sin(w),T=new this._paperScope.PointText({point:[R,S],content:H[I],fontSize:F,fillColor:G}),I+=L));this._axisMarker()},_polarAngleLinesMarkerArrayGenerator:function(){var a,b,c,d,e,f,g,h,i,j;for(a=[0,345,330,315,300,285,270,255,240,225,210,195,180,165,150,135,120,105,90,75,60,45,30,15],this._polarLineAngleMarker.degree=a,d=this.PI,e=[0],b=1,c=23;c>0;c--){for(f=12>c?c:12,h=12,i=c,g=1,j=f;j>=2;j--)for(;h%j===0&&i%j===0;)h/=j,i/=j;1===i&&1===h?e[b]=d:1===i?e[b]=d+"/"+h:1===h?e[b]=i+d:e[b]=i+d+"/"+h,b++}this._polarLineAngleMarker.radian=e},_axisMarker:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca;if(L=this._gridGraphModelObject,K=L.get("_graphDisplayValues"),H=this._canvasSize,I=K._graphParameters,J=K._symbols,b=H.height,c=H.width,d=K._graphOrigin.currentOrigin,z=K._zoomingFactor,Q=z.xZoomMultiplier,R=z.yZoomMultiplier,e=z.xTotalMultiplier,f=z.yTotalMultiplier,g=I.graphGridLine,_=I.xGridLine,aa=I.yGridLine,h="#000000",i="grey",j=h,P=K._graphDisplay.isCartesionCurrentGraphType,O=K._graphDisplay.isProjectorModeOn,K._graphDisplay.isAxisLinesShown===!0&&(J.xAxis.place(new this._paperScope.Point(d.x,b/2)),J.yAxis.place(new this._paperScope.Point(c/2,d.y))),k=K._graphDisplay.isProjectorModeOn===!0?16:12,K._graphDisplay.isLabelShown===!0){if(K._graphDisplay.isXmarkerInRadians===!1||P===!1)for(m=I.distanceBetweenTwoVerticalLines/z.xZoomFactorForGraphParameterModification,n=I.totalVerticalLines*z.xZoomFactorForGraphParameterModification,d.x>=0?(q=d.x,r=parseInt(q/m,10),s=q-r*m,t=_-r%_,u=parseInt(r/_,10)):(A=Math.abs(d.x),B=parseInt(A/m,10),s=m-(A-B*m),t=B,u=parseInt(B/_,10),0!==s&&(t++,u++)),C=e,d.x>=0&&K._graphDisplay.isCartesionCurrentGraphType===!0&&(C=-e),l=0;n>=l;l++)t%_===0&&(v=this._getPowerOfNumber(u*C,Q),M=parseFloat(v[0].toFixed(4)),N=v[1],0===N?(w=M.toString().length,$=0):(w=M.toString().length+N.toString().length+"x10".length,$=1),x=0===M?s+l*m-w*k/2-2:s+l*m-w*k/4,P===!1&&0>M&&(M=-M),0!==M&&(0>=x?x=0:c-x>0&&w*k/2>c-x&&(x=c-w*(2*k/3))),y=d.y+k,P===!0&&(d.y<0?(y=0+k,j=i):d.y>b-k&&(y=b-$*k-a.Common.Components.Views.MathUtilitiesGraph.GridGraph.AXIS_LABEL_BOTTOM_PADDING,j=i)),(d.y<0||d.y>b-k)&&0===M||this._displayToPower10(M,N,x,y,j,k,O),d.x<0?u++:u--),t++;else for(X=I.distanceBetweenTwoHorizontalLines*_/(_/(_-2)),ca=this._getRadianMarkers(X,!0),S=ca.marker,ba=S/Math.PI,_=/5/.test(ba)?5:4,T=this._getCanvasPointCoordinates([S,0]),U=Math.abs(d.x-T[0]),V=U/_,W=c/V,V<this.MINIMUM_THRESHOLD_LINE_DISTANCE&&(S=ca.maxMarker,ba=S/Math.PI,_=/5/.test(ba)?5:4,T=this._getCanvasPointCoordinates([S,0]),U=Math.abs(d.x-T[0]),V=U/_,W=c/V),m=V,n=W,d.x>=0?(q=d.x,r=parseInt(q/m,10),s=q-r*m,l=0,t=_-r%_,u=S/Math.PI*parseInt(r/_,10)):(A=Math.abs(d.x),B=parseInt(A/m,10),s=m-(A-B*m),l=0,t=B,u=S/Math.PI*parseInt(B/_,10),0!==s&&(t++,u+=S/Math.PI)),C=1,d.x>=0&&K._graphDisplay.isCartesionCurrentGraphType===!0&&(C=-1),l=0;n>=l;l++)t%_===0&&(v=this._getProperFormedRadianMarkerText(u*C,Q),M=v[0],N=v[1],0===N?(w=M.toString().length,$=0):(w=M.toString().length+N.toString().length+"x10".length,$=1),0===M?(x=s+l*m-w*k/2-2,M=0):x=s+l*m-w*k/4,0!==M&&(0>=x?x=0:c-x>0&&w*k/2>c-x&&(x=0===N?c-w*(2*k/3):c-w*(1*k/2))),y=d.y+k,P===!0&&(d.y<0?(y=0+k,j=i):d.y>b-k&&(y=b-$*k,j=i)),(d.y<0||d.y>b-k)&&0===M||this._displayToPower10(M,N,x,y,j,k,O),d.x<0?u+=S/Math.PI:u-=S/Math.PI),t++;if(K._graphDisplay.isYmarkerInRadians===!1||P===!1)for(o=I.distanceBetweenTwoHorizontalLines/z.yZoomFactorForGraphParameterModification,p=I.totalHorizontalLines*z.yZoomFactorForGraphParameterModification,d.y>=0?(D=d.y,E=parseInt(D/o,10),s=D-E*o,t=aa-E%aa,u=parseInt(E/aa,10)):(F=Math.abs(d.y),G=parseInt(F/o,10),s=o-(F-G*o),t=G,u=parseInt(G/aa,10),0!==s&&(t++,u++)),d.y<0&&K._graphDisplay.isCartesionCurrentGraphType===!0&&(f=-f),j=h,l=0;p>=l;l++)t%aa===0&&(v=this._getPowerOfNumber(u*f,R),M=parseFloat(v[0].toFixed(4)),N=v[1],w=0===N?M.toString().length:M.toString().length+N.toString().length+"x10".length,y=s+l*o+1*k/4,P===!1&&0>M&&(M=-M),k>=y?y=k:y>=b-k&&b+3*k/2>y&&(y=b-k/4),x=d.x-w*k/2-k/4,P===!0&&(d.x<w*k/2?(x=a.Common.Components.Views.MathUtilitiesGraph.GridGraph.AXIS_LABEL_RIGHT_PADDING,j=i):d.x>c&&(x=c-w*k/2-a.Common.Components.Views.MathUtilitiesGraph.GridGraph.AXIS_LABEL_RIGHT_PADDING,j=i)),0!==M&&this._displayToPower10(M,N,x,y,j,k,O),d.y<0?u++:u--),t++;else for(X=I.distanceBetweenTwoHorizontalLines*aa/(aa/(aa-2)),ca=this._getRadianMarkers(X,!0),S=ca.marker,ba=S/Math.PI,aa=/5/.test(ba)?5:4,T=this._getCanvasPointCoordinates([0,S]),U=Math.abs(d.y-T[1]),Y=U/aa,Z=b/Y,Y<this.MINIMUM_THRESHOLD_LINE_DISTANCE&&(S=ca.maxMarker,ba=S/Math.PI,aa=/5/.test(ba)?5:4,T=this._getCanvasPointCoordinates([0,S]),U=Math.abs(d.y-T[1]),Y=U/aa,Z=b/Y),o=Y,p=Z,d.y>=0?(D=d.y,E=parseInt(D/o,10),s=D-E*o,t=aa-E%aa,u=S/Math.PI*parseInt(E/aa,10)):(F=Math.abs(d.y),G=parseInt(F/o,10),s=o-(F-G*o),t=G,u=S/Math.PI*parseInt(G/aa,10),0!==s&&(t++,u+=S/Math.PI)),f=1,d.y<0&&K._graphDisplay.isCartesionCurrentGraphType===!0&&(f=-1),j=h,l=0;p>=l;l++)t%aa===0&&(v=this._getProperFormedRadianMarkerText(u*f,R),M=v[0],N=v[1],w=0===N?M.toString().length:M.toString().length+N.toString().length+"x10".length,y=s+l*o+1*k/4,k>=y?y=k:y>=b-k&&b+3*k/2>y&&(y=b-k/4),x=d.x-w*k/2-k/4,P===!0&&(d.x<w*k/2?(x=0,j=i):d.x>c&&(x=c-w*k/2,j=i)),0!==M&&this._displayToPower10(M,N,x,y,j,k,O),d.y<0?u+=S/Math.PI:u-=S/Math.PI),t++}this.refreshView()},_getProperFormedRadianMarkerText:function(a,b){var c,d=Math.PI,e=this.PI;return b>1e4?(a*=d,c=this._getPowerOfNumber(a,b),c[0]=parseFloat(c[0].toFixed(4)),c):Math.abs(a)*d<d/24?(a*=d,c=this._getPowerOfNumber(a,b),c[0]=parseFloat(c[0].toFixed(4)),c):(c=this._getFractionalFormNumber(a),a=1===Math.abs(c[0])&&1===c[1]?1===c[0]?e:"-"+e:1===Math.abs(c[0])?1===c[0]?e+"/"+c[1]:"-"+e+"/"+c[1]:1===c[1]?c[0]+e:c[0]+e+"/"+c[1],[a,0])},_getFractionalFormNumber:function(a){var b,c,d,e,f;if(a=parseFloat(a.toFixed(2)),-1===a.toString().indexOf("."))return[a,1];for(b=a,c=.01,d=1,e=1,f=d/e;Math.abs(f-b)>c;)b>f?d++:(e++,d=parseInt(Math.round(b*e),10)),f=d/e;return[d,e]},_getPowerOfNumber:function(a,b){a=parseFloat(a);var c,d,e,f=0;if(0>a){if(c=Math.abs(a),1e-4>b)for(;1>c;)c=10*c,f-=1;else if(b>1e4)for(;c/10>=1;)c/=10,f+=1;a=-c}else if(1e-4>b&&0!==a)for(;1>a;)a=10*a,f-=1;else if(b>1e4)for(;a/10>=1;)a/=10,f+=1;return d=a,e=[],e.push(d),e.push(f),e},_displayToPower10:function(a,b,c,d,e,f,g){var h,i,j;return j=this.PI,0===b?g===!0?(h=new this._paperScope.PointText({point:[c,d],justification:"left",fontSize:f,content:a,strokeColor:e,strokeWidth:.3}),i=new this._paperScope.PointText):(h=new this._paperScope.PointText({point:[c,d],justification:"left",fontSize:f,content:a,fillColor:e,strokeColor:e,strokeWidth:.4}),i=new this._paperScope.PointText):g===!0?(h=new this._paperScope.PointText({point:[c,d+f/2],justification:"left",fontSize:f,content:a+"x10",strokeColor:e,strokeWidth:.3}),i=new this._paperScope.PointText({point:[c+h.bounds.width,d],justification:"left",fontSize:3*f/4,content:b,strokeColor:e,strokeWidth:.3})):(h=new this._paperScope.PointText({point:[c,d+f/2],justification:"left",fontSize:f,content:a+"x10",fillColor:e,strokeColor:e,strokeWidth:.4}),i=new this._paperScope.PointText({point:[c+h.bounds.width,d],justification:"left",fontSize:3*f/4,content:b,fillColor:e,strokeColor:e,strokeWidth:.4})),[h,i]},_getCanvasPointCoordinates:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;return l=this._gridGraphModelObject,m=l.get("_graphDisplayValues"),d=m._graphOrigin.currentOrigin,f=m._graphParameters.distanceBetweenTwoVerticalLines,e=m._graphParameters.distanceBetweenTwoHorizontalLines,g=m._graphParameters.graphGridLine,n=m._graphParameters.xGridLine,o=m._graphParameters.yGridLine,k=m._zoomingFactor,i=k.xTotalMultiplier,j=k.yTotalMultiplier,b=[],c=d.x+a[0]*n*(f/k.xZoomFactorForGraphParameterModification)/i,b.push(c),h=d.y-a[1]*o*(e/k.yZoomFactorForGraphParameterModification)/j,b.push(h),b},_getGraphPointCoordinates:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;return l=this._gridGraphModelObject,m=l.get("_graphDisplayValues"),b=m._graphOrigin.currentOrigin,d=m._graphParameters.distanceBetweenTwoVerticalLines,c=m._graphParameters.distanceBetweenTwoHorizontalLines,e=m._graphParameters.graphGridLine,n=m._graphParameters.xGridLine,o=m._graphParameters.yGridLine,f=m._zoomingFactor,g=f.xTotalMultiplier,h=f.yTotalMultiplier,i=[],j=-((b.x-a[0])/(d/f.xZoomFactorForGraphParameterModification)/n)*g,k=(b.y-a[1])/(c/f.yZoomFactorForGraphParameterModification)/o*h,i.push(j),i.push(k),i},_deltaAngle:function(){var a,b,c,d,e,f,g,h,i,j;h=this._gridGraphModelObject,i=h.get("_graphDisplayValues"),j=h.get("markerBounds"),a=i._graphOrigin.currentOrigin,c=this._canvasSize.height,b=this._canvasSize.width,a.y<0?a.x<0?(d=new this._paperScope.Point(0,c),f=this._angleBetweenTwoPoints(a,d),e=new this._paperScope.Point(b,0),g=this._angleBetweenTwoPoints(a,e)):a.x>b?(d=new this._paperScope.Point(0,0),f=this._angleBetweenTwoPoints(a,d),e=new this._paperScope.Point(b,c),g=this._angleBetweenTwoPoints(a,e)):(d=new this._paperScope.Point(0,0),f=this._angleBetweenTwoPoints(a,d),e=new this._paperScope.Point(b,0),g=this._angleBetweenTwoPoints(a,e)):a.y>c?a.x<0?(d=new this._paperScope.Point(b,c),f=this._angleBetweenTwoPoints(a,d),e=new this._paperScope.Point(0,0),g=this._angleBetweenTwoPoints(a,e)):a.x>b?(d=new this._paperScope.Point(b,0),f=this._angleBetweenTwoPoints(a,d),e=new this._paperScope.Point(0,c),g=this._angleBetweenTwoPoints(a,e)):(d=new this._paperScope.Point(b,c),f=this._angleBetweenTwoPoints(a,d),e=new this._paperScope.Point(0,c),g=this._angleBetweenTwoPoints(a,e)):a.x<0?(d=new this._paperScope.Point(b,0),f=this._angleBetweenTwoPoints(a,d),e=new this._paperScope.Point(b,c),g=this._angleBetweenTwoPoints(a,e)):a.x>b?(d=new this._paperScope.Point(b,0),f=this._angleBetweenTwoPoints(a,d),e=new this._paperScope.Point(b,c),g=this._angleBetweenTwoPoints(a,e)):(d=new this._paperScope.Point(b,0),f=this._angleBetweenTwoPoints(a,d),e=new this._paperScope.Point(b,c),g=this._angleBetweenTwoPoints(a,e)),this.markerBounds.max["\\theta"]=g,this.markerBounds.min["\\theta"]=f,j.max["\\theta"]=g,j.min["\\theta"]=f},repositionImage:function(a){var b=this._getCanvasPointCoordinates(a.points[0]);a.raster.position={x:b[0],y:b[1]},this._paperScope.view.draw()},_shapeRedraw:function(){this._projectLayers.shapeLayer.activate(),null!==this._paperScope.project.activeLayer.children&&this._paperScope.project.activeLayer.removeChildren(),this.trigger("graph:zoom-pan"),this._projectLayers.gridLayer.activate()},_delta:null,_previousMaxValue:null,_shapeZoom:function(){var a,b,c,d,e,f,g,h,i,j;for(this.activateScope(),c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),e=d._graphOrigin.currentOrigin,g=this._canvasSize.height,f=this._canvasSize.width,a=this._getGraphPointCoordinates([f,g/2])[0],b=this._previousMaxValue/a,this._projectLayers.shapeLayer.activate(),i=this._paperScope.project.activeLayer.children,j=i.length,h=0;j>h;h++)i[h].bounds.x-=this._delta.x,i[h].bounds.y-=this._delta.y,i[h].scale(b,e);this._previousMaxValue=a,this.refreshView()},_layerDrag:function(a,b){a.activate();var c=this._paperScope.project.activeLayer.children,d=c.length;0!==d&&(a.bounds.x+=b.x,a.bounds.y+=b.y)},drawPoint:function(a){this._projectLayers.pointLayer.activate();var b,c,d,e,f,g,h,b=this._gridGraphModelObject;void 0===a.color?(d="#000000",a.color=d):d=a.color,void 0===a.thickness?(e=3,a.thickness=3*e):e=3*a.thickness,void 0===a.opacity?(f=1,a.opacity=f):f=a.opacity,void 0===a.dashArray?a.dashArray=[]:g=a.dashArray,void 0===a.visible?(h=!0,a.visible=h):h="object"==typeof a.visible?a.visible.point:a.visible,c=new this._paperScope.Group,-1===b.get("_points").indexOf(a)&&b.get("_points").push(a),this._drawPoints(a),this.refreshView(),this._projectLayers.gridLayer.activate()},_drawPoints:function(a){this.activateScope();var b,c,d,e,f,g,h,i,j,k,l,m;for(d=a.color,e=3*a.thickness,f=a.opacity,g=a.dashArray,h=a.visible,c=new this._paperScope.Group,k=this,l=function(){var b,c=k._getGraphPointCoordinates([this.bounds.center.x,this.bounds.center.y]);c[0]=k._getNumberForToolTip(c[0]),c[1]=k._getNumberForToolTip(c[1]),b=$('.coordinate-tooltip[data-point="'+c[0]+"-"+c[1]+'"]'),0===b.length?k.showToolTipForPoint(this.bounds.center,[c[0],0],[c[1],0],!1,a):b.remove()},m=function(){var a,b=k._getGraphPointCoordinates([this.bounds.center.x,this.bounds.center.y]);b[0]=k._getNumberForToolTip(b[0]),b[1]=k._getNumberForToolTip(b[1]),a=$('.coordinate-tooltip[data-point="'+b[0]+"-"+b[1]+'"]'),a.remove()},i=0;i<a.points.length;i++)b=this._getCanvasPointCoordinates(a.points[i]),a.drawStyle&&a.drawStyle.draggable&&(j=this._getPointShapePath(a.pointShape,b,a.drawStyle.dragHitThickness/2,a.drawStyle.dragHitColor),j.hit=!0,j.fillColor.alpha=a.drawStyle.dragHitAlpha,j.equation=a,c.addChild(j)),j=this._getPointShapePath(a.pointShape,b,e/2),j.equation=a,this.isTooltipForPoint&&(j.tooltipPoint=a.points[i],j.onMouseEnter=l,j.onMouseLeave=m),c.addChild(j),0===a.dashArray.length?j.fillColor=d:(j.fillColor="#ffffff",j.strokeColor=d),j.visible=h,k=this,this.repositionPointsToolTip(b);void 0!==a.pointsGroup&&(this._removePathRollOverListeners(a.pointsGroup),a.pointsGroup.remove()),a.pointsGroup=c,this._setPathRollOverListeners(c),this.refreshView()},_getPointShapePath:function(a,b,c,d){var e;switch(d||(d="#000000"),a){case"triangle":e=new this._paperScope.Path.RegularPolygon(b,3,c);break;case"square":e=new this._paperScope.Path.RegularPolygon(b,4,c);break;default:e=new this._paperScope.Path.Circle({center:b,radius:c})}return e.fillColor=d,e},_repositionPoints:function(){this._projectLayers.pointLayer.activate();var a,b,c,d,e,f,g,h,i;for(a=this._gridGraphModelObject.get("_points"),b=a.length,c=0;b>c;c++){for(h=a[c],g=h.points,e=g.length,d=0;e>d;d++)f=this._getCanvasPointCoordinates(g[d]),i=h.pointsGroup.children[d],i.position=new this._paperScope.Point(f),i.hit===!0&&(i=h.pointsGroup.children[d+1],i.position=new this._paperScope.Point(f)),this.repositionPointsToolTip(this._getGraphPointCoordinates(f));null!==h.labelData.labelObject&&this._updateLabelPosition(h)}this.refreshView()},_getNumberForToolTip:function(a){if(0===parseInt(a))return 0;if(a){var b,c,d,e,f=a.toString(),g=3;return-1===f.indexOf(".")?f:(f=Number(f).toFixed(g),b=f.split("."),d=/([0-9]*[1-9])([0]+)/g,b[1]=b[1].replace(d,function(a,b,c){return c=void 0,b}),e=Number(b[1]),0===e?Number(b[0]):(c=b[1].length,3>c&&(g=c),Number(f).toFixed(g)))}},removePoint:function(a){if(void 0!==a){this._projectLayers.pointLayer.activate();var b=this._gridGraphModelObject.get("_points").indexOf(a);-1!==b&&this._gridGraphModelObject.get("_points").splice(b,1),this._redrawPoints(),a.pointsGroup&&(this._removePathRollOverListeners(a.pointsGroup),a.pointsGroup.remove()),this.$(".coordinate-tooltip[data-equation-cid="+a.cid+"]").remove(),this.refreshView(),this._projectLayers.gridLayer.activate()}},removeRaster:function(a){"undefined"!=typeof a&&(this._projectLayers.imageLayer.activate(),a.raster&&a.raster.remove(),this.refreshView())},_redrawPoints:function(){this._projectLayers.pointLayer.activate(),null!==this._paperScope.project.activeLayer.children&&this._paperScope.project.activeLayer.removeChildren();var a,b,c,d,e,f=this._gridGraphModelObject.get("_points");for(b=this,d=function(){var a,d=b._getGraphPointCoordinates([this.bounds.center.x,this.bounds.center.y]);d[0]=b._getNumberForToolTip(d[0]),d[1]=b._getNumberForToolTip(d[1]),a=$('.coordinate-tooltip[data-point="'+d[0]+"-"+d[1]+'"]'),0===a.length?b.showToolTipForPoint(this.bounds.center,[d[0],0],[d[1],0],!1,c):a.remove()},e=function(){var a,c=b._getGraphPointCoordinates([this.bounds.center.x,this.bounds.center.y]);c[0]=b._getNumberForToolTip(c[0]),n,a=$('.coordinate-tooltip[data-point="'+c[0]+"-"+c[1]+'"]'),a.remove()},a=0;a<f.length;a++)this._drawPoints(f[a]);this.refreshView(),this._projectLayers.gridLayer.activate()},repositionPointsToolTip:function(a){var b,c,d,e,f,g,h,i,j,k=this.$("#"+this.ID.canvasId);a[0]=this._getNumberForToolTip(a[0]),a[1]=this._getNumberForToolTip(a[1]),b=$($('.coordinate-tooltip[data-point="'+a[0]+"-"+a[1]+'"]')[0]),0!==b.length&&(c=this._getCanvasPointCoordinates(a),h=k.height(),i=k.width(),j=k.position(),f=b.height(),g=b.width(),d=j.left+c[0],e=j.top+c[1]-2*f,c[1]-f<0||c[1]-f>h||c[0]<0||c[0]+2*g>=i?b.hide():b.show(),$(b[0]).css({top:e+"px",left:d+"px"}))},_changePlotColor:function(){var a=this.pathGroup;a.strokeColor=this.changed.color,this.refreshView()},addLabel:function(a){var b,c=!1,d=this;switch(this._projectLayers.labelLayer.activate(),a.type){case"point":null===a.labelData.labelObject?(a.labelData.labelObject=new this._paperScope.PointText,this._updateLabelPosition(a),a.labelData.labelObject.visible=!0,c=!0):(this._updateLabelPosition(a),c=!0),a.isSaveRestoreData===!0&&(this._updateLabelPosition(a),c=!0);break;case"polygon":null===a.labelData.labelObject?(a.labelData.labelObject=new this._paperScope.PointText,a.pathGroup&&void 0!==a.pathGroup.children[0]&&(this._updateLabelPosition(a),a.labelData.labelObject.visible=!0,c=!0)):(this._updateLabelPosition(a),c=!0),a.isSaveRestoreData===!0&&(this._updateLabelPosition(a),c=!0);break;case"plot":null===a.labelData.labelObject?(a.labelData.labelObject=new this._paperScope.PointText,a.pathGroup&&(void 0!==a.pathGroup.children[0]&&(this._updateLabelPosition(a),c=!0),a.labelData.labelObject.visible=!0)):void 0!==a.pathGroup.children[0]&&(this._updateLabelPosition(a),c=!0),a.isSaveRestoreData===!0&&(this._updateLabelPosition(a),
c=!0);break;case"drawAnnotation":return void(c=!1)}c===!0&&(b=a.labelData.labelObject,b.fillColor="red",b.fontWeight="bold",b.fontSize=20,b.fontFamily="Montserrat",b.content=a.labelData.text),this.refreshView(),a.on("post-drag",function(a){d._updateLabelPosition(a)}),a.on("post-relocate",function(a){d._updateLabelPosition(a)}),a.on("teleported",function(a){d._updateLabelPosition(a)})},_updateLabelPosition:function(a){var b,c,d,e,f,g;switch(a.type){case"point":a.labelData.labelObject.position.x=a.pointsGroup.firstChild.position.x+15,a.labelData.labelObject.position.y=a.pointsGroup.firstChild.position.y-15;break;case"polygon":case"plot":if(!a.pathGroup)return;a.pathGroup.children[0]&&(b=a.pathGroup.children[0],c=b.length/2,d=b.getPointAt(c),e=b.getNormalAt(c),e.length=20,f=new this._paperScope.Path,f.add(d),f.add([d.x+e.x,d.y+e.y]),g=f.getPointAt(e.length/2),a.labelData.labelObject.position.x=g.x,a.labelData.labelObject.position.y=g.y);break;case"drawAnnotation":break;case"measurement":}},setBannerPosition:function(a){var b,c,d,e,f,g=a.model.equation.bannerData.bannerObject;this._projectLayers.bannerLayer.activate(),this._paperScope.project.activeLayer.addChild(g),b=MathUtilities.Tools.Dgt.Models.DgtMeasurement.previousMeasurement,null!==b?(c=b.equation.bannerData.bannerObject.children[2],d=c.bounds.y,e=c.bounds.x,f=c.bounds.height):(d=50,e=10,f=0),g.children[2].bounds.y=d+f+10,g.children[2].bounds.x=e,this._projectLayers.pointLayer.activate()},showToolTipForPoint:function(b,c,d,e,f){var g,h,i,j,k,l=this.$("#"+this.ID.canvasId),m=l.position(),n="";f&&(h=f.cid,i=f.color),g=$("<div></div>").css({position:"absolute",top:m.top+b.y+"px",left:m.left+b.x+"px","border-color":i}).attr("class","coordinate-tooltip"),j=a.Common.Utilities.Models.Utils.convertIntoScientificNotaion({number:c[0],numberOfDigits:5}).number,k=a.Common.Utilities.Models.Utils.convertIntoScientificNotaion({number:d[0],numberOfDigits:5}).number,f.titleLabel&&(n+=f.titleLabel+"<br/>"),f.xToolTipLabel&&f.yToolTipLabel?(n+=f.xToolTipLabel+":&nbsp",n+=j,0!==c[1]&&(n+=" × "+c[1]),n+="<br>",n+=f.yToolTipLabel+":&nbsp;",n+=k,0!==d[1]&&(n+=" × "+d[1])):(n=j,0!==c[1]&&(n+=" × "+c[1]),n+=",&nbsp;"+k,0!==d[1]&&(n+=" × "+d[1])),g.html(n),e?(this.$(".drag-tooltip").remove(),g.addClass("drag-tooltip")):(g.attr("data-point",c[0]+"-"+d[0]),g.attr("data-equation-cid",h));var o,p,q=g.css("top"),r=g.css("left");this.$el.parents(".de-mathematics-interactive .player").append(g),g.css({top:0,left:0}),o=g.width()+20+2,p=g.height()+6+2,g.css({top:q,left:r}),this.$el.find(".coordinate-tooltip").remove(),this.$el.append(g),g.css("top",g.position().top-(p+15)),g.position().left+o>this.$el.width()&&g.css("left",g.position().left-o),g.position().top<m.top&&g.css("top",g.position().top+(p+15+15))},addPoints:function(a){this._projectLayers.shapeLayer.activate(),void 0!==a.pathGroup&&(a.pathGroup.remove(),this._removePathRollOverListeners(a.pathGroup)),-1===this._gridGraphModelObject.get("_plots").indexOf(a)&&this._gridGraphModelObject.get("_plots").push(a),Backbone.listenTo(a,"change:color",$.proxy(this._changePlotColor,a));var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;for(u=a.points,v=a.color,w=a.thickness,b=null,c=null,d=null,f=null,x=new this._paperScope.Group,g=new this._paperScope.Path,g.equation=a,g.strokeColor=v,g.strokeWidth=w,x.addChild(g),i=new this._paperScope.Point(0,0),j=new this._paperScope.Point(0,0),k=[],m=!1,s=[],t=[],y=1,z="color: #000",A="background: #0c0; color: #fff",C=0;C<u.length;C++)if(e=u[C],null===f||f[0]!==e[0]||f[1]!==e[1]){for(q=!1,l=0;4>l&&(m=void 0===k[l],0===l?(n="",m&&(k[l]=[]),k[l].push(e)):(m&&(k[l]=[]),p=k[l-1],k[l].push(this._getPointDiff(p))),o=k[l],n+="%c "+o[o.length-1][0].toFixed(5)+","+o[o.length-1][1].toFixed(5)+"%c>>",t[l]=l>=2&&(Math.abs(o[o.length-1][0])>y||Math.abs(o[o.length-1][1])>y)?A:z,2===l&&(r=o[o.length-1],(Math.abs(r[0])>y||Math.abs(r[1])>y)&&(B=this._getCanvasPointCoordinates(e))),!m);l++);q&&(h=new this._paperScope.Path,h.strokeColor=v,h.equation=a,h.strokeWidth=w,g=h,x.addChild(g)),e=this._getCanvasPointCoordinates(e),g.add(e),this._plottingPoints(x,c,b,e),c=b,b=e,f=e}x.strokeColor=v,this.refreshView(),a.pathGroup=x,D=this,a.set({color:"black"})},_traceMouseDownHandle:function(a,b){if(this.isTooltipForPoint&&this.disableLineTooltip!==!0){b.bringToFront();var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(q=15,e=this._gridGraphModelObject,g=[],h=this._canvasSize.height,i=this._canvasSize.width,d=this._getGraphPointCoordinates([a.point.x,a.point.y]),k=this._getPowerOfNumber(d[0],this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.xTotalMultiplier),k[0]=parseFloat(k[0].toFixed(4)),0!==k[1]?(m=k[0].toString().length+k[1].toString().length+"x10".length,n=2):(m=k[0].toString().length,n=1),l=this._getPowerOfNumber(d[1],this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.yTotalMultiplier),l[0]=parseFloat(l[0].toFixed(4)),0!==l[1]?(o=l[0].toString().length+l[1].toString().length+"x10".length,p=2):(o=l[0].toString().length,p=1),f=new this._paperScope.Path([a.point.x,0],[a.point.x,h]),b.children)for(j=0;j<b.children.length;j++)g=g.concat(f.getIntersections(b.children[j]));else g=b.getIntersections(e.get("path"));if(g.length<1){if(f=new this._paperScope.Path([0,a.point.y],[i,a.point.y]),b.children)for(j=0;j<b.children.length;j++)g=g.concat(f.getIntersections(b.children[j]));else g=b.getIntersections(e.get("path"));g.length<1&&(f=new this._paperScope.Path)}c=new this._paperScope.Path.Circle(g[0].point,3),c.fillColor=b.strokeColor,this.disableLineTooltip!==!0&&this.showToolTipForPoint(g[0].point,k,l,!0,b.children[0].equation),e.set("circleDrag",c),e.set("path",f),this.refreshView()}},_traceMouseDragHandle:function(a,b){if(this.isTooltipForPoint&&this.disableLineTooltip!==!0){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=[],q=this._gridGraphModelObject;if(q.get("circleDrag").visible=!0,0===q.get("path").firstSegment.point.y?q.get("path").position.x=a.point.x:q.get("path").position.y=a.point.y,b.children)for(e=0;e<b.children.length;e++)p=p.concat(b.children[e].getIntersections(q.get("path")));else p=b.getIntersections(q.get("path"));if(p.length<1)return q.get("circleDrag").visible=!1,void this.$(".drag-tooltip").remove();for(c=new Array(p.length),c[0]=p[0].point.getDistance(a.point),d=c[0],e=1;e<p.length;e++)c[e]=p[e].point.getDistance(a.point),c[e]<d&&(d=c[e]);f=c.indexOf(d),q.get("circleDrag").position=p[f].point,g=this._getGraphPointCoordinates([q.get("circleDrag").position.x,q.get("circleDrag").position.y]),h=this._getPowerOfNumber(g[0],this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.xTotalMultiplier),h[0]=parseFloat(h[0].toFixed(4)),0!==h[1]?(o=h[0].toString().length+"x10".length,j=o+h[1].toString().length,k=2):(o=0,j=h[0].toString().length,k=1),i=this._getPowerOfNumber(g[1],this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.yTotalMultiplier),i[0]=parseFloat(i[0].toFixed(4)),0!==i[1]?(n=i[0].toString().length+"x10".length,l=n+i[1].toString().length,m=2):(n=0,l=i[0].toString().length,m=1),this.disableLineTooltip!==!0&&this.showToolTipForPoint(p[f].point,h,i,!0,b.children[0].equation),this.refreshView()}},_addSegments:function(a){this.activateScope();var b,c,d,e,f,g,h,i,j,k,l;for(b=a.leftArray,c=a.rightArray,this._projectLayers.shapeLayer.activate(),void 0!==a.pathGroup&&(this._removePathRollOverListeners(a.pathGroup),a.pathGroup.remove()),i=void 0===a.color?"#000000":a.color,j=void 0===a.thickness?1:a.thickness,void 0!==a.dashArray&&(k=a.dashArray),l=void 0===a.visible?!0:"object"==typeof a.visible?a.visible.curve:a.visible,e=new this._paperScope.Group,g=null,h=null,f=0;f<b.length;f++)a.drawStyle.draggable&&(d=new this._paperScope.Path({segments:b[f]}),d.strokeColor=a.drawStyle.dragHitColor,d.strokeColor.alpha=a.drawStyle.dragHitAlpha,d.equation=a,d.hit=!0,d.equationID=a.id,d.strokeWidth=a.drawStyle.dragHitThickness,e.addChild(d)),d=new this._paperScope.Path({segments:b[f]}),d.strokeColor=a.color,d.strokeWidth=a.thickness,d.equation=a,d.equationID=a.id,e.addChild(d);if(void 0!==c)for(g=null,f=0;f<c.length;f++)a.drawStyle.draggable&&(d=new this._paperScope.Path({segments:c[f]}),d.strokeColor=a.drawStyle.dragHitColor,d.equation=a,d.hit=!0,d.strokeColor.alpha=a.drawStyle.dragHitAlpha,d.equationID=a.id,d.strokeWidth=a.drawStyle.dragHitThickness,e.addChild(d)),d=new this._paperScope.Path({segments:c[f]}),d.strokeColor=i,d.equation=a,d.equationID=a.id,d.strokeWidth=a.thickness,e.addChild(d);e.dashArray=a.dashArray,e.visible=l,this._setPathRollOverListeners(e),a.pathGroup=e,null!==a.labelData.labelObject&&this._updateLabelPosition(a),this._projectLayers.gridLayer.activate(),this.refreshView(),-1===this._gridGraphModelObject.get("_plots").indexOf(a)&&this._gridGraphModelObject.get("_plots").push(a)},_addGraph:function(a,b,c){this._projectLayers.shapeLayer.activate(),void 0!==a.pathGroup&&a.pathGroup.remove();var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(n=null,o=null,d=a.points,e=void 0===a.color?"#000000":a.color,f=void 0===a.thickness?1:a.thickness,z=void 0===a.opacity?1:a.opacity,void 0===a.dashArray||(A=a.dashArray),B=void 0===a.visible?!0:"object"==typeof a.visible?a.visible.curve:a.visible,g=new this._paperScope.Group,j=[],k=[],p=new CurveDerivativeTracker,q=new CurveDerivativeTracker,r=this._getOppositeAxis(b),s=this._getAxisIndex(b),t=!1,v=this._canvasSize.height,w=this._canvasSize.width,y=0;y<d.length;y++)(void 0!==d[y]&&t!==!0||(h=new this._paperScope.Path({segments:j}),h.strokeColor=e,h.strokeWidth=f,g.addChild(h),u=new this._paperScope.Path.Circle(new this._paperScope.Point(l[0],l[1]),10),u.strokeColor="black",g.addChild(u),j=[],t=!1,void 0!==d[y]))&&(l=this._generatePoint(d[y],b,1),l[1]<-5e3||l[0]<-5e3||l[0]>w+5e3||l[1]>v+5e3||(j.push(l),c>1&&(m=this._getCanvasPointCoordinates(this._generatePoint(d[y],b,2)),k.push(m),void 0!==q.flipState[2]&&q.flipState[2][s]===!0&&(k.pop(),k.pop())),void 0!==p.flipState[2]&&p.flipState[2][s]===!0&&(j.pop(),j.pop()),this._plottingPoints(g,n,o,l),n=o,o=l));j.length>0&&(h=new this._paperScope.Path({segments:j}),h.strokeColor=e,h.strokeWidth=f,g.addChild(h),c>1&&(i=new this._paperScope.Path({segments:k}),i.strokeColor="red",i.strokeWidth=f,g.addChild(i))),g.strokeColor=e,g.opacity=z,g.dashArray=A,g.visible=B,a.pathGroup=g,a.set({color:"black"}),x=this,-1===this._gridGraphModelObject.get("_plots").indexOf(a)&&this._gridGraphModelObject.get("_plots").push(a),this.refreshView()},_getOppositeAxis:function(a){switch(a){case"y":return"x";case"x":return"y"}},_getAxisIndex:function(a){switch(a){case"y":return 1;case"x":return 0}},_extendPathForConnection:function(a,b){var c,d,e;c=a[0],d=b[0],void 0!==c&&void 0!==d&&(e=geomFunctions.distance(new this._paperScope.Point(c[0],c[1]),new this._paperScope.Point(d[0],d[1])),10>e&&a.unshift(d),c=a[a.length-1],d=b[b.length-1],e=geomFunctions.distance(new this._paperScope.Point(c[0],c[1]),new this._paperScope.Point(d[0],d[1])),50>e&&a.push(d),this.refreshView())},_generatePoint:function(a,b,c){var d=[];return"y"!==b?(d.push(a[0+c]),d.push(a[0])):(d.push(a[0]),d.push(a[0+c])),d},_plottingPoints:function(a,b,c,d){var e;if(null!==b&&null!==c)return c[1]<b[1]&&c[1]<d[1]||c[1]>b[1]&&c[1]>d[1]?(e=new this._paperScope.Path.Circle({center:[c[0],c[1]],radius:2,fillColor:"#666666",strokeColor:"#666666"}),void a.addChild(e)):c[0]<b[0]&&c[0]<d[0]||c[0]>b[0]&&c[0]>d[0]?(e=new this._paperScope.Path.Circle({center:[c[0],c[1]],radius:2,fillColor:"#666666",strokeColor:"#666666"}),void a.addChild(e)):void 0},_getPointDiff:function(a){var b,c;return b=a[a.length-1],c=a[a.length-2],[b[0]-c[0],b[1]-c[1]]},_printorder:function(a,b){b=void 0,a=void 0},getAttribute:function(){var a,b,c;return c=function(a){var b,d;if(null===a||"object"!=typeof a)return a;b=a.constructor();for(d in a)b[d]=c(a[d]);return b},a={markerBounds:{},graphDisplay:{},currentLimits:{},graphOrigin:{currentOrigin:{x:{},y:{}},isOriginPositionChanged:null},graphParameters:{},zoomingFactor:{}},b=this._gridGraphModelObject.get("_graphDisplayValues"),a.markerBounds=this._gridGraphModelObject.get("markerBounds"),a.graphDisplay=b._graphDisplay,a.currentLimits=b._graphsAxisLimits.currentLimits,a.graphOrigin.currentOrigin.x=b._graphOrigin.currentOrigin.x,a.graphOrigin.currentOrigin.y=b._graphOrigin.currentOrigin.y,a.graphOrigin.isOriginPositionChanged=b._graphOrigin.isOriginPositionChanged,a.graphParameters=b._graphParameters,a.zoomingFactor=b._zoomingFactor,c(a)},setAttribute:function(a){this._gridGraphModelObject.setModelAttribute(a),this._retrieveGraph()},_retrieveGraph:function(){this._deltaAngle(),this.markerBounds=this._gridGraphModelObject.get("markerBounds"),this._graphTypeSelector()},activateScope:function(){this._paperScope.activate()},drawPolygon:function(b){this.activateScope(),"annotation"===b.type?this._projectLayers.annotationLayer.activate():(this._projectLayers.shapeLayer.activate(),void 0!==b.pathGroup&&this._removePathRollOverListeners(b.pathGroup)),void 0!==b.pathGroup&&b.pathGroup.remove();var c,d,e,f,g,h,i,j,k=new this._paperScope.Path,l=new this._paperScope.Group,m=0;if(b.drawStyle.draggable&&(d=new this._paperScope.Path,d.strokeColor=b.drawStyle.dragHitColor,d.equation=b,d.strokeColor.alpha=b.drawStyle.dragHitAlpha,d.equationID=b.id,d.strokeWidth=b.drawStyle.dragHitThickness,d.hit=!0),void 0!==b.points){if(j=b.points.length,c=this._gridGraphModelObject,-1===c.get("_plots").indexOf(b)&&c.get("_plots").push(b),j=b.points.length,k.strokeColor=l.strokeColor=b.color,k.strokeWidth=l.strokeWidth=b.thickness,k.opacity=l.opacity=b.opacity,k.equation=b,void 0===b.visible?k.visible=!0:"object"==typeof b.visible?k.visible=b.visible.curve:k.visible=b.visible,g=k.style,f=[],"annotation"!==b.type&&b.rayPolygon){for(e=[],i=1;j>i;i++)e.push(b.points[i-1][0]),e.push(b.points[i-1][1]),e.push(b.points[i][0]),e.push(b.points[i][1]);e=a.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.fitPointsInsideDomain({domain:{minX:this.markerBounds.min.x,maxX:this.markerBounds.max.x,minY:this.markerBounds.min.y,maxY:this.markerBounds.max.y}},e)}else e=b.points;for(i=0;j>i;i++)"annotation"===b.type?void 0===b.points[i]||null===b.points[i]?(l.addChild(k),k=new this._paperScope.Path,k.style=g,m=0):(k.add(this._getCanvasPointCoordinates(b.points[i])),d&&d.add(this._getCanvasPointCoordinates(b.points[i]))):b.rayPolygon?(h=[e[0][2*i],e[0][2*i+1]],k.add(this._getCanvasPointCoordinates(h)),d&&d.add(this._getCanvasPointCoordinates(h))):(k.add(this._getCanvasPointCoordinates(e[i])),d&&d.add(this._getCanvasPointCoordinates(e[i])));b.closed===!0&&(d&&(d.closed=!0),k.closed=!0),b.smooth===!0&&k.smooth(),d&&l.addChild(d),l.addChild(k),"annotation"!==b.type&&this._setPathRollOverListeners(l),b.pathGroup=l,null!==b.labelData.labelObject&&this._updateLabelPosition(b),this.refreshView()}},removePlottedGraph:function(a){a.pathGroup&&(this._removePathRollOverListeners(a.pathGroup),a.pathGroup.remove()),this.refreshView()},canvasResize:function(){this._paperScope.activate();var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=0,x=0;a=document.getElementById(this.ID.canvasId),r=this._gridGraphModelObject,f=r.get("_graphDisplayValues"),k=f._graphParameters.graphGridLine,s=f._graphParameters.xGridLine,t=f._graphParameters.yGridLine,l=f._zoomingFactor.zoomFactorForGraphParameterModification,u=f._zoomingFactor.xZoomFactorForGraphParameterModification,v=f._zoomingFactor.yZoomFactorForGraphParameterModification,m=f._graphsAxisLimits.currentLimits,o=f._graphParameters,b=$(a).height(),c=$(a).width(),j=f._graphParameters.distanceBetweenTwoHorizontalLines/v,i=f._graphParameters.distanceBetweenTwoVerticalLines/u,d=this._canvasSize.height,e=this._canvasSize.width,g=b-d,h=c-e,c>0&&b>0&&(0!==g||0!==h)&&(0!==g&&(this._canvasSize.height=b,x=g/(j*t)*f._zoomingFactor.yTotalMultiplier,m.yLower=m.yLower-x/2,m.yUpper=m.yUpper+x/2),0!==h&&(this._canvasSize.width=c,w=h/(i*s)*f._zoomingFactor.xTotalMultiplier,m.xLower=m.xLower-w/2,m.xUpper=m.xUpper+w/2),n=this.markerBounds,n.max.x=m.xUpper,n.max.y=m.yUpper,n.min.x=m.xLower,n.min.y=m.yLower,this._setTextBoxValues(),o=f._graphParameters,o.totalVerticalLines+=h/f._graphParameters.distanceBetweenTwoVerticalLines,o.totalHorizontalLines+=g/f._graphParameters.distanceBetweenTwoHorizontalLines,p=m.xLower>=0?0-m.xLower:Math.abs(m.xLower),q=m.yUpper<=0?0-Math.abs(m.yUpper):Math.abs(m.yUpper),f._graphOrigin.currentOrigin=new this._paperScope.Point(p/f._zoomingFactor.xTotalMultiplier*s*i,q/f._zoomingFactor.yTotalMultiplier*t*j),f._graphOrigin.defaultOrigin=new this._paperScope.Point(this._canvasSize.width/2,this._canvasSize.height/2),this._cartesionSymbolGenerator(),this._deltaAngle(),this._graphTypeSelector(),0!==r.get("_plots").length&&this._shapeRedraw(),0!==r.get("_points").length&&this._repositionPoints(),this._paperScope.view.viewSize=[c,b],this.refreshView())},_originShiftFactorForDoubleClick:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=this._getNextMultipliers(),t={};return e=this._gridGraphModelObject,f=e.get("_graphDisplayValues"),g=f._zoomingFactor,h=f._graphParameters,i=f._graphOrigin.currentOrigin,j=h.distanceBetweenTwoVerticalLines,k=h.distanceBetweenTwoHorizontalLines,b=g.zoomLevel-this._ZOOM_LEVEL_INCREMENT_STEPS,b<=this._MINIMUM_ZOOM_LEVEL_FACTOR&&(b=this._MAXIMUM_ZOOM_LEVEL_FACTOR),b===this._MAXIMUM_ZOOM_LEVEL_FACTOR?(c=s.xFactor.xGridLine,d=s.yFactor.yGridLine,l=s.xFactor.xTotalMultiplier,m=s.yFactor.yTotalMultiplier):(c=h.xGridLine,d=h.yGridLine,l=g.xTotalMultiplier,m=g.yTotalMultiplier),n=c/(c-b),o=d/(d-b),p=this._getCanvasPointCoordinates(a),t.x=p[0]-a[0]*c*(j/n)/l,t.y=p[1]+a[1]*d*(k/o)/m,q=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),r=this._angleBetweenTwoPoints(i,t)+Math.PI,{distance:q,angle:r}},_getNextMultipliers:function(){var a,b,c,d,e={},f={};switch(c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),a=d._zoomingFactor,b=this._zoomFactors,a.yCurrentFactor){case b[0]:f.yCurrentFactor=b[2],f.yZoomMultiplier=a.yZoomMultiplier/10,f.yTotalMultiplier=f.yCurrentFactor*f.yZoomMultiplier,f.yGridLine=5;break;case b[1]:f.yCurrentFactor=b[0],f.yZoomMultiplier=a.yZoomMultiplier,f.yTotalMultiplier=f.yCurrentFactor*a.yZoomMultiplier,f.yGridLine=4;break;case b[2]:f.yCurrentFactor=b[1],f.yZoomMultiplier=a.yZoomMultiplier,f.yTotalMultiplier=f.yCurrentFactor*a.yZoomMultiplier,f.yGridLine=4}switch(a.xCurrentFactor){case b[0]:e.xCurrentFactor=b[2],e.xZoomMultiplier=a.xZoomMultiplier/10,e.xTotalMultiplier=e.xCurrentFactor*e.xZoomMultiplier,e.xGridLine=5;break;case b[1]:e.xCurrentFactor=b[0],e.xZoomMultiplier=a.xZoomMultiplier,e.xTotalMultiplier=e.xCurrentFactor*a.xZoomMultiplier,e.xGridLine=4;break;case b[2]:e.xCurrentFactor=b[1],e.xZoomMultiplier=a.xZoomMultiplier,e.xTotalMultiplier=e.xCurrentFactor*a.xZoomMultiplier,e.xGridLine=4}return{xFactor:e,yFactor:f}},getDefaultZoomBehaviour:function(){return this._isGraphDefaultZoomBehaviourAllowed},setDefaultZoomBehaviour:function(a){"boolean"==typeof a&&(this._isGraphDefaultZoomBehaviourAllowed=a)},getDefaultPanBehaviour:function(){return this._isGraphDefaultPanBehaviourAllowed},setDefaultPanBehaviour:function(a){"boolean"==typeof a&&(a===!0?(this.$el.attr("disabledCursor",this.$el.find("canvas").css("cursor")),this.$el.find("canvas").css("cursor","pointer")):a===!1&&(this.$el.find("canvas").css("cursor","default"),this.$el.removeAttr("disabledCursor")),this._isGraphDefaultPanBehaviourAllowed=a)},getClosestGridPoint:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=[],I=1,J=1;for(g=a[0],h=a[1],c=this._gridGraphModelObject,d=c.get("_graphDisplayValues"),i=d._graphParameters.xGridLine,j=d._graphParameters.yGridLine,k=d._zoomingFactor.xTotalMultiplier,l=d._zoomingFactor.yTotalMultiplier,void 0===b&&(b=d._graphDisplay.isCartesionCurrentGraphType?"cartesian-graph":"polar-graph"),0!==Math.abs(g)&&(I=g/Math.abs(g)),0!==Math.abs(h)&&(J=h/Math.abs(h)),"cartesian-graph"===b?(e=I*k/i,f=J*l/j,m=g%e,n=e-m,o=h%f,p=f-o,H=[[g-m,h-o],[g+n,h-o],[g-m,h+p],[g+n,h+p]]):"polar-graph"===b&&(u=this.polarAngleIncrement(),v=this.angleBetweenPoints(a,[0,0],!1),0>v&&(v=2*Math.PI+v),w=v-v%u,x=v+(u-v%u),A=k/i,B=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)),y=B-B%A,z=B+(A-B%A),C=[y*Math.cos(x),y*Math.sin(x)],D=[y*Math.cos(w),y*Math.sin(w)],E=[z*Math.cos(x),z*Math.sin(x)],F=[z*Math.cos(w),z*Math.sin(w)],H=[C,D,E,F]),G=.4*geomFunctions.distance2(H[0][0],H[0][1],H[2][0],H[2][1]),r=0;r<H.length;r++)s=Math.sqrt(Math.pow(g-H[r][0],2)+Math.pow(h-H[r][1],2)),void 0===q?(q=s,t=H[r]):q>s&&(q=s,t=H[r]);return q>G?a:t},getClosestCanvasPoint:function(a,b){var c,d,e;return d=this._getGraphPointCoordinates(a),e=this.getClosestGridPoint(d,b),c=this._getCanvasPointCoordinates(e)},changeOriginPosition:function(a){var b,c,d;b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),d=c._graphOrigin.currentOrigin,(d.x!==a[0]||d.y!==a[1])&&(c._graphOrigin.currentOrigin=new this._paperScope.Point(a),this._graphLimitChangesDuringDragging(),this._graphTypeSelector(),this._deltaAngle(),0!==b.get("_plots").length&&this._shapeRedraw(),0!==b.get("_points").length&&this._repositionPoints(),this.refreshView())},angleBetweenPoints:function(a,b,c){var d,e,f,g,h;return d=a[0],e=a[1],f=b[0],g=b[1],h=Math.atan2(e-g,d-f),c?180*h/Math.PI:h},polarAngleIncrement:function(){var a,b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),d=c._graphOrigin.currentOrigin,e=this._canvasSize.width,f=this._canvasSize.height;return a=d.x<e&&d.x>0&&d.y<f&&d.y>0?15*Math.PI/180:5*Math.PI/180},setGraphType:function(a){var b,c;switch(b=this._gridGraphModelObject,c=b.get("_graphDisplayValues"),a){case"no-grid":c._graphDisplay.isLabelShown=!1,c._graphDisplay.isGridLineShown=!1,c._graphDisplay.isAxisLinesShown=!1,this._graphTypeSelector();break;case"cartesian-graph":c._graphDisplay.isCartesionCurrentGraphType=!0,c.isLabelShown||c.isGridLineShown||c.isAxisLinesShown||(c._graphDisplay.isLabelShown=!0,c._graphDisplay.isGridLineShown=!0,c._graphDisplay.isAxisLinesShown=!0),this._graphTypeSelector();break;case"polar-graph":c._graphDisplay.isCartesionCurrentGraphType=!1,c.isLabelShown||c.isGridLineShown||c.isAxisLinesShown||(c._graphDisplay.isLabelShown=!0,c._graphDisplay.isGridLineShown=!0,c._graphDisplay.isAxisLinesShown=!0,this._graphTypeSelector())}},getGraphType:function(){var a,b;return a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b.isLabelShown||b.isGridLineShown||b.isAxisLinesShown?"no-grid":b.isCartesionCurrentGraphType?"cartesian-graph":"polar-graph"},getMinimumMarkerValues:function(){var a,b,c,d,e,f,g;return a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),e=b._zoomingFactor,f=b._graphParameters.xGridLine,g=b._graphParameters.yGridLine,c=e.xTotalMultiplier/f,d=e.yTotalMultiplier/g,{xMinMarker:c,xGridLines:f,yMinMarker:d,yGridLines:g}},getMinimumSteps:function(){var a=this.getMinimumMarkerValues(),b=a.xMinMarker*a.xGridLines,c=a.yMinMarker*a.yGridLines;return{xMarker:b,yMarker:c}},startDoubleClickZoom:function(){this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.doubleClickZoomAllow=!0},stopDoubleClickZoom:function(){this._gridGraphModelObject.get("_graphDisplayValues")._zoomingFactor.doubleClickZoomAllow=!1},hideGridLines:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isGridLineShown=!1,this._graphTypeSelector()},hideLabels:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isLabelShown=!1,this._graphTypeSelector()},hideAxis:function(){var a,b;a=this._gridGraphModelObject,b=a.get("_graphDisplayValues"),b._graphDisplay.isAxisLinesShown=!1,this._graphTypeSelector()}},{AXIS_LABEL_RIGHT_PADDING:5,AXIS_LABEL_BOTTOM_PADDING:3})}(window.MathInteractives),function(a){"use strict";MathInteractives.Common.Components.Views.MathUtilitiesGraph.plotterView=Backbone.View.extend({model:null,_graphView:null,_plottingFuntions:null,_worker:null,initialize:function(){this.model=new MathInteractives.Common.Components.Models.MathUtilitiesGraph.plotterModel,this.graphView=this.options.graphView,this.graphView.on("graph:zoom-pan",$.proxy(function(){var a,b=this.model._equations;for(a=0;a<b.length;a++)if(void 0!==b[a].type&&null!==b[a].type&&"error"!==b[a].type&&"expression"!==b[a].type&&"number"!==b[a].type&&"quadratic"!==b[a].type)if("polygon"===b[a].type)this.graphView.drawPolygon(b[a]);else{if("point"===b[a].type)continue;"annotation"===b[a].type?this.graphView.drawPolygon(b[a]):"image"===b[a].type?this.graphView.repositionImage(b[a]):this._plot(b[a])}},this)),MathInteractives.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Productions.init()},addEquation:function(a){var b=this.model._equations,c=this.model._equationsMap;if(-1===b.indexOf(a))return b.push(a),c[a.id]=a,"image"===a.type?void this.graphView._paperScope.view.draw():(a.on("change-equation",$.proxy(function(){this._showConsole(!0,"Updating plot for equation "+a),this.addPlot(a)},this)),a.on("change-color",$.proxy(function(){this.changePlotColor(a)},this)),a.on("change-points-color",$.proxy(function(){this.changePointsColor(a)},this)),a.on("change-constants",$.proxy(function(){a.containsConstant!==!1&&"point"!==a.type&&("error"===a.type||"expression"===a.type||a.containsConstant===!0?this.addPlot(a):this._plot(a))},this)),a.on("change-thickness",$.proxy(function(){"point"===a.type?void 0!==a.pointsGroup&&(a.thickness=a.thickness,this.graphView._redrawPoints()):void 0!==a.pathGroup&&(a.pathGroup.strokeWidth=a.thickness)},this)),"polygon"===a.type||"annotation"===a.type?("annotation"===a.type&&null!==this.model._annotationPaths&&(this.model._annotationPaths.remove(),this.graphView._paperScope.view.draw()),void this.graphView.drawPolygon(a)):void this.addPlot(a))},removeEquation:function(a){var b,c=this.model._equations,d=this.model._equationsMap;b=c.indexOf(a),-1!==b&&(void 0!==a.pathGroup&&this.graphView.removePlottedGraph(a),void 0!==a.pointsGroup&&this.graphView.removePoint(a),void 0!==a.raster&&this.graphView.removeRaster(a),c.splice(b,1)),delete d[a.id]},createAnnotationStart:function(a,b){this.graphView._projectLayers.annotationLayer.activate(),this.graphView.setGridMode("annotation-mode");var c=this;this.graphView.on("annotation-start",$.proxy(c._createAnnotationMouseDown,c)),this.graphView.on("draw-annotation",$.proxy(c._createAnnotationMove,c)),this.graphView.on("annotation-end",$.proxy(c._createAnnotationMouseUp,c)),this.model._annotationPaths=new this.graphView._paperScope.Group,this.model._annotationPaths.strokeColor=a,this.model._annotationPaths.strokeWidth=b},_createAnnotationMouseDown:function(a){this.graphView.setGridMode("annotation-mode");var b,c=this.model;b=new this.graphView._paperScope.Path,b.strokeWidth=c._annotationPaths.strokeWidth,this.graphView._paperScope.tool.minDistance=1,b.strokeColor=this.model._annotationPaths.strokeColor,b.strokeWidth=this.model._annotationPaths.strokeWidth,c.incompleteAnnotations.push(this.graphView._getGraphPointCoordinates(getCanvasCoordinates(a))),c._firstPoint=a.point,c._annotationPaths.addChild(b),b.strokeCap="round"},_createAnnotationMove:function(a){var b=this.model._annotationPaths._children,c=this.model;this.graphView._paperScope.tool.minDistance=1,null!==c._firstPoint&&(b[b.length-1].add(c._firstPoint),c._firstPoint=null),b[b.length-1].add(a.point),c.incompleteAnnotations.push(this.graphView._getGraphPointCoordinates(getCanvasCoordinates(a)))},_createAnnotationMouseUp:function(a){a=void 0;var b=this.model,c=this.model._annotationPaths._children;null!==b._firstPoint&&(c[c.length-1].add([b._firstPoint.x,b._firstPoint.y]),c[c.length-1].add([b._firstPoint.x+1,b._firstPoint.y+1]),this.model.incompleteAnnotations.push(this.graphView._getGraphPointCoordinates([b._firstPoint.x+2,b._firstPoint.y+4])),b._firstPoint=null),this.model.incompleteAnnotations.push(void 0),this.graphView.refreshView()},createAnnotationEnd:function(a){a=void 0;var b;return this.model.incompleteAnnotations.pop(),b=this.model.incompleteAnnotations,this.model.incompleteAnnotations=[],this.graphView.off("annotation-start"),this.graphView.off("draw-annotation"),this.graphView.off("annotation-end"),this.graphView.resetGridMode(),b},changePlotColor:function(a){var b;if("point"===a.type)0===a.dashArray.length?this.changePointsColor(a):this.changePointsColor(a);else if(a.pathGroup)for(b=0;b<a.pathGroup.children.length;b++)a.pathGroup.children[b].hit||(a.pathGroup.children[b].strokeColor=a.color);this.graphView.refreshView()},changePointsColor:function(a){if(void 0!==a.pointsGroup){var b;if(0===a.dashArray.length)for(b=0;b<a.pointsGroup.children.length;b++)a.pointsGroup.children[b].hit||(a.pointsGroup.children[b].fillColor=a.color);else for(b=0;b<a.pointsGroup.children.length;b++)a.pointsGroup.children[b].hit||(a.pointsGroup.children[b].strokeColor=a.color);this.graphView._paperScope.view.draw()}},_showConsole:function(a,b,c){a=void 0,b=void 0,c=void 0},addPlot:function(a){var b,c,d,e;if(MathInteractives.Common.Components.Models.MathUtilitiesGraph.EquationEngine.Parser.parseEquation(a),"point"===a.type){if(!a.blind)for(c=a.solution.length,a.points=[],b=0;c>b;b++)d=[],d.push(Number(a.solution[b][0])),d.push(Number(a.solution[b][1])),a.points.push(d);this.graphView.drawPoint(a)}else a.canBeSolved===!0&&"expression"!==a.type&&"number"!==a.type?(MathInteractives.Common.Components.Models.MathUtilitiesGraph.EquationEngine.TreeProcedures.convertToSolvableForm(a),"quadratic"===a.type&&(e=MathInteractives.Common.Components.Models.MathUtilitiesGraph.EquationEngine.TreeProcedures.solveEquation(a,1),a.solution=e),"plot"===a.type&&(void 0===a.color&&(a.color="green"),this._plot(a))):a.blind===!0?this._plot(a):this._showConsole(!0,"Cant plot this equation")},_plot:function(a){a.leftArray=a.rightArray=[];var b,c,d,e,f,g,h,i,j,k=(this.model._equationsMap,Number(this.graphView.markerBounds.min[a.paramVariable])),l=Number(this.graphView.markerBounds.max[a.paramVariable]),m=(navigator.userAgent.toLowerCase(),[]),n=[],o=this.graphView,p=8*((Math.abs(k)+Math.abs(l))/1e4);if(o._paperScope.activate(),null!==a.range&&void 0!==a.range&&(null!==a.range.min&&(k=a.range.min.value,a.range.min.include===!1&&(k+=p)),null!==a.range.max&&(l=a.range.max.value,a.range.max.include===!1&&(l-=p))),b=this.graphView.getMinimumMarkerValues(),e={minX:k,maxX:l,minY:Number(this.graphView.markerBounds.min[a.functionVariable]),maxY:Number(this.graphView.markerBounds.max[a.functionVariable]),step:p,tolerance:b.xMinMarker/100,paramVariable:a.paramVariable},d=(p.toString().split(".")[1]||[]).length,c=a.analysis.paramVariableOrder,e.gridGraph=o,a.autonomous){for(h=new Function("constants,plot",a.analysis.functionCode),m=h(a.constants,e),f=[],g=0;g<m.length;g++)f.push(MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.translateSegment(e,m[g],o));m=f}else h=new Function("param,constants",a.analysis.functionCode),i=function(b){var c=h(b,a.constants);return c[0]},j=function(b){var c=h(b,a.constants);return c[1]},m=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.generatePlot(i,e),2===c&&(n=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.generatePlot(j,e),a.rightArray=n);a.leftArray=m,this.graphView._addSegments(a),a.points=m,void 0===a.thickness&&(a.thickness=3)},addImage:function(a,b,c){var d,e,f;return this.graphView._paperScope.activate(),this.graphView._projectLayers.imageLayer.activate(),d="string"==typeof a?new this.graphView._paperScope.Raster({source:a}):new this.graphView._paperScope.Raster(a),void 0===c?(e=d.width/2,f=d.height/2):(e=c[0]+c[2]/2,f=c[1]+c[3]/2),d.position=new this.graphView._paperScope.Point(e,f),b.position=this.graphView._getGraphPointCoordinates([e,f]),b.points=[],b.points.push(this.graphView._getGraphPointCoordinates([e,f])),this.addEquation(b),this.graphView._gridGraphModelObject.get("_images").push(b),d}},{}),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions=Backbone.Model.extend({},{_graphView:null,generateSimplePlot:function(a,b){
var c=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.getPlotObject(b);return MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.addPoint(c,b.minX,a(b.minX)),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.addPoint(c,b.maxX,a(b.maxX)),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.finishSegment(c),c.lines},convertPolarToCartesian:function(a){var b,c,d,e,f;for(b=[],c=[],e=0;e<a.length;e++){for(c=a[e],d=[],f=0;f<c.length-1;f+=2)isFinite(c[f])&&isFinite(c[f+1])&&(d.push(c[f+1]*Math.cos(c[f])),d.push(c[f+1]*Math.sin(c[f])));b.push(d)}return b},addPoint:function(a,b,c){var d,e=[b,c],f=a.basePoint;return a.temporaryLines?f?(d=[a.temporaryLines[a.temporaryLines.length-2],a.temporaryLines[a.temporaryLines.length-1]],this.changePivot(d,f,e,a.tolerance)||(this.removeUnsettledPoints(a),a.basePoint=e),void(a.unsettledPoint=e)):(a.basePoint=e,void(a.unsettledPoint=e)):void(a.temporaryLines=[e[0],e[1]])},removeUnsettledPoints:function(a){a.unsettledPoint&&(a.temporaryLines.push(a.unsettledPoint[0],a.unsettledPoint[1]),a.basePoint=null,a.unsettledPoint=null)},finishSegment:function(a){MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.removeUnsettledPoints(a);var b,c,d;if(a.temporaryLines){for(b=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.fitPointsInsideDomain(a,a.temporaryLines),d=0;d<b.length;d++)b[d].length<2||(c=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.translateSegment(a,b[d]),a.lines.push(c));a.temporaryLines=null}},translateSegment:function(a,b,c){var d,e,f=[];for(e=0;e<b.length-1;e+=2)d="x"===a.paramVariable?[b[e],b[e+1]]:[b[e+1],b[e]],d=a.gridGraph._getCanvasPointCoordinates(d),f.push(d);return f},projectPointOnDomain:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s;return isFinite(e)||(e=e>0?1e10:-1e10),isFinite(c)||(c=c>0?1e10:-1e10),j=!0,k=!0,isFinite(e)||(e=e>0?1e10:-1e10),isFinite(c)||(c=c>0?1e10:-1e10),d<a.domain.minX?(h=a.domain.minX,i=a.domain.minY,n=a.domain.minX,o=a.domain.maxY):d>a.domain.maxX?(h=a.domain.maxX,i=a.domain.minY,n=a.domain.maxX,o=a.domain.maxY):j=!1,e<a.domain.minY?(f=a.domain.minX,g=a.domain.minY,l=a.domain.maxX,m=a.domain.minY):e>a.domain.maxY?(f=a.domain.minX,g=a.domain.maxY,l=a.domain.maxX,m=a.domain.maxY):k=!1,k&&(p=geomFunctions.intersectionOfLines(f,g,l,m,b,c,d,e),void 0!==p&&(r=geomFunctions.distance2(b,c,p[0],p[1]))),j&&(q=geomFunctions.intersectionOfLines(h,i,n,o,b,c,d,e),void 0!==q&&(s=geomFunctions.distance2(b,c,q[0],q[1]))),r||s?r&&s?r>s?p:q:r?p:s?q:void 0:void 0},fitPointsInsideDomain:function(a,b){if(void 0!==b&&!(b.length<2)){var c,d,e,f,g,h,i=[],j=[i],k=[];for(c=0;c<b.length-1;c+=2)if(b[c]!==d||b[c+1]!==e)if(h=this.getDomainForPoint(a,b[c],b[c+1]),void 0!==d){if(h!==g){if(0===h&&k.indexOf(0)>-1){for(;k.length>0;)k.pop();i=[],j.push(i)}k.push(h)}if(0===h){if(0!==g){if(f=this.projectPointOnDomain(a,b[c],b[c+1],d,e),void 0===f)continue;i.push(f[0]),i.push(f[1])}i.push(b[c]),i.push(b[c+1])}else if(0===g){if(f=this.projectPointOnDomain(a,d,e,b[c],b[c+1]),void 0===f)continue;i.push(f[0]),i.push(f[1])}else if(h!==g){if(f=this.projectPointOnDomain(a,b[c],b[c+1],d,e),void 0===f)continue;if(i.push(f[0]),i.push(f[1]),f=this.projectPointOnDomain(a,d,e,b[c],b[c+1]),void 0===f)continue;i.push(f[0]),i.push(f[1])}g=h,d=b[c],e=b[c+1]}else d=b[c],e=b[c+1],0===h&&(i.push(b[c]),i.push(b[c+1])),g=h,k.push(h);return j}},changePivot:function(a,b,c,d){var e,f=geomFunctions.getSegmentParam(c[0],c[1],a[0],a[1],b[0],b[1]);return 1>f?!1:(e=[a[0]+f*(b[0]-a[0]),a[1]+f*(b[1]-a[1])],Math.abs(c[0]-e[0])<=d&&Math.abs(c[1]-e[1])<=d)},isPointOutSideDomain:function(a,b,c){return 0===this.getDomainForPoint(a,b,c)},getDomainForPoint:function(a,b,c){var d=0,e=0;return b<a.domain.minX-10?d=1:b>a.domain.maxX+10&&(d=2),c<a.domain.minY?e=1:c>a.domain.maxY&&(e=2),10*e+d},getPlotObject:function(a){return{lines:[],segment:null,tolerance:a.tolerance,domain:a,gridGraph:a.gridGraph,basePoint:null,unsettledPoint:null,paramVariable:a.paramVariable}},refine:function(a,b,c,d){var e,f;f=geomFunctions.mean(a[0],b[0]),e=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.detectJump(c,d.domain.tolerance,a[0],a[1],f,c(f),b[0],b[1]),e&&(MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.addPoint(d,e[0][0],e[0][1]),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.finishSegment(d),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.addPoint(d,e[1][0],e[1][1]))},generatePlot:function(a,b){var c,d=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.getPlotObject(b),e=b.minX,f=a(e),g=[e,f];for(isFinite(f)&&MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.addPoint(d,e,f),e+=b.step;e<=b.maxX;)f=a(e),isFinite(f)&&isFinite(g[1])?(MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.refine(g,[e,f],a,d),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.addPoint(d,e,f)):isFinite(f)&&!isFinite(g[1])?(c=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.limitedRefine(g[0],g[1],e,f,a),c[0]!==e&&MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.addPoint(d,c[0],c[1]),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.refine(c,[e,f],a,d),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.addPoint(d,e,f)):!isFinite(f)&&isFinite(g[1])&&(c=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.limitedRefine(g[0],g[1],e,f,a),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.refine(g,c,a,d),c[0]!==g[0]&&MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.addPoint(d,c[0],c[1]),MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.finishSegment(d)),g=[e,f],e+=b.step;return MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.finishSegment(d),d.lines},detectJump:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p;if(isFinite(d)&&isFinite(f)&&isFinite(h)&&!(c>e||e>g))for(;;){if(i=this.getInterpolationParam(c,e),k=a(i),m=Math.abs(k-geomFunctions.mean(d,f)),j=this.getInterpolationParam(e,g),l=a(j),n=Math.abs(l-geomFunctions.mean(f,h)),b>=m&&b>=n)return null;if(!isFinite(k))return o=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.limitedRefine(c,d,i,k,a),p=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.limitedRefine(i,k,g,h,a),[o,p];if(!isFinite(l))return o=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.limitedRefine(c,d,j,l,a),p=MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.limitedRefine(j,l,g,h,a),[o,p];if(!(i!==c&&i!==e||j!==e&&j!==g))return Math.abs(f-d)>Math.abs(h-f)?(o=[c,d],p=[e,f]):(o=[e,f],p=[g,h]),[o,p];if(i===c||i===e)return MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.selectJumpPoint(c,d,e,f,j,l,g,h);if(j===e||j===g)return MathInteractives.Common.Components.Models.MathUtilitiesGraph.plottingFunctions.selectJumpPoint(c,d,i,k,e,f,g,h);m>n?(g=e,h=f,e=i,f=k):(c=e,d=f,e=j,f=l)}},selectJumpPoint:function(a,b,c,d,e,f,g,h){var i=Math.abs(d-b),j=Math.abs(f-d),k=Math.abs(h-f);return i>j&&i>k?[[a,b],[c,d]]:k>j&&k>i?[[e,f],[g,h]]:[[c,d],[e,f]]},getInterpolationParam:function(a,b){return a>b&&(a=a+b-(b=a)),Math.abs(a)>.01||Math.abs(b)>.01?geomFunctions.mean(a,b):0===a?b*Math.abs(b):0===b?a*Math.abs(a):a>0!=b>0?0:geomFunctions.mean(a,b)},setGraphView:function(a){this._graphView=a},limitedRefine:function(a,b,c,d,e){var f,g;if(isFinite(b)!==isFinite(d))for(;;){if(f=this.getInterpolationParam(a,c),g=e(f),f===a||f===c)return isFinite(b)?[a,b]:[c,d];isFinite(g)!==isFinite(b)?(c=f,d=g):(a=f,b=g)}}})}(window.MathUtilities);