!function(a){"use strict";var b=a.Common.Components.Theme2.Models;b.TutorialPlayer=Backbone.Model.extend({defaults:{steps:[],stepsPlayedCounter:0},incrementCounter:function(){var a=Number(this.get("stepsPlayedCounter"));this.set("stepsPlayedCounter",++a)},setCounter:function(a){null!==a&&void 0!==a&&-1!==a?this.set("stepsPlayedCounter",a):this.incrementCounter()}},{METHOD_ENUM:{0:"_simulateMove",1:"_simulateClick",2:"_simulateDoubleClick",3:"_simulateDrag",4:"_simulateMouseDown",5:"_simulateMouseUp",6:"_promptUserToMarquee",7:"_promptUserToClick",8:"_promptUserToDoubleClick",9:"_promptUserToDrag",10:"_simulateToggleButtonToggle",11:"_simulateTileClick"},METHOD_ENUM_INVERSE:{_simulateMove:0,_simulateClick:1,_simulateDoubleClick:2,_simulateDrag:3,_simulateMouseDown:4,_simulateMouseUp:5,_promptUserToMarquee:6,_promptUserToClick:7,_promptUserToDoubleClick:8,_promptUserToDrag:9,_simulateToggleButtonToggle:10,_simulateTileClick:11},EVENTS:{PARSED_STEP_REQUIRED:"parsedStepRequired",STEP_PARSED:"stepParsed",ANIMATION_START:"playingTutorialAnimation",STEP_ANIMATION_END:"completedStep",HANDLE_CSS_ANIMATION_FOR_IE9:"_handleCssAnimationForIe9",ALL_STEPS_COMPLETED:"allStepsComplete",CURSOR_CHANGE_REQUIRED:"cursorChangeRequired",ANIMATION_CLASSES_REMOVED:"animationClassesRemoved"},Cursor:Backbone.Model.extend({defaults:{interactionPointOffset:{x:0,y:0},position:{x:0,y:0},currentCursor:"default"}},{})},{})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Theme2.Views,c=a.Common.Components.Theme2.Models;b.TutorialPlayer=a.Common.Player.Views.Base.extend({_elementsWithTutorialEvents:[],initialize:function(){this.player=this.options.player,this.idPrefix=this.options.idPrefix,window.tp=this},updateSteps:function(a){a&&this.model.set("steps",a)},stopActualMouseEvents:function(a){var b="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave select";b=b.trim().concat(" ").replace(/ /g,"."+this.idPrefix+" "),this.$el.off(b),a!==!1?this.$el.on(b,$.proxy(this.killEvent,this)):this.$el.off(b)},killEvent:function(a){a.stopPropagation(),a.preventDefault()},render:function(){this.addCursor()},addCursor:function(){var a=new c.TutorialPlayer.Cursor,d=this.el.id+"-cursor",e=$("<div></div>",{id:d,"class":d.slice(this.idPrefix.length)}).appendTo(this.$el);this.cursor=new b.TutorialPlayer.Cursor({el:e,model:a})},updateCursor:function(a){a=a||{},a.interactionPointOffset&&this.cursor.model.set("interactionPointOffset",a.interactionPointOffset),a.cursorImage&&this.cursor.$el.css("background-image",a.cursorImage),a.size&&this.cursor.$el.css(a.size)},play:function(a){(null===a||"undefined"==typeof a)&&(a=0);var b=c.TutorialPlayer.EVENTS;this.model.set("stepsPlayedCounter",a),this.on(b.ALL_STEPS_COMPLETED,$.proxy(this.onAllStepsCompletion,this)),this.playStep()},onAllStepsCompletion:function(){this.$el.hide(),this.resetCursor()},playStep:function(){var a=this.model.get("stepsPlayedCounter"),b=this.model.get("steps"),d=b[a],e=c.TutorialPlayer.EVENTS;d?(this.off(e.STEP_PARSED).on(e.STEP_PARSED,$.proxy(this.onStepParsed,this)),this.trigger(e.PARSED_STEP_REQUIRED,d)):(this.off("completedStepLevel0"),this.trigger(e.ALL_STEPS_COMPLETED))},proceedToNextStep:function(a){this.model.setCounter(a),this.playStep()},onStepParsed:function(a){this.off(c.TutorialPlayer.EVENTS.STEP_PARSED),this.parsedStep=a,this.playParsedStep()},playParsedStep:function(){var a,b,d=this.parsedStep,e=this.model.get("steps"),f=this,g=c.TutorialPlayer.METHOD_ENUM_INVERSE,h=c.TutorialPlayer.EVENTS,i=1,j=0;if(this.$el.show(),this.clearEventsBoundByTutorial(),this.model.get("stepsPlayedCounter")<e.length){this.trigger(h.ANIMATION_START);var k=function(){j++,j>=d.length&&(f.off("completedStepLevel"+i),this.$el.hide(),f.trigger(h.STEP_ANIMATION_END,d))};for(this.off("completedStepLevel"+i).on("completedStepLevel"+i,k),a=0;a<d.length;a++)switch(b=d[a],b.stepLevel=i,b.simulateActionEnum){case g._promptUserToClick:case g._promptUserToDoubleClick:case g._promptUserToDrag:this.$el.removeClass("cursor-none"),this.cursor.$el.hide(),this._animateElements(b);break;default:this.$el.addClass("cursor-none"),this.cursor.$el.show(),this[c.TutorialPlayer.METHOD_ENUM[b.simulateActionEnum]](b)}}else f.off("completedStepLevel0")},clearEventsBoundByTutorial:function(){var a=this._elementsWithTutorialEvents,b=null,c=null;for(c=a.length-1;c>=0;c--)b=a[c],b.off(".tutorial");this._elementsWithTutorialEvents=[]},resetCursor:function(){this.cursor.model.set("position",{x:0,y:0})},_simulateDrag:function(a){var b,c,d,e,f=this;e=a.stepLevel+1,b=[{methodName:"_simulateMouseDown",params:{target:a.target,stepLevel:e}},{methodName:"_simulateMove",params:{target:a.nextTarget,stepLevel:e,speedFactor:2}},{methodName:"_simulateMouseUp",params:{target:a.nextTarget,stepLevel:e}}],c=0,d=function(){if(c<b.length){var d=b[c];c++,window.setTimeout($.proxy(f[d.methodName],f,d.params),500)}else f.off("completedStepLevel"+e),f.trigger("completedStepLevel"+a.stepLevel)},f.off("completedStepLevel"+e).on("completedStepLevel"+e,d),f._setCursorAtTarget(a.target),d()},_simulateMove:function(a){this.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED);var b,d,e=a.target,f=e.element,g=e.offset,h=f.getBoundingClientRect(),i={x:h.left+g.x,y:h.top+g.y},j=this.cursor.getCursorPosition(),k=Math.round(i.x-j.x),l=Math.round(i.y-j.y),m=a.speedFactor||1,n=a.speed||3,o=10,p=k/o,q=l/o,r=j,s=null,t=this;n*=m,b=0,d=function(){o>b?(s=null,s={x:r.x+p,y:r.y+q},b++,window.setTimeout($.proxy(t._cursorMove,t,s,{target:f}),100),r=s):(t.cursor.off("moveComplete"),t.trigger("completedStepLevel"+a.stepLevel))},t.cursor.off("moveComplete").on("moveComplete",$.proxy(d,t)),d()},_cursorMove:function(a,b){this.cursor.move(a,b)},_simulateMouseDown:function(a){this.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED);var b=a.target,d=b.element,e=b.offset,f=d.getBoundingClientRect();this.cursor.sendMouseDownEvent({target:d,eventPoint:{x:f.left+e.x,y:f.top+e.y}}),this.trigger("completedStepLevel"+a.stepLevel)},_simulateMouseUp:function(a){this.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED);var b=a.target,d=b.element,e=b.offset,f=d.getBoundingClientRect();this.cursor.sendMouseUpEvent({target:d,eventPoint:{x:f.left+e.x,y:f.top+e.y}}),this.trigger("completedStepLevel"+a.stepLevel)},_simulateClick:function(a){var b,c,d,e,f=this,g=a.target;g.offset,g.element;e=a.stepLevel+1,b=[{methodName:"_simulateMouseDown",params:{target:g,stepLevel:e}},{methodName:"_simulateMouseUp",params:{target:g,stepLevel:e}}],c=0,d=function(){if(c<b.length){var d=b[c];c++,f[d.methodName].call(f,d.params)}else f.off("completedStepLevel"+e),f.trigger("completedStepLevel"+a.stepLevel)},f.off("completedStepLevel"+e).on("completedStepLevel"+e,d),f._setCursorAtTarget(a.target),d()},_simulateDoubleClick:function(a){var b,c,d,e,f=this;e=a.stepLevel+1,b=[{methodName:"_simulateClick",params:{target:a.target,stepLevel:e}},{methodName:"_simulateClick",params:{target:a.target,stepLevel:e}}],c=0,d=function(){if(c<b.length){var d=b[c];c++,f[d.methodName].call(f,d.params)}else f.off("completedStepLevel"+e),f.trigger("completedStepLevel"+a.stepLevel)},f.off("completedStepLevel"+e).on("completedStepLevel"+e,d),f._setCursorAtTarget(a.target),d()},_animateElements:function(b){var d,e,f,g,h,i=(b.stepLevel+1,this),j=a.Common.Utilities.Models.BrowserCheck,k=b.target,l=b.nextTarget,m=0,n=0,o=!1,p=!1,q=c.TutorialPlayer.EVENTS,r="webkitAnimationEnd oanimationend msAnimationEnd animationend MSAnimationEnd",s="",t=j.isIE&&j.browserVersion<10;k&&k.animation&&(o=!0,n++),l&&l.animation&&(p=!0,n++),f=function(){$(this).removeClass(s).removeClass("animated")},g=function(){m++,m>=n&&i.trigger("completedStepLevel"+b.stepLevel)},h=function(){$(this).removeClass(s).removeClass("animated"),g()},o&&(s+=k.animation.className+" ",d=$(k.element),t?k.animation.isNotStandard?i.trigger(q.HANDLE_CSS_ANIMATION_FOR_IE9,d,k.animation.className,g):this._simulateAnimateCss(d,k.animation,g):d.addClass(k.animation.className).addClass("animated").one(r,h)),p&&(s+=l.animation.className+" ",e=$(l.element),b.simulateActionEnum===c.TutorialPlayer.METHOD_ENUM_INVERSE._promptUserToDrag?(i._elementsWithTutorialEvents.push(d),d.off("dragstart.tutorial").on("dragstart.tutorial",function(){t?l.animation.isNotStandard?i.trigger(q.HANDLE_CSS_ANIMATION_FOR_IE9,e,l.animation.className):this._simulateAnimateCss(e,l.animation):e.addClass(l.animation.className).addClass("animated").one(r,f)}),g()):e.addClass(l.animation).addClass("animated").one(r,h))},_promptUserToMarquee:function(a){this._addRemoveFakeMarqueeDiv(!0);var b,d=a.stepLevel+1;b={target:a.target,nextTarget:a.nextTarget,stepLevel:d},this.off("completedStepLevel"+d).on("completedStepLevel"+d,$.proxy(function(){this._simulateMouseDown({target:b.target,stepLevel:b.stepLevel+1}),this.cursor.simulateEvent(b.nextTarget.element,"mousemove",{},{offset:b.nextTarget.offset}),this._simulateMouseUp({target:b.nextTarget,stepLevel:b.stepLevel+1}),this.stopActualMouseEvents(!1),this._addRemoveFakeMarqueeDiv(!1),this.trigger("completedStepLevel"+a.stepLevel)},this)),this._setCursorAtTarget(b.target),this.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED),this.stopActualMouseEvents();var e,f,g=b.target,h=g.element,i=g.offset,j=h.getBoundingClientRect(),k={x:j.left+i.x,y:j.top+i.y},l=b.nextTarget,m=l.element,n=l.offset,o=m.getBoundingClientRect(),p={x:o.left+n.x,y:o.top+n.y},q=this.el.getBoundingClientRect(),r=k.y-q.top,s=k.x-q.left,t=this.cursor.getCursorPosition(),u=Math.round(p.x-t.x),v=Math.round(p.y-t.y),w=b.speedFactor||1,x=((b.speed||10)*w,10),y=u/x,z=v/x,A=t,B=null,C=this;this._$fakeMarqueeDiv.css({top:r,left:s}),this._fakeMarqueeDivClientRect=this._$fakeMarqueeDiv[0].getBoundingClientRect(),e=0,f=function(){x>=e?(B=null,B={x:A.x+y,y:A.y+z},e++,window.setTimeout(function(){C._expandMarquee(B,{target:h})},100),A=B):(C._$fakeMarqueeDiv.css({width:u,height:v}),C.cursor.off("moveComplete"),C.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED),C.trigger("completedStepLevel"+b.stepLevel))},C.cursor.off("moveComplete").on("moveComplete",$.proxy(f,C)),this.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED),f()},_fakeMarqueeDivClientRect:null,_expandMarquee:function(a,b){if(this._cursorMove(a,b),this._$fakeMarqueeDiv){var c=this._fakeMarqueeDivClientRect,d=c.top,e=c.left;this._$fakeMarqueeDiv.css({width:a.x-e,height:a.y-d})}},_$fakeMarqueeDiv:null,_addRemoveFakeMarqueeDiv:function(a){if(a){var b=this.el.id+"-fake-marquee-div";this._$fakeMarqueeDiv=$("<div></div>",{id:b,"class":b.slice(this.idPrefix.length)}).appendTo(this.$el)}else this._$fakeMarqueeDiv.remove(),this._$fakeMarqueeDiv=null},_simulateToggleButtonToggle:function(a){var b,d=a.stepLevel+1;b={target:a.target,nextTarget:a.nextTarget,stepLevel:d},this.off("completedStepLevel"+d).on("completedStepLevel"+d,$.proxy(function(){this.stopActualMouseEvents(!1),this._setCursorAtTarget(b.target),this.cursor.sendClickEvent({target:b.target.element,eventPoint:{x:b.target.element.getBoundingClientRect().left+b.target.offset.x,y:b.target.element.getBoundingClientRect().top+b.target.offset.y}}),this.trigger("completedStepLevel"+a.stepLevel)},this)),this._setCursorAtTarget(b.target),this.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED),this.stopActualMouseEvents();var e,f,g=b.target,h=g.element,i=b.nextTarget,j=i.element,k=i.offset,l=j.getBoundingClientRect(),m={x:l.left+k.x,y:l.top+k.y},n=this.cursor.getCursorPosition(),o=Math.round(m.x-n.x),p=Math.round(m.y-n.y),q=b.speedFactor||1,r=((b.speed||10)*q,10),s=o/r,t=p/r,u=n,v=null,w=this;e=0,f=function(){r>e?(v=null,v={x:u.x+s,y:u.y+t},e++,window.setTimeout(function(){w._dragToggleButtonHandle(v,{target:h,targetParent:j})},20),u=v):(w.cursor.off("moveComplete"),w.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED),w.trigger("completedStepLevel"+b.stepLevel))},w.cursor.off("moveComplete").on("moveComplete",$.proxy(f,w)),this.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED),f()},_simulateTileClick:function(a){var b,d=a.stepLevel+1,e=this;b={target:a.target,nextTarget:a.nextTarget,stepLevel:d},this.off("completedStepLevel"+d).on("completedStepLevel"+d,$.proxy(function(){this.stopActualMouseEvents(!1),this._setCursorAtTarget(b.target),this.cursor.sendClickEvent({target:b.target.element,eventPoint:{x:b.target.element.getBoundingClientRect().left+b.target.offset.x,y:b.target.element.getBoundingClientRect().top+b.target.offset.y}}),this.trigger("completedStepLevel"+a.stepLevel)},this)),this._setCursorAtTarget(b.target),this.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED);var f=$(b.target.element);window.setTimeout(function(){f.addClass("tile-pressed-state"),window.setTimeout(function(){f.removeClass("tile-pressed-state"),window.setTimeout(function(){e.trigger(c.TutorialPlayer.EVENTS.CURSOR_CHANGE_REQUIRED),e.trigger("completedStepLevel"+b.stepLevel)},500)},1e3)},500)},_dragToggleButtonHandle:function(a,b){this._cursorMove(a,b);var c,d,e,f=b.target,g=b.targetParent;f&&(c=$(f),d=f.getBoundingClientRect(),e=g.getBoundingClientRect(),c.css({left:a.x-e.left-d.width/2}))},_setCursorAtTarget:function(a){var b=a.element,c=a.offset,d=b.getBoundingClientRect(),e={x:d.left+c.x,y:d.top+c.y};this.cursor.setCursorPosition(e)},animateDynamicGeneratedElements:function(b){var d,e,f,g,h,i,j,k=a.Common.Utilities.Models.BrowserCheck,l="webkitAnimationEnd oanimationend msAnimationEnd animationend MSAnimationEnd",m=0,n=0,o=this,p=b.length,q=c.TutorialPlayer.EVENTS,r="",s=k.isIE&&k.browserVersion<10;for(h=function(){$(this).removeClass(r).removeClass("animated")},i=function(){m++,m>=n&&o.trigger("dynamicGenElemsAnimationComplete")},j=function(){$(this).removeClass(r).removeClass("animated"),i()},d=0;p>d;d++)e=b[d],f=e.element,g=$(f),r+=e.animation.className+" ",s?e.animation.isNotStandard?o.trigger(q.HANDLE_CSS_ANIMATION_FOR_IE9,g,e.animation.className):this._simulateAnimateCss(g,e.animation,i):g.addClass(e.animation.className).addClass("animated").one(l,j)},_simulateAnimateCss:function(a,b,c){switch(b.className){case"bounce":this._bounceElementInIe9(a,b,c);break;case"pulse":b.isButton?this._pulseButtonInIe9(a,b,c):this._pulseElementInIe9(a,b,c)}},_bounceElementInIe9:function(a,b,c){a=a instanceof $?a:$(a);var d,e=b.duration||1e3,f=b.value||30,g=b.times||1,h=1*g;d=function i(){return 0===h?void(c&&c()):void a.effect("bounce",{distance:f},e,function(){h--,i()})}()},_pulseElementInIe9:function(a,b,c){a=a instanceof $?a:$(a);var d,e=b.duration||300,f=b.times||1,g=2*f,h=a.width(),i=a.height(),j=1.05*h,k=1.05*i,l=Number(a.css("top").split("px")[0]),m=Number(a.css("left").split("px")[0]),n=l+(i-k)/2,o=m+(h-j)/2,p={top:n,left:o,width:j,height:k},q={top:l,left:m,width:h,height:i};d=function r(){return 0===g?void(c&&c()):void a.animate(p,e/g,function(){g--,a.animate(q,e/g,function(){g--,r()})})}()},_pulseButtonInIe9:function(a,b,c){a=a instanceof $?a:$(a);var d,e,f,g=b.duration||300,h=b.times||1,i=2*h,j=i,k=a.width(),l=a.height(),m=1.05*k,n=1.05*l,o=Number(a.css("top").split("px")[0]),p=Number(a.css("left").split("px")[0]),q=o+(l-n)/2,r=p+(k-m)/2,s={top:q,left:r,width:m,height:n},t={top:o,left:p,width:k,height:l},u=a.find(".custom-btn-text"),v=a.find(".custom-btn-shadowHolder"),w={};u&&(w={textNode:u,lineHeight:u.css("line-height"),disp:u.css("display"),paddingLeft:u.css("padding-left"),initialHeight:l}),e=function(){var a=w.textNode;a.css({"line-height":"",display:"table-cell","vertical-align":"middle",width:"inherit",height:"inherit","text-align":"center",padding:0}),v.css("width","100%")},f=function(){var a=w.textNode;a.css("line-height",w.lineHeight),a.css("display",w.disp),a.css("vertical-align",""),a.css("width",""),a.css("text-align",""),a.css("padding",""),a.css("height",w.initialHeight+"px"),a.css("padding-left",w.paddingLeft),v.css("width","inherit")},d=function x(){return e(),0===i?(f(),void(c&&c())):void a.animate(s,g/j,function(){i--,a.animate(t,g/j,function(){i--,x()})})}()}},{Cursor:a.Common.Player.Views.Base.extend({setCursorPosition:function(a){this.model.set("position",a);var b=this.el.parentElement.getBoundingClientRect();this.$el.css({left:a.x-b.left,top:a.y-b.top})},getCursorPosition:function(){var a=this.el.getBoundingClientRect();return this.parentClientRect=this.el.parentElement.getBoundingClientRect(),{x:a.left,y:a.top}},getParentPosition:function(){var a=this.el.parentElement.getBoundingClientRect();return{x:a.left,y:a.top}},move:function(a,b){this.model.set("position",a);var c=this.parentClientRect;this.$el.css({left:a.x-c.left,top:a.y-c.top}),this.numberOfStepsToPerform--,this.simulateEvent(b.target,"mousemove",{clientX:a.x,clientY:a.y}),this.trigger("moveComplete")},sendClickEvent:function(a){this.simulateEvent(a.target,"click",{clientX:a.eventPoint.x,clientY:a.eventPoint.y})},sendDoubleClickEvent:function(a){this.simulateEvent(a.target,"dblclick",{clientX:a.eventPoint.x,clientY:a.eventPoint.y})},sendMouseDownEvent:function(a){this.simulateEvent(a.target,"mousedown",{clientX:a.eventPoint.x,clientY:a.eventPoint.y})},sendMouseUpEvent:function(a){this.simulateEvent(a.target,"mouseup",{clientX:a.eventPoint.x,clientY:a.eventPoint.y})},changeCursor:function(){},simulateEvent:function(a,b,c,d){if(d&&d.offset){var e=a.getBoundingClientRect();c.clientX=e.left+d.offset.x,c.clientY=e.top+d.offset.y}var f=this.createEvent(b,c);this.dispatchEvent(a,b,f,c)},createEvent:function(a,b){var c,d,e,f;return b=$.extend({bubbles:!0,cancelable:"mousemove"!==a,view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0},b),document.createEvent?(c=document.createEvent("MouseEvents"),c.initMouseEvent(a,b.bubbles,b.cancelable,b.view,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,b.relatedTarget||document.body.parentNode),0===c.pageX&&0===c.pageY&&Object.defineProperty&&(d=c.relatedTarget.ownerDocument||document,e=d.documentElement,f=d.body,Object.defineProperty(c,"pageX",{get:function(){return b.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0)}}),Object.defineProperty(c,"pageY",{get:function(){return b.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)}}))):document.createEventObject&&(c=document.createEventObject(),$.extend(c,b),c.button={0:1,1:4,2:2}[c.button]||(-1===c.button?0:c.button)),c.isSimulated=!0,c},dispatchEvent:function(a,b,c){a[b]?a[b]():a.dispatchEvent?a.dispatchEvent(c):a.fireEvent&&a.fireEvent("on"+b,c)}})})}(window.MathInteractives);