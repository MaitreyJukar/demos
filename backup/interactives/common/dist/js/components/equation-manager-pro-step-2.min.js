!function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro;b.TileItem=a.Common.Player.Models.Base.extend({defaults:{tileArray:null,operator:null,isDenominator:!1,isLHS:!0,type:null},initialize:function(){},getTree:function(){throw new Error("Not implemented Get Tree")},getModelFromIndex:function(){throw new Error("Not implemented getModelFromIndex")},getIndexFromItemModel:function(a){var b,c,d;if(d=this.get("tileArray"),!d)return-1;if(c=d.models.indexOf(a),-1!==c)return c+"";for(b=0;b<d.length;b++)if(c=d.at(b).getIndexFromItemModel(a),-1!==c)return b+"."+c;return-1},isPrecedent:function(a,c){var d=b.TileItem.OPERATORS;switch(a){case d.ADDITION:case d.SUBTRACTION:if([d.ADDITION,d.SUBTRACTION].indexOf(c)>-1)return!0;if([d.MULTIPLICATION,d.DIVISION].indexOf(c)>-1)return!1;break;case d.MULTIPLICATION:case d.DIVISION:if([d.ADDITION,d.SUBTRACTION,d.DIVISION,d.MULTIPLICATION].indexOf(c)>-1)return!0}return!0},deepClone:function(){var a=this.clone(),b=null,c=this.get("tileArray"),d=new Backbone.Collection,e=null;if(c&&c.length>0){for(b=0;b<c.length;b++)e=c.at(b).deepClone(),d.add(e);a.set("tileArray",d)}return a.set({multipleInParentheses:null,treeNodeRef:null}),a},setBDenominator:function(a){this.set("isDenominator",a);var b=this.get("tileArray"),c=0;if(b)for(c=0;c<b.length;c++)b.at(c).set("isDenominator",a)},setIsLHS:function(a){this.set("isLHS",a);var b=this.get("tileArray"),c=0;if(b)for(c=0;c<b.length;c++)b.at(c).setIsLHS(a)},checkIfVariablePresent:function(){var a,b=this.get("tileArray");for(a=0;a<b.length;a++)if(b.at(a).checkIfVariablePresent()===!0)return!0;return!1},checkFractionToDecimalCase:function(){return!1}},{TileType:{BIN_TILE:"BIN_TILE",TERM_TILE:"TERM_TILE",PARENTHESES:"PARENTHESES",FRACTION:"FRACTION",EQUATION:"EQUATION",EXPRESSION:"EXPRESSION",SQUARED_PARENTHESES:"SQUARED_PARENTHESES",MARQUEE:"MARQUEE",PARENTHESES_EXPONENT:"PARENTHESES_EXPONENT"},OPERATORS:{EQUAL:"=",ADDITION:"+",MULTIPLICATION:"*",DIVISION:"/",PARENTHESES:"^",SUBTRACTION:"-"},createTileItem:function(a){var c,d=b.TileItem.TileType;switch(a.type){case d.BASE_EXPONENT:c=new b.BaseExpTile(a);break;case d.PARENTHESES:c=new b.ParenthesesTile(a);break;case d.FRACTION:c=new b.FractionTile(a);break;case d.SQUARED_PARENTHESES:c=new b.SquaredParenthesesTile(a);break;case d.TERM_TILE:c=new b.TermTile(a);break;case d.EXPRESSION:c=new b.Expression(a);break;default:throw new Error("Item Type does not exist")}return c}})}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManagerPro;a.TreeNode=MathInteractives.Common.Player.Models.Base.extend({data:null,collectionData:null,children:null,parent:null,setData:function(a,b){this.data=a,this.collectionData=b,this.children=[],this.parent=null},isLeaf:function(){return 0===this.children.length},isRoot:function(){return this.parent?!1:!0},getPath:function(){for(var a=this,b=null,c=[];!a.isRoot();)b=a.parent.children.indexOf(a),c.push(b),a=a.parent;return c.reverse(),c},getTreeRoot:function(){for(var a=this;!a.isRoot();)a=a.parent;return a},getChildAt:function(a){return a.length?this.children[a.shift()].getChildAt(a):this},next:function(){var a=this.parent.children.indexOf(this);return a===this.parent.children.length-1?null:this.parent.children[a+1]},prev:function(){var a=this.parent.children.indexOf(this);return 0===a?null:this.parent.children[a-1]},areChildrenLeafNodes:function(){var a;for(a=0;a<this.children.length;a++)if(this.children[a].isLeaf()===!1)return!1;return!0},contains:function(a){var b,c=this.children?this.children:[];if(this.isLeaf())return!1;for(b=0;b<c.length;b++){if(-1!==a.indexOf(c[b].data))return!0;if(c[b].contains(a)===!0)return!0}return!1}},{})}(),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro;b.Marquee=a.Common.Player.Models.BaseInteractive.extend({defaults:function(){return{idPrefix:null,manager:null,filePath:null,player:null,marqueeContainer:null,selectorClass:null,ignoreClass:"ignore-marquee",tolerance:0,zIndex:3,marqueeDefaultOffset:{top:0,left:0},itemsDefaultOffset:{top:0,left:0},paddingTop:4,paddingRight:2,paddingBottom:2,paddingLeft:4,scrollAmt:0,type:"MARQUEE"}}},{MARQUEE_STYLE_DRAGGING:{border:"1px dashed rgb(141, 141, 141)","border-radius":"5px","background-color":"rgba(206, 206, 206, 0.4)"},MARQUEE_STYLE_AFTER_RELEASE:{border:"1px dashed rgb(228, 228, 228)","border-radius":"5px","background-color":"rgba(206, 206, 206, 0.4)"},FAKE_MARQUEE_STYLE:{DRAGGING:{border:"1px dashed rgb(141, 141, 141)","border-radius":"5px","background-color":"rgba(0,0,0,0)"}}})}(window.MathInteractives),function(a){"use strict";var b=null,c=a.Common.Components.Views.EquationManagerPro,d=a.Common.Components.Models.EquationManagerPro,e=a.Common.Utilities.Models.Rect,f=a.Common.Utilities.Models.Point;c.Marquee=a.Common.Player.Views.Base.extend({idPrefix:null,manager:null,filePath:null,$marqueeContainer:null,namespace:null,$marqueeDiv:null,_marqueeOriginalPosition:null,equationManager:null,isDrawing:!1,isDragging:!1,_isAcc:!0,initialize:function(){var a=this.model,b=a.get("marqueeContainer"),e=null,f=this.options.equationManager,g=a.get("scrollContainer"),h=d.TileItem.TileType;c.Marquee.bDocumentEventAttached||(c.Marquee.bDocumentEventAttached=!0),this.idPrefix=a.get("idPrefix"),this.manager=a.get("manager"),this.filePath=a.get("filePath"),this.player=a.get("player"),this._isAcc=this.isAccessible(),f&&(this.equationManager=f),this.model.set("type",h.MARQUEE),e="string"==typeof b?this.$(b):b,this.marqueeContainerSelector=""===e[0].id?Math.random().toPrecision(1):e[0].id,this.namespace=this.idPrefix+this.marqueeContainerSelector,this.$marqueeContainer=e,this.$scrollContainer=g,this.$marqueeDiv=this.createMarqueeDiv(),this.attachListenersOnMarqueeContainment(),this._attachListenersOnMarqueeDiv()},createMarqueeDiv:function(){var a=this.namespace,b=this.$marqueeContainer,c=this.model.get("zIndex"),e=$("<div>",{"class":a+"marquee-div marquee-div"});return this._isAcc&&e.attr("tabindex",-1),e.css({position:"absolute","z-index":c}),e.css(d.Marquee.MARQUEE_STYLE_DRAGGING),this.model.get("marqueeBGColor")&&e.css("background-color",this.model.get("marqueeBGColor")),b.append(e),e},attachListenersOnMarqueeContainment:function(){var b=this,c=this.namespace,d=this.$marqueeDiv,e=this.$marqueeContainer;a.Common.Utilities.Models.BrowserCheck.isMobile;a.Common.Utilities.Models.Utils.EnableTouch(d),e.off("mousedown."+c).on("mousedown."+c,function(a){b.marqueeContainerMouseDownHandler(a)}),this.applyHandCursorToElem(d),a.Common.Utilities.Models.Utils.EnableTouch(e,{specificEvents:a.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE})},_attachListenersOnMarqueeDiv:function(){this.$marqueeDiv.off("keydown.acc").on("keydown.acc",$.proxy(this.keydownHandler,this))},keydownHandler:function(a){a.preventDefault(),a.stopPropagation();var b=c.EquationManager.KEY;this.equationManager;if(this.$marqueeDiv.is(":visible"))switch(a.which){case b.LEFTARROW:case b.RIGHTARROW:this.equationManager.handleMarqueeAcc(a)}},detachListenersOnMarqueeContainment:function(){var a=this.namespace,b=null,c=null;b=this.$marqueeDiv,c=this.$marqueeContainer,c.off("mousedown."+a),b.off("mousedown."+a),c.off("mouseup."+a),b.off("mouseup."+a)},_detachAllExceptMouseDown:function(){var a=this.namespace,b=null,c=null;b=this.$marqueeDiv,c=this.$marqueeContainer,c.off("mouseup."+a),b.off("mouseup."+a)},detachListenersOnContainment:function(){this.detachListenersOnMarqueeContainment()},_getPoint:function(a){var b={x:a.pageX+this.model.get("scrollAmt"),y:a.pageY};return b},marqueeContainerMouseDownHandler:function(c){if(!this.isDragging){this.resetCursor(),this.isDrawing=!0;var d=this.$marqueeDiv,g=a.Common.Utilities.Models.BrowserCheck.isMobile,h=(new e(this.$marqueeContainer[0].getBoundingClientRect()),c);new f({left:h.clientX,top:h.clientY});if(g||1===c.which){for(this._marqueeMouseUpAndMoveEvents(),g&&(h=c.originalEvent,h.touches&&h.touches.length>0&&(h=h.touches[0]),this._marqueeTouchEndAndMoveEvents()),this.collapseMarquee(h);d[0].hasChildNodes();)d[0].removeChild(d[0].lastChild);d.show(),this.dragging=!0,this.startPoint=this._getPoint(h),this.trigger(b.EVENTS.start,b.createCustomEventObject(h),this.model.get("marqueeIndex")),this.$marqueeDiv.css({"z-index":this.model.get("zIndex")}),c.preventDefault()}}},marqueeMouseDownHandler:function(a){this.trigger(b.EVENTS.MARQUEE_MOUSEDOWN),a.stopPropagation(),a.preventDefault()},_detachUpAndMoveEvents:function(){var b=this.namespace;$(document).off("mouseup."+b),$(document).off("mousemove."+b),a.Common.Utilities.Models.Utils.DisableTouch(this.player.$el)},_marqueeMouseUpAndMoveEvents:function(){var a=this.namespace,b=this;$(document).off("mouseup."+a).on("mouseup."+a,function(a){var c;c=b.marqueeMouseUpHandler(a,!0,!1)}),$(document).on("mousemove."+a,function(a){a.preventDefault(),a.stopPropagation(),b.marqueeMouseMoveHandler(a)})},_marqueeTouchEndAndMoveEvents:function(){var b,c,d=this.namespace,e=this;b=function(a){a.stopPropagation(),$(document).off("mouseup."+d);var b;b=e.marqueeMouseUpHandler(a,!0,!1)},c=function(a){a.preventDefault(),a.stopPropagation(),e.marqueeMouseMoveHandler(a)},a.Common.Utilities.Models.Utils.DisableTouch(this.player.$el),a.Common.Utilities.Models.Utils.EnableTouch(this.player.$el)},marqueeMouseMoveHandler:function(c){var f=c;a.Common.Utilities.Models.BrowserCheck.isMobile&&(f=c.originalEvent,f.touches&&f.touches.length>0&&(f=f.touches[0]));var g,h,i,j,k,l,m,n,o,p,q=this.model.get("scrollAmt"),r=this._getPoint(f),s=r.x,t=r.y,u=this.startPoint,v=u.x,w=u.y,x=Math.abs(s-v),y=Math.abs(t-w),z=30,A=15,B=4;g=this.$marqueeDiv,j=this.$marqueeContainer,k=j.offset(),l=k.left+q,m=k.top,o=j.height(),n=j.width(),p=new e(this.$scrollContainer[0].getBoundingClientRect()),i=v>s?v-x:v,h=w>t?w-y:w,l>s?(i=l,x=v-l):s>l+n&&(x=l+n-v-B),m>t?(h=m,y=w-m):t>m+o&&(y=m+o-w-B),s-q>p.getRight()-z?this.$scrollContainer.scrollLeft(q+A):s-q<p.getLeft()+z&&this.$scrollContainer.scrollLeft(q-A),g.css({width:Math.round(x),height:Math.round(y),top:Math.round(h-m)+0+"px",left:Math.round(i-l)+0+"px"}),c.originalEvent&&c.originalEvent.isSimulated?g.css(d.Marquee.FAKE_MARQUEE_STYLE.DRAGGING):(g.css(d.Marquee.MARQUEE_STYLE_DRAGGING),this.model.get("marqueeBGColor")&&g.css("background-color",this.model.get("marqueeBGColor"))),this.trigger(b.EVENTS.move,b.createCustomEventObject(f)),c.preventDefault()},marqueeMouseUpHandler:function(a,c,d){if(d||this.dragging){var f,g=this.$marqueeContainer,h=g.offset(),i=this.$marqueeDiv;if(this.applyHandCursorToElem(i),this.isDrawing=!1,a.isSimulated||a.originalEvent.isSimulated)return f=i.clone().removeAttr("class").addClass("fake-marquee").insertAfter(i),this.collapseMarquee(a),a.preventDefault(),void this._detachUpAndMoveEvents();this.trigger(b.EVENTS.ChangeSelectorClass,a,i,this.model.get("marqueeIndex")),this.dragging&&(this.dragging=!1);var j=this,k=[],l=j.model.get("selectorClass"),m=j.model.get("ignoreClass"),n=(j.model.get("tolerance"),"string"==typeof l?this.$scrollContainer.find("."+l):l),o=null,p=null,q=null,r=null,s=null,t=null,u=null,v={top:0,left:0,height:0,width:0},w=!0,x=null;n.each(function(a){o=$(this),o.hasClass(m)||(p=o.offset(),q=p.top,r=p.left,s=o.outerHeight(),t=o.outerWidth(),u={top:q,left:r,height:s,width:t},o.data().isInsideMarquee=!0,w?(v.top=q,v.left=r,v.height=s,v.width=t,w=!1,k.push(o)):k.push(o),v=j._adjustMarqueeBounds(v,u))}),v.top=v.top-h.top,v.left=v.left-h.left;var y=this._getMarqueeData();x=j._resizeMarquee(v,k,c,a),this.$groupCover&&this.$groupCover.css({height:this.$marqueeDiv.outerHeight(!0),width:this.$marqueeDiv.outerWidth(!0)}),this.marqueeInitRect=new e(i[0].getBoundingClientRect()),c&&j.trigger(b.EVENTS.end,b.createCustomEventObject(a,k,{marqueeData:y,$marquee:i,$scrollCntr:this.$scrollContainer})),this.$marqueeDiv.css({"z-index":0}),a.preventDefault(),this._detachUpAndMoveEvents()}},_getMarqueeData:function(){var a=this.$marqueeDiv,b={height:a.outerHeight(),width:a.outerWidth(),position:a.position(),offset:a.offset()};return b},_adjustMarqueeBounds:function(a,b){var c=b.top,d=b.left,e=b.height,f=b.width;return c>=a.top&&d>=a.left?(a.height=c+e>a.top+a.height?c+e-a.top:a.height,a.width=d+f>a.left+a.width?d+f-a.left:a.width):c<=a.top&&d<=a.left?(a.height=a.top+a.height-c,a.width=a.left+a.width-d,a.top=c,a.left=d):c>=a.top&&d<=a.left?(a.height=a.top+a.height<c+e?c+e-a.top:a.height,a.width=a.left+a.width-d,a.left=d):c<=a.top&&d>=a.left&&(a.height=e<a.height?a.top+a.height-c:e,a.width=a.left+a.width<d+f?d+f-a.left:a.width,a.top=c),a},_checkIsInsideMarquee:function(a,b){if(a){var c=!1,d=this.$marqueeDiv,e=d.offset(),f=e.top,g=e.left,h=d.outerHeight(!0),i=d.outerWidth(!0),j=e.top+h,k=e.left+i,l=a.top,m=a.left,n=a.height,o=a.width,p=n*o,q=l+n,r=m+o,s=0,t=0,u={height:0,width:0},v=0;return s=Math.max(Math.min(j,q)-Math.max(f,l),0),t=Math.max(Math.min(k,r)-Math.max(g,m),0),u.height=s,u.width=t,v=u.height*u.width,r>g&&k>m&&q>f&&j>l&&v/p>b&&(c=!0),c}},_resizeMarquee:function(a,c,d,e){var f=this,g=this.$marqueeDiv,h=null,i=this.model.get("paddingTop"),j=this.model.get("paddingRight"),k=this.model.get("paddingBottom"),l=this.model.get("paddingLeft"),m=this.model.get("marqueeDefaultOffset"),n=null,o=0,p=0;if(a){p?(o=p,g.css({top:Math.round(a.top-h+m.top),left:Math.round(a.left-h+m.left)+o,height:Math.round(a.height?a.height+2*h:0),width:Math.round(a.width?a.width+2*h:0)})):g.css({top:a.top-i+m.top,left:a.left-l,height:Math.round(a.height?a.height+(i+k):0),width:Math.round(a.width?a.width+(j+l):0)+p}),(1===a.height||1===a.width)&&g.css({outline:"none"});var q=this._getMarqueeData(),r=[],s=null;s=c.length,n=b.createCustomEventObject(e,c,{marqueeData:q,elementPositions:r}),d&&f.trigger(b.EVENTS.resize,n)}return n},_getElementData:function(a){var b=a.offset(),c=this.$marqueeDiv.offset(),d={relativeTop:b.top-c.top,relativeLeft:b.left-c.left};return d},isDisabled:!1,disableMarquee:function(){var a=this.$marqueeDiv;this.hideMarquee(),this.detachListenersOnMarqueeContainment(),this.isDisabled=!0,a.is(".ui-draggable")&&a.draggable("disable"),a.is(".ui-droppable")&&a.droppable("disable")},enableDisableMarqueeDraggable:function(a){this.$marqueeDiv.is(".ui-draggable")&&this.$marqueeDiv.draggable(a?"enable":"disable")},enableDisableMarqueeDroppable:function(a){this.$marqueeDiv.is(".ui-droppable")&&this.$marqueeDiv.droppable(a?"enable":"disable")},enableMarquee:function(){this.isDisabled=!1,this.showMarquee(),this.attachListenersOnMarqueeContainment(),this._attachListenersOnMarqueeDiv()},hideMarquee:function(){this.$marqueeDiv.hide()},showMarquee:function(){this.$marqueeDiv.show()},getMarqueeDiv:function(){return this.$marqueeDiv},collapseMarquee:function(a){var b=this.$marqueeDiv;this.marqueeInitRect=null,this._resizeMarquee({top:0,left:0,width:0,height:0},!1,!0,a),b.css({border:"none","background-color":"rgba(0, 0, 0, 0);"}),setTimeout(function(){b.off(),b.is(".ui-draggable")&&b.draggable("destroy"),b.is(".ui-droppable")&&b.droppable("destroy")},10)},customFitMarqueeToBounds:function(a,b){this._resizeMarquee(a,b,!1)},drawMarqueeOn:function(a){var b=0,c=null,e=null,f=this.$marqueeContainer.offset(),g=null,h=null;for(b=0;b<a.length;b++)h=a[b].$el,g=h.offset(),c={left:g.left-f.left,top:g.top-f.top,width:h.outerWidth(),height:h.outerHeight()},c.right=c.left+c.width,c.bottom=c.top+c.height,e||(e=$.extend({},c)),e={left:Math.min(e.left,c.left),top:Math.min(e.top,c.top),right:Math.max(e.right,c.right),bottom:Math.max(e.bottom,c.bottom)},e.width=e.right-e.left,e.height=e.bottom-e.top;this.customFitMarqueeToBounds(e,a),this.$marqueeDiv.css(d.Marquee.MARQUEE_STYLE_AFTER_RELEASE),this.model.get("marqueeBGColor")&&this.$marqueeDiv.css("background-color",this.model.get("marqueeBGColor"))},groupSelectedElements:function(b){var c=this.$marqueeDiv,d=this,e=this.namespace;a.Common.Utilities.Models.BrowserCheck.isMobile;this.$groupCover=$("<div/>"),c.append(b),c.append(this.$groupCover),this.$groupCover.attr("class","selected-elements-cover").css({position:"absolute",height:c.outerHeight(),width:c.outerWidth(),top:"0px",left:"0px","z-index":0}),this._isAcc&&this.$groupCover.attr("tabindex",-1),c.css(a.Common.Components.Models.EquationManagerPro.Marquee.MARQUEE_STYLE_AFTER_RELEASE),this.model.get("marqueeBGColor")&&c.css("background-color",this.model.get("marqueeBGColor")),c.off("mousedown."+e).on("mousedown."+e,function(a){d.marqueeMouseDownHandler(a)}),a.Common.Utilities.Models.Utils.EnableTouch(c)},makeGroupDraggable:function(b,e,g){var h,i=this,j=0,k=e.length,l=d.TileItem.TileType,m=c.EquationManagerPro.EVENTS;this.$marqueeDiv.on("mousedown",function(a){g.adjustContainment($(this)),g.mouseDownOnInteractive(a,!1,!0,!1),a.stopPropagation()}),this.$marqueeDiv.on("mouseup",function(a){g.resetContainment()}),this.$marqueeDiv.draggable({scroll:!0,scrollSensitivity:50,distance:10,refreshPositions:!0,scrollSpeed:a.Common.Utilities.Models.BrowserCheck.isMobile?40:30,appendTo:this.equationManager.$el.find(".equation-view-component"),containment:g.$draggableContainment,revert:function(){return i.$marqueeDiv.css({cursor:"default"}),this.data("isDropped")===!0?(i.equationManager.$(".term-tile[data-negatetile=true]").removeAttr("data-negatetile data-originalvalue"),!1):(i.equationManager._showHideDropslots(i.equationManager.equationView.$el,!1),i.equationManager.showHideOverlayDiv(!0),g.trigger(m.REVERT_START),!1)},zIndex:5,cursorAt:{left:i.$marqueeDiv.width()/2,top:i.$marqueeDiv.height()/2},helper:"clone",start:function(a,d){var e=a.originalEvent?a.originalEvent:a,l=c.EquationManagerPro.EVENTS,m=$(this).parents(".expression-view-holder").length>0?$(this).parents(".expression-view-holder"):null;m&&(j=m.scrollLeft()),i.stopReading(),$(this).css({visibility:"hidden"}),i.isDragging=!0,h=new f({left:e.clientX,top:e.clientY}),d.helper.addClass("current-draggable"),d.helper.data({"cur-draggable":b,length:k,prevLocationData:b.model.get("isLHS")}),g.trigger(l.MARQUEE_DRAG_START),g.trigger(l.ANY_DRAG_START),g.getLhsRhsContainerRects()},drag:function(a,b){i.equationManager.enableDisableDroppables(a,b,i.equationManager.marqueeSelectedItems[0]),i.equationManager.onlyLHS||i._negateTile(a,b);var c,e=i.equationManager.marqueeSelectedItems;1===e.length&&(c=e[0],c.model.get("type")===d.TileItem.TileType.TERM_TILE&&c._termTileDraggingStart())},stop:function(a,b){g.trigger(m.ANY_DRAG_STOP);var e,f=i.equationManager.marqueeSelectedItems;if(1===f.length&&(e=f[0],e.model.get("type")===d.TileItem.TileType.TERM_TILE&&e._termTileDraggingStop()),$(this).data("isDropped"))g.removeMarquee(),i._onStop(g,b,$(this)),g.trigger(c.EquationManagerPro.EVENTS.TILE_DROP_SUCCESS);else{var h=$(this),k=h.parents(".expression-view-holder").length>0?$(this).parents(".expression-view-holder"):null,l=b.originalPosition,n=l.left,o=l.top,p=b.helper.clone();if(b.helper.parent().append(p),p.css({"z-index":5}),i.equationManager.showHideOverlayDiv(!0),k){var q=g.getScrollAmount(k,h);q.scroll&&k.scrollLeft(q.scrollAmt),j-=k.scrollLeft()}p.animate({top:o,left:n+j},700,function(){i._onStop(g,b,h),h.css({visibility:""}),p.remove()})}}}).attr({"data-tiletype":l.MARQUEE})},_onStop:function(a,b,d){var e=c.EquationManagerPro.EVENTS;this.isDragging=!1,b.helper.removeData("cur-draggable"),b.helper.removeClass("current-draggable"),b.helper.removeData("prevLocationData"),b.helper.removeData("length"),d.removeData("isDropped"),a.resetContainment(),a.showHideOverlayDiv(!1),a.refresh(),a.trigger(e.REVERT_END),a.setIsDropped(!1),a.refresh(),a.equationView.$el.find(".hover-border").removeClass("hover-border")},_negateTile:function(a,b){var c,d=0===this.model.get("marqueeIndex")?!0:!1,f=new e(b.helper[0].getBoundingClientRect()),g=f.getMiddle(),h=this.$(".term-tile[data-negatetile=true]"),i=h.length/3,j=!1;for(j=this.equationManager.lhsRect.isPointInRect(g)&&!d?!0:this.equationManager.rhsRect.isPointInRect(g)&&d?!0:!1,c=h.length;c>h.length-i;c--)this.invertBaseText(j,$(h[c-1]))},invertBaseText:function(a,b){var c=b.find(".base-value");0!==c.find(".base-str")&&(a?(c.data("isNegate")||c.html(this.invertText(c.text())),c.data("isNegate",!0)):(c.html(this.getValueText(b.data("originalvalue"))),c.data("isNegate",!1)))},invertText:function(a){var b="−",c=parseInt(a),d=null;return-1===a.indexOf(b)?isNaN(c)?b+"<em>"+a+"</em>":"0"===a?a:b+a:(d=a.substr(b.length),isNaN(parseInt(d))?"<em>"+d+"</em>":d)},getValueText:function(a){var b=a;return"string"==typeof b&&-1!==b.indexOf("-")?(b="<em>"+b+"</em>","&minus;"+b.replace("-","")):null!==b&&void 0!==b?isNaN(b)?0>b?"&minus;"+Math.abs(b):"<em>"+b.toString()+"</em>":0>b?"&minus;"+Math.abs(b):b.toString():b},breakGroup:function(){for(var a=this.$marqueeDiv[0];a.hasChildNodes();)a.removeChild(a.lastChild)},getOriginalOffset:function(){return this._marqueeOriginalPosition},applyHandCursorToElem:function(b){if(!this.equationManager.isTouch()){var c,d;c="mouseenter",d="mouseleave",b.on(c,$.proxy(this._setOpenCursor,this)),b.on(d,$.proxy(this._setDefaultCursor,this)),b.on("mousedown",$.proxy(this._setClosedCursor,this)),b.on("mouseup",$.proxy(this._setOpenCursor,this)),a.Common.Utilities.Models.Utils.EnableTouch(b)}},_setOpenCursor:function(){if(!this.equationManager.isTouch()){var a=this.$marqueeDiv;a.hasClass("current-draggable")||a.css({cursor:"url('"+this.getImagePath("open-hand")+"'), move"})}},_setClosedCursor:function(){if(!this.equationManager.isTouch()){var a=this.$marqueeDiv;a.hasClass("current-draggable")||a.css({cursor:"url('"+this.getImagePath("closed-hand")+"'), move"})}},_setDefaultCursor:function(){if(!this.equationManager.isTouch()){var a=this.$marqueeDiv;a.hasClass("current-draggable")||a.css({cursor:"default"})}},resetCursor:function(){if(!this.equationManager.isTouch()){var b,c,d=this.$marqueeDiv;b="mouseenter",c="mouseleave",d.off(b,this._setOpenCursor),d.off(c,this._setDefaultCursor),d.off("mousedown",this._setClosedCursor),d.off("mouseup",this._setOpenCursor),a.Common.Utilities.Models.Utils.EnableTouch(d)}}},{createMarquee:function(b){if(b){var c=new a.Common.Components.Models.EquationManagerPro.Marquee(b),d=new a.Common.Components.Views.EquationManagerPro.Marquee({model:c,el:b.el||b.player.$el,equationManager:b.equationManager});return d}},EVENTS:{MARQUEE_MOUSEDOWN:"marquee-mousedown",resize:"marquee-resize",move:"marquee-move",start:"marquee-select-start",end:"marquee-end",ChangeSelectorClass:"change-selector-class"},FRACTION_CLASSES:{NUMERATOR:"fraction-component-numerator",DENOMINATOR:"fraction-component-denominator"},createCustomEventObject:function(a,b,c){return{originalEvent:a,selectedItems:b,optionalParams:c}},bDocumentEventAttached:!1,CTX_ITEM_ID:{DELETE_TILE:"marquee-context-menu-0",ADD_NEG_PARENS:"marquee-context-menu-1",ADD_POS_PARENS:"marquee-context-menu-2",REMOVE_PARENS:"marquee-context-menu-3",COMBINE_NUM:"marquee-context-menu-4",COMBINE_DEN:"marquee-context-menu-5",REPOS_ACROSS_VINCULUM:"marquee-context-menu-6"}}),b=c.Marquee}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManagerPro,b=a.EquationManagerPro.Utils;a.Equation=a.TileItem.extend({defaults:$.extend(!0,{},a.TileItem.prototype.defaults,{type:a.TileItem.TileType.EQUATION}),initialize:function(){a.Equation.__super__.initialize.apply(this,arguments);var b,c=0,d=[];if(null===this.get("tileArray")&&this.set("tileArray",[]),b=this.get("tileArray"),b instanceof Array){for(c=0;c<b.length;c++)d[c]=a.TileItem.createTileItem(b[c]);this.set("tileArray",new Backbone.Collection(d))}},getTree:function(){var b,c,d=this.get("tileArray"),e=d.length,f=[];for(b=0;e>b;b++)c=d.at(b),Array.prototype.push.apply(f,c.getTree());return 1===e&&f.push(null),f.push(a.TileItem.OPERATORS.EQUAL),f.push(this),this._createTree(f)},_createTree:function(b){var c,d,e,f,g,h,i,j=[],k=a.TileItem.OPERATORS;for(h=0,i=b.length;i>h;h++)f=b[h],c=new a.TreeNode,[k.PARENTHESES,k.DIVISION,k.EQUAL].indexOf(f)>-1?(c.setData(f,b[h+1]),h+=1):c.setData(f,null),"string"!=typeof f?j.push(c):(e=j.pop(),d=j.pop(),d.data===c.data&&d.data!==k.PARENTHESES?(d.children.push(e),e.parent=d,j.push(d)):(c.children.push(d,e),d.parent=e.parent=c,j.push(c)));return g=j.pop(),this._cacheTakeOutCommonRelatedNodes(g),g},parseTree:function(a){var b=[];return Array.prototype.push.apply(b,this._parseTreeForAcc(a.children[0])),Array.prototype.push.apply(b,this._parseTreeForAcc(a.children[1])),b},_parseTreeForAcc:function(a){for(var b=[],c=null,d=0;d<a.children.length;d++){var e=a.children[d];if(!e||"*"!==e.data&&"+"!==e.data)c=this.getModelIndexFromNode(e),null!=c&&b.push(c);else{for(var f=[],g=0;g<e.children.length;g++)c=this.getModelIndexFromNode(e.children[g]),null!=c?f.push(c):e.children[g].children.length>0&&f.push(this._parseTreeForAcc(e.children[g]));b.push(f)}e.children.length>0&&("^"===e.data?Array.prototype.push.apply(b,this._parseTreeForAcc(e.children[0])):Array.prototype.push.apply(b,this._parseTreeForAcc(e)))}return b},getModelIndexFromNode:function(a){return a.collectionData||"string"!=typeof a.data?this.getIndexFromItemModel(a.collectionData||a.data):void 0},_cacheTakeOutCommonRelatedNodes:function(a){this._setMultipleInParenthesesForAllLeaves(a,null),this._cacheTakeOutCommonRelatedNodesIndices(a)},_setMultipleInParenthesesForAllLeaves:function(a,c){var d,e=b.getAllLeaves(a);for(d=0;d<e.length;d++)"number"!=typeof e[d].data&&e[d].data.set("multipleInParentheses",c);for(e=this._getChildParenthesesNodes(a),d=0;d<e.length;d++)e[d].collectionData.set("multipleInParentheses",c)},_getChildParenthesesNodes:function(b){var c,d=[],e=b.data;if(null===e)return[];if(e===a.TileItem.OPERATORS.PARENTHESES)return[b];for(c=0;c<b.children.length;c++)Array.prototype.push.apply(d,this._getChildParenthesesNodes(b.children[c]));return d},_cacheTakeOutCommonRelatedNodesIndices:function(b){var c,d,e,f,g,h;switch(c=a.TileItem.OPERATORS,e=b.children,f=e.length,g=b.data){case c.DIVISION:b.collectionData.set("treeNodeRef",b);case c.EQUAL:case c.ADDITION:case c.MULTIPLICATION:for(d=0;f>d;d++)this._cacheTakeOutCommonRelatedNodesIndices(e[d]);break;case c.PARENTHESES:h=e[0],e[1].data||(this._setMultipleInParenthesesForAllLeaves(h,null),this._cacheRelatedNodesIndicesInParentheses(h,b.collectionData)),this._cacheTakeOutCommonRelatedNodesIndices(h),b.collectionData.set("treeNodeRef",b);break;default:g instanceof a.TermTile&&g.set("treeNodeRef",b)}},_cacheRelatedNodesIndicesInParentheses:function(c,d){var e,f,g,h,i,j,k,l=a.TileItem.OPERATORS,m=a.CommandFactory.EXIT_CODE;if(e=c.children,c.data===l.ADDITION)k=this._cacheRelatedNodesIndicesInParenthesesForPolynomial(e),k===a.Equation.RETURN_TYPE.FAILURE?this._updateMultipleInParenthesesForLikeTerms(d,!1,!0):k===a.Equation.RETURN_TYPE.CHILDREN_EXCEED?this._setMultipleInParenthesesForAllLeaves(c,m.SIMPLIFY_TERMS_FIRST):k===a.Equation.RETURN_TYPE.LIKE_TERMS_FACTOR?this._setMultipleInParenthesesForAllLeaves(c,m.NOT_LIKE_TERMS):k===a.Equation.RETURN_TYPE.HAS_ZERO?this._setMultipleInParenthesesForAllLeaves(c,m.SIMPLIFY_TERMS_FIRST):b.hasCombinableImaginaryTerms(c)?this._updateMultipleInParenthesesForLikeTerms(d,!0,!0):this._updateMultipleInParenthesesForLikeTerms(d,!1,!1);else if(c.data===l.DIVISION&&(f=e[0],g=e[1],f.data===l.ADDITION))if(k=this._cacheRelatedNodesIndicesInParenthesesForPolynomial(f.children),k===a.Equation.RETURN_TYPE.FAILURE)this._updateMultipleInParenthesesFractionCase(c.collectionData,!0,m.SIMPLIFY_TERMS_FIRST);else if(k===a.Equation.RETURN_TYPE.CHILDREN_EXCEED)this._setMultipleInParenthesesForAllLeaves(c,m.SIMPLIFY_TERMS_FIRST);else if(k===a.Equation.RETURN_TYPE.LIKE_TERMS_FACTOR)this._setMultipleInParenthesesForAllLeaves(c,m.NOT_LIKE_TERMS);else if(k===a.Equation.RETURN_TYPE.HAS_ZERO)this._setMultipleInParenthesesForAllLeaves(c,m.SIMPLIFY_TERMS_FIRST);else for(this._checkForNegativeFactorInFractionCase(f.children),h=this._getDraggableNodesFromMonomial(g),i=0;i<h.length;i++)j=h[i].data,1===j.get("base")?j.set("multipleInParentheses",m.FACTOR_ONE_FROM_PARANTHESES):j.set("multipleInParentheses","-1")},_checkForNegativeFactorInFractionCase:function(b){var c,d,e,f,g;for(c=0;c<b.length;c++)for(e=this._getDraggableNodesFromMonomial(b[c]),d=0;d<e.length;d++)f=e[d].data,f instanceof a.TermTile&&(g=f.get("base"),("number"==typeof g&&-1>g||"string"==typeof g&&g.indexOf(a.TileItem.OPERATORS.SUBTRACTION)>-1)&&f.set("multipleInParentheses",a.CommandFactory.EXIT_CODE.NEGATIVE_NUMBER_COMMON_OUT))},_updateMultipleInParenthesesForLikeTerms:function(b,c,d){var e,f,g,h=b.get("tileArray"),i=a.TileItem.OPERATORS,j=a.CommandFactory.EXIT_CODE,k=[],l=[],m=!1;for(e=c?j.SIMPLIFY_TERMS_FIRST:j.SIMPLIFY_TERM_TAKE_COMMON,f=0;f<h.length;f++)g=h.at(f),g.get("operator")===i.ADDITION&&(m=!0),m===!0?l.push(g):k.push(g);this._matchingAllElements(k,l,e,d),this._matchingAllElements(l,k,e,d)},_matchingAllElements:function(c,d,e,f){var g,h,i;for(g=0;g<c.length;g++)if(h=c[g],b.isBasicTileType(h))if(i=h.get("multipleInParentheses"),"string"==typeof i&&f)h.set("multipleInParentheses",e);else{if("number"==typeof i)continue;this._tryFindingMatchingTermOnOtherSide(h,d,e,f)}else h.get("type")===a.TileItem.TileType.FRACTION&&this._updateMultipleInParenthesesFractionCase(h,f,e)},_updateMultipleInParenthesesFractionCase:function(b,c,d){var e,f,g,h,i=b.get("tileArray"),j=a.CommandFactory.EXIT_CODE;for(g=0;g<i.length;g++)f=i.at(g),h=f.get("base"),e=f.get("multipleInParentheses"),"string"==typeof e&&c&&f.set("multipleInParentheses",d),h/Math.abs(h)===-1&&-1!==h&&f.set("multipleInParentheses",j.NEGATIVE_NUMBER_COMMON_OUT)},_tryFindingMatchingTermOnOtherSide:function(b,c,d,e){var f,g,h=b.get("iotaExponent"),i=b.get("base"),j=b.get("squareRootProps"),k=a.CommandFactory.EXIT_CODE;if("string"!=typeof b.get("multipleInParentheses")&&"number"!=typeof b.get("multipleInParentheses")){if(i/Math.abs(i)===-1&&null===j||j&&j.isNegative)return void b.set("multipleInParentheses",k.NEGATIVE_NUMBER_COMMON_OUT);for(f=0;f<c.length;f++){if(g=c[f],h&&g.get("iotaExponent")&&g.get("base")%i===0){b.set("multipleInParentheses",d);break}if(!h&&g.get("base")%i===0&&g.get("iotaExponent")){b.set("multipleInParentheses",k.BREAK_IMAGINARY_NUMBER);break}if(j&&g.get("squareRootProps")&&j.exponent===g.get("squareRootProps").exponent&&g.get("base")%i===0&&!h){b.set("multipleInParentheses",k.ROOT_MAGNITUDE);break}}}},_setSimplifyValueInAllNumeratorTerms:function(b){var c,d,e=a.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;for(c=0;c<b.length;c++)d=b[c],d.isLeaf()?d.data.set("multipleInParentheses",e):d.data===a.TileItem.OPERATORS.MULTIPLICATION&&this._setSimplifyValueInAllNumeratorTerms(d.children)},_cacheRelatedNodesIndicesInParenthesesForPolynomial:function(c){var d,e,f,g,h,i,j,k=a.TileItem.OPERATORS,l=[];if(d=c.length,2===d){if(!(b._hasVariableTermTile(c[0],b._isVariableImaginaryTermTile)^b._hasVariableTermTile(c[1],b._isVariableImaginaryTermTile)))return a.Equation.RETURN_TYPE.LIKE_TERMS_FACTOR;if(b._hasVariableTermTile(c[0],b._isZeroTile)||b._hasVariableTermTile(c[1],b._isZeroTile))return a.Equation.RETURN_TYPE.HAS_ZERO;for(l[0]=this._getDraggableNodesFromMonomial(c[0]),l[1]=this._getDraggableNodesFromMonomial(c[1]),e=0;d>e;e++)for(g=l[e],f=0;f<g.length;f++)h=g[f],j=this._findMultiple(c[d-1-e],h),i=h.data===k.PARENTHESES?h.collectionData:h.data,j?i.set("multipleInParentheses",this.getIndexFromItemModel(j)):"number"!=typeof i.get("multipleInParentheses")&&i.set("multipleInParentheses",null);this._checkForNonDraggableNegativeOnes(l)}else if(2!==d)return a.Equation.RETURN_TYPE.CHILDREN_EXCEED;return 2===d&&b._hasVariableTermTile(c[0],b._isVariableImaginaryTermTile)^b._hasVariableTermTile(c[1],b._isVariableImaginaryTermTile)&&!(c[0].data===k.DIVISION&&c[0].children[0].data===k.ADDITION||c[1].data===k.DIVISION&&c[1].children[0].data===k.ADDITION)?a.Equation.RETURN_TYPE.SUCCESS:a.Equation.RETURN_TYPE.FAILURE},_getDraggableNodesFromMonomial:function(b){b=b||{};var c,d=[],e=a.TileItem.OPERATORS;switch(b.data){case e.ADDITION:case e.PARENTHESES:break;case e.MULTIPLICATION:case e.DIVISION:for(c=0;c<b.children.length;c++)Array.prototype.push.apply(d,this._getDraggableNodesFromMonomial(b.children[c]));
break;default:b.data instanceof a.TermTile&&d.push(b)}return d},_findMultiple:function(b,c){var d=c.data;return d===a.TileItem.OPERATORS.PARENTHESES?this._findMultipleOfParentheses(b,c):d&&d.get("type")===a.TileItem.TileType.TERM_TILE?this._findMultipleOfTermTile(b,c):!1},_checkForNonDraggableNegativeOnes:function(b){var c,d,e,f,g,h=b[0].concat(b[1]),i=function(b){return"string"!=typeof b.data&&b.data.get("type")===a.TileItem.TileType.TERM_TILE&&-1===b.data.get("base")&&!b.data.get("squareRootProps")&&!b.get("iotaExponent")},j=[];for(c=0;c<h.length;c++)i(h[c])&&j.push(h[c]);for(c=0;c<j.length;c++)for(e=j[c],d=0;d<h.length;d++)if(f=h[d],f!==e&&!i(f)&&"string"!=typeof f.data&&(g=f.data.get("multipleInParentheses"),"string"==typeof g&&g.length>0)){e.data.set("multipleInParentheses",a.CommandFactory.EXIT_CODE.MINUS_ONE_COMMON_OUT);break}},_findMultipleOfParentheses:function(c,d){var e,f,g,h=c.data,i=(d.data,a.TileItem.OPERATORS),j=null;switch(h){case i.MULTIPLICATION:for(e=0;e<c.children.length&&(j=this._findMultipleOfParentheses(c.children[e],d),null===j);e++);break;case i.DIVISION:break;case i.ADDITION:break;case i.PARENTHESES:f=c.children,g=d.children,b._compareParenthesesEqual(c,d)&&(j=c)}return j},_findMultipleOfTermTile:function(b,c,d){d=d||{};var e,f,g,h,i,j,k,l,m,n,o,p,q=b.data,r=c.data,s=a.TileItem.OPERATORS,t=!1,u=!1,v=d.specialCase;if(k=r.get("base"),1===k&&!r.get("iotaExponent"))return r.set("multipleInParentheses",a.CommandFactory.EXIT_CODE.FACTOR_ONE_FROM_PARANTHESES),!1;if(0===k)return r.set("multipleInParentheses",a.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST),!1;if(n=r.get("iotaExponent"))return!1;if(p=r.get("squareRootProps")||{},p.isNegative||!p.exponent&&!n&&"number"==typeof k&&-1>k)return!1;switch(v!==!1&&(v=-1===k&&r.get("isDenominator")),q){case s.MULTIPLICATION:for(e=0;e<b.children.length;e++)if(t=this._findMultipleOfTermTile(b.children[e],c,{update:!1}),t&&1===t.answer){u=!0,f=e;break}if(u)t=this._findMultipleOfTermTile(b.children[f],c);else for(e=0;e<b.children.length&&!(t=this._findMultipleOfTermTile(b.children[e],c));e++);break;case s.DIVISION:t=r.get("isDenominator")?this._findMultipleOfTermTile(b.children[1],c,{specialCase:!1}):this._findMultipleOfTermTile(b.children[0],c,{specialCase:!1});break;case s.PARENTHESES:case s.ADDITION:break;default:if(q instanceof a.TermTile){if(q.get("isDenominator")!==r.get("isDenominator")&&!v)return!1;if(j=q.get("base"),0===j)return r.set("multipleInParentheses",a.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST),!1;m=q.get("iotaExponent"),o=q.get("squareRootProps")||{},o.exponent&&o.exponent===p.exponent&&!m&&m===n&&j&&j===k?(l=o.isNegative^p.isNegative?-1:1,t=d.update===!1?{answer:l}:q):o.exponent||p.exponent||m||n?-1!==k||p.exponent||(t=q):"string"==typeof k&&"string"==typeof j?(g=k.indexOf(s.SUBTRACTION)>-1^j.indexOf(s.SUBTRACTION)>-1,h=j.replace(s.SUBTRACTION,""),h===k.replace(s.SUBTRACTION,"")&&(i=g?-1:1,t=d.update===!1?{answer:i}:q)):"string"==typeof j&&-1===k?t=d.update===!1?{answer:j.indexOf(s.SUBTRACTION)>-1?j.replace(s.SUBTRACTION,""):s.SUBTRACTION+j}:q:j&&j%k===0&&(l=j/k,t=d.update===!1?{answer:l}:q)}}return t},getModelFromIndex:function(a){var b,c,d=this.get("tileArray");return a?(b=a.split("."),c=parseInt(b[0],10),b.splice(0,1),d.at(c)?this.get("tileArray").at(c).getModelFromIndex(b.join(".")):null):""===a?this:null},printExpr:function(){var a=this.get("tileArray"),b=a.at(0).printExpr();return a.length>1&&(b+="\n = \n"+a.at(1).printExpr()),b},checkSimplest:function(){var a,b=this.get("tileArray"),c=b.at(0).checkSimplest();if(c===!1)return!1;if(b.length>1){if(a=b.at(1).checkSimplest(),a===!1)return!1;c+="="+a}return c},checkIfSimplestFormFractionCase:function(){var a,b=this.get("tileArray");for(a=0;a<b.length;a++)if(b.at(a).checkIfSimplestFormFractionCase()===!1)return!1;return!0},checkFractionToDecimalCase:function(){var a,b=this.get("tileArray");for(a=0;a<b.length;a++)if(b.at(a).checkFractionToDecimalCase()===!1)return!1;return!0}},{RETURN_TYPE:{SUCCESS:1,CHILDREN_EXCEED:2,FAILURE:3,LIKE_TERMS_FACTOR:4,HAS_ZERO:5},SOLVE_FRACTION_TO_DECIMAL:"solve-fraction-to-decimal"})}(),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro;b.EquationManagerPro.Utils;b.BaseCommand=a.Common.Player.Models.Base.extend({initialize:function(){},execute:function(){},undo:function(){}},{})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro,c=b.EquationManagerPro.Utils;b.CombineCommand=b.BaseCommand.extend({sourceTiles:null,destTiles:null,sourcePos:null,destPos:null,operatorChangedSP:null,sourceObj:null,destObj:null,numOfTilesInserted:0,operationPerformed:null,sourceStaticZeroAdd:!1,destStaticZeroAdd:!1,removedSingleTerm:!1,convertedToZero:null,initialize:function(){this.sourceTiles=[],this.destTiles=[]},_initializeModelAttributes:function(a,b){var d=b.source.index,e=b.source.numOfTiles,f=b.dest.index,g=b.dest.numOfTiles,h={};return this.sourceObj=b.source,this.destObj=b.dest,this.sourcePos=parseInt(c.getSourceWrtParent(d)),this.destPos=parseInt(c.getSourceWrtParent(f)),h.sourceParent=a.getModelFromIndex(c.getParentIndex(d)),h.destParent=a.getModelFromIndex(c.getParentIndex(f)),this._populateConcernedTilesArray(h.sourceParent.get("tileArray"),e,"source"),this._populateConcernedTilesArray(h.destParent.get("tileArray"),g,"dest"),h},_populateConcernedTilesArray:function(a,b,c){var d;for(d=0;b>d;d++)this[c+"Tiles"].push(a.at(this[c+"Pos"]+d))},execute:function(a,c,d){var e=this._initializeModelAttributes(c,d),f=b.TileItem.OPERATORS,g={};return this.isIotaPresent=a.isIotaAllowed,this.fractionToDecimalAllowed=a.fractionToDecimalAllowed,null==e.sourceParent||null==e.destParent?!1:(g=this._getCommonNodeObject(d.root),-1!==[f.ADDITION,f.EQUAL].indexOf(g.commonParent.data)?(this.operationPerformed=f.ADDITION,this._performAddition(d.root,e,g,c)):-1!==[f.MULTIPLICATION].indexOf(g.commonParent.data)?(this.operationPerformed=f.MULTIPLICATION,this._performMultiplication(d.root,e,g,c)):-1!==[f.DIVISION].indexOf(g.commonParent.data)?(this.operationPerformed=f.MULTIPLICATION,this._performDivision(d.root,c,e,g)):b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST)},_getCommonNodeObject:function(a){var b,d,e,f,g;return b=c.tilesToNodes(a,this.sourceTiles),d=c.tilesToNodes(a,this.destTiles),e=c.getCommonParentFromMultiple(b),f=c.getCommonParentFromMultiple(d),g=c.getCommonParent(e,f),{sourceCommon:e,destCommon:f,commonParent:g}},_performDivision:function(a,d,e,f){var g=f.sourceCommon,h=f.destCommon,i=c.getOperatorStringsBetween(g,h),j=b.TileItem.OPERATORS;return-1!==i.indexOf(j.PARENTHESES)||e.sourceParent!==e.destParent?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:this.sourceTiles[0].get("isDenominator")===!1?!1:g.isLeaf()===!1?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:h.isLeaf()?this._performTermMultiplication(e,d):this._performEasterEggDivision(a,e,g,h)},_performEasterEggDivision:function(a,c,d,e){var f,g=a.collectionData,h=(c.sourceParent.get("tileArray"),this.sourceTiles[0]),i=[],j=(b.TileItem.OPERATORS,h.get("base"));return i=this._getDivisibilityInNumerator(j),0===i.length?this._emulateTakeCommonOut(a,c,d):(f=this._getFractionAfterDivision(c.sourceParent,i,j),this._updateParentCollection(g,c.sourceParent,[f],1,0),!0)},_emulateTakeCommonOut:function(a,c,d){var e,f,g,h,i=a.collectionData,j=d.data,k=[],l=b.TileItem.OPERATORS,m=[];return e=this._getFractionNodeFromChild(d),f=e.parent.data===l.PARENTHESES?e.parent:null,f?(h=f.collectionData.deepClone(),k=this._getCoeffTiles(f),0===k.length?(m=this._makeFractionTile(j,h),this._updateParentCollection(i,c.sourceParent,m,2,0),!0):k[0].data===l.DIVISION?(m=this._insertInTileFraction(k[0],j),g=this._updateFractionTile(h.get("tileArray").at(0)),m.push(h),this._updateParentCollection(i,c.sourceParent,m,2,k.length),!0):(m=this._convertCoeffToFraction(k,j),g=this._updateFractionTile(h.get("tileArray").at(0)),m.push(h),this._updateParentCollection(i,c.sourceParent,m,2,k.length),!0)):(g=e.collectionData.deepClone(),h=this._wrapFractionIsideParentheses(g,j),m=this._makeFractionTile(j,h),this._updateParentCollection(i,c.sourceParent,m,1,0),!0)},_wrapFractionIsideParentheses:function(a,b){var c;return c=this._createParenthesesTile(a.get("operator"),a.get("isLHS")),a.set("operator",null),c.set("tileArray",new Backbone.Collection([a])),c},_insertInTileFraction:function(a,c){var d,e,f,g=b.TileItem.OPERATORS;return d=a.collectionData.deepClone(),e=d.get("tileArray"),f=c.deepClone(),f.set("operator",g.MULTIPLICATION),e.add(f),[d]},_makeFractionTile:function(a,c){var d,e,f,g,h,i=b.TileItem.OPERATORS,j=[];return e=c.get("operator"),f=c.get("isLHS"),d=this._createFractionTile(e,f),j.push(this._createTermTile(1,null,f,!1)),h=a.deepClone(),h.set("operator",null),j.push(h),d.set("tileArray",new Backbone.Collection(j)),j=[d],c.set("operator",i.MULTIPLICATION),g=this._updateFractionTile(c.get("tileArray").at(0)),j.push(c),j},_updateFractionTile:function(a){var b,c,d=a.get("tileArray");return b=d.at(this.sourcePos),(c=d.at(this.sourcePos+1))&&c&&c.set("operator",b.get("operator")),d.remove(b),a},_convertCoeffToFraction:function(a,c){var d,e,f,g,h,i=[],j=[],k=b.TileItem.OPERATORS,l=_.isString(a[0].data)?a[0].collectionData:a[0].data,m=[];for(f=l.get("operator"),g=l.get("isLHS"),d=0;d<a.length;d++)a[d].data===k.PARENTHESES?j.push(a[d]):i.push(a[d]);for(e=this._createFractionTile(f,g),d=0;d<i.length;d++)m.push(i[d].data.deepClone());for(0===m.length?m.push(this._createTermTile(1,null,g,!1)):m[0].set("operator",null),h=c.deepClone(),h.set("operator",null),m.push(h),e.set("tileArray",new Backbone.Collection(m)),m=[e],d=0;d<j.length;d++)h=j[d].collectionData.deepClone(),h.set("operator",k.MULTIPLICATION),m.push(h);return m},_getCoeffTiles:function(a){var c,d=a.parent,e=[],f=d.children,g=b.TileItem.OPERATORS.MULTIPLICATION,h=f.indexOf(a);if(d.data===g)for(c=0;h>c;c++)e.push(f[c]);return e},_getFractionNodeFromChild:function(a){for(var c=a.parent,d=b.TileItem.OPERATORS.DIVISION;c.data!==d;)c=c.parent;return c},_getFractionAfterDivision:function(a,b,c){var d,e,f,g,h=a.deepClone(),i=h.get("tileArray");for(e=i.at(this.sourcePos),(f=i.at(this.sourcePos+1))&&f&&f.set("operator",e.get("operator")),i.remove(e),d=0;d<b.length;d++)e=i.at(b[d]),g=e.get("base"),_.isString(g)?-1===c&&e.set("base",this._invertVariable(g)):e.set("base",g/c);return h},_getDivisibilityInNumerator:function(a){var c,d,e,f,g=[],h=this.destTiles,i=b.TileItem.OPERATORS,j=!1,k=!1,l=!1;for(c=0;c<h.length;){if(0!==c&&j===!1)return[];j=!1,k=!1,l=!1;do k!==!0?(d=h[c],e=d.get("operator"),f=d.get("base"),f===a?(j&&(g.pop(),j=!1),k=!0):Math.abs(f)===Math.abs(a)&&(j&&(g.pop(),j=!1),l=!0),(f%a===0||1===Math.abs(a)&&_.isString(f))&&j===!1&&(g.push(c),j=!0),c++):c++;while(h[c]&&h[c].get("operator")===i.MULTIPLICATION);if(j===!1)return[]}return g},_performMultiplication:function(a,d,e,f){var g,h,i=e.sourceCommon,j=e.destCommon,k=c.getOperatorStringsBetween(i,j),l=b.TileItem.OPERATORS;return-1!==k.indexOf(l.PARENTHESES)||-1!==k.indexOf(l.ADDITION)?!1:i.isLeaf()&&j.isLeaf()?this._performTermMultiplication(d,f):i.isLeaf()&&j.data===l.PARENTHESES?this._performTermParenthesesMultiplication(d,i,j):i.data===l.PARENTHESES&&j.data===l.PARENTHESES?this._performTwoParenthesesMultiplication(d,i,j):!j.isLeaf()&&j.data!==l.DIVISION||i.data!==l.PARENTHESES?i.data===l.MULTIPLICATION&&j.data===l.PARENTHESES?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:i.data===l.DIVISION&&j.data===l.PARENTHESES?(g=i.children[0],h=i.children[1],g.isLeaf()&&h.isLeaf()?this._performFractionParenthesesMultiplication(d,i,j):b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST):this.isIotaPresent?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:this._returnFeedbackForNonFractionVariableCase(this.sourceTiles):b.CommandFactory.EXIT_CODE.APPLY_COEFFECIENTS},_performTwoParenthesesMultiplication:function(a,d,e){var f,g,h,i,j=a.sourceParent.get("tileArray"),k=a.destParent.get("tileArray"),l=this.sourceTiles[0],m=this.destTiles[0],n=b.TileItem.OPERATORS,o=[],p=!1;if(j!==k||c._hasVariableTermTile(d,c._isVariableTermTile)||c._hasVariableTermTile(e,c._isVariableTermTile))return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;for(p=this._checkToAddParentheses(e,m.get("isLHS")),g=l.deepClone(),f=g.get("tileArray"),i=0;i<f.length;i++){for(o.push(f.at(i));f.at(i+1)&&f.at(i+1).get("operator")!==n.ADDITION;)i++,o.push(f.at(i));h=m.deepClone(),h.set("operator",n.MULTIPLICATION),o.push(h)}return p?(p.set("tileArray",new Backbone.Collection(o)),this._updateCollection(a.sourceParent,a.destParent,[p])):(this._validateAndChangeOperators(l,m,o,j),this._updateCollection(a.sourceParent,a.destParent,o)),!0},_checkToAddParentheses:function(a,c){var d=a.parent,e=b.TileItem.OPERATORS;return d.children.length>2?this._createParenthesesTile(e.MULTIPLICATION,c):!1},_performFractionParenthesesMultiplication:function(a,c,d){var e,f,g=a.sourceParent,h=g.get("tileArray"),i=a.destParent.get("tileArray"),j=c.children[0],k=c.children[1],l=j.data,m=(k.data,this.sourceTiles[0]),n=this.destTiles[0],o=(b.TileItem.OPERATORS,d.children[0],[]);return 0===l.get("base")?(f=l.deepClone(),f.set({operator:n.get("operator"),isLHS:n.get("isLHS"),iotaExponent:null}),o=this._validateAndChangeOperators(m,n,[l],h),this._updateCollection(a.sourceParent,a.destParent,o),!0):(e=n.deepClone(),f=m.deepClone(),e=this._applyTermInsideBigTermWithFraction(f.get("tileArray").at(1),e),e=this._applyTermInsideBigTerm(f.get("tileArray").at(0),e),o=[e],h===i&&(o=this._validateAndChangeOperators(m,n,o,h)),this._updateCollection(a.sourceParent,a.destParent,o),!0)},_performTermParenthesesMultiplication:function(a,c,d){var e,f,g=a.sourceParent,h=g.get("tileArray"),i=a.destParent.get("tileArray"),j=this.sourceTiles[0],k=this.destTiles[0],l=(b.TileItem.OPERATORS,d.children[0],[]);if(0===j.get("base"))return l=this._performMultiplicationWithZeroBase(j,k,!1),l=this._validateAndChangeOperators(j,k,l,h),this._updateCollection(a.sourceParent,a.destParent,l),!0;if(e=k.deepClone(),f=j.deepClone(),j.get("isDenominator")===!1){if(l.push(this._applyTermInsideBigTerm(f,e)),h===i)l=this._validateAndChangeOperators(j,k,l,h);else{if(g.get("type")!==b.TileItem.TileType.FRACTION)return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;this._validateAndChangeOperatorsFractionCase(h,this.sourcePos)}return this._updateCollection(a.sourceParent,a.destParent,l),!0}return l.push(this._applyTermInsideBigTermWithFraction(f,e)),this._validateAndChangeOperatorsFractionCase(h,this.sourcePos),this._updateCollection(a.sourceParent,a.destParent,l),!0},_applyTermInsideBigTermWithFraction:function(a,b){var c=b.get("tileArray");return c=this._convertAllTilesToFraction(c,a),b.set("tileArray",c),b},_convertAllTilesToFraction:function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o=[],p=[],q=!1,r=[],s=[],t=[];for(-1===c.get("base")&&(q=!0),d=0;d<a.length;)if(p=[],r=[],s=[],t=[],f=a.at(d),f.get("type")===b.TileItem.TileType.FRACTION)h=f.get("tileArray"),p=h.where({isDenominator:!0}),Array.prototype.push.apply(o,this._getIndexOperatorOfTile(h,q,h.length-p.length)),d++;else{if(f.get("operator")===b.TileItem.OPERATORS.MULTIPLICATION){d++;continue}for(r=this._getMultiplicativeGroup(a,d),a.remove(r),s=this.getParenthesesIndex(r),e=s.length-1;e>=0;e--)Array.prototype.push.apply(t,r.splice(s[e],1));t.reverse(),g=r[0]?this._createFractionTile(r[0].get("operator"),r[0].get("isLHS")):this._createFractionTile(t[0].get("operator"),t[0].get("isLHS")),0===r.length?(r.push(this._createTermTile(1,null,c.get("isLHS"),!1)),t[0].set("operator",b.TileItem.OPERATORS.MULTIPLICATION)):r[0].set("operator",null),g.set("tileArray",new Backbone.Collection(r)),a.add(g,{at:d}),d++,a.add(t,{at:d}),d+=t.length,o.push(r.length,null,!1)}for(d=a.length-1;d>=0;d--)j=a.at(d),j.get("type")===b.TileItem.TileType.FRACTION&&(i=a.at(d).get("tileArray"),n=o.pop(),k=o.pop(),l=o.pop(),m=c.deepClone(),n&&(m=this._negateTerm(m)),m.set("operator",k),i.add(m,{at:l}));return a},getParenthesesIndex:function(a){var c,d,e=b.TileItem.TileType,f=[];for(d=0;d<a.length;d++)c=a[d],c.get("type")===e.PARENTHESES&&f.push(d);return f},_getMultiplicativeGroup:function(a,c){var d=c,e=[];for(e.push(a.at(c)),d++;a.at(d)&&a.at(d).get("operator")===b.TileItem.OPERATORS.MULTIPLICATION;)e.push(a.at(d)),d++;return e},_getIndexOperatorOfTile:function(a,c,d){var e,f,g,h,i=[],j=b.TileItem.OPERATORS,k=!1,l=!1;for(e=d;e<a.length;e++)f=a.at(e),null===f.get("operator")&&(i.push(e,f.get("operator"),!1),f.set("operator",j.MULTIPLICATION),l=!1,k=!1),c===!0&&-1===f.get("base")&&k===!1&&(l&&a.add(h,{at:g}),l=!0,k=!0,a.remove(f),e-=1,i.pop(),i.push(!0)),1===f.get("base")&&l===!1&&(a.remove(f),g=e,h=f,e-=1,l=!0);return i},_applyTermInsideBigTerm:function(a,d){var e,f,g,h,i,j,k,l,m,n,o=d.get("tileArray"),p="string"==typeof a.get("base"),q=[],r=b.TileItem.OPERATORS,s=!1,t=!1,u=!1,v=[];if(1===a.get("base")&&null===a.get("iotaExponent")&&null===a.get("squareRootProps"))return d;for(-1===a.get("base")&&null===a.get("iotaExponent")&&null===a.get("squareRootProps")&&(u=!0),f=0;f<o.length;f++){if(g=o.at(f),g.get("isDenominator")!==a.get("isDenominator")){p&&q.push(f,r.MULTIPLICATION,!1);break}p&&g.get("operator")===r.ADDITION&&c.isBasicTileType(o.at(f-1))&&q.push(f,r.MULTIPLICATION,!1),g.get("type")===b.TileItem.TileType.FRACTION?(o.remove(g),e=this._applyTermInsideBigTerm(a,g),o.add(e,{at:f})):((null===g.get("operator")||g.get("operator")===r.ADDITION)&&(p||(q.push(f,g.get("operator"),!1),g.set("operator",r.MULTIPLICATION)),s=!1,t=!1),u===!0&&-1===g.get("base")&&t===!1&&null===g.get("iotaExponent")&&null===a.get("squareRootProps")&&(s&&o.add(j,{at:i}),s=!0,t=!0,q.pop(),o.remove(g),f-=1,q.push(!0)),1===g.get("base")&&null===g.get("iotaExponent")&&s===!1&&(p?v.push(g):(o.remove(g),i=f,j=g,f-=1),s=!0),p&&f+1>=o.length&&q.push(f+1,r.MULTIPLICATION,!1))}for(;q.length>0;)m=q.pop(),l=q.pop(),k=q.pop(),h=a.deepClone(),m&&(h=this._negateTerm(h)),h.set("operator",l),o.add(h,{at:k});for(f=0;f<v.length;f++)g=v[f],n=o.indexOf(g),o.at(n+1).set("operator",g.get("operator")),o.remove(g);return d.set("tileArray",o),d},_negateTerm:function(a){if(c.isBasicTileType(a)){var d,e,f=a.get("base");return(e=a.get("squareRootProps"))||e?(e=$.extend(!0,{},e),e.isNegative=!e.isNegative,a.set("squareRootProps",e),a):(d=_.isString(f)?this._invertVariable(f):-1*f,a.set("base",d),a)}if(a.get("type")===b.TileItem.TileType.FRACTION){var g=a.get("tileArray"),h=g.at(0);return h=this._negateTerm(h),a}},_performTermMultiplication:function(a,c){var d,e,f=a.sourceParent.get("tileArray"),g=a.destParent.get("tileArray"),h=this.sourceTiles[0],i=this.destTiles[0],j=h.get("base"),k=i.get("base"),l=h.get("squareRootProps"),m=i.get("squareRootProps"),n=[],o=[],p=null,q=null;if(f!==g)return!1;if(0===j||0===k)n=this._performMultiplicationWithZeroBase(h,i,!0);else if(null===l&&null!==m||null!==l&&null===m){if(n=this._checkRootTermMultiplicationWithOneTile(h,i),0===n.length)return!1}else if(null!==l){if(o=this._getBasesAfterSquareRootMultiplication(h,i),0===o.length)return b.CommandFactory.EXIT_CODE.SIMPLIFY_IMAGINARY_NUMBER;p=(h.get("iotaExponent")||0)+(i.get("iotaExponent")||0),d=i.deepClone(),q=l.isNegative!==m.isNegative?{isNegative:!0,exponent:l.exponent}:{isNegative:!1,exponent:l.exponent},d.set("squareRootProps",q),d.set("base",o[0]),d.set("iotaExponent",p||null),n.push(d)}else if(null!==h.get("iotaExponent")&&null!==i.get("iotaExponent")){if(n=this._getBasesAfterIotaMultiplication(h,i),0===n.length)return!1}else{if(h.get("isDenominator")===i.get("isDenominator")&&"string"==typeof j&&"number"==typeof k&&1===Math.abs(k))return e=this.sourceTiles,this.sourceTiles=this.destTiles,this.destTiles=e,e=this.sourcePos,this.sourcePos=this.destPos,this.destPos=e,this._performTermMultiplication(a);if(o=this._performMathMultiplication(h.get("isDenominator"),j,i.get("isDenominator"),k,c),0===o.length)return!1;if(this._checkMaxValueCondition(o))return b.CommandFactory.EXIT_CODE.MAX_VALUE_REACHED;n=this._getClonedModels(o,i),((p=h.get("iotaExponent")||i.get("iotaExponent"))||p)&&n[0].set("iotaExponent",p)}return n=this._validateAndChangeOperators(h,i,n,f),this._updateCollection(a.sourceParent,a.destParent,n,c),!0},_performMultiplicationWithZeroBase:function(a,b,c){var d,e=a.get("iotaExponent"),f=b.get("iotaExponent"),g=null;return"undefined"==typeof f&&(f=0),"undefined"==typeof e&&(f=0),(e||f)&&(g=e+f),0===a.get("base")?(d=a.deepClone(),d.set({operator:b.get("operator"),isLHS:b.get("isLHS"),iotaExponent:null}),[d]):c===!0?(d=b.deepClone(),d.set("iotaExponent",null),[d]):[]},_validateAndChangeOperators:function(a,c,d,e){var f=a.get("operator");if(f===b.TileItem.OPERATORS.ADDITION||null===f)if(this.sourcePos===this.destPos-1)d[0].set("operator",f);else{var g=e.at(this.sourcePos+1);g&&(this.operatorChangedSP=g.get("operator"),g.set("operator",f))}return d},_validateAndChangeOperatorsFractionCase:function(a,c){var d,e=a.at(c),f=e.get("operator");(f===b.TileItem.OPERATORS.ADDITION||null===f)&&(d=a.at(c+1),d&&d.get("isDenominator")===e.get("isDenominator")&&(this.operatorChangedSP=d.get("operator"),d.set("operator",f)))},_checkRootTermMultiplicationWithOneTile:function(a,b){var c,d=a.get("squareRootProps"),e=b.get("squareRootProps"),f=a.get("base"),g=b.get("base"),h=(a.get("iotaExponent")||0)+(b.get("iotaExponent")||0),i=null;return 1===Math.abs(f)&&null===d?(c=b.deepClone(),i={isNegative:1===f?e.isNegative:!e.isNegative,exponent:e.exponent},c.set("squareRootProps",i),c.set("iotaExponent",h||null),[c]):1===Math.abs(g)&&null===e?(c=a.deepClone(),i={isNegative:1===g?d.isNegative:!d.isNegative,exponent:d.exponent},c.set("squareRootProps",i),c.set("iotaExponent",h||null),c.set("operator",b.get("operator")),[c]):[]},_getBasesAfterSquareRootMultiplication:function(a,b){var c=a.get("squareRootProps"),d=b.get("squareRootProps"),e=c.exponent,f=d.exponent;return e!==f||a.get("base")<0||b.get("base")<0?[]:this._performMathMultiplication(!1,a.get("base"),!1,b.get("base"))},_getBasesAfterIotaMultiplication:function(a,b){var c,d,e=a.get("base"),f=b.get("base"),g=[];return g=this._performMathMultiplication(a.get("isDenominator"),e,b.get("isDenominator"),f),0===g.length?[]:(c=a.get("iotaExponent")+b.get("iotaExponent"),d=b.deepClone(),d.set({iotaExponent:c,base:g[0]}),[d])},_performMathMultiplication:function(a,b,c,d,e){var f=[];return a===c?_.isNumber(b)&&_.isNumber(d)?f.push(b*d):1===Math.abs(b)&&_.isString(d)?f.push(-1===b?this._invertVariable(d):d):1===Math.abs(d)&&_.isString(b)?f.push(-1===d?this._invertVariable(b):b):(0===b||0===d)&&f.push(0):a===!0&&(0===d?f.push(0):d%b===0||this.fractionToDecimalAllowed&&(!_.isString(b)||!_.isString(d))&&this._fractionToDecimalCase(e)?f.push(d/b):_.isString(b)&&_.isString(d)?b===d?f.push(1):f.push(-1):1===Math.abs(b)&&_.isString(d)&&f.push(-1===b?this._invertVariable(d):d)),f},_fractionToDecimalCase:function(a){var c=0,d=a.get("tileArray");for(c;c<d.length;c++)if(d.at(c).get("tileArray").length>1)return!1;var e=d.at(0).get("tileArray").at(0),f=d.at(1).get("tileArray").at(0);if(e.get("type")===b.TileItem.TileType.TERM_TILE&&"t"===e.get("base")){if(f.get("type")===b.TileItem.TileType.FRACTION&&2===f.get("tileArray").length)return!0}else if(e.get("type")===b.TileItem.TileType.FRACTION&&2===e.get("tileArray").length&&f.get("type")===b.TileItem.TileType.TERM_TILE&&"t"===f.get("base"))return!0},_invertVariable:function(a){var c=b.TileItem.OPERATORS;return-1!==a.indexOf(c.SUBTRACTION)?a.replace(c.SUBTRACTION,""):c.SUBTRACTION+a},_checkToGiveBinMulFeedback:function(a,c,d){var e,f=a.sourceParent;return f.get("type")!==b.TileItem.TileType.PARENTHESES?(e=c.parent,this._checkWhetherAdditionOperatorExists(e)===!1?!1:(e=d.parent,this._checkWhetherAdditionOperatorExists(e)===!1?!1:b.CommandFactory.EXIT_CODE.DIVIDE_ON_OTHER_SIDE)):!1},_checkWhetherAdditionOperatorExists:function(a){for(var c=!1,d=b.TileItem.OPERATORS;a.data!==d.EQUAL;){if(a.data===d.ADDITION){c=!0;break}a=a.parent}return c===!0?!1:!0},_performAddition:function(a,d,e,f){var g=e.sourceCommon,h=e.destCommon,i=b.TileItem.OPERATORS,j=c.getOperatorStringsBetween(g,h);if(-1!==j.indexOf(i.PARENTHESES)||-1!==j.indexOf(i.DIVISION)||-1!==j.indexOf(i.MULTIPLICATION))return e.commonParent.data===i.EQUAL&&-1===j.indexOf(i.PARENTHESES)?this._checkToGiveBinMulFeedback(d,g,h):!1;if(g.data===i.MULTIPLICATION&&g.children.length!==this.sourceTiles.length)return e.commonParent.data===i.EQUAL?this._checkToGiveBinMulFeedback(d,g,h):!1;if(g.data===i.ADDITION)return!1;if(g.isLeaf()){if(h.isLeaf())return this._performTermAddition(d,f);if(h.data===i.MULTIPLICATION)return this._performTermMultiplicativeAddition(d,h);if(h.data===i.DIVISION)return this._performTermFractionAddition(d)}if(h.isLeaf()){if(g.data===i.MULTIPLICATION)return this._performMultiplicativeTermAddition(d,g);if(g.data===i.DIVISION)return this._performFractionAdditionWithTerm(d,g)}if(g.data===i.MULTIPLICATION){if(h.data===i.MULTIPLICATION)return this._performMultiplicationAddition(d,g,h);if(h.data===i.DIVISION)return this._returnFeedbackForNonFractionVariableCase(this.sourceTiles)}if(g.data===i.DIVISION){if(h.data===i.DIVISION)return this._performOnlyFractionAddition(d,g,h);if(h.data===i.MULTIPLICATION)return this._performFractionAdditionWithTerm(d,g)}return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST},_performOnlyFractionAddition:function(a,b,c,d){var e=b.children[1],f=c.children[1];return e.isLeaf()&&f.isLeaf()?e.data.get("base")===f.data.get("base")?this._addFractionNumerators(a,b,c,d):d===!0?-1:this._getFeedbackForFractionCase(b):this._getFeedbackForFractionCase(b)},_addFractionNumerators:function(a,c,d,e){var f=c.children[0],g=d.children[0],h=d.children[1].data,i=b.TileItem.OPERATORS;if(f.isLeaf()){if(g.isLeaf())return this._performFractionTermAddition(a,f.data,g.data,h,e);if(g.data===i.MULTIPLICATION)return this._performTermMultiplicativeFractionAddition(a,f.data,g,h,e)}else if(g.isLeaf()){if(f.data===i.MULTIPLICATION)return this._performMultiplicativeTermFractionAddition(a,f,g.data,h,e)}else if(g.data===i.MULTIPLICATION&&f.data===i.MULTIPLICATION)return this._performMultiplicationFractionAddition(a,f,g,h,e)},_performMultiplicationFractionAddition:function(a,c,d,e,f){if(c.children.length>2||c.areChildrenLeafNodes()===!1)return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;if(d.children.length>2||d.areChildrenLeafNodes()===!1)return this._getFeedbackForFractionCase(c.parent);var g,h=c.children[0].data,i=c.children[1].data,j=d.children[0].data,k=d.children[1].data,l=i.get("base"),m=k.get("base"),n=b.TileItem.OPERATORS,o=[],p=[];return _.isString(l)?_.isString(m)?(g=this._createFractionTile(this.destTiles[0].get("operator"),this.destTiles[0].get("isLHS")),l.replace(n.SUBTRACTION,"")!==m.replace(n.SUBTRACTION,"")?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:(o=this._getBasesAfterNegationOfVariables(h.get("base"),l,h.get("isLHS"),j.get("base"),m,j.get("isLHS")),0===o.length?!1:this._checkMaxValueCondition(o)?b.CommandFactory.EXIT_CODE.MAX_VALUE_REACHED:(p=this._getClonedModels(o,j,j.get("operator")),p.push(e.deepClone()),g.set("tileArray",new Backbone.Collection(p)),f===!0?g:(this._updateCollection(a.sourceParent,a.destParent,[g]),!0)))):!1:b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST},_performMultiplicativeTermFractionAddition:function(a,c,d,e,f){if(c.children.length>2||c.areChildrenLeafNodes()===!1)return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;var g,h=c.children[0].data,i=c.children[1].data,j=d.get("base"),k=i.get("base"),l=b.TileItem.OPERATORS,m=[],n=[];if(!_.isString(k))return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;if(g=this._createFractionTile(this.destTiles[0].get("operator"),this.destTiles[0].get("isLHS")),_.isString(j)){if(j.replace(l.SUBTRACTION,"")!==k.replace(l.SUBTRACTION,""))return b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS;if(m=this._getBasesAfterNegationOfVariables(h.get("base"),k,h.get("isLHS"),1,j,d.get("isLHS")),0===m.length)return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;if(this._checkMaxValueCondition(m))return b.CommandFactory.EXIT_CODE.MAX_VALUE_REACHED;n=this._getClonedModels(m,d,d.get("operator"))}else n=this._joinTermsOfNumerators([h,i],h.get("isLHS"),[d],d.get("isLHS"));return n.push(e.deepClone()),g.set("tileArray",new Backbone.Collection(n)),f===!0?g:(this._updateCollection(a.sourceParent,a.destParent,[g]),!0)},_performTermMultiplicativeFractionAddition:function(a,c,d,e,f){if(d.children.length>2||d.areChildrenLeafNodes()===!1)return!1;var g,h=d.children[0].data,i=d.children[1].data,j=c.get("base"),k=i.get("base"),l=b.TileItem.OPERATORS,m=[],n=[];if(!_.isString(k))return!1;if(g=this._createFractionTile(this.destTiles[0].get("operator"),this.destTiles[0].get("isLHS")),_.isString(j)){if(j.replace(l.SUBTRACTION,"")!==k.replace(l.SUBTRACTION,""))return b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS;if(m=this._getBasesAfterNegationOfVariables(1,j,c.get("isLHS"),h.get("base"),k,h.get("isLHS")),0===m.length)return b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS;if(this._checkMaxValueCondition(m))return b.CommandFactory.EXIT_CODE.MAX_VALUE_REACHED;n=this._getClonedModels(m,h,null)}else n=this._joinTermsOfNumerators([c],c.get("isLHS"),[h,i],h.get("isLHS"));return n.push(e.deepClone()),g.set("tileArray",new Backbone.Collection(n)),f===!0?g:(this._updateCollection(a.sourceParent,a.destParent,[g]),!0)},_joinTermsOfNumerators:function(a,c,d,e){var f,g,h=[];for(g=0;g<a.length;g++)f=a[g].deepClone(),c!==e&&(0===g&&(f=this._negateTerm(f)),f.set("isLHS",e)),h.push(f);for(g=0;g<d.length;g++)f=d[g].deepClone(),0===g&&f.set("operator",b.TileItem.OPERATORS.ADDITION),h.push(f);return h},_performFractionTermAddition:function(a,b,c,d,e){var f,g=this.destTiles[0],h=b.get("base"),i=c.get("base"),j=[],k=[];return f=this._createFractionTile(g.get("operator"),g.get("isLHS")),typeof h==typeof i?(j=this._performMathAddition(b.get("isLHS"),h,c.get("isLHS"),i),k=this._getClonedModels(j,c,null)):k=this._joinTermsOfNumerators([b],b.get("isLHS"),[c],c.get("isLHS")),k.push(d.deepClone()),f.set("tileArray",new Backbone.Collection(k)),e===!0?f:(this._updateCollection(a.sourceParent,a.destParent,[f]),!0)},_joinTwoFractionsAndApplyParentheses:function(a,c){var d,e,f,g=a.get("isLHS"),h=c.get("isLHS"),i=a.deepClone(),j=c.deepClone(),k=b.TileItem.OPERATORS.ADDITION;return d=this._createParenthesesTile(k,h),f=d.get("tileArray"),g!==h&&(e=i.get("tileArray").at(0),e.set("base",-1*e.get("base"))),i.set("operator",null),j.set("operator",k),f.add([i,j]),d},_performTermFractionAddition:function(a){var c,d=(b.TileItem.OPERATORS,this.sourceTiles[0]),e=d.get("base");return 0===e?(c=this._performSeveralTileAdditionWithZeroBase([d],this.destTiles),this._updateCollection(a.sourceParent,a.destParent,c),!0):!1},_performFractionAdditionWithTerm:function(a,b){var c,d=this.destTiles[0],e=d.get("base");return 0===e?(c=this._performSeveralTileAdditionWithZeroBase(this.sourceTiles,[d]),this._updateCollection(a.sourceParent,a.destParent,c),!0):this._getFeedbackForFractionCase(b)},_getFeedbackForFractionCase:function(a){var d=a.children[1],e=a.children[0],f=b.TileItem.OPERATORS,g=2;return d.isLeaf()?e.data===f.MULTIPLICATION?(c._hasVariableTermTile(e,c._isVariableTermTile)&&(g=3),e.children.length>=g?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:!1):!1:b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST},_performMultiplicationAddition:function(a,d,e){if(d.children.length>2||d.children.length!==e.children.length)return this._returnAppropriateFeedbackMultipleChildrenCase(this.sourceTiles,this.destTiles);var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=b.TileItem.OPERATORS,B=[],C=[],D=[];if(d.areChildrenLeafNodes()&&e.areChildrenLeafNodes()){if(k=this._setCommutativeTilesInOrder(d),l=this._setCommutativeTilesInOrder(e),"number"==typeof k||"number"==typeof l)return this._returnAppropriateFeedbackString(k,l);if(g=k["var"],f=k.coeff,i=l["var"],h=l.coeff,p=i.get("base"),q=g.get("base"),g&&i)return _.isString(q)&&_.isString(p)?q.replace(A.SUBTRACTION,"")!==p.replace(A.SUBTRACTION,"")&&f!==A.PARENTHESES&&h!==A.PARENTHESES?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:(D=this._getBasesAfterNegationOfVariables(f.get("base"),q,f.get("isLHS"),h.get("base"),p,h.get("isLHS")),
0===D.length?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:this._checkMaxValueCondition(D)?b.CommandFactory.EXIT_CODE.MAX_VALUE_REACHED:(C=this._getClonedModels(D,h),this._updateCollection(a.sourceParent,a.destParent,C),!0)):this._checkIotaSame(g,i,!0)&&this._checkSquareRootsSame(g,i,!1)?(D=this._getBasesAfterIotaAddition(f.get("base"),f.get("isLHS"),g,h.get("base"),h.get("isLHS"),i),0===D.length?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:(y=h.get("operator")===A.MULTIPLICATION?i.get("operator"):h.get("operator"),C=this._getClonedModels(D,h,y),0!==D[0]&&(j=i.deepClone(),j.set("operator",A.MULTIPLICATION),this._checkToNegateCoeffs(g,i)&&((z=j.get("squareRootProps"))||z?(z=$.extend(!0,{},z),z.isNegative=!1,j.set("squareRootProps",z)):j.set("base",Math.abs(j.get("base")))),C.push(j)),this._updateCollection(a.sourceParent,a.destParent,C),!0)):this._checkSquareRootsSame(g,i,!0)&&this._checkIotaSame(f,h,!1)?f.get("iotaExponent")!==h.get("iotaExponent")?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:(v=this._checkToNegateCoeffs(g,i),D=this._getBasesAfterSquareRootAddition(f.get("base"),f.get("isLHS"),g,h.get("base"),h.get("isLHS"),i,v),0===D.length?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:(C=this._getClonedModelsForSquareRoot(D[0],h,i,!1,v),this._updateCollection(a.sourceParent,a.destParent,C),!0)):_.isString(p)||_.isString(q)?this._returnFeedbackForNonFractionVariableCase(this.sourceTiles):this._returnAppropriateFeedbackMultipleChildrenCase(this.sourceTiles,this.destTiles)}else{if((B=this._checkParenthesesTermTileCombination(d,e))&&0!==B.length){if(f=d.children[B[0]],g=d.children[B[1]],h=e.children[B[2]],i=e.children[B[3]],n=f.data.get("base"),o=h.data.get("base"),r=f.data.get("iotaExponent"),s=h.data.get("iotaExponent"),t=f.data.get("squareRootProps"),u=h.data.get("squareRootProps"),0===n)return C=this._performSeveralTileAdditionWithZeroBase([f],this.destTiles),this._updateCollection(a.sourceParent,a.destParent,C),!0;if(0===o)return C=this._performSeveralTileAdditionWithZeroBase(this.sourceTiles,[this.destTiles[0]]),this._updateCollection(a.sourceParent,a.destParent,C),!0;if(c._compareParenthesesEqual(g,i)===!1)return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;if(_.isString(n)&&_.isNumber(o)||_.isString(o)&&_.isNumber(n))m=this._performNumberStringAddition(f.data,h.data,!0),j=i.collectionData.deepClone(),j.set("operator",A.ADDITION),C.push(j,m);else if(t&&t.exponent||u&&u.exponent)m=this._performNumberRootAddition(f.data,h.data,!0),j=i.collectionData.deepClone(),C.push(m,j);else if(r!==s)m=this._performNumberIotaAddition(f.data,h.data,!0),j=i.collectionData.deepClone(),C.push(m,j);else{if(D=this._performMathAddition(f.data.get("isLHS"),n,h.data.get("isLHS"),o),this._checkMaxValueCondition(D))return b.CommandFactory.EXIT_CODE.MAX_VALUE_REACHED;if(C=this._getClonedModels(D,h.data),!_.isNumber(n)||!_.isNumber(o))return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;0!==D[0]&&C.push(i.collectionData.deepClone())}return this._updateCollection(a.sourceParent,a.destParent,C),!0}if((B=this._checkFractionParenthesesTileCombination(d,e))&&0!==B.length){if(f=d.children[B[0]],g=d.children[B[1]],h=e.children[B[2]],i=e.children[B[3]],c._compareParenthesesEqual(g,i)===!1)return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;if(w=this._performOnlyFractionAddition(a,f,h,!0),-1===w)x=this._joinTwoFractionsAndApplyParentheses(f.collectionData,h.collectionData),C.push(x);else{if(w===!1||"number"==typeof w)return w;C.push(w)}return j=i.collectionData.deepClone(),j.set("operator",A.MULTIPLICATION),C.push(j),this._updateCollection(a.sourceParent,a.destParent,C),!0}}return this._returnAppropriateFeedbackMultipleChildrenCase(this.sourceTiles,this.destTiles)},_performMultiplicativeTermAddition:function(a,c){var d,e,f,g,h,i,j,k=b.TileItem.OPERATORS,l=this.destTiles[0],m=l.get("base"),n=l.get("isLHS"),o=[],p=[];if(0===m&&c.children.length===this.sourceTiles.length)return o=this._performSeveralTileAdditionWithZeroBase(this.sourceTiles,[l]),this._updateCollection(a.sourceParent,a.destParent,o),!0;if(c.children.length>2)return this._returnAppropriateFeedbackMultipleChildrenCase(this.sourceTiles,this.destTiles);if(c.areChildrenLeafNodes()===!1)return!1;if(d=this._setCommutativeTilesInOrder(c),"number"==typeof d)return b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS;if(f=d["var"],e=d.coeff,f&&_.isString(f.get("base"))&&_.isString(m)){if(f.get("base").replace(k.SUBTRACTION,"")!==m.replace(k.SUBTRACTION,"")&&e!==k.PARENTHESES)return b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS;if(c.children[0].isLeaf())return p=this._getBasesAfterNegationOfVariables(e.get("base"),f.get("base"),e.get("isLHS"),1,m,n),0===p.length?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:this._checkMaxValueCondition(p)?b.CommandFactory.EXIT_CODE.MAX_VALUE_REACHED:(o=this._getClonedModels(p,l,l.get("operator")),this._updateCollection(a.sourceParent,a.destParent,o),!0)}else{if(f&&this._checkIotaSame(f,l,!0)&&this._checkSquareRootsSame(f,l,!1)){if(p=this._getBasesAfterIotaAddition(e.get("base"),e.get("isLHS"),f,null,n,l),0===p.length)return b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST;if(o=this._getClonedModels(p,e,l.get("operator")),e.get("isLHS")!==n)for(i=0;i<o.length;i++)o[i].set("isLHS",n);return 0!==p[0]&&(g=l.deepClone(),g.set("operator",k.MULTIPLICATION),this._checkToNegateCoeffs(f,l)&&((h=g.get("squareRootProps"))||h?(h=$.extend(!0,{},h),h.isNegative=!1,g.set("squareRootProps",h)):g.set("base",Math.abs(g.get("base")))),o.push(g)),this._updateCollection(a.sourceParent,a.destParent,o),!0}if(f&&this._checkSquareRootsSame(f,l,!0)&&this._checkIotaSame(e,l,!1))return j=this._checkToNegateCoeffs(f,l),p=this._getBasesAfterSquareRootAddition(e.get("base"),e.get("isLHS"),f,null,n,l,j),0===p.length?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:(o=this._getClonedModelsForSquareRoot(p[0],l,f,!1,j),this._updateCollection(a.sourceParent,a.destParent,o),!0);if(f&&(_.isString(f.get("base"))||_.isString(m)))return this._returnFeedbackForNonFractionVariableCase(this.sourceTiles)}return this._returnAppropriateFeedbackMultipleChildrenCase(this.sourceTiles,this.destTiles)},_performTermMultiplicativeAddition:function(a,c){var d,e,f,g,h,i,j,k=b.TileItem.OPERATORS,l=this.sourceTiles[0],m=l.get("base"),n=[],o=[];if(0===m&&c.children.length===this.destTiles.length)return n=this._performSeveralTileAdditionWithZeroBase([l],this.destTiles),this._updateCollection(a.sourceParent,a.destParent,n),!0;if(c.children.length>2)return this._returnAppropriateFeedbackMultipleChildrenCase(this.sourceTiles,this.destTiles);if(c.areChildrenLeafNodes()===!1)return!1;if(d=this._setCommutativeTilesInOrder(c),"number"==typeof d)return b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS;if(f=d["var"],e=d.coeff,f&&_.isString(f.get("base"))&&_.isString(m)){if(f.get("base").replace(k.SUBTRACTION,"")!==m.replace(k.SUBTRACTION,"")&&e!==k.PARENTHESES)return b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS;if(c.children[0].isLeaf())return o=this._getBasesAfterNegationOfVariables(1,m,l.get("isLHS"),e.get("base"),f.get("base"),e.get("isLHS")),0===o.length?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:this._checkMaxValueCondition(o)?b.CommandFactory.EXIT_CODE.MAX_VALUE_REACHED:(n=this._getClonedModels(o,e),this._updateCollection(a.sourceParent,a.destParent,n),!0)}else if(f&&this._checkIotaSame(l,f,!0)&&this._checkSquareRootsSame(l,f,!1))return o=this._getBasesAfterIotaAddition(null,l.get("isLHS"),l,e.get("base"),e.get("isLHS"),f),0===o.length?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:(h=e.get("operator")===k.MULTIPLICATION?f.get("operator"):e.get("operator"),n=this._getClonedModels(o,e,h),0!==o[0]&&(g=f.deepClone(),g.set("operator",k.MULTIPLICATION),this._checkToNegateCoeffs(l,f)&&((i=g.get("squareRootProps"))||i?(i=$.extend(!0,{},i),i.isNegative=!1,g.set("squareRootProps",i)):g.set("base",Math.abs(g.get("base")))),n.push(g)),this._updateCollection(a.sourceParent,a.destParent,n),!0);return f&&this._checkSquareRootsSame(l,f,!0)&&this._checkIotaSame(l,e,!1)?(j=this._checkToNegateCoeffs(l,f),o=this._getBasesAfterSquareRootAddition(null,l.get("isLHS"),l,e.get("base"),e.get("isLHS"),f,j),0===o.length?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:(n=this._getClonedModelsForSquareRoot(o[0],e,f,!1,j),this._updateCollection(a.sourceParent,a.destParent,n),!0)):f&&(_.isString(m)||_.isString(f.get("base")))?!1:this._returnAppropriateFeedbackMultipleChildrenCase(this.sourceTiles,this.destTiles)},_performTermAddition:function(a,c){var d,e=this.sourceTiles[0],f=this.destTiles[0],g=e.get("base"),h=f.get("base"),i=e.get("squareRootProps"),j=f.get("squareRootProps"),k=[],l=[];return 0===g||0===h?(k=this._performAdditionWithZeroBase(e,f),this._updateCollection(a.sourceParent,a.destParent,k),this.fractionToDecimalAllowed&&this._setTilesForEndResult(c,!0),!0):null===i&&null!==j||null!==i&&null===j?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:e.get("iotaExponent")!==f.get("iotaExponent")?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:null!==i?(d=this._checkToNegateCoeffs(e,f),l=this._getBasesAfterSquareRootAddition(null,e.get("isLHS"),e,null,f.get("isLHS"),f,d),0===l.length?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:(k=this._getClonedModelsForSquareRoot(l[0],f,f,!1,d),this._updateCollection(a.sourceParent,a.destParent,k),!0)):(l=null!==e.get("iotaExponent")?this._getBasesAfterIotaAddition(null,e.get("isLHS"),e,null,f.get("isLHS"),f):this._performMathAddition(e.get("isLHS"),g,f.get("isLHS"),h),0===l.length?_.isString(g)||_.isString(h)?!1:b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:this._checkMaxValueCondition(l)?b.CommandFactory.EXIT_CODE.MAX_VALUE_REACHED:(k=this._getClonedModels(l,f),this._updateCollection(a.sourceParent,a.destParent,k),!0))},_performAdditionWithZeroBase:function(a,b){var c;return 0===a.get("base")?(c=b.deepClone(),0===c.get("base")&&c.set("iotaExponent",null),[c]):(c=a.deepClone(),c.set({operator:b.get("operator"),isLHS:b.get("isLHS")}),a.get("isLHS")!==b.get("isLHS")&&(c=this._negateTerm(c)),0===c.get("base")&&c.set("iotaExponent",null),[c])},_performSeveralTileAdditionWithZeroBase:function(a,b){var c,d,e,f,g=[];if(1===a.length&&0===a[0].get("base"))for(d=0;d<b.length;d++)g.push(b[d].deepClone());else{for(c=b[0],f=c.get("isLHS"),d=0;d<a.length;d++)e=a[d].deepClone(),e.setIsLHS(f),g.push(e);g[0].set("operator",c.get("operator")),f!==a[0].get("isLHS")&&(g[0]=this._negateTerm(g[0]))}return g},_getBasesAfterNegationOfVariables:function(a,c,d,e,f,g){var h=[],i=b.TileItem.OPERATORS;return f===c?(h=this._performMathAddition(d,a,g,e),h.push(c)):-1!==f.indexOf(i.SUBTRACTION)?(h=this._performMathAddition(d,a,g,-1*e),h.push(c)):-1!==c.indexOf(i.SUBTRACTION)&&(h=this._performMathAddition(d,-1*a,g,e),h.push(f)),0===h[0]?[h[0]]:h},_getBasesAfterSquareRootAddition:function(a,b,c,d,e,f,g){var h=c.get("squareRootProps"),i=f.get("squareRootProps"),j=h.exponent,k=i.exponent,l=c.get("base"),m=f.get("base"),n=[];return j!==k||l!==m?[]:(null===a&&null===d?n=g?this._performMathAddition(b,h.isNegative?-1:1,e,i.isNegative?-1:1):this._performMathAddition(b,1,e,1):(a=a||1,d=d||1,n=g?this._performMathAddition(b,h.isNegative?-1*a:a,e,i.isNegative?-1*d:d):this._performMathAddition(b,a,e,d)),n)},_getBasesAfterIotaAddition:function(a,b,c,d,e,f){var g=c.get("iotaExponent"),h=f.get("iotaExponent"),i=c.get("base"),j=f.get("base"),k=[];return g!==h?[]:(null===a&&null===d?k=this._performMathAddition(b,i,e,j):Math.abs(i)===Math.abs(j)&&(a=null===a?1:a,d=null===d?1:d,this._checkToNegateCoeffs(c,f)&&(a=this._getAfterNegationOfIota(a,c),d=this._getAfterNegationOfIota(d,f)),k=this._performMathAddition(b,a,e,d)),k)},_checkToNegateCoeffs:function(a,b){var c=a.get("squareRootProps"),d=b.get("squareRootProps"),e=a.get("base"),f=b.get("base");if(c||d){if(c.isNegative===d.isNegative)return!1}else if(e/Math.abs(e)===f/Math.abs(f))return!1;return!0},_getAfterNegationOfIota:function(a,b){var c=b.get("squareRootProps"),d=b.get("base");return c?c.isNegative?-1*a:a:d/Math.abs(d)===-1?-1*a:a},_performMathAddition:function(a,c,d,e){var f=[],g=b.TileItem.OPERATORS;return a===d?_.isNumber(c)&&_.isNumber(e)?f.push(c+e):_.isString(c)&&_.isString(e)&&Array.prototype.push.apply(f,this._addStrings(c,e)):_.isNumber(c)&&_.isNumber(e)?f.push(e-c):_.isString(c)&&_.isString(e)&&(c=-1!==c.indexOf(g.SUBTRACTION)?c.replace(g.SUBTRACTION,""):g.SUBTRACTION+c,Array.prototype.push.apply(f,this._addStrings(c,e))),f},_performNumberStringAddition:function(a,c,d){var e=b.TileItem.OPERATORS,f=a.get("isLHS"),g=c.get("isLHS"),h=a.get("base"),i=c.get("base");if(f===g){if(_.isString(h)&&_.isNumber(i))return this._addNumberString(i,h,c,a,c.get("isLHS"),d);if(_.isString(i)&&_.isNumber(h))return this._addNumberString(h,i,a,c,c.get("isLHS"),d)}else{if(_.isString(h)&&_.isNumber(i))return h=-1!==h.indexOf(e.SUBTRACTION)?h.replace(e.SUBTRACTION,""):e.SUBTRACTION+h,this._addNumberString(i,h,c,a,c.get("isLHS"),d);if(_.isString(i)&&_.isNumber(h))return this._addNumberString(-1*h,i,a,c,c.get("isLHS"),d)}},_performNumberRootAddition:function(a,c,d){var e=b.TileItem.OPERATORS,f=a.get("isLHS"),g=c.get("isLHS"),h=(a.get("base"),c.get("base"),this._createParenthesesTile(c.get("operator"),g)),i=a.deepClone(),j=c.deepClone(),k=[],l={};return i.set("operator",null),j.set("operator",e.ADDITION),f===g?k.push(i,j):(l=i.get("squareRootProps"),l=$.extend(!0,{},l),l.isNegative=!l.isNegative,i.set("squareRootProps",l)),d?(h.set("tileArray",new Backbone.Collection(k)),h):k},_performNumberIotaAddition:function(a,c,d){var e=b.TileItem.OPERATORS,f=a.get("isLHS"),g=c.get("isLHS"),h=a.get("base"),i=(c.get("base"),this._createParenthesesTile(c.get("operator"),g)),j=a.deepClone(),k=c.deepClone(),l=[];return j.set("operator",null),k.set("operator",e.ADDITION),f===g?l.push(j,k):j.set("base",-1*h),d?(i.set("tileArray",new Backbone.Collection(l)),i):l},_addNumberString:function(a,c,d,e,f,g){var h,i=b.TileItem.OPERATORS,j=this._createParenthesesTile(i.MULTIPLICATION,f),k=[];return h=d.deepClone(),h.set("operator",null),k.push(h),h=e.deepClone(),h.set("operator",i.ADDITION),k.push(h),g?(j.set("tileArray",new Backbone.Collection(k)),j):k},_addStrings:function(a,c){var d=[],e=b.TileItem.OPERATORS;return a.replace(e.SUBTRACTION,"")!==c.replace(e.SUBTRACTION,"")?[]:(a===c?-1!==c.indexOf(e.SUBTRACTION)?d.push(-2,c.replace(e.SUBTRACTION,"")):d.push(2,a):d.push(0),d)},_checkParenthesesTermTileCombination:function(a,b){var c=[];return c.push(this._getBinaryStringParenthesesFromNode(a.children[0]),this._getBinaryStringParenthesesFromNode(a.children[1]),this._getBinaryStringParenthesesFromNode(b.children[0]),this._getBinaryStringParenthesesFromNode(b.children[1])),-1!==["0101","1001","0110","1010"].indexOf(c.join(""))?c:[]},_checkFractionParenthesesTileCombination:function(a,b){var c=[];return c.push(this._getBinaryStringFractionFromNode(a.children[0]),this._getBinaryStringFractionFromNode(a.children[1]),this._getBinaryStringFractionFromNode(b.children[0]),this._getBinaryStringFractionFromNode(b.children[1])),-1!==["0101","1001","0110","1010"].indexOf(c.join(""))?c:[]},_returnFeedbackForNonFractionVariableCase:function(a){if(1===a.length)return!1;var c,d,e=!1;for(c=0;c<a.length;c++)if(a[c].checkIfVariablePresent()){e=!0;break}return d=e===!0?3:2,a.length>=d?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:!1},_returnAppropriateFeedbackMultipleChildrenCase:function(a,d){var e,f,g,h,i,j,k=b.CommandFactory.EXIT_CODE;if(this.isIotaPresent){for(e=0;e<a.length;e++)if(g=a[e],c.isBasicTileType(g))for(i=g.get("base"),f=0;f<d.length;f++)if(h=d[f],c.isBasicTileType(h)){if(j=h.get("base"),"string"==typeof i&&"string"==typeof j)return k.SIMPLIFY_TERMS_FIRST;if(this._checkIotaSame(g,h,!0,!0)&&this._checkSquareRootsSame(g,h,!1))return k.SIMPLIFY_TERMS_FIRST;if(this._checkIotaSame(g,h,!1,!0)&&this._checkSquareRootsSame(g,h,!0))return k.SIMPLIFY_TERMS_FIRST}for(e=0;e<a.length&&(g=a[e],c.isBasicTileType(g)&&this._isNumberTile(g));e++);if(e===a.length){for(e=0;e<d.length&&(g=d[e],c.isBasicTileType(g)&&this._isNumberTile(g));e++);if(e===d.length)return k.SIMPLIFY_TERMS_FIRST}return k.NOT_LIKE_TERMS}return this._returnFeedbackForNonFractionVariableCase(a)},_isNumberTile:function(a){return null===a.get("iotaExponent")&&null===a.get("squareRootProps")&&!_.isString(a.get("base"))},_returnAppropriateFeedbackString:function(a,c){return a===c?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:this.isIotaPresent?b.CommandFactory.EXIT_CODE.NOT_LIKE_TERMS:this._returnFeedbackForNonFractionVariableCase(this.sourceTiles)},_setCommutativeTilesInOrder:function(a){var c=a.children,d=c[0].data,e=c[1].data,f=d.get("squareRootProps"),g=e.get("squareRootProps"),h=d.get("iotaExponent"),i=e.get("iotaExponent");return _.isString(e.get("base"))?{coeff:d,"var":e}:_.isString(d.get("base"))?{coeff:e,"var":d}:f&&g?b.CombineCommand.RETURN_TYPE.SQRT_EXISTS:h&&i?b.CombineCommand.RETURN_TYPE.IOTA_EXISTS:f&&null===g?{coeff:e,"var":d}:g&&null===f?{coeff:d,"var":e}:h&&null===i?{coeff:e,"var":d}:i&&null===h?{coeff:d,"var":e}:{coeff:d,"var":e}},_getBinaryStringParenthesesFromNode:function(a){return a.data===b.TileItem.OPERATORS.PARENTHESES?1:a.isLeaf()?0:-1},_getBinaryStringFractionFromNode:function(a){return a.data===b.TileItem.OPERATORS.PARENTHESES?1:a.data===b.TileItem.OPERATORS.DIVISION?0:-1},_checkSquareRootsSame:function(a,b,c){var d=a.get("squareRootProps"),e=b.get("squareRootProps"),f=a.get("iotaExponent"),g=b.get("iotaExponent");return!c||null!==d&&null!==e?null===d&&null===e?!0:f!==g?!1:null!==d&&null===e||null===d&&null!==e?!1:d.exponent===e.exponent&&a.get("base")===b.get("base")?!0:!1:!1},_checkIotaSame:function(a,b,c,d){var e=a.get("iotaExponent"),f=b.get("iotaExponent");return!c||null!==e&&null!==f?null===e&&null===f?!0:!d&&Math.abs(a.get("base"))!==Math.abs(b.get("base"))||e!==f?!1:!0:!1},_createFractionTile:function(a,c){var d=b.TileItem.createTileItem,e=b.TileItem.TileType;return d({type:e.FRACTION,tileArray:null,exponent:null,operator:a,isLHS:c})},_createParenthesesTile:function(a,c){var d=b.TileItem.createTileItem,e=b.TileItem.TileType;return d({type:e.PARENTHESES,tileArray:null,exponent:null,operator:a,isLHS:c})},_createTermTile:function(a,c,d,e){var f=b.TileItem.createTileItem,g=b.TileItem.TileType;return f({type:g.TERM_TILE,base:a,operator:c,isLHS:d,isDenominator:e})},_checkMaxValueCondition:function(a){var b;for(b=0;b<a.length;b++)if(a[b]>999||a[b]<-999)return!0;return!1},_getClonedModelsForSquareRoot:function(a,c,d,e,f){var g,h,i=[],j=null,k=b.TileItem.OPERATORS.MULTIPLICATION;return g=c.deepClone(),g.set({base:a,squareRootProps:null}),d.get("iotaExponent")&&g.set("iotaExponent",null),0===a&&(g.set("squareRootProps",null),g.set("iotaExponent",null)),c.get("operator")===k&&(h=d.get("operator"),g.set("operator",h)),i.push(g),0===a?i:(j={exponent:d.get("squareRootProps").exponent,isNegative:d.get("squareRootProps").isNegative},f&&(j.isNegative=!1),g=d.deepClone(),g.set({operator:k,squareRootProps:j}),i.push(g),i)},_getClonedModels:function(a,c,d){var e,f,g,h=[];for(f=0;f<a.length;f++)e=c.deepClone(),g=a[f],e.set({base:a[f],isVariable:!1}),d&&e.set("operator",d),0===g&&e.set({iotaExponent:null,squareRootExponent:null}),_.isString(g)?e.set("isVariable",!0):e.set("isVariable",!1),0!==f&&e.set("operator",b.TileItem.OPERATORS.MULTIPLICATION),h.push(e);return h},_updateCollection:function(a,c,d,e){var f,g=a.get("tileArray"),h=c.get("tileArray"),i=c.get("isLHS"),j=!1;for(g===h&&(this._changeSourceDestPos(),j=!0),g.remove(this.sourceTiles),h.remove(this.destTiles),f=0;f<d.length;f++)d[f].setIsLHS(i),h.add(d[f],{at:this.destPos+f});this.numOfTilesInserted=f,this.operationPerformed===b.TileItem.OPERATORS.ADDITION&&(g.at(0)&&g.at(0).set("operator",null),h.at(0)&&h.at(0).set("operator",null)),this.sourceStaticZeroAdd=this._checkForStaticZero(a,!1,!1),j===!1&&(this.destStaticZeroAdd=this._checkForStaticZero(c,!1,!1)),this.fractionToDecimalAllowed&&this._setTilesForEndResult(e,!0)},_setTilesForEndResult:function(a,c){var d,e,f,g;a&&(d=a.get("tileArray").at(0).get("tileArray"),e=a.get("tileArray").at(1)?a.get("tileArray").at(1).get("tileArray"):[],1===d.length&&1===e.length&&(f=d.at(0),g=e.at(0),(f.get("type")===b.TileItem.TileType.TERM_TILE&&g.get("type")===b.TileItem.TileType.TERM_TILE&&"t"!==f.get("base")&&"t"===g.get("base")||f.get("type")===b.TileItem.TileType.TERM_TILE&&g.get("type")===b.TileItem.TileType.TERM_TILE&&"t"===f.get("base")&&"t"!==g.get("base"))&&(f.set("endResult",c),g.set("endResult",c))))},_updateParentCollection:function(a,b,d,e,f){var g,h,i,j=(b.get("tileArray"),this.destObj.index);for(g=0;e>g;g++)j=c.getParentIndex(j);for(this.destPos=parseInt(c.getSourceWrtParent(j)),this.destObj.index=j,this.sourceObj.index="0",this.destPos=this.destPos-f,h=a.getModelFromIndex(c.getParentIndex(j)),i=h.get("tileArray"),this.sourceTiles=[],this.destTiles=[],g=0;f>=g;g++)this.destTiles.push(i.at(g+this.destPos));for(i.remove(this.destTiles),g=0;g<d.length;g++)i.add(d[g],{at:this.destPos+g});this.numOfTilesInserted=g},_checkForStaticZero:function(a,c,d){var e,f=a.get("tileArray"),g=b.TileItem.TileType;if(a.get("type")===g.EXPRESSION){if(1===f.length&&f.at(0).get("type")===g.TERM_TILE&&0===f.at(0).get("base"))return e=f.at(0).deepClone(),e.set({isDraggable:c,isDroppable:c}),f.remove(f.at(0)),f.add(e),d||(this.convertedToZero=!0),!0;if(0===f.length)return this._addStaticZeroTerm(a),d||(this.convertedToZero=!1),!0}return!1},_addStaticZeroTerm:function(a){var c,d=b.TileItem.createTileItem,e=a.get("tileArray");c=d({base:0,isDenominator:!1,isLHS:a.get("isLHS"),operator:null,type:b.TileItem.TileType.TERM_TILE,isDroppable:!1,isDraggable:!1}),e.add(c)},_changeSourceDestPos:function(){this.sourcePos<this.destPos&&(this.destPos-=this.sourceTiles.length)},undo:function(a){var d,e,f,g,h,i=this.sourceObj.index,j=this.destObj.index,k=b.TileItem.OPERATORS,l=[];for(e=a.getModelFromIndex(c.getParentIndex(i)),f=a.getModelFromIndex(c.getParentIndex(j)),g=e.get("tileArray"),h=f.get("tileArray"),this._setTilesForEndResult(a,!1),this.sourceStaticZeroAdd&&this.convertedToZero&&this._checkForStaticZero(e,!0,!0),this.destStaticZeroAdd&&this.convertedToZero&&this._checkForStaticZero(f,!0,!0),this.operationPerformed===k.ADDITION&&(g.at(0).set("operator",k.ADDITION),h.at(0).set("operator",k.ADDITION)),this.operatorChangedSP&&g.at(this.sourcePos).set("operator",this.operatorChangedSP),this.sourceStaticZeroAdd&&this.convertedToZero!==!0&&g.remove(g.at(0)),this.destStaticZeroAdd&&this.convertedToZero!==!0&&h.remove(h.at(0)),d=0;d<this.numOfTilesInserted;d++)l[d]=h.at(this.destPos+d);for(h.remove(l),d=0;d<this.destTiles.length;d++)h.add(this.destTiles[d],{at:this.destPos+d});for(d=0;d<this.sourceTiles.length;d++)g.add(this.sourceTiles[d],{at:this.sourcePos+d});this.operationPerformed===k.ADDITION&&(g.at(0).set("operator",null),h.at(0).set("operator",null))}},{RETURN_TYPE:{IOTA_EXISTS:0,SQRT_EXISTS:1,NUMBER_EXISTS:2}})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro,c=b.EquationManagerPro.Utils;b.CheckParenthesesRules=b.BaseCommand.extend({numOfTilesAdded:0,deletedTile:null,sourceIndex:null,sourcePos:null,isDummyCommand:!0,extraTermsInserted:null,initialize:function(){this.extraTermsInserted=[]},execute:function(a,d,e){var f,g,h,i=e.source.index;return this.sourceIndex=i,this.sourcePos=parseInt(c.getSourceWrtParent(i)),f=d.getModelFromIndex(c.getParentIndex(i)),g=f.get("tileArray"),h=g.at(this.sourcePos),h.get("type")!==b.TileItem.TileType.PARENTHESES?!1:this._validateParentheses(h,e.root,g)},_validateParentheses:function(a,b,d){var e=c.tilesToNodes(b,[a])[0];return null!==a.get("exponent")?!1:this._checkParenthesesContents(e,d)},_checkParenthesesContents:function(a,d){if(null===this._getParenthesesCoeff(a)||null===a.children[0])return this._removeParentheses(a.collectionData,d);if(c._hasVariableTermTile(a,c._isVariableTermTile)&&this._checkForMultipliedParentheses(a.collectionData))return!1;var e=a.children[0],f=b.TileItem.OPERATORS;return e.isLeaf()?this._applyTermToCoefficient(a,e,d):e.data===f.MULTIPLICATION?this._applyMultiplicativeTermToCoefficient(a,d):e.data===f.DIVISION&&e.contains([f.ADDITION])===!1?this._applyFractionToCoefficient(a,e,d):!1},_checkForMultipliedParentheses:function(a){var c,d=a.get("tileArray");for(c=0;c<d.length;c++)if(d.at(c).get("type")!==b.TileItem.TileType.PARENTHESES)return!0;return!1},_applyMultiplicativeTermToCoefficient:function(a,c){var d=this._getParenthesesCoeff(a),e=b.TileItem.OPERATORS;return d&&d.data===e.DIVISION&&this._checkForMultipliedParentheses(a.collectionData)?this._removeParenthesesCombineMulFraction(d.collectionData,a.collectionData,c):this._removeParentheses(a.collectionData,c)},_applyTermToCoefficient:function(a,c,d){var e=this._getParenthesesCoeff(a),f=b.TileItem.OPERATORS;return e&&e.data===f.DIVISION?this._removeParenthesesAndApplyFraction(e.collectionData,c.data,a.collectionData,d):this._removeParentheses(a.collectionData,d)},_applyFractionToCoefficient:function(a,c,d){var e=this._getParenthesesCoeff(a),f=b.TileItem.OPERATORS;if(e){if(e.data===f.DIVISION)return this._removeParenthesesCombineFractions(e.collectionData,c.collectionData,a.collectionData,d);if(e.data instanceof b.TermTile)return this._removeParenthesesCombineTermFraction(a,c,d)}return this._removeParentheses(a.collectionData,d)},_getParenthesesCoeff:function(a){var c,d=b.TileItem.OPERATORS,e=a.parent;if(e.data===d.MULTIPLICATION){if(c=e.children.indexOf(a),0!==c)return e.children[c-1];if(c!==e.children.length-1)return e.children[c+1]}return null},_removeParentheses:function(a,d){var e,f,g,h=a.get("tileArray"),i=b.TileItem.OPERATORS;for(d.remove(a),this.deletedTile=a,a.get("operator")===i.MULTIPLICATION&&c.isBasicTileType(d.at(this.sourcePos-1))&&_.isString(d.at(this.sourcePos-1).get("base"))&&(g=d.at(this.sourcePos-1).get("operator"),d.at(this.sourcePos-1).set("operator",i.MULTIPLICATION),this.sourcePos-=1,this.tileAddedInMiddle=!0),e=0;e<h.length;e++)f=h.at(e).deepClone(),0===e&&f.set("operator","undefined"==typeof g?a.get("operator"):g),d.add(f,{at:this.sourcePos+e});return this.numOfTilesAdded=e,!0},_removeParenthesesAndApplyFraction:function(a,d,e,f){var g,h,i=a.get("tileArray"),j=a.getNumeratorLength(),k=d.deepClone(),l=b.TileItem.OPERATORS,m=[];return k.set("operator",l.MULTIPLICATION),g=f.indexOf(a),h=i.at(j-1),c.isBasicTileType(h)&&_.isString(h.get("base"))?(i.at(j-1).set("operator",l.MULTIPLICATION),i.add(k,{at:j-1}),m.push(g+"."+(j-1))):(i.add(k,{at:j}),m.push(g+"."+j)),i.at(0).set("operator",null),this.extraTermsInserted=m,this.numOfTilesAdded=0,f.remove(e),this.deletedTile=e,!0},_removeParenthesesCombineFractions:function(a,c,d,e){var f,g,h,i,j=a.get("tileArray"),k=a.getNumeratorLength(),l=c.deepClone(),m=l.get("tileArray"),n=l.getNumeratorLength(),o=b.TileItem.OPERATORS,p=[],q=0;for(g=e.indexOf(a),h=0;n>h;h++)i=m.at(h),i.set("operator",o.MULTIPLICATION),j.add(i,{at:k+h}),p.push(g+"."+(k+h));for(h=n;h<m.length;h++)i=m.at(h),i.set("operator",o.MULTIPLICATION),f=j.length+q,j.add(i,{at:f}),p.push(g+"."+f),q++;return this.extraTermsInserted=p,this.numOfTilesAdded=0,e.remove(d),this.deletedTile=d,!0},_removeParenthesesCombineTermFraction:function(a,c,d){var e,f,g,h,i=a.collectionData,j=d.indexOf(i),k=[],l=b.TileItem.OPERATORS,m=c.collectionData,n=m.deepClone(),o=n.get("tileArray");for(h=j-1;h>=0&&(e=d.at(h),e instanceof b.TermTile&&k.push(e),!([l.ADDITION,null].indexOf(e.get("operator"))>-1));h--);for(g=0>h?0:h,f=k.length,this.coefficientsRemoved={numberOfCoefficients:f,startingIndex:g},n.set("operator",k[f-1].get("operator")),o.at(0).set("operator",l.MULTIPLICATION),h=0;f>h;h++)o.add(k[h].deepClone(),{at:0});return o.at(0).set("operator",null),d.remove(k),this.deletedTile=i,d.remove(i),d.add(n,{at:g}),!0},_removeParenthesesCombineMulFraction:function(a,c,d){var e,f,g,h=a.get("tileArray"),i=a.getNumeratorLength(),j=c.get("tileArray"),k=b.TileItem.OPERATORS,l=[];for(e=d.indexOf(a),f=0;f<j.length;f++)g=j.at(f).deepClone(),g.set("operator",k.MULTIPLICATION),h.add(g,{at:i+f}),l.push(e+"."+(i+f));return this.extraTermsInserted=l,this.numOfTilesAdded=0,d.remove(c),this.deletedTile=c,!0},undo:function(a){var b,d,e,f,g,h,i,j,k=this.sourceIndex,l=this.numOfTilesAdded,m=[];if(h=a.getModelFromIndex(c.getParentIndex(k)),g=h.get("tileArray"),this.coefficientsRemoved){for(e=this.coefficientsRemoved.startingIndex,b=g.at(e),d=b.get("tileArray"),i=this.coefficientsRemoved.numberOfCoefficients-1;i>=0;i--)f=d.at(i).deepClone(),0===i&&f.set("operator",b.get("operator")),g.add(f,{at:e});g.remove(b)}else if(0===l){for(i=this.extraTermsInserted.length-1;i>=0;i--)h.getModelFromIndex(this.extraTermsInserted[i]).destroy();j=this.extraTermsInserted[0].substring(0,this.extraTermsInserted[0].lastIndexOf("."))+".0",h.getModelFromIndex(j).set("operator",null)}else{for(i=0;l>i;i++)m[i]=g.at(this.sourcePos+i);g.remove(m)}this.tileAddedInMiddle&&(g.at(this.sourcePos).set("operator",m[0].get("operator")),this.sourcePos+=1),g.add(this.deletedTile,{at:this.sourcePos})}},{})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro,c=b.EquationManagerPro.Utils;b.CheckFractionRules=b.BaseCommand.extend({numOfTilesAdded:0,deletedTile:null,sourceIndex:null,sourcePos:null,isDummyCommand:!0,initialize:function(){},execute:function(a,d,e){var f,g,h,i=e.source.index;return this.sourceIndex=i,this.sourcePos=parseInt(c.getSourceWrtParent(i)),this.fractionToDecimalAllowed=a.fractionToDecimalAllowed,f=d.getModelFromIndex(c.getParentIndex(i)),g=f.get("tileArray"),h=g.at(this.sourcePos),this.deletedTile=h,h.get("type")!==b.TileItem.TileType.FRACTION?!1:this._validateFraction(h,g,f,d)},_validateFraction:function(a,d,e,f){var g,h,i,j,k=a.deepClone(),l=k.get("tileArray"),m=a.getNumeratorLength();if(0===a.getDenominatorLength()){for(h=l.models,d.remove(a),i=0;i<h.length;i++)0===i&&h[i].set("operator",a.get("operator")),d.add(h[i],{at:this.sourcePos+i});return this.numOfTilesAdded=i,1===this.numOfTilesAdded&&e.get("type")===b.TileItem.TileType.EXPRESSION&&1===d.length&&c.isBasicTileType(d.at(0))&&0===d.at(0).get("base")&&(j=d.at(0).deepClone(),j.set({isDraggable:!1,isDroppable:!1}),d.remove(d.at(0)),d.add(j)),this.fractionToDecimalAllowed&&this._setTilesForEndResult(f,!0),!0}return 0===m?(g=this._addTermTile(1,!1,a.get("isLHS"),null,!0),l.add(g,{at:0}),d.remove(a),d.add(k,{at:this.sourcePos}),this.numOfTilesAdded=1,!0):!1},_setTilesForEndResult:function(a,c){var d,e,f,g;a&&(d=a.get("tileArray").at(0).get("tileArray"),e=a.get("tileArray").at(1).get("tileArray"),1===d.length&&1===e.length&&(f=a.get("tileArray").at(0).get("tileArray").at(0),g=a.get("tileArray").at(1).get("tileArray").at(0),(f.get("type")===b.TileItem.TileType.TERM_TILE&&g.get("type")===b.TileItem.TileType.TERM_TILE&&"t"!==f.get("base")&&"t"===g.get("base")||f.get("type")===b.TileItem.TileType.TERM_TILE&&g.get("type")===b.TileItem.TileType.TERM_TILE&&"t"===f.get("base")&&"t"!==g.get("base"))&&(f.set("endResult",c),g.set("endResult",c))))},_addTermTile:function(a,c,d,e,f){var g,h=b.TileItem.createTileItem;return g=h({base:a,isDenominator:c,isLHS:d,operator:e,type:b.TileItem.TileType.TERM_TILE}),f===!0&&(this.addedTile=g),g},undo:function(a){var b,d,e,f,g,h=this.sourceIndex,i=this.numOfTilesAdded,j=[];if(d=a.getModelFromIndex(c.getParentIndex(h)),b=d.get("tileArray"),this.fractionToDecimalAllowed&&this._setTilesForEndResult(a,!1),this.deletedTile){for(e=0;i>e;e++)j[e]=b.at(this.sourcePos+e);b.remove(j),b.add(this.deletedTile,{at:this.sourcePos})}else f=b.at(this.sourcePos),g=f.get("tileArray"),g.remove(g.at(0))}},{})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro,c=b.EquationManagerPro.Utils;b.ParenthesesExpClick=b.BaseCommand.extend({numOfTilesAdded:0,deletedTile:null,sourceIndex:null,sourcePos:null,initialize:function(){},execute:function(a,d,e){var f,g,h,i=e.source.index;return this.sourceIndex=i,this.sourcePos=parseInt(c.getSourceWrtParent(i)),f=d.getModelFromIndex(c.getParentIndex(i)),g=f.get("tileArray"),h=g.at(this.sourcePos),h.get("type")!==b.TileItem.TileType.PARENTHESES?!1:this._duplicateParentheses(h,g);
},_duplicateParentheses:function(a,c){var d,e,f=a.get("exponent"),g=b.TileItem.OPERATORS;for(c.remove(a),this.deletedTile=a,e=0;f>e;e++)d=a.deepClone(),d.set({operator:g.MULTIPLICATION,exponent:null,isAnimate:!0}),0===e&&d.set("operator",a.get("operator")),c.add(d,{at:this.sourcePos+e});return this.numOfTilesAdded=e,!0},undo:function(a){var b,d,e=this.sourceIndex,f=this.numOfTilesAdded,g=[];for(b=c.getParentTiles(a,e),d=0;f>d;d++)g[d]=b.at(this.sourcePos+d);b.remove(g),b.add(this.deletedTile,{at:this.sourcePos})}},{})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro,c=b.EquationManagerPro.Utils;b.BreakBase=b.BaseCommand.extend({numOfTilesAdded:null,deletedTiles:null,sourceIndex:null,sourcePos:null,operatorMadeNull:!1,addedStaticZero:!1,initialize:function(){this.deletedTiles=[],this.numOfTilesAdded=0},execute:function(a,b,d){var e,f,g,h,i=d.root,j=d.source.index;a.allowedOperation;return this.sourceIndex=j,this.sourcePos=parseInt(c.getSourceWrtParent(j)),e=b.getModelFromIndex(c.getParentIndex(j)),f=e.get("tileArray"),g=f.at(this.sourcePos),h=g.get("base"),_.isString(h)?this._performBreakBase(f,g):0===h?this._applyZeroBase(b,e,f,g,i):null!==g.get("iotaExponent")?this._breakIotaBase(f,g):null!==g.get("squareRootProps")?this._breakSquareRootBase(f,g):this._performBreakBase(f,g)},_applyZeroBase:function(a,b,c,d,e){var f,g=d.get("iotaExponent");return g?(f=d.deepClone(),f.set({iotaExponent:null,isAnimate:!0}),this._updateCollection([f],c,d),!0):!1},_deleteOnlyChild:function(a,b){var c=b.get("tileArray");this.deletedTiles.push(a),a.destroy(),null===a.get("operator")&&0!==c.length&&this._updateTileOperator(c),this._checkAndAddStaticZero(b)},_removeAllChildren:function(a,b){var d,e,f,g,h=a.get("tileArray"),i=b.children,j=c.getModelDataFromTreeNode(i[0]);for(this.sourcePos=h.indexOf(j),d=0;d<i.length;d++)e=i[d],f=c.getModelDataFromTreeNode(e),this.deletedTiles.push(f),h.remove(f);g=f,this.numOfTilesAdded=0,null===j.get("operator")&&this._updateTileOperator(h),this._checkAndAddStaticZero(a)},_checkAndAddStaticZero:function(a){var c=a.get("tileArray");a.get("type")===b.TileItem.TileType.EXPRESSION&&0===c.length&&this._addStaticZeroTerm(a)},_addStaticZeroTerm:function(a){var c,d=b.TileItem.createTileItem,e=a.get("tileArray");c=d({base:0,isDenominator:!1,isLHS:a.get("isLHS"),operator:null,type:b.TileItem.TileType.TERM_TILE,isDroppable:!1,isDraggable:!1}),this.addedStaticZero=!0,e.add(c)},_updateTileOperator:function(a){var b=a.at(this.sourcePos);b&&(b.set("operator",null),this.operatorMadeNull=!0,this.numOfTilesAdded=0)},_breakIotaBase:function(a,c){var d,e=c.get("iotaExponent"),f=c.get("base"),g=[];if(d=c.deepClone(),1===f&&e%2===0)d.set({base:-1,iotaExponent:null,isAnimate:!0}),g.push(d);else{if(1===f)return!1;d.set({base:f,iotaExponent:null,isAnimate:!0}),g.push(d),d=c.deepClone(),d.set({base:1,iotaExponent:e,squareRootProps:null,operator:b.TileItem.OPERATORS.MULTIPLICATION,isAnimate:!0}),g.push(d),c.get("squareRootProps")&&(g.reverse(),g[0].set("operator",g[1].get("operator")),g[1].set("operator",b.TileItem.OPERATORS.MULTIPLICATION))}return this._updateCollection(g,a,c),!0},_breakSquareRootBase:function(a,c){var d,e,f,g=c.get("squareRootProps"),h=g.exponent,i=c.get("base"),j=[];if(d=c.deepClone(),e=$.extend(!0,{},g),g.isNegative===!0)d.set({base:-1,squareRootProps:null,isAnimate:!0}),j.push(d),e.isNegative=!1,d=c.deepClone(),d.set({squareRootProps:e,operator:b.TileItem.OPERATORS.MULTIPLICATION,isAnimate:!0}),j.push(d);else if(i/Math.abs(i)===-1)f=Math.pow(Math.abs(i),1/h),f=f%1===0?f:-1*i,d.set({base:f,iotaExponent:1,isAnimate:!0,squareRootProps:f===Math.abs(i)?e:null}),j.push(d);else{if(f=Math.pow(i,1/h),f%1!==0)return!1;d.set({base:Math.pow(i,1/h),squareRootProps:null,isAnimate:!0}),j.push(d)}return this._updateCollection(j,a,c),!0},_updateCollection:function(a,b,c){var d;for(this.numOfTilesAdded=a.length,this.deletedTiles.push(c),b.remove(c),d=0;d<a.length;d++)b.add(a[d],{at:this.sourcePos+d})},_performBreakBase:function(c,d){var e,f,g,h=[],i=[],j=d.get("base"),k=b.TileItem.OPERATORS,l=a.Common.Utilities.Models.MathUtils;if(_.isString(j)&&-1!==j.indexOf(k.SUBTRACTION)||1!==Math.abs(j)&&l.isPrime(j)&&j/Math.abs(j)===-1?(g=_.isString(j)?j.replace(k.SUBTRACTION,""):Math.abs(j),h.push(-1,g)):_.isNumber(j)&&(h=l.getGreatestMultiple(j)),0===h.length)return!1;for(this.numOfTilesAdded=h.length,this.deletedTiles.push(d),c.remove(d),e=0,f=h.length;f>e;e++)i[e]=d.deepClone(),i[e].set("base",h[e]),i[e].set("isAnimate",!0),0!==e&&i[e].set("operator",k.MULTIPLICATION),c.add(i[e],{at:this.sourcePos+e});return!0},undo:function(a){var d,e,f,g=this.sourceIndex,h=this.numOfTilesAdded,i=[];for(d=c.getParentTiles(a,g),this.addedStaticZero&&d.remove(d.at(0)),e=0;h>e;e++)i[e]=d.at(this.sourcePos+e);for(d.remove(i),this.operatorMadeNull&&d.at(this.sourcePos).set("operator",b.TileItem.OPERATORS.ADDITION),e=0,f=this.deletedTiles.length;f>e;e++)d.add(this.deletedTiles.pop(),{at:this.sourcePos})}},{})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro,c=b.EquationManagerPro.Utils;b.TakeOutCommonCommand=b.BaseCommand.extend({parenthesesOriginalModel:null,parenthesesModel:null,parenthesesIndex:null,parenthesesParent:null,_commonTileRelativePosition:null,_eldestSiblingOperator:null,execute:function(a,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=e.source,x=e.dest,y=e.root,z=w.index,A=x.index,B=b.TileItem.OPERATORS,C=[],D=0;if(f=d.getModelFromIndex(z),g=d.getModelFromIndex(A),o=c.tilesToNodes(y,[f])[0],p=c.tilesToNodes(y,[g])[0],n=f.get("multipleInParentheses"),this._draggingOutDenominator=f.get("isDenominator"),r=this._getParentParenthesesNode(o),r===!1||null!==r.children[1].data)return b.CommandFactory.EXIT_CODE.PARENTHESES_EXPONENT_PRESENT;for(j=+w.numOfTiles,h=c.getParentTiles(d,z),i=parseInt(c.getSourceWrtParent(z)),k=[],v=0;j>v;v++)k.push(h.at(i+v));if(l=c.tilesToNodes(y,k),m=c.getCommonParentFromMultiple(l),j>1)return this._checkForSimplifiableMarquee(m,l)?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:!1;if(o.data===B.DIVISION)return this._checkForSimplifiableMarquee(o.children[0])||this._checkForSimplifiableMarquee(o.children[1])?b.CommandFactory.EXIT_CODE.SIMPLIFY_TERMS_FIRST:!1;for(t=c.getOperatorsBetween(o,p),u=t.node1ToParentOperators,v=0;v<u.length;v++)C.push(u[v].data);if(C=C.toString(),C.indexOf(B.PARENTHESES)===C.lastIndexOf(B.PARENTHESES)){if(1===j&&this._checkForApplyCoefficientFeedback(r))return b.CommandFactory.EXIT_CODE.APPLY_COEFFECIENTS;s=r.children[0],q=s.getPath(),this.parenthesesOriginalModel=r.collectionData,this.parenthesesModel=this.parenthesesOriginalModel.deepClone(),this.parenthesesIndex=d.getIndexFromItemModel(this.parenthesesOriginalModel),this.parenthesesParent=d.getModelFromIndex(this.parenthesesIndex.slice(0,this.parenthesesIndex.lastIndexOf("."))),s.data===B.ADDITION?D=this._takeOutCommonFromPolynomial({sourceNode:o,monomials:s.children,modelRef:d,sourceIndexString:z,relatedTileIndex:n}):s.data===B.DIVISION&&(D=this._takeOutCommonFromFraction({sourceNode:o,numerator:s.children[0],denominator:s.children[1],modelRef:d,sourceIndexString:z,relatedTileIndex:n}))}return"number"!=typeof D&&f.set("multipleInParentheses",null),D},_checkForSimplifiableMarquee:function(a,d){d=d||[];var e,f,g=b.TileItem.OPERATORS,h=a.children.length,i=0;if(d.length)if(a.data===g.MULTIPLICATION){for(e=0;e<d.length;e++)c._hasVariableTermTile(d[e],c._isNonNumericTermTile)||i++;f=i>1}else f=!1;else f=a.data===g.MULTIPLICATION&&(c._hasVariableTermTile(a,c._isNonNumericTermTile)?h>2:h>1);return f},_checkForApplyCoefficientFeedback:function(a){var c=a.children[0],d=b.TileItem.OPERATORS;return!(c.data===d.DIVISION&&c.children[0].data===d.ADDITION||c.data===d.ADDITION)},_getParentParenthesesNode:function(a){var c=a.parent;return c?c.data===b.TileItem.OPERATORS.PARENTHESES?c:this._getParentParenthesesNode(c):!1},_takeOutCommonFromPolynomial:function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=a.sourceNode,H=a.sourceIndexString,I=(a.monomials,a.modelRef),J=a.relatedTileIndex,K=b.TileItem.OPERATORS,L=b.TileItem.TileType,M=!1,N=!1;if("string"!=typeof J)return"number"==typeof J?J:!1;if(j=H.replace(this.parenthesesIndex+".",""),k=J.replace(this.parenthesesIndex+".",""),e=this.parenthesesModel.get("tileArray"),c=this.parenthesesParent.get("tileArray"),d=Number(this.parenthesesIndex.slice(this.parenthesesIndex.lastIndexOf(".")+1)),y=G.data.deepClone(),this._isTermTile(y)&&-1===y.get("base")&&null===y.get("squareRootProps")&&(M=!0),this._draggingOutDenominator){for(s=[],F=d;F>=0;F--)if(p=c.at(F),q=p.get("operator"),p.get("type")===b.TileItem.TileType.TERM_TILE&&s.unshift(p),null===q||q===K.ADDITION){w=F;break}switch(p===this.parenthesesOriginalModel&&(p=this.parenthesesModel),r=p.get("type")){case L.PARENTHESES:this._eldestSiblingOperator=q,p.set("operator",K.MULTIPLICATION);case L.TERM_TILE:for(s.length>0&&c.remove(s),y.set("operator",null),t=b.TileItem.createTileItem({type:b.TileItem.TileType.FRACTION,operator:q,isLHS:y.get("isLHS")}),v=t.get("tileArray"),F=0;F<s.length;F++)v.add(s[F]);v.length&&v.at(0).set("operator",null),v.add(y),c.add(t,{at:w}),this._draggedOutTilePosition=I.getIndexFromItemModel(y);break;case L.FRACTION:u=p.get("tileArray"),this._multiplyCommonTileToCoefficient({modelRef:I,commonTile:y,coefficients:u,swapRequired:M,rightToLeftSearchStartIndex:null})}if(n=this.parenthesesModel.getModelFromIndex(j),i=this._getParentsTileArray(j,this.parenthesesModel),m=this.parenthesesModel.getModelFromIndex(k),D=this._getParentsTileArray(k,this.parenthesesModel),E=m.get("isDenominator")!==n.get("isDenominator"),E||(z=i.indexOf(n),A=n.get("operator"),B=D.indexOf(m),C=m.get("operator")),M){for(f=[],F=0;F<e.length;F++)if(h=e.at(F),!N){if(h.get("operator")===K.ADDITION){N=!0,g=F;break}f.push(h)}for(e.at(0).set("operator","+"),e.at(g).set("operator",null),e.remove(f),F=0;F<f.length;F++)e.add(f[F])}for(E&&(z=i.indexOf(n),A=n.get("operator"),B=D.indexOf(m),C=m.get("operator")),x=I.getIndexFromItemModel(this.parenthesesOriginalModel),x=Number(x.slice(x.lastIndexOf(".")+1)),c.remove(this.parenthesesOriginalModel),c.add(this.parenthesesModel,{at:x}),i.remove(n),o=!1,F=i.length-1;F>=0;F--)if(i.at(F).get("isDenominator")){o=!0;break}for(o?i.add(this._getResultantTermTile(n),{at:z}):i.at(z)&&i.at(z).set("operator",A),D.remove(m),m=this._getResultantTermTile(m,y),o=!1,F=D.length-1;F>=0;F--)if(D.at(F).get("isDenominator")){o=!0;break}1!==m.get("base")||o||E?D.add(m,{at:B}):D.at(B)&&D.at(B).set("operator",C),this._denominatorAddedAt=I.getIndexFromItemModel(y)}else{for(F=d;F>=0&&(p=c.at(F),q=p.get("operator"),null!==q&&q!==K.ADDITION);F--);switch(p===this.parenthesesOriginalModel&&(p=this.parenthesesModel),r=p.get("type")){case L.PARENTHESES:y.set("operator",q),p.set("operator",K.MULTIPLICATION),c.add(y,{at:F}),this._draggedOutTilePosition=I.getIndexFromItemModel(y),this._eldestSiblingOperator=q;break;case L.TERM_TILE:this._multiplyCommonTileToCoefficient({modelRef:I,commonTile:y,coefficients:c,swapRequired:M,rightToLeftSearchStartIndex:d});break;case L.FRACTION:u=p.get("tileArray"),this._multiplyCommonTileToCoefficient({modelRef:I,commonTile:y,coefficients:u,swapRequired:M,rightToLeftSearchStartIndex:null})}if(n=this.parenthesesModel.getModelFromIndex(j),l=this._getResultantTermTile(n),i=this._getParentsTileArray(j,this.parenthesesModel),j=i.indexOf(n),i.remove(n),i.add(l,{at:j}),m=this.parenthesesModel.getModelFromIndex(k),l=this._getResultantTermTile(m,n),i=this._getParentsTileArray(k,this.parenthesesModel),k=i.indexOf(m),i.remove(m),i.add(l,{at:k}),M){for(f=[],F=0;F<e.length;F++)if(h=e.at(F),!N){if(h.get("operator")===K.ADDITION){N=!0,g=F;break}f.push(h)}for(e.at(0).set("operator","+"),e.at(g).set("operator",null),e.remove(f),F=0;F<f.length;F++)e.add(f[F])}d=c.indexOf(this.parenthesesOriginalModel),c.remove(this.parenthesesOriginalModel),c.add(this.parenthesesModel,{at:d})}return!0},_multiplyCommonTileToCoefficient:function(a){var c,d,e,f,g,h=a.commonTile,i=a.coefficients,j=a.swapRequired,k=a.modelRef,l=b.TileItem.OPERATORS,m=(b.TileItem.TileType,-1),n=-1,o=a.rightToLeftSearchStartIndex,p={};for((null===o||"undefined"==typeof o)&&(o=i.length-1),c=o;c>=0&&(e=i.at(c),h.get("isDenominator")===!1&&e.get("isDenominator")||(f=e.get("operator"),this._isTermTile(e)&&(g=e.get("base"),-1===g?m=c:1===g&&(n=c)),null!==f&&f!==l.ADDITION));c--);m>-1&&(j||-1===n)?(e=i.at(m),this._negativeOneTileReplacedAt=k.getIndexFromItemModel(e),h.get("squareRootProps")?(d=h.get("squareRootProps"),p={exponent:d.exponent,isNegative:!d.isNegative},h.set({operator:e.get("operator"),squareRootProps:p})):h.set({operator:e.get("operator"),base:-1*h.get("base")}),i.remove(e),i.add(h,{at:m})):n>-1?(e=i.at(n),this._oneTileReplacedAt=k.getIndexFromItemModel(e),h.set({operator:e.get("operator")}),i.remove(e),i.add(h,{at:n})):(e=i.at(c),f=e.get("operator"),this._eldestSiblingOperator=f,this._draggedOutTilePosition=k.getIndexFromItemModel(e),e.set("operator",l.MULTIPLICATION),h.set("operator",f),i.add(h,{at:c}))},_getParentsTileArray:function(a,b){var c,d,e;return c=a.split("."),d=c.shift(),e=b.get("tileArray"),c.length>0?this._getParentsTileArray(c.join("."),e.at(d)):e},_getResultantTermTile:function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=b.TileItem.OPERATORS,u=!1,v=!1;return s=b.TileItem.TileType,e=a.get("operator"),f=a.get("isLHS"),g=a.get("isDenominator"),l=1,c&&(r=c.get("type"),r===s.TERM_TILE&&(j=a.get("base"),m=a.get("iotaExponent"),o=a.get("squareRootProps")||{},k=c.get("base"),n=c.get("iotaExponent"),p=c.get("squareRootProps")||{},o.exponent&&o.exponent===p.exponent&&!m&&m===n&&j&&j===k?l=o.isNegative^p.isNegative?-1:1:o.exponent||p.exponent||m||n?-1!==k||p.exponent||n||(o.exponent?(l=j,u=$.extend(!0,{},o),u.isNegative=!u.isNegative):l="string"==typeof j?j.indexOf(t.SUBTRACTION)>-1?j.replace(t.SUBTRACTION,""):t.SUBTRACTION+j:-1*j,v=m):"string"==typeof k&&"string"==typeof j?(h=k.indexOf(t.SUBTRACTION)>-1^j.indexOf(t.SUBTRACTION)>-1,i=j.replace(t.SUBTRACTION,""),i===k.replace(t.SUBTRACTION,"")&&(l=h?-1:1)):"string"==typeof j?l=j.indexOf(t.SUBTRACTION)>-1?j.replace(t.SUBTRACTION,""):t.SUBTRACTION+j:j&&j%k===0&&(l=j/k))),q={type:b.TileItem.TileType.TERM_TILE,base:l,operator:e,isLHS:f,isDenominator:g},u&&(q.squareRootProps=u),v&&(q.iotaExponent=v),d=b.TileItem.createTileItem(q)},_isTermTile:function(a){return a&&a.get("type")===b.TileItem.TileType.TERM_TILE&&null===a.get("iotaExponent")&&null===a.get("squareRootProps")},_isNegativeTile:function(a){var c,d,e,f,g,h=b.TileItem.TileType,i=a.get("type"),j=!1;switch(i){case h.TERM_TILE:return e=a.get("base"),d=a.get("iotaExponent"),c=a.get("squareRootProps")||{},c.exponent?c.isNegative:"string"==typeof e?e.indexOf(b.TileItem.OPERATORS.SUBTRACTION)>-1:0>e;case h.FRACTION:for(g=a.get("tileArray"),f=0;f<g.length;f++)j^=this._isNegativeTile(g.at(f));return j}return!1},_takeOutCommonFromFraction:function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=a.sourceNode,B=a.sourceIndexString,C=(a.numerator,a.denominator,a.modelRef),D=a.relatedTileIndex,E=b.TileItem.OPERATORS,F=b.TileItem.TileType,G=!1,H=!1,I=!1;if("string"!=typeof D)return"number"==typeof D?D:!1;if(o=this.parenthesesParent.get("tileArray"),p=Number(this.parenthesesIndex.slice(this.parenthesesIndex.lastIndexOf(".")+1)),q=A.data.deepClone(),"-1"===D){for(p=Number(this.parenthesesIndex.slice(this.parenthesesIndex.lastIndexOf(".")+1)),c=this.parenthesesModel.get("tileArray").at(0),e=this.parenthesesIndex+".0",d=c.get("tileArray"),j=B.replace(e+".",""),k=D.replace(e+".",""),n=d.at(j),r=n.get("operator"),d.remove(n),z=d.length-1;z>=0;z--)if(d.at(z).get("isDenominator")){I=!0;break}for(I?d.add(this._getResultantTermTile(n),{at:j}):d.at(j)&&d.at(j).set("operator",r),v=[],z=p;z>=0;z--)if(s=o.at(z),t=s.get("operator"),s.get("type")===b.TileItem.TileType.TERM_TILE&&v.unshift(s),null===t||t===E.ADDITION){w=z;break}switch(s===this.parenthesesOriginalModel&&(s=this.parenthesesModel),u=s.get("type")){case F.PARENTHESES:this._eldestSiblingOperator=t,s.set("operator",E.MULTIPLICATION);case F.TERM_TILE:for(v.length>0&&(p-=v.length,o.remove(v),v[0].set("operator",null)),q.set("operator",null),x=b.TileItem.createTileItem({type:b.TileItem.TileType.FRACTION,operator:t,isLHS:q.get("isLHS")}),y=x.get("tileArray"),z=0;z<v.length;z++)y.add(v[z]);y.at(0).set("operator",null),y.add(q),o.add(x,{at:w}),p++,this._draggedOutTilePosition=C.getIndexFromItemModel(q);break;case F.FRACTION:this._multiplyCommonTileToCoefficient({modelRef:C,commonTile:q,coefficients:s.get("tileArray"),swapRequired:G,rightToLeftSearchStartIndex:null})}o.remove(this.parenthesesOriginalModel),o.add(this.parenthesesModel,{at:p}),this._denominatorAddedAt=C.getIndexFromItemModel(q)}else{for(c=this.parenthesesModel.get("tileArray").at(0),e=this.parenthesesIndex+".0",d=c.get("tileArray"),j=B.replace(e+".",""),k=D.replace(e+".",""),n=d.at(j),l=this._getResultantTermTile(n),d.remove(n),d.add(l,{at:+j}),m=c.getModelFromIndex(k),l=this._getResultantTermTile(m,n),k=d.indexOf(m),d.remove(m),d.add(l,{at:+k}),p=Number(this.parenthesesIndex.slice(this.parenthesesIndex.lastIndexOf(".")+1)),z=p;z>=0&&(s=o.at(z),t=s.get("operator"),null!==t&&t!==E.ADDITION);z--);switch(u=s.get("type")){case F.PARENTHESES:q.set("operator",t),s.set("operator",E.MULTIPLICATION),o.add(q,{at:z}),this._draggedOutTilePosition=C.getIndexFromItemModel(q),this._eldestSiblingOperator=t;break;case F.TERM_TILE:this._multiplyCommonTileToCoefficient({modelRef:C,commonTile:q,coefficients:o,swapRequired:G,rightToLeftSearchStartIndex:p});break;case F.FRACTION:this._multiplyCommonTileToCoefficient({modelRef:C,commonTile:q,coefficients:s.get("tileArray"),swapRequired:G,rightToLeftSearchStartIndex:null})}p=o.indexOf(this.parenthesesOriginalModel),o.remove(this.parenthesesOriginalModel),o.add(this.parenthesesModel,{at:p})}if(G){for(f=[],z=0;z<d.length&&(g=d.at(z),H||g.get("operator")!==E.ADDITION||(H=!0),H||f.push(g),!g.get("isDenominator"));z++)h=z;for(i=f.length,d.at(0).set("operator","+"),d.at(i).set("operator",null),d.remove(f),z=i-1;z>=0;z--)d.add(f[z],{at:h-i+1})}return!0},undo:function(a){var c,d,e,f,g,h,i,j,k,l,m=this.parenthesesParent.get("tileArray"),n=!0,o=Number(this.parenthesesIndex.slice(this.parenthesesIndex.lastIndexOf(".")+1));if("string"==typeof this._oneTileReplacedAt)c=a.getModelFromIndex(this._oneTileReplacedAt),e=this._oneTileReplacedAt.split("."),f=Number(e.pop()),g=e.join("."),i=a.getModelFromIndex(g).get("tileArray"),d=b.TileItem.createTileItem({type:b.TileItem.TileType.TERM_TILE,base:1,operator:c.get("operator"),isLHS:c.get("isLHS"),isDenominator:c.get("isDenominator")}),i.remove(c),i.add(d,{at:f});else if("string"==typeof this._negativeOneTileReplacedAt)c=a.getModelFromIndex(this._negativeOneTileReplacedAt),e=this._negativeOneTileReplacedAt.split("."),f=Number(e.pop()),g=e.join("."),i=a.getModelFromIndex(g).get("tileArray"),d=b.TileItem.createTileItem({type:b.TileItem.TileType.TERM_TILE,base:-1,operator:c.get("operator"),isLHS:c.get("isLHS"),isDenominator:c.get("isDenominator")}),i.remove(c),i.add(d,{at:f});else if(e=this._draggedOutTilePosition.split("."),f=Number(e.pop()),g=e.join("."),h=a.getModelFromIndex(g),i=h.get("tileArray"),i.remove(i.at(f)),d=a.getModelFromIndex(this._draggedOutTilePosition))d.set("operator",this._eldestSiblingOperator);else if(h instanceof b.FractionTile)if(0===i.length)m.remove(h),m.at(g.slice(g.lastIndexOf(".")+1)).set("operator",this._eldestSiblingOperator);else{for(l=[],k=i.length-1;k>=0;k--)if(d=i.at(k),l.push(d),d.get("isDenominator")){n=!1;break}if(n){for(m.remove(h),j=Number(g.slice(g.lastIndexOf(".")+1)),k=0;k<l.length;k++)m.add(l[k],{at:j});l.length&&m.at(j).set("operator",h.get("operator"))}}m.remove(m.at(o)),m.add(this.parenthesesOriginalModel,{at:o})}},{})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro,c=b.EquationManagerPro.Utils;b.RepositionCommand=b.BaseCommand.extend({_sourceIndexString:null,_destIndexString:null,_numberOfTiles:null,_bLeft:!0,_sourcePosition:null,_destPosition:null,execute:function(a,b,c){var d=c.source,e=c.dest;this._sourceIndexString=d.index,this._destIndexString=e.index,this._numberOfTiles=d.numOfTiles,this.fractionToDecimalAllowed=a.fractionToDecimalAllowed,this._bLeft=null===c.bLeft||"undefined"==typeof c.bLeft?this._bLeft:c.bLeft;var f=this._validateCommand(a,b,c.root);return f?(this._performResposition(b),b.printExpr(),!0):void 0},_validateCommand:function(a,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=!0,r=this._bLeft,s=0;if(f=this._sourceIndexString,g=this._destIndexString,this._sourcePosition=parseInt(c.getSourceWrtParent(f)),this._destPosition=parseInt(c.getSourceWrtParent(g)),i=d.getModelFromIndex(f),j=d.getModelFromIndex(g),h=this._numberOfTiles,k=c.getParentTiles(d,f),l=this._sourcePosition,f.charAt(0)!==g.charAt(0)||(!r||f!=g&&k.at(l+h)!==j)&&(r||k.at(l+h))){for(m=[],p=c.tilesToNodes(e,[j])[0],s=0;h>s;s++)m.push(k.at(l+s));n=c.tilesToNodes(e,m),o=c.getCommonParentFromMultiple(n),q=o.data===b.TileItem.OPERATORS.MULTIPLICATION&&o.children.length!==this._numberOfTiles?!1:this._validateUsingOperatorString(o,p)}else q=!1;return q},_validateUsingOperatorString:function(a,d){var e=c.getOperatorStringsBetween(a,d),f=b.TileItem.OPERATORS,g=!0,h=this._bLeft;return e.indexOf(f.DIVISION)>-1||e.indexOf(f.PARENTHESES)>-1?g=!1:1===e.length&&e[0]===f.MULTIPLICATION?g=!1:e[0]!==f.MULTIPLICATION||e[1]!==f.ADDITION&&e[1]!==f.EQUAL?d.data!==f.EQUAL&&(h&&null===d.prev()||!h&&null===d.next())&&(g=this._validateUsingOperatorString(a,d.parent)):g=!1,g},_performResposition:function(a){this._sourceIndexString.charAt(0)===this._destIndexString.charAt(0)?this._performIntraResposition(a):(this._performInterResposition(a),this.fractionToDecimalAllowed&&this._setTilesForEndResult(a,!0))},_performIntraResposition:function(a){var d,e,f=this._sourceIndexString,g=(this._destIndexString,this._numberOfTiles),h=b.TileItem.OPERATORS,i=c.getParentTiles(a,f),j=this._sourcePosition,k=this._destPosition,l=0,m=this._bLeft?0:1,n=[];for(k>j&&(l=-1*g),i.at(0).set("operator",h.ADDITION),d=0;g>d;d++)e=i.at(j+d),null===e.get("operator")&&e.set("operator",h.ADDITION),n[d]=e;for(i.remove(n),d=0;g>d;d++)i.add(n[d],{at:k+d+l+m});i.at(0).set("operator",null)},_performInterResposition:function(a){var d,e,f,g=this._sourceIndexString,h=this._destIndexString,i=b.TileItem.OPERATORS,j=c.getParentTiles(a,g),k=c.getParentTiles(a,h),l=this._sourcePosition,m=this._destPosition,n=[];for(j.at(0).set("operator",i.ADDITION),d=0;d<this._numberOfTiles;d++)f=j.at(l+d),null===f.get("operator")&&f.set("operator",i.ADDITION),this._negate(f),n[d]=f;for(j.remove(n),this._convertDraggableZeroToStatic=!1,1===j.length&&(f=j.at(0),f.get("type")===b.TileItem.TileType.TERM_TILE&&0===f.get("base")&&(j.remove(f),c.checkAndGenerateStaticZeroForEquation(a),this._convertDraggableZeroToStatic=!0)),c.checkAndGenerateStaticZeroForEquation(a),j.at(0).set("operator",null),k.at(0).set("operator",i.ADDITION),1===k.length&&(f=k.at(0),f.get("type")===b.TileItem.TileType.TERM_TILE&&0===f.get("base")&&(k.remove(f),this._bLeft=!0)),e=this._bLeft?0:1,d=0;d<this._numberOfTiles;d++)f=n[d],f.setIsLHS(!f.get("isLHS")),k.add(f,{at:m+d+e});k.at(0).set("operator",null),1===k.length&&(f=k.at(0),f.get("type")===b.TileItem.TileType.TERM_TILE&&0===f.get("base")&&(k.remove(f),c.checkAndGenerateStaticZeroForEquation(a)))},_negate:function(c){var d,e,f,g,h,i=c.get("type"),j=b.TileItem.OPERATORS,k=a.Common.Components.Models.EquationManagerPro.TileItem.TileType;if([null,j.ADDITION].indexOf(c.get("operator"))>-1)switch(i){case k.TERM_TILE:d=c.get("base"),"number"==typeof d?d*=-1:(h=d.indexOf(j.SUBTRACTION),d=h>-1?d.slice(h+1):j.SUBTRACTION+d),c.set("base",d);break;case k.FRACTION:for(e=c.get("tileArray"),f=0;f<e.length&&(g=e.at(f),!g.get("isDenominator"));f++)this._negate(g);break;case k.PARENTHESES:for(e=c.get("tileArray"),f=0;f<e.length;f++)g=e.at(f),this._negate(g)}},_setTilesForEndResult:function(a,c){var d,e,f,g;a&&(d=a.get("tileArray").at(0).get("tileArray"),e=a.get("tileArray").at(1)?a.get("tileArray").at(1).get("tileArray"):[],1===d.length&&1===e.length&&(f=d.at(0),g=e.at(0),(f.get("type")===b.TileItem.TileType.TERM_TILE&&g.get("type")===b.TileItem.TileType.TERM_TILE&&"t"!==f.get("base")&&"t"===g.get("base")||f.get("type")===b.TileItem.TileType.TERM_TILE&&g.get("type")===b.TileItem.TileType.TERM_TILE&&"t"===f.get("base")&&"t"!==g.get("base"))&&(f.set("endResult",c),g.set("endResult",c))))},undo:function(a){this._sourceIndexString.charAt(0)===this._destIndexString.charAt(0)?this._undoIntraReposition(a):(this.fractionToDecimalAllowed&&this._setTilesForEndResult(a,!1),this._undoInterReposition(a)),a.printExpr()},_undoIntraReposition:function(a){var d,e,f=this._sourceIndexString,g=(this._destIndexString,this._numberOfTiles),h=this._bLeft?0:1,i=b.TileItem.OPERATORS,j=c.getParentTiles(a,f),k=this._sourcePosition,l=this._destPosition,m=0,n=[];for(l>k&&(m=-1*g),j.at(0).set("operator",i.ADDITION),d=0;g>d;d++)e=j.at(l+d+m+h),null===e.get("operator")&&e.set("operator",i.ADDITION),n[d]=e;for(j.remove(n),d=0;g>d;d++)j.add(n[d],{at:k+d});j.at(0).set("operator",null)},_undoInterReposition:function(a){var d,e,f=this._sourceIndexString,g=this._destIndexString,h=this._numberOfTiles,i=b.TileItem.OPERATORS,j=c.getParentTiles(a,f),k=c.getParentTiles(a,g),l=this._sourcePosition,m=this._destPosition,n=this._bLeft?0:1,o=[];for(1===k.length&&(e=k.at(0),e.get("type")===b.TileItem.TileType.TERM_TILE&&0===e.get("base")&&(k.remove(e),e=b.TileItem.createTileItem({type:b.TileItem.TileType.TERM_TILE,base:0,operator:null,isDraggable:!0,isDroppable:!0,ignoreMarquee:!0,isLHS:e.get("isLHS")}),k.add(e))),k.at(0).set("operator",i.ADDITION),d=0;h>d;d++)e=k.at(m+d+n),null===e.get("operator")&&e.set("operator",i.ADDITION),this._negate(e),o[d]=e;for(k.remove(o),c.checkAndGenerateStaticZeroForEquation(a),k.at(0).set("operator",null),this._convertDraggableZeroToStatic&&(e=j.at(0),j.remove(e),e=b.TileItem.createTileItem({type:b.TileItem.TileType.TERM_TILE,base:0,operator:null,isDraggable:!0,isDroppable:!0,ignoreMarquee:!0,isLHS:e.get("isLHS")}),j.add(e)),j.at(0).set("operator",i.ADDITION),this._convertDraggableZeroToStatic||1!==j.length||(e=j.at(0),e.get("type")===b.TileItem.TileType.TERM_TILE&&0===e.get("base")&&j.remove(e)),d=0;h>d;d++)e=o[d],e.setIsLHS(!e.get("isLHS")),j.add(e,{at:l+d});j.at(0).set("operator",null)}},{})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro,c=b.EquationManagerPro.Utils;b.AddTile=b.BaseCommand.extend({sourceIndex:null,sourcePos:null,addedTile:null,parenthesesAdded:null,fractionAdded:null,changeOperatorAtSP:"",staticZeroRemoved:!1,isIgnoreUndo:!1,initialize:function(){},execute:function(a,b,d){var e,f,g=d.source.index;return null===d.tileValue&&(this.isIgnoreUndo=!0,this.dummyTileValue=d.dummyTileValue),this.sourceIndex=g,this.sourcePos=parseInt(c.getSourceWrtParent(g)),e=b.getModelFromIndex(c.getParentIndex(g)),f=e.get("tileArray"),this._makeNonDragZeroToDrag(e),d.parenthesesAdded&&this._addParenthesesToExpression(f,d.isLHS),d.fractionAdded?this._addFractionToExpression(f,d.isLHS,d.tilesToAddInFraction,d.tileValue):this._addTileAtIndex(e,d.isLHS,d.isDenominator,d.tileValue,d.operation)},_addTileAtIndex:function(a,b,c,d,e){var f,g=a.get("tileArray"),h=this._addTermTile(d,c,b,null,!0);return f=g.at(this.sourcePos),f&&f.get("isDenominator")===c&&(this.changeOperatorAtSP=f.get("operator"),f.set("operator",e)),0!==this.sourcePos&&c===!1&&h.set("operator",e),g.add(h,{at:this.sourcePos}),!0},_addFractionToExpression:function(a,c,d,e){var f,g,h,i,j=b.TileItem.createTileItem,k=b.TileItem.OPERATORS,l=b.TileItem.TileType,m=[];if(f=j({type:b.TileItem.TileType.FRACTION,operator:null,isDenominator:!1,isLHS:c}),h=f.get("tileArray"),d>0){for(i=this.sourcePos;d>i;i++)g=a.at(i),m.push(g),h.add(g);a.remove(m),h.add(this._addTermTile(e,!0,c,null,!0))}else h.add(this._addTermTile(1,!1,c,null,!1)),h.add(this._addTermTile(e,!0,c,null,!1)),2===a.length&&a.at(0).get("type")===l.PARENTHESES&&a.at(1).get("type")===l.PARENTHESES&&a.at(1).get("operator")===k.MULTIPLICATION&&a.at(0).set("operator",k.MULTIPLICATION);return a.add(f,{at:this.sourcePos}),this.fractionAdded=f,!0},_addParenthesesToExpression:function(a,c){var d,e,f,g,h=b.TileItem.createTileItem,i=[];for(d=h({type:b.TileItem.TileType.PARENTHESES,operator:"*",isDenominator:!1,isLHS:c}),f=d.get("tileArray"),g=0;g<a.length;g++)e=a.at(g),i.push(e),f.add(e);a.remove(i),a.add(d),this.parenthesesAdded=d},_addTermTile:function(a,c,d,e,f){var g,h=b.TileItem.createTileItem;return g=h({base:a,isDenominator:c,isLHS:d,operator:e,type:b.TileItem.TileType.TERM_TILE,tileToReplace:null===a?this.dummyTileValue:null}),f===!0&&(this.addedTile=g),g},_makeNonDragZeroToDrag:function(a){var c,d=a.get("tileArray"),e=b.TileItem.TileType;a.get("type")===e.EXPRESSION&&1===d.length&&d.at(0).get("type")===e.TERM_TILE&&0===d.at(0).get("base")&&(c=d.at(0).deepClone(),c.set({isDraggable:!0,isDroppable:!0}),d.remove(d.at(0)),d.add(c),this.staticZeroRemoved=!0)},undo:function(a){var d,e,f,g,h=[],i=b.TileItem.OPERATORS,j=b.TileItem.TileType;if(d=a.getModelFromIndex(c.getParentIndex(this.sourceIndex)),e=d.get("tileArray"),this.fractionAdded){for(this.addedTile&&(h=this.fractionAdded.get("tileArray").where({isDenominator:!1})),e.remove(this.fractionAdded),f=0;f<h.length;f++)e.add(h[f],{at:f+this.sourcePos});2===e.length&&e.at(0).get("type")===j.PARENTHESES&&e.at(1).get("type")===j.PARENTHESES&&e.at(1).get("operator")===i.MULTIPLICATION&&e.at(0).set("operator",null)}else this.addedTile&&(e.remove(e.at(this.sourcePos)),""!==this.changeOperatorAtSP&&e.at(this.sourcePos).set("operator",this.changeOperatorAtSP));if(this.parenthesesAdded)for(h=this.parenthesesAdded.get("tileArray").models,e.remove(this.parenthesesAdded),f=0;f<h.length;f++)e.add(h[f],{at:f+this.sourcePos});this.staticZeroRemoved&&(g=e.at(0).deepClone(),g.set({isDraggable:!1,isDroppable:!1}),e.remove(e.at(0)),e.add(g))}})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro,c=b.EquationManagerPro.Utils;b.ReplaceTile=b.BaseCommand.extend({tileToReplace:null,sourceIndex:null,sourcePos:null,initialize:function(){},execute:function(a,b,d){var e,f,g,h,i=d.source.index,j=d.tileValue;return this.sourceIndex=i,this.sourcePos=parseInt(c.getSourceWrtParent(i)),e=b.getModelFromIndex(c.getParentIndex(i)),f=e.get("tileArray"),h=f.at(this.sourcePos),null!==h.get("base")?!1:(this.tileToReplace=h,g=h.deepClone(),g.set("base",j),g.set("tileToReplace",null),f.remove(h),f.add(g,{at:this.sourcePos}),!0)},undo:function(a){var b,d=this.sourceIndex;b=c.getParentTiles(a,d),b.remove(b.at(this.sourcePos)),b.add(this.tileToReplace,{at:this.sourcePos})}})}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManagerPro;a.ParenthesesTile=a.TileItem.extend({defaults:$.extend(!0,{},a.TileItem.prototype.defaults,{type:a.TileItem.TileType.PARENTHESES_TILE,exponent:null}),initialize:function(){a.ParenthesesTile.__super__.initialize.apply(this,arguments);var b,c=[],d=[];if(null===this.get("tileArray")&&this.set("tileArray",[]),c=this.get("tileArray"),c instanceof Array){for(b=0;b<c.length;b++)d[b]=a.TileItem.createTileItem(c[b]);this.set("tileArray",new Backbone.Collection(d))}},getTree:function(){var b,c,d,e=this.get("tileArray"),f=e.length,g=[],h=[];for(b=0;f>b;b++)if(d=e.at(b),c=d.get("operator"),a.EquationManagerPro.Utils.isBasicTileType(d))if(null===c){for(;0!==g.length;)h.push(g.pop());h.push(d)}else{for(;g.length>0&&this.isPrecedent(g[g.length-1],c);)h.push(g.pop());g.push(c),h.push(d)}else{if(null!==c){for(;g.length>0&&this.isPrecedent(g[g.length-1],c);)h.push(g.pop());g.push(c)}Array.prototype.push.apply(h,d.getTree())}for(0===f&&h.push(null);g.length>0;)h.push(g.pop());return h.push(this.get("exponent")),h.push(a.TileItem.OPERATORS.PARENTHESES),
h.push(this),h},getModelFromIndex:function(a){var b,c,d=this.get("tileArray");return a?(b=a.split("."),c=parseInt(b[0],10),b.splice(0,1),d.at(c)?this.get("tileArray").at(c).getModelFromIndex(b.join(".")):null):""===a?this:null},printExpr:function(){var b=0,c=this.get("exponent"),d=this.get("tileArray"),e=this.get("operator")||"",f="";for(b=0;b<d.models.length;b++)f+=d.at(b).printExpr();return f="("+f+")",c&&(f+=a.TileItem.OPERATORS.PARENTHESES+c),f=e+f},checkSimplest:function(){return!1},checkIfSimplestFormFractionCase:function(){return!1}},{})}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManagerPro;a.SquaredParenthesesTile=a.ParenthesesTile.extend({defaults:$.extend(!0,{},a.TileItem.prototype.defaults,{type:a.TileItem.TileType.SQUARED_PARENTHESES}),initialize:function(){a.SquaredParenthesesTile.__super__.initialize.apply(this,arguments);var b,c=[],d=[];if(null===this.get("tileArray")&&this.set("tileArray",[]),c=this.get("tileArray"),c instanceof Array){for(b=0;b<c.length;b++)d[b]=a.TileItem.createTileItem(c[b]);this.set("tileArray",new Backbone.Collection(d))}},getTree:function(){},printExpr:function(){var b=0,c=this.get("exponent"),d=this.get("tileArray"),e=this.get("operator")||"",f="";for(b=0;b<d.models.length;b++)f+=d.at(b).printExpr();return f="["+f+"]",c&&(f+=a.TileItem.OPERATORS.PARENTHESES+c),f=e+f}},{})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManagerPro;a.FractionTile=a.TileItem.extend({defaults:$.extend(!0,{},a.TileItem.prototype.defaults,{type:a.TileItem.TileType.FRACTION_TILE}),initialize:function(){a.FractionTile.__super__.initialize.apply(this,arguments);var b,c=[],d=[];if(null===this.get("tileArray")&&this.set("tileArray",[]),c=this.get("tileArray"),c instanceof Array){for(b=0;b<c.length;b++)d[b]=a.TileItem.createTileItem(c[b]);this.set("tileArray",new Backbone.Collection(d))}},getTree:function(){var b,c,d,e=this.get("tileArray"),f=e.length,g=[],h=[];for(b=0;f>b;b++)if(d=e.at(b),c=d.get("operator"),0===b&&d.get("isDenominator")===!0&&h.push(1),a.EquationManagerPro.Utils.isBasicTileType(d))if(null===c){for(;0!==g.length;)h.push(g.pop());h.push(d)}else{for(;g.length>0&&this.isPrecedent(g[g.length-1],c);)h.push(g.pop());g.push(c),h.push(d)}else{if(null!==c){for(;g.length>0&&this.isPrecedent(g[g.length-1],c);)h.push(g.pop());g.push(c)}Array.prototype.push.apply(h,d.getTree())}for(;g.length>0;)h.push(g.pop());return"undefined"==typeof this.getFirstDenominatorTile()&&h.push(1),h.push(a.TileItem.OPERATORS.DIVISION),h.push(this),h},getDenominatorLength:function(){var a=this.get("tileArray"),b=a.where({isDenominator:!0});return b.length},getFirstDenominatorTile:function(){var a=this.get("tileArray");return a?a.findWhere({isDenominator:!0}):void 0},getNumeratorLength:function(){var a=this.get("tileArray"),b=a.where({isDenominator:!1});return b.length},getModelFromIndex:function(a){var b,c,d=this.get("tileArray");return a?(b=a.split("."),c=parseInt(b[0],10),b.splice(0,1),d.at(c)?this.get("tileArray").at(c).getModelFromIndex(b.join(".")):null):""===a?this:null},printExpr:function(){var a=0,b=(this.get("exponent"),this.get("tileArray")),c=this.get("operator")||"";for(c+="{",a=0;a<b.length&&b.at(a).get("isDenominator")===!1;a++)c+=b.at(a).printExpr();for(c+="} / {";a<b.length;a++)c+=b.at(a).printExpr();return c+="}"},checkSimplest:function(){return!1},checkIfSimplestFormFractionCase:function(){var a,b,c,d,e,f=this.get("tileArray"),g=this.getNumeratorLength();return g>1||f.length>2?!1:(a=f.at(0),b=f.at(1),c=a&&a.checkIfSimplestFormFractionCase(!0),d=b&&b.checkIfSimplestFormFractionCase(!0),c&&d?0>c&&0>d?!1:1===Math.abs(d)?!1:1===Math.abs(c)?!0:(e=MathInteractives.Common.Components.Models.EquationManagerPro.EquationManagerPro.Utils.getGCF(c,d),1===Math.abs(e)?!0:!1):!1)},checkFractionToDecimalCase:function(){var a,b,c,d,e=this.get("tileArray"),f=this.getNumeratorLength();return f>1||e.length>2?!1:(a=e.at(0),b=e.at(1),c=a&&a.checkIfSimplestFormFractionCase(!0),d=b&&b.checkIfSimplestFormFractionCase(!0),c&&d?1===Math.abs(d)?!1:!0:!1)}},{})}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManagerPro;a.Expression=a.TileItem.extend({defaults:$.extend(!0,{},a.TileItem.prototype.defaults,{type:a.TileItem.TileType.EXPRESSION}),initialize:function(){a.Expression.__super__.initialize.apply(this,arguments);var b,c=[],d=[];if(null===this.get("tileArray")&&this.set("tileArray",[]),c=this.get("tileArray"),c instanceof Array){for(b=0;b<c.length;b++)d[b]=a.TileItem.createTileItem(c[b]);this.set("tileArray",new Backbone.Collection(d))}},getTree:function(){var b,c,d,e=this.get("tileArray"),f=e.length,g=[],h=[];for(b=0;f>b;b++)if(d=e.at(b),c=d.get("operator"),a.EquationManagerPro.Utils.isBasicTileType(d))if(null===c){for(;0!==g.length;)h.push(g.pop());h.push(d)}else{for(;g.length>0&&this.isPrecedent(g[g.length-1],c);)h.push(g.pop());g.push(c),h.push(d)}else{if(null!==c){for(;g.length>0&&this.isPrecedent(g[g.length-1],c);)h.push(g.pop());g.push(c)}Array.prototype.push.apply(h,d.getTree())}for(;g.length>0;)h.push(g.pop());return h},getModelFromIndex:function(a){var b,c,d=this.get("tileArray");return a?(b=a.split("."),c=parseInt(b[0],10),b.splice(0,1),d.at(c)?this.get("tileArray").at(c).getModelFromIndex(b.join(".")):null):""===a?this:null},printExpr:function(){var a=this.get("tileArray"),b=0,c="";for(b=0;b<a.length;b++)c+=a.at(b).printExpr();return c},checkSimplest:function(){var a,b=this.get("tileArray"),c=0,d="";for(c=0;c<b.length;c++){if(a=b.at(c).checkSimplest(),a===!1)return!1;d+=a}return d},checkIfSimplestFormFractionCase:function(){var a=this.get("tileArray");return a.length>1?!1:a.at(0).checkIfSimplestFormFractionCase()},checkFractionToDecimalCase:function(){var a=this.get("tileArray");return a.length>1?!1:a.at(0).checkFractionToDecimalCase()}},{})}(),function(a){"use strict";var b=a.Common.Components.Models.EquationManagerPro;b.TermTile=b.TileItem.extend({defaults:$.extend(!0,{},b.TileItem.prototype.defaults,{base:null,type:b.TileItem.TileType.TERM_TILE,isDraggable:!0,isDroppable:!0,ignoreMarquee:!1,iotaExponent:null,squareRootProps:null,isVariable:null,endResult:!1}),initialize:function(){b.TermTile.__super__.initialize.apply(this,arguments)},getModelFromIndex:function(a){return""===a?this:null},printExpr:function(){var a="",c=b.TileItem.OPERATORS,d=this.get("base"),e=this.get("iotaExponent"),f=this.get("squareRootProps");return a=this.get("operator")||"",f&&(f.isNegative&&(a+=c.SUBTRACTION),f.exponent&&(a+="√")),(d||0===d||"0"===d)&&(a+=d),e&&(a+=e>1?"i"+c.PARENTHESES+e:"i"),a},checkSimplest:function(){var a="",b=this.get("base"),c=this.get("iotaExponent"),d=this.get("squareRootProps");if(a=this.get("operator")||"",d)return!1;if((b||0===b)&&(a+=b),c){if(c>1)return!1;a+="i"}return a},checkIfSimplestFormFractionCase:function(a){var b;return a?this.checkIfVariablePresent()?!1:this.get("base"):(b=this.get("base"),_.isString(b)&&-1!==b.indexOf("-")?!1:!0)},checkFractionToDecimalCase:function(){var a=this.get("base");return"t"===a?!0:!1},checkIfVariablePresent:function(){return _.isString(this.get("base"))?!0:!1}},{})}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManagerPro,b=MathInteractives.Common.Components.Models.EquationManagerPro;a.TileView=MathInteractives.Common.Player.Views.Base.extend({initialize:function(){var a=this.options;this.parent=a.parent,this.player=a.player,this.equationManager=a.equationManager,this.isTutorialMode=a.isTutorialMode,this.render()},refresh:function(){var a=this.tileViews,b=0;if(a)for(b=0;b<a.length;b++)a[b].refresh()},enableOperator:function(a){var b=a?"enable":"disable",c=this.parent.$operatorViews[this.parent.tileViews.indexOf(this)];c&&c.is(".ui-droppable")&&c.droppable(b)},attachDetachDroppable:function(c,d){var e,f,g=this.tileViews||[],h=this.$operatorViews||[],i=c?"enable":"disable",j=a.EquationManagerPro.TILE_INSIDE_MARQUEE;if(g.length>0)for(e=0;e<g.length;e++)g[e].attachDetachDroppable(c,d),d&&h[e]&&h[e].is(".ui-droppable")&&!h[e].hasClass(j)&&(h[e].droppable(i),c||(h[e].find(".insertion-cursor").hide(),h[e].find(".add-sign-in-null-operator").hide()));this.$el.is(".ui-droppable")&&!this.$el.hasClass(j)&&(f=this.parent.$operatorViews[this.parent.tileViews.indexOf(this)],d&&f&&f.is(".ui-droppable")&&!f.hasClass(j)&&(f.droppable(i),c||(f.find(".insertion-cursor").hide(),f.find(".add-sign-in-null-operator").hide())),this.model.get("type")!==b.TileItem.TileType.EXPRESSION?this.$el.droppable(i):(f=this.$(".right-null-operator-container"),f&&f.is(".ui-droppable")&&(f.droppable(i),c||(f.find(".insertion-cursor").hide(),f.find(".add-sign-in-null-operator").hide()))))},enableOperators:function(a){var b,c,d=this.tileViews,e=null,f=a?"enable":"disable";for(this.parent&&(b=this.parent.$operatorViews[this.parent.tileViews.indexOf(this)]),b&&b.is(".ui-droppable")&&b.droppable(f),e=this.$(".right-null-operator-container"),e.is(".ui-droppable")&&e.droppable(f),c=0;c<d.length;c++)d[c].enableOperators(a)},getMarqueeContainsNullTile:function(){var a,c,d=this.tileViews;if(this.model.get("type")===b.TileItem.TileType.TERM_TILE)return null===this.model.get("base")?!0:!1;for(a=0;a<d.length;a++)if(c=d[a].getMarqueeContainsNullTile())return c},addClassForAllTilesInsideMarquee:function(){var b,c,d=this.tileViews||[],e=this.$operatorViews||[];if(d.length>0)for(b=0;b<d.length;b++)d[b].addClassForAllTilesInsideMarquee(),e[b]&&e[b].addClass(a.EquationManagerPro.TILE_INSIDE_MARQUEE);c=this.parent.$operatorViews[this.parent.tileViews.indexOf(this)],c&&c.addClass(a.EquationManagerPro.TILE_INSIDE_MARQUEE),this.$el.addClass(a.EquationManagerPro.TILE_INSIDE_MARQUEE)},_getClosedHandCss:function(){return this.equationManager.isTouch()?{}:{cursor:"url('"+this.getImagePath("closed-hand")+"'), move"}},_getOpenHandCss:function(){return this.equationManager.isTouch()?{}:{cursor:"url('"+this.getImagePath("open-hand")+"'), move"}},_getDefaultCursorCss:function(){return this.equationManager.isTouch()?{}:{cursor:""}},getIndex:function(a){var b=this.tileViews.indexOf(a);return this.parent.getIndex(this)+"."+b},stopListeningEvents:function(a){if(a)for(var b=0;b<this.tileViews.length;b++)this.tileViews[b].stopListeningEvents(!0);this.stopListening()},changeOperatorArray:function(a,c){var d,e,f,g;d=this.model.get("tileArray"),e=d.indexOf(a),g=this.$operatorViews[e],g&&(g.is(".ui-droppable")&&g.droppable("disable"),g.off(),g.remove()),f=this.model.get("type")!==b.TileItem.TileType.PARENTHESES&&a.get("type")===b.TileItem.TileType.PARENTHESES?this.createOperator(c,null,a.get("type")):this.model.get("type")===b.TileItem.TileType.PARENTHESES&&a.get("type")===b.TileItem.TileType.PARENTHESES?this.createOperator(c,a.get("type")):this.createOperator(c),null!==f&&(f.insertBefore(this.tileViews[e].el),this.$operatorViews[e]=f,"*"===c?this.tileViews[e].$el.addClass("multiplied-tile"):this.attachEventsOnOperator(f)),(this.$operatorViews[e].hasClass("multiplication-operator-container")||this.$operatorViews[e].hasClass("null-operator-container"))&&null===c&&this.tileViews[e].$el.removeClass("multiplied-tile"),this.$operatorViews.splice(e,1,f)},enableDisableTiles:function(a){for(var c,d=this.tileViews,e=0,f=this.model.get("type"),g=b.TileItem.TileType;e<d.length;e++)d[e].enableDisableTiles(a);this.parent&&(c=this.parent.$operatorViews[this.parent.tileViews.indexOf(this)]),a?(c&&c.removeClass("disable"),(f===g.TERM_TILE||f===g.PARENTHESES)&&(this.$base.removeClass("disable"),this.isTileDisabled=!a,f===g.PARENTHESES&&(this.$exponent&&this.$exponent.removeClass("disable"),this.$leftBracket.removeClass("disable"),this.$rightBracket.removeClass("disable")),this.$el.is(".ui-draggable")&&this.$el.draggable("enable"))):(c&&c.addClass("disable"),(f===g.TERM_TILE||f===g.PARENTHESES)&&(this.$base.addClass("disable"),this.isTileDisabled=!a,f===g.PARENTHESES&&(this.$exponent&&this.$exponent.addClass("disable"),this.$leftBracket.addClass("disable"),this.$rightBracket.addClass("disable")),this.$el.is(".ui-draggable")&&this.$el.draggable("disable")))},enableDisableTilesItem:function(a,b){var c,d=null;a&&(c=a.split("|"),d=this.getViewFromIndex(c[0]),d&&(d.enableDisableTiles(b),d.attachDetachDroppable(!0,!0)))},getValueText:function(a){var b=this.model.get(a);return"string"==typeof b&&-1!==b.indexOf("-")?(b="<em>"+b+"</em>","&minus;"+b.replace("-","")):null!==b&&void 0!==b?isNaN(b)?0>b?"&minus;"+Math.abs(b):"<em>"+b.toString()+"</em>":0>b?"&minus;"+Math.abs(b):b.toString():b},getViewFromIndex:function(a){var b,c=a.indexOf(".");return c=-1===c?this.tileViews.length:c,b=parseInt(a.substring(0,c)),a.length>1?(a=a.substring(c+1,a.length),""===a?this.tileViews[b]:this.tileViews[b].getViewFromIndex(a)):this.tileViews[b]},reset:function(){for(var a=this.tileViews,b=0;b<a.length;b++)a[b].reset();this.$el.off().empty(),this.off()},highlightTiles:function(){var a=this.tileViews,b=a.length,c=0;if(0!==b)for(;b>c;c++)a[c].highlightTiles();else this.$el.addClass("hover-border")},invertText:function(a){var b="−",c=parseInt(a),d=null;return-1===a.indexOf(b)?isNaN(c)?b+"<em>"+a+"</em>":b+a:(d=a.substr(b.length),isNaN(parseInt(d))?"<em>"+d+"</em>":d)},addNullTileCase:function(a,c){var d,e,f,g={},h=this.model.get("isLHS");null===this.equationManager.getTileAddedInExpression()?(this.equationManager.setTileAddedInExpression(h),h?(d=this.equationManager.equationView.tileViews[1],e=d.fractionIndex):(d=this.equationManager.equationView.tileViews[0],e=d.multiplicationIndex),a===b.TileItem.OPERATORS.ADDITION?(g={operation:"+",tileValue:null,index:d.parent.getIndex(d).substr(0,1)+"."+d.tileViews.length,isLHS:!h,isDenominator:!1,dummyTileValue:c},this.equationManager.onAddTile(g),this.equationManager.scrollExpression(d,"scrollToRight")):(this.isDenominator||this.model.get("isDenominator")?(f=!0,e=d.fractionIndex):(f=!1,e=d.multiplicationIndex),g={isLHS:d.model.get("isLHS"),isDenominator:this.isDenominator||this.model.get("isDenominator"),index:d.multiplicationIndex?e:d.index,operation:"*",tileValue:null,parenthesesAdded:d.parenthesesAdded,fractionAdded:d.multiplicationIndex?d.fractionAdded:f,tilesToAddInFraction:d.tilesToAddInFraction,dummyTileValue:c},this.equationManager.onAddTile(g))):this.equationManager.setTileAddedInExpression()},containsNullTile:function(){for(var a,c=this.tileViews,d=0;d<c.length;d++)if(a=c[d].containsNullTile())return a;return this.model.get("type")===b.TileItem.TileType.TERM_TILE?null===this.model.get("base")?this:!1:void 0},hasChildView:function(a,b){var c=this.tileViews,d=0;if(-1!==c.indexOf(a))return!0;if(b)for(;d<c.length;d++)if(c[d].hasChildView(a))return!0;return!1},checkForNestedLevelOfParentheses:function(){var a,c,d=this.tileViews,e=0;if(this.model.get("type")===b.TileItem.TileType.PARENTHESES&&(a=this.parent.getIndex(this),a=b.EquationManagerPro.Utils.getParentIndex(a),this.equationManager.equationView.getViewFromIndex(a).model.get("type")===b.TileItem.TileType.PARENTHESES))return!0;for(;e<d.length;e++)if(c=d[e].checkForNestedLevelOfParentheses())return c},hideOperatorOfParCoeff:function(){for(var a=this.tileViews,b=0;b<a.length;b++)a[b].hideOperatorOfParCoeff()},getNextTile:function(){if(this.parent){var a=this.parent.tileViews.indexOf(this);return this.parent.tileViews[a+1]?this.parent.tileViews[a+1]:void 0}},getPrevTile:function(){if(this.parent){var a=this.parent.tileViews.indexOf(this);return this.parent.tileViews[a-1]?this.parent.tileViews[a-1]:void 0}},deActivateEventOnTiles:function(a){var b,c=this.tileViews,d=0;if(c&&(d=c.length),d>0&&a)for(var e=0;d>e;e++)b=c[e],b.deActivateEventOnTiles(a)},getOperatorFromTileItem:function(a){if(this.tileViews){var b=this.tileViews.indexOf(a);return this.$operatorViews[b]}return null},coefficientOfXWithFraction:function(){return!1}},{createTileItemView:function(c,d,e,f,g){var h,i=b.TileItem.TileType,j={model:c,parent:d,equationManager:e,player:f,isTutorialMode:g};switch(c.get("type")){case i.TERM_TILE:h=new a.TermTileView(j);break;case i.PARENTHESES:h=new a.ParenthesesTileView(j);break;case i.FRACTION:h=new a.FractionTileView(j);break;case i.SQUARED_PARENTHESES:h=new a.SquaredParenthesesTileView(j);break;case i.EXPRESSION:h=new a.ExpressionTileView(j);break;case i.EQUATION:h=new a.EquationView(j);break;default:throw new Error("Invalid tile type")}return h},CLASSES:{TermTile:"term-tile",BASE:"base",EXPONENT:"exponent",BASE_ONLY:"base-only",Bracket:"bracket",PARENTHESES:"parentheses",LeftBracket:"left-bracket",RightBracket:"right-bracket",FRACTION:"fraction-component",NUMERATOR:"numerator",DENOMINATOR:"denominator",VINICULUM:"vinicullum",Level:"level",OperatorContainer:"operator-container",Operator:"operator","*":"multiplication","+":"addition"},Scroll:{SENSITIVITY:50,SPEED:MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?40:function(){var a=MathInteractives.Common.Utilities.Models.BrowserCheck;return a.isIE||a.isIE11?!0:!1}()?60:30,ENABLE:!0}})}(),function(a){"use strict";var b=a.Common.Components.Views.EquationManagerPro;a.Common.Components.Models.EquationManagerPro,a.Common.Utilities.Models.Rect,a.Common.Utilities.Models.Point;b.EquationView=b.TileView.extend({tileViews:null,$operatorViews:null,initialize:function(){this.tileViews=[],this.$operatorViews=[],b.EquationView.__super__.initialize.apply(this,arguments),this.initializeDefaultProperties()},render:function(){var a=this.model.get("tileArray"),c=0;for(c=0;c<a.length;c++)this.tileViews[c]=new b.TileView.createTileItemView(a.at(c),this,this.equationManager,this.player,this.isTutorialMode)},checkForFractionInExpression:function(){for(var a=this.tileViews,b=0;b<a.length;b++)a[b].checkForFractionInExpression()},createView:function(){var b,c,d=a.Common.Components.templates.equationViewTemplate({idPrefix:this.idPrefix+this.equationManager.postIdPrefixString,isMobile:this.isMobile}),e=$(d);b=e.find(".lhs-expression-view-expression"),c=e.find(".rhs-expression-view-expression");var f,g=0,h=this.tileViews;for(g=0;g<h.length;g++)h[g].model.get("isLHS")===!0?(f=h[g].createView(),b.append(f)):(f=h[g].createView(),c.append(f));this.$el.append(e)},setEquationContainer:function(a){this.setElement(a)},attachEvents:function(){var a=0,b=this.tileViews;for(a=0;a<b.length;a++)b[a].attachEvents()},refresh:function(){this.curHoveredTile&&(this.curHoveredTile.$el.removeClass("white-border-left white-border-right"),this.curHoveredTile=null),b.EquationView.__super__.refresh.apply(this,arguments)},getIndex:function(a){var b=this.tileViews.indexOf(a);return b.toString()},checkContainsParOrFraction:function(){for(var a,b=this.tileViews,c=0;c<b.length;c++)if(a=b[c].checkContainsParOrFraction())return a},isExpressionContainsParOrFraction:function(){for(var a,b=this.tileViews,c=0;c<b.length;c++)if(a=b[c].isExpressionContainsParOrFraction())return a},isExpressionContainsParentheses:function(){for(var a,b=this.tileViews,c=0;c<b.length;c++)if(a=b[c].isExpressionContainsParentheses())return a},getTileContentInHtmlForm:function(b){var c,d=this.tileViews,e=(d.length,""),f="";return c=d[0],f+=c.getTileContentInHtmlForm(b),c=d[1],c&&(f+=a.Common.Components.templates.mathematicalOperators({operator:{equals:!0}}).trim(),f+=c.getTileContentInHtmlForm(b)),e=a.Common.Components.templates.headerExprContainer({exprBody:f})},getAccString:function(a){for(var b=this.tileViews,c=b.length,d="",e=0;c>e;e++)d+=b[e].getAccString(),0===e&&c>1&&(d+=this.manager.getAccMessage("prefixed-statements",0));return d.trim()},getElementsInsideMarquee:function(a,b,c){this.tileViews[c].getElementsInsideMarquee(a,b)},getViewFromNode:function(a){return this.getViewFromIndex(this.model.getModelIndexFromNode(a))}},{})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Views.EquationManagerPro,c=a.Common.Components.Models.EquationManagerPro,d=a.Common.Utilities.Models.Rect,e=a.Common.Utilities.Models.Point;b.ExpressionTileView=b.TileView.extend({tileViews:null,$operatorViews:null,curHoveredTile:null,$expression:null,initialize:function(){this.tileViews=[],this.$operatorViews=[],b.EquationView.__super__.initialize.apply(this,arguments),this.initializeDefaultProperties(),this.listenEvents()},render:function(){var a=this.model.get("tileArray"),c=0;for(c=0;c<a.length;c++)this.tileViews[c]=new b.TileView.createTileItemView(a.at(c),this,this.equationManager,this.player,this.isTutorialMode)},createView:function(){var a=this.model.get("isLHS")?"lhs-":"rhs-";this.$el.addClass("expression-view-holder "+a+"expression-view-holder");var b,c=0,d=this.tileViews,e=$("<div></div>").addClass("expression-view"),f=$("<div></div>").addClass("expression-marquee-container "+a+"expression-marquee-container");for(f.append(e),this.$el.append(f),c=0;c<d.length;c++)b=d[c].createView(this.parent.getIndex(this)+"."+c),e.append(b);return this.$expression=e,this.createOperatorView(),this.$el},checkForFractionInExpression:function(){var a,b=this.tileViews,d=0,e=this.$el.find(".expression-view"),f=c.TileItem.TileType;for(e.removeClass("expression-with-fraction expression-without-fraction");d<b.length;d++){if(b[d].model.get("type")===f.FRACTION){e.addClass("expression-with-fraction");break}if(b[d].model.get("type")===f.PARENTHESES&&(a=b[d].checkForFractionInExpression())){e.addClass("expression-with-fraction");break}}d===b.length&&e.addClass("expression-without-fraction")},createOperatorView:function(){var a,b,c,d,e=0;for(e=0;e<this.tileViews.length;e++)b=this.tileViews[e],c=b.model.get("operator"),d=b.model.get("type"),null!==c?("*"===c?(a=this.createOperator(c,null,d),a.insertBefore(b.$el),b.$el.addClass("multiplied-tile")):(a=this.createOperator(c),a.insertBefore(b.$el),this.attachEventsOnOperator(a)),this.$operatorViews[e]=a):(a=this.createOperator(c),a.insertBefore(b.$el),this.$operatorViews[e]=null,this.attachEventsOnOperator(a));a=this.createOperator(null,!0),a.insertAfter(b.$el),this.attachEventsOnOperator(a)},createOperator:function(d,e,f){var g,h,i,j=b.TileView.CLASSES,k=$("<div></div>"),l=a.Common.Utilities.Models.BrowserCheck;return null!==d?(g=$("<div></div>").addClass(j.OperatorContainer),"+"===d?k.html("&#43;"):"*"===d&&f===c.TileItem.TileType.PARENTHESES?(k.addClass("parentheses-coefficient-operator"),g.addClass("parentheses-coefficient-operator-container")):"*"===d&&(k.addClass("multiplication-operator"),g.addClass("multiplication-operator-container")),k.addClass(j.Operator).appendTo(g)):null!==d||e?e&&(g=$("<div></div>").addClass(j.OperatorContainer+" right-null-operator-container"),k.addClass(j.Operator+" right-null-operator").appendTo(g),i=$("<div>&#43;</div>").addClass("add-sign-in-null-operator").hide(),i.appendTo(g)):(this.$(".null-operator-container").remove(),g=$("<div></div>").addClass(j.OperatorContainer+" null-operator-container"),k.addClass(j.Operator+" null-operator").appendTo(g),i=$("<div>&#43;</div>").addClass("add-sign-in-null-operator").hide(),i.appendTo(g)),h=$("<div></div>").addClass("insertion-cursor").hide().appendTo(g),(l.isIE||l.isIE11||l.isFirefox)&&h.addClass("insertion-cursor-ie-ff"),g},onAddTile:function(a,d,e){var f,g=a.get("operator"),h=this.tileViews.length,i=null!==e.at&&void 0!==e.at?parseInt(e.at,10):h,j=b.TileView.createTileItemView(a,this,this.equationManager,this.player,this.isTutorialMode),k=j.createView(this.parent.getIndex(this)+"."+i),l=a.get("isAnimate"),m=null;this.equationManager.restrictFirstTileAnimation===!1&&l&&k.css({visibility:"hidden"}).addClass("animated-tiles"),0===i?(m=this.$expression.find(".null-operator-container"),m&&(m.is(".ui-droppable")&&m.droppable("disable"),m.off().remove()),this.$expression.prepend(k)):0===h?this.$expression.append(k):k.insertAfter(this.tileViews[i-1].$el),this.equationManager.restrictFirstTileAnimation===!0&&(this.equationManager.firstTile=k),f=a.get("type")===c.TileItem.TileType.PARENTHESES?this.createOperator(g,null,a.get("type")):this.createOperator(g),null!==f?(l===!0&&this.equationManager.restrictFirstTileAnimation===!1&&f.css("visibility","hidden").addClass("invisible-operators"),f.insertBefore(j.$el),this.$operatorViews.splice(i,0,f),"*"===g?j.$el.addClass("multiplied-tile"):this.attachEventsOnOperator(f)):this.$operatorViews.splice(i,0,null),a.set("isAnimate",!1),this.equationManager.restrictFirstTileAnimation=!1,j.attachEvents(),this.equationManager.tileAdded(j),this.tileViews.splice(i,0,j)},onRemoveTile:function(a,b,c){var d=c.index,e=this.tileViews[d],f=null,g=this;null!==g.$operatorViews[d]&&(f=this.$operatorViews[d]),this.$operatorViews.splice(d,1),this.tileViews.splice(d,1),e.stopListeningEvents(!0),f&&(f.is(".ui-droppable"),f.off(),f.remove()),e.$el.remove(),e.off()},listenEvents:function(){this.listenTo(this.model.get("tileArray"),"add",this.onAddTile),this.listenTo(this.model.get("tileArray"),"remove",this.onRemoveTile)},attachEvents:function(){var a=0,b=this.tileViews,c=this,d=this.parent.tileViews.indexOf(this);for(a=0;a<b.length;a++)b[a].attachEvents();this.isTutorialMode||(this.makeDroppable(!0),this.$el.scroll(function(){c.equationManager.marqueeViews[d].model.set("scrollAmt",this.scrollLeft)}))},attachEventsOnOperator:function(a){if(!this.isTutorialMode){var b=this;a.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(a,c){b.onDropOperator(a,c)},over:function(a,c){b.onMouseOverOperator(a,c),c.draggable.data("cur-droppable",b)},out:function(a,c){b.onMouseOutOperator(a,c),c.draggable.removeData("cur-droppable")}})}},onMouseOverOperator:function(a,b){var c=b.helper;null===this.equationManager.getTileAddedInExpression()&&"t"!==c.data("tilevalue")&&this.equationManager.getFirstTileDrop()!==!1&&($(a.target).find(".insertion-cursor, .add-sign-in-null-operator").show(),b.helper.data("add-tile-droppable",$(a.target)))},onMouseOutOperator:function(a,b){$(a.target).find(".insertion-cursor, .add-sign-in-null-operator").hide()},onDropOperator:function(a,d,e){if(null!==this.equationManager.getTileAddedInExpression())return void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",16),this.getAccMessage("inline-feedback-text",16));if(d&&("t"===d.helper.data("tilevalue")||d.helper.hasClass("equals-sign-container")))return void(this.equationManager.getFirstTileDrop()===!1&&this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",19),this.getAccMessage("inline-feedback-text",19)));var f,g,h,i,j=e&&e.target?e.target:$(a.target),k=this.tileViews,l=0,m=k.length,n=d?d.helper.data():e,o=n["cur-draggable"],p=n.tiletype,q=n.tilevalue,r=k.indexOf(o),s=n.length,t=1,u={};if(this.equationManager._checkForNestedLevelOfParentheses()&&p===c.TileItem.TileType.BIN_TILE)return this.equationManager._showHideDropslots(this.$el,!1),void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",12),this.getAccMessage("inline-feedback-text",12));if(this.equationManager.getFirstTileDrop()===!1)return void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",19),this.getAccMessage("inline-feedback-text",19));for(j.find(".insertion-cursor, .add-sign-in-null-operator").hide(),t=s?s:1;m+1>l;l++){if(this.$operatorViews[l]&&this.$operatorViews[l].get(0)===j.get(0)){g=l;break}if(j.hasClass("right-null-operator-container")){g=m;break}if(null===this.$operatorViews[l]&&j.hasClass("null-operator-container")){g=l;break}}(r+1!==g&&r!==g||j.hasClass("null-operator-container")&&p===c.TileItem.TileType.BIN_TILE||j.hasClass("right-null-operator-container")&&p===c.TileItem.TileType.BIN_TILE||!o.model||o.model.get("isLHS")!==this.model.get("isLHS"))&&(m>g?(f=k[g],u.bLeft=!0):g===m&&(f=k[g-1],u.bLeft=!1,i=f.parent.getIndex(f).substr(0,1)+"."+m),p===c.TileItem.TileType.BIN_TILE?(u={tileValue:q,operation:"+",index:u.bLeft?f.parent.getIndex(f):i,isDenominator:f.model.get("isDenominator"),isLHS:f.model.get("isLHS")},h=this.equationManager.onAddTile(u),this.equationManager.setTileAddedFromBinValue(q),h&&this.addNullTileCase(u.operation,u.tileValue)):(u={sourceTile:o,destTile:f,numOfTiles:t,bLeft:u.bLeft},h=this.equationManager.onRepositionTile(u)),h&&(d&&d.draggable.data("isDropped",!0),e&&this.equationManager.trigger(b.EquationManagerPro.EVENTS.TILE_DROP_SUCCESS)))},makeDroppable:function(a){if(a){var b=this;this.$el.hasClass("ui-droppable")||this.$el.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(a,c){b.equationManager.getIsDropped()||(b.onTileDrop(a,c),c.draggable.removeData("cur-droppable"),b.equationManager.setIsDropped(!0))},over:function(a,c){b.onMouseOver(a,c),c.draggable.data("cur-droppable",b)},out:function(a,c){b.onMouseOut(a,c),c.draggable.removeData("cur-droppable")}})}else this.$el.hasClass("ui-droppable")&&this.$el.droppable("destroy")},onMouseOver:function(a,b){var d=b.helper.data(),e=d["cur-draggable"],f=d.tiletype,g=this.equationManager.equationView.tileViews,h=this.model.get("isLHS")?1:0,i=g[h]||null;if(this.equationManager.getFirstTileDrop()&&!this.equationManager.onlyLHS&&this.equationManager._showHideDropslots(g[h].$el,!1),i&&i.$(".hover-border").removeClass("hover-border"),f===c.TileItem.TileType.BIN_TILE)b.helper.data("add-tile-droppable",this);else if(!e)return},onMouseOut:function(a,d){var e=d.helper.data(),f=e["cur-draggable"],g=e.tiletype;if(g===c.TileItem.TileType.BIN_TILE);else{if(!f)return;var h=f.model,i=h.get("isLHS");this.$el.parents(".lhs-expression-view-expression").length>0&&!i?this.equationManager.trigger(b.EquationManagerPro.EVENTS.INVERT_TILE_TEXT[g],f,$(d.helper)):this.$el.parents(".rhs-expression-view-expression").length>0&&i&&this.equationManager.trigger(b.EquationManagerPro.EVENTS.INVERT_TILE_TEXT[g],f,$(d.helper))}},onTileDrop:function(a,e,f){if(null!==this.equationManager.getTileAddedInExpression())return void this.equationManager.equationNotBalancedFeedback();if(this.equationManager.getFirstTileDrop()===!1){var g=this.$(".virtual-numerator"),h=new d(g[0].getBoundingClientRect()),i=new d(e?e.helper[0].getBoundingClientRect():f.target[0].getBoundingClientRect()),j=i&&i.getMiddle(),k=e?e.helper.data("tilevalue"):f.tilevalue;if(h.isPointInRect(j)===!1||h.isPointInRect(j)===!0&&"t"!==k||this.model.get("isLHS")===!1)return this.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border"),this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",19),this.getAccMessage("inline-feedback-text",19)),!1;this.$(".virtual-numerator-operator-container").remove(),this.$(".drop-t-case-tile, drop-t-case-empty").removeClass("drop-t-case-tile drop-t-case-empty")}var l,m,n=e?e.helper.data():f,o=n["cur-draggable"],p=n.tiletype,q=n.tilevalue,r=!1,s=null;if(p!==c.TileItem.TileType.BIN_TILE)return o.model.get("isLHS")!==this.model.get("isLHS")?void this._repositionTermTile(a,e):void this._takeOutCommonCommandCall(a,e);if(this.equationManager.onlyLHS||!e||e.helper.data("add-tile-droppable")){var t,u=this,v=u.model.get("type"),w=u.parent.getIndex(u).substring(0,1),x=this,y=x.$el,z=y.find(".virtual-numerator"),A=y.find(".virtual-denominator").length?y.find(".virtual-denominator"):y.find(".absolute-denominator"),B=y.find(".null-operator-container"),C=y.find(".right-null-operator-container"),i=new d(e?e.helper[0].getBoundingClientRect():f.target[0].getBoundingClientRect()),j=i.getMiddle(),D=new d(y[0].getBoundingClientRect()),E=D.getTop(),F=D.getBottom(),G=D.getRight(),H=D.getLeft(),I=E+Math.abs(E-F)/2-24,J=(new d({top:E,right:G,left:H,bottom:I,height:65,width:D.getWidth()}),E+Math.abs(E-F)/2+24),K=(new d({top:J,right:G,left:H,bottom:F,height:65,width:D.getWidth()}),new d(B[0].getBoundingClientRect())),L=new d(C[0].getBoundingClientRect()),M=(new d(z[0].getBoundingClientRect()),new d(A[0].getBoundingClientRect()),!0),N="*",O=u.model.get("isDenominator");if(this.equationManager._checkForNestedLevelOfParentheses()&&p===c.TileItem.TileType.BIN_TILE)return this.equationManager._showHideDropslots(this.$el,!1),void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",12),this.getAccMessage("inline-feedback-text",12));
if("none"!==A.css("display")||f&&f.isDenominator===!0){if(r=!0,s=this.fractionIndex,this.isDenominator=!0,"t"===q)return this.equationManager._showHideDropslots(this.$el,!1),void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",15),this.getAccMessage("inline-feedback-text",15))}else if("none"!==z.css("display")||f&&f.isDenominator===!1)r=!1,s=this.multiplicationIndex,this.isDenominator=!1;else if(D.isPointInRect(j))if(v===c.TileItem.TileType.TERM_TILE)if(O){if(r=!0,s=this.fractionIndex,"t"===q)return void this.equationManager._showHideDropslots(this.$el,!1)}else r=!1,s=this.multiplicationIndex;else{if(K.getRight()>j.getLeft()){if("t"===q)return void this.equationManager._showHideDropslots(this.$el,!1);M=!1,N="+",t=w+".0",this.parenthesesAdded=!1,this.fractionAdded=!1}else if(L.getLeft()<j.getLeft()){if("t"===q)return void this.equationManager._showHideDropslots(this.$el,!1);M=!1,N="+",t=w+"."+this.tileViews.length,this.parenthesesAdded=!1,this.fractionAdded=!1}M&&(r=!1,s=this.multiplicationIndex)}if(l={isLHS:this.model.get("isLHS"),isDenominator:this.isDenominator,index:this.multiplicationIndex?s:this.index,operation:N,tileValue:q,parenthesesAdded:this.parenthesesAdded,fractionAdded:this.multiplicationIndex?this.fractionAdded:r,tilesToAddInFraction:this.tilesToAddInFraction},"+"===N&&(l.index=t),this.equationManager.getFirstTileDrop()===!1&&(l.index="0.0.1",this.equationManager.setFirstTileDrop(!0)),"string"==typeof q&&-1!==q.indexOf("x")&&"*"===N)return this.equationManager._showHideDropslots(this.$el,!1),this.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border"),void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",20),this.getAccMessage("inline-feedback-text",20));m=this.equationManager.onAddTile(l),this.equationManager.setTileAddedFromBinValue(q),m&&(e&&e.draggable.data("isDropped",!0),this.addNullTileCase(N,l.tileValue),f&&this.equationManager.trigger(b.EquationManagerPro.EVENTS.TILE_DROP_SUCCESS)),this.equationManager._showHideDropslots(this.$el,!1)}},_takeOutCommonCommandCall:function(a,b){var f,g,h,i,j=b.helper.data(),k=j["cur-draggable"],l=k.parent,m={},n=j.length,o=new e({left:a.clientX,top:a.clientY});if(l.model.get("type")===c.TileItem.TileType.PARENTHESES||l.model.get("type")===c.TileItem.TileType.FRACTION){if(l.model.get("type")===c.TileItem.TileType.FRACTION&&(l=l.parent,l.model.get("type")!==c.TileItem.TileType.PARENTHESES))return;if(i=new d(l.$el[0].getBoundingClientRect()),i.getLeft()<o.getLeft()&&i.getRight()>o.getLeft()||l.parent.model.get("type")===c.TileItem.TileType.PARENTHESES)return;g=l.parent.tileViews.indexOf(l),h=l.parent.tileViews[g-1]||l.parent.tileViews[g+1],h&&h.model.get("type")===c.TileItem.TileType.PARENTHESES&&(h=h.tileViews[0]),h?(m.destTile=h,m.sourceTile=k,m.sourceNumOfTiles=n||1,f=this.equationManager.onTakeOutCommonTile(m)):l.model.get("exponent")&&this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",13),this.getAccMessage("inline-feedback-text",13)),f&&b.draggable.data("isDropped",!0)}},_repositionTermTile:function(a,b){var c,d=b.helper.data(),e=d["cur-draggable"],f=(d.tiletype,d.length),g={},h=this.tileViews;g={sourceTile:e,numOfTiles:f||1,bLeft:g.bLeft},"none"!==this.$(".null-operator-container").find(".insertion-cursor").css("display")?(g.destTile=h[0],g.bLeft=!0,c=this.equationManager.onRepositionTile(g)):"none"!==this.$(".right-null-operator-container").find(".insertion-cursor").css("display")&&(g.destTile=h[h.length-1],g.bLeft=!1,c=this.equationManager.onRepositionTile(g)),c&&b.draggable.data("isDropped",!0),this.equationManager._showHideDropslots(this.$el,!1)},hideOperatorOfParCoeff:function(){for(var a=this.tileViews,b=0;b<a.length;b++)a[b].model.get("type")===c.TileItem.TileType.PARENTHESES&&a[b+1]&&"*"===a[b+1].model.get("operator")?(this.$operatorViews[b+1].find(".operator").hide(),this.tileViews[b+1].model.get("type")===c.TileItem.TileType.TERM_TILE&&this.tileViews[b+1].$el.addClass("multiplied-tile-term-tile")):a[b].model.get("type")!==c.TileItem.TileType.PARENTHESES&&a[b+1]&&"*"===a[b+1].model.get("operator")&&this.tileViews[b+1].model.get("type")===c.TileItem.TileType.TERM_TILE&&this.tileViews[b+1].$el.removeClass("multiplied-tile-term-tile")},checkContainsParOrFraction:function(){var a=this.tileViews,b=0;for(this.$el.find(".expression-view");b<a.length;b++)if(a[b].model.get("type")===c.TileItem.TileType.PARENTHESES||a[b].model.get("type")===c.TileItem.TileType.FRACTION)return!0;return!1},isExpressionContainsParOrFraction:function(){for(var a=this.tileViews,b=0,d=this.$el.find(".expression-view");b<a.length;b++)if(d.removeClass("expression-contains-parentheses"),a[b].model.get("type")===c.TileItem.TileType.PARENTHESES||a[b].model.get("type")===c.TileItem.TileType.FRACTION)return d.addClass("expression-contains-parentheses"),!0;return!1},isExpressionContainsParentheses:function(){for(var a=this.tileViews,b=0,d=this.$el.find(".expression-view");b<a.length;b++)if(d.removeClass("expression-contains-only-parentheses"),a[b].model.get("type")===c.TileItem.TileType.PARENTHESES)return d.addClass("expression-contains-only-parentheses"),!0;return!1},checkCoefficientOfXForm:function(){var a=this.tileViews,b=0;if(a.length>2)return!1;for(b;b<a.length;b++)if(a[b].model.get("type")!==c.TileItem.TileType.TERM_TILE)return!1;return a[1]?a[1].model.get("operator")===c.TileItem.OPERATORS.MULTIPLICATION&&"string"==typeof a[1].model.get("base")&&Math.abs(a[0].model.get("base"))>9?(this.equationManager.numberToReplaceInBin=a[0].model.get("base"),!0):!1:!0},getTileContentInHtmlForm:function(b){for(var c=this.model,d=this.tileViews,e=c.get("isLHS"),f=0,g=d.length,h=null,i="",j="";g>f;f++)h=d[f],j+=h.getTileContentInHtmlForm(b);return i=a.Common.Components.templates.exprContainer({isLHS:e,exprBody:j})},getAccString:function(a){for(var b="",c=this.model,d=this.tileViews,e=d.length,f=(c.get("exponent"),0);e>f;f++)b+=d[f].getAccString();return b},getElementsInsideMarquee:function(a,b){var c,e,f=new d(b[0].getBoundingClientRect()),g=f.getMiddle(),h=0;for(e=this.tileViews.length;e>h;h++)c=new d(this.tileViews[h].$el[0].getBoundingClientRect()),g=c.getMiddle(),this.tileViews[h].getElementsInsideMarquee(a,b)}},{})}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManagerPro,b=MathInteractives.Common.Components.Models.EquationManagerPro,c=MathInteractives.Common.Utilities.Models.Rect,d=MathInteractives.Common.Utilities.Models.Point;a.FractionTileView=a.TileView.extend({initialize:function(){this.tileViews=[],this.$operatorViews=[],a.FractionTileView.__super__.initialize.apply(this,arguments),this.listenEvents(),this.initializeDefaultProperties()},render:function(){var b=this.model.get("tileArray"),c=0;for(c=0;c<b.length;c++)this.tileViews[c]=new a.TileView.createTileItemView(b.at(c),this,this.equationManager,this.player,this.isTutorialMode)},createView:function(b){var c,d,e,f,g=a.TileView.CLASSES,h=0;for(this.$base=$("<div></div>").addClass("fraction-component"),e=$("<div></div>",{"class":"numerator-container"}),this.$numeratorDiv=$("<div></div>",{"class":g.NUMERATOR}),f=$("<div></div>",{"class":"denominator-container"}),this.$denominatorDiv=$("<div></div>").addClass(g.DENOMINATOR),this.$vinculumLine=$("<div></div>").addClass(g.VINICULUM),this.$base.append(e.append(this.$numeratorDiv)).append(this.$vinculumLine).append(f.append(this.$denominatorDiv)),this.$el.append(this.$base),this.$el.addClass(g.FRACTION),h=0;h<this.tileViews.length&&(d=this.tileViews[h],d.model.get("isDenominator")===!1);h++)c=d.createView(b+"."+h),this.$numeratorDiv.append(c);for(;h<this.tileViews.length;h++)d=this.tileViews[h],d.model.get("isDenominator")===!0&&(c=d.createView(b+"."+h),this.$denominatorDiv.append(c));return this.createOperatorView(),this.equationManager.setDeletedItemsInParenthesesFraction(b,this.model.get("type")),this.$el},createOperatorView:function(){for(var a,b,c,d,e=0;e<this.tileViews.length;e++)c=this.tileViews[e],b=c.model.get("operator"),d=c.model.get("type"),null!==b?("*"===b?(a=this.createOperator(b,d),a.insertBefore(c.$el),c.$el.addClass("multiplied-tile")):(a=this.createOperator(b),a.insertBefore(c.$el),this.attachEventsOnOperator(a)),this.$operatorViews[e]=a):this.$operatorViews[e]=null},createOperator:function(c,d){var c,e,f,g=a.TileView.CLASSES,h=$("<div></div>");return null!==c?(e=$("<div></div>").addClass(g.OperatorContainer),"+"===c?h.html("&#43;"):"*"===c&&d===b.TileItem.TileType.PARENTHESES?(h.addClass("parentheses-coefficient-operator"),e.addClass("parentheses-coefficient-operator-container")):"*"===c&&(h.addClass("multiplication-operator"),e.addClass("multiplication-operator-container")),h.addClass(g.Operator).appendTo(e),f=$("<div></div>").addClass("insertion-cursor").hide().appendTo(e),e):null},onAddTile:function(b,c,d){var e,f=b.get("operator"),g=null!==d.at&&void 0!==d.at?parseInt(d.at,10):this.tileViews.length,h=a.TileView.createTileItemView(b,this,this.equationManager,this.player,this.isTutorialMode),i=h.createView(this.parent.getIndex(this)+"."+g),j=this.getNumeratorLength(this.tileViews),k=this.tileViews.length-j,l=b.get("isAnimate");this.equationManager.restrictFirstTileAnimation===!1&&l&&i.css({visibility:"hidden"}).addClass("animated-tiles"),0===g?b.get("isDenominator")===!1?this.$numeratorDiv.prepend(i):this.$denominatorDiv.prepend(i):b.get("isDenominator")===!1&&0===j?this.$numeratorDiv.append(i):b.get("isDenominator")===!0&&0===k?this.$denominatorDiv.append(i):g===j&&b.get("isDenominator")===!0?this.$denominatorDiv.prepend(i):i.insertAfter(this.tileViews[g-1].$el),this.equationManager.restrictFirstTileAnimation===!0&&(this.equationManager.firstTile=i),e=this.createOperator(h.model.get("operator")),null!==e?(l===!0&&this.equationManager.restrictFirstTileAnimation===!1&&e.css("visibility","hidden").addClass("invisible-operators"),e.insertBefore(h.$el),this.$operatorViews.splice(g,0,e),"*"===f?h.$el.addClass("multiplied-tile"):this.attachEventsOnOperator(e)):this.$operatorViews.splice(g,0,null),b.set("isAnimate",!1),this.equationManager.restrictFirstTileAnimation=!1,h.attachEvents(),this.equationManager.tileAdded(h),this.tileViews.splice(g,0,h)},onRemoveTile:function(a,b,c){var d=c.index,e=this.tileViews[d],f=null,g=this;null!==g.$operatorViews[d]&&(f=this.$operatorViews[d]),this.equationManager.setDeletedItemsInParenthesesFraction(this.parent.getIndex(this),this.model.get("type")),this.$operatorViews.splice(d,1),this.tileViews.splice(d,1),e.stopListeningEvents(!0),f&&(f.is(".ui-droppable"),f.off(),f.remove()),e.$el.remove(),e.off()},attachEventsOnOperator:function(a){if(!this.isTutorialMode){var b=this;a.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(a,c){b.onDropOperator(a,c)},over:function(a,c){b.onMouseOverOperator(a,c),c.draggable.data("cur-droppable",b)},out:function(a,c){b.onMouseOutOperator(a,c),c.draggable.removeData("cur-droppable")}})}},onMouseOverOperator:function(a,b){var c=b.helper;null===this.equationManager.getTileAddedInExpression()&&"t"!==c.data("tilevalue")&&this.equationManager.getFirstTileDrop()!==!1&&($(a.target).find(".insertion-cursor").show(),b.helper.data("add-tile-droppable",$(a.target)))},onMouseOutOperator:function(a,b){$(a.target).find(".insertion-cursor").hide()},onDropOperator:function(a,c){var d=$(a.target);d.find(".insertion-cursor").hide();if(null!==this.equationManager.getTileAddedInExpression())return void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",16),this.getAccMessage("inline-feedback-text",16));if(c.helper.data("tiletype")!==b.TileItem.TileType.BIN_TILE&&"t"!==c.helper.data("tilevalue")){var e,f,g,h=this.tileViews,i=0,j=h.length,k=c.helper.data(),l=k["cur-draggable"],m=k.tiletype,n=h.indexOf(l),o=k.length,p=1,q={};for(p=o?o:1;j+1>i;i++){if(this.$operatorViews[i]&&this.$operatorViews[i].get(0)===d.get(0)){f=i;break}if(d.hasClass("right-null-operator-container")){f=j;break}if(null===this.$operatorViews[i]&&d.hasClass("null-operator-container")){f=i;break}}n+1!==f&&n!==f&&(j>f?(e=h[f],q.bLeft=!0):f===j&&(e=h[f-1],q.bLeft=!1),m===b.TileItem.TileType.BIN_TILE?(q={tileValue:k.tilevalue,operation:"+",index:e.parent.getIndex(e),isDenominator:e.model.get("isDenominator"),isLHS:e.model.get("isLHS"),bLeft:q.bLeft},g=this.equationManager.onAddTile(q)):(q={sourceTile:l,destTile:e,numOfTiles:p,bLeft:q.bLeft},g=this.equationManager.onRepositionTile(q)),g&&c.draggable.data("isDropped",!0))}},_onOperatorChange:function(a,b){this.parent.changeOperatorArray(a,b)},listenEvents:function(){this.listenTo(this.model.get("tileArray"),"add",this.onAddTile),this.listenTo(this.model.get("tileArray"),"remove",this.onRemoveTile),this.listenTo(this.model,"change:operator",this._onOperatorChange),this.equationManager.solveFractionToDecimal&&this.listenTo(this.model,b.FractionTile.SOLVE_FRACTION_TO_DECIMAL,this._solveFractionToDecimal)},_solveFractionToDecimal:function(){this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",22))},getNumeratorLength:function(a){var b,c=0,d=a.length;for(b=0;d>b;b++)a[b].model.get("isDenominator")===!1&&c++;return c},attachEvents:function(){var a=0;for(a=0;a<this.tileViews.length;a++)this.tileViews[a].attachEvents()},hideOperatorOfParCoeff:function(){for(var a=this.tileViews,c=0;c<a.length;c++)a[c].model.get("type")===b.TileItem.TileType.PARENTHESES&&a[c+1]&&"*"===a[c+1].model.get("operator")&&this.$operatorViews[c+1].hide()},getTileContentInHtmlForm:function(a){var b,c=this.model,d=c.get("operator"),e=(c.get("exponent"),this.tileViews),f="",g=!0,h=!0,i=!1,j="",k="";switch(d){case"*":f+=MathInteractives.Common.Components.templates.mathematicalOperators({operator:{multiplication:!0}}).trim();break;case"+":f+=MathInteractives.Common.Components.templates.mathematicalOperators({operator:{addition:!0}}).trim()}for(b=0;b<e.length;b++)e[b].model.get("isDenominator")||(j+=e[b].getTileContentInHtmlForm(a),g=!1);for(b=0;b<e.length;b++)e[b].model.get("isDenominator")&&(k+=e[b].getTileContentInHtmlForm(a),h=!1);return f+=MathInteractives.Common.Components.templates.fractionExpr({isNumeratorEmpty:g,isFractionParentParenthesis:i,numeratorBody:j,isDenominatorEmpty:h,denominatorBody:k}).trim()},getAccString:function(a){var b="",c=this.model,d=this.tileViews,e=d.length,f=c.get("operator"),g=0;if(a)a=!1;else switch(f){case"*":b+=this.getAccMessage("operators-text",0);break;case"+":b+=this.getAccMessage("operators-text",1);break;default:b+=""}for(;e>g;g++)b+=d[g].getAccString(a);return" "+b.trim()},getElementsInsideMarquee:function(a,e){var f,g=0,h=new d({left:a.marqueeStartX,top:a.marqueeStartY}),i=new c(this.$vinculumLine[0].getBoundingClientRect()),j=i.get("top")<a.marqueeStartY,k=this.tileViews;if(this.isFractionInMarquee(e))if(this.equationManager.getWhetherPlusOperatorPresent(this.model.get("treeNodeRef"))){for(var l,m=this;m&&m.model.get("operator")===b.TileItem.OPERATORS.MULTIPLICATION;)m=m.getPrevTile();for(this.equationManager.pushElementToSelection(m,m.model.get("treeNodeRef")),l=m.getNextTile();l&&l.model.get("operator")===b.TileItem.OPERATORS.MULTIPLICATION;)this.equationManager.pushElementToSelection(l,l.model.get("treeNodeRef")),l=l.getNextTile()}else this.equationManager.pushElementToSelection(this,this.model.get("treeNodeRef"));else for(i.isPointInRect(h)&&(j=a.clientY>a.marqueeStartY?!0:!1),"hidden"===this.$vinculumLine.css("visibility")&&(j=!1),g=0;g<k.length;g++)f=k[g].model,f.get("isDenominator")===j&&this.tileViews[g].getElementsInsideMarquee(a,e)},isFractionInMarquee:function(a){var b=new c(this.$el[0].getBoundingClientRect()),d=new c(a[0].getBoundingClientRect()),e=b.getMiddle(),f=.5;return d.isPointInRect(e)&&d.getWidth()>f*b.getWidth()&&d.getHeight()>f*b.getHeight()},getWhetherTermPresent:function(a){if(a===this)return!0;var b,c=this.tileViews;for(b=0;b<c.length;b++)if(c[b].getWhetherTermPresent(a)===!0)return!0;return!1},coefficientOfXWithFraction:function(){var a=0;if(2!==this.tileViews.length)return!1;for(;a<this.tileViews.length;a++)if("string"==typeof this.tileViews[a].model.get("base"))return!1;return!0}},{})}(),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManagerPro,b=MathInteractives.Common.Components.Models.EquationManagerPro,c=MathInteractives.Common.Utilities.Models.Rect,d=MathInteractives.Common.Utilities.Models.Point,e=a.TileView.Scroll;a.ParenthesesTileView=a.TileView.extend({$exponent:null,tileViews:null,$operatorViews:null,isDragging:!1,initialize:function(){this.tileViews=[],this.$operatorViews=[],a.ParenthesesTileView.__super__.initialize.apply(this,arguments),this.listenEvents(),this.initializeDefaultProperties()},events:{"mouseenter .parentheses-exponent":"addHoverClassBase","mouseleave .parentheses-exponent":"removeHoverClassBase"},render:function(){var b=this.model.get("tileArray"),c=0;for(c=0;c<b.length;c++)this.tileViews[c]=new a.TileView.createTileItemView(b.at(c),this,this.equationManager,this.player,this.isTutorialMode)},createView:function(c){var d,e,f=a.TileView.CLASSES,g=0,h=b.TileItem.TileType,i=this.model.get("exponent"),j=this.getValueText("exponent"),k=this.equationManager.parenthesesColor?this.equationManager.parenthesesColor:a.EquationManagerPro.WHITE,l={color:k},m=MathInteractives.Common.Components.templates.parenthesesTemplate(l).trim();for(this.$leftBracket=$("<div>"+m+"</div>").addClass(f.LeftBracket),this.$rightBracket=$("<div>"+m+"</div>").addClass(f.RightBracket),this.$base=$("<div></div>").addClass("parentheses-container"),i&&(e=$(MathInteractives.Common.Components.templates.baseTilePro({base:j,"base-class":"",level:"eqn-manager-tile",baseTileType:h.PARENTHESES_EXPONENT,idPrefix:this.idPrefix})),this.$exponent=$("<div></div>").addClass("parentheses-exponent").append(e),this.$el.addClass("parentheses-with-exponent")),this.$base.append(this.$leftBracket),g=0;g<this.tileViews.length;g++)d=this.tileViews[g].createView(c+"."+g),this.$base.append(d);if(this.$base.append(this.$rightBracket).append(this.$exponent),this.$el.append(this.$base),this.$el.addClass(f.PARENTHESES).attr("data-tiletype",h.PARENTHESES),this.createOperatorView(),this.equationManager.setDeletedItemsInParenthesesFraction(c,this.model.get("type")),this.$el.find(".fraction-component").length>0){this.$leftBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:k,isBigParentheses:!0}).trim()).addClass("big-left-bracket"),this.$rightBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:k,isBigParentheses:!0}).trim()).addClass("big-right-bracket");var n=this.model.get("isLHS")?0:1;this.equationManager.equationView.tileViews[n].$el.find(".expression-view").addClass("expression-with-big-parentheses")}return this.$el},checkForFractionInExpression:function(){for(var a,c=this.tileViews,d=0;d<c.length;d++){if(c[d].model.get("type")===b.TileItem.TileType.FRACTION)return!0;if(a=c[d].checkForFractionInExpression())return a}return!1},createOperatorView:function(){for(var a,b,c,d,e=0;e<this.tileViews.length;e++)c=this.tileViews[e],b=c.model.get("operator"),d=c.model.get("type"),null!==b?("*"===b?(a=this.createOperator(b,d),a.insertBefore(c.$el),c.$el.addClass("multiplied-tile")):(a=this.createOperator(b),a.insertBefore(c.$el),this.attachEventsOnOperator(a)),this.$operatorViews[e]=a):this.$operatorViews[e]=null},createOperator:function(c,d){var c,e,f,g=a.TileView.CLASSES,h=$("<div></div>");return null!==c?(e=$("<div></div>").addClass(g.OperatorContainer),"+"===c?h.html("&#43;"):"*"===c&&d===b.TileItem.TileType.PARENTHESES?(h.addClass("parentheses-coefficient-operator"),e.addClass("parentheses-coefficient-operator-container")):"*"===c&&(h.addClass("multiplication-operator"),e.addClass("multiplication-operator-container")),h.addClass(g.Operator).appendTo(e),f=$("<div></div>").addClass("insertion-cursor").hide().appendTo(e),e):null},showHideContentAfterDrag:function(a){a?(this.$leftBracket.css("visibility",""),this.$rightBracket.css("visibility","")):(this.$leftBracket.css("visibility","hidden"),this.$rightBracket.css("visibility","hidden"))},onAddTile:function(b,c,d){var e,f=b.get("operator"),g=null!==d.at&&void 0!==d.at?d.at:c.length-1,h=a.TileView.createTileItemView(b,this,this.equationManager,this.player,this.isTutorialMode),i=h.createView(this.parent.getIndex(this)+"."+g),j=b.get("isAnimate"),k=this.equationManager.parenthesesColor?this.equationManager.parenthesesColor:a.EquationManagerPro.WHITE;this.equationManager.restrictFirstTileAnimation===!1&&j&&i.css({visibility:"hidden"}).addClass("animated-tiles"),0===g?i.insertAfter(this.$leftBracket):i.insertAfter(this.tileViews[g-1].$el),this.equationManager.restrictFirstTileAnimation===!0&&(this.equationManager.firstTile=i),e=this.createOperator(h.model.get("operator"),b.get("type")),null!==e?(j===!0&&this.equationManager.restrictFirstTileAnimation===!1&&e.css("visibility","hidden").addClass("invisible-operators"),e.insertBefore(h.$el),this.$operatorViews.splice(g,0,e),"*"===f?h.$el.addClass("multiplied-tile"):this.attachEventsOnOperator(e)):this.$operatorViews.splice(g,0,null),b.set("isAnimate",!1),this.equationManager.restrictFirstTileAnimation=!1;var l=this.model.get("isLHS")?0:1;this.$el.find(".fraction-component").length>0?(this.$leftBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:k,isBigParentheses:!0}).trim()).addClass("big-left-bracket"),this.$rightBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:k,isBigParentheses:!0}).trim()).addClass("big-right-bracket"),this.equationManager.equationView.tileViews[l].$el.find(".expression-view").addClass("expression-with-big-parentheses")):(this.$leftBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:k}).trim()).removeClass("big-left-bracket"),this.$rightBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:k}).trim()).removeClass("big-right-bracket")),this.parent.trigger(a.EquationManagerPro.EVENTS.PARENTHESES_REFLECTION),h.attachEvents(),this.equationManager.tileAdded(h),this.tileViews.splice(g,0,h),this.refreshCursorAt()},onRemoveTile:function(b,c,d){var e,f=d.index,g=this.tileViews[f],h=(g.model.get("operator"),b.get("type"),this.equationManager.parenthesesColor?this.equationManager.parenthesesColor:a.EquationManagerPro.WHITE);null!==this.$operatorViews[f]&&(e=this.$operatorViews[f]),this.$operatorViews.splice(f,1),g.stopListeningEvents(!0),e&&(e.is(".ui-droppable"),e.off(),e.remove()),g.$el.remove(),this.equationManager.setDeletedItemsInParenthesesFraction(this.parent.getIndex(this),this.model.get("type"));var i=this.model.get("isLHS")?0:1;this.$el.find(".fraction-component").length>0?(this.$leftBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:h,isBigParentheses:!0}).trim()).addClass("big-left-bracket"),this.$rightBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:h,isBigParentheses:!0}).trim()).addClass("big-right-bracket"),this.equationManager.equationView.tileViews[i].$el.find(".expression-view").addClass("expression-with-big-parentheses")):(this.$leftBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:h}).trim()).removeClass("big-left-bracket"),this.$rightBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:h}).trim()).removeClass("big-right-bracket")),g.off(),this.tileViews.splice(f,1),this.refreshCursorAt(),this.parent.trigger(a.EquationManagerPro.EVENTS.PARENTHESES_REFLECTION)},attachEventsOnOperator:function(a){if(!this.isTutorialMode){var b=this;a.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(a,c){b.onDropOperator(a,c)},over:function(a,c){b.onMouseOverOperator(a,c),c.draggable.data("cur-droppable",b)},out:function(a,c){b.onMouseOutOperator(a,c),c.draggable.removeData("cur-droppable")}})}},onMouseOverOperator:function(a,b){var c=b.helper;null===this.equationManager.getTileAddedInExpression()&&"t"!==c.data("tilevalue")&&this.equationManager.getFirstTileDrop()!==!1&&($(a.target).find(".insertion-cursor").show(),b.helper.data("add-tile-droppable",$(a.target)))},onMouseOutOperator:function(a,b){$(a.target).find(".insertion-cursor").hide()},onDropOperator:function(a,c){var d=$(a.target);d.find(".insertion-cursor").hide();if(null!==this.equationManager.getTileAddedInExpression())return void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",16),this.getAccMessage("inline-feedback-text",16));if(c.helper.data("tiletype")!==b.TileItem.TileType.BIN_TILE&&"t"!==c.helper.data("tilevalue")){var e,f,g,h=this.tileViews,i=0,j=h.length,k=c.helper.data(),l=k["cur-draggable"],m=k.tiletype,n=h.indexOf(l),o=k.length,p=1,q={};for(p=o?o:1;j+1>i;i++){if(this.$operatorViews[i]&&this.$operatorViews[i].get(0)===d.get(0)){f=i;break}if(d.hasClass("right-null-operator-container")){f=j;break}if(null===this.$operatorViews[i]&&d.hasClass("null-operator-container")){f=i;break}}n+1!==f&&n!==f&&(j>f?(e=h[f],q.bLeft=!0):f===j&&(e=h[f-1],q.bLeft=!1),m===b.TileItem.TileType.BIN_TILE?(q={tileValue:k.tilevalue,operation:"+",index:e.parent.getIndex(e),isDenominator:e.model.get("isDenominator"),isLHS:e.model.get("isLHS"),bLeft:q.bLeft},g=this.equationManager.onAddTile(q)):(q={sourceTile:l,destTile:e,numOfTiles:p,bLeft:q.bLeft},g=this.equationManager.onRepositionTile(q)),g&&c.draggable.data("isDropped",!0))}},_onOperatorChange:function(a,b){this.parent.changeOperatorArray(a,b)},listenEvents:function(){this.listenTo(this.model.get("tileArray"),"add",this.onAddTile),this.listenTo(this.model.get("tileArray"),"remove",this.onRemoveTile),this.listenTo(this.model,"change:operator",this._onOperatorChange),this.listenTo(this,a.EquationManagerPro.EVENTS.PARENTHESES_REFLECTION,this._parenthesesReflection)},_parenthesesReflection:function(){var b=this.model.get("isLHS")?0:1,c=this.equationManager.parenthesesColor?this.equationManager.parenthesesColor:a.EquationManagerPro.WHITE;this.$el.find(".fraction-component").length>0?(this.$leftBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:c,isBigParentheses:!0}).trim()).addClass("big-left-bracket"),this.$rightBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:c,isBigParentheses:!0}).trim()).addClass("big-right-bracket"),this.equationManager.equationView.tileViews[b].$el.find(".expression-view").addClass("expression-with-big-parentheses")):(this.$leftBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:c}).trim()).removeClass("big-left-bracket"),this.$rightBracket.html(MathInteractives.Common.Components.templates.parenthesesTemplate({color:c}).trim()).removeClass("big-right-bracket"))},_invertTileText:function(a,b){b.find(".parentheses-negate-tile").length>0?this.invertParenthesesText(!1,b):this.invertParenthesesText(!0,b)},invertParenthesesText:function(a,c){if(a){var d="−1",e=MathInteractives.Common.Components.templates.baseTilePro({base:d,"base-class":"bin-tiles-base",level:"eqn-manager-tile",baseTileType:b.TileItem.TileType.BASE,idPrefix:this.idPrefix}),f=$(e).addClass("parentheses-negate-tile");c.prepend(f).addClass("parentheses-helper"),c.find(".parentheses-container").addClass("parentheses-helper")}else c.find(".parentheses-negate-tile").remove()},attachEvents:function(){var b=0,c=this;for(b=0;b<this.tileViews.length;b++)this.tileViews[b].attachEvents();this.isTutorialMode||(this.$exponent&&MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$exponent,{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE}),this.$el.off("mousedown").on("mousedown",function(a){return c.onMouseDown(a)}),this.$el.off("mouseup").on("mouseup",function(a){return c.onMouseUp(a)}),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$(".base-container"),{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE}),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$el,{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE}),this.$exponent&&this.$exponent.off("click").on("click",function(b){c.$exponent.hasClass("disable")||c.isDragging!==!1||c.equationManager.onExponentClick(c),c.equationManager.trigger(a.EquationManagerPro.EVENTS.TILE_DRAGGING_START)}),this.applyHandCursorToElem(this.$leftBracket),this.applyHandCursorToElem(this.$rightBracket),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$leftBracket,{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE}),MathInteractives.Common.Utilities.Models.Utils.EnableTouch(this.$rightBracket,{specificEvents:MathInteractives.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE}),this.$exponent&&this.applyHandCursorToElem(this.$exponent),this.attachEventsOnTile())},addHoverClassBase:function(){this.$exponent.hasClass("disable")||this.equationManager.getIsMarqueeDrawing()||this.$exponent.addClass("hover")},removeHoverClassBase:function(){this.$exponent.hasClass("disable")||this.$exponent.removeClass("hover")},onMouseDown:function(a){var b,e=a.originalEvent?a.originalEvent:a,f=e,g=null,h=new c(this.$leftBracket[0].getBoundingClientRect()),i=new c(this.$rightBracket[0].getBoundingClientRect()),j=this.tileViews||null,k=null,l=0;if(this.$exponent&&(k=new c(this.$exponent[0].getBoundingClientRect())),this.refreshCursorAt(),f="touchstart"===f.type?f.touches[0]:f,b=new d({left:f.clientX,top:f.clientY}),h.isPointInRect(b)||i.isPointInRect(b)||k&&k.isPointInRect(b))return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.equationManager.mouseDownOnInteractive(f,!0,!0,!1),this.attachEventsOnTile(),this.equationManager.adjustContainment(this.$el),window.clearTimeout(this.equationManager.timerId),this.equationManager.getLhsRhsContainerRects(),this.equationManager.enableDisableDroppables(a),this.stopReading(),!1;if(null!==j)for(;l<j.length;l++)if(g=new c(j[l].el.getBoundingClientRect()),g=g.inflateRect(10,10),g.isPointInRect(b))return this.$el.draggable("disable"),!0;return this.$el.draggable("disable"),this.refreshCursorAt(),!0},onMouseUp:function(a){this.$el.draggable("enable")},_onTouchStart:function(a){var b=a.changedTouches,c=b[0],d=document.createEvent("MouseEvent"),e=$.Event("mouseenter");this._lastTap=c.target,d.initMouseEvent("mousedown",!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),c.target.dispatchEvent(d),$(c.target).trigger(e),this.el.addEventListener("touchmove",this._touchMoveHandler,!1),this.el.addEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onTouchMove:function(a){var b=a.changedTouches,c=b[0],d=0,e=document.createEvent("MouseEvent");e.initMouseEvent("mousemove",!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,d,null),c.target.dispatchEvent(e),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()},_onTouchEnd:function(a){var b=a.changedTouches,e=b[0],f=0,g=this.isDragging,h=document.createEvent("MouseEvent"),i=$.Event("mouseleave"),j=new d({left:e.clientX,top:e.clientY}),k=new c(this._lastTap.getBoundingClientRect());h.initMouseEvent("mouseup",!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,f,null),e.target.dispatchEvent(h),$(e.target).trigger(i),e.target===this._lastTap&&!g&&k.isPointInRect(j)&&(h=document.createEvent("MouseEvent"),h.initMouseEvent("click",!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(h)),this._lastTap=null,this.el.removeEventListener("touchmove",this._touchMoveHandler,!1),this.el.removeEventListener("touchend",this._touchEndHandler,!1),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault();
},attachEventsOnTile:function(){if(!this.isTileDisabled){var b=this,c=this.$el.is(".ui-draggable"),d=0;a.EquationManagerPro.EVENTS;c?this.$el.draggable("enable"):this.$el.draggable({scroll:e.ENABLE,scrollSensitivity:e.SENSITIVITY,scrollSpeed:e.SPEED,distance:5,zIndex:1,helper:"clone",appendTo:this.equationManager.$draggableContainment,containment:this.equationManager.$draggableContainment,cursorAt:{left:this.$el.width()/2,top:this.$el.height()/2},revert:function(a){return b.equationManager._showHideDropslots(b.equationManager.equationView.$el,!1),!1},start:function(c,e){var f=$(this).parents(".expression-view-holder").length>0?$(this).parents(".expression-view-holder"):null;f&&(d=f.scrollLeft()),b.isDragging=!0,e.helper.data("prevLocationData",null),e.helper.addClass("current-draggable").css({"z-index":10}),b.equationManager.trigger(a.EquationManagerPro.EVENTS.TILE_DRAGGING_START),b.equationManager.trigger(a.EquationManagerPro.EVENTS.ANY_DRAG_START),e.helper.data({"cur-draggable":b}),$(this).css({visibility:"hidden"}),e.helper.css(b._getClosedHandCss())},drag:function(a,c){b.equationManager.enableDisableDroppables(a,c,b)},stop:function(c,e){if(b.equationManager.trigger(a.EquationManagerPro.EVENTS.ANY_DRAG_STOP),$(this).data("isDropped"))b._onStop(c,e,$(this)),b.equationManager.trigger(a.EquationManagerPro.EVENTS.TILE_DROP_SUCCESS);else{var f=$(this),g=f.parents(".expression-view-holder").length>0?$(this).parents(".expression-view-holder"):null,h=e.originalPosition,i=h.left,j=h.top,k=e.helper.clone(),l=c;if(e.helper.parent().append(k),k.css({"z-index":5}),b.equationManager.showHideOverlayDiv(!0),g){var m=b.equationManager.getScrollAmount(g,f);m.scroll&&g.scrollLeft(m.scrollAmt),d-=g.scrollLeft()}k.animate({top:j,left:i+d},700,function(){b._onStop(l,e,f),k.remove()})}}})}},_onStop:function(a,b,c){var d=this;d.isDragging=!1,d._onDraggingStop(a,b,c),d.equationManager.refresh(),d.equationManager.showHideOverlayDiv(!1),d.equationManager.setIsDropped(!1),c.css({visibility:""}),b.helper.removeClass("current-draggable").css("z-index",""),d.equationManager.equationView.attachDetachDroppable(!0),d.equationManager.resetContainment(),d.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border")},onMouseOver:function(a,b){},onMouseOut:function(a,b){},_onDraggingStop:function(a,b,c){var e=c.data(),f=e.isDropped;if(b.helper.removeData("cur-draggable"),c.removeClass("current-draggable"),c.removeData("isDropped"),b.helper.removeData("prevLocationData"),!f){var g=a.originalEvent?a.originalEvent:a;new d({left:g.clientX,top:g.clientY});this.showHideContentAfterDrag(!0)}},refreshCursorAt:function(){var a=this;a.$el.is(".ui-draggable")&&a.$el.draggable("option","cursorAt",{left:a.$el.width()/2,top:a.$el.height()/2})},refresh:function(){this.curHoveredTile&&(this.curHoveredTile.$el.removeClass("white-border-left white-border-right"),this.curHoveredTile=null),a.ParenthesesTileView.__super__.refresh.apply(this,arguments)},applyHandCursorToElem:function(b){var c,d,e=this;this.equationManager.isTouch()?(c="touchstart",d="touchend"):(c="mouseenter",d="mouseleave"),b.on(c,function(a){$(this).hasClass("disable")||e.isMobile||e.equationManager.getIsMarqueeDrawing()||b.css(e._getOpenHandCss())}),b.on(d,function(){this.isMobile||e.equationManager.getIsMarqueeDrawing()||b.css(e._getDefaultCursorCss())}),b.on("mousedown",function(){this.isMobile||$(this).hasClass("disable")||e.equationManager.getIsMarqueeDrawing()||(b.css(e._getClosedHandCss()),e.equationManager.trigger(a.EquationManagerPro.EVENTS.TILE_MOUSE_DOWN))}),b.on("mouseup",function(){this.isMobile||$(this).hasClass("disable")||e.equationManager.getIsMarqueeDrawing()||b.css(e._getOpenHandCss())})},_detachEvents:function(){this.$el.off("mousedown"),this.$el.off("mouseup"),$.support.touch&&(this.el.removeEventListener("touchstart",this._touchStartHandler,!1),this._touchStartHandler=null,this._touchMoveHandler=null,this._touchEndHandler=null),this.$el.is(".ui-draggable")&&this.$el.draggable("destroy"),this.$el.addClass("no-hover")},hideOperatorOfParCoeff:function(){for(var a=this.tileViews,c=0;c<a.length;c++)a[c].model.get("type")===b.TileItem.TileType.PARENTHESES&&a[c+1]&&"*"===a[c+1].model.get("operator")&&this.$operatorViews[c+1].find(".operator").hide()},checkContainsParOrFraction:function(){for(var a=this.tileViews,c=0;c<a.length;c++)if(a[c].model.get("type")===b.TileItem.TileType.PARENTHESES||a[c].model.get("type")===b.TileItem.TileType.FRACTION)return!0;return!1},getTileContentInHtmlForm:function(b){var c,d=this.model,e=d.get("operator"),f=d.get("exponent"),g=this.tileViews,h=this.checkContainsParOrFraction(),i=b?b:a.EquationManagerPro.WHITE,j={color:i},k="",l=MathInteractives.Common.Components.templates.parenthesesTemplate(j).trim(),m="";switch(e){case"*":k+=MathInteractives.Common.Components.templates.mathematicalOperators({operator:{multiplication:!0,hide:!0}}).trim();break;case"+":k+=MathInteractives.Common.Components.templates.mathematicalOperators({operator:{addition:!0}}).trim()}for(c=0;c<g.length;c++)m+=g[c].getTileContentInHtmlForm(b);return-1===m.indexOf("fraction-data-tab")&&(h=!1),k+=MathInteractives.Common.Components.templates.parenthesesExpr({bigParenthesis:h,bracket:l,parenthesesBody:m,exponent:f,exponentNegative:0>f,absExponent:Math.abs(f)}).trim()},getAccString:function(a){var b="",c=this.model,d=c.get("operator"),e=this.tileViews,f=e.length,g=c.get("exponent"),h=0;if(a)a=!1;else switch(d){case"*":b+=this.getAccMessage("operators-text",0);break;case"+":b+=this.getAccMessage("operators-text",1);break;default:b+=""}for(b+=this.getAccMessage("prefixed-statements",10);f>h;h++)b+=this.tileViews[h].getAccString(a);return b+=this.getAccMessage("prefixed-statements",11),g&&(b+=this.getAccMessage("prefixed-statements",12)+g)," "+b.trim()},getElementsInsideMarquee:function(a,c){var d=0,e=this.tileViews;if(this.isParenthesisInMarquee(c))if(this.equationManager.getWhetherPlusOperatorPresent(this.model.get("treeNodeRef"))){for(var f,g=this;g&&g.model.get("operator")===b.TileItem.OPERATORS.MULTIPLICATION;)g=g.getPrevTile();for(this.equationManager.pushElementToSelection(g,g.model.get("treeNodeRef")),f=g.getNextTile();f&&f.model.get("operator")===b.TileItem.OPERATORS.MULTIPLICATION;)this.equationManager.pushElementToSelection(f,f.model.get("treeNodeRef")),f=f.getNextTile()}else this.equationManager.pushElementToSelection(this,this.model.get("treeNodeRef"));else for(d=0;d<e.length;d++)this.tileViews[d].getElementsInsideMarquee(a,c)},isParenthesisInMarquee:function(a){var b=new c(this.$el[0].getBoundingClientRect()),d=new c(a[0].getBoundingClientRect()),e=b.getMiddle(),f=.5;return d.isPointInRect(e)&&this.eitherBracketInside(a)&&d.getWidth()>f*b.getWidth()&&d.getHeight()>f*b.getHeight()},eitherBracketInside:function(a){var b=new c(a[0].getBoundingClientRect()),d=new c(this.$leftBracket[0].getBoundingClientRect()),e=new c(this.$rightBracket[0].getBoundingClientRect()),f=d.getMiddle(),g=e.getMiddle();return b.isPointInRect(f)||b.isPointInRect(g)},getWhetherTermPresent:function(a){if(a===this)return!0;var b,c=this.tileViews;for(b=0;b<c.length;b++)if(c[b].getWhetherTermPresent(a)===!0)return!0;return!1}},{})}(),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManagerPro;MathInteractives.Common.Components.Models.EquationManagerPro;a.SquaredParenthesesTileView=a.ParenthesesTileView.extend({initialize:function(){this.initializeDefaultProperties()}},{})}(),function(a){"use strict";var b=a.Common.Components.Views.EquationManagerPro,c=a.Common.Components.Models.EquationManagerPro,d=a.Common.Utilities.Models.Rect,e=a.Common.Utilities.Models.Point,f=b.TileView.Scroll;b.TermTileView=b.TileView.extend({tileViews:null,isDragging:!1,isTileDisabled:!1,negateTile:!1,initialize:function(){b.TermTileView.__super__.initialize.apply(this,arguments),this.initializeDefaultProperties(),this.tileViews=[]},render:function(){},events:{"mouseenter .base-container":"addHoverClassBase","mouseleave .base-container":"removeHoverClassBase"},createView:function(){var d,e=b.TileView.CLASSES,f=null,g=null,h=this.model.get("base"),i=this.getValueText("base"),j=this.model.get("iotaExponent"),k=this.model.get("squareRootProps"),l=(this.model.get("isDraggable"),c.TileItem.TileType),m=this;return k?(1===j?d=-1===h?'<i class="iota-margin-adjust">&minus;i</i>':'<i class="iota-margin-adjust">i</i>':2===j&&(d=-1===h?'<i>&minus;i</i><span class="iota-exponent">2</span>':'<i>i</i><span class="iota-exponent">2</span>'),i=k.isNegative?"&minus;"+(void 0!==d?d:"")+'<span class="squareroot-img"></span><span class="squareroot-value">'+i+"</span>":(void 0!==d?d:"")+'<span class="squareroot-img"></span><span class="squareroot-value">'+i+"</span>"):i=1===j&&1!==h?-1===h?'<span class="base-str"><i>&minus;i</i></span>':'<span class="base-str">'+i+"</span><i>i</i>":1===j&&1===h?"<i>i</i>":2===j&&1!==h?-1===h?'<i>&minus;i</i><span class="iota-exponent">2</span>':'<span class="base-str">'+i+'</span><i>i</i><span class="iota-exponent">2</span>':2===j&&1===h?'<i>i</i><span class="iota-exponent">2</span>':"string"==typeof h?'<span class="base-str"><i>'+i+"</i></span>":'<span class="base-str">'+i+"</span>",null!==h?(g=a.Common.Components.templates.baseTilePro({base:i,"base-class":"bin-tiles-base",level:"eqn-manager-tile",baseTileType:l.TERM_TILE,idPrefix:this.idPrefix}),f=$(g)):(g=a.Common.Components.templates.baseTilePro({base:"","base-class":"empty-tile",level:"eqn-manager-tile",baseTileType:l.TERM_TILE,idPrefix:this.idPrefix}),f=$(g),this.$el.addClass("empty-dropslot")),((h+"").length>3||3===(h+"").length&&-1===(h+"").indexOf("-"))&&f.find(".base-value").addClass("decrease-font-size"),this.$base=f.find(".base-container"),this.$el.append(f).addClass(e.TermTile).attr("data-tiletype",l.TERM_TILE),this._createNonDraggableTile(),window.setTimeout(function(){m._showFlashAnimation()},100),this.$el},checkForFractionInExpression:function(){return!1},_reduceFontSize:function(a){a&&a.isNegative&&(this.$el.find(".base-value").addClass("reduced-font-size"),this.$el.find(".squareroot-img").css({height:"16px"}))},_createNonDraggableTile:function(){var a=this.model.get("isDraggable");a||(this.$el.find(".box").hide(),this.$base.addClass("non-draggable-tile"),this.$el.addClass("ignore-marquee"))},_showFlashAnimation:function(){var a,b=this.equationManager,c=this;2===this.model.get("iotaExponent")&&(b.showHideOverlayDiv(!0),a=function(){b.showHideOverlayDiv(!1),c.$el.removeClass("flashShadowTS animated")},b._isIE9?this._flashShadowInIE9(this.$el):this.$el.addClass("flashShadowTS animated").one("webkitAnimationEnd oanimationend msAnimationEnd animationend MSAnimationEnd",a))},_flashShadowInIE9:function(a){a=a instanceof $?a:$(a);var b,c=2e3,d=6,e=c/d,f=this;(b=function g(){return 0===d?(a.css({"box-shadow":""}),void f.equationManager.showHideOverlayDiv(!1)):void window.setTimeout(function(){a.css({"box-shadow":"0px 0px 0px 3px rgba(255, 168, 0, 1), 0px 0px 0px 8px rgba(255, 168, 0, 0.3)"}),d--,window.setTimeout(function(){a.css({"box-shadow":"0px 0px 0px 3px rgba(0,0,0,0)"}),d--,g()},e)},e)})()},_onOperatorChange:function(a,b){this.parent.changeOperatorArray(a,b)},invertBaseText:function(a,b){var c=b.find(".base-value");0!==this.model.get("base")&&(a?(c.data("isNegate")||c.html(this.invertText(c.text())),c.data("isNegate",!0)):(c.html(this.getValueText("base")),c.data("isNegate",!1)))},attachEvents:function(b){var d=this;c.TileItem.TILE_TYPES,this.model.get("base");this.listenTo(this.model,"change:operator",this._onOperatorChange),this.listenTo(this.model,"change:endResult",this._renderEndResult),this.applyHandCursorToElem(this.$base),(!this.isTutorialMode||b)&&(this.$el.off("mousedown.tile").on("mousedown.tile",function(a){return d._onMouseDownTile(a)}),this.$el.off("mouseup.tile").on("mouseup.tile",function(a){return d._onMouseUpTile(a)}),this.$el.off("click.tile").on("click.tile",$.proxy(this._onBaseClick,this)),a.Common.Utilities.Models.Utils.EnableTouch(this.$base,{specificEvents:a.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE}),a.Common.Utilities.Models.Utils.EnableTouch(this.$el,{specificEvents:a.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE}),this.attachEventsOnTile(),this.attachDroppableOnTile())},_renderEndResult:function(a,b){var c=this.model.get("base"),d=this.equationManager,e=this.$base;b?(e.addClass("end-result-tile"),d.removeHighlightTilesImmediate(),this.enableDisableTiles(!1),d.enableDisableTabOnLHSContainer(!1),d.enableDisableTabOnRHSContainer(!1),d.disableMarquee(!0,!0),d.changeDragHandleImg(c,b),d.enableDisableBinTiles(!1),this.enableTab("tile-module-bin-tile-container",!1),"string"!=typeof c&&e.find(".base-str").text(c.toFixed(2))):("string"!=typeof c&&e.find(".base-str").text(c),e.removeClass("end-result-tile"),this.enableDisableTiles(!0),d.enableMarquee(!0,!0),d.enableDisableTabOnLHSContainer(!0),d.enableDisableTabOnRHSContainer(!0),d.changeDragHandleImg(c,b),d.enableDisableBinTiles(!0),this.enableTab("tile-module-bin-tile-container",!0))},addHoverClassBase:function(){this.$base.hasClass("disable")||this.equationManager.getIsMarqueeDrawing()||this.$base.hasClass("non-draggable-tile")||this.$base.addClass("hover")},removeHoverClassBase:function(){this.$base.hasClass("disable")||this.$base.removeClass("hover")},onTileDrop:function(a,d,e){var f=null===this.equationManager.getTileAddedInExpression(),g=d?d.helper.data().tilevalue:e.tilevalue;if(!f&&!this.isTutorialMode&&(!this.$el.hasClass("empty-dropslot")||g!==this.equationManager.getTileAddedFromBinValue())||!f&&e&&e["cur-draggable"]&&e["cur-draggable"].model&&e["cur-draggable"].model.get("type")!==c.TileItem.TileType.BIN_TILE)return this.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border"),void this.equationManager.equationNotBalancedFeedback();var h,i,j,k=this.tileViews,l=0,m=(k.length,this.equationManager.equationView.model),n=this.equationManager.equationView,o=d?d.helper.data():e,p=o["cur-draggable"],q=o.tiletype,r=o.tilevalue,s=this,t=s.model,u=t.get("isDenominator"),v=t.get("isLHS"),w=m.getIndexFromItemModel(t),x=v?0:1,y=this.equationManager.equationView.tileViews[x],z=null,A={},B=[],C=this.equationManager.getTreeRoot();if(this.equationManager.getFirstTileDrop()===!1)return this.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border"),void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",19),this.getAccMessage("inline-feedback-text",19));if(this.equationManager._showHideDropslots(this.equationManager.equationView.$el,!1),this.equationManager._checkForNestedLevelOfParentheses()&&f&&q===c.TileItem.TileType.BIN_TILE)return this.equationManager._showHideDropslots(y.$el,!1),this.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border"),void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",12),this.getAccMessage("inline-feedback-text",12));if("string"==typeof r&&q===c.TileItem.TileType.BIN_TILE&&-1!==r.indexOf("x")&&null===this.equationManager.getTileAddedInExpression())return this.equationManager._showHideDropslots(this.$el,!1),this.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border"),void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",20),this.getAccMessage("inline-feedback-text",20));if(q===c.TileItem.TileType.BIN_TILE){if(u){if(j=y.fractionIndex,"t"===r){var D=this.equationManager.equationView.$el;return this.equationManager._showHideDropslots(D,!1),D.find(".hover-border").removeClass("hover-border"),void this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",15),this.getAccMessage("inline-feedback-text",15))}}else j=y.multiplicationIndex;A={isLHS:v,isDenominator:u,index:y.multiplicationIndex?j:y.index,operation:"*",tileValue:r,parenthesesAdded:y.parenthesesAdded,fractionAdded:y.multiplicationIndex?y.fractionAdded:u,tilesToAddInFraction:y.tilesToAddInFraction},null!==this.equationManager.getTileAddedInExpression()?("+"===this.model.get("operator")&&(A.operation="+",A.index=w),this.equationManager.setTileAddedInExpression(),this.equationManager.setTileAddedFromBinValue(),i=this.equationManager.onReplaceTile(A)):(i=this.equationManager.onAddTile(A),this.equationManager.setTileAddedFromBinValue(r),i&&this.addNullTileCase(c.TileItem.OPERATORS.MULTIPLICATION,A.tileValue))}else{var E,F,G,H,I,J=p.parent.getIndex(p),K=(p.model,this._isInterLevel(J,w)),L=o.length,M=[],N=[],O=[],P=[],Q=null;for(L||(L=1),A.sourceNumOfTiles=L,A.sourceTile=p,A.destTile=s,E=this.getParentTiles(m,J),F=parseInt(this.getSourceWrtParent(J),10),h=this.tilesToNodes(C,[t])[0],x=0;L>x;x++)M.push(E.at(F+x));if(G=this.tilesToNodes(C,M),H=this.getCommonParentFromMultiple(G),P=h.getPath(),1===L?O=G[0].getPath():(G=c.EquationManagerPro.Utils.getAllLeaves(G[0]),O=G[0].getPath(),this.equationManager.trigger(b.EquationManagerPro.EVENTS.MARQUEE_DROPPED)),G[0].parent.data===h.parent.data&&G[0].parent===h.parent)Q="combine",A.destNumOfTiles=1;else if(K===!0)B=h.getPath(),z=C,Q="combine",I=v?z.children[0]:z.children[1],!I||"*"!==I.data&&"/"!==I.data?(I=this._getChildOfRoot(C,h),"*"===I.data?(A.destNumOfTiles=I.children.length,A.destTile=n.getViewFromIndex(n.model.getIndexFromItemModel(I.children[0].collectionData||I.children[0].data))):(A.destNumOfTiles=1,A.destTile=n.getViewFromIndex(n.model.getIndexFromItemModel(I.collectionData||I.data)))):(z=I,"/"===z.data?(A.destTile=n.getViewFromIndex(n.model.getIndexFromItemModel(z.collectionData)),A.destNumOfTiles=1):(A.destNumOfTiles=z.children.length,A.destTile=n.getViewFromIndex(n.model.getIndexFromItemModel(z.children[0].collectionData||z.children[0].data))));else{var R;for(R=O.length>P.length?O.length:P.length;R>l&&P[l]===O[l];l++)B.push(P[l]);if(z=C.getChildAt(B),"*"===z.data||"+"===z.data){var S=this.getOperatorsBetween(G[0],h);if(this._isTakeOutCommon(S)===!0)"*"===z.data&&(Q="takeOut");else{Q="combine";var T=this._getSourceSiblingBranchContainsDest(G[0],h,z,C);"^"===T.data||"/"===T.data?(A.destNumOfTiles=1,A.destTile=n.getViewFromIndex(m.getIndexFromItemModel(T.collectionData))):(A.destNumOfTiles=T.children.length||1,A.destTile=n.getViewFromIndex(m.getIndexFromItemModel(this._getLeftMostChildModelFromNode(T))))}}else if("/"===z.data){Q="combine";var U;U=u&&"+"===z.children[1].data?z.children[1]:u||"+"!==z.children[0].data?h:z.children[0],N=this._getTilesModelsInsideNode(U),A.destNumOfTiles=N.length,A.destTile=n.getViewFromIndex(m.getIndexFromItemModel(N[0]))}}"combine"===Q?i=this.equationManager.onCombineTile(A):"takeOut"===Q&&(i=this.equationManager.onTakeOutCommonTile(A))}i&&(d&&d.draggable.data("isDropped",!0),e&&this.equationManager.trigger(b.EquationManagerPro.EVENTS.TILE_DROP_SUCCESS),this.equationManager.proceedToNextStep()),this.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border")},_getLeftMostChildModelFromNode:function(a){var b=a.data,d=c.TileItem.OPERATORS;return b===d.PARENTHESES||b===d.DIVISION?a.collectionData:a.children.length?this._getLeftMostChildModelFromNode(a.children[0]):a.data},_onBaseClick:function(){return null===this.model.get("base")?!1:this.equationManager.getFirstTileDrop()===!1?(this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",19),this.getAccMessage("inline-feedback-text",19)),!1):null!==this.equationManager.getTileAddedInExpression()?(this.equationManager._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",16),this.getAccMessage("inline-feedback-text",16)),!1):(this.isTilesDisabled||this.isDragging!==!1||this.$base.hasClass("disable")||this.equationManager.onBaseClick(this),void this.equationManager.trigger(b.EquationManagerPro.EVENTS.TILE_DRAGGING_START))},applyHandCursorToElem:function(a){var b=this,c="mouseenter",d="mouseleave";a.on(c,function(){b.$el.hasClass("ui-droppable")&&!b.$el.hasClass("ui-draggable")||b.$el.hasClass("ui-draggable-dragging")||$(this).hasClass("empty-tile")||$(this).hasClass("disable")||$(this).hasClass("non-draggable-tile")||b.equationManager.getIsMarqueeDrawing()||(a.css(b._getOpenHandCss()),b.$el.parents(".ui-draggable-dragging").length>0&&a.css(b._getClosedHandCss()))}),a.on(d,function(){b.$el.hasClass("ui-droppable")&&!b.$el.hasClass("ui-draggable")||b.$el.hasClass("ui-draggable-dragging")||b.isMobile||b.equationManager.getIsMarqueeDrawing()||a.css(b._getDefaultCursorCss())}),a.on("mousedown",function(){b.$el.hasClass("ui-droppable")&&!b.$el.hasClass("ui-draggable")||$(this).hasClass("empty-tile")||$(this).hasClass("disable")||$(this).hasClass("non-draggable-tile")||b.isMobile||b.equationManager.getIsMarqueeDrawing()||a.css(b._getClosedHandCss())}),a.on("mouseup",function(){b.$el.hasClass("ui-droppable")&&!b.$el.hasClass("ui-draggable")||$(this).hasClass("empty-tile")||$(this).hasClass("disable")||$(this).hasClass("non-draggable-tile")||b.isMobile||b.equationManager.getIsMarqueeDrawing()||a.css(b._getOpenHandCss())})},attachDroppableOnTile:function(){var a=this,b=this.$el.is(".ui-droppable");b?this.$el.droppable("enable"):this.$el.droppable({accept:this.model.get("strDroppables"),tolerance:"pointer",greedy:!0,drop:function(b,c){if(!a.equationManager.getIsDropped()){var d=a.onTileDrop(b,c);return c.draggable.removeData("cur-droppable"),a.equationManager.setIsDropped(!0),d}return!1},over:function(b,c){c.draggable.data("cur-droppable",a),a.onMouseOver(b,c)},out:function(b,c){c.draggable.removeData("cur-droppable"),a.onMouseOut(b,c)}})},attachEventsOnTile:function(){if(!this.isTileDisabled||this.isTutorialMode){var a=this,c=0,d=this.$el.is(".ui-draggable"),e=this.model;b.EquationManagerPro.EVENTS;null!==e.get("base")&&e.get("isDraggable")?d?this.$el.draggable("enable"):this.$el.draggable({scroll:f.ENABLE,distance:5,scrollSensitivity:f.SENSITIVITY,scrollSpeed:f.SPEED,appendTo:this.equationManager.$draggableContainment,refreshPositions:!0,revert:function(b){return this.data("isDropped")||(a.equationManager._showHideDropslots(a.equationManager.equationView.$el,!1),a.equationManager.setIsDropped(!1),this.removeData("isDropped")),!1},zIndex:5,helper:"clone",containment:this.equationManager.$draggableContainment,cursorAt:{left:this.$el.width()/2,top:this.$el.height()/2},start:function(d,e){var f=$(this).parents(".expression-view-holder").length>0?$(this).parents(".expression-view-holder"):null;f&&(c=f.scrollLeft()),e.helper.addClass("current-draggable"),e.helper.data({"cur-draggable":a}),e.helper.data("prevLocationData",null),$(this).css({visibility:"hidden"}),a.isDragging=!0,a.equationManager.trigger(b.EquationManagerPro.EVENTS.TILE_DRAGGING_START),a.equationManager.trigger(b.EquationManagerPro.EVENTS.ANY_DRAG_START),a._termTileDraggingStart(d,e)},drag:function(b,c){a.equationManager.enableDisableDroppables(b,c,a),a.equationManager.onlyLHS||a._negateTile(b,c)},stop:function(d,e){if(a.equationManager.trigger(b.EquationManagerPro.EVENTS.ANY_DRAG_STOP),$(this).data("isDropped"))a._onStop(d,e,$(this)),a.equationManager.trigger(b.EquationManagerPro.EVENTS.TILE_DROP_SUCCESS);else{var f=$(this),g=f.parents(".expression-view-holder").length>0?$(this).parents(".expression-view-holder"):null,h=e.originalPosition,i=h.left,j=h.top,k=e.helper.clone(),l=d;if(e.helper.parent().append(k),k.css({"z-index":5}),a.equationManager.showHideOverlayDiv(!0),g){var m=a.equationManager.getScrollAmount(g,f);m.scroll&&g.scrollLeft(m.scrollAmt),c-=g.scrollLeft()}k.animate({top:j,left:i+c},700,function(){a._onStop(l,e,f),k.remove()})}}}):d&&this.$el.draggable("disable")}},_onStop:function(a,c,d){var e=this;c.helper.removeData("prevLocationData"),c.helper.removeData(["cur-draggable","cur-droppable"]),d.removeClass("current-draggable"),e.equationManager.resetContainment(),e.isDragging=!1,e.equationManager.refresh(),e.equationManager.showHideOverlayDiv(!1),e.equationManager.setIsDropped(!1),d.css({visibility:""}),e._termTileDraggingStop(a,c),e.equationManager.resetContainment(),e.negateTile=!1,e.equationManager.trigger(b.EquationManagerPro.EVENTS.TILE_DRAG_STOP),e.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border")},tileToNegate:function(){for(var a=this.equationManager.getTreeRoot(),b=this.model.get("treeNodeRef"),c=b.getPath(),d=a.children[c[0]],e=0;e<d.children.length&&"/"!==d.data&&"*"!==d.data;e++)d.children[e].cid===b.cid&&(this.negateTile=!0);0===d.children.length&&(this.negateTile=d.cid===b.cid?!0:!1)},_negateTile:function(a,b){if(this.negateTile){var c=this.model.get("isLHS"),e=new d(b.helper[0].getBoundingClientRect()),f=e.getMiddle();this.equationManager.lhsRect.isPointInRect(f)&&!c?this.invertBaseText(!0,$(b.helper)):this.equationManager.rhsRect.isPointInRect(f)>0&&c?this.invertBaseText(!0,$(b.helper)):this.invertBaseText(!1,$(b.helper))}},_multipleInParenthesesTileElem:null,_termTileDraggingStart:function(a,b){this._multipleInParenthesesTileElem=null;var c,d=this.model.get("multipleInParentheses");"string"==typeof d&&(c=this.equationManager.equationView.getViewFromIndex(d),c&&(this._multipleInParenthesesTileElem=c.$el.addClass("multiple-in-parentheses")))},_termTileDraggingStop:function(a,b){this._multipleInParenthesesTileElem&&this._multipleInParenthesesTileElem.removeClass("multiple-in-parentheses")},onMouseOver:function(a,b){if(this.equationManager.getFirstTileDrop()!==!1){if(null!==this.equationManager.getTileAddedInExpression())return void(this.$el.hasClass("empty-dropslot")&&b.helper.data("tiletype")===c.TileItem.TileType.BIN_TILE&&(this.highlightTiles(),this.equationManager.enableDisableDroppables(a,b)));var d,e=this.tileViews,f=0,g=(e.length,this.equationManager.equationView.model),h=this.equationManager.equationView,i=b.helper.data(),j=i["cur-draggable"],k=i.tiletype,l=this.equationManager.getTreeRoot(),m=this,n=m.model,o=n.get("isDenominator"),p=n.get("isLHS"),q=null,r=[];if(k===c.TileItem.TileType.BIN_TILE){for(d=this.tilesToNodes(l,[n])[0],r=d.getPath(),q=l.getChildAt([r[0]]),F=this._getTilesModelsInsideNode(q),f=0;f<F.length;f++)this._highlightTile(F[f],g,h);b.helper.data("add-tile-droppable",this)}else{var s,t,u,v,w,x,y=j.parent.getIndex(j),z=j.model,A=(z.get("isDenominator"),g.getIndexFromItemModel(n)),B=this._isInterLevel(y,A),C=i.length,D=0,E=[],F=[],G=[],H=[],I=!0;for(C||(C=1),s=this.getParentTiles(g,y),t=parseInt(this.getSourceWrtParent(y),10),d=this.tilesToNodes(l,[n])[0];C>D;D++)E.push(s.at(t+D));if(u=this.tilesToNodes(l,E),v=this.getCommonParentFromMultiple(u),H=d.getPath(),1===C?G=u[0].getPath():(u=c.EquationManagerPro.Utils.getAllLeaves(u[0]),G=u[0].getPath()),u[0].parent.data===d.parent.data&&u[0].parent===d.parent)this.$el.addClass("hover-border");else if(B===!0)for(r=d.getPath(),q=l,w=p?q.children[0]:q.children[1],!w||"*"!==w.data&&"/"!==w.data?(w=this._getChildOfRoot(l,d),F=this._getTilesModelsInsideNode(w)):(q=w,F=this._getTilesModelsInsideNode(q)),f=0;f<F.length;f++)this._highlightTile(F[f],g,h);else{var J;for(J=G.length>H.length?G.length:H.length;J>f&&H[f]===G[f];f++)r.push(H[f]);if(q=l.getChildAt(r),"*"===q.data||"+"===q.data){var K=this.getOperatorsBetween(u[0],d);if(this._isTakeOutCommon(K)===!0)if("*"===q.data){for(f=0;f<q.children.length;f++)x=q.children[f].getPath().join("."),x!==G.join(".").substring(0,x.length)&&(F=F.concat(this._getTilesModelsInsideNode(q.children[f])),I=!1);if(I){var L=this._getSourceSiblingBranchContainsDest(u[0],d,q,l);F=this._getTilesModelsInsideNode(L)}}else{var L=this._getSourceSiblingBranchContainsDest(u[0],d,q,l);F=this._getTilesModelsInsideNode(L)}else{var L=this._getSourceSiblingBranchContainsDest(u[0],d,q,l);F=this._getTilesModelsInsideNode(L)}}else if("/"===q.data){var M;M=o&&"+"===q.children[1].data?q.children[1]:o||"+"!==q.children[0].data?d:q.children[0],F=this._getTilesModelsInsideNode(M)}for(f=0;f<F.length;f++)this._highlightTile(F[f],g,h)}}}},_getChildOfRoot:function(a,b){var c=b.getPath();return c.length>1?a.getChildAt([c[0],c[1]]):b},_isTakeOutCommon:function(a){var b=a.node1ToParentOperators||[];if(b.length){for(var c=b.length-1;c>=0;c--)if("^"===b[c].data)return!0;return!1}return!1},_getSourceSiblingBranchContainsDest:function(a,b,c,d){var e=(a.getPath(),b.getPath()),f=c.getPath(),g=f;return g.push(e[f.length]),d.getChildAt(g)},_getCommonParentOfSourceAndDest:function(a,b){for(var c=b.parent,d=a.parent;c!==d;)c=c.parent,d=d.parent;return c},_getTilesModelsInsideNode:function(a){var b,c=(a.parent,[]),d=0,e=a.data;if("string"==typeof e||null===e)for(b=a.children;d<b.length;d++)c=c.concat(this._getTilesModelsInsideNode(b[d]));else c.push(e);return c},_highlightTile:function(a,b,c){var d,e;d=b.getIndexFromItemModel(a),e=c.getViewFromIndex(d),e.highlightTiles()},_isInterLevel:function(a,b){return+a.substr(0,1)===+b.substr(0,1)?!1:!0},getWhetherTermPresent:function(a){return a===this?!0:!1},isBasicTileType:function(a){var b=a.get("type"),d=c.TileItem.TileType;return b===d.TERM_TILE||b===d.BASE_EXPONENT},getSourceWrtParent:function(a){var b=a.lastIndexOf(c.CommandFactory.SEPARATOR);return a.substring(b+1)},getParentIndex:function(a){if(1===a.length)return"";var b=a.lastIndexOf(c.CommandFactory.SEPARATOR);return a.substring(0,b)},getParentTiles:function(a,b){return b=this.getParentIndex(b),a.getModelFromIndex(b).get("tileArray")},getCommonParent:function(a,b){for(var c=a.getPath(),d=b.getPath(),e=a.getTreeRoot(),f=Math.min(c.length,d.length),g=[],h=0;f>h&&c[h]===d[h];h++)g[h]=c[h];return e.getChildAt(g)},getCommonParentFromMultiple:function(a){if(1===a.length)return a[0];var b=this.getCommonParent(a[0],a[1]),c=0;if(2===a.length)return b;for(c=2;c<a.length&&!b.isRoot();c++)b=this.getCommonParent(b,a[c]);return b},getOperatorsBetween:function(a,b){var c=this.getCommonParent(a,b),d={},e=null,f=a,g=[],h=[];for(d.commonParentOperator=c;!_.isEqual(f,c)&&!_.isEqual(f.parent,c);)e=f.parent,g.push(e),f=f.parent;for(d.node1ToParentOperators=g,f=b;!_.isEqual(f,c)&&!_.isEqual(f.parent,c);)e=f.parent,h.push(e),f=f.parent;return d.node2ToParentOperators=h,d},getOperatorStringsBetween:function(a,b){var c=this.getOperatorsBetween(a,b),d=[],e=0;for(e=0;e<c.node1ToParentOperators.length;e++)d.push(c.node1ToParentOperators[e].data);for(d.push(c.commonParentOperator.data),e=c.node2ToParentOperators.length-1;e>=0;e--)d.push(c.node2ToParentOperators[e].data);return d},tilesToNodes:function(a,b){var c=[],d=0;for(d=0;d<b.length;d++)c.push(this.searchInTree(a,b[d]));return c},searchInTree:function(a,b){var c,d;if(null===a||void 0===a)return null;if(a.data===b||a.collectionData===b)return a;for(c=0;c<a.children.length;c++)if(d=this.searchInTree(a.children[c],b),null!==d&&void 0!==d)return d},getModelDataFromTreeNode:function(a){return _.isString(a.data)&&a.collectionData?a.collectionData:a.data},onMouseOut:function(a,b){this.equationManager.equationView.$el.find(".hover-border").removeClass("hover-border")},_onMouseDownTile:function(a){var b,c,f=new d(this.$el[0].getBoundingClientRect()),g=a.originalEvent?a.originalEvent:a,h=this.$el.is(".ui-draggable");return h&&this.$el.draggable("option","cursorAt",{left:this.$el.width()/2,top:this.$el.height()/2}),g="touchstart"===g.type?g.touches[0]:g,b=new e({left:g.clientX,top:g.clientY}),(c=f.isPointInRect(b))?(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),this.equationManager.mouseDownOnInteractive(a,!0,!0,!1),this.attachEventsOnTile(),this.equationManager.adjustContainment(this.$el),window.clearTimeout(this.equationManager.timerId),this.equationManager.getLhsRhsContainerRects(),this.equationManager.enableDisableDroppables(a),this.tileToNegate(),this.stopReading(),!1):(h&&this.$el.draggable("disable"),!0)},refreshCursorAt:function(){var a=this;a.$el.is(".ui-draggable")&&a.$el.draggable("option","cursorAt",{left:a.$el.width()/2,top:a.$el.height()/2})},stopListeningEvents:function(a){this.stopListening()},_onMouseUpTile:function(a){var a=a.originalEvent?a.originalEvent:a;this.attachEventsOnTile()},getTileContentInHtmlForm:function(b){var c=this.model,d=c.get("operator"),e=c.get("base"),f="",g=e,h=!0,i=!1;
switch("string"==typeof e&&(i=!0),d){case"*":f+=a.Common.Components.templates.mathematicalOperators({operator:{multiplication:!0}}).trim();break;case"+":f+=a.Common.Components.templates.mathematicalOperators({operator:{addition:!0}}).trim()}return null===e&&(h=!1),f+=a.Common.Components.templates.termTileExpr({baseValNegative:_.isString(g)?-1!==g.indexOf("-"):0>g,base:e,absBase:_.isString(g)?g.replace("-",""):Math.abs(g),baseNotNull:h,isVariable:i}).trim()},getAccString:function(a){var b="",c=this.model,d=c.get("operator"),e=c.get("base"),f=c.get("iotaExponent"),g=c.get("squareRootProps"),h=c.get("isDenominator"),d=h&&!d?"/":d,i=null,j=null,k=null,l=null,m=null,n=null;if(!a)switch(d){case"*":b+=this.getAccMessage("operators-text",0);break;case"+":b+=this.getAccMessage("operators-text",1);break;case"/":b+=this.getAccMessage("operators-text",2);break;default:b+=""}return g&&(g.isNegative&&(i=this.getAccMessage("comm19",0)),j=this.getAccMessage("operators-text",3)),f&&(k=e.toString(),(-1===e||1===e)&&(l=-1!==k.indexOf("-")?this.getAccMessage("comm19",0)+" i":"i"),m=l?l+(2===f?" "+this.getAccMessage("operators-text",4):""):(g?"":e)+(2===f?" i "+this.getAccMessage("operators-text",4):" i")),null===e&&(e=this.getAccMessage("prefixed-statements",13)),f||g?(i&&(b+=" "+i),b+=" "+(f?m:"")+(g?" "+j+" "+e:"")):(n=isNaN(e)?e:Math.round(100*e)/100,b=b+" "+n)," "+b.trim()},getElementsInsideMarquee:function(b,d){var e,f=new a.Common.Utilities.Models.Rect(d[0].getBoundingClientRect()),g=null;if(e=new a.Common.Utilities.Models.Rect(this.el.getBoundingClientRect()),g=e.getMiddle(),f.isPointInRect(g))if(this.equationManager.getWhetherPlusOperatorPresent(this.model.get("treeNodeRef"))){for(var h,i=this;i&&i.model.get("operator")===c.TileItem.OPERATORS.MULTIPLICATION;)i=i.getPrevTile();for(this.equationManager.pushElementToSelection(i,i.model.get("treeNodeRef")),h=i.getNextTile();h&&h.model.get("operator")===c.TileItem.OPERATORS.MULTIPLICATION;)this.equationManager.pushElementToSelection(h,h.model.get("treeNodeRef")),h=h.getNextTile()}else this.equationManager.pushElementToSelection(this,this.model.get("treeNodeRef"))},deActivateEventOnTiles:function(){this.$el.off("mousedown.tile").off("mouseup.tile").addClass("no-hover"),this.detachEventsOnTile()},detachEventsOnTile:function(){var a=this.$el.is(".ui-draggable"),b=this.model;a&&null!==b.get("base")&&this.$el.draggable("destroy")},attachEventOnView:function(a){var b=this;switch(a){case 1:case 7:this.$el.on("click",$.proxy(this._onBaseClick,this));break;case 2:case 8:break;case 3:case 9:this.$el.on("mousedown",function(a){return b._onMouseDownTile(a)}),this.$el.on("mouseup",function(a){return b._onMouseUpTile(a)}),this.attachEventsOnTile();break;case 6:this.$el.on("mousedown",$.proxy(this._onMouseDownTile,this)),this.$el.on("mouseup",$.proxy(this._onMouseUpTile,this))}}},{})}(window.MathInteractives),function(){"use strict";var a=MathInteractives.Common.Components.Views.EquationManagerPro;MathInteractives.Common.Components.Models.EquationManagerPro;a.BaseExponentTileView=a.TileView.extend({initialize:function(){this.initializeDefaultProperties()}},{})}(),function(){"use strict";var a=MathInteractives.Common.Components.Models.EquationManagerPro;a.CommandFactory=MathInteractives.Common.Player.Models.Base.extend({defaults:{modelRef:null,allowedOperation:null,undoStack:null},initialize:function(){this.set("undoStack",[])},resetUndoStack:function(){this.set("undoStack",[])},setData:function(a){this.set("modelRef",a.modelRef),this.set("allowedOperation",a.allowedOperation)},resetData:function(){this.set("modelRef",null),this.set("allowedOperation",null),this.resetUndoStack()},fireCommand:function(b,c){var d,e,f,g,h,i;d=new a.CommandFactory.TileLocation(b||"1.1",1),e=new a.CommandFactory.TileLocation(c||"1.2",1),f={source:d,dest:e,root:this.get("modelRef").getTree()},h=new a.CommandFactory.Rules(this.get("allowedOperation")),i=new a.CombineCommand,g=i.execute(h,this.get("modelRef"),f)},execute:function(b,c,d){var e=new a.CommandFactory.COMMANDTOCLASS[b],f=a.CommandFactory.EXIT_CODE,g=null;return(g=e.execute(c,this.get("modelRef"),d))!==f.SUCCESS?g:(this.get("undoStack").push(e),g)},undo:function(){var a=this.get("undoStack").pop();a&&(a.undo(this.get("modelRef")),a.isDummyCommand&&this.undo())}},{SEPARATOR:".",COMMANDS:{COMBINE:"COMBINE_COMMAND",BREAK_BASE:"BREAK_BASE",REPOSITION_COMMAND:"REPOSITION_COMMAND",TAKE_OUT_COMMON_COMMAND:"TAKE_OUT_COMMON_COMMAND",CHECK_PARENTHESES_RULES:"CHECK_PARENTHESES_RULES",CHECK_FRACTION_RULES:"CHECK_FRACTION_RULES",PARENTHESES_EXPONENT_CLICK:"PARENTHESES_EXPONENT_CLICK",ADD_TILE:"ADD_TILE",REPLACE_TILE:"REPLACE_TILE"},COMMANDTOCLASS:{COMBINE_COMMAND:a.CombineCommand,BREAK_BASE:a.BreakBase,REPOSITION_COMMAND:a.RepositionCommand,TAKE_OUT_COMMON_COMMAND:a.TakeOutCommonCommand,CHECK_PARENTHESES_RULES:a.CheckParenthesesRules,CHECK_FRACTION_RULES:a.CheckFractionRules,PARENTHESES_EXPONENT_CLICK:a.ParenthesesExpClick,ADD_TILE:a.AddTile,REPLACE_TILE:a.ReplaceTile},EXIT_CODE:{FAILURE:!1,SUCCESS:!0,NOT_LIKE_TERMS:2,SIMPLIFY_TERMS_FIRST:3,SIMPLIFY_IMAGINARY_NUMBER:4,NOT_DISTRIBUTIVE:5,PARENTHESES_EXPONENT_PRESENT:6,SIMPLIFY_TERM_TAKE_COMMON:7,BREAK_IMAGINARY_NUMBER:8,MINUS_ONE_COMMON_OUT:9,NEGATIVE_NUMBER_COMMON_OUT:10,ROOT_MAGNITUDE:11,FACTOR_ONE_FROM_PARANTHESES:12,MAX_VALUE_REACHED:13,DIVIDE_ON_OTHER_SIDE:14,APPLY_COEFFECIENTS:15},Rules:function(a,b,c){this.allowedOperation=a,this.isIotaAllowed=b===!0?b:!1,this.fractionToDecimalAllowed=c===!0?c:!1},TileLocation:function(a,b){this.index=a,this.numOfTiles=b}})}(),function(){var a=MathInteractives.Common.Components.Views.EquationManagerPro;a.DerivedContextMenu=MathInteractives.Common.Components.Views.ContextMenu.extend({initialize:function(){a.DerivedContextMenu.__super__.initialize.apply(this,arguments)},updateContextMenuHeight:function(){var a=(this.model.get("maxItemCount"),this.$(".contextMenuHolder"));a.width(),a.height()},updateMaxItemCount:function(a){this.model.set("maxItemCount",a)},_elementKeyup:function(){this.$el.find(".contextMenuHolder").removeAttr("style"),a.DerivedContextMenu.__super__._elementKeyup.apply(this,arguments)}},{SCROLLBAR_WIDTH:17,WRAPPER_PADDING:5,PLAYER_PADDING:8,CONTEXTMENU_OPEN:"context-menu-displayed",CONTEXTMENU_HIDE:"context-menu-hidden",CONTEXTMENU_SELECT:"context-menu-selected",initContextMenu:function(b){if(b){var c=new MathInteractives.Common.Components.Models.ContextMenu(b);c.setInteractivityPrefix(b.prefix),c.setElements(b.elements),c.setContextMenuCount(b.contextMenuCount),c.setScreenID(b.screenId),c.setManager(b.manager),c.setNestedMenuData({}),b.nestedMenuData&&c.setNestedMenuData(b.nestedMenuData);var d=new a.DerivedContextMenu({el:b.el,model:c});return d._callerView=b.thisView,d}}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.baseTilePro=a(function(a,b,c,d,e){function f(a,b){return' \r\n    <div class="acc-div acc-read-elem math-utilities-manager-access"></div>\r\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this;return i+='\ufeff<div class="base-inner ',(h=c.level)?g=h.call(b,{hash:{},data:e}):(h=b&&b.level,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'">\r\n    ',g=c["if"].call(b,b&&b.isAccessible,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(g||0===g)&&(i+=g),i+='\r\n    <div class="base-container ',(h=c["base-class"])?g=h.call(b,{hash:{},data:e}):(h=b&&b["base-class"],g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+" ",(h=c.level)?g=h.call(b,{hash:{},data:e}):(h=b&&b.level,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+' " data-tiletype="',(h=c.baseTileType)?g=h.call(b,{hash:{},data:e}):(h=b&&b.baseTileType,g=typeof h===j?h.call(b,{hash:{},data:e}):h),i+=k(g)+'">\r\n        <div class="base-value">',(h=c.base)?g=h.call(b,{hash:{},data:e}):(h=b&&b.base,g=typeof h===j?h.call(b,{hash:{},data:e}):h),(g||0===g)&&(i+=g),i+='</div>\r\n        <div class="box">\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n            <div class="inside-divs"></div>\r\n        </div>\r\n    </div>\r\n</div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.equationViewTemplate=a(function(a,b,c,d,e){function f(a,b){var d,e,f="";return f+='\r\n        <div id="',(e=c.idPrefix)?d=e.call(a,{hash:{},data:b}):(e=a&&a.idPrefix,d=typeof e===k?e.call(a,{hash:{},data:b}):e),f+=l(d)+'lhs-swipe-region" class="lhs-swipe-region">\r\n          <div id="',(e=c.idPrefix)?d=e.call(a,{hash:{},data:b}):(e=a&&a.idPrefix,d=typeof e===k?e.call(a,{hash:{},data:b}):e),f+=l(d)+'lhs-double-angle-left" class="double-angle double-angle-left"></div>\r\n          <div id="',(e=c.idPrefix)?d=e.call(a,{hash:{},data:b}):(e=a&&a.idPrefix,d=typeof e===k?e.call(a,{hash:{},data:b}):e),f+=l(d)+'lhs-swipe-region-text" class="swipe-region-text"></div>\r\n          <div id="',(e=c.idPrefix)?d=e.call(a,{hash:{},data:b}):(e=a&&a.idPrefix,d=typeof e===k?e.call(a,{hash:{},data:b}):e),f+=l(d)+'lhs-double-angle-right" class="double-angle double-angle-right"></div>\r\n        </div>\r\n        '}function g(a,b){var d,e,f="";return f+='\r\n        <div id="',(e=c.idPrefix)?d=e.call(a,{hash:{},data:b}):(e=a&&a.idPrefix,d=typeof e===k?e.call(a,{hash:{},data:b}):e),f+=l(d)+'rhs-swipe-region" class="rhs-swipe-region">\r\n          <div id="',(e=c.idPrefix)?d=e.call(a,{hash:{},data:b}):(e=a&&a.idPrefix,d=typeof e===k?e.call(a,{hash:{},data:b}):e),f+=l(d)+'rhs-double-angle-left" class="double-angle double-angle-left"></div>\r\n          <div id="',(e=c.idPrefix)?d=e.call(a,{hash:{},data:b}):(e=a&&a.idPrefix,d=typeof e===k?e.call(a,{hash:{},data:b}):e),f+=l(d)+'rhs-swipe-region-text" class="swipe-region-text"></div>\r\n          <div id="',(e=c.idPrefix)?d=e.call(a,{hash:{},data:b}):(e=a&&a.idPrefix,d=typeof e===k?e.call(a,{hash:{},data:b}):e),f+=l(d)+'rhs-double-angle-right" class="double-angle double-angle-right"></div>\r\n        </div>\r\n        '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this.escapeExpression,m=this;return j+='<div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'workspace-expression-area-equation-view" class="equation-view-component">\r\n  <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'lhs-expression-view" class="lhs-expression-view">\r\n    <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'lhs-expression-seperator-holder" class="lhs-expression-seperator-holder expression-seperator-holder"></div>\r\n    <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'lhs-expression-top-holder" class="lhs-expression-top-holder">\r\n      \r\n      <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'lhs-expression-view-expression" class="lhs-expression-view-expression">\r\n        ',h=c["if"].call(b,b&&b.isMobile,{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(h||0===h)&&(j+=h),j+='\r\n      </div>\r\n    </div>\r\n    <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'lhs-expression-bottom-holder" class="lhs-expression-bottom-holder">\r\n      <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'show-lhs-expression" class="show-lhs-expression">\r\n        <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'lhs-expression-container" class="lhs-expression-container"></div>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n  <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'equals-sign-container" class="equals-sign-container">\r\n    <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'equals-sign" class="equals-sign"></div>\r\n  </div>\r\n  <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'rhs-expression-view" class="rhs-expression-view">\r\n    <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'rhs-expression-seperator-holder" class="rhs-expression-seperator-holder expression-seperator-holder"></div>\r\n    <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'rhs-expression-top-holder" class="rhs-expression-top-holder">\r\n      <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'rhs-expression-view-expression" class="rhs-expression-view-expression">\r\n        ',h=c["if"].call(b,b&&b.isMobile,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(h||0===h)&&(j+=h),j+='\r\n      </div>\r\n      \r\n    </div>\r\n    <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'rhs-expression-bottom-holder" class="rhs-expression-bottom-holder">\r\n      <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'show-rhs-expression" class="show-rhs-expression">\r\n        <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'rhs-expression-container" class="rhs-expression-container"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div id="',(i=c.idPrefix)?h=i.call(b,{hash:{},data:e}):(i=b&&b.idPrefix,h=typeof i===k?i.call(b,{hash:{},data:e}):i),j+=l(h)+'drag-handle-containment" class="drag-handle-containment"></div>\r\n</div>\r\n'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.parenthesesTemplate=a(function(a,b,c,d,e){function f(a,b){var d,e,f="";return f+='\r\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="126" focusable="false">\r\n  <defs/>\r\n  <g>\r\n    <path stroke="none" fill="',(e=c.color)?d=e.call(a,{hash:{},data:b}):(e=a&&a.color,d=typeof e===j?e.call(a,{hash:{},data:b}):e),f+=k(d)+'" d="M16 25.05 L16.05 105.95 Q15.35 112.65 11.2 118.15 6.8 123.9 0 126.35 13.7 117.5 13.9 103.6 L13.85 25.05 16 25.05"/>\r\n    <path stroke="none" fill="',(e=c.color)?d=e.call(a,{hash:{},data:b}):(e=a&&a.color,d=typeof e===j?e.call(a,{hash:{},data:b}):e),f+=k(d)+'" d="M0 0.05 Q6.8 2.5 11.2 8.25 15.35 13.75 16.05 20.45 L16 101.35 13.85 101.35 13.9 22.8 Q13.7 8.9 0 0.05"/>\r\n  </g>\r\n</svg>  \r\n'}function g(a,b){var d,e,f="";return f+='\r\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="9" height="54">\r\n  <defs/>\r\n  <g>\r\n    <path stroke="none" fill="',(e=c.color)?d=e.call(a,{hash:{},data:b}):(e=a&&a.color,d=typeof e===j?e.call(a,{hash:{},data:b}):e),f+=k(d)+'" d="M9 14.5 L9 30.4 6.05 30.4 6.1 14.15 Q5.7 4.1 -0.05 0.05 8.2 2.25 9 14.5"/>\r\n    <path stroke="none" fill="',(e=c.color)?d=e.call(a,{hash:{},data:b}):(e=a&&a.color,d=typeof e===j?e.call(a,{hash:{},data:b}):e),f+=k(d)+'" d="M6.05 23.6 L9 23.6 9 39.5 Q8.2 51.75 -0.05 53.95 5.7 49.9 6.1 39.85 L6.05 23.6"/>\r\n  </g>\r\n</svg>\r\n'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="",j="function",k=this.escapeExpression,l=this;return i+="\ufeff",h=c["if"].call(b,b&&b.isBigParentheses,{hash:{},inverse:l.program(3,g,e),fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.binTileArray=a(function(a,b,c,d,e){function f(a,b,c){var d,e="";return e+='\r\n	<div id="'+n((d=c&&c.idPrefix,typeof d===m?d.apply(a):d))+n((d=c&&c.prefix,typeof d===m?d.apply(a):d))+"-bin-tile-number-"+n((d=a&&a.className,typeof d===m?d.apply(a):d))+'" class="bin-tile-number-'+n((d=a&&a.className,typeof d===m?d.apply(a):d))+' bin-tiles" data-tiletype="'+n((d=c&&c.tileType,typeof d===m?d.apply(a):d))+'" data-tilevalue="'+n((d=a&&a.value,typeof d===m?d.apply(a):d))+'"></div>\r\n'}function g(a,b,d){var e,f="";return f+="\r\n	",e=c.each.call(a,a&&a.frequencyTile1,{hash:{},inverse:o.noop,fn:o.programWithDepth(4,h,b,a,d),data:b}),(e||0===e)&&(f+=e),f+="\r\n"}function h(a,b,c,d){var e,f="";return f+='\r\n		<div id="'+n((e=d&&d.idPrefix,typeof e===m?e.apply(a):e))+n((e=c&&c.prefix,typeof e===m?e.apply(a):e))+"-bin-tile-"+n((e=c&&c.tileOneText,typeof e===m?e.apply(a):e))+"-"+n(typeof a===m?a.apply(a):a)+'" class="bin-tile-'+n((e=c&&c.tileOneText,typeof e===m?e.apply(a):e))+"-"+n(typeof a===m?a.apply(a):a)+" bin-tile-"+n((e=c&&c.tileOneText,typeof e===m?e.apply(a):e))+' bin-tiles" data-tiletype="'+n((e=d&&d.tileType,typeof e===m?e.apply(a):e))+'" data-tilevalue="'+n((e=c&&c.tileOneText,typeof e===m?e.apply(a):e))+'"></div>\r\n	'}function i(a,b,d){var e,f="";return f+="\r\n	",e=c.each.call(a,a&&a.frequencyTile2,{hash:{},inverse:o.noop,fn:o.programWithDepth(7,j,b,a,d),data:b}),(e||0===e)&&(f+=e),f+="\r\n"}function j(a,b,c,d){var e,f="";return f+='\r\n		<div id="'+n((e=d&&d.idPrefix,typeof e===m?e.apply(a):e))+n((e=c&&c.prefix,typeof e===m?e.apply(a):e))+"-bin-tile-"+n((e=c&&c.tileTwoText,typeof e===m?e.apply(a):e))+"-"+n(typeof a===m?a.apply(a):a)+'" class="bin-tile-'+n((e=c&&c.tileTwoText,typeof e===m?e.apply(a):e))+"-"+n(typeof a===m?a.apply(a):a)+" bin-tile-"+n((e=c&&c.tileTwoText,typeof e===m?e.apply(a):e))+' bin-tiles" data-tiletype="'+n((e=d&&d.tileType,typeof e===m?e.apply(a):e))+'" data-tilevalue="'+n((e=c&&c.tileTwoText,typeof e===m?e.apply(a):e))+'"></div>\r\n	'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var k,l="",m="function",n=this.escapeExpression,o=this;return k=c.each.call(b,b&&b.tileArray,{hash:{},inverse:o.noop,fn:o.programWithDepth(1,f,e,b),data:e}),(k||0===k)&&(l+=k),l+="\r\n",k=c["if"].call(b,b&&b.tileOneText,{hash:{},inverse:o.noop,fn:o.programWithDepth(3,g,e,b),data:e}),(k||0===k)&&(l+=k),l+="\r\n",k=c["if"].call(b,b&&b.tileTwoText,{hash:{},inverse:o.noop,fn:o.programWithDepth(6,i,e,b),data:e}),(k||0===k)&&(l+=k),l})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.buttonGroup=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f),(g=c.buttonName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.buttonName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-button-container" class="',(g=c.buttonName)?f=g.call(b,{hash:{},data:e}):(g=b&&b.buttonName,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'-button-container"></div>'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.exprContainer=a(function(a,b,c,d,e){function f(a,b){return"\r\n	<div class='left-expression-container equation-common'><div class='left-expression equation-common expression-common'>\r\n"}function g(a,b){return"\r\n	<div class='right-expression-container equation-common'><div class='right-expression equation-common expression-common'>\r\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k=this,l="function";return h=c["if"].call(b,b&&b.isLHS,{hash:{},inverse:k.program(3,g,e),fn:k.program(1,f,e),data:e}),(h||0===h)&&(j+=h),j+="\r\n	",(i=c.exprBody)?h=i.call(b,{hash:{},data:e}):(i=b&&b.exprBody,h=typeof i===l?i.call(b,{hash:{},data:e}):i),(h||0===h)&&(j+=h),j+="\r\n</div></div>"})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.headerExprContainer=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function";return h+="<div class='header-expression-container'><div class='header-expression equation-common'>\r\n",(g=c.exprBody)?f=g.call(b,{hash:{},data:e}):(g=b&&b.exprBody,f=typeof g===i?g.call(b,{hash:{},data:e}):g),(f||0===f)&&(h+=f),h+="\r\n</div></div>"})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.mathematicalOperators=a(function(a,b,c,d,e){function f(a,b){var d,e="";return e+="\r\n	",d=c["if"].call(a,(d=a&&a.operator,null==d||d===!1?d:d.hide),{hash:{},inverse:s.program(4,h,b),fn:s.program(2,g,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n"}function g(a,b){return"\r\n	<div class='hide-operator equation-common'></div>\r\n	"}function h(a,b){return"\r\n	<div class='multiplication-operator equation-common'></div>\r\n	"}function i(a,b){var d,e="";return e+=" \r\n	",d=c["if"].call(a,(d=a&&a.operator,null==d||d===!1?d:d.addition),{hash:{},inverse:s.program(9,k,b),fn:s.program(7,j,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n"}function j(a,b){return"\r\n		<div class='addition-operator equation-common'>&nbsp;&#43;&nbsp;</div>\r\n	"}function k(a,b){var d,e="";return e+=" \r\n		",d=c["if"].call(a,(d=a&&a.operator,null==d||d===!1?d:d.equals),{hash:{},inverse:s.program(12,m,b),fn:s.program(10,l,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n	"}function l(a,b){return"\r\n			<div class='equal-to-sign equation-common'>&nbsp;=&nbsp;</div>\r\n		"}function m(a,b){var d,e="";return e+="\r\n			",d=c["if"].call(a,(d=a&&a.operator,null==d||d===!1?d:d.division),{hash:{},inverse:s.program(15,o,b),fn:s.program(13,n,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n		"}function n(a,b){return"\r\n				<div class='division-operator equation-common'></div>\r\n			"}function o(a,b){var d,e="";return e+="\r\n				",d=c["if"].call(a,(d=a&&a.operator,null==d||d===!1?d:d.subtraction),{hash:{},inverse:s.program(18,q,b),fn:s.program(16,p,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n			"}function p(a,b){return"\r\n					<div class='subtraction-operator equation-common'></div>\r\n				"}function q(a,b){return"\r\n					<div class='no-operator equation-common'></div>\r\n				"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var r,s=this;return r=c["if"].call(b,(r=b&&b.operator,null==r||r===!1?r:r.multiplication),{hash:{},inverse:s.program(6,i,e),fn:s.program(1,f,e),data:e}),r||0===r?r:""})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.fractionExpr=a(function(a,b,c,d,e){function f(a,b){return"\r\n		<div class='fraction-data-tab equation-common'><div class='numerator numerator-empty equation-common'>1\r\n	"}function g(a,b){var d,e="";return e+="\r\n		",d=c["if"].call(a,a&&a.isFractionParentParenthesis,{hash:{},inverse:o.program(6,i,b),fn:o.program(4,h,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n	"}function h(a,b){return" \r\n			<div class='fraction-data-tab adjust-bottom equation-common'><div class='numerator equation-common'>\r\n		"}function i(a,b){return"\r\n			<div class='fraction-data-tab equation-common'><div class='numerator equation-common'>\r\n		"}function j(a,b){return"\r\n		<div class='denominator denominator-empty equation-common'>\r\n	"}function k(a,b){return"\r\n		<div class='denominator equation-common'>\r\n	"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var l,m,n="",o=this,p="function";return n+="<!--Start of Fraction-->\r\n	<!--Start of Numerator-->\r\n	",l=c["if"].call(b,b&&b.isNumeratorEmpty,{hash:{},inverse:o.program(3,g,e),fn:o.program(1,f,e),data:e}),(l||0===l)&&(n+=l),n+="\r\n	\r\n	",(m=c.numeratorBody)?l=m.call(b,{hash:{},data:e}):(m=b&&b.numeratorBody,l=typeof m===p?m.call(b,{hash:{},data:e}):m),(l||0===l)&&(n+=l),n+="\r\n	\r\n	</div> <!--End of Numerator-->\r\n\r\n	<div class='vinicullum'></div>\r\n	\r\n	<!--Start of Denominator-->\r\n	",l=c["if"].call(b,b&&b.isDenominatorEmpty,{hash:{},inverse:o.program(10,k,e),fn:o.program(8,j,e),data:e}),(l||0===l)&&(n+=l),n+="\r\n	\r\n	",(m=c.denominatorBody)?l=m.call(b,{hash:{},data:e}):(m=b&&b.denominatorBody,l=typeof m===p?m.call(b,{hash:{},data:e}):m),(l||0===l)&&(n+=l),n+="\r\n	\r\n	</div> <!--End of Denominator-->\r\n</div> <!--End of Fraction-->"})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.termTileExpr=a(function(a,b,c,d,e){function f(a,b){var d,e="";return e+="\r\n	",d=c["if"].call(a,a&&a.baseNotNull,{hash:{},inverse:s.program(7,j,b),fn:s.program(2,g,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n"}function g(a,b){var d,e="";return e+="\r\n		",d=c["if"].call(a,a&&a.isVariable,{hash:{},inverse:s.program(5,i,b),fn:s.program(3,h,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n	"}function h(a,b){var d,e,f="";return f+="\r\n			<span class='base-exp-data-tab equation-common'>\r\n                <span class='open-bracket minus-open-bracket'>(</span>\r\n                <span class=\"minus-sign-base equation-common\">&minus;</span>\r\n                <span class='equation-variable'><em>",(e=c.absBase)?d=e.call(a,{hash:{},data:b}):(e=a&&a.absBase,d=typeof e===q?e.call(a,{hash:{},data:b}):e),f+=r(d)+"</em></span>\r\n                <span class='closed-bracket minus-closed-bracket'>)</span>\r\n            </span>\r\n		"}function i(a,b){var d,e,f="";return f+="\r\n			<span class='base-exp-data-tab equation-common open-bracket-container'>\r\n                <span class='open-bracket minus-open-bracket'>(</span>\r\n                <span class=\"minus-sign-base equation-common\">&minus;</span>\r\n                <span class='base-exp-data-tab equation-common'>",(e=c.absBase)?d=e.call(a,{hash:{},data:b}):(e=a&&a.absBase,d=typeof e===q?e.call(a,{hash:{},data:b}):e),f+=r(d)+"</span>\r\n                <span class='closed-bracket minus-closed-bracket'>)</span>\r\n            </span>\r\n		"}function j(a,b){return"\r\n		<div class='static-empty-tile empty-tile'>\r\n			<div class='box'>\r\n				<div class='inside-divs'></div>\r\n				<div class='inside-divs'></div>\r\n				<div class='inside-divs'></div>\r\n				<div class='inside-divs'></div>\r\n				<div class='inside-divs'></div>\r\n				<div class='inside-divs'></div>\r\n			</div>\r\n		</div>\r\n	"}function k(a,b){var d,e="";return e+="\r\n	",d=c["if"].call(a,a&&a.baseNotNull,{hash:{},inverse:s.program(7,j,b),fn:s.program(10,l,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n"}function l(a,b){var d,e="";return e+="\r\n		",d=c["if"].call(a,a&&a.isVariable,{hash:{},inverse:s.program(13,n,b),fn:s.program(11,m,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n	"}function m(a,b){var d,e,f="";return f+="\r\n			<span class='base-exp-data-tab equation-common equation-variable'><em>",(e=c.base)?d=e.call(a,{hash:{},data:b}):(e=a&&a.base,d=typeof e===q?e.call(a,{hash:{},data:b}):e),(d||0===d)&&(f+=d),f+="</em></span>\r\n		"}function n(a,b){var d,e,f="";return f+="\r\n			<span class='base-exp-data-tab equation-common'>",(e=c.base)?d=e.call(a,{hash:{},data:b}):(e=a&&a.base,d=typeof e===q?e.call(a,{hash:{},data:b}):e),(d||0===d)&&(f+=d),f+="</span>\r\n		"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var o,p="",q="function",r=this.escapeExpression,s=this;return o=c["if"].call(b,b&&b.baseValNegative,{hash:{},inverse:s.program(9,k,e),fn:s.program(1,f,e),data:e}),(o||0===o)&&(p+=o),p+="\r\n"})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.parenthesesExpr=a(function(a,b,c,d,e){function f(a,b){var d,e,f="";return f+="\r\n	<span class='big-parenthesis-container equation-common'><span class='open-parentheses-data-tab'>",(e=c.bracket)?d=e.call(a,{hash:{},data:b}):(e=a&&a.bracket,d=typeof e===s?e.call(a,{hash:{},data:b}):e),(d||0===d)&&(f+=d),f+="</span>\r\n"}function g(a,b){return"\r\n	<span class='equation-common'><span class='equation-common open-bracket'>(</span>\r\n"}function h(a,b){var d,e,f="";return f+="\r\n	<span class='close-parentheses-data-tab equation-common'>",(e=c.bracket)?d=e.call(a,{hash:{},data:b}):(e=a&&a.bracket,d=typeof e===s?e.call(a,{hash:{},data:b}):e),(d||0===d)&&(f+=d),f+="</span></span>\r\n"}function i(a,b){return"\r\n	<span class='equation-common closed-bracket'>)</span></span>\r\n"}function j(a,b){var d,e="";return e+="\r\n	",d=c["if"].call(a,a&&a.exponentNegative,{hash:{},inverse:u.noop,fn:u.program(10,k,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n	",d=c["if"].call(a,a&&a.bigParenthesis,{hash:{},inverse:u.program(17,o,b),fn:u.program(15,n,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n"}function k(a,b){var d,e="";return e+="\r\n		",d=c["if"].call(a,a&&a.bigParenthesis,{hash:{},inverse:u.program(13,m,b),fn:u.program(11,l,b),data:b}),(d||0===d)&&(e+=d),e+="\r\n	"}function l(a,b){var d,e,f="";return f+="\r\n			<span class='minus-sign-exponent minus-sign-exponent-big-parenthesis equation-common'>&minus;</span>",(e=c.absExponent)?d=e.call(a,{hash:{},data:b}):(e=a&&a.absExponent,d=typeof e===s?e.call(a,{hash:{},data:b}):e),f+=t(d)+"\r\n		"}function m(a,b){var d,e,f="";return f+="\r\n			<span class='minus-sign-exponent equation-common'>&minus;</span>",(e=c.absExponent)?d=e.call(a,{hash:{},data:b}):(e=a&&a.absExponent,d=typeof e===s?e.call(a,{hash:{},data:b}):e),f+=t(d)+"\r\n		"}function n(a,b){var d,e,f="";return f+="\r\n		<div class='big-parenthesis-exponent-data-tab equation-common'>",(e=c.exponent)?d=e.call(a,{hash:{},data:b}):(e=a&&a.exponent,d=typeof e===s?e.call(a,{hash:{},data:b}):e),f+=t(d)+"</div>\r\n	"}function o(a,b){var d,e,f="";return f+="\r\n		<div class='parenthesis-exponent-data-tab exponent-data-tab equation-common'>",(e=c.exponent)?d=e.call(a,{hash:{},data:b}):(e=a&&a.exponent,d=typeof e===s?e.call(a,{hash:{},data:b}):e),f+=t(d)+"</div>\r\n	"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var p,q,r="",s="function",t=this.escapeExpression,u=this;return p=c["if"].call(b,b&&b.bigParenthesis,{hash:{},inverse:u.program(3,g,e),fn:u.program(1,f,e),data:e}),(p||0===p)&&(r+=p),r+="\r\n\r\n",(q=c.parenthesesBody)?p=q.call(b,{hash:{},data:e}):(q=b&&b.parenthesesBody,p=typeof q===s?q.call(b,{hash:{},data:e}):q),(p||0===p)&&(r+=p),r+="\r\n\r\n",p=c["if"].call(b,b&&b.bigParenthesis,{hash:{},inverse:u.program(7,i,e),fn:u.program(5,h,e),data:e}),(p||0===p)&&(r+=p),r+="\r\n\r\n",p=c["if"].call(b,b&&b.exponent,{hash:{},inverse:u.noop,fn:u.program(9,j,e),data:e}),(p||0===p)&&(r+=p),r})}();