!function(a){"use strict";a.Common.Components.Models.EquationManagerPro={},a.Common.Components.Views.EquationManagerPro={};var b=a.Common.Components.Models.EquationManagerPro;b.EquationManagerPro=a.Common.Player.Models.Base.extend({defaults:{allowedOperation:null,tileAddedFromBinValue:null,addTileInExpression:null,resetBtnStatus:!1,isFirstTileDrop:!1,isFractionToDecimalAllowed:!1,operationPerformed:{operation:null,isDenominator:null},numberToReplaceInBin:null}},{Utils:{isBasicTileType:function(a){var c=a.get("type"),d=b.TileItem.TileType;return c===d.TERM_TILE||c===d.BASE_EXPONENT},getSourceWrtParent:function(a){var c=a.lastIndexOf(b.CommandFactory.SEPARATOR);return a.substring(c+1)},getParentIndex:function(a){if(1===a.length)return"";var c=a.lastIndexOf(b.CommandFactory.SEPARATOR);return a.substring(0,c)},getParentTiles:function(a,c){return c=b.EquationManagerPro.Utils.getParentIndex(c),a.getModelFromIndex(c).get("tileArray")},getCommonParent:function(a,b){for(var c=a.getPath(),d=b.getPath(),e=a.getTreeRoot(),f=Math.min(c.length,d.length),g=[],h=0;f>h&&c[h]===d[h];h++)g[h]=c[h];return e.getChildAt(g)},getCommonParentFromMultiple:function(a){if(1===a.length)return a[0];var c=b.EquationManagerPro.Utils.getCommonParent(a[0],a[1]),d=0;if(2===a.length)return c;for(d=2;d<a.length&&!c.isRoot();d++)c=b.EquationManagerPro.Utils.getCommonParent(c,a[d]);return c},getOperatorsBetween:function(a,c){var d=b.EquationManagerPro.Utils.getCommonParent(a,c),e={},f=null,g=a,h=[],i=[];for(e.commonParentOperator=d;!_.isEqual(g,d)&&!_.isEqual(g.parent,d);)f=g.parent,h.push(f),g=g.parent;for(e.node1ToParentOperators=h,g=c;!_.isEqual(g,d)&&!_.isEqual(g.parent,d);)f=g.parent,i.push(f),g=g.parent;return e.node2ToParentOperators=i,e},getOperatorStringsBetween:function(a,c){var d=b.EquationManagerPro.Utils.getOperatorsBetween(a,c),e=[],f=0;for(f=0;f<d.node1ToParentOperators.length;f++)e.push(d.node1ToParentOperators[f].data);for(e.push(d.commonParentOperator.data),f=0;f<d.node2ToParentOperators.length;f++)e.push(d.node2ToParentOperators[f].data);return e},tilesToNodes:function(a,c){var d=[],e=0;for(e=0;e<c.length;e++)d.push(b.EquationManagerPro.Utils.searchInTree(a,c[e]));return d},searchInTree:function(a,c){var d,e;if(null===a||void 0===a)return null;if(a.data===c||a.collectionData===c)return a;for(d=0;d<a.children.length;d++)if(e=b.EquationManagerPro.Utils.searchInTree(a.children[d],c),null!==e&&void 0!==e)return e},getModelDataFromTreeNode:function(a){return _.isString(a.data)&&a.collectionData?a.collectionData:a.data},checkAndGenerateStaticZeroForEquation:function(a,c){c=c||{};var d,e,f,g,h=a.get("tileArray"),i=c.ignoreRHS?1:2;for(g=0;i>g;g++)if(d=h.at(g),e=d.get("tileArray"),0===e.length)return f=b.TileItem.createTileItem({type:b.TileItem.TileType.TERM_TILE,base:0,operator:null,isDraggable:!1,isDroppable:!1,ignoreMarquee:!0,isLHS:0===g}),e.add(f),f;return!1},_hasVariableTermTile:function(a,c){var d,e=!1;if(a.children.length)for(d=a.children.length-1;d>=0&&!(e=b.EquationManagerPro.Utils._hasVariableTermTile(a.children[d],c));d--);else e=c.call(this,a);return e},_isVariableTermTile:function(a){var c=a.data;return c instanceof b.TermTile&&"string"==typeof c.get("base")},_isNonNumericTermTile:function(a){var c=a.data;return c instanceof b.TermTile&&("string"==typeof c.get("base")||c.get("iotaExponent"))},_isZeroTile:function(a){var c=a.data;return c instanceof b.TermTile&&0===c.get("base")},_isVariableImaginaryTermTile:function(a,c){c=c||{};var d,e,f,g,h=a.data,i=!1;return h instanceof b.TermTile&&(d=h.get("base"),e=h.get("iotaExponent"),f=h.get("squareRootProps"),g=e&&!f||e&&f&&d>0||!e&&f&&0>d,c.checkForIotaOnly?g&&(i=!0):("string"==typeof d||g)&&(i=!0)),i},_isIotaSquareTerm:function(a){var c=a.data;return c instanceof b.TermTile&&2===c.get("iotaExponent")},hasCombinableImaginaryTerms:function(a){var c,d,e=a.data,f=a.children,g=b.TileItem.OPERATORS;switch(e){case g.ADDITION:for(c=0;c<f.length;c++)if(b.EquationManagerPro.Utils.hasCombinableImaginaryTerms(f[c]))return!0;return!1;case g.PARENTHESES:return b.EquationManagerPro.Utils.hasCombinableImaginaryTerms(f[0]);case g.MULTIPLICATION:for(c=0;c<f.length;c++)if(b.EquationManagerPro.Utils.hasCombinableImaginaryTerms(f[c]))return!0;for(d=0,c=0;c<f.length;c++)b.EquationManagerPro.Utils._hasImaginaryTerm(f[c])&&d++;return d>0&&d%2===0;case g.DIVISION:return!1;default:return b.EquationManagerPro.Utils._isIotaSquareTerm(a)}},_hasImaginaryTerm:function(a){var c,d,e=a.data,f=a.children,g=b.TileItem.OPERATORS;switch(e){case g.ADDITION:for(c=0;c<f.length;c++)if(b.EquationManagerPro.Utils._hasImaginaryTerm(f[c]))return!0;return!1;case g.PARENTHESES:return b.EquationManagerPro.Utils._hasImaginaryTerm(f[0]);case g.MULTIPLICATION:for(d=0,c=0;c<f.length;c++)b.EquationManagerPro.Utils._hasImaginaryTerm(f[c])&&d++;return d%2!==0;case g.DIVISION:return!1;default:return e instanceof b.TermTile&&b.EquationManagerPro.Utils._isVariableImaginaryTermTile(a,{checkForIotaOnly:!0})}},getAllLeaves:function(a,b){var c,d=[],e=a.data;if(null===e)return[];if(a.isLeaf())return[a];if(b&&"^"===a.data)for(c=a.children.length-1;c>=0;c--)Array.prototype.push.apply(d,this.getAllLeaves(a.children[c],b));else for(c=0;c<a.children.length;c++)Array.prototype.push.apply(d,this.getAllLeaves(a.children[c],b));return d},_compareParenthesesEqual:function(a,c){var d,e,f,g=a.children,h=c.children;if(g.length!==h.length)return!1;if(d=this._getBaseWithParentsToCompare(b.EquationManagerPro.Utils.getAllLeaves(a)),e=this._getBaseWithParentsToCompare(b.EquationManagerPro.Utils.getAllLeaves(c)),d.length!==e.length)return!1;for(d.sort(),e.sort(),f=0;f<d.length;f++)if(d[f]!==e[f])return!1;return!0},_getBaseWithParentsToCompare:function(a){var c,d,e,f,g="";for(c=0;c<a.length;c++){for(d=a[c],e=d.data.get("iotaExponent"),f=d.data.get("squareRootProps"),g=d.data.get("base")+"",e&&(g+="i"+e),f&&(g+=f.exponent+"",g+=f.isNegative+"");d.data!==b.TileItem.OPERATORS.PARENTHESES;)d=d.parent,g+=d.data;a[c]=g,g=""}return a},getGCF:function(a,b){var c;return c=0!==b?this.getGCF(b,a%b):a}},FOCUS_DIV_STYLE:{outline:"2px dotted #aaa",height:"52px",width:"52px",position:"absolute",color:"rgba(0,0,0,0)","font-size":"0px","z-index":"-1"}})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Views.EquationManagerPro,c=a.Common.Components.Models.EquationManagerPro,d=a.Common.Utilities.Models.Rect,e=a.Common.Utilities.Models.Point,f=a.Common.Utilities.Models.BrowserCheck;b.EquationManagerPro=a.Common.Player.Views.Base.extend({equationView:null,commandFactory:null,$draggableContainment:null,restrictFirstTileAnimation:!1,firstTile:null,currentHoveredTile:null,getIdPrefix:function(){return this.idPrefix},root:null,_isTouch:null,_isDropped:!1,getIsDropped:function(){return this._isDropped},setIsDropped:function(a){this._isDropped=a},deletedItemsInParenthesesFraction:null,$binTileContainment:null,tileTextFrequencyArray:0,tileTextArray:null,resetButtonType:null,undoButtonType:null,$buttonGroupContainer:null,resetButtonView:null,undoButtonView:null,numericTileArray:null,timerId:null,binTileArray:null,resetButtonTextColor:null,undoButtonTextColor:null,$lhsExprView:null,$rhsExprView:null,$lhsExprBgView:null,$rhsExprBgView:null,$showLhsExprBgView:null,$showRhsExprBgView:null,$lhsExprEqnHolder:null,$rhsExprEqnHolder:null,isTutorialMode:!1,marqueeSelectedItems:null,marqueeSelectedRefNodes:null,marqueeNodes:null,marqueeView:null,marqueeViews:null,postIdPrefixString:"",resetPopUpTexts:null,showRightTooltip:!1,showLeftTooltip:!1,tabOrderArr:[],termTileConextMenuScreenId:null,_tutorialMarqueeFirstElementIndex:null,_tutorialMarqueeLastElementIndex:null,combineLikeBasesTooltip:null,tabIndex:null,$equationCOntainer:null,accDivOffset:null,ignoreChangeSignForTextTile:!1,initialize:function(){var b=this.options,c=b.tileTextFrequencyArray,d=b.tileTextArray,e=b.numericTileArray,f="undefined",g=a.global.Theme2.Button.TYPE.FA_ICON,h="#ffffff",i=a.Common.Utilities.Models.BrowserCheck,j=b.postIdPrefixString,k=b.ignoreChangeSignForTextTile,l=b.termTileContextMenuScreenId;this.binTileArray=[],this.onlyLHS=b.onlyLHS,this.solveFractionToDecimal=this.model.get("isFractionToDecimalAllowed"),this._isIE9=i.isIE&&i.browserVersion<10,this.initializeDefaultProperties(),this.marqueeViews=[],this.marqueeSelectedRefNodes=[],this.deletedItemsInParenthesesFraction=[],this.isBottomExpressionShown=this.options.isBottomExpressionShown,this._createCommandFactory({}),this.parenthesesColor=b.parenthesesColor,b.$binTileDraggableContainment&&(this.$binTileDraggableContainment=b.$binTileDraggableContainment),b.draggableContainment&&(this.$draggableContainment=b.draggableContainment),b.binTileContainment&&(this.$binTileContainment=b.binTileContainment),typeof c!==f&&null!==c&&(this.tileTextFrequencyArray=c),typeof d!==f&&null!==d&&(this.tileTextArray=d),typeof e!==f&&null!==e&&this.updatesNumericTileArray(e),j&&(this.postIdPrefixString=j),b.tabIndex&&(this.tabIndex=b.tabIndex),b.accDivOffset&&(this.accDivOffset=b.accDivOffset),k&&(this.ignoreChangeSignForTextTile=k),l&&(this.termTileConextMenuScreenId=l),this.binTileArray=b.numericTileArray||[],this.setElement(b.element),this.$overlayDiv=$("<div></div>").addClass("overlay-div").hide(),this.$overlayDiv2=$("<div></div>").addClass("overlay-div overlay-div-2").hide(),this.$el.append(this.$overlayDiv).append(this.$overlayDiv2),this._setNegativeSign(),this.$equationContainer=this.$el,b.createTileBin===!0&&this.updateTilesInBin(b.isTutorial),b.createButtonGroup===!0&&(this.buttonGroup=b.buttonGroup?b.buttonGroup:[],this.resetButtonType=b.resetButtonType?b.resetButtonType:g,this.undoButtonType=b.resetButtonType?b.resetButtonType:g,this.resetButtonTextColor=b.resetButtonTextColor?b.resetButtonTextColor:h,this.undoButtonTextColor=b.undoButtonTextColor?b.undoButtonTextColor:h,this.undoButtonWidth=b.undoButtonWidth?b.undoButtonWidth:null,this.resetButtonWidth=b.resetButtonWidth?b.resetButtonWidth:null,this.$buttonGroupContainer=b.buttonGroupContainer,this._createResetUndoButtons()),b.resetPopUpTexts&&(this.resetPopUpTexts=b.resetPopUpTexts),this.loadScreen("equation-manager-pro-messages"),this.marqueeContainer=b.marqueeDiv||this.$equationContainer||this.$el},_setIsTouch:function(){var b=a.Common.Utilities.Models.BrowserCheck;this._isTouch=b.isAndroid||b.isIOS},isTouch:function(){return null===this._isTouch&&this._setIsTouch(),this._isTouch},render:function(a){this.equationView.createView(this.parenthesesColor),this.equationView.checkForFractionInExpression(),this.equationView.hideOperatorOfParCoeff(),this._checkOfIntroductionOfParenthesesOrFraction(),this.isExpressionContainsParentheses(),this._cacheWindowElements(),this._attachEvents(),this.options.createTileBin&&this._setDropSlotsForBinTiles(),this.isBottomExpressionShown&&this._updateBottomEquations(),this.getLhsRhsContainerRects(),this.setDeletedItemsInParenthesesFraction(),this._createTooltips(),this.marqueeViews=this._generateMarquee(),this._handleTouchScroll(),this.removeMarquee(),this._firstTileDrop(a)},_firstTileDrop:function(){},_handleTouchScroll:function(){var a,b;this.isMobile&&(this.$el.addClass("is-touch"),a=this.filePath.getFontAwesomeClass("angle-double-left"),b=this.filePath.getFontAwesomeClass("angle-double-right"),this.$(".double-angle-left").addClass(a),this.$(".double-angle-right").addClass(b),this.$(".swipe-region-text").html(this.getMessage("swipe-region-text",0)))},_createCommandFactory:function(a){a=a||{},this.commandFactory=new c.CommandFactory(a)},setData:function(c,d){this.resetData();var e=a.Common.Components.Models.EquationManagerPro,f=new e.Equation(c.equationData),g=null,h="";if(this.equationView=new b.EquationView({model:f,equationManager:this,player:this.player}),!c.equationViewContainer)throw new Error("Provide EquationView container");this.equationView.setEquationContainer(c.equationViewContainer);var i={modelRef:this.equationView.model,allowedOperation:c.cmdFactoryData.allowedOperation||this.model.get("allowedOperation")};d||this.isBottomExpressionShown&&(g=this.equationView.getTileContentInHtmlForm(),h=this.equationView.getAccString(b.EquationManagerPro.DATA),this.trigger(b.EquationManagerPro.EVENTS.NEW_EXPRESSION_START,{equationHtml:g,equationAccString:h})),this.commandFactory.setData(i),this.setTreeRoot(),this.undoButtonView&&this.enableDisableSpecificButton(b.EquationManagerPro.UNDO_BUTTON,!1),this.resetButtonView&&this.enableDisableSpecificButton(b.EquationManagerPro.RESET_BUTTON,this.model.get("resetBtnStatus"))},resetData:function(){this.equationView&&(this.equationView.reset(),this.equationView=null),this.commandFactory.resetData()},resetBools:function(){this.setTileAddedFromBinValue(),this.setTileAddedInExpression()},_attachEvents:function(){var a=this;this.equationView.attachEvents(),this.$overlayDiv&&this.$overlayDiv.on("mousedown",function(a){return a.stopPropagation(),a.preventDefault(),!1}),this.$overlayDiv2&&this.$overlayDiv2.on("mousedown",function(a){return a.stopPropagation(),a.preventDefault(),!1}),this.$el.off("mousedown.eqnMgr").on("mousedown.eqnMgr",function(){a.stopReading()})},adjustContainment:function(a){if(this.model.get("adjustContainment")&&this.$draggableContainment){var b=a instanceof d?a.getWidth():a.outerWidth(),c=-2,e=b/2+c,f=this.$equationContainer.width();this.$draggableContainment.css({width:f+2*e,left:-e}),this.$equationContainer.css("max-width",f)}},resetContainment:function(){this.model.get("adjustContainment")&&this.$draggableContainment&&(this.$draggableContainment.css({width:"",left:""}),this.$equationContainer.css("max-width",""))},showHideOverlayDiv:function(a){a?this.$overlayDiv&&this.$overlayDiv.show():this.$overlayDiv&&this.$overlayDiv.hide()},showHideOverlayDiv2:function(a){a?this.$overlayDiv2&&this.$overlayDiv2.show():this.$overlayDiv2&&this.$overlayDiv2.hide()},refresh:function(){this.equationView&&this.equationView.refresh()},_animateTiles:function(a){if(a){var c,d=(this.firstTile.offset().left,this),e=this.$(".animated-tiles");b.EquationManagerPro.EVENTS;e.position({my:"left top",at:"left top",of:this.firstTile,collision:"none"}),d.showHideOverlayDiv(!0),e.css({visibility:"",opacity:0}),c=1,e.animate({left:0,opacity:c},1e3,_.once($.proxy(d.tilesAnimationComplete,d)))}},tilesAnimationComplete:function(){var a=this;setTimeout(function(){a.$(".animated-tiles").css({left:"",opacity:""}).removeClass("animated-tiles"),a.$(".invisible-operators").css({visibility:"",opacity:0}).animate({opacity:1},150,_.once($.proxy(a.operatorsAnimationComplete,a)))},100)},changeDragHandleImg:function(a,c){var d;("string"!=typeof a||c===!1)&&(d=a.toString().split(".")[1]||[],d=c?d:[],d.length>2?this.trigger(b.EquationManagerPro.EVENTS.CHANGE_DRAG_HANDLE_IMG,!0):this.trigger(b.EquationManagerPro.EVENTS.CHANGE_DRAG_HANDLE_IMG,!1))},operatorsAnimationComplete:function(){var a=this,c=b.EquationManagerPro.EVENTS;setTimeout(function(){a.$(".invisible-operators").css({opacity:""}).removeClass("invisible-operators"),a.showHideOverlayDiv(!1),a.trigger(c.FANNING_ANIMATION_COMPLETE)},100)},getLhsRhsContainerRects:function(){this.lhsRect=new d(this.equationView.$el.find(".lhs-expression-view-expression")[0].getBoundingClientRect()),this.rhsRect=new d(this.equationView.$el.find(".rhs-expression-view-expression")[0].getBoundingClientRect()),this.dragHandle=new d(this.equationView.$el.find(".equals-sign-container")[0].getBoundingClientRect())},enableDisableDroppables:function(a,b,c){var d,f=new e({left:a.clientX,top:a.clientY}),g=this.equationView,h=g.tileViews,i=50,j=20;this.lhsRect.isPointInRect(f)?(d=h[0].$el,this.onlyLHS||(h[0].attachDetachDroppable(!0,!0),h[1].attachDetachDroppable(!1,!0)),f.getLeft()<this.lhsRect.getLeft()+i?d[0].scrollLeft=d[0].scrollLeft-j:f.getLeft()>this.lhsRect.getRight()-i&&(d[0].scrollLeft=d[0].scrollLeft+j),c&&!c.model.get("isLHS")&&this._showInsertionCursor(a,b,d,c)):this.rhsRect.isPointInRect(f)?(d=h[1].$el,this.onlyLHS||(h[1].attachDetachDroppable(!0,!0),h[0].attachDetachDroppable(!1,!0)),f.getLeft()<this.rhsRect.getLeft()+i?d[0].scrollLeft=d[0].scrollLeft-j:f.getLeft()>this.rhsRect.getRight()-i&&(d[0].scrollLeft=d[0].scrollLeft+j),c&&c.model.get("isLHS")&&this._showInsertionCursor(a,b,d)):this.dragHandle.isPointInRect(f)&&(h[0].attachDetachDroppable(!1,!0),h[1].attachDetachDroppable(!1,!0),this.getFirstTileDrop()===!0&&(g.$el.find(".hover-border").removeClass("hover-border"),g.$el.find(".absolute-denominator, .absolute-vincullum, .virtual-numerator, .numerator-one-tile, .dropslots-vincullum, .virtual-denominator, .virtual-left-par, .virtual-right-par, .virtual-fraction-numerator, .virtual-fraction-denominator").css({display:"none"}),g.$el.find(".coefficient-tile").css({top:""}),g.$el.find(".virtual-big-bracket").length>0?g.$el.find(".expression-view").removeClass("big-parentheses-to-expression"):"",b.helper.removeData("add-tile-droppable")))},_showInsertionCursor:function(a,b,c){if(null!=this.getTileAddedInExpression()||!this.getFirstTileDrop())return!1;var e=c.find(".null-operator-container").length>0?c.find(".null-operator-container"):this._addRemoveFirstTile(!0,c),f=c.find(".right-null-operator-container").length>0?c.find(".right-null-operator-container"):this._addRemoveFirstTile(!1,c),g=e.find(".insertion-cursor, .add-sign-in-null-operator").hide(),h=f.find(".insertion-cursor, .add-sign-in-null-operator").hide(),i=new d(e[0].getBoundingClientRect()),j=new d(f[0].getBoundingClientRect()),k=new d(b.helper[0].getBoundingClientRect()),l=k.getMiddle();i.getRight()>l.getLeft()?(this._showHideDropslots(c,!1),g.show()):j.getLeft()<l.getLeft()&&(this._showHideDropslots(c,!1),h.show())},_addRemoveFirstTile:function(a,b){var c=this.equationView.tileViews[a===!0?0:1].model,d=c.get("tileArray"),e=d.at(0);return d.remove(e),d.add(e,{at:0}),this.removeHighlightTilesImmediate(),a===!0?b.find(".null-operator-container"):b.find(".right-null-operator-container")},makeBinTilesDraggable:function(c){var d="string"==typeof c?$(c):c,e=this,f=0;for(d.draggable({start:function(a,c){e.trigger(b.EquationManagerPro.EVENTS.BIN_DRAGGING_START),e._binTileDragStart(a,c,$(this))},drag:$.proxy(this._binTileDragHandler,this),revert:function(a){return e.showHideOverlayDiv(!0),this.data("isDropped")?(e.trigger(b.EquationManagerPro.EVENTS.TILE_DROP_SUCCESS),!1):(this.removeData("isDropped"),e.getFirstTileDrop()&&e._showHideDropslots(e.equationView.$el,!1),!0)},refreshPositions:!0,helper:"clone",stop:function(a,c){e._binTileDragStop(a,c,$(this)),e.trigger(b.EquationManagerPro.EVENTS.BIN_DRAG_STOP)},containment:this.$binTileDraggableContainment,zIndex:5,distance:10,cursorAt:{left:24,top:24}});f<d.length;f++)this.applyHandCursorToElem($(d[f]));a.Common.Utilities.Models.Utils.EnableTouch(d,{specificEvents:a.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE})},_binTileDragStart:function(a,b,c){this.stopReading();var d=b.helper;d.data({"cur-draggable":c}),d.addClass("current-draggable"),this.getLhsRhsContainerRects(),this.enableDisableDroppables(a,b),this.equationView.tileViews[0].makeDroppable(!1),this.equationView.tileViews[1]&&this.equationView.tileViews[1].makeDroppable(!1),this.equationView.tileViews[0].makeDroppable(!0),this.equationView.tileViews[1]&&this.equationView.tileViews[1].makeDroppable(!0)},_binTileDragHandler:function(a,b){var e=this.equationView.tileViews,f=new d(b.helper[0].getBoundingClientRect()),g=f.getMiddle();if(e[0].isDenominator=!1,e[1].isDenominator=!1,!this.getFirstTileDrop()){var h=e[0].$el.find(".virtual-numerator"),i=new d(h[0].getBoundingClientRect()),f=new d(b.helper[0].getBoundingClientRect()),g=f.getMiddle();return void(i.isPointInRect(g)?h.find(".base-container").addClass("hover-border"):h.find(".base-container").removeClass("hover-border"))}if(null!==this.getTileAddedInExpression())return void this.enableDisableDroppables(a,b);var j,k=b.helper.data("add-tile-droppable"),l=b.helper.data("variable");if(k&&!l){if(!k.model)return j=k,this._showHideDropslots(this.equationView.$el,!1),void j.find(".insertion-cursor, .add-sign-in-null-operator").show();var m=k.model.get("type"),n=k.model.get("isDenominator"),o=k.parent.getIndex(k).substring(0,1),p=this.equationView.getViewFromIndex(o),q=p.$el,h=q.find(".virtual-numerator"),r=q.find(".virtual-denominator").length?q.find(".virtual-denominator"):q.find(".absolute-denominator"),s=q.find(".null-operator-container"),t=q.find(".right-null-operator-container"),u=s.find(".insertion-cursor, .add-sign-in-null-operator").hide(),v=t.find(".insertion-cursor, .add-sign-in-null-operator").hide(),w=new d(q[0].getBoundingClientRect()),x=w.getTop(),y=w.getBottom(),z=w.getRight(),A=w.getLeft(),B=w.getHeight(),C=24,D=B/2-C,E=x+D,F=new d({top:x,right:z,left:A,bottom:E,height:D,width:w.getWidth()}),G=x+B/2+C,H=new d({top:G,right:z,left:A,bottom:y,height:D,width:w.getWidth()}),I=new d({top:x,right:z,left:A,bottom:w.getHeight()/2,height:w.getHeight()/2,width:w.getWidth()}),J=(new d({top:w.getHeight()/2,right:z,left:A,bottom:y,height:w.getHeight()/2,width:w.getWidth()}),new d(s[0].getBoundingClientRect())),K=new d(t[0].getBoundingClientRect()),i=new d(h[0].getBoundingClientRect()),L=new d(r[0].getBoundingClientRect()),M=!0;if(H.isPointInRect(g))this._showHideDropslots(q,!0),p.isDenominator=!0;else if(F.isPointInRect(g))this._showHideDropslots(q,!0,!0),p.isDenominator=!1;else if(w.isPointInRect(g))if(m===c.TileItem.TileType.TERM_TILE)n?this._showHideDropslots(q,!0):this._showHideDropslots(q,!0,!0),p.isDenominator=n;else if(i.isPointInRect(g))this._showHideDropslots(q,!0,!0),p.isDenominator=!1;else if(L.isPointInRect(g))this._showHideDropslots(q,!0),p.isDenominator=!0;else{if(J.getRight()>g.getLeft()){if("t"===b.helper.data("tilevalue"))return void this._showHideDropslots(this.$el,!1);this._showHideDropslots(q,!1),u.show(),M=!1,p.isDenominator=!1}else if(K.getLeft()<g.getLeft()){if("t"===b.helper.data("tilevalue"))return void this._showHideDropslots(this.$el,!1);this._showHideDropslots(q,!1),v.show(),M=!1,p.isDenominator=!1}M&&(I.isPointInRect(g)?(this._showHideDropslots(q,!0,!0),p.isDenominator=!1):(this._showHideDropslots(q,!0),p.isDenominator=!0))}else this._showHideDropslots(q,!1)}this.enableDisableDroppables(a,b)},_showHideDropslots:function(a,b,c){b?c?(a.find(".virtual-denominator, .dropslots-vincullum, .numerator-one-tile, .virtual-fraction-denominator, .absolute-denominator, .absolute-vincullum, .insertion-cursor, .add-sign-in-null-operator").css({display:"none"}).removeClass("absolute-denominator-top absolute-vincullum-top"),a.find(".virtual-numerator, .virtual-left-par, .virtual-right-par, .virtual-fraction-numerator, .virtual-fraction-container").css({display:""}),a.find(".coefficient-tile, .virtual-fraction-container").css({top:""}).removeClass("coefficient-tile-top"),a.find(".virtual-big-bracket").length>0?a.find(".expression-view").addClass("big-parentheses-to-expression"):""):(a.find(".absolute-denominator").css({display:"",top:"94px"}).addClass("absolute-denominator-top"),a.find(".virtual-denominator").css({display:""}),a.find(".dropslots-vincullum").css({display:""}),a.find(".absolute-vincullum").css({display:"",top:"87px"}).addClass("absolute-vincullum-top"),a.find(".numerator-one-tile, .virtual-left-par, .virtual-right-par, .virtual-fraction-denominator, .virtual-fraction-container").css({display:""}),a.find(".virtual-numerator, .virtual-fraction-numerator, .insertion-cursor, .add-sign-in-null-operator").css({display:"none"}),a.find(".coefficient-tile").css({top:"-30px"}).addClass("coefficient-tile-top"),a.find(".virtual-big-bracket").length>0?a.find(".expression-view").addClass("big-parentheses-to-expression"):""):(this.getFirstTileDrop()&&(a.find(".absolute-denominator, .absolute-vincullum, .virtual-numerator, .numerator-one-tile, .dropslots-vincullum, .virtual-denominator, .virtual-left-par, .virtual-right-par, .virtual-fraction-numerator, .virtual-fraction-denominator").css({display:"none"}).removeClass("absolute-denominator-top absolute-vincullum-top"),a.find(".coefficient-tile, .virtual-fraction-container").css({top:""}).removeClass("coefficient-tile-top"),a.find(".virtual-big-bracket").length>0?a.find(".expression-view").removeClass("big-parentheses-to-expression"):""),a.find(".virtual-fraction-container, .insertion-cursor, .add-sign-in-null-operator").css({display:"none"}))},_binTileDragStop:function(a,b,c){this.showHideOverlayDiv(!1),this.setIsDropped(!1),b.helper.removeData(["cur-draggable","cur-droppable"]),b.helper.removeData("add-tile-droppable"),c.removeData("isDropped"),this.equationView.attachDetachDroppable(!0),this.equationView.enableOperators(!0)},applyHandCursorToElem:function(a){var b=this,c="mouseenter",d="mouseleave";a.on(c,function(){a.hasClass("ui-draggable-dragging")||a.hasClass("disable")||(a.css(b.equationView._getOpenHandCss()),b.$el.parents(".ui-draggable-dragging").length>0&&a.css(b.equationView._getClosedHandCss()))}),a.on(d,function(){a.css(b.equationView._getDefaultCursorCss())}),a.on("mousedown",function(){a.hasClass("disable")||a.css(b.equationView._getClosedHandCss())}),a.on("mouseup",function(){a.hasClass("disable")||a.css(b.equationView._getOpenHandCss())})},registerMouseOverTile:function(a,b,c){this.currentHoveredTile&&this.currentHoveredTile!==a&&this.currentHoveredTile.onMouseOut(b,c),this.currentHoveredTile=a,this.showHideBorder(!1)},setTreeRoot:function(){this.root=this.equationView.model.getTree(),this.tabOrderArr=this.equationView.model.parseTree(this.root)},getTreeRoot:function(){return this.root},tileAdded:function(a){var b=c.TileItem.TileType,d="new-created-tile",e=a.model.get("type"),f=0;if(e===b.TERM_TILE)a.$el.addClass(d);else if(e===b.FRACTION)for(f=0;f<a.tileViews.length;f++)this.tileAdded(a.tileViews[f]);else if(e===b.PARENTHESES)for(f=0;f<a.tileViews.length;f++)this.tileAdded(a.tileViews[f])},removeHighlightTiles:function(){var a=this;window.clearTimeout(this.timerId),this.timerId=setTimeout(function(){a.$(".new-created-tile").removeClass("new-created-tile")},5e3)},removeHighlightTilesImmediate:function(){this.$(".new-created-tile").removeClass("new-created-tile"),window.clearTimeout(this.timerId)},_clearDropslots:function(){this.equationView.$el.find(".virtual-numerator, .numerator-one-tile, .dropslots-vincullum, .virtual-denominator, .virtual-left-par, .virtual-right-par, .virtual-fraction-numerator, .virtual-fraction-denominator, .absolute-vincullum, .absolute-denominator, .virtual-fraction-container, .virtual-numerator-operator-container").remove(),this.equationView.$el.find(".coefficient-tile").removeClass("coefficient-tile")},_setDropSlotsForBinTiles:function(){this._clearDropslots();for(var a,b,c,d,e=0,f=0,g=[],h=[],i=this.equationView.tileViews,j=[];e<this.root.children.length;e++){if(i[e].parenthesesAdded=!1,i[e].fractionAdded=!1,i[e].tilesToAddInFraction=0,i[e].multiplicationIndex=null,i[e].fractionIndex=null,i[e].index=null,d=e+".0",h=[],"+"===this.root.children[e].data)i[e].parenthesesAdded=!0,i[e].fractionAdded=!0,"*"===this.root.children[e].children[0].data?(a=this._getFirstChildNodeOfMultiplication(this.root.children[e].children[0]),this._appendTilesAndParentheses(a,!0)):"/"===this.root.children[e].children[0].data?(a=this.root.children[e].children[0].collectionData,this._appendTilesAndParentheses(a,!0)):(a=this.root.children[e].children[0],g=this._getTilesModelsInsideNode(a),this._appendTilesAndParentheses(g[0],!0));else if("*"===this.root.children[e].data)if(c=this.root.children[e].children,"string"==typeof c[0].data)"/"===c[0].data?(a=c[0].children[0],g=j=this._getTilesModelsInsideNode(a),this._appendTilesAndParentheses(g[0],!1,"num"),i[e].multiplicationIndex=d+".0",b=c[0].children[1],g=this._getTilesModelsInsideNode(b),this._appendTilesAndParentheses(g[0],!1,"den"),i[e].fractionIndex=d+"."+j.length):"^"===c[0].data&&(a=c[0].collectionData,this._appendTilesAndParentheses(a,!0,null,null,!0));else{for(f=0;f<c.length;f++)if("^"!==c[f].data){var k=this.equationView.getViewFromIndex(this.equationView.model.getIndexFromItemModel(c[f].data));this._operatorsOfCoeffTiles(k),h.push(k.$el.addClass("coefficient-tile"))}i[e].tilesToAddInFraction=h.length,this._appendTilesAndParentheses(c[0].data,!1,null,h)}else if("/"===this.root.children[e].data)"+"!==this.root.children[e].children[0].data?(a=this.root.children[e].children[0]||this.root.children[e].children[0].children[0],g=j=this._getTilesModelsInsideNode(a),this._appendTilesAndParentheses(g[0],!1,"num"),i[e].multiplicationIndex=d+".0",b=this.root.children[e].children[1]||this.root.children[e].children[1].children[0],g=this._getTilesModelsInsideNode(b),this._appendTilesAndParentheses(g[0],!1,"den"),i[e].fractionIndex=d+"."+j.length):(a=this.root.children[e].collectionData,i[e].parenthesesAdded=!0,this._appendTilesAndParentheses(a,!0));else if("string"!=typeof this.root.children[e]){var k=this.equationView.getViewFromIndex(this.equationView.model.getIndexFromItemModel(this.root.children[e].data));this._operatorsOfCoeffTiles(k),h.push(k.$el.addClass("coefficient-tile")),this._appendTilesAndParentheses(this.root.children[e].data,!1,null,h),i[e].tilesToAddInFraction=h.length,i[e].fractionAdded=!0}i[e].index=d}},_operatorsOfCoeffTiles:function(a){var b=a.model.get("operator"),c=a.parent.tileViews.indexOf(a);b&&a.parent.$operatorViews[c].addClass("coefficient-tile")},_getFirstChildNodeOfMultiplication:function(a){var b=a.data;return"*"===b?this._getFirstChildNodeOfMultiplication(a.children[0]):"string"!=typeof a.data?a.data:a.collectionData},enableDisableTiles:function(a,c){var d=this.commandFactory.get("undoStack");this.equationView.enableDisableTiles(a),this.removeHighlightTilesImmediate(),a?this.enableMarquee(!0,!0):this.disableMarquee(!0,!0),c&&(a=!a),0===d.length&&a?(this.enableDisableSpecificButton(b.EquationManagerPro.UNDO_BUTTON,!a),this.enableDisableSpecificButton(b.EquationManagerPro.RESET_BUTTON,this.model.get("resetBtnStatus"))):(this.enableDisableSpecificButton(b.EquationManagerPro.UNDO_BUTTON,a),this.enableDisableSpecificButton(b.EquationManagerPro.RESET_BUTTON,this.model.get("resetBtnStatus")))},enableDisableBinTiles:function(a,b,c){c=c||{};var d=b?b:this.$binTileContainment.find(".bin-tiles"),e=0;if(a){if(d.removeClass("disable"),c.alterDraggable!==!1)for(;e<this.numericTileArray.length;e++)$(d[e]).is(".ui-draggable")&&$(d[e]).draggable("enable")}else if(d.addClass("disable"),c.alterDraggable!==!1)for(;e<this.numericTileArray.length;e++)$(d[e]).is(".ui-draggable")&&$(d[e]).draggable("disable")},getIsMarqueeDrawing:function(){return this.marqueeViews[0].isDrawing||this.marqueeViews[1].isDrawing},_appendTilesAndParentheses:function(a,b,c,d,e){b?this._dropslotsForParenthesesCase(a,b,c,d,e):c?this._dropslotsForFractionCase(a,c,d):d&&this._dropslotsForCoefficientCase(a,d)},_dropslotsForParenthesesCase:function(d,e,f,g,h){var i=this.equationView.model.getIndexFromItemModel(d),j=this.equationView.getViewFromIndex(i),k=this.equationView.tileViews[+i[0]],l=j.$el,m=l.parents(".expression-view-holder"),n=$("<div></div>").addClass("virtual-fraction-container").css({display:"none"}),o=a.Common.Components.templates.baseTilePro({base:"","base-class":"empty-tile",level:"eqn-manager-tile",baseTileType:c.TileItem.TileType.TERM_TILE,idPrefix:this.idPrefix}),p=$(o).addClass("virtual-numerator").css({display:"none"}),q=k.checkContainsParOrFraction();k.$el.removeClass("expression-with-multiplication-only"),q||k.$el.addClass("expression-with-multiplication-only");var r,s,t=$("<div></div>").addClass("dropslots-vincullum").css({display:"none"}),o=a.Common.Components.templates.baseTilePro({base:"","base-class":"empty-tile",level:"eqn-manager-tile",baseTileType:c.TileItem.TileType.TERM_TILE,idPrefix:this.idPrefix}),u=$(o).addClass("virtual-denominator").css({display:"none"}),v=k.$expression.hasClass("expression-with-fraction")?a.Common.Components.templates.parenthesesTemplate({color:this.parenthesesColor?this.parenthesesColor:b.EquationManagerPro.WHITE,isBigParentheses:!0}):a.Common.Components.templates.parenthesesTemplate({color:this.parenthesesColor?this.parenthesesColor:b.EquationManagerPro.WHITE
});n.append(p).append(t).append(u),n.insertAfter(m.find(".null-operator-container")),r=$("<div>"+v+"</div>").addClass("virtual-left-par left-bracket").css({display:"none"}),s=$("<div>"+v+"</div>").addClass("virtual-right-par right-bracket").css({display:"none"}),k.$expression.hasClass("expression-with-fraction")&&(r.addClass("virtual-big-bracket"),s.addClass("virtual-big-bracket")),h||(r.insertAfter(n),s.insertBefore(m.find(".right-null-operator-container")));var w=$("<div>1</div>").addClass("numerator-one-tile").css({display:"none"});w.insertBefore(p)},_dropslotsForFractionCase:function(b,d,e){var f=this.equationView.getViewFromIndex(this.equationView.model.getIndexFromItemModel(b)),g=f.$el,h=a.Common.Components.templates.baseTilePro({base:"","base-class":"empty-tile",level:"eqn-manager-tile",baseTileType:c.TileItem.TileType.TERM_TILE,idPrefix:this.idPrefix}),i=$(h),j=$("<div></div>").addClass("virtual-numerator-operator"),k=$("<div></div>").addClass("virtual-numerator-operator-container").hide().append(j);"num"===d?(i.insertBefore(g).addClass("virtual-numerator").css({display:"none"}),k.insertBefore(g)):i.insertBefore(g).addClass("virtual-denominator").css({display:"none"})},_dropslotsForCoefficientCase:function(b,d){var e=this.equationView.getViewFromIndex(this.equationView.model.getIndexFromItemModel(b)),f={width:48,height:48},g=e.$el,h=d.length,i=1===h?3*h:3*(h-1),j=a.Common.Components.templates.baseTilePro({base:"","base-class":"empty-tile",level:"eqn-manager-tile",baseTileType:c.TileItem.TileType.TERM_TILE,idPrefix:this.idPrefix}),k=$(j).addClass("virtual-numerator").css({display:"none"});k.insertBefore(g);var l=$("<div></div>").addClass("absolute-vincullum").css({display:"none"}),j=a.Common.Components.templates.baseTilePro({base:"","base-class":"empty-tile",level:"eqn-manager-tile",baseTileType:c.TileItem.TileType.TERM_TILE,idPrefix:this.idPrefix}),m=$(j).addClass("absolute-denominator").css({display:"none"});l.insertAfter(g),m.insertAfter(l),window.setTimeout(function(){l.css({width:f.width*h+3*(h-1)+10,left:g.position().left-5}),m.css({left:i+f.width*(h-1)/2+g.position().left-3*h})},10)},_getTilesModelsInsideNode:function(a){var b,c=(a.parent,[]),d=0,e=a.data;if("string"==typeof e||null===e)for(b=a.children;d<b.length;d++)c=c.concat(this._getTilesModelsInsideNode(b[d]));else c.push(e);return c},setDeletedItemsInParenthesesFraction:function(a,b){var c=!1;if(void 0===a)this.deletedItemsInParenthesesFraction=[];else{for(var d=0;d<this.deletedItemsInParenthesesFraction.length;d++)if(this.deletedItemsInParenthesesFraction[d].index===a){c=!0;break}c||this.deletedItemsInParenthesesFraction.push({index:a,type:b})}},getDeletedItemsInParenthesesFraction:function(){return this.deletedItemsInParenthesesFraction},fireCommand:function(a,d){var e,f,g=c.CommandFactory,h=new g.Rules(this.commandFactory.get("allowedOperation"),this.model.get("isIotaPresent"),this.model.get("isFractionToDecimalAllowed")),i=this.getDeletedItemsInParenthesesFraction(),j=(this.commandFactory.get("undoStack"),""),k=this,l=d.isLHS;if(this.$(".big-parentheses-to-expression").removeClass("big-parentheses-to-expression"),d.isLHS||(d.dest?l="0"===d.dest.index.split(".")[0]?!0:!1:d.source&&(l="0"===d.source.index.split(".")[0]?!0:!1)),null!==d.source.index&&-1===d.source.index.split(".").map(Number).indexOf(-1)){if(a!==g.COMMANDS.CHECK_PARENTHESES_RULES&&a!==g.COMMANDS.CHECK_FRACTION_RULES&&a!==g.COMMANDS.ADD_TILE&&this.removeHighlightTilesImmediate(),this.equationView.$el.find(".multiple-in-parentheses").removeClass("multiple-in-parentheses"),e=this.commandFactory.execute(a,h,d),-1===[g.COMMANDS.PARENTHESES_EXPONENT_CLICK,g.COMMANDS.COMBINE,g.COMMANDS.TAKE_OUT_COMMON_COMMAND,g.COMMANDS.CHECK_PARENTHESES_RULES,g.COMMANDS.CHECK_FRACTION_RULES].indexOf(a)&&(this.setDeletedItemsInParenthesesFraction(),i=this.getDeletedItemsInParenthesesFraction()),"number"==typeof e)return e;if(e||i.length){if(this._undoResetBtnStatus(),this.trigger(b.EquationManagerPro.EVENTS.COMMAND_SUCCESSFUL),this.setTreeRoot(),this.equationView.$el.find(".multiplication-operator").show(),i.sort(function(a,b){return k.versionCompare(a.index,b.index)}),i.length){var m=i.pop();d={root:this.getTreeRoot(),source:new g.TileLocation(m.index,1)},this.fireCommand(g.COMMANDS["CHECK_"+m.type+"_RULES"],d)}this.isBottomExpressionShown&&this._updateBottomEquations(),window.clearTimeout(this.timerId),this.removeHighlightTiles(),this.equationView.checkForFractionInExpression(),this.options.createTileBin&&this._setDropSlotsForBinTiles(),this.equationView.hideOperatorOfParCoeff(),this._checkOfIntroductionOfParenthesesOrFraction(),this.isExpressionContainsParentheses(),a!==g.COMMANDS.CHECK_PARENTHESES_RULES&&a!==g.COMMANDS.CHECK_FRACTION_RULES&&a!==g.COMMANDS.ADD_TILE&&(f=this.equationView.getTileContentInHtmlForm(b.EquationManagerPro.BLACK),j=this.equationView.getAccString(b.EquationManagerPro.DATA),this.trigger(b.EquationManagerPro.EVENTS.ADD_STEP,{equationHtml:f,equationAccString:j}),a===g.COMMANDS.BREAK_BASE?window.setTimeout(function(){k._scrollExpressionOnCommandSuccess(!1,l)},1100):this._scrollExpressionOnCommandSuccess(!1,l)),a===g.COMMANDS.ADD_TILE&&this._scrollExpressionOnCommandSuccess(!1,l),this._checkOfBigParentheses()}return e}},_checkOfBigParentheses:function(){var a=null;this.equationView.tileViews.forEach(function(b){a=b.$expression.find(".big-left-bracket").length>0&&b.$(".expression-with-big-parentheses").length>0,a||b.$(".expression-with-big-parentheses").removeClass("expression-with-big-parentheses")})},isExpressionContainsParentheses:function(){this.equationView.tileViews[0]&&this.equationView.tileViews[0].isExpressionContainsParentheses(),this.equationView.tileViews[1]&&this.equationView.tileViews[1].isExpressionContainsParentheses()},_scrollExpressionOnCommandSuccess:function(a,b){var c,e,f=this.equationView.tileViews,g=b||this.options.onlyLHS?f[0]:f[1],h=g.$el,i=h.find(".new-created-tile"),j=0,k=this,l=new d(h[0].getBoundingClientRect()),m=h.scrollLeft(),n=null,o=null,p=($(i[i.length-1]).parents(".fraction-component"),g.containsNullTile()),q=null,r=null;i.length>0&&(o=this._findRightMostTile(i),e=i[0].getBoundingClientRect().left,c=o.getBoundingClientRect().right,p?(q=p.$el[0].getBoundingClientRect().left,r=p.$el[0].getBoundingClientRect().right,l.getLeft()>q?(j=-(l.getLeft()-q),n=-100):l.getRight()<r&&(j=r-l.getRight(),n=100)):l.getLeft()>e?(j=-(l.getLeft()-e),n=-10):l.getRight()<c&&(j=c-l.getRight(),n=10),m===j?this.showHideOverlayDiv2(!1):(j=j+m+n,a?h.scrollLeft(j):(this.showHideOverlayDiv2(!0),h.animate({scrollLeft:j},1e3,function(){k.showHideOverlayDiv2(!1)}))))},_findRightMostTile:function(a){for(var b=a.length-1,c=0,d=a[b],e=0,f=null;b>=c;b--)f=a[b].getBoundingClientRect().right,f>e&&(e=f,d=a[b]);return d},_undoResetBtnStatus:function(){var c=this.commandFactory.get("undoStack"),d=a.global.Theme2.Button.BUTTON_STATE_DISABLED,e=this.undoButtonView?this.undoButtonView.getButtonState():null,f=this.resetButtonView?this.resetButtonView.getButtonState():null;(this.undoButtonView||this.resetButtonView)&&c.length>0&&(e===d&&this.enableDisableSpecificButton(b.EquationManagerPro.UNDO_BUTTON,!0),f===d&&(this.enableDisableSpecificButton(b.EquationManagerPro.RESET_BUTTON,!0),this.model.set("resetBtnStatus",!0)))},versionCompare:function(a,b,c){function d(a){return(e?/^\d+[A-Za-z]*$/:/^\d+$/).test(a)}var e=c&&c.lexicographical,f=c&&c.zeroExtend,g=a.split("."),h=b.split(".");if(!g.every(d)||!h.every(d))return NaN;if(f){for(;g.length<h.length;)g.push("0");for(;h.length<g.length;)h.push("0")}e||(g=g.map(Number),h=h.map(Number));for(var i=0;i<g.length;++i){if(h.length==i)return 1;if(g[i]!=h[i])return g[i]>h[i]?1:-1}return g.length!=h.length?-1:0},_checkOfIntroductionOfParenthesesOrFraction:function(){this.equationView.isExpressionContainsParOrFraction()},_checkForNestedLevelOfParentheses:function(){var a=this.equationView.checkForNestedLevelOfParentheses();return a},equationNotBalancedFeedback:function(){var a=this.equationView.containsNullTile();a&&this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",16),this.getAccMessage("inline-feedback-text",16))},scrollExpression:function(a,c){var d,e=a.$el,f=this;c===b.EquationManagerPro.SCROLL_DIRECTION.LEFT?d=0:c===b.EquationManagerPro.SCROLL_DIRECTION.RIGHT&&(d=e[0].scrollWidth),this.showHideOverlayDiv2(!0),e.animate({scrollLeft:d},1e3,function(){f.showHideOverlayDiv2(!1)})},undo:function(a){var c,d=this.commandFactory.get("undoStack");window.clearTimeout(this.timerId),this.removeHighlightTilesImmediate(),this.commandFactory.undo(a),c=this.containsNullTile(),c&&"t"===c.model.get("tileToReplace")&&this.trigger(b.EquationManagerPro.EVENTS.SET_FIRST_TILE_DROP),this.equationView.checkForFractionInExpression(),this.equationView.hideOperatorOfParCoeff(),null!==this.getTileAddedInExpression()?(this.setTileAddedInExpression(),this.undo(!0)):a||this.trigger(b.EquationManagerPro.EVENTS.REMOVE_STEP),this.setTileAddedFromBinValue(),c&&(this.setTileAddedInExpression(!0),this.setTileAddedFromBinValue(c.model.get("tileToReplace")),this.options.createTileBin&&"t"!==this.getTileAddedFromBinValue()&&this.enableDisableBinTiles(!0)),this.setDeletedItemsInParenthesesFraction(),this._checkOfIntroductionOfParenthesesOrFraction(),this.isExpressionContainsParentheses(),this.removeHighlightTiles(),this.setTreeRoot(),this._scrollExpressionOnCommandSuccess(!0,!0),this._scrollExpressionOnCommandSuccess(!0,!1),this.options.createTileBin&&this._setDropSlotsForBinTiles(),0===d.length&&null===this.getTileAddedInExpression()&&this.model.get("isTDropped")===!1&&(this.setFirstTileDrop(!1),this._firstTileDrop()),this._checkOfBigParentheses()},containsNullTile:function(){return this.equationView.containsNullTile()},onBaseClick:function(a){var d,e=c.CommandFactory,f=new e.TileLocation(a.parent.getIndex(a)),g={source:f,root:this.getTreeRoot()},h=this,i=a.model.get("base"),j=a.model.get("squareRootProps"),k=a.model.get("iotaExponent");return this.restrictFirstTileAnimation=!0,a.$el.css({visibility:"hidden"}),d=this.fireCommand(e.COMMANDS.BREAK_BASE,g),a.$el.css({visibility:""}),0===i||!j&&k&&1===i||j&&!k&&!j.isNegative?this.$(".invisible-operators, .animated-tiles").css({visibility:""}).removeClass("invisible-operators animated-tiles"):(this._animateTiles(d),d===!0&&h.trigger(b.EquationManagerPro.EVENTS.TILE_DROP_SUCCESS)),d},onExponentClick:function(a){if(a.isTilesDisabled!==!0){var d,e=c.CommandFactory,f=new e.TileLocation(a.parent.getIndex(a)),g={source:f,root:this.getTreeRoot()},h=this,i=!1;return this.restrictFirstTileAnimation=!0,this._checkPlusOpInPar(a)===!0&&(i=!0),d=this.fireCommand(e.COMMANDS.PARENTHESES_EXPONENT_CLICK,g),i&&(this._animateTiles(d),d===!0&&h.trigger(b.EquationManagerPro.EVENTS.TILE_DROP_SUCCESS)),d}},_checkPlusOpInPar:function(a){for(var b=0;b<a.tileViews.length;b++)if("+"===a.tileViews[b].model.get("operator"))return!0;return!1},onRepositionTile:function(a){var b=c.CommandFactory,d=new b.TileLocation(a.sourceTile.parent.getIndex(a.sourceTile),a.numOfTiles),e=new b.TileLocation(a.destTile.parent.getIndex(a.destTile)),f={source:d,dest:e,root:this.getTreeRoot(),bLeft:a.bLeft},g=this.fireCommand(b.COMMANDS.REPOSITION_COMMAND,f);return g},onTakeOutCommonTile:function(a){var b=c.CommandFactory,d=new b.TileLocation(a.sourceTile.parent.getIndex(a.sourceTile),a.sourceNumOfTiles),e=new b.TileLocation(a.destTile.parent.getIndex(a.destTile)),f={source:d,dest:e,root:this.getTreeRoot()},g=this.fireCommand(b.COMMANDS.TAKE_OUT_COMMON_COMMAND,f);switch(g){case b.EXIT_CODE.SIMPLIFY_TERMS_FIRST:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",1),this.getAccMessage("inline-feedback-text",1)),g=!1;break;case b.EXIT_CODE.NOT_LIKE_TERMS:case b.EXIT_CODE.SIMPLIFY_TERM_TAKE_COMMON:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",5),this.getAccMessage("inline-feedback-text",5)),g=!1;break;case b.EXIT_CODE.BREAK_IMAGINARY_NUMBER:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",6),this.getAccMessage("inline-feedback-text",6)),g=!1;break;case b.EXIT_CODE.MINUS_ONE_COMMON_OUT:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",7),this.getAccMessage("inline-feedback-text",7)),g=!1;break;case b.EXIT_CODE.NEGATIVE_NUMBER_COMMON_OUT:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",8,[this.getMinusSignLocText()]),this.getAccMessage("inline-feedback-text",8,[this.getMinusSignLocText()])),g=!1;break;case b.EXIT_CODE.ROOT_MAGNITUDE:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",9),this.getAccMessage("inline-feedback-text",9)),g=!1;break;case b.EXIT_CODE.FACTOR_ONE_FROM_PARANTHESES:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",10),this.getAccMessage("inline-feedback-text",10)),g=!1;break;case b.EXIT_CODE.APPLY_COEFFECIENTS:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",21),this.getAccMessage("inline-feedback-text",21)),g=!1}return g},onCombineTile:function(a){var b=c.CommandFactory,d=new b.TileLocation(a.sourceTile.parent.getIndex(a.sourceTile),a.sourceNumOfTiles),e=new b.TileLocation(a.destTile.parent.getIndex(a.destTile),a.destNumOfTiles),f={source:d,dest:e,root:this.getTreeRoot()},g=this.fireCommand(b.COMMANDS.COMBINE,f);switch(g){case b.EXIT_CODE.NOT_LIKE_TERMS:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",0),this.getAccMessage("inline-feedback-text",0)),g=!1;break;case b.EXIT_CODE.SIMPLIFY_TERMS_FIRST:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",1),this.getAccMessage("inline-feedback-text",1)),g=!1;break;case b.EXIT_CODE.SIMPLIFY_IMAGINARY_NUMBER:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",2),this.getAccMessage("inline-feedback-text",2)),g=!1;break;case b.EXIT_CODE.NOT_DISTRIBUTIVE:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",3),this.getAccMessage("inline-feedback-text",3)),g=!1;break;case b.EXIT_CODE.MAX_VALUE_REACHED:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",11),this.getAccMessage("inline-feedback-text",11)),g=!1;break;case b.EXIT_CODE.DIVIDE_ON_OTHER_SIDE:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",14),this.getAccMessage("inline-feedback-text",14)),g=!1;break;case b.EXIT_CODE.APPLY_COEFFECIENTS:this._changeTooltipTextAndShow(this.getMessage("inline-feedback-text",21),this.getAccMessage("inline-feedback-text",21)),g=!1}return g},onAddTile:function(a){var b=c.CommandFactory,d=new b.TileLocation(a.index,1),e={source:d,root:this.getTreeRoot(),isLHS:a.isLHS,isDenominator:a.isDenominator,operation:a.operation,tileValue:a.tileValue,dummyTileValue:a.dummyTileValue,parenthesesAdded:a.parenthesesAdded,fractionAdded:a.fractionAdded,tilesToAddInFraction:a.tilesToAddInFraction},f=this.fireCommand(b.COMMANDS.ADD_TILE,e),g={operation:a.operation,isDenominator:a.isDenominator};return this.model.set("operationPerformed",g),f},onReplaceTile:function(a){var d=c.CommandFactory,e=new d.TileLocation(a.index,1),f={source:e,root:this.getTreeRoot(),tileValue:a.tileValue},g=this.fireCommand(d.COMMANDS.REPLACE_TILE,f);return"t"===f.tileValue&&this.trigger(b.EquationManagerPro.EVENTS.RESET_FIRST_TILE_DROP),g},setTileAddedInExpression:function(a){void 0===a?this.model.set("addTileInExpression",null):this.model.set("addTileInExpression",a)},getTileAddedInExpression:function(){return this.model.get("addTileInExpression")},setTileAddedFromBinValue:function(a){void 0===a?this.model.set("tileAddedFromBinValue",null):this.model.set("tileAddedFromBinValue",a)},getTileAddedFromBinValue:function(){return this.model.get("tileAddedFromBinValue")},getFirstTileDrop:function(){return this.model.get("isFirstTileDrop")},setFirstTileDrop:function(a){},_updateBottomEquations:function(){var a=this.equationView.tileViews,b=null,c=null,d=this.options.onlyLHS;b=a[0].getTileContentInHtmlForm(),this.$(".lhs-expression-container").html("").append(b),this._handleCaseOfFraction(this.$(".lhs-expression-container")),d||(c=a[1].getTileContentInHtmlForm(),this.$(".rhs-expression-container").html("").append(c),this._handleCaseOfFraction(this.$(".rhs-expression-container"))),this._updateEquationPosition()},_handleCaseOfFraction:function(a){a.find(".fraction-data-tab").length>0&&a.find(".expression-common").addClass("expression-contains-fraction"),0===a.find(".big-parenthesis-container").length&&a.find(".expression-common").addClass("expression-without-big-parentheses")},updateBottomEquations:function(){this._updateBottomEquations()},updateTilesInBin:function(a){var b=this;this.createTilesInBin(a),this._attachHoverTileEvents(b),this._attachNegateTileEvents(b)},createTilesInBin:function(b){var d,e=this.numericTileArray,f=e?e:[1,2,3,4,5,6,7,8,9],g=this.idPrefix,h=c.TileItem.TileType.BIN_TILE,i=0,j=f.length,k=f[i],l={"base-class":"bin-tiles-base",baseTileType:h,idPrefix:g},m=null,n=null,o=[],p=this.tileTextFrequencyArray,q=(p?p.length:0,this.tileTextArray,null),i=1,r={};for(i=0;j>i;i++)d=f[i],"number"==typeof d?r.className=Math.abs(d):"x"===d||"-x"===d?r.className="x":("t"===d||"-t"===d)&&(r.className="t"),r.value=f[i],o[i]=r,r={};for(q={tileArray:o,idPrefix:g,tileType:"BIN_TILE",prefix:b?"tutorial":"explore"},n=a.Common.Components.templates.binTileArray(q),this.$binTileContainment.html("").append($(n)),$(this.$binTileContainment.find(".bin-tiles")[j-1]).addClass("last-tile-in-bin"),i=0,j=o.length;j>i;i++)k=o[i],"string"==typeof k.value?l.base="<i>"+k.value+"</i>":k.value>=0?l.base=k.value:l.base=this.minusSign+Math.abs(k.value),l.level="",m=a.Common.Components.templates.baseTilePro(l),this.$binTileContainment.find(".bin-tile-number-"+k.className).append($(m)),((k.value+"").length>3||3===(k.value+"").length&&-1===(k.value+"").indexOf("-"))&&this.$binTileContainment.find(".bin-tile-number-"+k.className).find(".base-value").addClass("decrease-font-size")},_createResetUndoButtons:function(){var c=this.idPrefix,d=this.filePath,e=a.global.Theme2.Button,f=this.resetButtonType,g=this.undoButtonType,h=this.el.id,c=h,i={player:this.player,manager:this.manager,path:this.filePath,idPrefix:c,data:{id:c+"reset-button-container",type:f,baseClass:"buttons-base-class",text:this.manager.getMessage("comm2",0),textColor:this.resetButtonTextColor,height:38,width:42,icon:{faClass:d.getFontAwesomeClass("fixed-reset"),fontColor:this.resetButtonTextColor,fontSize:22,height:20,width:25}}},j=i.data,k=j.icon,l={idPrefix:this.el.id},m=null,n=this,o=this.buttonGroup||[],p=0,q=o.length,r=null;for(f===e.TYPE.FA_ICONTEXT?this.resetButtonWidth?j.width=this.resetButtonWidth:delete j.width:(i.data.tooltipText=this.manager.getMessage("comm2",0),i.data.tooltipType=a.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.TOP_MIDDLE),this.$buttonGroupContainer.html("");q>p;p++)l.buttonName=o[p],m=a.Common.Components.templates.buttonGroup(l),this.$buttonGroupContainer.append($(m));this.resetButtonView=new e.generateButton(i),this.resetButtonView.el&&(r={elementId:this.resetButtonView.$el.attr("id").split(this.idPrefix)[1],tabIndex:this.tabIndex+410,acc:this.manager.getMessage("comm2",0),role:"button"},this.createAccDiv(r),this.enableDisableSpecificButton(b.EquationManagerPro.RESET_BUTTON,this.model.get("resetBtnStatus")),this.resetButtonView.$el.off("click.resetButtonClick").on("click.resetButtonClick",function(){n._resetButtonClickHandler()})),j.id=c+"undo-button-container",k.faClass=d.getFontAwesomeClass("fixed-undo"),j.type=g,j.textColor=this.undoButtonTextColor,j.icon.fontColor=this.undoButtonTextColor,j.text=this.manager.getMessage("comm24",0),g===e.TYPE.FA_ICONTEXT?this.undoButtonWidth?j.width=this.undoButtonWidth:delete j.width:(i.data.tooltipText=this.manager.getMessage("comm24",0),i.data.tooltipType=a.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.TOP_MIDDLE),i.data.icon.height=15,this.undoButtonView=new e.generateButton(i),r={elementId:this.undoButtonView.$el.attr("id").split(this.idPrefix)[1],tabIndex:this.tabIndex+400,acc:this.manager.getAccMessage("comm24",0),role:"button"},this.createAccDiv(r),this.enableDisableSpecificButton(b.EquationManagerPro.UNDO_BUTTON,!1),this.undoButtonView.$el.off("click.undoButtonClick").on("click.undoButtonClick",function(a){n._undoButtonClickHandler(a)}),this.undoButtonView.$el.off("mousedown.undoButtonClick").on("mousedown.undoButtonClick",function(a){return n.mouseDownOnInteractive(a,!0,!0,!0),!1})},makeResizableContainerDraggable:function(){var b=(this.model,this.$(".equals-sign-container"));b.not(".ui-disabled").draggable({start:$.proxy(this._handleDragStart,this),drag:$.proxy(this._handleDragHandler,this),revert:!1,stop:$.proxy(this._handleDragStop,this),containment:this.$(".drag-handle-containment"),axis:"x",cursor:"col-resize",cursorAt:{left:this.$(".equals-sign-container").width()/2},refreshPositions:!0}),a.Common.Utilities.Models.Utils.EnableTouch(b,{specificEvents:a.Common.Utilities.Models.Utils.SPECIFIC_EVENTS.DRAGGABLE})},enableDisableResizableContainerDrag:function(a){var b=this.$(".equals-sign-container");b.is(".ui-draggable")&&(a===!1?b.draggable("disable").css("cursor","default"):b.draggable("enable").css("cursor","col-resize"))},_handleDragStart:function(){this.equationView.attachDetachDroppable(!1,!0),this.prevHandleLeft=this.$(".equals-sign-container").position().left},_handleDragHandler:function(a,b){var c,d,e=this.$el.width(),f=b.position.left;c=Math.abs(this.$lhsExprView.position().left-f),d=e-c-b.helper.width(),this.$lhsExprView.css("width",c),this.$rhsExprView.css("width",d),this.$lhsExprView.find(".expression-seperator-holder svg").css("transform","scale("+this.$lhsExprView.width()/300+", 1)"),this.$rhsExprView.find(".expression-seperator-holder svg").css("transform","scale("+this.$rhsExprView.width()/300+", 1)")},_updateEquationPosition:function(){},updateEquationPosition:function(){this._updateEquationPosition()},_handleDragStop:function(){this.equationView.attachDetachDroppable(!0),this.getFirstTileDrop()===!0&&this._setDropSlotsForBinTiles()},_attachHoverTileEvents:function(a){var b=this.$binTileContainment;f.isAndroid===!1&&f.isIOS===!1?(b.find(".bin-tiles").off("mouseover.binTileMouseOver").on("mouseover.binTileMouseOver",function(b){a._onTileMouseOver(b)}),b.find(".bin-tiles").off("mouseout.binTileMouseOut").on("mouseout.binTileMouseOut",function(b){a._onTileMouseOut(b)})):(b.find(".bin-tiles").off("touchstart.binTileTouchStart").on("touchstart.binTileTouchStart",function(b){a._onTileTouchStart(b)}),b.find(".bin-tiles").off("touchend.binTileTouchEnd").on("touchend.binTileTouchEnd",function(b){a._onTileTouchEnd(b)}))},_onTileMouseOver:function(a){$(a.currentTarget).find(".bin-tiles-base").addClass("hover")},_onTileMouseOut:function(a){$(a.currentTarget).find(".bin-tiles-base").removeClass("hover")},_onTileTouchStart:function(a){$(a.target).addClass("hover")},_onTileTouchEnd:function(a){$(a.target).removeClass("hover")},_attachNegateTileEvents:function(a){var b=a.$binTileContainment.find(".bin-tiles");b.off("click.binTileClick").on("click.binTileClick",function(b){a.isAnimationRunning===!0||$(b.currentTarget).hasClass("disable")||"t"===$(b.currentTarget).attr("data-tilevalue")||a._onBinTileClick(this)}),b.off("mousedown.binTileDown").on("mousedown.binTileDown",function(){a.stopReading()})},_onBinTileClick:function(a){var c,d,e,f=null,g=this,h=null,i=a.id.split(this.idPrefix)[1],j=null;c=$(a),d=c.attr("data-tilevalue"),f=null,e="x"!==d&&"-x"!==d&&"t"!==d&&"-t"!==d?-1*parseInt(d,10):d,"number"==typeof e?(h=-1*e,e>0?c.find(".base-value").html(e):c.find(".base-value").html("<span>&minus;</span>"+Math.abs(e)),c.attr("data-tilevalue",e),j=e):(h=e,"x"===e?(f=this.minusSign+"x",c.attr("data-tilevalue","-x"),j="-x"):"-x"===e&&(f="x",c.attr("data-tilevalue",f),j=f),"t"===e?(f=this.minusSign+"t",c.attr("data-tilevalue","-t"),j="-t"):"-t"===e&&(f="t",c.attr("data-tilevalue",f),j=f),c.find(".base-value").html("<em>"+f+"</em>")),c.hasClass("bin-tile-number-x")===!0&&this.trigger(b.EquationManagerPro.EVENTS.COEFF_TILE_NEGATED,{changedValue:j,previousValue:h}),c.addClass("animated fadeIn"),this.showHideOverlayDiv(!0),this.isAnimationRunning=!0,c.off("webkitAnimationEnd oanimationend msAnimationEnd animationend MSAnimationEnd"),this._isIE9?this._onAnimationEndAfterBinTileClick(c):c.one("webkitAnimationEnd oanimationend msAnimationEnd animationend MSAnimationEnd",function(){g._onAnimationEndAfterBinTileClick(c)}),this.isTutorialMode||this.setAccMessage(i,this._getTileText(c)),c.hasClass("last-tile-in-bin")===!0&&(this.numberToReplaceInBin=j,this.model.set("numberToReplaceInBin",j)),this.trigger(b.EquationManagerPro.EVENTS.BIN_TILE_SIGN_CHANGED,{previousValue:h,changedValue:j})},_onAnimationEndAfterBinTileClick:function(a){a.removeClass("animated fadeIn"),this.showHideOverlayDiv(!1),this.isAnimationRunning=!1},_setNegativeSign:function(a){this.minusSign=$("<span/>").html("&minus;").html()},updatesNumericTileArray:function(a){this.numericTileArray=a},checkIfSimplestForm:function(){return!1},mouseDownOnInteractive:function(a,c,d,e){e||this.removeHighlightTilesImmediate(),c&&1===a.which&&0===_.intersection($(a.target),this.$(".expression-view-holder")).length&&this.removeMarquee(),$(a.target).parents(".theme2-tooltip").length>0||(this.combineLikeBasesTooltip&&this.combineLikeBasesTooltip.hideTooltip(),d&&this.trigger(b.EquationManagerPro.EVENTS.MOUSEDOWN_ON_TILES),this.trigger(b.EquationManagerPro.EVENTS.HIDE_TOOLTIP))},_createTooltips:function(){if(null===this.combineLikeBasesTooltip&&this.options.inlineFeedbackConatiner){var b={elementEl:this.options.inlineFeedbackConatiner,idPrefix:this.idPrefix,manager:this.manager,_player:this.player,text:"",baseClass:"tooltip-base-class",type:a.Common.Components.Theme2.Views.Tooltip.TYPE.FORM_VALIDATION,arrowType:a.Common.Components.Theme2.Views.Tooltip.ARROW_TYPE.TOP_MIDDLE,path:this.filePath,filePath:this.filePath,isTts:!0,isArrow:!1,closeOnDocumentClick:!0,tabIndex:4500,accDivOffset:{offsetTop:-5,offsetLeft:-5}};this.combineLikeBasesTooltip=a.global.Theme2.Tooltip.generateTooltip(b),this._attachTooltipAccEvents()}},_attachTooltipAccEvents:function(){var a=this;this.combineLikeBasesTooltip.$(".text-container").off("keydown.hideToolTip").on("keydown.hideToolTip",function(b,c){9===b.keyCode&&b.shiftKey&&(b.preventDefault(),a._handleFocusOutOnToolTip(b,!0))}),this.combineLikeBasesTooltip.$(".custom-btn-tts-blue").on("keydown.hideToolTip",function(b,c){9!==b.keyCode||b.shiftKey||(b.preventDefault(),a._handleFocusOutOnToolTip(b,!1))})},_handleFocusOutOnToolTip:function(a){this.stopReading(),this.setFocusOnPreviousElement(a),this.combineLikeBasesTooltip.hideTooltip()},_changeTooltipTextAndShow:function(a,c){this.combineLikeBasesTooltip?(this.combineLikeBasesTooltip.$el.css({left:0}),this.combineLikeBasesTooltip.changeText(a,c),this.combineLikeBasesTooltip.showTooltip(),this.setFocus(this.combineLikeBasesTooltip.$el.find(".text-container").attr("id").split(this.idPrefix)[1])):this.trigger(b.EquationManagerPro.EVENTS.SHOW_INTERACTIVE_TOOLTIP,a,c),this.tooltipData={isTooltipVisible:!0,lastIndex:this.prevTileIndex,selectedTile:this.$selectedTile,isMarquee:this.marqueeNodes.length>0}},_generateMarquee:function(){var c=[];if(this.player){var d,e,f=a.Common.Components.Views.EquationManagerPro.Marquee;return e={idPrefix:this.idPrefix,manager:this.manager,filePath:this.filePath,player:this.player,equationManager:this,marqueeContainer:this.$(".lhs-expression-marquee-container"),scrollContainer:this.$(".lhs-expression-view-holder"),selectorClass:b.EquationManagerPro.TILE_DUMMY_CLASS,el:this.el,marqueeIndex:0,marqueeBGColor:this.options.marqueeBGColor||!1},d=f.createMarquee(e),this.listenTo(d,f.EVENTS.start,this._marqueeStartHandler),this.listenTo(d,f.EVENTS.ChangeSelectorClass,this._changeSelectorClass),this.listenTo(d,f.EVENTS.end,this._onMarqueeDrawn),c.push(d),e.marqueeContainer=this.$(".rhs-expression-marquee-container").length>0?this.$(".rhs-expression-marquee-container"):this.$(".rhs-expression-view"),e.scrollContainer=this.$(".rhs-expression-view-holder"),e.marqueeIndex=1,d=f.createMarquee(e),this.listenTo(d,f.EVENTS.start,this._marqueeStartHandler),this.listenTo(d,f.EVENTS.ChangeSelectorClass,this._changeSelectorClass),this.listenTo(d,f.EVENTS.end,this._onMarqueeDrawn),c.push(d),this.marqueeSelectedItems=[],this.marqueeNodes=[],c}},_onMarqueeDrawn:function(a,b,c){var d=this.marqueeSelectedItems,e="",f=0,d=this.marqueeSelectedItems,g=d.length,h=null;for(this.onlyLHS||this._checkMarqueeContainsNullTile()||0===this.marqueeView.model.get("marqueeIndex")&&this.getFirstTileDrop()===!1||this._marqueeSelectedItemsTreeNodeRefs(!0),this._groupSelectedTileItems(a.optionalParams.$marquee,a.optionalParams.$scrollCntr),this._hideMarqueeSelectedItems();g>f;f++)h=0===f?!0:!1,e+=d[f].getAccString(h)},_marqueeSelectedItemsTreeNodeRefs:function(a){for(var b=0,d=!0;b<this.marqueeSelectedItems.length;b++)this.marqueeSelectedRefNodes.push(this.marqueeSelectedItems[b].model.get("treeNodeRef"));if(this.marqueeSelectedRefNodes.length){var e=c.EquationManagerPro.Utils.getCommonParentFromMultiple(this.marqueeSelectedRefNodes),f=this.getTreeRoot(),g=c.EquationManagerPro.Utils.getOperatorStringsBetween(e,f);-1!==g.indexOf("^")||-1!==g.indexOf("/")?d=!1:"*"!==g[0]||"+"!==g[1]&&"="!==g[1]?"*"===e.data&&e.children.length!==this.marqueeSelectedRefNodes.length&&(d=!1):d=!1,d?this._negateTilesInsideMarquee(this.marqueeSelectedRefNodes,a):this.marqueeSelectedRefNodes=[]}},_negateTilesInsideMarquee:function(a,b){var d=c.EquationManagerPro.Utils.getCommonParentFromMultiple(a);switch(d.data){case c.TileItem.OPERATORS.ADDITION:this._tilesToNegate(d.children,b);break;case c.TileItem.OPERATORS.MULTIPLICATION:this._tilesToNegate(d,b);break;case c.TileItem.OPERATORS.DIVISION:this._negateTilesInsideMarquee(d.children[0].children.length?d.children[0].children:[d.children[0]],b);break;default:this._tilesToNegate(d,b)}},_tilesToNegate:function(a,b){var d,e=a.data,f=0,g=this.equationView;if("string"!=typeof e)for(;f<a.length&&a.length>1;f++)this._tilesToNegate(a[f],b);e===c.TileItem.OPERATORS.MULTIPLICATION?a.children[0].data===c.TileItem.OPERATORS.DIVISION?this._negateTilesInsideMarquee(a.children[0].children.length?a.children[0].children:[a.children[0].children[0]],b):a.children[0].data===c.TileItem.OPERATORS.PARENTHESES?this._negateTilesInsideMarquee(a.children[0].children[0].children.length?a.children[0].children[0].children:[a.children[0].children[0]],b):(d=g.getViewFromIndex(g.model.getIndexFromItemModel(a.children[0].data)),this._checkTileInsideMarquee(d)&&(b?d.$el.attr({"data-negateTile":b,"data-originalValue":d.model.get("base")}):d.$el.removeAttr("data-negateTile"))):e===c.TileItem.OPERATORS.DIVISION?this._negateTilesInsideMarquee(a.children[0].children.length?a.children[0].children:[a.children[0]],b):a.data&&(d=g.getViewFromIndex(g.model.getIndexFromItemModel(a.data)),this._checkTileInsideMarquee(d)&&(b?d.$el.attr({"data-negateTile":b,"data-originalValue":d.model.get("base")}):d.$el.removeAttr("data-negateTile")))},_checkTileInsideMarquee:function(a){var b,c=this.marqueeSelectedItems;for(b=0;b<c.length;b++)if(c[b].getWhetherTermPresent(a)===!0)return!0;return!1},_checkMarqueeContainsNullTile:function(){var a,b=this.marqueeSelectedItems;for(a=0;a<b.length;a++)if(b[a].getMarqueeContainsNullTile()===!0)return!0;return!1},_changeSelectorClass:function(a,c,d){0===this.$el.find(".current-draggable").length&&(this._marqueeEndHandler(a,c,d),this.marqueeSelectedItems=this._updateMarqueeForMulTiles(this.marqueeSelectedItems),this.marqueeSelectedItems=this._validateMarqueeItems(this.marqueeSelectedItems,a)||[],this.marqueeView.model.set("selectorClass",b.EquationManagerPro.TILE_CLASS))},setTutorialMarqueeTargetsIndex:function(a,b){},_marqueeStartHandler:function(a,c){this.marqueeView=this.marqueeViews[c],this.trigger(b.EquationManagerPro.EVENTS.MARQUEE_START),this._showMarqueeSelectedItems(),this.marqueeSelectedItems=[],this.marqueeNodes=[],self.$(".term-tile[data-negatetile=true]").removeAttr("data-negatetile data-originalvalue"),
this.marqueeSelectedRefNodes=[],this.termsToNegate=[],this.marqueeStartX=a.originalEvent.clientX,this.marqueeStartY=a.originalEvent.clientY;var d=this.$el.find("."+b.EquationManagerPro.TILE_CLASS);d.removeClass(b.EquationManagerPro.TILE_CLASS)},_marqueeEndHandler:function(b,c,d){this.endClientLeft=b.clientX,this.endClientTop=b.clientY;var e=(this.endClientLeft-this.startClientLeft,this.endClientTop-this.startClientTop,c),f=(this.equationView,new a.Common.Utilities.Models.Rect(e[0].getBoundingClientRect()));f.getMiddle();b.marqueeStartX=this.marqueeStartX,b.marqueeStartY=this.marqueeStartY,this.equationView.getElementsInsideMarquee(b,e,d)},_hideMarqueeSelectedItems:function(){this.$(".marquee-selected").css({visibility:"hidden"});var a;for(a=0;a<this.marqueeSelectedItems.length;a++)this.marqueeSelectedItems[a].attachDetachDroppable(!1,!0),this.marqueeSelectedItems[a].addClassForAllTilesInsideMarquee();this.marqueeSelectedItems[0]&&this.marqueeSelectedItems[0].enableOperator(!0)},_showMarqueeSelectedItems:function(){if(this.$(".marquee-selected").css({visibility:""}),this.$(".tile-inside-marquee").removeClass(b.EquationManagerPro.TILE_INSIDE_MARQUEE),this.marqueeSelectedItems){var a;for(a=0;a<this.marqueeSelectedItems.length;a++)this.marqueeSelectedItems[a].attachDetachDroppable(!0,!0)}},allEmptyInMarquee:function(){var a=0,b=this.marqueeSelectedItems;for(a=0;a<b.length;a++)if(b[a]instanceof Backbone.View&&!b[a].model.isEmpty())return!1;return!0},_validateMarqueeItems:function(a,c){if(0!==a.length){var d=0,e=b.EquationManagerPro.TILE_CLASS,f=[],g=this.marqueeView.model.get("ignoreClass"),h=c.clientX>c.marqueeStartX?"ltr":"rtl",i="ltr"===h?1:"rtl"===h?-1:null,j="ltr"===h?0:"rtl"===h?a.length-1:null,k=a[j].parent;for(d=j;this._validateMarqueeLoopCond(h,a,d)&&a[d].parent===k;d+=i)if(!a[d].$el.hasClass(g)&&(f.push(a[d]),a[d].$el.addClass(e),d>0&&this._addOperatorToMarquee(a[d]),!this._validAdjacentTile(h,a,d))){"rtl"===h&&this._removeOperatorFromMarquee(a[d]);break}return"ltr"===h?f:"rtl"===h?f.reverse():null}},_addOperatorToMarquee:function(a){if(a){var c=this.$(this.getOperatorViewOfTileItem(a)),d=b.EquationManagerPro.TILE_CLASS;0!==c.length&&c.addClass(d)}},_removeOperatorFromMarquee:function(a){var c=this.$(this.getOperatorViewOfTileItem(a)),d=b.EquationManagerPro.TILE_CLASS;0!==c.length&&c.removeClass(d)},_validAdjacentTile:function(a,b,c){return"ltr"===a?b[c+1]&&b[c+1]===b[c].getNextTile():"rtl"===a?b[c-1]&&b[c-1]===b[c].getPrevTile():void 0},_validateMarqueeLoopCond:function(a,b,c){return"ltr"===a?c<b.length:"rtl"===a?c>=0:void 0},removeFromArray:function(a,b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},_groupSelectedTileItems:function(a,c){var d=$("<div/>"),e=null,f=(this.marqueeSelectedItems,c.find("."+b.EquationManagerPro.TILE_CLASS)),g=f.length;this.marqueeExponents=[],d.css({position:"relative","z-index":0,left:"0px"}),0!==g&&(this.marqueeView.groupSelectedElements(d),this.marqueeView.makeGroupDraggable(this.marqueeSelectedItems[0],this.marqueeSelectedItems,this));for(var h=0;g>h;h++){e=$(f[h]);var i=e.clone(!1).removeClass(b.EquationManagerPro.TILE_CLASS);this.$el.find(".current-draggable").attr("style",""),d.append(i),i.css("position","absolute").position({my:"left top",at:"left top",of:e,collision:"none"}).removeClass("coefficient-tile")}},_saveMarqueeExponents:function(a){var b=c.TileItem.TileType,d=(this.marqueeSelectedItems,a.data("tiletype"));d===b.TERM_TILE?this.marqueeExponents.push(a.find(".exponent > .exponent-value")):d===b.PARENTHESES?this.marqueeExponents.push(a.find("> .exponent > .exponent-value")):d===b.BASE_ONLY&&this.marqueeExponents.push(null)},pushElementToSelection:function(a,b){-1===this.marqueeSelectedItems.indexOf(a)&&(this.marqueeSelectedItems.push(a),this.marqueeNodes.push(b))},removeMarquee:function(){var a;for(this._showMarqueeSelectedItems(),this.marqueeSelectedItems=[],this.marqueeNodes=[],a=0;a<this.marqueeViews.length;a++)this.marqueeViews[a].$marqueeDiv.empty(),this.marqueeViews[a].$marqueeDiv.css("visibility",""),this.marqueeViews[a].collapseMarquee();this.trigger(b.EquationManagerPro.EVENTS.MARQUEE_REMOVED)},isTileViewInsideMarquee:function(a){var b,c=this.marqueeSelectedItems,d=0;if(-1!==c.indexOf(a))return!0;for(;d<c.length;d++)if(b=c[d],b instanceof Backbone.View&&b.hasChildView(a,!0))return!0;return!1},isTileViewInsideMarqueeFixed:function(a){var b=this.getAllMarqueeViews();return b.indexOf(a)>-1},getAllMarqueeViews:function(){var a=[],b=0;for(b=0;b<this.marqueeSelectedItems.length;b++)Array.prototype.push.apply(a,this.marqueeSelectedItems[b].getChildViews());return a},getOperatorViewOfTileItem:function(a){var b=a.parent.getOperatorFromTileItem(a);return b},getWhetherPlusOperatorPresent:function(a){var b,d=(this.marqueeSelectedItems,this.marqueeNodes);return a&&d.push(a),d.length&&(b=c.EquationManagerPro.Utils.getCommonParentFromMultiple(d),b.data===c.TileItem.OPERATORS.ADDITION)?(a&&d.pop(),!0):(a&&d.pop(),!1)},_updateMarqueeForMulTiles:function(a){var b,d=(this.marqueeNodes,c.TileItem.TileType);if(this.getWhetherPlusOperatorPresent(null)===!0){var e,f;for(e=a[0],f=e.getPrevTile();f&&e.model.get("operator")===c.TileItem.OPERATORS.MULTIPLICATION;)a.unshift(f),e=f,f=f.getPrevTile()}return a.length>0&&(b=a[0].parent,b.model.get("type")===d.PARENTHESES&&b.tileViews.length===a.length&&this._checkIfAllItemsBelongToSameParent(a,b)&&(a=[],a.push(b))),a},_checkIfAllItemsBelongToSameParent:function(a,b){var c;for(c=1;c<a.length;c++)if(a[c].parent!==b)return!1;return!0},_undoButtonClickHandler:function(c){var d=this.commandFactory.get("undoStack");d.length;this.undoButtonView.getButtonState()!==a.global.Theme2.Button.BUTTON_STATE_DISABLED&&(this.stopReading(),this.undo(),this.isBottomExpressionShown&&this._updateBottomEquations(),0===d.length&&(this.enableDisableSpecificButton(b.EquationManagerPro.UNDO_BUTTON,!1),this.getFirstTileDrop()===!1&&(this.enableDisableSpecificButton(b.EquationManagerPro.RESET_BUTTON,!1),this.model.set("resetBtnStatus",!1)),this.trigger(b.EquationManagerPro.EVENTS.UNDO_STACK_EMPTY)),this.trigger(b.EquationManagerPro.EVENTS.UNDO_BUTTON_CLICKED),this._setFocus())},_showResetPopUp:function(){var b,c=this.resetPopUpTexts,d=null,e=null,f=null,g=null,h=a.global.Theme2.Button.TYPE.TEXT,i=this.manager;c?(d=c.titleText?c.titleText:i.getMessage("comm32",0),e=c.titleAccText?c.titleAccText:i.getAccMessage("comm32",0),f=c.bodyText?c.bodyText:i.getMessage("comm33",0),g=c.bodyAccText?c.bodyAccText:i.getAccMessage("comm33",0)):(d=i.getMessage("comm32",0),e=i.getAccMessage("comm32",0),f=i.getMessage("comm33",0),g=i.getAccMessage("comm33",0)),b={manager:this.manager,player:this.player,path:this.filePath,idPrefix:this.idPrefix,tooltipColorType:a.Common.Components.Theme2.Views.Tooltip.TYPE.GENERAL,type:a.global.Theme2.PopUpBox.CONFIRM,containsTts:!0,title:d,accTitle:e,text:f,accText:g,buttons:[{id:"popup-ok",type:h,text:i.getMessage("theme2-pop-up-ok-btn-text",0),clickCallBack:{fnc:this._resetOkButtonClickHandler,scope:this}},{id:"popup-cancel",type:h,text:i.getMessage("comm23",0),clickCallBack:{fnc:this._resetCancelButtonClickHandler,scope:this}}],closeCallback:{fnc:function(a){"popup-ok"===a.buttonClicked&&this._setFocus({resetClicked:!0})},scope:this}},a.global.Theme2.PopUpBox.createPopup(b)},_resetOkButtonClickHandler:function(){this.stopReading(),this.enableDisableSpecificButton(b.EquationManagerPro.UNDO_BUTTON,!1),this.model.set("resetBtnStatus",!1),this.resetAllBinTiles(),this.setTileAddedFromBinValue(),this.setTileAddedInExpression(),this.trigger(b.EquationManagerPro.EVENTS.RESET_BUTTON_CLICKED)},_resetCancelButtonClickHandler:function(){this.stopReading();var a=this.resetButtonView.$el.attr("id").split(this.idPrefix)[1];this.setFocus(a)},_resetButtonClickHandler:function(){this.stopReading(),this.resetButtonView.getButtonState()!==a.global.Theme2.Button.BUTTON_STATE_DISABLED&&this._showResetPopUp()},_enableDisableButtons:function(b,c){b&&(c===!0?b.setButtonState(a.global.Theme2.Button.BUTTON_STATE_ACTIVE):b.setButtonState(a.global.Theme2.Button.BUTTON_STATE_DISABLED))},_cacheWindowElements:function(){var a=this.idPrefix;this.$lhsExprView=this.$(".lhs-expression-view"),this.$rhsExprView=this.$(".rhs-expression-view"),this.$lhsExprBgView=this.$(".lhs-expression-view-bg-holder"),this.$rhsExprBgView=this.$(".rhs-expression-view-bg-holder"),this.$showLhsExprBgView=this.$(".show-lhs-expression-bg"),this.$showRhsExprBgView=this.$(".show-rhs-expression-bg"),this.$lhsExprEqnHolder=this.$("#"+a+"workspace-expression-area").find(".lhs-expression-view-expression  .expression-view-holder"),this.$rhsExprEqnHolder=this.$("#"+a+"workspace-expression-area").find(".rhs-expression-view-expression  .expression-view-holder"),this.$equationCOntainer=this.$(".equation-view-component")},resetAllBinTiles:function(){for(var a=this.numericTileArray,b=this.$binTileContainment,c=0,d=a.length,e=null,f=null,g=null,h=null;d>c;c++)if(h=a[c],"number"==typeof h?h=Math.abs(h):"-x"===h&&(h="x"),e=b.find(".bin-tile-number-"+h),f=e.attr("data-tilevalue"),g=parseInt(f),isNaN(g)===!0)switch(f){case"-x":e.find(".base-value").html("<em>x</em>"),e.attr("data-tilevalue","x");break;case"-t":e.find(".base-value").html("<em>t</em>"),e.attr("data-tilevalue","t")}else 0>g&&(g*=-1,e.find(".base-value").html(g),e.attr("data-tilevalue",g))},getBinTileUsingIndex:function(a){return this.$binTileContainment.find(".bin-tile-number-"+a)},enableDisableSpecificButton:function(a,c){var d=b.EquationManagerPro;switch(a){case d.UNDO_BUTTON:this.undoButtonView&&(this._enableDisableButtons(this.undoButtonView,c),this.enableTab(this._getAccId(this.undoButtonView.$el),c));break;case d.RESET_BUTTON:this.resetButtonView&&(this._enableDisableButtons(this.resetButtonView,c),this.enableTab(this._getAccId(this.resetButtonView.$el),c),this.model.set("resetBtnStatus",c))}},attachTutorialEventsOnTile:function(a){var b=this.equationView.getViewFromIndex(a);b&&b.attachEvents(!0)},detachDraggable:function(a){var b=this.equationView.getViewFromIndex(a);b&&b.$el.is(".ui-draggable")&&(this.detachMouseEventsOfTile(b),b.$el.draggable("destroy"))},detachDroppable:function(a){var b=this.equationView.getViewFromIndex(a);b&&b.$el.is(".ui-droppable")&&(this.detachMouseEventsOfTile(b),b.$el.droppable("destroy"))},detachMouseEventsOfTile:function(a){a&&a.$el.off("mousedown.tile").off("mouseup.tile").off("click.tile").addClass("no-hover")},proceedToNextStep:function(){},attachListenersOnMarqueeContainment:function(a,b){a&&this.marqueeViews[0].attachListenersOnMarqueeContainment(),b&&this.marqueeViews[1].attachListenersOnMarqueeContainment()},detachListenersOnMarqueeContainment:function(a,b){a&&this.marqueeViews[0].detachListenersOnMarqueeContainment(),b&&this.marqueeViews[1].detachListenersOnMarqueeContainment()},enableMarquee:function(a,b){a&&this.marqueeViews[0].enableMarquee(),b&&this.marqueeViews[1].enableMarquee()},disableMarquee:function(a,b){a&&this.marqueeViews[0].disableMarquee(),b&&this.marqueeViews[1].disableMarquee()},showMarquee:function(a,b){a&&this.marqueeViews[0].showMarquee(),b&&this.marqueeViews[1].showMarquee()},enableMarqueeDraggable:function(a,b){a&&this.marqueeViews[0].enableDisableMarqueeDraggable(!0),b&&this.marqueeViews[1].enableDisableMarqueeDraggable(!0)},disableMarqueeDraggable:function(a,b){a&&this.marqueeViews[0].enableDisableMarqueeDraggable(!1),b&&this.marqueeViews[1].enableDisableMarqueeDraggable(!1)},enableMarqueeDroppable:function(a,b){a&&this.marqueeViews[0].enableDisableMarqueeDroppable(!0),b&&this.marqueeViews[1].enableDisableMarqueeDroppable(!0)},disableMarqueeDroppable:function(a,b){a&&this.marqueeViews[0].enableDisableMarqueeDroppable(!1),b&&this.marqueeViews[1].enableDisableMarqueeDroppable(!1)},getMarqueeDiv:function(a){return this.marqueeViews[a?0:1].getMarqueeDiv()},getScrollAmount:function(a,b){var c=a[0].getBoundingClientRect(),d=b[0].getBoundingClientRect(),e={scroll:!1};return d.width>c.width?(e.scrollAmt=0,e.scroll=!1):d.left<c.left?(e.scrollAmt=a.scrollLeft()+d.left-c.left,e.scroll=!0):d.right>c.right&&(e.scrollAmt=a.scrollLeft()+d.right-c.right,e.scroll=!0),e},updateContainerSizes:function(a,b,c){this.$lhsExprView.css("width",a),this.$rhsExprView.css("width",b),this.$(".equals-sign-container").css("left",c),this.$lhsExprView.find(".expression-seperator-holder svg").css("transform","scale("+a/300+", 1)"),this.$rhsExprView.find(".expression-seperator-holder svg").css("transform","scale("+b/300+", 1)")},_createEquationTooltips:function(b){var c=this,d=a.Common.Components.Theme2.Views.Tooltip,e={_player:c.player,idPrefix:c.idPrefix,manager:c.manager,path:c.filePath,elementEl:c.idPrefix+b+"lhs-expression-container",type:d.TYPE.FORM_VALIDATION,baseClass:"equation-tooltip",isArrow:!0,text:"tooltip",arrowType:d.ARROW_TYPE.TOP_MIDDLE};c.leftEquationTooltip=d.generateTooltip(e),e.elementEl=c.idPrefix+b+"rhs-expression-container",c.rightEquationTooltip=d.generateTooltip(e)},_bindEquationTooltipEvents:function(){var b=this,c=a.Common.Utilities.Models.Utils,d=this.$el.find(".left-expression-container"),e=this.$el.find(".right-expression-container"),f=null,g=null;d.off(".leftEquation").on("mouseenter.leftEquation",function(a){b.showLeftTooltip=!0,f=window.setTimeout(function(a){b.showLeftTooltip&&b._showHideTooltips(!0,!0)},500)}).on("mouseleave.leftEquation",function(a){b._showHideTooltips(!0,!1),b.showLeftTooltip=!1,window.clearTimeout(f)}),e.off(".rightEquation").on("mouseenter.rightEquation",function(a){b.showRightTooltip=!0,g=window.setTimeout(function(a){b.showRightTooltip&&b._showHideTooltips(!1,!0)},500)}).on("mouseleave.rightEquation",function(a){b._showHideTooltips(!1,!1),b.showRightTooltip=!1,window.clearTimeout(g)}),c.EnableTouch(d),c.EnableTouch(e)},_showHideTooltips:function(a,b){a&&b?this._adjustLeftTooltipPosition():a&&!b?this.leftEquationTooltip.hideTooltip():!a&&b?this._adjustRightTooltipPosition():this.rightEquationTooltip.hideTooltip()},_adjustLeftTooltipPosition:function(){var a,b,c=this.$el.find(".lhs-expression-view"),d=5,e=50,f=-33,g=12;a=10+c.position().left+c.width()/2,b=a-this.leftEquationTooltip.$el.width()/2<g?g:a-this.leftEquationTooltip.$el.width()/2,this.leftEquationTooltip.$el.find(".big-parenthesis-container").length>0?(this.leftEquationTooltip.$el.css({height:e}),this.leftEquationTooltip.$el.find(".expression-contains-fraction").css({top:f})):(this.leftEquationTooltip.$el.css({height:"auto"}),this.leftEquationTooltip.$el.find(".expression-contains-fraction").css({top:""})),this.leftEquationTooltip.showTooltip(),this.leftEquationTooltip.$el.css({left:b,top:this.leftEquationTooltip.$el.position().top+d}),this.leftEquationTooltip.$el.find(".arrow-div,.border-div").css({left:a-b-10})},_adjustRightTooltipPosition:function(){this.rightEquationTooltip.$el.css({left:0});var a,b,c=this.$el.find(".rhs-expression-view"),d=c.position().left+10,e=c.width(),f=5,g=50,h=-33,i=d+e;a=d+e/2,b=a+this.rightEquationTooltip.$el.width()/2>i?i-this.rightEquationTooltip.$el.width():a-this.rightEquationTooltip.$el.width()/2+1,this.rightEquationTooltip.$el.find(".big-parenthesis-container").length>0?(this.rightEquationTooltip.$el.css({height:g}),this.rightEquationTooltip.$el.find(".expression-contains-fraction").css({top:h})):(this.rightEquationTooltip.$el.css({height:"auto"}),this.rightEquationTooltip.$el.find(".expression-contains-fraction").css({top:""})),this.rightEquationTooltip.showTooltip(),this.rightEquationTooltip.$el.css({left:b,top:this.rightEquationTooltip.$el.position().top+f}),this.rightEquationTooltip.$el.find(".arrow-div,.border-div").css({left:a-b-9})},_addEquationInTooltip:function(){this.leftEquationTooltip.$el.find(".text-container").html(this.$el.find(".left-expression-container").html()),this.rightEquationTooltip.$el.find(".text-container").html(this.$el.find(".right-expression-container").html())},handleMarqueeAcc:function(){},showHideParticularBinTile:function(a,b){a===!0?$(this.$binTileContainment.find(".bin-tiles")[b]).show():$(this.$binTileContainment.find(".bin-tiles")[b]).hide()},updateParticularBinTileData:function(a,b){var c=$(this.$binTileContainment.find(".bin-tiles")[a]),d=c.find(".base-value").removeClass("decrease-font-size"),e=b?b:this.numberToReplaceInBin;d.html(e>0?e:"&minus;"+Math.abs(e)),Math.abs(e).toString().length>2&&d.addClass("decrease-font-size"),c.attr("data-tilevalue",e)},_getMaxTermsPerSide:function(a){var b=this.equationView.tileViews;return a===!0?b[0].tileViews.length:b[1].tileViews.length}},{TILE_CLASS:"marquee-selected",TILE_DUMMY_CLASS:"base",TILE_INSIDE_MARQUEE:"tile-inside-marquee",EVENTS:{COMMAND_FIRED:"command-fired",TILE_DRAGGING_START:"tile-dragging-start",TILE_MOUSE_DOWN:"tile-mouse-down",MARQUEE_DRAG_START:"marquee-drag-start",MARQUEE_DROPPED:"marquee-dropped",REVERT_START:"revert-start",REVERT_END:"revert-end",NEW_EXPRESSION_START:"new-expression-start",INVERT_TILE_TEXT:{PARENTHESES:"parentheses",TERM_TILE:"term-tile",MARQUEE:"marquee"},COMMAND_SUCCESSFUL:"command-successful",RESET_BUTTON_CLICKED:"reset-button-clicked",ADD_STEP:"add-step",REMOVE_STEP:"remove-step",RESET_FIRST_TILE_DROP:"reset-first-tile-drop",SET_FIRST_TILE_DROP:"set-first-tile-drop",FANNING_ANIMATION_COMPLETE:"fanning-animation-complete",MOUSEDOWN_ON_TILES:"mouse-down-on-tiles",HIDE_TOOLTIP:"hide-tooltip",BIN_TILE_SIGN_CHANGED:"bin-tile-sign-changed",BIN_TILE_RESET:"bin-tile-reset",TILE_DRAG_STOP:"tile-drag-stop",BIN_DRAGGING_START:"bin-dragging-start",BIN_DRAG_STOP:"bin-drag-stop",UNDO_STACK_EMPTY:"undo-stack-empty",SHOW_INTERACTIVE_TOOLTIP:"show-interactive-tooltip",ANY_DRAG_START:"any-drag-start",ANY_DRAG_STOP:"any-drag-stop",TILE_DROP_SUCCESS:"tile-drop-success",UNDO_BUTTON_CLICKED:"undo-button-clicked",PARENTHESES_REFLECTION:"parentheses-reflection",SET_UNDO_RESET_BTN_TAB_INDEXES:"set-undo-reset-btn-tab-indexes",CHANGE_DRAG_HANDLE_IMG:"change-drag-handle-img",TREE_ROOT_SET:"tree-root-set",COEFF_TILE_NEGATED:"coeff-tile-negated",FOCUS_SET_LHS:"focus-set-lhs"},KEY:{TAB:9,SPACE:32,ENTER:13,ESCAPE:27,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40,DELETE:68,ROTATE_CLOCKWISE:82,ROTATE_ANTI_CLOCKWISE:69},SCROLL_DIRECTION:{LEFT:"scrollToLeft",RIGHT:"scrollToRight"},RESET_BUTTON:"reset-button",UNDO_BUTTON:"undo-button",BLACK:"#000000",WHITE:"#FFFFFF",DATA:"data"})}(window.MathInteractives),function(a){"use strict";var b=a.Common.Components.Views.EquationManagerPro,c=a.Common.Components.Models.EquationManagerPro;b.EquationManagerProAcc=b.EquationManagerPro.extend({firstTileAccId:null,lhsFocusDiv:null,rhsFocusDiv:null,leftTileArray:[],rightTileArray:[],leftTileIndex:-1,rightTileIndex:-1,lastTabIndex:0,allElemIds:null,isCircularModeOn:!1,$selectedTile:null,prevTileIndex:-1,contextMenuView:null,termTileContextMenuView:null,isSpaceKeyDown:!1,tooltipData:{isTooltipVisible:!1},exponentParenthesisView:null,termTileContextMenuAllIds:[],termTileContextMenuFirstId:[],binTileContextMenuFirstId:[],enableTabOnContainer:!1,isMarqueeStep:!1,isIgnoreCombine:null,fullExpressionSelected:!1,ignoreIndexForTutorial:null,prevAccText:"",prevTileAccText:"",initialize:function(){b.EquationManagerProAcc.__super__.initialize.apply(this,arguments),this._attachAccEvents(),this.loadScreen("miscellaneous-screen"),this.binTileContextMenuFirstId.push(this.idPrefix+"bin-tiles-context-menu-0")},render:function(){b.EquationManagerProAcc.__super__.render.apply(this,arguments),this._updateTileArray(),this._generateAccScreen(),this.loadScreen("equation-manager-acc-screen"),this._enableDisableTabOnBinTiles(!1),this._createFocusDivs(),this._bindKeyDownOnExpressions(),this.attachLhsContFocusIn(),this._createBinTilesContextMenu(),this._createTermTilesContextMenu(),this._setTermTileContextMenuAllIds(),this.ignoreChangeSignForTextTile===!0&&this._ignoreBinTileSignChangeRow(!0)},attachAccEvents:function(){this._attachAccEvents()},_getAllLeafViews:function(a){for(var b=c.EquationManagerPro.Utils.getAllLeaves(a,!0),d=b.length,e=[],f=0;d>f;f++)"object"==typeof b[f].data?e.push(this.equationView.getViewFromNode(b[f])):(e.push(".parentheses-exponent"),this.exponentParenthesisView=this.equationView.getViewFromNode(b[f].parent));return e},_getPointForDummyMarquee:function(a){for(var b=a.length,c={},d=null,e=[],f=0;b>f;f++)e.push(this.equationView.getViewFromNode(a[f]));return d=e[0].el.getBoundingClientRect(),c.top=d.top,c.left=d.left,d=e[e.length-1].el.getBoundingClientRect(),c.bottom=d.bottom,c.right=d.right,c},_updateTileArray:function(a,b){this.leftTileArray=[],this.rightTileArray=[],this.leftTileArray=a?a:this._getAllLeafViews(this.root.children[0]),b||(this.rightTileArray=a?a:this._getAllLeafViews(this.root.children[1]))},_generateAccScreen:function(){var a={id:"equation-manager-acc-screen",name:"equation-manager-acc-screen"},b=this.$binTileContainment?this._getAccId(this.$binTileContainment):"",c=null,d=this.tabIndex+20,e=this.accDivOffset,f=null,g=null,h=null,i=0,j=[],k=[],l=null,m=this.equationView;if(""!==b){l=this.getAccMessage("bin-section-text",0),j.push(this._createElementObj(b,d,l)),k.push(b),c=this.$binTileContainment.find(".bin-tiles"),i=c.length,this.firstTileAccId=this._getAccId($(c[0]));for(var n=0;i>n;n++)d+=5,b=this._getAccId($(c[n])),j.push(this._createElementObj(b,d,$(c[n]).data("tilevalue"))),k.push(b)}this.onlyLHS||(b=this._getAccId(this.$equationCOntainer),k.push(b),d+=10,l=this.getAccMessage("equation-reading-text",0),f=this._createElementObj(b,d,l,e),j.push(f)),g=this.$el.find(".lhs-expression-view"),l=m.tileViews[0].getAccString(),l=this._handleTSEmptySlot(l),b=g?this._getAccId(g):"",k.push(b),""!==b&&(d+=20,l=this.onlyLHS===!0?this.getAccMessage("equation-reading-text",7,[l]):this.getAccMessage("equation-reading-text",2,[this.getAccMessage("equation-reading-text",4),l]),f=this._createElementObj(b,d,l,e),j.push(f)),m.tileViews[1]&&(l=m.tileViews[1].getAccString()),h=this.$el.find(".rhs-expression-view"),b=h?this._getAccId(h):"",k.push(b),""!==b&&(d+=100,l=this.getAccMessage("equation-reading-text",2,[this.getAccMessage("equation-reading-text",5),l]),f=this._createElementObj(b,d,l,e),j.push(f)),a.elements=j,this.manager.model.parse([a]),this.allElemIds=k},_handleTSEmptySlot:function(a){var b=this.$el.find(".lhs-expression-view"),c=null,d=null;return b.find(".drop-t-case-empty").length>0&&(c=a.indexOf(this.getAccMessage("operators-text",2)),d={isLHS:!0,operator:"*"},a=a.substr(0,c)+this._getDummyEmptySlotAccString(d)+" "+a.substr(c)),a},_getDummyEmptySlotAccString:function(a,b){var c="",d=a.operator;a.isLHS;if(!b)switch(d){case"*":c+=this.getAccMessage("operators-text",0);break;case"+":c+=this.getAccMessage("operators-text",1);break;case"/":c+=this.getAccMessage("operators-text",2);break;default:c+=""}return c+=" "+this.getAccMessage("prefixed-statements",13)},updateFocusRectOfSpecificElem:function(a){this.updateFocusRect(a)},updatefocusrectOfAllElems:function(){for(var a=0,b=this.allElemIds,c=b.length;c>a;a++)this.updateFocusRectOfSpecificElem(b[a])},_bindKeyDownOnExpressions:function(){var a=this.$el.find(".lhs-expression-view"),b=this.$el.find(".rhs-expression-view"),c=this;a.length>0&&(a.off(".acc").on("keydown.acc",$.proxy(this._keydownHandler,this,!0)).on("keyup.acc",$.proxy(this._keyupHandler,this,!0)),this.focusOut("lhs-expression-view",function(){c.removeHighlightTilesImmediate()})),b.length>0&&(b.off(".acc").on("keydown.acc",$.proxy(this._keydownHandler,this,!1)).on("keyup.acc",$.proxy(this._keyupHandler,this,!1)),this.focusOut("rhs-expression-view",function(){c.removeHighlightTilesImmediate()})),this.focusOut("workspace-expression-area-equation-view",function(){c.removeHighlightTilesImmediate()})},_createFocusDivs:function(){var a=$("<div>",{"class":"lhs-focus-div dummy-acc-focus-div"}),b=$("<div>",{"class":"rhs-focus-div dummy-acc-focus-div"});a.css(c.EquationManagerPro.FOCUS_DIV_STYLE),b.css(c.EquationManagerPro.FOCUS_DIV_STYLE),this.$el.find(".lhs-expression-view-holder").append(a),this.$el.find(".rhs-expression-view-holder").append(b),this.lhsFocusDiv=a,this.rhsFocusDiv=b,a.hide(),b.hide()},setTreeRoot:function(){b.EquationManagerProAcc.__super__.setTreeRoot.apply(this,arguments),this._updateTileArray(),this.trigger(b.EquationManagerPro.EVENTS.TREE_ROOT_SET,this.equationView.getAccString())},_keyupHandler:function(a,c){var d=b.EquationManagerPro.KEY,e=c.keyCode?c.keyCode:c.charCode;switch(e){case d.LEFTARROW:case d.RIGHTARROW:this.getFirstTileDrop()!==!0||this.onlyLHS||this._setDropSlotsForBinTiles()}},_keydownHandler:function(a,c){var d=b.EquationManagerPro.KEY,e=this.$el.find(".lhs-expression-view"),f=this.$el.find(".rhs-expression-view"),g=c.keyCode?c.keyCode:c.charCode;switch(g){case d.LEFTARROW:this._handleResizeOfContainer(!0,c);break;case d.RIGHTARROW:this._handleResizeOfContainer(!1,c);break;case d.SPACE:this.stopReading(),this.removeHighlightTilesImmediate(),$(c.target).hasClass("dummy-acc-focus-div")||(this._updateTileArray(),this._bindKeyDownOnFocusDiv(a?this.lhsFocusDiv:this.rhsFocusDiv,a),this.lastTabIndex=this.getTabIndex(a?this._getAccId(e):this._getAccId(f)),this._goToNextTile(a,c))}},_handleResizeOfContainer:function(a,b){var c=this.$el.find(".equals-sign-container"),d=$(".equals-sign-container").is(":visible"),e={},f=this.$el.find(".drag-handle-containment"),g=10,h=b.target.id.indexOf("lhs")>-1,i=d?f.position().left+g:400,j=d?i+f.width()-c.width()-g:400;if(d){if(b.stopPropagation(),b.preventDefault(),e.helper=c,e.position=c.position(),a){if(e.position.left<i)return void this._setResizeAccText({isLHSFocused:h,leftKeyPressed:a,limitReached:!0});e.position.left-=g}else{if(e.position.left>j)return void this._setResizeAccText({isLHSFocused:h,leftKeyPressed:a,limitReached:!0});e.position.left+=g}this._handleDragHandler(b,e),a?c.css({left:c.position().left-g}):c.css({left:c.position().left+g}),this._setResizeAccText({isLHSFocused:h,leftKeyPressed:a,limitReached:!1}),this.updateFocusRect(this._getAccId(this.$lhsExprView)),this.updateFocusRect(this._getAccId(this.$rhsExprView)),this.getFirstTileDrop()===!0&&this._setDropSlotsForBinTiles()}},_setResizeAccText:function(a){var b,c,d,e=a.isLHSFocused,f=a.leftKeyPressed,g=a.limitReached;e?(b=this._getAccId(this.$lhsExprView),d=this.getAccMessage("equation-reading-text",4),c=f?g?this.getAccMessage("equation-reading-text",18):this.getAccMessage("equation-reading-text",16,[d]):g?this.getAccMessage("equation-reading-text",17):this.getAccMessage("equation-reading-text",15,[d])):(b=this._getAccId(this.$rhsExprView),d=this.getAccMessage("equation-reading-text",5),c=f?g?this.getAccMessage("equation-reading-text",17):this.getAccMessage("equation-reading-text",15,[d]):g?this.getAccMessage("equation-reading-text",18):this.getAccMessage("equation-reading-text",16,[d])),c===this.prevAccText&&""!==c?this.prevAccText=c+" ":this.prevAccText=c,this.setAccMessage(b,this.prevAccText),this.setFocus(this._getAccId(this.$equationCOntainer)),this.setFocus(b),e?this._setLHSAccText():this._setRHSAccText()},_bindKeyDownOnFocusDiv:function(a,b){$(a).off("keydown.focusDiv").on("keydown.focusDiv",$.proxy(this._keyDownOnFocusDiv,this,b)),$(a).off("keyup.focusDiv").on("keyup.focusDiv",$.proxy(this._keyUpOnFocusDiv,this,b))},_keyDownOnFocusDiv:function(a,c){var d=b.EquationManagerPro.KEY;switch(c.which){case d.LEFTARROW:case d.RIGHTARROW:c.stopPropagation(),c.preventDefault(),this.$selectedTile||this.handleMarqueeAcc(c,a);break;case d.ESCAPE:this._handleEscapeOnFocusDiv(a),this.isIgnoreCombine=!1;break;case d.TAB:this.stopReading(),this.removeHighlightTilesImmediate(),this._goToNextTile(a,c);break;case d.SPACE:c.shiftKey||(this.stopReading(),this.removeHighlightTilesImmediate(),this._handleSpaceOnFocusDiv(a,c))}},_keyUpOnFocusDiv:function(a,c){var d=b.EquationManagerPro.KEY;switch(c.which){case d.SPACE:this.stopReading(),this.removeHighlightTilesImmediate(),this.isSpaceKeyDown=!1}},_handleSpaceOnFocusDiv:function(a,b){var d,e=a?this.leftTileArray[this.leftTileIndex]:this.rightTileArray[this.rightTileIndex],f=null,g=null,h=null;this.isSpaceKeyDown||(b&&(b.stopPropagation(),b.preventDefault()),this.isSpaceKeyDown=!0,this.$selectedTile?(this.$selectedTile.model&&this.$selectedTile.model.get("type")!==c.TileItem.TileType.BIN_TILE?(this._handleTileDropInExpression(b,a),this._updateTileArray()):(null===this.getTileAddedInExpression()?this._droppedTileFromBin(b,e,a):(d={target:this.$selectedTile,tilevalue:isNaN(+this.$selectedTile.attr("data-tilevalue"))?this.$selectedTile.attr("data-tilevalue"):+this.$selectedTile.attr("data-tilevalue"),"cur-draggable":this.$selectedTile,tiletype:c.TileItem.TileType.BIN_TILE},e.onTileDrop(b,null,d)),h={binTileDrop:!0,left:a}),this._setFocus(h),this._resetParametersOnFocusOutOfLastElement(),this.$selectedTile=null,this.prevTileIndex=-1):(f=this.marqueeSelectedItems.length>0?this.marqueeSelectedItems[0]:a?this.leftTileArray[this.leftTileIndex]:this.rightTileArray[this.rightTileIndex],g=f instanceof Backbone.View?f.$el:$(f),this.fullExpressionSelected&&this.onlyLHS?this.isSpaceKeyDown=!1:(g.is(".ui-draggable")||this.marqueeSelectedItems.length>0)&&(this.$selectedTile=f,this.prevTileIndex=a?this.leftTileIndex:this.rightTileIndex,this._bindKeyDownOnFocusDiv(b.currentTarget,a),this.lastTabIndex=this.getTabIndex(a?this._getAccId(this.$lhsExprView):this._getAccId(this.$rhsExprView)),this.leftTileIndex=-1,this.rightTileIndex=-1,this.$binTileContainment?(this.isCircularModeOn=!0,a?this.rightTileArray.unshift(".null-operator-container"):this.leftTileArray.unshift(".null-operator-container")):this.isCircularModeOn=!1,this._goToNextTile(a,b))))},_handleEscapeOnFocusDiv:function(a){var b=-1!==this.prevTileIndex?this.prevTileIndex:a?this.leftTileIndex:this.rightTileIndex,d=null,e=null,f=null;this.marqueeNodes.length>0?-1!==this.prevTileIndex?(this._handleFocusOutOnFocusDiv(a),d=0===this.marqueeNodes[0].getPath()[0],d?this.leftTileIndex=this.prevTileIndex:this.rightTileIndex=this.prevTileIndex,this.$selectedTile=null,this._setPositionOfFocusDiv(this.getMarqueeDiv(d),d)):(this.removeMarquee(),this._setPositionOfFocusDiv(a?this.leftTileArray[b].$el:this.rightTileArray[b].$el,a)):(this._handleFocusOutOnFocusDiv(a),this.$selectedTile?(f=this.$selectedTile instanceof Backbone.View?this.$selectedTile.$el:this.$selectedTile,f.data("tiletype")!==c.TileItem.TileType.BIN_TILE?(e=f.parents(".lhs-expression-view").length>0,e?this.leftTileIndex=this.prevTileIndex:this.rightTileIndex=this.prevTileIndex,this.$selectedTile=null,this._setPositionOfFocusDiv(e?this.leftTileArray[b].$el:this.rightTileArray[b].$el,e)):this._handleBinTileFocus(a,event,f)):(this._setFocusOnExpression(a),this._resetParametersOnFocusOutOfLastElement())),this.isCircularModeOn=!1,this.$selectedTile=null,this.prevTileIndex=-1,this._showHideDropslots(this.equationView.$el,!1),this._updateTileArray()},_handleTileDropInExpression:function(a,b){var c=b?this.leftTileArray[this.leftTileIndex]:this.rightTileArray[this.rightTileIndex],d=b?this.equationView.tileViews[0]:this.equationView.tileViews[1],e=(this.$selectedTile,null);".parentheses-exponent"!==c&&("string"==typeof c?(e={target:d.$el.find(c),tilevalue:this.$selectedTile.model.get("base"),"cur-draggable":this.$selectedTile,length:this.marqueeSelectedItems.length},d.onDropOperator(a,null,e)):(e={tilevalue:this.$selectedTile.model.get("base"),"cur-draggable":this.$selectedTile,length:this.marqueeSelectedItems.length},c.onTileDrop(a,null,e))),this._resetParametersOnFocusOutOfLastElement(),this.onlyLHS||this._setFocus()},_setFocus:function(a){a=a||{};var d,e,f,g=this.tooltipData,h=this.onlyLHS?this._getAccId(this.$lhsExprView):this._getAccId(this.$equationCOntainer),i=(this.equationView,null),j=c.TileItem.OPERATORS,k=this._getContainerText();g.isTooltipVisible||this.player.getModalPresent()?this._showHideDropslots(this.equationView.$el,!1):(this.isMarqueeStep||this.removeMarquee(),f=k,a.binTileDrop?(i=this.model.get("operationPerformed"),d=this._getTileText(this.$selectedTile).replace(this.getAccMessage("equation-reading-text",9),""),e=this.getAccMessage("equation-reading-text",a.left?4:5),f=i.operation===j.ADDITION?this.getAccMessage("prefixed-statements",7,[d,e,k]):i.isDenominator?this.getAccMessage("prefixed-statements",9,[e,d,k]):this.getAccMessage("prefixed-statements",8,[d,e,k])):a.resetClicked&&(f=this.getAccMessage("equation-reading-text",1,[k])),
this.setAccMessage(h,f),this._setLHSAccText(),this._setRHSAccText(),this.setFocus(h),this.trigger(b.EquationManagerPro.EVENTS.FOCUS_SET_LHS),(a.binTileDrop||a.resetClicked)&&this.setAccMessage(h,k))},_getContainerText:function(){var a=this.equationView.tileViews,b=null;return b=this._handleTSEmptySlot(a[0].getAccString()),a[1]&&(b+=this.getAccMessage("prefixed-statements",0)+a[1].getAccString()),b},_getAccId:function(a){return a&&a.attr("id")?a.attr("id").split(this.idPrefix)[1]:""},_setLHSAccText:function(){var a=this.equationView.tileViews[0].getAccString();a=this.onlyLHS===!0?this.getAccMessage("equation-reading-text",7,[a]):this.getAccMessage("equation-reading-text",4)+". "+a,this.setAccMessage(this._getAccId(this.$lhsExprView),this._handleTSEmptySlot(a))},_setRHSAccText:function(){var a,b=this.equationView;b.tileViews.length>1&&(a=b.tileViews[1].getAccString(),this.setAccMessage(this._getAccId(this.$rhsExprView),this.getAccMessage("equation-reading-text",5)+"."+a))},_setFocusOnExpression:function(a){this.setFocus(a||this.onlyLHS?this._getAccId(this.$lhsExprView):this._getAccId(this.$rhsExprView))},setFocusOnPreviousElement:function(a){var b=this.tooltipData,d=b.selectedTile,e=d instanceof Backbone.View?d.$el:d,f=b.lastIndex,g=null;this._resetParametersOnFocusOutOfLastElement(),d&&(this.isSpaceKeyDown=!1,e.data("tiletype")===c.TileItem.TileType.BIN_TILE?(this._enableDisableTabOnBinTiles(!0),this.setFocus(this._getAccId(d))):(e.parents(".lhs-expression-view").length>0?(this.leftTileIndex=f,g=!0):e.parents(".rhs-expression-view").length>0&&(this.rightTileIndex=f,g=!1),b.isMarquee?this._setPositionOfFocusDiv(this.getMarqueeDiv(g),g,{isMarquee:!0}):this._setPositionOfFocusDiv(e,g)),this.prevTileIndex=-1,this.$selectedTile=null,this.tooltipData={isTooltipVisible:!1})},enableDisableTabOnEquationContainer:function(a){this.enableTab(this._getAccId(this.$equationCOntainer),a)},enableDisableTabOnLHSContainer:function(a){this.enableTab(this._getAccId(this.$lhsExprView),a)},enableDisableTabOnRHSContainer:function(a){this.enableTab(this._getAccId(this.$rhsExprView),a)},enableDisableTabOnBinContainement:function(a){this.enableTab(this._getAccId(this.$binTileContainment),a)},enableDisableTabAllBinTiles:function(a){this._enableDisableTabOnBinTiles(a)},enableDisableBinTile:function(a,b){this.enableTab(this._getAccId(a),b)},enableDisableTabOnAllContainers:function(a){this.enableDisableTabOnEquationContainer(a),this.enableDisableTabOnLHSContainer(a),this.enableDisableTabOnRHSContainer(a),this.enableDisableTabOnBinContainement(a),this.enableDisableTabAllBinTiles(a)},_enableDisableTabOnBinTiles:function(a){if(this.$binTileContainment){var b=this.$binTileContainment.find(".bin-tiles"),c=null,d=b.length,e=!1;this.firstTileAccId=null;for(var f=0;d>f;f++)c=$(b[f]),a===!0&&c.hasClass("disable")===!1?(this.enableDisableBinTile(c,!0),e||(this.firstTileAccId=this._getAccId(c),e=!0)):this.enableDisableBinTile(c,!1)}},_droppedTileFromBin:function(a,b,d){var e=d?this.equationView.tileViews[0]:this.equationView.tileViews[1],f={target:e.$el.find(b),tilevalue:isNaN(+this.$selectedTile.attr("data-tilevalue"))?this.$selectedTile.attr("data-tilevalue"):+this.$selectedTile.attr("data-tilevalue"),tiletype:c.TileItem.TileType.BIN_TILE,"cur-draggable":this.$selectedTile};".null-operator-container"===b?e.onDropOperator(a,null,f):(".virtual-numerator"===b||b.indexOf(".virtual-denominator")||b.indexOf(".absolute-denominator"))&&e.onTileDrop(a,null,f)},_resetParametersOnFocusOutOfLastElement:function(){this.lhsFocusDiv.hide(),this.rhsFocusDiv.hide(),this.rightTileIndex=-1,this.leftTileIndex=-1,this.isCircularModeOn=!1,this.$selectedTile=null},_goToNextTile:function(a,d){var e,f=b.EquationManagerPro.KEY,g=null,h=null;if(this.$selectedTile||this.removeMarquee(),this._showHideDropslots(this.equationView.$el,!1),a){if(d&&d.shiftKey){do this.leftTileIndex--;while(this._checkLimit(a,!1))}else do this.leftTileIndex++;while(this._checkLimit(a,!0));this._getEndCondition(a,!0)&&(this.isCircularModeOn=!1),this.leftTileIndex>=0&&this.leftTileIndex<this.leftTileArray.length?(d&&(d.stopPropagation(),d.preventDefault()),h=this.leftTileArray[this.leftTileIndex],g="string"==typeof h?this.$lhsExprView.find(h):h.$el,this._currentFocusedElement(h,a),this._setPositionOfFocusDiv(g,a)):this._getEndCondition(a,!1)?(e=this.$selectedTile instanceof Backbone.View?this.$selectedTile.$el:this.$selectedTile,e.data("tiletype")!==c.TileItem.TileType.BIN_TILE?(d.stopPropagation(),d.preventDefault(),this._updateTileArray(),this.leftTileIndex=this.prevTileIndex,this.prevTileIndex=-1,this.rightTileIndex=-1,this.$selectedTile=null,this.isCircularModeOn=!1,this._goToNextTile(!0,d)):this._handleBinTileFocus(a,d)):this.fullExpressionSelected&&this.onlyLHS&&d.which===f.SPACE?this.$selectedTile=null:(this.isCircularModeOn||(d.shiftKey&&(d.stopPropagation(),d.preventDefault()),this.removeMarquee(),this.$selectedTile=null,this._updateTileArray(),-1!==this.prevTileIndex&&this.rightTileArray.length>0&&this.prevTileIndex!==this.rightTileArray.length-1?(d.stopPropagation(),d.preventDefault(),this.rightTileIndex=this.prevTileIndex,this.prevTileIndex=-1,this.leftTileIndex=-1,this.$selectedTile=null,this._goToNextTile(!1,d)):this._setFocusOnExpression(-1===this.prevTileIndex)),this._handleFocusOutOnFocusDiv(a),this.isCircularModeOn&&(e=this.$selectedTile instanceof Backbone.View?this.$selectedTile.$el:this.$selectedTile,d&&e.data("tiletype")!==c.TileItem.TileType.BIN_TILE&&(d.stopPropagation(),d.preventDefault()),this.rhsFocusDiv.show(),this._bindKeyDownOnFocusDiv(this.rhsFocusDiv,!1),this.rightTileIndex=d.shiftKey?this.rightTileArray.length:-1,this._goToNextTile(!1,d)))}else{if(d&&d.shiftKey){do this.rightTileIndex--;while(this._checkLimit(a,!1))}else do this.rightTileIndex++;while(this._checkLimit(a,!0));if(this._getEndCondition(a,!0)&&(this.isCircularModeOn=!1,e=this.$selectedTile instanceof Backbone.View?this.$selectedTile.$el:this.$selectedTile,e.data("tiletype")===c.TileItem.TileType.BIN_TILE))return this._handleBinTileFocus(a,d),this._resetParametersOnFocusOutOfLastElement(),void(this.$selectedTile=null);this.rightTileIndex>=0&&this.rightTileIndex<this.rightTileArray.length?(d&&(d.stopPropagation(),d.preventDefault()),h=this.rightTileArray[this.rightTileIndex],g="string"==typeof h?this.$rhsExprView.find(h):h.$el,this._currentFocusedElement(h,a),this._setPositionOfFocusDiv(g,a)):this._getEndCondition(a,!1)?(d.stopPropagation(),d.preventDefault(),this._updateTileArray(),this.rightTileIndex=this.prevTileIndex,this.prevTileIndex=-1,this.leftTileIndex=-1,this.$selectedTile=null,this.isCircularModeOn=!1,this._goToNextTile(!1,d)):(this.isCircularModeOn||(d.shiftKey&&(d.stopPropagation(),d.preventDefault()),this.removeMarquee(),this.$selectedTile=null,this._updateTileArray(),-1!==this.prevTileIndex&&this.leftTileArray.length>0&&this.prevTileIndex!==this.leftTileArray.length-1?(d.stopPropagation(),d.preventDefault(),this.leftTileIndex=this.prevTileIndex,this.prevTileIndex=-1,this.rightTileIndex=-1,this.$selectedTile=null,this._goToNextTile(!0,d)):this._setFocusOnExpression(-1!==this.prevTileIndex)),this._handleFocusOutOnFocusDiv(a),this.isCircularModeOn&&(e=this.$selectedTile instanceof Backbone.View?this.$selectedTile.$el:this.$selectedTile,d&&e.data("tiletype")!==c.TileItem.TileType.BIN_TILE&&(d.stopPropagation(),d.preventDefault()),this.lhsFocusDiv.show(),this._bindKeyDownOnFocusDiv(this.lhsFocusDiv,!0),this.leftTileIndex=d.shiftKey?this.leftTileArray.length:-1,this._goToNextTile(!0,d)))}},_handleBinTileFocus:function(a,b,d){var d=d||this._getNextPrevEnabledTile(a),e=-1;this._updateTileArray(),e=this.numericTileArray.indexOf(this.$selectedTile.data("tilevalue")),d.data("tiletype")!==c.TileItem.TileType.BIN_TILE?(this.enableTab(this._getAccId(this.$selectedTile),!0),this.setFocus(this._getAccId(this.$selectedTile))):(b.stopPropagation(),b.preventDefault(),this._enableDisableTabOnBinTiles(!0),this.setFocus(this._getAccId(d))),this._resetParametersOnFocusOutOfLastElement(),this.prevTileIndex=-1,this.$selectedTile=null},_getNextPrevEnabledTile:function(a){for(var b=this.$selectedTile;;)if(b=a?b.prev():b.next(),b.data("tiletype")!==c.TileItem.TileType.BIN_TILE||!b.hasClass("disable"))break;return b},_getEndCondition:function(a,b){var d=a?this.leftTileArray:this.rightTileArray,e=d.length,f=a?this.leftTileIndex:this.rightTileIndex,g=this.$selectedTile instanceof Backbone.View?this.$selectedTile.$el:this.$selectedTile,h=b===a?".rhs-expression-view":".lhs-expression-view";d[f];return(b?f===e:-1===f)&&g&&(g.parents(h).length>0||g.data("tiletype")===c.TileItem.TileType.BIN_TILE&&b!==a)},_checkLimit:function(a,b){var c=a?this.leftTileArray:this.rightTileArray,d=a?this.leftTileIndex:this.rightTileIndex,e=c[d];return(this._checkTileInsideMarquee(e)||this.$selectedTile===e||this.$selectedTile&&this.$selectedTile.model&&"PARENTHESES"===this.$selectedTile.model.get("type")&&".parentheses-exponent"===e)&&(b?d<c.length:d>=0)},_setPositionOfFocusDiv:function(a,b,c){c=c||{};var d,e,f=a.offset(),g=null,h=2,i={left:f.left-h+(a.hasClass("marquee-div")?1:0),top:f.top-h+(a.hasClass("marquee-div")?1:0)},j={width:a.width()+2*h,height:a.height()+2*h},k=b?this.lhsFocusDiv:this.rhsFocusDiv,l=b?this.getAccMessage("prefixed-statements",1):this.getAccMessage("prefixed-statements",2),m=(this._getTileText(a,b),this.marqueeSelectedItems.length),n=this._getMaxTermsPerSide(b);c.isMarquee?d=c.cannotExpand?this.getAccMessage("equation-reading-text",c.cannotExpand):this._getMarqueeAccText():this.onlyLHS&&!a.hasClass("parentheses-exponent")?d=this.leftTileArray[this.leftTileIndex].getAccString(!0):(this.isTutorialMode&&this.termTileContextMenuView.updateMaxItemCount(1),a.hasClass("operator-container")===!0?d=this.getAccMessage("prefixed-statements",3,[l]):a.hasClass("virtual-numerator")===!0?d=this.getAccMessage("prefixed-statements",4,[l]):a.hasClass("virtual-denominator")===!0||a.hasClass("absolute-denominator")===!0?d=this.getAccMessage("prefixed-statements",5,[l]):(e=this._getTileText(a),e.match(/\d+/g)||e.match(/\s+[x,t]$/g)||e.match(/^[x,t]\s+/g)||1===e.length?(g=this.isMarqueeStep&&!this.$selectedTile?this._getMarqueeAccText():this._getTileText(a),this.isTutorialMode?this.$selectedTile||(this.ignoreMultipleTermTileRows(!1,7),1==b?this.ignoreMultipleTermTileRows(!0,this.ignoreIndexForTutorial):this.ignoreMultipleTermTileRows(!0,this.ignoreIndexForTutorial)):e.match(/\d+/g)?(this.termTileContextMenuView.updateMaxItemCount(3),this.ignoreMultipleTermTileRows(!1,1)):(this.termTileContextMenuView.updateMaxItemCount(2),this.ignoreMultipleTermTileRows(!1,7),this.ignoreMultipleTermTileRows(!0,1)),d=this.onlyLHS?g:this.getAccMessage("equation-reading-text",11,[this.getAccMessage("equation-reading-text",b?4:5),g]),d=this._appendTutorialText(a,d,b)):d=this._getTileText(a,b))),a.hasClass("empty-dropslot")===!0||a.hasClass("ignore-marquee")===!0||this.$selectedTile?this._handleContextMenuOpenEvent(!1):this.isTutorialMode||this.isIgnoreCombine||e&&e.match(/\d+/g)&&(this.termTileContextMenuView.updateMaxItemCount(3),this._handleContextMenuOpenEvent(!0)),this.$selectedTile||(m>0?this.isTutorialMode===!0?(this.termTileContextMenuView.updateMaxItemCount(1),7===this.ignoreIndexForTutorial&&this.ignoreMultipleTermTileRows(!0,this.ignoreIndexForTutorial)):m===n?(this.termTileContextMenuView.updateMaxItemCount(1),this._ignoreCombineOption(b,!0)):(this.termTileContextMenuView.updateMaxItemCount(2),this.ignoreMultipleTermTileRows(!0,1)):a.hasClass("parentheses-exponent")===!0?(this._createContextMenuAgain(1),this.ignoreMultipleTermTileRows(!1,1),this.ignoreMultipleTermTileRows(!0,14)):this._createContextMenuAgain()),k.show(),k.offset({left:0,top:0}),k.offset(i),k.css(j),k.attr("tabindex",-1),this.prevTileAccText.trim()===d.trim()&&""!==d?this.prevTileAccText=d+". ":(this.prevTileAccText=d," "===this.prevTileAccText.charAt(0)&&(this.prevTileAccText=this.prevTileAccText.substring(1))),k.text(this.prevTileAccText),this.player._refreshDOM(),this.onlyLHS?(this.setFocus("practice-lhs-expression-view"),this.setFocus("lhs-expression-view")):this.setFocus(this._getAccId(this.$equationCOntainer)),k[0].focus()},_appendTutorialText:function(a,b,c){return b},_getTileText:function(a,b){var c=a.attr("data-tilevalue")||a.text().trim(),d="",e=this.getAccMessage("comm19",0)+" ";return this.$selectedTile&&(d=" "+this.getAccMessage("equation-reading-text",9)),"string"==typeof c&&(""===c?(c=this.getAccMessage("prefixed-statements",6,[this.getAccMessage("equation-reading-text",b?4:5)])+" ",this.$selectedTile||(d=" "+this.getAccMessage("equation-reading-text",8))):"0"===c?this.$selectedTile||a.is(".ui-draggable")||(d=" "+this.getAccMessage("equation-reading-text",8)):-1!==c.indexOf("−")?c.replace("−",e):-1!==c.indexOf("-")?c.replace("-",e):a.hasClass("parentheses-exponent")&&(c=this.getAccMessage("exponent-text",0)+c,d=" "+this.getAccMessage("equation-reading-text",19))),c+d},_currentFocusedElement:function(a,b){if("string"==typeof a){var c=b?this.equationView.tileViews[0].$el:this.equationView.tileViews[1].$el;".null-operator-container"===a?(this._showHideDropslots(this.equationView.$el,!1),c.find(a).find(".insertion-cursor, .add-sign-in-null-operator").show()):".virtual-numerator"===a?this._showHideDropslots(c,!0,!0):(a.indexOf(".virtual-denominator")||a.indexOf(".absolute-denominator"))&&this._showHideDropslots(c,!0,!1)}},_handleFocusOutOnFocusDiv:function(a){a?(this.leftTileIndex=-1,this.lhsFocusDiv.hide()):(this.rightTileIndex=-1,this.rhsFocusDiv.hide())},_createElementObj:function(a,b,c,d){var e={type:"text",accId:a,id:a,tabIndex:b,messages:[{id:0,isAccTextSame:!1,message:{acc:c?c:"%@$%"}}]};return d&&(e.offsetTop=d.offsetTop,e.offsetLeft=d.offsetLeft),e},handleMarqueeAcc:function(a,c){var d=b.EquationManagerPro.KEY;switch(a.which){case d.LEFTARROW:a.shiftKey&&this._expandMarqueeToLeft(c);break;case d.RIGHTARROW:a.shiftKey&&this._expandMarqueeToRight(c)}},_expandMarqueeToRight:function(a){var b,d,e,f,g,h=$.extend(!0,[],this.marqueeNodes),i=this.marqueeNodes,j=i.length,k=c.TileItem.OPERATORS;if(0===j)this._addTileToEmptyMarquee(a);else{for(e=i[j-1],f=e.next(),g=e.parent;null===f&&g.data!==k.EQUAL;){if(0!==_.difference(this._getMarqueeSelectableNodesArrayFromNode(g),i).length){g.parent.data!==k.EQUAL&&(i=_.difference(i,this._getMarqueeSelectableNodesArrayFromNode(g,!1,!0)),g.parent.data===k.PARENTHESES&&(g=g.parent),Array.prototype.push.apply(i,this._getMarqueeSelectableNodesArrayFromNode(g)));break}if(g.parent.data===k.EQUAL)break;f=g.next(),g=g.parent}null!==f&&e.parent.data!==k.EQUAL&&(Array.prototype.push.apply(i,this._getMarqueeSelectableNodesArrayFromNode(f)),0===_.difference(this._getMarqueeSelectableNodesArrayFromNode(g),i).length?(i=_.difference(i,this._getMarqueeSelectableNodesArrayFromNode(g)),g.parent.data===k.PARENTHESES&&(g=g.parent),Array.prototype.push.apply(i,this._getMarqueeSelectableNodesArrayFromNode(g))):g.data===k.DIVISION&&this._isWholeFractionToBeSelected(i,g)&&(i=_.difference(i,this._getMarqueeSelectableNodesArrayFromNode(g.children[0])),i=_.difference(i,this._getMarqueeSelectableNodesArrayFromNode(g.children[1])),g.parent.data===k.PARENTHESES&&(g=g.parent),Array.prototype.push.apply(i,this._getMarqueeSelectableNodesArrayFromNode(g)))),this.marqueeNodes=i}this.marqueeNodes.length>0&&(this._redrawMarquee(a),d=this._compareNodesArraysEquality(i,this._getMarqueeSelectableNodesArrayFromNode(this.root.children[a?0:1])),d?(this._ignoreCombineOption(a,!0),this.termTileContextMenuView.updateMaxItemCount(1)):(this._ignoreCombineOption(a,!1),this.termTileContextMenuView.updateMaxItemCount(3)),this._compareNodesArraysEquality(i,h)&&(b=13,d&&(b=14)),this.fullExpressionSelected=d,this._setPositionOfFocusDiv(this.getMarqueeDiv(a),a,{isMarquee:!0,cannotExpand:b}),this._scrollToShowMarquee(a))},_expandMarqueeToLeft:function(a){var b,d,e,f,g,h=$.extend(!0,[],this.marqueeNodes),i=this.marqueeNodes,j=i.length,k=c.TileItem.OPERATORS;if(0===j)this._addTileToEmptyMarquee(a);else{for(e=i[0],f=e.prev(),g=e.parent;null===f&&g.data!==k.EQUAL;){if(0!==_.difference(this._getMarqueeSelectableNodesArrayFromNode(g,!0),i).length){g.parent.data!==k.EQUAL&&(i=_.difference(i,this._getMarqueeSelectableNodesArrayFromNode(g,!0,!0)),g.parent.data===k.PARENTHESES&&(g=g.parent),Array.prototype.unshift.apply(i,this._getMarqueeSelectableNodesArrayFromNode(g,!0).reverse()));break}if(g.parent.data===k.EQUAL)break;f=g.prev(),g=g.parent}null!==f&&e.parent.data!==k.EQUAL&&(Array.prototype.unshift.apply(i,this._getMarqueeSelectableNodesArrayFromNode(f,!0).reverse()),0===_.difference(this._getMarqueeSelectableNodesArrayFromNode(g,!0),i).length?(i=_.difference(i,this._getMarqueeSelectableNodesArrayFromNode(g,!0)),g.parent.data===k.PARENTHESES&&(g=g.parent),Array.prototype.unshift.apply(i,this._getMarqueeSelectableNodesArrayFromNode(g,!0).reverse())):g.data===k.DIVISION&&this._isWholeFractionToBeSelected(i,g)&&(i=_.difference(i,this._getMarqueeSelectableNodesArrayFromNode(g.children[0])),i=_.difference(i,this._getMarqueeSelectableNodesArrayFromNode(g.children[1])),g.parent.data===k.PARENTHESES&&(g=g.parent),Array.prototype.unshift.apply(i,this._getMarqueeSelectableNodesArrayFromNode(g,!0).reverse()))),this.marqueeNodes=i}this.marqueeNodes.length>0&&(this._redrawMarquee(a),d=this._compareNodesArraysEquality(i,this._getMarqueeSelectableNodesArrayFromNode(this.root.children[a?0:1])),d?(this._ignoreCombineOption(a,!0),this.termTileContextMenuView.updateMaxItemCount(1)):(this._ignoreCombineOption(a,!1),this.termTileContextMenuView.updateMaxItemCount(3)),this._compareNodesArraysEquality(i,h)&&(b=12,d&&(b=14)),this.fullExpressionSelected=d,this._setPositionOfFocusDiv(this.getMarqueeDiv(a),a,{isMarquee:!0,cannotExpand:b}),this._scrollToShowMarquee(a))},_addTileToEmptyMarquee:function(a){var b;b=a?this.leftTileArray[this.leftTileIndex].model:this.rightTileArray[this.rightTileIndex].model,!b||0===b.get("base")&&b.get("isDraggable")===!1||this.marqueeNodes.push(b.get("treeNodeRef"))},_redrawMarquee:function(a){var c,d,e=this.marqueeViews[a?0:1],f=e.getMarqueeDiv(),g=$(f),h=a?this.$(".lhs-expression-view-holder"):this.$(".rhs-expression-view-holder"),i=this.marqueeNodes,j=i.length,k=[];for(this._showMarqueeSelectedItems(),this.$el.find("."+b.EquationManagerPro.TILE_CLASS).removeClass(b.EquationManagerPro.TILE_CLASS),c=0;j>c;c++)d=this.equationView.getViewFromNode(i[c]),d.$el.addClass(b.EquationManagerPro.TILE_CLASS),d.$el.find(".base-container").hasClass("disable")||k.push(d);e.drawMarqueeOn(k),this.marqueeSelectedItems=k,this.marqueeView=e,this.marqueeSelectedItems=this._validateMarqueeItems(this.marqueeSelectedItems,{clientX:10,marqueeStartX:0}),g.html(""),this._groupSelectedTileItems(g,h),this._hideMarqueeSelectedItems()},_getMarqueeAccText:function(){for(var a=this.marqueeSelectedItems,b="",c=0,a=this.marqueeSelectedItems,d=a.length,e=null;d>c;c++)e=0===c?!0:!1,b+=a[c].getAccString(e);return this.getAccMessage("equation-reading-text",6,[b])},_getMarqueeSelectableNodesArrayFromNode:function(a,b,d){var e,f=[],g=c.TileItem.OPERATORS,h=[g.ADDITION,g.MULTIPLICATION].indexOf(a.data)>-1,i=d&&a.data===g.DIVISION;if(h||i)for(e=0;e<a.children.length;e++)b?Array.prototype.unshift.apply(f,this._getMarqueeSelectableNodesArrayFromNode(a.children[e],b)):Array.prototype.push.apply(f,this._getMarqueeSelectableNodesArrayFromNode(a.children[e]));return(!h||i)&&(b?f.unshift(a):f.push(a)),f},_isWholeFractionToBeSelected:function(a,b){var c,d;return c=this._getMarqueeSelectableNodesArrayFromNode(b.children[0]),d=this._getMarqueeSelectableNodesArrayFromNode(b.children[1]),_.difference(c,a).length<c.length&&_.difference(d,a).length<d.length},_scrollToShowMarquee:function(a){var b,c,d,e,f,g,h,i,j,k;b=a===!1?this.$(".rhs-expression-view-holder"):this.$(".lhs-expression-view-holder"),f=this.getMarqueeDiv(a),g=f.offset().left,h=g+f.width(),d=b.offset().left,c=b.scrollLeft(),e=b.width(),i=0,j=0,k=13,d>g&&(i=c+g-d-k),h-d>e&&(j=c+h-e-d+k),0===i?j&&b.scrollLeft(j):j?b.scrollLeft(i>j?i:j):b.scrollLeft(i),f.css("z-index",0)},_compareNodesArraysEquality:function(a,b){var c,d,e,f=!0,g=[],h=[];if(d=a.length,e=b.length,d===e){for(c=0;d>c;c++)g.push(a[c].cid);for(c=0;e>c;c++)h.push(b[c].cid);f=_.isEqual(g,h)}else f=!1;return f},_getViewFromNode:function(){return node.collectionData||"string"!=typeof node.data?this.equationView.getViewFromIndex(this.equationView.model.getIndexFromItemModel(node.collectionData||node.data)):void 0},_attachAccEvents:function(){var a=this,b=null,c=null;this.$binTileContainment&&(c=this.$binTileContainment.find(".bin-tiles"),b=c.length-1,this.$binTileContainment.off("focusin.dm").on("focusin.dm",function(b){b.target.id.indexOf("container")>-1&&a._enableDisableTabOnBinTiles(!1)}),this.$binTileContainment.off("keyup.binTilesContainerKeyUp").on("keyup.binTilesContainerKeyUp",function(b,c){a._binTilecontainerKeyUpHandler(b,c)}),$(c[0]).off("keydown.firstBinTileKeyDown").on("keydown.firstBinTileKeyDown",function(b,c){a._firstBinTileKeyDownHandler(b,c)}),this.attachDetachKeyDownOnBinTile(c,!0))},attachDetachKeyDownOnBinTile:function(a,b){var c=this;a.off("keydown.binTilesKeyDown"),b&&a.on("keydown.binTilesKeyDown",function(a,b){c._binTilesKeyDownHandler(a,b)})},attachLhsContFocusIn:function(){var a=this;this.$lhsExprView.off("focusin.lhsContainerFocusIn").on("focusin.lhsContainerFocusIn",function(){a._enableDisableTabOnBinTiles(!1),a.isIgnoreCombine=!1}),this.$equationCOntainer.off("focusin.totalContainerFocusIn").on("focusin.totalContainerFocusIn",function(){a._enableDisableTabOnBinTiles(!1)}),this.$rhsExprView.off("focusin.rhsContainerFocusIn").on("focusin.rhsContainerFocusIn",function(){a.isIgnoreCombine=!1})},_binTilecontainerKeyUpHandler:function(a,c){var d=a.keyCode,e=b.EquationManagerPro.KEY;d===e.SPACE&&(this.stopReading(),this.removeHighlightTilesImmediate(),this._enableDisableTabOnBinTiles(!1),this._enableDisableTabOnBinTiles(!0),null!==this.firstTileAccId&&this.setFocus(this.firstTileAccId))},_firstBinTileKeyDownHandler:function(a,c){var d=a.keyCode?a.keyCode:a.charCode,e=b.EquationManagerPro.KEY,f=this.$binTileContainment.find(".bin-tiles").parent().attr("id").split(this.idPrefix)[1];d===e.TAB&&a.shiftKey===!0?(a.stopPropagation(),a.preventDefault(),this._enableDisableTabOnBinTiles(!1),this.removeHighlightTilesImmediate(),this.stopReading(),this.setFocus(f)):d===e.SPACE&&(a.stopPropagation(),a.preventDefault())},_binTilesKeyDownHandler:function(a,c){var d=a.keyCode,e=b.EquationManagerPro.KEY;switch(d){case e.SPACE:this.stopReading(),this.removeHighlightTilesImmediate(),this._handleSpaceOnBinTile(a);break;case e.ESCAPE:this._handleEscapeOnBinTile(a);case e.ENTER:a.preventDefault(),a.stopPropagation();break;case e.TAB:this.stopReading(),this.removeHighlightTilesImmediate()}},setEnableTabOnContainer:function(a){this.enableTabOnContainer=a},getEnableTabOnContainer:function(a){return this.enableTabOnContainer},_handleSpaceOnBinTile:function(a){var b=this.getTileAddedInExpression();a.stopPropagation(),a.preventDefault(),this.$selectedTile=$(a.currentTarget),null===b?(this.getFirstTileDrop()===!0?this._updateTileArray([".null-operator-container",".virtual-numerator",".virtual-denominator,.absolute-denominator"]):this._updateTileArray([".virtual-numerator"],!0),this._bindKeyDownOnFocusDiv(this.lhsFocusDiv,!0),this.lastTabIndex=this.getTabIndex(this._getAccId(this.$binTileContainment)),this.isCircularModeOn=!0,this._goToNextTile(!0)):(this.lastTabIndex=this.getTabIndex(this._getAccId(this.$binTileContainment)),b?(this.rightTileArray=[this.containsNullTile()],this.leftTileArray=[],this._bindKeyDownOnFocusDiv(this.rhsFocusDiv,!1),this.isCircularModeOn=!0,this._goToNextTile(!1)):(this.leftTileArray=[this.containsNullTile()],this.rightTileArray=[],this._bindKeyDownOnFocusDiv(this.lhsFocusDiv,!0),this.isCircularModeOn=!0,this._goToNextTile(!0)))},_handleEscapeOnBinTile:function(a){this.setFocus(this._getAccId(this.$binTileContainment)),this._enableDisableTabOnBinTiles(!1),this._resetParametersOnFocusOutOfLastElement(),this.prevTileIndex=-1,this.$selectedTile=null},_createBinTilesContextMenu:function(){if(this.$binTileContainment){var a,c=this,d=(this.model,b.DerivedContextMenu),e=d,f=e.CONTEXTMENU_SELECT,g=e.CONTEXTMENU_HIDE,h=e.CONTEXTMENU_OPEN,i=this.$binTileContainment.find(".bin-tiles"),j=7,k=this.isTutorialMode?1:7;a={el:this.player.$el,prefix:this.idPrefix,elements:[i],screenId:"bin-tiles-context-menu",contextMenuCount:j,maxItemCount:k,manager:this.manager,thisView:this},this.contextMenuView&&(this.contextMenuView=null),this.contextMenuView=e.initContextMenu(a),i.off(f).on(f,function(a,b){c._handleContextMenuSelect(a,b)}),i.off(g).on(g,function(a,b){c.setFocus(c._getAccId($(this)))}),i.off(h).on(h,function(a,b){c.setFocus("bin-tiles-context-menu-0")})}},_handleContextMenuSelect:function(a,b){var d=$(b.currentTarget).attr("id"),e=parseInt(d.split(this.idPrefix+"bin-tiles-context-menu-")[1]),f=a.currentTarget,g=$(a.currentTarget).attr("data-tilevalue"),g=isNaN(parseInt(g,10))?g:parseInt(g,10),h={fractionAdded:!1,index:null,isDenominator:!1,isLHS:null,operation:null,parenthesesAdded:!1,tileValue:g,tilesToAddInFraction:1},i=this.$lhsExprView.find(".lhs-expression-view-holder"),j=this.$rhsExprView.find(".rhs-expression-view-holder"),k={type:"drop",target:null},l={"cur-draggable":null,tiletype:c.TileItem.TileType.BIN_TILE,tilevalue:g,target:null},m=(this.getTileAddedInExpression(),this.containsNullTile()),n=m?m.parent.getIndex(m):"",o=this.model.get("operationPerformed");switch(this.setEnableTabOnContainer(!1),e){case 0:this._onBinTileClick(f),this.setFocus(this._getAccId($(f)));break;case 1:this.$selectedTile=$(f),k.target=i,l["cur-draggable"]=a.currentTarget,l.target=i.find(".operator-container.null-operator-container"),m&&"0"===n.split(".")[0]&&"+"===o.operation?m.onTileDrop(k,null,l):this.equationView.tileViews[0].onDropOperator(k,null,l),this._setFocus({binTileDrop:!0,left:!0});break;case 2:this.$selectedTile=$(f),h.isLHS=!0,k.target=i,l["cur-draggable"]=a.currentTarget,l.target=i.find(".virtual-numerator"),l.isDenominator=!1,m&&"0"===n.split(".")[0]&&"*"===o.operation&&o.isDenominator===!1?m.onTileDrop(k,null,l):this.equationView.tileViews[0].onTileDrop(k,null,l),this._setFocus({binTileDrop:!0,left:!0});break;case 3:this.$selectedTile=$(f),h.isLHS=!0,k.target=i,l["cur-draggable"]=a.currentTarget,l.target=i.find(".virtual-denominator, .absolute-denominator"),l.isDenominator=!0,m&&"0"===n.split(".")[0]&&"*"===o.operation&&o.isDenominator===!0?m.onTileDrop(k,null,l):this.equationView.tileViews[0].onTileDrop(k,null,l),this._setFocus({binTileDrop:!0,left:!0});break;case 4:this.$selectedTile=$(f),k.target=j,l["cur-draggable"]=a.currentTarget,l.target=j.find(".operator-container.null-operator-container"),m&&"1"===n.split(".")[0]&&"+"===o.operation?m.onTileDrop(k,null,l):this.equationView.tileViews[1].onDropOperator(k,null,l),this._setFocus({binTileDrop:!0,left:!1});break;case 5:this.$selectedTile=$(f),h.isLHS=!1,k.target=j,l["cur-draggable"]=a.currentTarget,l.target=j.find(".virtual-numerator"),l.isDenominator=!1,m&&"1"===n.split(".")[0]&&"*"===o.operation&&o.isDenominator===!1?m.onTileDrop(k,null,l):this.equationView.tileViews[1].onTileDrop(k,null,l),this._setFocus({binTileDrop:!0,left:!1});break;case 6:this.$selectedTile=$(f),h.isLHS=!1,k.target=j,l["cur-draggable"]=a.currentTarget,l.target=j.find(".virtual-denominator, .absolute-denominator"),l.isDenominator=!0,m&&"1"===n.split(".")[0]&&"*"===o.operation&&o.isDenominator===!0?m.onTileDrop(k,null,l):this.equationView.tileViews[1].onTileDrop(k,null,l),this._setFocus({binTileDrop:!0,left:!1})}this._resetParametersOnFocusOutOfLastElement()},_createTermTilesContextMenu:function(){var a,c=this,d=(this.model,b.DerivedContextMenu),e=d,f=e.CONTEXTMENU_SELECT,g=e.CONTEXTMENU_HIDE,h=e.CONTEXTMENU_OPEN,i=this.$equationCOntainer.find(".dummy-acc-focus-div"),j=3,k=this.isTutorialMode?1:2;a={el:this.player.$el,prefix:this.idPrefix,elements:[i],screenId:this.termTileContextMenuScreenId?this.termTileContextMenuScreenId:"term-tiles-context-menu",contextMenuCount:j,maxItemCount:k,manager:this.manager,thisView:this},this.termTileContextMenuView&&(this.termTileContextMenuView=null),this.termTileContextMenuView=e.initContextMenu(a),i.off(f).on(f,function(a,b){c._handleTermTileContextMenuSelect(a,b)}),i.off(g).on(g,function(a,b){var d=null,e=$(this),f=e.offset(),g=c.marqueeSelectedItems.length>0,h=2,i={left:f.left+h-(g?0:1),top:f.top+h-(g?0:1)},j={width:e.width()-2*h,height:e.height()-2*h};e.offset(i),e.css(j),$(this).hasClass("lhs-focus-div")===!0?(d=c.leftTileArray[c.leftTileIndex],g?c._setPositionOfFocusDiv(e,!0,{isMarquee:!0}):c._setPositionOfFocusDiv("string"==typeof d?c.$lhsExprView.find(d):d.$el,!0)):(d=c.rightTileArray[c.rightTileIndex],g?c._setPositionOfFocusDiv(e,!1,{isMarquee:!0}):c._setPositionOfFocusDiv("string"==typeof d?c.$rhsExprView.find(d):d.$el,!1))}),i.off(h).on(h,function(a,b){var d=c.player.$(".contextMenuHolder"),e=parseInt(d.css("height"));d.css("height",e+1),c.setFocus("term-tiles-context-menu-0")})},_handleTermTileContextMenuSelect:function(a,b){var c=$(b.currentTarget).attr("id"),d=parseInt(c.split(this.idPrefix+"term-tiles-context-menu-")[1]),e=a.currentTarget,f=null,g=null,h=null;switch($(e).hasClass("lhs-focus-div")===!0?(g=this.leftTileIndex,f=this.leftTileArray[g],h=!0):(g=this.rightTileIndex,f=this.rightTileArray[g],h=!1),d){case 0:this.$selectedTile=f,this.prevTileIndex=g,"string"!=typeof f?f._onBaseClick():this.onExponentClick(this.exponentParenthesisView),this._updateTileArray(),this._resetParametersOnFocusOutOfLastElement(),this._setFocus();break;case 1:h?this._handleSpaceOnFocusDiv(!0,a):(this._handleSpaceOnFocusDiv(!1,a),this._handleFocusOutOnFocusDiv(!1),this.leftTileIndex=-1,this.rightTileIndex=this.rightTileArray.length-1,this._goToNextTile(!0),this._bindKeyDownOnFocusDiv(this.lhsFocusDiv,!0)),this.isSpaceKeyDown=!1;break;case 2:h?(this._handleSpaceOnFocusDiv(!0,a),this._handleFocusOutOnFocusDiv(!0),this.leftTileIndex=this.leftTileArray.length-1,this.rightTileIndex=-1,this._goToNextTile(!1),this._bindKeyDownOnFocusDiv(this.rhsFocusDiv,!1)):this._handleSpaceOnFocusDiv(!1,a),this.isSpaceKeyDown=!1}},_handleContextMenuOpenEvent:function(b){this.$equationCOntainer.find(".dummy-acc-focus-div"),a.global.ContextMenu.CONTEXTMENU_OPEN;b===!0?this.termTileContextMenuView.editContextMenu(this.termTileContextMenuAllIds,!1):this.termTileContextMenuView.editContextMenu(this.termTileContextMenuAllIds,!0)},_setTermTileContextMenuAllIds:function(){var a=0,b=3,c=this.idPrefix;for(this.termTileContextMenuAllIds.length=0,this.termTileContextMenuFirstId.length=0,this.termTileContextMenuFirstId.push(c+"term-tiles-context-menu-0");b>a;a++)this.termTileContextMenuAllIds.push(c+"term-tiles-context-menu-"+a)},_ignoreBinTileSignChangeRow:function(a){a===!0?this.contextMenuView.editContextMenu(this.binTileContextMenuFirstId,!0):this.contextMenuView.editContextMenu(this.binTileContextMenuFirstId,!1)},ignoreMultipleBinTileRows:function(a,b){for(var c=0,d=Math.ceil(Math.log(b)/Math.log(2)),e=[],f=this.idPrefix+"bin-tiles-context-menu-";d>c;c++)b&Math.pow(2,c)&&e.push(f+c);a===!0?this.contextMenuView.editContextMenu(e,!0):this.contextMenuView.editContextMenu(e,!1)},ignoreMultipleTermTileRows:function(a,b){for(var c=0,d=Math.ceil(Math.log(b)/Math.log(2)),e=[],f=this.idPrefix+"term-tiles-context-menu-";d>=c;c++)b&Math.pow(2,c)&&e.push(f+c);a===!0?this.termTileContextMenuView.editContextMenu(e,!0):this.termTileContextMenuView.editContextMenu(e,!1)},_createContextMenuAgain:function(){},_ignoreCombineOption:function(a,b){a===!0?this.termTileContextMenuView.editContextMenu([this.idPrefix+"term-tiles-context-menu-0",this.idPrefix+"term-tiles-context-menu-1"],b):this.termTileContextMenuView.editContextMenu([this.idPrefix+"term-tiles-context-menu-0",this.idPrefix+"term-tiles-context-menu-2"],b),this.isIgnoreCombine=b},setTutorialIgnoreIndex:function(a){this.ignoreIndexForTutorial=a;
}},{})}(window.MathInteractives);