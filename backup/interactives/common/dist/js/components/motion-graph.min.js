!function(){MathInteractives.Common.Components.Models.MotionGraph=Backbone.Model.extend({defaults:{title:null,origin:null,xAxis:null,yAxis:null,plots:[],referencePlot:null,plotToRepaint:null,paintReferencePlotFlag:null,player:null,manager:null,idPrefix:null,path:null,MotionGraphClass:this,paintWithEndPoints:!1,showControlOnInit:!1,allowDrawing:!1,tickLength:0,repaintIndicator:0,canvasHeight:100,canvasWidth:100,xAxisStrokeColor:null,yAxisStrokeColor:null,xAxisStepSize:null,yAxisStepSize:null,verticalLineSize:null,horizontalLineSize:null,unitsPerStepsize:5,xUnitsPerStepsize:null,yUnitsPerStepsize:null,prependID:null,showControls:null,trashCanCustomPosition:null,hideRaster:!1,defaultVerticalLine:20,defaultHorizontalLine:30,stepValueColor:"#777777",hideControlButtons:!1,toolTipText:null,toolTipXOffset:null,toolTipYOffset:null,toolTipTextPrecision:null,toolTipBackGroundImageIds:null,xLabelDistFromAxis:null,yLabelDistFromAxis:null,yLabelVerticalOffset:null,characterStyle:null,showGridLines:!0,ignoreZero:!1},initialize:function(){var a=this.get("xUnitsPerStepsize"),b=null,c=this.get("yUnitsPerStepsize");this.setIDPrefix(this.get("idPrefix")+this.get("prependID")),this.get("showControls")&&this.set("showControls",this.get("showControls"));var d,e,f,g,h,i;e=this,d=this.get("plots").plots,f=this.get("title"),f?this.set("title",new MathInteractives.Common.Components.Models.MotionGraph.Title(f)):this.set("title",new MathInteractives.Common.Components.Models.MotionGraph.Title),g=this.get("xAxis"),g?this.set("xAxis",new MathInteractives.Common.Components.Models.MotionGraph.Axis(g)):(b=null!==a?a:this.get("unitsPerStepsize"),this.set("xAxis",new MathInteractives.Common.Components.Models.MotionGraph.Axis({stepSize:48,min:0,max:this.get("defaultHorizontalLine"),unitsPerStepSize:b}))),h=this.get("yAxis"),h?this.set("yAxis",new MathInteractives.Common.Components.Models.MotionGraph.Axis(h)):(b=null!==c?c:this.get("unitsPerStepsize"),this.set("yAxis",new MathInteractives.Common.Components.Models.MotionGraph.Axis({stepSize:48,min:0,max:this.get("defaultVerticalLine"),unitsPerStepSize:b}))),i=this.get("origin"),i?this.set("origin",new MathInteractives.Common.Components.Models.MotionGraph.Point(i)):this.set("origin",new MathInteractives.Common.Components.Models.MotionGraph.Point({x:0,y:0})),d=this.get("plots"),d=new MathInteractives.Common.Components.Models.MotionGraph.PlotLineCollection(d),this.set("plots",d),d.on("add",function(a){e.set("plotToRepaint",a)}),d.on("change",function(a){e.set("plotToRepaint",a)})},setIDPrefix:function(a){a&&this.set("idPrefix",a)},setReferencePlot:function(a){var b,c;c=this,b=this.get("referencePlot"),b&&b.paperPathObject&&(b.paperPathObject.remove(),b.get("points").off("add")),this.set("referencePlot",a),a&&a.get("points").on("add",function(b){c.get("paintReferencePlotFlag")&&c.set("plotToRepaint",a)}),this.get("paintReferencePlotFlag")&&this.set("plotToRepaint",this.get("referencePlot"))},setPaintReferencePlotFlag:function(a){var b;this.set("paintReferencePlotFlag",a),b=this.get("referencePlot"),a&&b&&this.set("plotToRepaint",b)},addPlot:function(a){var b=this;this.get("plots").add(a),a.get("points").on("add",function(c){b.set("plotToRepaint",a)})},clearGraph:function(){var a,b,c,d,e,f,g;for(b=this.get("plots"),c=b.length,f=0;c>f;f++){for(d=b.at(f).paperPathObject,b.at(f).paperEndPointCircleGroup.removeChildren(),a=d.segments.length,e=a-1;e>=0;e--)d.segments[e].remove();b.at(f).get("points").reset()}this.set("plotToRepaint",null),this.set("plots",new MathInteractives.Common.Components.Models.MotionGraph.PlotLineCollection),g=this.get("referencePlot"),g&&g.paperPathObject&&g.paperPathObject.remove(),g&&g.paperEndPointCircleGroup&&(g.paperEndPointCircleGroup.remove(),g.get("points").reset())},setOrigin:function(a){a=new MathInteractives.Common.Components.Models.MotionGraph.Point(a),this.set("origin",a)},getSnappedPoint:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return b={},m=this.get("xAxis"),n=this.get("yAxis"),e=m.get("stepSize"),f=n.get("stepSize"),g=m.get("max"),h=n.get("max"),k=m.get("unitsPerStepSize"),l=n.get("unitsPerStepSize"),i=this.get("origin"),j={},j.x=a.x-i.get("x"),j.y=i.get("y")-a.y,c=Math.round(j.x*(k/e)),d=Math.round(j.y*(l/f)),b.x=c*(e/k)+i.get("x"),b.y=i.get("y")-d*(f/l),b}},{Title:Backbone.Model.extend({defaults:{content:"Height over Time",fillColor:"#6F2AAC",justification:"center",fontSize:18}}),Axis:Backbone.Model.extend({defaults:{labelText:"Axis",labelColor:"#000000",labelJustification:"center",labelFontSize:15,stepSize:null,unitsPerStepSize:null,max:null}}),Point:Backbone.Model.extend({defaults:{x:0,y:0}}),PointCollection:Backbone.Collection.extend({model:this.Point,initialize:function(){this.model=MathInteractives.Common.Components.Models.MotionGraph.Point}}),PlotLine:Backbone.Model.extend({defaults:{points:null,strokeColor:"#22B14C",strokeWidth:1,lineType:null},initialize:function(){var a=this;a.set("points",new MathInteractives.Common.Components.Models.MotionGraph.PointCollection),a.set("lineType",MathInteractives.Common.Components.Models.MotionGraph.PlotLine.LINE_TYPES.CONTINUES_THIN_LINE)},addPoint:function(a){var b;b=new MathInteractives.Common.Components.Models.MotionGraph.Point(a),this.get("points").add(b)}},{LINE_TYPES:{CONTINUES_THIN_LINE:0,DASHED_THIN_LINE:1}}),PlotLineCollection:Backbone.Collection.extend({model:this.PlotLine,initialize:function(){this.model=MathInteractives.Common.Components.Models.MotionGraph.PlotLine,this.paperPathObject=null}})})}(),function(){"use strict";var a=null;a=MathInteractives.Common.Player.Views.Base.extend({manager:null,filePath:null,idPrefix:null,disabledBtnRaster:null,hoverBtnRaster:null,activeBtnRaster:null,allowLineDraw:!1,allowLineDrag:!1,myPaper:null,tool:null,myPath:null,currentGroup:null,xMaxBoundry:null,xMinBoundry:null,yMaxBoundry:null,yMinBoundry:null,allPaths:[],pathCount:0,pointToMove:null,endPointRadius:9,originalPoint:null,drawingColor:"#4c1787",drawingLineHoverColor:"#BC417E",drawingCircleColor:"#FFFFFF",hitAreaCircleRadius:11,drawingCircleStrokeColor:"#7C708C",staticCircleColor:"#00b9e6",staticCircleStrokeColor:"#00b9e6",lineWidth:5,invisibleLine:null,invisibleLineStrokeWidth:12,plotColor:"#00b9e6",gridLineThickness:1,gridLineColor:"#BBBBBB",axisLineThickness:1,axisLineColor:"#BBBBBB",axisLabelFontSize:16,startPoints:null,endPoints:null,clearAllBtn:null,drawLineBtnView:null,dragLineBtnView:null,userGraphBtnView:null,feedbackGraphBtnView:null,xMinGraph:null,xMaxGraph:null,yMinGraph:null,yMaxGraph:null,originX:null,originY:null,player:null,currentGridPosition:{},preventLongTap:!1,showControls:!1,toolTipText:null,xLabelDistFromAxis:29,yLabelDistFromAxis:22,yLabelVerticalOffset:5,toolTipXOffset:null,toolTipYOffset:null,toolTipBackGroundImageIds:null,initialize:function(){var a,b=this,c=null,d=null,e=null,f=null;c=b.$el,d=b.model,b.manager=d.get("manager"),b.filePath=d.get("path"),b.idPrefix=d.get("idPrefix"),b.toolTipText=d.get("toolTipText"),b.toolTipXOffset=d.get("toolTipXOffset"),b.toolTipYOffset=d.get("toolTipYOffset"),b.toolTipXOffset=null===b.toolTipXOffset||"undefined"==typeof b.toolTipXOffset?25:Number(b.toolTipXOffset),b.toolTipBackGroundImageIds=d.get("toolTipBackGroundImageIds"),b.xLabelDistFromAxis=d.get("xLabelDistFromAxis")||b.xLabelDistFromAxis,b.yLabelDistFromAxis=d.get("yLabelDistFromAxis")||b.yLabelDistFromAxis,b.yLabelVerticalOffset=d.get("yLabelVerticalOffset")||b.yLabelVerticalOffset,e=c.find("canvas"),this.myPaper=new paper.PaperScope,a=this.myPaper,a.setup(e[0]),a.activate(),f=this.tool=new a.Tool,f.view=this,MathInteractives.Common.Utilities.Models.BrowserCheck.isMobile?(f.onMouseDrag=$.proxy(this.manageMouseMovefeatures,b),f.onMouseUp=function(a){b.positionTooltip(a);var c=b.$("#"+b.idPrefix+"tooltip-container");c.hide(),b.fireEventOnMouseup(a)}):(f.onMouseMove=$.proxy(this.manageMouseMovefeatures,this),f.onMouseUp=$.proxy(this.fireEventOnMouseup,this)),this.setUpGraph(),this.model.on("change",this.repaint,this),this.model.get("showControls")&&(this.showControls=this.model.get("showControls")),this.render(),this.model.get("allowDrawing")&&this.allowLineDrawing(),this.player=d.get("player"),this.xMinGraph=d.get("xAxis").get("min"),this.xMaxGraph=d.get("xAxis").get("max"),this.yMinGraph=d.get("yAxis").get("min"),this.yMaxGraph=d.get("yAxis").get("max"),this.originX=d.get("origin").get("x"),this.originY=d.get("origin").get("y")},render:function(){this.repaint(),this.generateButtons(),this._renderTooltip(),this._hideTrashCanRaster(),this._hideControlButtons()},_renderTooltip:function(){var a='<div id="'+this.idPrefix+'tooltip-container" class="draggable-tooltip-container"><div id="'+this.idPrefix+'tooltip-left" class="draggable-tooltip-left"></div><div id="'+this.idPrefix+'tooltip-mid" class="draggable-tooltip-mid typography-body-text"></div><div id="'+this.idPrefix+'tooltip-right" class="draggable-tooltip-right"></div></div>';this.$el.find(".graph-it-graph-container-main-wrapper").append(a);var b=this.toolTipBackGroundImageIds;if("none"!==b){var c,d;d=b&&b.left?b.left:"tooltip-left",c=this.filePath.getImagePath(d),this.$(".draggable-tooltip-left").css({"background-image":'url("'+c+'")'}),d=b&&b.left?b.middle:"tooltip-middle",c=this.filePath.getImagePath(d),this.$(".draggable-tooltip-mid").css({"background-image":'url("'+c+'")'}),d=b&&b.left?b.right:"tooltip-right",c=this.filePath.getImagePath(d),this.$(".draggable-tooltip-right").css({"background-image":'url("'+c+'")'}),this.$(".draggable-tooltip-container").hide()}},fireEventOnMouseup:function(a){var b=this.$("#"+this.idPrefix+"tooltip-container");this.positionTooltip(a),(null!==b||"undefined"!==b)&&b.hide(),this.trigger(MathInteractives.Common.Components.Views.MotionGraph.CUSTOM_MOUSEUP_EVENT_FIRED,a,this.currentGridPosition)},_hideTrashCanRaster:function(){var a=this,b=a.model.get("hideRaster");b===!0&&(this.disabledBtnRaster.visible=!1,this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1)},_hideControlButtons:function(){this.model.get("hideControlButtons")&&this.$("#"+this.idPrefix+"graph-controls").hide()},generateButtons:function(){if(this.showControls!==!1&&0!==this.$el.find(".graph-controls").length){var a,b,c,d,e;this.$(".graph-controls").show(),a={id:this.idPrefix+"draw-line-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION_DRAW_LINE,path:this.filePath},this.drawLineBtnView=MathInteractives.global.Button.generateButton(a),this.$("#"+this.idPrefix+"draw-line-label").addClass("typography-label"),b={id:this.idPrefix+"move-line-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION_MOVE,path:this.filePath},this.dragLineBtnView=MathInteractives.global.Button.generateButton(b),this.$("#"+this.idPrefix+"move-line-label").addClass("typography-label"),this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),MathInteractives.global.Button.toggleButtonHandler({buttonObjects:[this.drawLineBtnView,this.dragLineBtnView]}),c={id:this.idPrefix+"users-graph-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION,toggleButton:!0,icon:{pathId:"users-graph-line",width:26,height:2},width:56,height:32,path:this.filePath},this.userGraphBtnView=MathInteractives.global.Button.generateButton(c),this.userGraphBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.$("#"+this.idPrefix+"users-graph-label").addClass("typography-body-text"),d={id:this.idPrefix+"feedback-graph-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION,toggleButton:!0,icon:{pathId:"feedback-graph-line",width:26,height:2},width:56,height:32,path:this.filePath},this.feedbackGraphBtnView=MathInteractives.global.Button.generateButton(d),this.feedbackGraphBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.$("#"+this.idPrefix+"feedback-graph-label").addClass("typography-body-text"),e={id:this.idPrefix+"clear-graph-btn",type:MathInteractives.Common.Components.Views.Button.TYPE.ACTION,path:this.filePath,text:"Clear All"},this.clearAllBtn=MathInteractives.global.Button.generateButton(e),this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED)}},events:{"click .draw-line-btn.click-enabled":"allowLineDrawing","click .move-line-btn.click-enabled":"allowLineDraging","click .users-graph-btn":"showHideUserDrawnGraph","click .feedback-graph-btn":"showHideFeedbackGraph","click .clear-graph-btn.click-enabled":"clearUserCreatedGraph"},setUpGraph:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,l={};for(v=this.myPaper,m=this.model,q=m.get("xAxis"),r=m.get("yAxis"),d=r.get("max"),e=q.get("max"),f=r.get("unitsPerStepSize"),g=q.get("unitsPerStepSize"),n=m.get("tickLength"),l.x=m.get("origin").get("x"),l.y=m.get("origin").get("y"),o=q.get("stepSize"),p=r.get("stepSize"),s=m.get("title"),t=q.get("unitsPerStepSize"),u=r.get("unitsPerStepSize"),w=m.get("verticalLineSize"),x=m.get("horizontalLineSize"),y=m.get("stepValueColor"),z=m.get("characterStyle"),A=m.get("showGridLines"),B=m.get("ignoreZero"),null===y&&(y="#777777"),this.axisLineColor=m.get("xAxisStrokeColor")||this.axisLineColor,this.gridLineColor=m.get("xAxisStrokeColor")||this.gridLineColor,null!==w?(j=w,d=w,p=m.get("yAxisStepSize"),r.set("stepSize",p)):j=p*d/f+n,null!==x?(k=x,e=x,o=m.get("xAxisStepSize"),q.set("stepSize",o)):k=o*e/g+n,a=0;e/g+1>a;a++)h=l.x+a*o,0===a?(b=new v.Path.Line({from:[h,l.y+n],to:[h,l.y+n-j]}),A===!0&&(b.strokeColor=this.axisLineColor,b.strokeWidth=this.axisLineThicknes)):(b=new v.Path.Line({from:[h,l.y+n],to:[h,l.y+n-j]}),A===!0&&(b.strokeColor=this.gridLineColor,b.strokeWidth=this.gridLineThickness)),c=new v.PointText(new v.Point(h,l.y+n+this.xLabelDistFromAxis)),c.style={fontFamily:"Arial, sans-serif",fontWeight:"bold",fontSize:16,fillColor:y},(null!==z||"undefined"!=typeof z)&&(c.characterStyle=z),c.content=(g*a).toString(),c.justification="center",B===!0&&0===a&&c.remove();for(a=0;d/f+1>a;a++)i=l.y-a*p,(i>10&&null!==w||null===w)&&(c=new v.PointText(new v.Point(l.x-n-this.yLabelDistFromAxis,i+this.yLabelVerticalOffset)),c.style={fontFamily:"Arial, sans-serif",fontWeight:"bold",fontSize:16,fillColor:y},(null!==z||"undefined"!=typeof z)&&(c.characterStyle=z),c.content=(f*a).toString(),c.justification="center",B===!0&&0===a&&c.remove()),0===a?(b=new v.Path.Line({from:[l.x-n,i],to:[k+l.x-n,i]}),A===!0&&(b.strokeColor=this.axisLineColor,b.strokeWidth=this.axisLineThicknes)):(b=new v.Path.Line({from:[l.x-n,i],to:[k+l.x-n,i]}),A===!0&&(b.strokeColor=this.gridLineColor,b.strokeWidth=this.gridLineThickness));this.trashCanRasters(m.get("trashCanCustomPosition")),this.showHideGraphControls(this.model.get("showControlOnInit")),this.xMaxBoundry=e*(o/t)+l.x,this.xMinBoundry=l.x,this.yMaxBoundry=l.y,this.yMinBoundry=l.y-d*(p/u)},allowLineDrawing:function(a){this.allowLineDraw=!0,this.allowLineDrag=!1,this.detachSegmentRelocateEvents(),this.attachDrawingEvents()},allowLineDraging:function(a){this.allowLineDraw=!1,this.allowLineDrag=!0,this.detachDrawingEvents(),this.attachSegmentRelocateEvents()},_isPathDisjoint:function(){var a=this.allPaths,b=a.length;if(0>=b)return!1;for(var c,d,e,f,g,h,i=new Array,j=new Array,k=0;b>k;k++)c=a[k].children[0],d=c.segments.length,e=c.segments[0],f=c.segments[d-1],g=this._getPointFromLogicalCoordinate({x:e.point.x,y:e.point.y}).attributes,h=this._getPointFromLogicalCoordinate({x:f.point.x,y:f.point.y}).attributes,i.push({x:Math.round(Number(g.x)),y:Math.round(Number(g.y))}),j.push({x:Math.round(Number(h.x)),y:Math.round(Number(h.y))});this.startPoints=i,this.endPoints=j;var l=this._bubbleSortArray(i,j);i=l[0],j=l[1];for(var m=0;b-1>m;m++)if(j[m].x!==i[m+1].x||j[m].y!==i[m+1].y)return!0;return!1},_bubbleSortArray:function(a,b){for(var c,d=a.length,e=0;d-1>e;e++)for(var f=e+1;d>f;f++)a[f].x<a[e].x&&(c=a[e],a[e]=a[f],a[f]=c,c=b[e],b[e]=b[f],b[f]=c);return[a,b]},_arePointsDrawnCorrect:function(){var a=this.model.get("referencePlot");if(!a||!this.startPoints||!this.endPoints)return!1;var b=a.get("points").toJSON(),c=b.length;if(0>=c)return!1;var d=this.startPoints;d.push(this.endPoints[this.endPoints.length-1]);for(var e=0;c>e;e++)if(b[e].x!==d[e].x||b[e].y!==d[e].y)return!1;return!0},arePointsCorrect:function(){return!this._isPathDisjoint()&&this._arePointsDrawnCorrect()?!0:(this.startPoints=null,this.endPoints=null,!1)},showHideLineEndPoints:function(a){var b,c,d,e,f,g,h,i,j;for(j=this.myPaper,b=a?this.endPointRadius:0,c=this.allPaths,d=this.allPaths.length,e=0;d>e;e++)g=c[e],f=c[e].children[0],h=g.children[1],a?h.scale(100):h.scale(.01),i=g.children[2],a?i.scale(100):i.scale(.01)},attachDrawingEvents:function(){var a=this.tool;a.onMouseUp=null,a.onMouseDown=this.startLine,a.onMouseDrag=$.proxy(this.drawLineOnDrag,this),a.onMouseUp=$.proxy(this.endLine,this),a.onDoubleClick=this.doubleClickOnLine},detachDrawingEvents:function(){var a=this.tool,b=this;a.onMouseUp=null,a.onMouseDown=null,a.onMouseDrag=null,a.onMouseUp=function(){var a=b.$("#"+b.idPrefix+"tooltip-container");a.hide()}},doubleClickOnLine:function(a){},startLine:function(a){var b,c,d,e,f,g=this.view;if(!g.preventLongTap){if(g.preventLongTap=!0,f=g.myPaper,d=g.isValidPoint(a.point),e=g.endPointRadius,!d)return void(g.preventLongTap=!1);if(g.allowLineDraw&&!g.allowLineDrag){c=g.model.getSnappedPoint(a.point),b=new f.Point(c.x,c.y),g.currentGroup=new f.Group,g.myPath=new f.Path,g.myPath.add(b),g.myPath.strokeColor=g.drawingColor,g.myPath.strokeWidth=g.lineWidth,g.myPath.strokeCap="round",g.myPath.strokeJoin="bevel",g.myPath.shadowColor=new f.Color(0,0,0),g.myPath.shadowColor.alpha=.68,g.myPath.shadowBlur=3,g.myPath.shadowOffset=new f.Point(2,2);var h=new f.Path.Circle(b,e);h.fillColor={gradient:{stops:[["#ffffff",0],["#cec8d8",1]],radial:!1},origin:{x:h.position._x,y:h.position._y-e},destination:{x:h.position._x,y:h.position._y+e}},h.strokeColor=g.drawingCircleStrokeColor,h.shadowColor=new f.Color(0,0,0),h.shadowBlur=3,h.shadowOffset=new f.Point(2,1),g.invisibleLine=new f.Path,g.invisibleLine.add(b),g.invisibleLine.strokeColor="green",g.invisibleLine.strokeWidth=g.invisibleLineStrokeWidth,g.invisibleLine.strokeCap="round",g.invisibleLine.strokeJoin="round",g.invisibleLine.opacity=.01;var i=new f.Path.Circle(b,g.hitAreaCircleRadius);i.fillColor=g.drawingCircleColor,i.strokeColor=g.drawingCircleStrokeColor,i.opacity=.01,g.currentGroup=new f.Group([g.myPath,h,g.invisibleLine,i])}}},drawLineOnDrag:function(a){var b,c;this.myPath&&(c=this.myPaper,this.allowLineDraw&&!this.allowLineDrag&&(b={},this.myPath.segments.length>1&&(this.myPath.segments.pop(),this.invisibleLine.segments.pop()),b=this.getValidPoint(a.point),this.myPath.add(new c.Point(b)),this.invisibleLine.add(new c.Point(b))),this.positionTooltip(a))},endLine:function(a){var b,c,d,e,f,g,h,i=this.$("#"+this.idPrefix+"tooltip-container");if(i.hide(),this.myPath&&(this.preventLongTap=!1,e=this.myPaper,b=this.myPath.segments[0].point,this.allowLineDraw&&!this.allowLineDrag)){if(h=this.getValidPoint(a.point),f=this.model.getSnappedPoint(h),g=new e.Point(f.x,f.y),g.x===b.x&&g.y===b.y)return this.currentGroup.remove(),this.currentGroup=null,this.myPath=null,void this.myPaper.view.draw();this.myPath.segments.length>1&&this.myPath.segments.pop(),this.myPath.add(g),d=this.endPointRadius,c=new e.Path.Circle(g,d),c.fillColor={gradient:{stops:[["#ffffff",0],["#cec8d8",1]],radial:!1},origin:{x:c.position._x,y:c.position._y-d},destination:{x:c.position._x,y:c.position._y+d}},c.shadowColor=new e.Color(0,0,0),c.shadowBlur=3,c.shadowOffset=new e.Point(2,1),c.strokeColor=this.drawingCircleStrokeColor,this.currentGroup.insertChild(2,c);var j=new e.Path.Circle(g,this.hitAreaCircleRadius);j.fillColor=this.drawingCircleColor,j.strokeColor=this.drawingCircleStrokeColor,j.opacity=.01,this.currentGroup.insertChild(5,j),this.currentGroup.pos=this.pathCount,this.currentGroup.name="name-"+this.pathCount.toString(),this.allPaths.push(this.currentGroup),this.pathCount+=1,this.allPaths.length>0?(this.disabledBtnRaster.visible=!1,this.activeBtnRaster.visible=!0):(this.disabledBtnRaster.visible=!0,this.activeBtnRaster.visible=!1),this.myPath=null,this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_ACTIVE),this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_ACTIVE),this.trigger(MathInteractives.Common.Components.Views.MotionGraph.FIRST_LINE_DRAWN)}},manageMouseMovefeatures:function(a){this.positionTooltip(a),this.allowLineDraw&&this.manageCursor(a.point)},manageCursor:function(a){this.isValidPoint(a)?this.$el.find(".graph-it-canvas").addClass("crossHairCursor"):this.$el.find(".graph-it-canvas").removeClass("crossHairCursor")},positionTooltip:function(a){var b=this._getPointFromLogicalCoordinate({x:a.point.x,y:a.point.y}).attributes,c=null,d=(this.model.get("verticalLineSize"),this.model),e=d.get("xAxis"),f=d.get("yAxis"),g=(e.get("stepSize"),f.get("stepSize"),e.get("unitsPerStepSize"),f.get("unitsPerStepSize"),a.point.x,a.point.y,this.toolTipYOffset),h=this.model.get("toolTipTextPrecision"),i=this.currentGridPosition;h=h&&0!==h?Number(h):1,c={x:Math.round(b.x/h)*h,y:Math.round(b.y/h)*h};var j=this.$("#"+this.idPrefix+"tooltip-container");if(!this.player.getModalPresent())if(c.x>=this.xMinGraph&&c.x<=this.xMaxGraph&&c.y>=this.yMinGraph&&c.y<=this.yMaxGraph){var k=c.x,l=c.y;i.xValue=k,i.yValue=l;var m=this.toolTipText,n=m&&m.message?m.message:"%@$%, %@$%",o=m&&m.units?m.units:[],p=[];o.length&&4===o.length?(p.push(k+o[1===k||0===k?0:1]),p.push(l+o[1===l||0===l?2:3])):(p.push(k),p.push(l)),n=this._replaceSpecialStr(n,p),this.$(".draggable-tooltip-mid").html(n),g=null===g||"undefined"==typeof g?j.height()/2:Number(g),j.show().css({left:String(a.point.x+this.toolTipXOffset)+"px",top:String(a.point.y+g)+"px"})}else j.hide()},_replaceSpecialStr:function(a,b){for(var c=0;c<b.length;c++)a=a.replace("%@$%",b[c]);return a},triggerMouseUp:function(a){var b,c,d,e,f,g;b=a.data.group,d=a.data.viewObj,e=$(a.target),g=this,f=e.parents("#"+d.$el.attr("id")).length>0,f||(c={},c.point=d.originalPoint,b.fire("mouseup",c)),$(this).off("mouseup",d.triggerMouseUp)},attachSegmentRelocateEvents:function(){var a,b,c,d;for(b=this.allPaths,a=b.length,d=this,c=0;a>c;c++)b[c].onMouseDown=function(a){var b,c,e,f,g;this.bringToFront(),b=d,b.pointToMove=null,f=this.children[0],g=this,c=f.segments[0].point,e=f.segments[f.segments.length-1].point,d.distanceBetweenTwoPoints(a.point,c)<d.hitAreaCircleRadius?(b.pointToMove={},b.pointToMove.endPoint=this.children[1],b.pointToMove.index=0):d.distanceBetweenTwoPoints(a.point,e)<d.hitAreaCircleRadius?(b.pointToMove={},b.pointToMove.endPoint=this.children[2],b.pointToMove.index=this.children[0].segments.length-1):b.originalPoint=this.position,$(document.body).on("mouseup",{group:g,viewObj:b},b.triggerMouseUp)},b[c].onMouseDrag=function(a){var b,c,e,f;b=d,c=this.children[0],f=this.children[3],b.pointToMove?(e=d.getValidPoint(a.point),b.pointToMove.endPoint.position=e,this.children[b.pointToMove.index+4].position=e,c.removeSegment(b.pointToMove.index),c.insert(b.pointToMove.index,e),f.removeSegment(b.pointToMove.index),f.insert(b.pointToMove.index,e)):this.position=a.point,b.pointerOverTrashCan(a.point)?(b.activeBtnRaster.visible=!1,b.hoverBtnRaster.visible=!0):(b.activeBtnRaster.visible=!0,b.hoverBtnRaster.visible=!1),b.positionTooltip(a)},b[c].onMouseEnter=function(){var a=d;this.children[0].strokeColor=a.drawingLineHoverColor,this.children[1].fillColor={gradient:{stops:[["#cec8d8",0],["#ffffff",1]],radial:!1},origin:{x:this.children[1].position._x,y:this.children[1].position._y-a.endPointRadius},destination:{x:this.children[1].position._x,y:this.children[1].position._y+a.endPointRadius}},this.children[2].fillColor={gradient:{stops:[["#cec8d8",0],["#ffffff",1]],radial:!1},origin:{x:this.children[2].position._x,y:this.children[2].position._y-a.endPointRadius},destination:{x:this.children[2].position._x,y:this.children[2].position._y+a.endPointRadius}},this.children[1].radius=30,this.children[2].radius=30,this.children[1].strokeWidth=1,this.children[2].strokeWidth=1,this.children[1].strokeColor=a.drawingCircleStrokeColor,this.children[2].strokeColor=a.drawingCircleStrokeColor,a.$(".graph-it-canvas").addClass("handCursor")},b[c].onMouseLeave=function(){var a=d;this.children[0].strokeColor=a.drawingColor,this.children[1].fillColor={gradient:{stops:[["#ffffff",0],["#cec8d8",1]],radial:!1},origin:{x:this.children[1].position._x,y:this.children[1].position._y-a.endPointRadius},destination:{x:this.children[1].position._x,y:this.children[1].position._y+a.endPointRadius}},this.children[2].fillColor={gradient:{stops:[["#ffffff",0],["#cec8d8",1]],radial:!1},origin:{x:this.children[2].position._x,y:this.children[2].position._y-a.endPointRadius},destination:{x:this.children[2].position._x,y:this.children[2].position._y+a.endPointRadius}},a.$(".graph-it-canvas").removeClass("handCursor")},b[c].onMouseUp=function(a){var b=self.$("#"+self.idPrefix+"tooltip-container");b.hide();var c,e,f,g,h;if(c=d,g=this.children[0],h=this.children[3],c.pointToMove)e=c.getValidPoint(a.point),f=c.getValidSnappedPoint(e,this.pos),c.pointToMove.endPoint.position=f,this.children[c.pointToMove.index+4].position=f,g.removeSegment(c.pointToMove.index),g.insert(c.pointToMove.index,f),h.removeSegment(c.pointToMove.index),h.insert(c.pointToMove.index,e);else{if(c.pointerOverTrashCan(a.point)){if(this.trigger("mouseleave"),c.detachEventsOnIndividualSegments(this),c.removePath(this),this.remove(),c.hoverBtnRaster.visible=!1,!(d.allPaths.length>0))return c.drawLineBtnView.$el.trigger("click"),c.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),c.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),c.trigger(MathInteractives.Common.Components.Views.MotionGraph.ALL_LINES_CLEARED),c.disabledBtnRaster.visible=!0,c.activeBtnRaster.visible=!1,void c.allowLineDrawing();c.activeBtnRaster.visible=!0,c.disabledBtnRaster.visible=!1}if(this.position=a.point,c.isValidPoint(g.segments[0].point)&&c.isValidPoint(g.segments[g.segments.length-1].point)){return}else this.position=c.originalPoint}c.pointToMove=null,c.originalPoint=null}},detachSegmentRelocateEvents:function(){var a,b,c;for(b=this.allPaths,a=b.length,c=0;a>c;c++)this.detachEventsOnIndividualSegments(b[c])},detachEventsOnIndividualSegments:function(a){var b=this;a.onMouseDown=null,a.onMouseDrag=null,a.onMouseLeave=null,a.onMouseEnter=null,a.onMouseUp=function(){var a=b.$("#"+b.idPrefix+"tooltip-container");a.hide()},a.onMouseMove=null},removePath:function(a){var b,c,d;for(c=this.allPaths,b=c.length,d=0;b>d;d++)if(a.pos===c[d].pos){this.detachEventsOnIndividualSegments(c[d]),c.splice(d,1);break}},pointerOverTrashCan:function(b){var c,d,e,f,g,h,i=this.model.get("trashCanCustomPosition"),j=i?i.x:a.DELETE_BTN_X,k=i?i.y:a.DELETE_BTN_Y;return c=j-a.DELETE_BTN_WIDTH/2,d=j+a.DELETE_BTN_WIDTH-a.DELETE_BTN_WIDTH/2,e=k-a.DELETE_BTN_HEIGHT/2,f=k+a.DELETE_BTN_HEIGHT-a.DELETE_BTN_HEIGHT/2,g=b.x,h=b.y,g>c&&d>g&&h>e&&f>h?!0:!1},trashCanRasters:function(b){var c,d=(this.model,b?b:{x:a.DELETE_BTN_X,y:a.DELETE_BTN_Y});c=this.myPaper,this.activeBtnRaster=new c.Raster({source:this.filePath.getImagePath("trashcan-up"),position:d,visible:!1}),this.disabledBtnRaster=new c.Raster({source:this.filePath.getImagePath("trashcan-disabled"),position:d,visible:!0}),this.hoverBtnRaster=new c.Raster({source:this.filePath.getImagePath("trashcan-hover"),position:d,visible:!1})},showHideGraphControls:function(a){a?(this.$el.find(".graph-controls").show(),this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1,this.disabledBtnRaster.visible=!0):(this.$el.find(".graph-controls").hide(),this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1,this.disabledBtnRaster.visible=!1)},distanceBetweenTwoPoints:function(a,b){var c;return c=MathInteractives.Common.Utilities.Models.Utils.distanceBetweenPoints(a.x,a.y,b.x,b.y),c=Math.floor(c)},isValidPoint:function(a){return a.x<this.xMinBoundry||a.x>this.xMaxBoundry||a.y>this.yMaxBoundry||a.y<this.yMinBoundry?!1:!0},getValidPoint:function(a){var b;return this.isValidPoint(a)?b=a:(b={},b.x=a.x>this.xMaxBoundry?this.xMaxBoundry:a.x<this.xMinBoundry?this.xMinBoundry:a.x,b.y=a.y>this.yMaxBoundry?this.yMaxBoundry:a.y<this.yMinBoundry?this.yMinBoundry:a.y,b=new this.myPaper.Point(b)),b},getPointDetailsInVicinity:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;for(c={},c.index=null,c.segmentIndex=null,j=2*this.endPointRadius,d=this.allPaths,e=d.length,f=0;e>f;f++)d[f].pos!==b&&(o=d[f].children[0],i=o.segments.length,g=o.segments[0].point,h=o.segments[i-1].point,k=this.distanceBetweenTwoPoints(a,g),l=this.distanceBetweenTwoPoints(a,h),l>k?m=j>k?!0:!1:n=j>l?!0:!1,m?(j=k,c.index=f,c.segmentIndex=0):n&&(j=l,c.index=f,c.segmentIndex=i-1),m=n=!1);return c},getValidSnappedPoint:function(a,b){var c,d,e;return c=this.model.getSnappedPoint(a),c=new this.myPaper.Point(c.x,c.y),d=this.getPointDetailsInVicinity(a,b),e=d.index?this.allPaths[d.index].children[0].segments[d.segmentIndex].point:c},repaint:function b(){this.myPaper.activate();var c,d,e,f,g,h,b,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(s=this.myPaper,k=this.model,p=this.model.get("plotToRepaint"),x=5,null===p&&this.myPaper.view)return void this.myPaper.view.draw();switch(this.model.set("plotToRepaint",null),i=k.get("origin").get("x"),j=k.get("origin").get("y"),l=k.get("xAxis"),m=k.get("yAxis"),n=l.get("stepSize"),o=m.get("stepSize"),r=m.get("unitsPerStepSize"),q=l.get("unitsPerStepSize"),t=p.get("lineType"),u=a.LINE_TYPES,d=p.get("points").models,c=d.length,b=p.paperPathObject?p.paperPathObject:new s.Path,v=p.paperEndPointCircleGroup?p.paperEndPointCircleGroup:new s.Group,b.removeSegments(),v.removeChildren(),b.strokeColor=this.plotColor,b.strokeWidth=this.lineWidth,t){case u.DASHED_THIN_LINE:b.dashArray=[8,4]}for(e=0;c>e;e++)g=Math.floor(d[e].get("x")*n/q+i),h=Math.floor(j-d[e].get("y")*o/r),f=new s.Point(g,h),b.add(f);if(this.model.get("paintWithEndPoints"))for(e=0;c>e;e++)g=Math.floor(d[e].get("x")*n/q+i),h=Math.floor(j-d[e].get("y")*o/r),f=new s.Point(g,h),w=new s.Path.Circle({center:f,radius:x}),w.strokeColor=this.staticCircleStrokeColor,w.fillColor=this.staticCircleColor,v.addChild(w);p.paperPathObject=b,p.paperEndPointCircleGroup=v,this.myPaper.view.draw()},_getPointFromLogicalCoordinate:function(a){var b=this.model,c=b.get("origin").get("x"),d=b.get("origin").get("y"),e=b.get("xAxis"),f=b.get("yAxis"),g=e.get("stepSize"),h=f.get("stepSize"),i=f.get("unitsPerStepSize"),j=e.get("unitsPerStepSize"),k=(a.x-c)*j/g,l=(d-a.y)*i/h,m=new MathInteractives.Common.Components.Models.MotionGraph.Point({x:k,y:l});return m},_setTitleTextInModel:function(a){a&&this.model.get("title").set("content",a)},_getTitleTextFromModel:function(){return this.model.get("title").get("content")},_setXAxisLabelInModel:function(a){a&&this.model.get("xAxis").set("labelText",a)},_getXAxisLabelFromModel:function(){return this.model.get("xAxis").get("labelText")},_setYAxisLabelInModel:function(a){a&&this.model.get("yAxis").set("labelText",a)},_getYAxisLabelFromModel:function(){return this.model.get("yAxis").get("labelText")},_alignLabel:function(a){if("undefined"!=typeof a){var b=(MathInteractives.Common.Player.Views.Player,MathInteractives.Common.Components.Views.MotionGraph),c=b.AXIS_LABEL_PADDING,d=b.TITLE_LABEL_PADDING,e=this.xMinBoundry,f=this.xMaxBoundry,g=this.yMinBoundry,h=this.yMaxBoundry,i={topLeft:{x:e,y:g},bottomRight:{x:f,y:h},topRight:{x:f,y:g},bottomLeft:{x:e,y:h},xAxisLength:f-e,yAxisLength:h-g},j=null,k=null;switch(a){case"xAxis":j=this.$("#"+this.idPrefix+"draw-graph-x-axis-label"),k=this.player.getTextHeightWidth(this._getXAxisLabelFromModel(),"draw-graph-x-axis-label typography-label"),j.css({top:i.bottomLeft.y+c,left:i.bottomLeft.x+i.xAxisLength/2-k.width/2});break;case"yAxis":j=this.$("#"+this.idPrefix+"draw-graph-y-axis-label"),k=this.player.getTextHeightWidth(this._getYAxisLabelFromModel(),"draw-graph-y-axis-label typography-label"),j.css({top:i.bottomLeft.y-i.yAxisLength/2-k.height/2,
left:i.bottomLeft.x-k.width/2-k.height/2-c});break;case"title":j=this.$("#"+this.idPrefix+"draw-graph-title"),k=this.player.getTextHeightWidth(this._getTitleTextFromModel(),"draw-graph-title typography-header"),j.css({top:i.topLeft.y-k.height/2-d,left:i.topLeft.x+i.xAxisLength/2-k.width/2})}}},showHideFeedbackGraph:function(){var a,b,c;a=this.model.get("referencePlot"),a&&a.paperPathObject&&(b=a.paperPathObject,b.visible=!b.visible),a&&a.paperEndPointCircleGroup&&(c=a.paperEndPointCircleGroup,c.visible=!c.visible),this.myPaper.view.draw()},showFeedbackGraph:function(){var a,b,c;a=this.model.get("referencePlot"),a&&a.paperPathObject&&(b=a.paperPathObject,b.visible=!0,this.myPaper.view.draw()),a&&a.paperEndPointCircleGroup&&(c=a.paperEndPointCircleGroup,c.visible=!0)},showHideUserDrawnGraph:function(){var a,b,c;for(a=this.allPaths,b=a.length,c=0;b>c;c++)a[c].visible=!a[c].visible;this.myPaper.view.draw()},showUserDrawnGraph:function(){var a,b,c;for(a=this.allPaths,b=a.length,c=0;b>c;c++)a[c].visible=!0;this.myPaper.view.draw()},enableDrawing:function(){this.hoverBtnRaster.visible=!1,this.allPaths.length>0?(this.activeBtnRaster.visible=!0,this.disabledBtnRaster.visible=!1,this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_ACTIVE)):(this.disabledBtnRaster.visible=!0,this.activeBtnRaster.visible=!1,this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED)),this.drawLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.allowLineDrawing()},disableDrawing:function(){this.allowLineDraw=!1,this.allowLineDrag=!1,this.detachDrawingEvents(),this.detachSegmentRelocateEvents(),this.drawLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1,this.disabledBtnRaster.visible=!0,this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED)},showHideGraphDisplayBtns:function(a){a?(this.userGraphBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.feedbackGraphBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_SELECTED),this.$el.find(".users-graph-control").show(),this.$el.find(".feedback-graph-control").show(),this.showFeedbackGraph(),this.showUserDrawnGraph()):(this.$el.find(".users-graph-control").hide(),this.$el.find(".feedback-graph-control").hide())},clearUserCreatedGraph:function(){var a,b;for(this.detachSegmentRelocateEvents(),this.detachDrawingEvents(),this.allowLineDrawing(),a=this.allPaths,b=a.length;a.length>0;)a[0].remove(),this.removePath(a[0]);this.activeBtnRaster.visible=!1,this.hoverBtnRaster.visible=!1,this.disabledBtnRaster.visible=!0,this.drawLineBtnView.$el.trigger("click"),this.clearAllBtn.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.dragLineBtnView.setButtonState(MathInteractives.global.Button.BUTTON_STATE_DISABLED),this.myPaper.view.draw(),this.trigger(MathInteractives.Common.Components.Views.MotionGraph.ALL_LINES_CLEARED)},getUserDrawLineCount:function(){return this.allPaths?this.allPaths.length:0},setTitle:function(a){return a?(this._setTitleTextInModel(a),this.$("#"+this.idPrefix+"draw-graph-title").append(this._getTitleTextFromModel()),void this._alignLabel("title")):void 0},setXAxisLabel:function(a){return a?(this._setXAxisLabelInModel(a),this.$("#"+this.idPrefix+"draw-graph-x-axis-label").append(this._getXAxisLabelFromModel()),void this._alignLabel("xAxis")):void 0},setYAxisLabel:function(a){return a?(this._setYAxisLabelInModel(a),this.$("#"+this.idPrefix+"draw-graph-y-axis-label").append(this._getYAxisLabelFromModel()),void this._alignLabel("yAxis")):void 0},setTooltipText:function(a){this.model.set("toolTipText",a),this.toolTipText=a}},{LINE_TYPES:{CONTINUES_THIN_LINE:0,DASHED_THIN_LINE:1},FIRST_LINE_DRAWN:"first_line_drawn",ALL_LINES_CLEARED:"all_lines_cleared",CUSTOM_MOUSEUP_EVENT_FIRED:"mouseup-event-fired",AXIS_LABEL_PADDING:35,TITLE_LABEL_PADDING:20,DELETE_BTN_X:345,DELETE_BTN_Y:357,DELETE_BTN_HEIGHT:49,DELETE_BTN_WIDTH:127}),MathInteractives.Common.Components.Views.MotionGraph=a}();