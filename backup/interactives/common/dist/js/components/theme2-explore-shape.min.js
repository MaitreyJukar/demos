!function(){"use strict";MathInteractives.Common.Components.Models.ExplorerShape=MathInteractives.Common.Components.Models.ExplorerGraph.extend({defaults:function(){return{showBubbles:!0,showGraph:!0,minBubbleLimit:10,maxBubbleLimit:30,currentSmallBubblesPosition:null,currentLargeBubblesPosition:null,currentMiddleBubblesPosition:null,smallBubbleGroup:null,largeBubbleGroup:null,showPopupOnTryAnother:!1,middleBubbleGroup:null,populateBubble:!0,noOfBubblesToPop:0,activityAreaStartPoint:{xCoordinate:131,yCoordinate:84},activityAreaEndPoint:{xCoordinate:909,yCoordinate:533},startPointBubble:{xCoordinate:158,yCoordinate:102},endPointBubble:{xCoordinate:896,yCoordinate:525},generateNewBubbles:!0,showEquation:!0,dummyBubblePath:new Array,intersectBubblesArray:new Array,shape:"ellipse",foci1:null,foci2:null,center:null,shapeCenter:null,majorAxis:60,minorAxis:30,tackToFoci1:null,tackToFoci2:null,thumbTack:null,circumferencePath:null,prevAngle:null,currentPointIndex:null,positionCounter:null,purple:null,red:null,black:null,purpleBar:null,redBar:null,purpleStringRaster:null,redStringRaster:null,blackStringRaster:null,purpleStringBarRaster:null,redStringBarRaster:null,fociCenterDist:null,fociDist:null,lastIndex:null,restrictMovementAlongCircumference:!1,isFociMovable:!0,isCenterMovable:!0,isThumbTackMovable:!0,animationStarted:!1,lableA:null,lableB:null,lineA:null,lineB:null,dashedShape:null,deletaXLine:null,deletaXLineLabel:null,deltaYLine:null,deletaYLineLabel:null,shapeCenterSnapX:0,shapeCenterSnapY:0,equationEllipseB:null,equationEllipseA:null,ellipseCenterCoordinate:null,showPoppedBubbles:!1,circlePoint:null,centerCoordinate:null,circlePointCoordinate:null,thumbTackCoordinate:null,radiusString:null,bubblesBoundsCenter:null,circleDeltaX:null,circleDeltaY:null,circleRadius:null,allBubbleGroup:null,shapeCenterCircle:null,isReplay:!1,thumbTackAcc:!1,centerAcc:!1,fociAcc:!1}},initialize:function(){},getMinBubbleLimit:function(){return this.get("minBubbleLimit")},setMinBubbleLimit:function(a){this.set("minBubbleLimit",a)},getMaxBubbleLimit:function(){return this.get("maxBubbleLimit")},setMaxBubbleLimit:function(a){this.set("maxBubbleLimit",a)},getShowGraph:function(){return this.get("showGraph")},setShowGraph:function(a){this.set("showGraph",a)},getShowBubbles:function(){return this.get("showBubbles")},setShowBubbles:function(a){this.set("showBubbles",a)},getStartPointBubble:function(){return this.get("startPointBubble")},setStartPoint:function(a,b){var c=this.getStartPointBubble();c.xCoordinate=a,c.yCoordinate=b},getEndPointBubble:function(){return this.get("endPointBubble")},setEndPoint:function(a,b){var c=this.getEndPointBubble();c.xCoordinate=a,c.yCoordinate=b},getSmallerBubbleRadius:function(){return this.get("smallerBubbleRadius")},getMiddleBubbleRadius:function(){return this.get("middleBubbleRadius")},getLargerBubbleRadius:function(){return this.get("largerBubbleRadius")},setSmallerBubbleRadius:function(a){this.set("smallerBubbleRadius",a)},setLargerBubbleRadius:function(a){this.set("largerBubbleRadius",a)},setMiddleBubbleRadius:function(a){this.set("middleBubbleRadius",a)},generateRandomNumber:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},isPointValid:function(a){var b=!1,c=this.get("activityAreaStartPoint"),d=this.get("activityAreaEndPoint"),e=this.get("foci1").position,f=this.get("foci2").position,g=this.get("thumbTack").position,h=this.get("shapeCenter").position;return a.x>c.xCoordinate&&a.x<d.xCoordinate&&a.y>c.yCoordinate&&a.y<d.yCoordinate&&e.x>c.xCoordinate&&e.x<d.xCoordinate&&e.y>c.yCoordinate&&e.y<d.yCoordinate&&f.x>c.xCoordinate&&f.x<d.xCoordinate&&f.y>c.yCoordinate&&f.y<d.yCoordinate&&g.x>c.xCoordinate&&g.x<d.xCoordinate&&g.y>c.yCoordinate&&g.y<d.yCoordinate&&h.x>c.xCoordinate&&h.x<d.xCoordinate&&h.y>c.yCoordinate&&h.y<d.yCoordinate&&(b=!0),b},setPositionsOfBubbles:function(){var a=this.get("startPointBubble"),b=this.get("endPointBubble"),c=15,d=a.xCoordinate+c,e=a.yCoordinate+c,f=b.xCoordinate-c,g=b.yCoordinate-c,h=this.get("bubblesBoundsCenter"),i=h.x,j=h.y,k=30,l=55,m=new Array,n=null,o=null,p=null;for(n=this.generateRandomNumber(k,l),o=Math.ceil(n/4),p=0;o>p;p++)this.setCurrentArrayValue(m,d,i,e,j),this.setCurrentArrayValue(m,i,f,e,j),this.setCurrentArrayValue(m,d,i,j,g);for(4*o>n&&(o=n-m.length),p=0;o>p;p++)this.setCurrentArrayValue(m,i,f,j,g);return m},setCurrentArrayValue:function(a,b,c,d,e){var f=this,g=null,h=null,i=a.length,j=null,k=MathInteractives.Common.Components.Models.ExplorerShape.MIN_DIST_TWO_POINTS,l=null,m=[],n=null;do for(n=!1,g=f.generateRandomNumber(b,c),h=f.generateRandomNumber(d,e),m[0]=g,m[1]=h,l=0;i>l;l++)j=f.getDistance(m,a[l]),k>j&&(n=!0);while(n);a.push(m)},getDistance:function(a,b){var c=Math.pow(Math.abs(a[0]-b[0]),2),d=Math.pow(Math.abs(a[1]-b[1]),2);return Math.sqrt(c+d)},setDummyBubblePath:function(a){var b=this.get("dummyBubblePath");b.push(a)}},{MIN_DIST_TWO_POINTS:34,createExplorerShapeModel:function(a){return new MathInteractives.Common.Components.Models.ExplorerShape(a)}})}(),function(){"use strict";MathInteractives.Common.Components.Views.ExplorerShape=MathInteractives.Common.Components.Views.ExplorerGraph.extend({idPrefix:null,manager:null,filePath:null,player:null,viewStaticData:null,minXBubbleBound:null,minYBubbleBound:null,maxXBubblebound:null,maxYBubbleBound:null,bubblesBoundsCenter:{},isRedCircleShown:null,hitOptions:null,hitResult:null,currentImage:null,lastIndexChanged:!1,dummyTackPath:null,interval:null,dummyEllipse:null,deltaGroup:null,shapeCenter:{x:null,y:null},thumbTackPositionAdded:{x:0,y:0},isFirstRun:!0,largeBubbleImageRaster:null,smallBubbleImageRaster:null,middlebubbleimageraster:null,largeAnimateBubblesRasters:null,middleAnimateBubblesRasters:null,smallAnimateBubblesRasters:null,dashedShapeGroup:null,initialAnimationInterval:null,canvasAcc:null,focusRect:null,previousItem:null,currentItem:null,arrow:null,thumbTackHeight:28,thumbTackWidth:19,currentIndex:null,afterFirstAnimate:!1,initialize:function(){this.redBarLoded=!1,this.rasterPattern={},this.isFirstRun=!0;var a=this.model,b=a.getShowGraph(),c=this;this.initialAnimationInterval=1,this.idPrefix=a.get("idPrefix"),this.manager=a.get("manager"),this.filePath=a.get("filePath"),this.player=a.get("player"),this.viewStaticData=MathInteractives.Common.Components.Views.ExplorerShape,this.timeOutInterval=this.viewStaticData.ANIMATION_DURATION/90,b?this._callBaseViewInitialize():(this._appendCanvas(),this._setpaperScope(),this._setCanvasStyle(),this._bindEvents()),this._appendDrawingLayer(),this.hitOptions={segments:!0,stroke:!0,fill:!0,tolerance:3},this.paperScope2.activate(),this.paperScope.view.draw(),this._prepareColorStringRasters(),this.on(MathInteractives.Common.Components.Views.ExplorerShape.CUSTOM_EVENTS.initializationDone,function(){c._setInitialAnimationPosition()})},_setInitialAnimationPosition:function(){var a=this.model,b=a.get("shape"),c=a.get("thumbTack"),d=a.get("foci1"),e=a.get("foci2"),f=a.get("dummyThumbTack"),g=a.get("shapeCenter"),h=8*a.get("gridSizeXAxis");if(this.paperScope2.activate(),c.position.x=g.position.x,c.position.y=g.position.y,f.position.x=c.position.x,f.position.y=c.position.y,this.model.set("thumbTack",c),this.model.set("shapeCenter",g),"ellipse"===b){d.position.x=g.position.x,d.position.y=g.position.y-h/2,e.position.x=g.position.x,e.position.y=g.position.y+h/2;var i={};i.event={},i.event.which=1,i.point=new this.paperScope2.Point(0,0),this._snapAll(),this._showShapeMouseDownFeatures(i),this._showShapeMouseUpFeatures(i),this.redBarLoded=!1,"ellipse"===this.model.get("shape")&&this._redrawBar()}else{c.position.x=g.position.x+57,c.position.y=g.position.y-57;var i={};i.event={},i.event.which=1,d.position.x=g.position.x,d.position.y=g.position.y,e.position.x=g.position.x,e.position.y=g.position.y,this.model.set("foci1",d),this.model.set("foci2",e),this._snapAll(),i.point=new this.paperScope2.Point(g.position.x,g.position.y),this._showShapeMouseUpFeatures(i)}this.paperScope2.view.draw()},_initialAniamtion:function(){var a=this,b=a.model,c=b.get("shape"),d=b.get("thumbTack"),e=null;return this.isFirstRun?(this._snapAll(),this._handleInitialAnimationStart(),this.draggableElement=d,"circle"===c?(e=b.generateRandomNumber(60,100),this._initialCircleAnimation(e)):"ellipse"===c&&(e=b.generateRandomNumber(150,250),a._initialEllipseAnimation(e)),void a._bringShapeToFront(c)):(this.trigger(a.viewStaticData.CUSTOM_EVENTS.bubblePopulationAnimationEnd),a._bringShapeToFront(c),this._handleInitialAnimationEnd(),!1)},_handleInitialAnimationStart:function(){var a=this.model,b={};b.point=a.get("shapeCenter").position,this._showShapeMouseDownFeatures(b),this._showShapeMouseUpFeatures(b),this.isAnimating=!0,this._unbindEventsOnDraggables(a.get("thumbTack")),this._unbindEventsOnDraggables(a.get("foci1")),this._unbindEventsOnDraggables(a.get("foci2")),this._unbindEventsOnDraggables(a.get("shapeCenter")),this._unbindEventsOnDraggables(a.get("dummyThumbTack")),this._bringShapeToFront(a.get("shape")),this.player.enableAllHeaderButtons(!1);var c=this.$("#"+this.idPrefix+"graph-holder-canvas-element-extended");c.css({cursor:"default"})},_handleInitialAnimationEnd:function(){var a=this,b=a.model;a._bindEventsOnDraggables(b.get("foci1")),a._bindEventsOnDraggables(b.get("foci2")),a._bindEventsOnDraggables(b.get("shapeCenter")),a._bindEventsOnDraggables(b.get("dummyThumbTack")),a.isAnimating=!1,a.draggableElement=null,a.isFirstRun=!1,this.player.enableAllHeaderButtons(!0)},_initialCircleAnimation:function(a){var b=this.model,c=b.get("shape"),d=b.get("thumbTack"),e={},f=this,g=b.get("shapeCenter");e.event={},e.event.which=1,this.paperScope2.activate(),setTimeout(function(){e.point=d.position.clone(),f._showShapeMouseDownFeatures(e),f.draggableElement=d,e.point.y-=1,e.point.x+=.4,f.paperScope2.activate(),f._showShapeMouseDragFeatures(e),"circle"===c?f.model.get("black").bringToFront():(f.model.get("purple").bringToFront(),f.model.get("red").bringToFront()),f._bringShapeToFront(f.model.get("shape")),0===a?(f.isFirstRun=!1,f._showShapeMouseUpFeatures(e),g=f.model.get("shapeCenter"),e.point=g.position,f._showShapeMouseDownFeatures(e),f._showShapeMouseUpFeatures(e),f.trigger(f.viewStaticData.CUSTOM_EVENTS.bubblePopulationAnimationEnd),f._bringShapeToFront(c),f._handleInitialAnimationEnd(),f.model.set("showPopupOnTryAnother",!1)):f._initialCircleAnimation(a-1),f.paperScope2.view.draw()},this.initialAnimationInterval)},_initialEllipseAnimation:function(a){var b,c=this.model,d=(c.get("shape"),c.get("thumbTack"),c.get("foci1"),c.get("foci2"),c.get("dummyThumbTack"),{}),e=this,f=(c.get("shapeCenter"),!0);b=1,d.event={},d.event.which=1,setTimeout(function(){var d=e.model.get("foci1"),g=e.model.get("foci2"),h={};h.event={},h.event.which=1,e.model.set("showGraph",!1),h.point=d.position.clone(),e.paperScope2.activate(),e._showShapeMouseDownFeatures(h),e.draggableElement=c.get("foci1"),f&&d.position.x===g.position.x?h.point.y+=b:h.point.x-=b,e._showShapeMouseDragFeatures(h),c.get("purple").bringToFront(),c.get("red").bringToFront(),e._bringShapeToFront(e.model.get("shape")),d.position.x===g.position.x&&d.position.y===g.position.y&&(f=!1,d.position.x-=10,g.position.x+=10),0===a?(e.model.set("showGraph",!0),e._showShapeMouseUpFeatures(h),e._initialCircleAnimation(c.generateRandomNumber(60,100))):a>0&&e._initialEllipseAnimation(a-1),e.paperScope2.view.draw()},this.initialAnimationInterval)},_animateCenter:function(a){var b=this.model,c=b.get("shape"),d=this,e=0;b.get("shapeCenter");setTimeout(function(){var f=d.model.get("shapeCenter").position.clone(),g={};e++,g.event={},g.event.which=1,g.point=f,d.paperScope2.activate(),d._showShapeMouseDownFeatures(g),g.point=f,g.point.x+=2,g.point.y-=2,d._showShapeMouseDragFeatures(g),"circle"===c?b.get("black").bringToFront():(b.get("purple").bringToFront(),b.get("red").bringToFront()),d._bringShapeToFront(d.model.get("shape")),d.paperScope2.view.draw(),a>0?d._animateCenter(a-1):(d._showShapeMouseUpFeatures(g),"ellipse"===c&&d._initialEllipseAnimation(200),"circle"===c&&d._initialCircleAnimation(40))},this.initialAnimationInterval)},_prepareColorStringRasters:function(){for(var a,b,c=["red","purple","Barpurple","Barred","black","largeBubble","smallBubble","middleBubble","animateLargeBubble1","animateLargeBubble2","animateLargeBubble3","animateSmallBubble1","animateSmallBubble2","animateSmallBubble3","animateMiddleBubble1","animateMiddleBubble2","animateMiddleBubble3","arrowCenter"],d=c.length,e=d,f=this,g=0;d>g;g++){var h=c[g];a=this.getImageURLFromSprite(h),null!==a?(b=new this.paperScope2.Raster(a),b.onLoad=function(){e--,0===e&&f._resumeInitialization()},this.rasterPattern[h]=b,this.rasterPattern[h].opacity=0):(e--,0===e&&f._resumeInitialization())}},_resumeInitialization:function(){this._render(),this.paperScope.view.draw(),this.paperScope2.activate(),this._bindEvents();var a={};a.event={},a.event.which=1,a.point=new this.paperScope2.Point(0,0),this._snapAll(),this._showShapeMouseDownFeatures(a),this._showShapeMouseUpFeatures(a),this.redBarLoded=!1,"ellipse"===this.model.get("shape")&&this._redrawBar(),this.paperScope2.view.draw(),this._handleInitialAnimationStart(),this.trigger(MathInteractives.Common.Components.Views.ExplorerShape.CUSTOM_EVENTS.initializationDone)},_appendDrawingLayer:function(){this.$("canvas").css({position:"absolute",top:"0px",left:"0px"}),this.$el.find(".canvas-holder").css("position","relative").append('<canvas class = "canvas-element" style="position:absolute;" id = "'+this.idPrefix+'graph-holder-canvas-element-extended" height="599" width="928"> '),this.paperScope2=new paper.PaperScope,this.paperScope2.setup(this.idPrefix+"graph-holder-canvas-element-extended"),this.currentTool=new this.paperScope2.Tool,this.paperScope2.activate()},bindEventsForCursor:function(){var a=this.model,b=a.get("foci1"),c=a.get("foci2"),d=a.get("shapeCenter");this._bindEventsOnDraggables(b),this._bindEventsOnDraggables(c),this._bindEventsOnDraggables(d)},_appendCanvas:function(){var a=this.$el,b=this.el.id,c=this.model,d=c.getCanvasHeight(),e=c.getCanvasWidth(),f=MathInteractives.Common.Components.templates.explorerGraph({idPrefix:this.idPrefix,height:d,width:e}).trim();a.html("").append(f),a.find(".canvas-holder").attr("id",b+"-canvas-holder"),a.find(".canvas-element").attr("id",b+"-canvas-element"),a.find(".canvas-tooltip").attr("id",b+"-canvas-tooltip"),a.find(".explore-graph-acc-container").attr("id",b+"-explore-graph-acc-container")},_setCanvasStyle:function(){var a=this.$el,b=this.el.id,c=a.find("#"+b+"-canvas-holder"),d=(c.find("#"+b+"-canvas-element"),this.model),e=d.getCanvasParentHeight(),f=d.getCanvasParentWidth();d.getCanvasHeight(),d.getcanvasBackgroundColor(),d.getCanvasWidth();c.css({height:e,width:f})},_render:function(){this.paperScope2.activate();var a=($('<div id="temo-div" class="temp-div">'),this.$el,this.model),b=a.getStartPointBubble(),c=a.getEndPointBubble(),d=(b.xCoordinate,b.yCoordinate,c.xCoordinate,a.getShowBubbles()),e=(c.yCoordinate,this);this.currentImage=this.getImagePath("explore-shapes"),this.isAnimating=!1;var f,g,h,i,j,j,a=this.model,k=(a.get("majorAxis"),a.get("minorAxis"),a.getOriginPosition()),l=this._createRaster(0,0),m=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",0,54,36,36)),n=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",46,54,36,36)),o=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",77,103,36,36)),p=null,q=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",80,34,19,28)),r=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",62,94,5,5)),s=a.get("shape"),t=a.get("showEquation");"circle"===s&&(m.opacity=0,n.opacity=0);var u=this.paperScope2,r=this.getSpritePartBase64URL("explore-shapes",62,94,5,5);this.blackStringRaster=new u.Raster({source:r}),"ellipse"===a.get("shape")&&(o.opacity=0),this._getRandomMajorMinorAxis(),a.set("foci1",m),a.set("foci2",n),a.set("center",k),this._calculateFociCenterDist(),l.remove(),this._setCircumferencePath(),j=a.get("circumferencePath"),p=new this.paperScope2.Raster(this.getSpritePartBase64URL("explore-shapes",92,54,19,39)),p.position=j[70],q.position=j[70],q.opacity=0,a.set("dummyThumbTack",q),a.set("thumbTack",p),a.set("circleCenter",o),this._setInitialPosition(),d&&(this._setBoundsForBubbles(),this.generateBubbles(),this._setAnimateBubblesRaster()),h=m.position.subtract(n.position),i=h.length,m.name="ellipse-foci1",n.name="ellipse-foci2",p.name="thumb-tack",q.name="thumb-tack",a.set("fociDist",i),a.set("fociCenterDist",i/2),a.set("center",k),a.set("foci1",m),a.set("foci2",n),a.set("thumbTack",p),a.set("dummyThumbTack",q),a.set("lastIndex",j.length),f=p.position.subtract(m.position).length,g=p.position.subtract(n.position).length,e.model.set("tackToFoci1",f),e.model.set("tackToFoci2",g),this._drawDummyTackPath(),"ellipse"===s?(this.redBarLoded=!1,this._generateBar(),e.model.get("thumbTack").bringToFront(),this._bringShapeToFront("ellipse"),t&&(this._addEllipseEquationHolderTemplate(),this._showHideEllipseEquation(!1))):"circle"===s&&(this._setRadiusLabel(f),this._bringShapeToFront("circle"),this._addCircleEquationHolderTemplate(),this._showHideCircleEquation(!1)),this._bindEventsOnDraggables(q),this._bindEventsOnDraggables(m),this._bindEventsOnDraggables(n)},_setAnimateBubblesRaster:function(){var a=[];a.push(this.rasterPattern.animateMiddleBubble1),a.push(this.rasterPattern.animateMiddleBubble2),a.push(this.rasterPattern.animateMiddleBubble3),this.middleAnimateBubblesRasters=a,a=[],a.push(this.rasterPattern.animateSmallBubble1),a.push(this.rasterPattern.animateSmallBubble2),a.push(this.rasterPattern.animateSmallBubble3),this.smallAnimateBubblesRasters=a,a=[],a.push(this.rasterPattern.animateLargeBubble1),a.push(this.rasterPattern.animateLargeBubble2),a.push(this.rasterPattern.animateLargeBubble3),this.largeAnimateBubblesRasters=a},_bringShapeToFront:function(a){var b=this.model,c=b.get("radiusLabel");this.dummyGroup&&this.dummyGroup.bringToFront(),b.get("thumbTack").bringToFront(),"circle"===a?b.get("black").bringToFront():"ellipse"===a&&(b.get("purple").bringToFront(),b.get("red").bringToFront()),b.get("foci1").bringToFront(),b.get("foci2").bringToFront(),c&&c.bringToFront(),b.get("shapeCenter").bringToFront(),b.get("dummyThumbTack").bringToFront()},_bindEventsOnDraggables:function(a){var b=this.$("#"+this.idPrefix+"graph-holder-canvas-element-extended"),c=this;this._unbindEventsOnDraggables(a),a.onMouseMove=function(){c.isElementDragging||b.css({cursor:"url('"+c.filePath.getImagePath("open-hand")+"'), move"})},a.onMouseDown=function(a){MathInteractives.global.SpeechStream.stopReading(),b.css({cursor:"url('"+c.filePath.getImagePath("closed-hand")+"'), move"})},a.onMouseDrag=function(a){MathInteractives.global.SpeechStream.stopReading(),c.isElementDragging=!0},a.onMouseUp=function(a){MathInteractives.global.SpeechStream.stopReading(),c.isElementDragging=!1,b.css({cursor:"url('"+c.filePath.getImagePath("open-hand")+"'), move"})},a.onMouseLeave=function(a){c.isElementDragging||b.css({cursor:"default"})}},_unbindEventsOnDraggables:function(a){a.detach("mouseenter"),a.detach("mousemove"),a.detach("mousedown"),a.detach("mousedrag"),a.detach("mouseup"),a.detach("mouseleave")},_drawDummyTackPath:function(){var a=this.model.get("circumferencePath"),b=a[70],c=this.dummyTackPath,d=this.paperScope2;null!==c&&c.remove(),this.dummyTackPath=new d.Path.Rectangle({from:[b.x-13,b.y-11],to:[b.x+1,b.y+9]})},_addEllipseEquationHolderTemplate:function(){var a=MathInteractives.Common.Components.templates.explorerShapeEllipse({idPrefix:this.idPrefix}).trim();this.$el.append(a),this.loadScreen("explorer-shape-ellipse-equation-screen")},_addCircleEquationHolderTemplate:function(){var a=MathInteractives.Common.Components.templates.explorerShapeCircle({idPrefix:this.idPrefix}).trim();this.$el.append(a),this.loadScreen("explorer-shape-circle-equation-screen")},tryAnother:function(){this.paperScope2.activate();var a,b,c,d=this.model,e=d.get("shape"),f=d.get("thumbTack"),g=d.get("foci1"),h=d.get("foci2"),i=d.get("dummyThumbTack");if(this._getRandomMajorMinorAxis(),this._setCircumferencePath(),a=d.get("circumferencePath"),f.position=a[70],i.position=a[70],d.set("thumbTack",f),this._calculateFociCenterDist(),"ellipse"===e){var j=d.get("purple"),k=d.get("red");j&&(j.removeChildren(),j.remove()),k&&(k.removeChildren(),k.remove())}else if("circle"===e){var l=d.get("black"),m=d.get("centerCoordinate");l&&l.remove(),m&&m.remove()}this._setInitialPosition(),this._snapAll(),b=f.position.subtract(g.position).length,c=f.position.subtract(h.position).length,d.set("tackToFoci1",b),d.set("tackToFoci2",c),d.set("shapeCenterSnapX",0),d.set("shapeCenterSnapY",0);var n={};n.event={},n.event.which=1,n.point=new this.paperScope2.Point(0,0),this._showShapeMouseDownFeatures(n),this._showShapeMouseUpFeatures(n),this.redBarLoded=!1,"ellipse"===e?this._redrawBar():"circle"===e&&(this._setRadiusLabel(b),this._displayCircleCenterCoordinates()),d.set("showPopupOnTryAnother",!1),"undefined"!=typeof this.collisionCircles&&null!==this.collisionCircles&&this.collisionCircles.removeChildren(),this.isAnimating=!1,this.isRedCircleShown=!1,this.trigger(this.viewStaticData.CUSTOM_EVENTS.onRedCircle,{isHidden:this.isRedCircleShown})},_snapAll:function(){this.paperScope2.activate();var a=this.model,b=a.get("foci1"),c=a.get("foci2"),d={},e=a.get("thumbTack"),f=a.get("dummyThumbTack");d.point=b.position,this._setSnappedpoints(d),b.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},d.point=c.position,this._setSnappedpoints(d),c.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},d.point=e.position,this._setSnappedpoints(d),e.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},f.position.x=e.position.x,f.position.y=e.position.y,a.set("foci1",b),a.set("foci2",c),a.set("thumbTack",e),a.set("dummyThumbTack",f),this._calculateFociCenterDist(),this._calculateMajorAxis(),this._calculateMinorAxis(),this.paperScope2.view.draw()},_getRandomMajorMinorAxis:function(){var a,b=this.model,c=Math.floor(243*Math.random()+200),d=c,e=b.get("shape");"ellipse"===e?a=200:"circle"===e&&(a=c),b.set("majorAxis",d),b.set("minorAxis",a)},_calculateFociCenterDist:function(){var a=this.model,b=a.get("majorAxis"),c=a.get("minorAxis"),d=Math.sqrt(b/2*(b/2)-c/2*(c/2));a.set("fociCenterDist",d)},_setCircumferencePath:function(){var a=this.model,b=a.get("majorAxis"),c=a.get("minorAxis"),d=a.get("center"),e=this._getPointsOnCircumference(d,b/2,c/2);a.set("circumferencePath",e)},_setRadiusLabel:function(a){var b,c=this.model,d=this.paperScope2,e=(c.get("center"),c.get("radiusLabel")),f=c.get("shapeCenter"),g=c.get("thumbTack"),h=f.position.subtract(g.position),i=new d.Point,j=new d.Point,k=new d.Path,l=h.angle,m=c.get("gridSizeXAxis"),n=c.get("restrictMovementAlongCircumference");if(this.paperScope2.activate(),a=Math.round(a),a=parseInt(a/m*10)/10,b=15*(10/a),3.7>a)return e&&e.remove(),void c.set("radiusLabel",null);k.moveTo(f.position),k.lineTo(g.position),j={x:g.position.x,y:f.position.y},i={x:(g.position.x+f.position.x)/2,y:(g.position.y+f.position.y)/2},e&&e.remove();var o=(l+360)%360;o+=n&&(o>90&&180>o||o>270&&360>o)?-b:b;var p=Math.sqrt(Math.pow(g.position.x-f.position.x,2)+Math.pow(g.position.y-f.position.y,2)),q=new d.Point(0,0);o=o*Math.PI/180,q.x=f.position.x-p/2*Math.cos(o),q.y=f.position.y-p/2*Math.sin(o),e=new d.PointText({content:"r = "+a,fontSize:14,fontWeight:"bold",fontFamily:"verdana",fillColor:"#555555",strokeColor:"#555555"}),e.position=q,e.bringToFront(),l=(h.angle+360)%360,e.rotate(l+(l>90&&180>=l?180:0)+(l>180&&270>l?180:0));var r=this.model.get("deletaXLineLabel");r&&(r.position.y>f.position.y&&e.position.y>f.position.y&&(e.position.y-=40),r.position.y<f.position.y&&e.position.y<f.position.y&&(e.position.y+=40)),c.set("radiusLabel",e),k.remove()},_setInitialPosition:function(){var a=this.model,b=a.get("shape"),c=a.get("foci1"),d=a.get("foci2"),e=a.get("center"),f=a.get("thumbTack"),g=a.get("fociCenterDist"),h=a.get("shapeCenter"),i=null,j=null,k=a.get("blackStringRaster");if("ellipse"===b){a.get("showEquation");c.position.x=e.x-g,c.position.y=e.y,d.position.x=e.x+g,d.position.y=e.y,null===h&&(h=this.rasterPattern.arrowCenter,h.position=e,h.opacity=1,this._bindEventsOnDraggables(h)),this._generateString("purple",i,c.position,f.position,!1),this._generateString("red",j,d.position,f.position,!1)}else if("circle"===b){var l=(a.get("showEquation"),a.get("circleCenter"));c.position.x=e.x,c.position.y=e.y,d.position=c.position,h=l,h.position=e,h.name="shape-center",c.sendToBack(),d.sendToBack(),this._generateString("black",k,h.position,f.position,!1),this._bindEventsOnDraggables(h)}h.position=e,h.name="shape-center",h.bringToFront(),a.set("foci1",c),a.set("foci2",d),a.set("thumbTack",f),a.set("shapeCenter",h),this._calculateAngleBisectorPoint(f.position,c.position,d.position)},_bindEvents:function(){if(null!==this.paperScope2&&"undefined"!=typeof this.paperScope2){var a=this,b=a.currentTool,c=this.model,d=c.get("shape"),e=a.$("canvas");c.get("showGraph");this.dummyGroup&&this.dummyGroup.remove(),this.dummyGroup=new this.paperScope2.Group([c.get("foci1"),c.get("foci2"),c.get("shapeCenter"),c.get("thumbTack"),c.get("dummyThumbTack")]),b.onMouseUp=function(b){(1===b.event.which||0===b.event.which)&&a.isAnimating!==!0&&(a.mouseUpCheck=!0,a.isElementDragging=!1,e.css({cursor:"default"}),null!==a.draggableElement&&"undefined"!=typeof a.draggableElement&&(a._setSnappedpoints(b),a._showShapeMouseUpFeatures(b),a.draggableElement=null))},b.onMouseDrag=function(b){(1===b.event.which||0===b.event.which)&&null!==a.draggableElement&&"undefined"!=typeof a.draggableElement&&a.isAnimating!==!0&&(a._setSnappedpoints(b),a._showShapeMouseDragFeatures(b),a._bringShapeToFront(d))},b.onMouseDown=function(b){a.isAnimating!==!0&&(1===b.event.which||0===b.event.which)&&(a._setSnappedpoints(b),a._showShapeMouseDownFeatures(b))}}},_showShapeMouseMoveFeatures:function(){var a=this;this.model.get("showGraph");a.hitResult=a.paperScope2.project.hitTest(event.point,a.hitOptions),a.paperScope2.project.activeLayer.selected=!1,a.hitResult&&a.hitResult.item&&(a.hitResult.item.selected=!0)},_showShapeMouseUpFeatures:function(a){var b,c,d,e=this,f=this.model,g=f.get("foci1"),h=f.get("foci2"),i=f.get("thumbTack"),j=(f.get("dummyThumbTack"),f.get("majorAxis")),k=f.get("minorAxis"),l=(f.get("center"),f.get("shapeCenter")),m=f.get("fociCenterDist"),n=g.position.subtract(h.position),o=f.get("restrictMovementAlongCircumference"),p=f.get("showGraph"),q=f.get("dashedShape"),r=(f.get("lableA"),f.get("lableB"),f.get("lineA"),f.get("lineB"),f.isPointValid(a.point),f.get("activityAreaStartPoint").xCoordinate),s=f.get("activityAreaStartPoint").yCoordinate,t=f.get("activityAreaEndPoint").xCoordinate,u=f.get("activityAreaEndPoint").yCoordinate,v=g.position,w=h.position,x=this.actualSnappedPointX,y=this.actualSnappedPointY,z=i.position,A=f.get("isFociMovable"),B=f.get("tackToFoci1"),C=f.get("tackToFoci2"),D=(f.get("isCenterMovable"),f.get("isThumbTackMovable"),f.get("shape")),E=f.get("animationStarted");f.get("circumferenceAlongFoci1"),f.get("circumferenceAlongFoci2");if(p&&this._setSnappedpoints(a),f.set("fociDist",n.length),f.set("fociCenterDist",n.length/2),v.y==w.y?(b=j,c=k):v.x==w.x&&(b=k,c=j),"thumb-tack"===e.draggableElement.name&&o===!1&&A){var F=a.point.subtract(g.position).length,G=a.point.subtract(h.position).length,H=a.point.subtract(l.position).length,I=a.point.x,J=a.point.y,K=e.draggableElement,L=(K.bounds,e.thumbTackHeight),M=e.thumbTackWidth;I>r+M/2&&t-M/2>I&&J>s+L/2&&u-L/2>J&&F>=57&&G>=57&&H>=57?(e.draggableElement.position.x=x,e.draggableElement.position.y=y):(I=e.draggableElement.position.x,J=e.draggableElement.position.y,r+M/2>I?I=r+15:I>t-M/2&&(I=t-10),s+L/2>J?J=s+10:J>u-L/2&&(J=u-10),e.draggableElement.position=[I,J])}if("shape-center"===e.draggableElement.name&&o===!1){(a.point.x+m>t||a.point.x-m<r)&&g.position.y===h.position.y,(a.point.y+m>u||a.point.y-m<s)&&g.position.x===h.position.x;var N={};N.point=l.position,this._setSnappedpoints(N),l.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},f.set("shapeCenter",l),f.set("shapeCenterSnapX",this.snappedX),f.set("shapeCenterSnapY",this.snappedY);var O=N.point;O={x:O.x-l.position.x,y:O.y-l.position.y},g.position.x=g.position.x-O.x,g.position.y=g.position.y-O.y,h.position.x=h.position.x-O.x,h.position.y=h.position.y-O.y,i.position.x=i.position.x-O.x,i.position.y=i.position.y-O.y,f.set("foci1",g),f.set("foci2",h),f.set("thumbTack",i)}var N={};N.point=g.position,p&&this._setSnappedpoints(N),g.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},N.point=h.position,p&&this._setSnappedpoints(N),h.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},o||(N.point=i.position,this._setSnappedpoints(N),i.position={x:this.model.get("actualSnappedPointX"),y:this.model.get("actualSnappedPointY")},f.set("thumbTack",i)),f.set("foci1",g),f.set("foci2",h),B=i.position.subtract(g.position).length,C=i.position.subtract(h.position).length,f.set("tackToFoci1",B),f.set("tackToFoci2",C),this._calculateMajorAxis(),this._calculateMinorAxis(),j=this.model.get("majorAxis"),k=this.model.get("minorAxis"),v.y==w.y?(b=j,c=k):v.x==w.x&&(b=k,c=j),d=e._getPointsOnCircumference(l.position,b/2,c/2),f.set("circumferencePath",d),e._calculateAngleBisectorPoint(z,v,w),l.bringToFront(),e._drawDummyEllipseShape(),e._getInterSectingBubbles(),e._setTackPosition(),e._redrawStrings(),E||(f.set("isFociMovable",!0),f.set("isCenterMovable",!0)),q&&(f.set("isCenterMovable",!1),f.set("isFociMovable",!1)),this._bringShapeToFront(D),"circle"===D&&(e._setRadiusLabel(B),e._displayCircleCenterCoordinates()),this.redBarLoded=!1,"ellipse"===this.model.get("shape")&&this._redrawBar(),o===!1&&this.isAnimating===!1&&(e.isRedCircleShown=e._showCollisionCircle()),e.trigger(e.viewStaticData.CUSTOM_EVENTS.onRedCircle,{isHidden:e.isRedCircleShown})},_moveFociAlongwithcenter:function(a,b,c){var d=this.model,e=d.get("isFociMovable"),f=a.position,g=b.position,h=this.draggableElement.position,i=d.get("activityAreaStartPoint").xCoordinate,j=d.get("activityAreaStartPoint").yCoordinate,k=d.get("activityAreaEndPoint").xCoordinate,l=d.get("activityAreaEndPoint").yCoordinate;e&&(f.y==g.y&&(h.x-c>i&&h.x-c<k?a.position.x=h.x-c:(d.set("isFociMovable",!1),d.set("isCenterMovable",!1)),h.y>j&&h.y<l?a.position.y=h.y:(d.set("isFociMovable",!1),d.set("isCenterMovable",!1)),h.x+c>i&&h.x+c<k?b.position.x=h.x+c:(d.set("isFociMovable",!1),d.set("isCenterMovable",!1)),h.y>j&&h.y<l?b.position.y=h.y:(d.set("isFociMovable",!1),d.set("isCenterMovable",!1))),f.x==g.x&&(h.y-c>j&&h.y-c<l?a.position.y=h.y-c:(d.set("isFociMovable",!1),d.set("isCenterMovable",!1)),h.x>i&&h.x<k?a.position.x=h.x:(d.set("isFociMovable",!1),d.set("isCenterMovable",!1)),h.y+c>j&&h.y+c<l?b.position.y=h.y+c:(d.set("isFociMovable",!1),d.set("isCenterMovable",!1)),h.x>i&&h.x<k?b.position.x=h.x:(d.set("isFociMovable",!1),d.set("isCenterMovable",!1)))),d.set("foci1",a),d.set("foci2",b)},_showShapeMouseDownFeatures:function(a){var b=this,c=this.model.get("shape"),d=this.model.get("showGraph");d&&this._setSnappedpoints(a),b.hitResult=b.paperScope2.project.hitTest(a.point,b.hitOptions),b.hitResult&&("thumb-tack"===b.hitResult.item.name?b.draggableElement=b.model.get("thumbTack"):b.draggableElement=b.hitResult.item,b.shapeCenter={x:b.draggableElement.position.x,y:b.draggableElement.position.y}),this._bringShapeToFront(c)},_showShapeMouseDragFeatures:function(a){var b,c,d,e=this,f=e.model,g=f.get("thumbTack"),h=f.get("dummyThumbTack"),i=f.get("foci1"),j=f.get("foci2"),k=f.get("tackToFoci1"),l=f.get("tackToFoci2"),m=f.get("shapeCenter"),n=f.get("dashedShape"),o=this.paperScope2,p=i.position.subtract(j.position),q=p.length,r=f.get("restrictMovementAlongCircumference"),s=f.get("shape"),t=f.get("showGraph"),u=f.get("activityAreaStartPoint").xCoordinate,v=f.get("activityAreaStartPoint").yCoordinate,w=f.get("activityAreaEndPoint").xCoordinate,x=f.get("activityAreaEndPoint").yCoordinate,y=(e.draggableElement.position,
g.position,f.get("isCenterMovable")),z=f.get("isThumbTackMovable"),A=f.get("circumferencePath"),B=(f.get("circumferenceAlongFoci1"),f.get("circumferenceAlongFoci2"),!1),C=!1,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null;if(t&&this._setSnappedpoints(a),d=f.get("isFociMovable"),f.set("fociDist",q),f.set("fociCenterDist",q/2),c=f.isPointValid(a.point),"thumb-tack"==e.draggableElement.name){if(f.set("showPopupOnTryAnother",!0),z)if(r===!1){var N=a.point.subtract(i.position).length,O=a.point.subtract(j.position).length,P=a.point.subtract(m.position).length,Q=a.point.x,R=a.point.y,S=e.draggableElement,T=(S.bounds,e.thumbTackHeight),U=e.thumbTackWidth;N>=57&&O>=57&&P>=57?(Q>u+U/2&&w-U/2>Q?(e.draggableElement.position.x=a.point.x,h.position.x=a.point.x):B=!0,R>v+T/2&&x-T/2>R?(e.draggableElement.position.y=a.point.y,h.position.y=a.point.y):B=!0):Q>u+U/2&&w-U/2>Q&&R>v+T/2&&x-T/2>R?(e.draggableElement.position=a.point,h.position=a.point):B=!0,e._calculateMajorAxis(),e._calculateMinorAxis()}else b=e._getNearestPoint(a.point,A),null!==b&&(e.draggableElement.position=b,h.position=b),"circle"===s&&this.circleDrawLabel();B===!1&&e.afterFirstAnimate===!0&&(e.focusRect.position=g.position),this.model.set("thumbTackAcc",B)}if(("ellipse-foci1"==e.draggableElement.name||"ellipse-foci2"==e.draggableElement.name)&&(f.set("showPopupOnTryAnother",!0),e._adjustFociPosition(a,e.draggableElement),D=f.get("fociAcc"),D===!1&&("ellipse-foci1"===e.draggableElement.name&&e.afterFirstAnimate===!0?e.focusRect.position=i.position:"ellipse-foci2"===e.draggableElement.name&&e.afterFirstAnimate===!0&&(e.focusRect.position=j.position))),"shape-center"==e.draggableElement.name&&!n){if(f.set("showPopupOnTryAnother",!0),y){this.dummyGroup&&(this.dummyGroup.remove(),this.dummyGroup=new o.Group([i,j,g,h,m])),E=m.position.clone(),F={x:E.x-a.point.x,y:E.y-a.point.y},this.dummyGroup.position.x-=F.x,this.dummyGroup.position.y-=F.y,I=o.Path.Rectangle({x:i.position.x-i.width/2,y:i.position.y-i.height/2,width:i.width,height:i.height}),J=o.Path.Rectangle({x:j.position.x-j.width/2,y:j.position.y-j.height/2,width:j.width,height:j.height}),K=o.Path.Rectangle({x:g.position.x-e.thumbTackWidth/2,y:g.position.y-e.thumbTackHeight/2,width:e.thumbTackWidth,height:e.thumbTackHeight}),L=o.Path.Rectangle({x:i.position.x-e.thumbTackWidth/2,y:i.position.y-e.thumbTackHeight/2,width:e.thumbTackWidth,height:e.thumbTackHeight}),M=o.Path.Rectangle({x:m.position.x-m.width/2,y:m.position.y-m.height/2,width:m.width,height:m.height}),H=new o.Group([I,J,K,L,M]),G=H.bounds,0!==F.x&&(G.x<u&&(this.dummyGroup.position.x-=G.x-u,C=!0),G.x+G.width>w&&(this.dummyGroup.position.x-=G.x+G.width-w,C=!0)),0!==F.y&&(G.y<v&&(this.dummyGroup.position.y-=G.y-v,C=!0),G.y+G.height>x&&(this.dummyGroup.position.y-=G.y+G.height-x,C=!0));var V={};V.point=m.position,this._setSnappedpoints(V),f.set("shapeCenterSnapX",this.snappedX),f.set("shapeCenterSnapY",this.snappedY),f.set("centerAcc",C),H.remove(),I.remove(),J.remove(),K.remove(),L.remove(),M.remove()}C===!1&&e.afterFirstAnimate===!0&&(e.focusRect.position=m.position)}k=g.position.subtract(i.position).length,l=g.position.subtract(j.position).length,f.set("tackToFoci1",k),f.set("tackToFoci2",l),f.set("thumbTack",g),f.set("shapeCenter",m),e._calculateMajorAxis(),e._calculateMinorAxis(),e._redrawStrings(),"ellipse"===s?e._redrawBar():"circle"===s&&(e._setRadiusLabel(k),e._displayCircleCenterCoordinates()),e._calculateAngleBisectorPoint(g.position,i.position,j.position),r===!1&&this.isAnimating===!1&&(e.isRedCircleShown=e._showCollisionCircle())},_showCollisionCircle:function(){var a=this.model,b=a.get("shape"),c=a.get("foci1"),d=a.get("foci2"),e=a.get("shapeCenter"),f=a.get("thumbTack"),g=f.position.subtract(c.position).length,h=null,i=null,j=!1;return"undefined"==typeof this.collisionCircles&&(this.collisionCircles=new this.paperScope2.Group),this.collisionCircles.removeChildren(),"ellipse"===b&&(h=f.position.subtract(d.position).length,i=f.position.subtract(e.position).length),"ellipse"===b?(57>g&&(this.drawRedCircle(c.position),j=!0),57>h&&(this.drawRedCircle(d.position),j=!0),57>i&&(this.drawRedCircle(e.position),j=!0)):"circle"===b&&57>g&&(this.drawRedCircle(c.position),j=!0),this.trigger(MathInteractives.Common.Components.Views.ExplorerShape.CUSTOM_EVENTS.onInsideCollisionCircle,j),j},drawRedCircle:function(a){var b=new this.paperScope2.Path.Circle({center:a,radius:56,fillColor:"#ff0000",opacity:.35});this.collisionCircles.addChild(b)},_drawDummyEllipseShape:function(){var a=this,b=this.model,c=a.paperScope2,d=b.get("majorAxis"),e=b.get("minorAxis"),f=b.get("shapeCenter"),g=(b.get("thumbTack"),b.get("foci1")),h=b.get("foci2"),i=[d,e],j=null,k=a.dummyEllipse;j=null!==f?f.position:b.get("originPosition"),null!==k&&this.dummyEllipse.remove(),g.position.x===h.position.x&&(i=[e,d]),this.dummyEllipse=new c.Path.Ellipse({center:[j.x,j.y],size:i,strokeWidth:10}),this.dummyEllipse.sendToBack()},_getInterSectingBubbles:function(){var a=this,b=a.model,c=this.dummyEllipse,d=null,e=null,f=null,g=null,h=[],i=0,j=(b.get("smallBubbleGroup"),b.get("largeBubbleGroup"),b.get("middleBubbleGroup"),0),k=null,l=null,h=[],m=b.get("showPoppedBubbles"),n=new Array,o=b.get("allBubbleGroup");for(i=0;i<o.children.length;i++)for(k=o.children[i],j=0;j<k.children.length;j++)l=k.children[j].children[0],l.bringToFront(),d=l.getIntersections(c),e=c.getIntersections(l),f=l.intersect(c),g=c.intersect(l),l.sendToBack(),(d.length>0||e.length>0)&&(h.push(l),n.push(l)),f.remove(),g.remove();if(m)for(i=0;i<n.length;i++)n[i].parent.remove();b.set("intersectBubblesArray",h),b.set("noOfBubblesToPop",h.length)},_setBoundsForBubbles:function(){var a=this.model,b=a.getStartPointBubble(),c=a.getEndPointBubble(),d=b.xCoordinate,e=b.yCoordinate,f=c.xCoordinate,g=c.yCoordinate,h=15,i={};this.minXBubbleBound=d+h,this.minYBubbleBound=e+h,this.maxXBubblebound=f-h,this.maxYBubbleBound=g-h,i.x=(f-d)/2+d,i.y=(g-e)/2+e,this.bubblesBoundsCenter=i,a.set("bubblesBoundsCenter",i)},generateBubbles:function(){this.paperScope2.activate(),this.isAnimating=!0;var a=this.model,b=this.viewStaticData,c=b.RADIUS_OF_BUBBLES,d=(b.POSITION_OF_BUBBLE,[]),e=null,f=a.get("generateNewBubbles"),g=this.paperScope2,h=!1,i=(new Array,a.get("largeBubbleGroup")),j=a.get("shape"),k=null,l=new g.Group,m=a.get("showEquation"),n=null,o=null,p=null,q=null,r=a.get("populateBubble"),s=null;if(this._unbindEventsOnDraggables(a.get("foci1")),this._unbindEventsOnDraggables(a.get("foci2")),this._unbindEventsOnDraggables(a.get("shapeCenter")),this._unbindEventsOnDraggables(a.get("thumbTack")),this._unbindEventsOnDraggables(a.get("dummyThumbTack")),"undefined"==typeof this.bubbleGroup&&(this.bubbleGroup=new this.paperScope2.Group),m&&"ellipse"===j&&this._showHideEllipseEquation(!1),m&&"circle"===j&&this._showHideCircleEquation(!1),e=c.largeBubbleRadius,null!==i&&(h=!0,a.set("intersectBubblesArray",null),this._clearBubbles(),a.set("largeBubbleGroup",null),a.set("middleBubbleGroup",null),a.set("smallBubbleGroup",null),a.set("dummyBubblePath",[])),f){for(q=a.setPositionsOfBubbles(),s=q.length,o=Math.floor(s/3),d=[],p=0;o>p;p++)n=a.generateRandomNumber(0,q.length-2),d.push(q[n]),q.splice(n,1);a.set("currentLargeBubblesPosition",d)}else d=a.get("currentLargeBubblesPosition");if(k=this._drawBubble(this.rasterPattern.largeBubble,d,e),l.addChild(k),a.set("largeBubbleGroup",k),e=c.middleBubbleRadius,f){for(d=[],p=0;o>p;p++)n=a.generateRandomNumber(0,q.length-2),d.push(q[n]),q.splice(n,1);a.set("currentMiddleBubblesPosition",d)}else d=a.get("currentMiddleBubblesPosition");k=this._drawBubble(this.rasterPattern.middleBubble,d,e),l.addChild(k),a.set("middleBubbleGroup",k),e=c.smallBubbleRadius,f?(d=q,a.set("currentSmallBubblesPosition",d)):d=a.get("currentSmallBubblesPosition"),k=this._drawBubble(this.rasterPattern.smallBubble,d,e,!0),a.set("smallBubbleGroup",k),l.addChild(k),a.set("allBubbleGroup",l),a.get("allBubbleGroup").sendToBack(),this._drawDummyEllipseShape(),this._drawDummyTackPath(),this._setTackPosition(),this._getInterSectingBubbles(),a.get("thumbTack").bringToFront(),this._bringShapeToFront(j),r&&(this.trigger(b.CUSTOM_EVENTS.bubblePopulationAnimationStart),this.populateBubble())},_createRaster:function(a,b){var c=this,d=null;return d=new c.paperScope2.Raster({source:c.currentImage,position:[a,b]})},_clearBubbles:function(){var a=this,b=a.model,c=b.get("allBubbleGroup");c.remove(),b.set("allBubbleGroup",null)},_drawBubble:function(a,b,c,d){var e=this.viewStaticData,f=this.paperScope2,g=this.model,h=null,i=null,j=null,k=null,l=(g.get("populateBubble"),null),e=this.viewStaticData,m=e.RADIUS_OF_BUBBLES,n=m.largeBubbleRadius,o=m.smallBubbleRadius,p=(m.middleBubbleRadius,new f.Group),c=c||n,q=null,r=b.length;for(l=a,j=0;r>j;j++)h=b[j][0],i=b[j][1],q=c===n?new f.Path.Circle({radius:c,center:[h-5,i-5]}):c===o?new f.Path.Circle({radius:c,center:[h-3,i-3]}):new f.Path.Circle({radius:c,center:[h-2,i-2]}),k=l.clone(),k.opacity=1,k.position=[h,i],p.addChild(new f.Group(q,k));return p},populateBubble:function(){var a=this.model,b=this,c=null,d=null,e=a.get("allBubbleGroup"),f=null,g=!0,h=this.paperScope2,i=h.view,j=e.children.length,k=!0,l=!0,m=!0,n=!0,o=!0,p=e.children[2],q=p.children[0].children[1].bounds,r=q.width,s=(q.height,e.children[1]),t=s.children[0].children[1].bounds,u=t.width,v=(t.height,e.children[0]),w=v.children[0].children[1].bounds,x=w.width;w.height;for(d=0;j>d;d++)for(f=e.children[d].children.length,c=0;f>c;c++)e.children[d].children[c].children[1].scale(.3);var y=setInterval(function(){if(p.children[0].children[1].bounds.width<=r&&g)for(d=0;d<p.children.length;d++)p.children[d].children[1].scale(1.12);else if(g=!1,p.children[0].children[1].bounds.width>=7*r/10&&k)for(d=0;d<p.children.length;d++)p.children[d].children[1].scale(.88);else g=!0,k=!1;if(v.children[0].children[1].bounds.width<=x&&n)for(d=0;d<v.children.length;d++)v.children[d].children[1].scale(1.1);else if(n=!1,v.children[0].children[1].bounds.width>=7*x/10&&o)for(d=0;d<v.children.length;d++)v.children[d].children[1].scale(.9);else n=!0,o=!1;if(s.children[0].children[1].bounds.width<=u&&l)for(d=0;d<s.children.length;d++)s.children[d].children[1].scale(1.09);else if(l=!1,m||(a.set("populateBubble",!1),a.set("generateNewBubbles",!1),b.generateBubbles(),b.player.enableAllHeaderButtons(!0),b._initialAniamtion(),clearInterval(y)),s.children[0].children[1].bounds.width>=7*u/10&&m)for(d=0;d<s.children.length;d++)s.children[d].children[1].scale(.91);else l=!0,m=!1;i.draw()},30)},_getNearestPoint:function(a,b){for(var c,d=this.model,e=0,f=d.get("thumbTack").bounds,g=f.height,h=f.width,i=null,j=1e4,k=d.get("activityAreaStartPoint"),l=d.get("activityAreaEndPoint"),m=k.xCoordinate,n=k.yCoordinate,o=l.xCoordinate,p=l.yCoordinate;360>=e;e++)c=a.subtract(b[e]).length,j>c&&(j=c,i=b[e]);return i?m+h/2>i.x||o-h/2<i.x||n+g/2>i.y||p-g/2<i.y?i=null:i:i=null},_updateFociToTackDistance:function(){var a,b,c,d,e=this.model;c=e.get("foci1"),d=e.get("foci2"),b=e.get("thumbTack"),tackToFoci1=b.position.subtract(c.position).length,a=b.position.subtract(d.position).length,e.set("tackToFoci1",tackToFoci1),e.set("tackToFoci2",a)},_adjustFociPosition:function(a,b){var c,d=this.model,e=d.get("shape"),f=d.get("foci1"),g=d.get("foci2"),h=(d.get("center"),d.get("shapeCenter")),i=d.get("isFociMovable"),j=d.get("activityAreaStartPoint").xCoordinate,k=d.get("activityAreaStartPoint").yCoordinate,l=d.get("activityAreaEndPoint").xCoordinate,m=d.get("activityAreaEndPoint").yCoordinate,n=b.position,o=b.bounds.height/2,p=b.bounds.width/2,q=!1;if("ellipse"==e){if(i===!0){var r,s=a.point.x-b.position.x,t=a.point.y-b.position.y;d.get("fociDsit");"ellipse-foci1"==b.name?(r=g,c=r.position):"ellipse-foci2"==b.name&&(r=f,c=r.position),"raster"==b.type&&(r.position.x>j+p&&r.position.x<l-p&&r.position.y>k+p&&r.position.y<m-p?(Math.round(b.position.y)==Math.round(h.position.y)&&(n.x+s>=j+p&&n.x+s<l-p?r&&(c.x-s>j+p&&c.x-s<l-p?(b.position.x=b.position.x+s,r.position.x=r.position.x-s):q=!0):q=!0,this.isFociDraggable(b,!0)===!1&&(b.position=h.position,r&&(r.position=h.position))),Math.round(b.position.x)==Math.round(h.position.x)&&(n.y+t>k+o&&n.y+t<m-o?r&&(c.y-t>k+o&&c.y-t<m-o?(b.position.y=b.position.y+t,r.position.y=r.position.y-t):q=!0):q=!0,this.isFociDraggable(b)===!1&&(b.position=h.position,r&&(r.position=h.position)))):q=!0,h.bringToFront())}else"circle"==e&&(f.position=h.position,g.position=h.position,h.bringToFront());d.set("foci1",f),d.set("foci2",g),d.set("fociAcc",q)}},isFociDraggable:function(a,b){var c=this.model,d=(c.get("shape"),c.get("foci1")),e=c.get("foci2"),f=c.get("shapeCenter"),g=f.position;if(b===!0){if("ellipse-foci1"===a.name&&d.position.x<=g.x)return!0;if("ellipse-foci2"===a.name&&e.position.x>=g.x)return!0}else{if("ellipse-foci1"===a.name&&d.position.y<=g.y)return!0;if("ellipse-foci2"===a.name&&e.position.y>=g.y)return!0}return!1},_updateCenter:function(a){this.set("center",a)},_calculateMajorAxis:function(){var a,b,c,d=this.model;a=d.get("tackToFoci1"),b=d.get("tackToFoci2"),c=a+b,d.set("majorAxis",c)},_calculateMinorAxis:function(){var a=this.model,b=a.get("foci1"),c=a.get("foci2"),d=b.position.subtract(c.position).length,e=a.get("tackToFoci1"),f=a.get("tackToFoci2"),g=e+f,h=Math.sqrt(g*g-d*d);a.set("minorAxis",h)},_getPointsOnCircumference:function(a,b,c){for(var d=this.model,e=new Array,f=0,g=Math.PI/180;360>=f;f++){var h=new this.paperScope2.Point(0,0);h.x=a.x+b*Math.cos(f*g),h.y=a.y+c*Math.sin(f*g),e.push(h)}return e=e.reverse(),d.set("circumferencePath",e),e},_getPointIndex:function(a){for(var b,c=this.model,d=0,e=c.get("thumbTack"),f=c.get("circumferencePath");360>=d;d++)f[d].x===e.position.x&&f[d].y===e.position.y&&(b=d);return b},_getCurrentPointIndex:function(a){var b,c,d=this.model,e=0,f=1e4,g=d.get("circumferencePath");if("undefined"==typeof b)for(e=0;360>=e;e++)c=a.subtract(g[e]).length,f>c&&(f=c,b=e);return b},_calculateAngleBisectorPoint:function(){var a,b,c,d,e,f=this.model,g=f.get("foci1"),h=f.get("foci2"),i=f.get("thumbTack"),j=f.get("dummyThumbTack"),k=(f.get("center"),f.get("shapeCenter")),l=f.get("shape"),m=g.position.subtract(i.position),n=h.position.subtract(i.position),o=new this.paperScope2.Path,p=f.get("prevAngle");o.strokeColor="black",c=i.position,o.moveTo(c),o.lineTo(h.position),"ellipse"===l?e=-81:"circle"===l&&(e=-75),Math.round(g.position.y)==Math.round(h.position.y)?(a=Math.abs(Math.abs(m.angle)-Math.abs(n.angle)),b=i.position.y>k.position.y?-a/2:a/2):(g.position.x=h.position.x,Math.round(g.position.x)==Math.round(h.position.x)&&(i.position.x>k.position.x?i.position.y<g.position.y&&i.position.y<h.position.y?a=Math.abs(Math.abs(m.angle)-Math.abs(n.angle)):i.position.y>=g.position.y&&i.position.y<=h.position.y?a=360-Math.abs(Math.abs(m.angle)+Math.abs(n.angle)):i.position.y>g.position.y&&i.position.y>h.position.y&&(a=Math.abs(Math.abs(n.angle)-Math.abs(m.angle))):i.position.y<g.position.y&&i.position.y<h.position.y?a=Math.abs(Math.abs(n.angle)-Math.abs(m.angle)):i.position.y>=g.position.y&&i.position.y<=h.position.y?a=Math.abs(Math.abs(m.angle)+Math.abs(n.angle)):i.position.y>g.position.y&&i.position.y>h.position.y&&(a=Math.abs(Math.abs(m.angle)-Math.abs(n.angle))),b=i.position.x>k.position.x?a/2:-a/2)),0===this.model.get("minorAxis")&&((null===this.prevPosition||"undefined"==typeof this.prevPosition)&&(this.prevPosition=i.position),b=this.prevPosition.y>i.position.y||this.prevPosition.x>i.position.x?90:270,this.prevPosition=i.position),isNaN(i.position.x)||isNaN(i.position.y),o.rotate(b,i.position),d=o.segments[1].point.subtract(o.segments[0].point),null!=p?(isNaN(d.angle-p),0===this.model.get("minorAxis")&&d.angle-p===90&&(d.angle=p),i.rotate(d.angle-p),j.rotate(d.angle-p)):(i.rotate(e),j.rotate(e)),f.set("prevAngle",d.angle),j.bringToFront(),o&&o.remove()},_animateAlongCircumference:function(){this.paperScope2.activate();var a,b,c,d=this.model,e=d.get("thumbTack"),f=d.get("dummyThumbTack"),g=e.position,h=d.get("currentPointIndex"),i=d.get("lastIndex"),j=d.get("foci1"),k=d.get("foci2"),l=d.get("circumferencePath"),m=this,n=(d.get("shapeCenter"),d.get("restrictMovementAlongCircumference")),o=d.get("isFociMovable"),p=!0,q=d.get("showEquation"),r=d.get("shape");h||0==h||(h=this._getCurrentPointIndex(g),"undefined"==typeof h&&(h=0),d.set("positionCounter",h),d.set("currentPointIndex",h)),c=d.get("positionCounter"),i>=c?("undefined"==typeof l[c]&&(c=l.length-1),this._calculateAngleBisectorPoint(e.position,j.position,k.position),e.position=l[c],f.position=l[c],m._setTackPosition(l[c-2]),m._popOutInterSectingBubbles(),d.set("positionCounter",c+4),this.lastIndexChanged===!0&&c+4>=i&&(this.isAnimating=!1,e.position=l[i],f.position=l[i],m._setTackPosition(l[c-2]),this._drawShape(),n=!0,d.set("restrictMovementAlongCircumference",n),o=!1,d.set("isFociMovable",o),q&&"ellipse"===r&&this._showHideEllipseEquation(!0),q&&"circle"===r&&this._showHideCircleEquation(!0),this._bindEventsOnDraggables(f),p=!1),p===!0&&(null!==this.interval&&(clearTimeout(this.interval),this.interval=null),this.interval=setTimeout(function(){m._animateAlongCircumference()},this.timeOutInterval))):i!=h&&(d.set("positionCounter",0),d.set("lastIndex",h),this.lastIndexChanged=!0,null!==this.interval&&(clearTimeout(this.interval),this.interval=null),this.animateFirstTime===!0?(m._animateAlongCircumference(),this.animateFirstTime=!1):this.interval=setTimeout(function(){m._animateAlongCircumference()},this.timeOutInterval)),a=e.position.subtract(j.position).length,b=e.position.subtract(k.position).length,d.set("tackToFoci1",a),d.set("tackToFoci2",b),this._redrawStrings(),"ellipse"===r?(this._redrawBar(),this.redBarLoded=!0):"circle"===r&&this._setRadiusLabel(a),this._bringShapeToFront(r),p===!1&&(this.redBarLoded=!1,d.set("animationStarted",!1),d.set("isThumbTackMovable",!0),this._calculateAngleBisectorPoint(e.position,j.position,k.position),"ellipse"===r&&this.ellipseDrawLabel(),this.interval=setTimeout(function(){m.trigger(MathInteractives.Common.Components.Views.ExplorerShape.CUSTOM_EVENTS.animationCompleate)},0),this._bringShapeToFront(r)),this.paperScope2.view.draw()},ellipseDrawLabel:function(){var a,b,c,d,e,f,g,h,i=this.model,j=i.get("majorAxis"),k=i.get("minorAxis"),l=(i.get("center"),i.get("shapeCenter")),m=i.get("foci1"),n=i.get("foci2"),o=(i.get("tackToFoci1"),i.get("tackToFoci2"),i.get("shape")),p=this.paperScope2,q=null,r=null,s=i.get("shapeCenterSnapX"),t=i.get("shapeCenterSnapY");"ellipse"===o&&(m.position.x===n.position.x&&(q=j,j=k,k=q),a=new p.Point(l.position.x,l.position.y),b=new p.Point(l.position.x,l.position.y-k/2),c=a.subtract(b),d=new p.Point(a.x-15,a.y+25),r=this.renderString("("+s+", "+t+")",d,0),g=this._drawDashedLine(a,b),d=new p.Point(a.x-20,a.y-c.length/2),e=m.position.x===n.position.x?this.renderString(this.getMessage("diagram-label-ellipse",0),d,0):this.renderString(this.getMessage("diagram-label-ellipse",1),d,0),a=new p.Point(l.position.x,l.position.y),b=new p.Point(l.position.x+j/2,l.position.y),c=a.subtract(b),h=this._drawDashedLine(a,b),d=new p.Point(a.x+c.length/2,b.y+20),f=m.position.x===n.position.x?this.renderString(this.getMessage("diagram-label-ellipse",1),d,0):this.renderString(this.getMessage("diagram-label-ellipse",0),d,0),i.set("lineA",g),i.set("lineB",h),i.set("lableA",e),i.set("lableB",f),i.set("ellipseCenterCoordinate",r))},_drawShape:function(){this.paperScope2.activate();var a,b,c=this.model,d=c.get("majorAxis"),e=c.get("minorAxis"),f=c.get("center"),g=c.get("shapeCenter"),h=c.get("foci1"),i=c.get("foci2"),j=(c.get("tackToFoci1"),c.get("tackToFoci2"),c.get("shape"));this.paperScope2,c.get("shapeCenterSnapX"),c.get("shapeCenterCircle"),c.get("shapeCenterSnapY");h.position.x===i.position.x?a=[e,d]:h.position.y===i.position.y&&(a=[d,e]),this.dashedShapeGroup=this._drawEllipse(f,d,e),this.dashedShapeGroup.strokeColor="gray",b=this.dashedShapeGroup,b.opacity=.4,b.bounds.center=[g.position.x,g.position.y],b.sendToBack(),c.set("dashedShape",b),"circle"===j&&this.circleDrawLabel()},_drawEllipse:function(a,b,c){var d,e,f,g,h,i,j,k=this.paperScope2,l=new this.paperScope2.Group,m=this.model.get("gridSizeXAxis");if(b/=2,c/=2,this.model.get("foci1").position.x===this.model.get("foci2").position.x){var n=b;b=c,c=n}for(j="circle"===this.model.get("shape")?Math.round(b/m*10)/10:Math.round(Math.max(b,c)/m*10)/10,i=4*(10/j),d=0;360>d;d+=i)e=new k.Path,h=d*Math.PI/180,f=a.x+b*Math.cos(h),g=a.y+c*Math.sin(h),e.add(new k.Point(f,g)),h=(d+i/2)*Math.PI/180,f=a.x+b*Math.cos(h),g=a.y+c*Math.sin(h),e.add(new k.Point(f,g)),e.closed=!0,l.addChild(e);return l},_displayCircleCenterCoordinates:function(){var a,b=this.model,c=b.get("shapeCenter"),d=b.get("thumbTack"),e=this.paperScope2,f=this._getStringAngle(c.position,d.position),g=b.get("centerCoordinate"),h=b.get("shapeCenterSnapX"),i=b.get("shapeCenterSnapY"),j=new e.Point(c.position.x,c.position.y),k=new e.Point(d.position.x,c.position.y);g&&g.remove(),f>=0?(a=new e.Point(j.x-12,k.y-18),g=this.renderString("("+h+", "+i+")",a,0)):(a=new e.Point(j.x-12,k.y+25),g=this.renderString("("+h+", "+i+")",a,0)),b.set("centerCoordinate",g)},circleDrawLabel:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this.model,s=(r.get("center"),r.get("thumbTack")),t=r.get("shapeCenter"),u=this.paperScope2,v=r.get("circlePoint"),w=r.get("centerCoordinate"),x=this._getStringAngle(t.position,s.position),y=r.get("gridSizeYAxis"),z=(r.get("shapeCenterSnapX"),r.get("shapeCenterSnapY"),null),A=null,B=(r.get("restrictMovementAlongCircumference"),s.position,null),C=t.position;null!==this.deltaGroup&&this.deltaGroup.remove(),v&&v.remove(),w&&w.remove(),a=new u.Point(t.position.x,t.position.y),d=new u.Point(s.position.x,t.position.y),g=this._drawDashedLine(a,d),e=a.subtract(d),r.set("circleDeltaX",Math.round(e.length/y)),z=d,p=(z.x-C.x)/y,q=(z.y-C.y)/y,p=parseInt(10*p)/10,q=parseInt(10*q)/10;var D=parseInt(100*p)/100,E=Math.round(D),F=Math.abs(D-E);(1>F&&F>.9||F>0&&.1>F)&&(p=E),D=parseInt(100*q)/100,E=Math.round(D),F=Math.abs(D-E),(1>F&&F>.9||F>0&&.1>F)&&(q=E),v=new this.paperScope2.Path.Circle({center:d,radius:5,strokeColor:"#555555",fillColor:"#555555"}),b=new u.Point(s.position.x,s.position.y),c=d,i=this._drawDashedLine(c,b),f=b.subtract(c),r.set("circleDeltaY",Math.round(f.length/y)),A=s.position,n=(A.x-t.position.x)/y,o=(t.position.y-A.y)/y,B=Number(n.toFixed(1)),0===B&&(n=B),B=Number(o.toFixed(1)),0===B&&(o=B),n=parseInt(10*n)/10,o=parseInt(10*o)/10;var D=parseInt(100*n)/100,E=Math.round(D),F=Math.abs(D-E);(1>F&&F>.9||F>0&&.1>F)&&(n=E),D=parseInt(100*o)/100,E=Math.round(D),F=Math.abs(D-E),(1>F&&F>.9||F>0&&.1>F)&&(o=E),x>=0&&(k=new u.Point(a.x-15,d.y-18),k=new u.Point(d.x-15,d.y-18),l=this.renderString("("+p+", "+q+")",k,0),k=new u.Point(b.x-15,b.y+25),m=this.renderString("("+n+", "+o+")",k,0),x>90?(k=new u.Point(a.x-e.length/2,d.y-18),h=this.renderString(this.getMessage("diagram-label-circle",0),k,0),k=new u.Point(c.x-28,b.y-f.length/2),j=this.renderString(this.getMessage("diagram-label-circle",1),k,0)):(k=new u.Point(a.x+e.length/2,d.y-18),h=this.renderString(this.getMessage("diagram-label-circle",0),k,0),k=new u.Point(c.x+18,b.y-f.length/2),j=this.renderString(this.getMessage("diagram-label-circle",1),k,0))),0>x&&(k=new u.Point(a.x-15,d.y+25),k=new u.Point(d.x-15,d.y+25),l=this.renderString("("+p+", "+q+")",k,0),k=new u.Point(b.x-15,b.y-18),m=this.renderString("("+n+", "+o+")",k,0),x>-90?(k=new u.Point(a.x+e.length/2,d.y+25),h=this.renderString(this.getMessage("diagram-label-circle",0),k,0),k=new u.Point(c.x+18,b.y+f.length/2),j=this.renderString(this.getMessage("diagram-label-circle",1),k,0)):(k=new u.Point(a.x-e.length/2,d.y+25),h=this.renderString(this.getMessage("diagram-label-circle",0),k,0),k=new u.Point(c.x-28,b.y+f.length/2),j=this.renderString(this.getMessage("diagram-label-circle",1),k,0))),r.set("deletaXLine",g),r.set("circlePoint",v),r.set("deletaXLineLabel",h),r.set("centerCoordinate",w),r.set("circlePointCoordinate",l),r.set("deltaYLine",i),r.set("deletaYLineLabel",j),r.set("thumbTackCoordinate",m),this.deltaGroup=new u.Group(g,v,h,w,l,i,j,m),v.moveBelow(s)},clearElementsOnCanvas:function(){var a=this.model,b=a.get("shape"),c=a.get("lableA"),d=a.get("lableB"),e=a.get("lineA"),f=a.get("lineB"),g=a.get("dashedShape"),h=a.get("deletaXLine"),i=a.get("deletaXLineLabel"),j=a.get("deltaYLine"),k=a.get("deletaYLineLabel"),l=a.get("circlePoint"),m=a.get("centerCoordinate"),n=a.get("circlePointCoordinate"),o=a.get("thumbTackCoordinate"),p=(a.get("radiusString"),a.get("shapeCenterCircle")),q=a.get("shapeCenter"),r=a.get("isReplay"),s=a.get("ellipseCenterCoordinate");this.redBarLoded=!1,"ellipse"===b&&(g&&(c&&c.remove(),d&&d.remove(),e&&e.remove(),f&&f.remove(),s&&s.remove(),r||(p.opacity=0,q.opacity=1,p.sendToBack(),q.bringToFront()),g.remove()),a.set("lableA",null),a.set("lableB",null),a.set("lineA",null),a.set("lineB",null),a.set("dashedShape",null),a.set("ellipseCenterCoordinate",null),a.set("isCenterMovable",!0)),"circle"===b&&(g&&(g.remove(),h&&h.remove(),i&&i.remove(),j&&j.remove(),k&&k.remove(),l&&l.remove(),m&&m.remove(),n&&n.remove(),o&&o.remove()),a.set("dashedShape",null),a.set("deletaXLine",null),a.set("deletaXLineLabel",null),a.set("deltaYLine",null),a.set("deletaYLineLabel",null),a.set("circlePoint",null),a.set("circlePointCoordinate",null),a.set("thumbTackCoordinate",null),a.set("radiusString",null))},_popAllIntersectingBubbles:function(){for(var a=this.model.get("circumferencePath"),b=0;b<a.length;b++)this.dummyTackPath.position=a[b],this._calculateAngleBisectorPoint(),this.dummyTackPath.sendToBack(),this._popOutInterSectingBubbles()},renderRequiredView:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this.model,r=null,s=q.get("showEquation"),t=q.get("shapeCenterCircle");if(b=a.shape,c=q.get("foci1"),c.position=a.foci1,d=q.get("foci2"),d.position=a.foci2,g=null,h=null,i=q.get("blackStringRaster"),e=q.get("shapeCenter"),e.position=a.shapeCenter,f=q.get("thumbTack"),r=q.get("dummyThumbTack"),f.position=a.thumbTack,r.position=a.thumbTack,n=a.shapeCenterSnapX,o=a.shapeCenterSnapY,c.position.y===d.position.y?(k=a.majorAxis,l=a.minorAxis):c.position.x===d.position.x&&(k=a.minorAxis,l=a.majorAxis),m=this._getPointsOnCircumference(e.position,k/2,l/2),q.set("shape",b),q.set("foci1",c),q.set("foci2",d),q.set("shapeCenter",e),q.set("thumbTack",f),q.set("dummyThumbTack",r),q.set("tackToFoci1",a.tackToFoci1),q.set("tackToFoci2",a.tackToFoci2),q.set("center",a.center),q.set("majorAxis",a.majorAxis),q.set("minorAxis",a.minorAxis),q.set("circumferencePath",m),q.set("shapeCenterSnapX",n),q.set("shapeCenterSnapY",o),q.set("showPoppedBubbles",!0),this.paperScope2.view.draw(),this.generateBubbles(),"ellipse"===b){var u=q.get("purple"),v=q.get("red"),w=q.get("purpleStringBarRaster"),x=q.get("redStringBarRaster");u&&u.remove(),v&&v.remove(),w&&w.remove(),x&&x.remove(),this._generateString("purple",g,c.position,f.position,!1),this._generateString("red",h,d.position,f.position,!1),this._redrawBar()}else if("circle"===b){var y=q.get("black");y&&y.remove(),this._generateString("black",i,d.position,f.position,!1),j=q.get("tackToFoci1"),this._setRadiusLabel(j),this._displayCircleCenterCoordinates()}this._calculateAngleBisectorPoint(f.position,c.position,d.position),this._drawShape(),"ellipse"===b&&(this.ellipseDrawLabel(),p=new this.paperScope2.Point(e.position.x,e.position.y),t&&t.remove(),t=new this.paperScope2.Path.Circle({center:p,radius:4,strokeColor:"#555555",fillColor:"#555555"}),q.set("shapeCenterCircle",t),t.opacity=1,e.opacity=0),s&&"ellipse"===b&&this._showHideEllipseEquation(!0),s&&"circle"===b&&this._showHideCircleEquation(!0),this._bringShapeToFront(b),this.paperScope2.activate(),this._handleInitialAnimationEnd(),this._unbindEventsOnDraggables(c),this._unbindEventsOnDraggables(d),this._unbindEventsOnDraggables(e),this.paperScope2.view.draw()},renderString:function(a,b,c){var d;return d=new this.paperScope2.PointText({position:{x:b.x,y:b.y}}),d.content=a,d.strokeColor="#555555",d.strokeWidth=1,d.style={font:"verdana",fontSize:12,fillColor:"#555555"},d.rotate(c),d},_showHideEllipseEquation:function(a){if(a===!0){var b,c,d,e,f,g=this,h=g.model,i=this.$el,j=g.idPrefix,k=h.get("majorAxis"),l=h.get("minorAxis"),m=h.get("shapeCenterSnapX"),n=h.get("gridSizeXAxis"),o=h.get("shapeCenterSnapY"),p=h.get("shapeCenter"),q=h.get("thumbTack"),r=null,s=h.get("foci1"),t=h.get("foci2");k=Math.round(k/n/2*100)/100,l=Math.round(l/n/2*100)/100,s.position.y===t.position.y&&s.position.y===p.position.y&&s.position.y===q.position.y&&0===l?(r=30,i.find("#"+j+"degenerated-x").html("y"),i.find("#"+j+"degenerated-y").html(o),i.find("#"+this.idPrefix+"graph-normal-formula").hide(),i.find("#"+this.idPrefix+"degenerated-formula").show()):s.position.x===t.position.x&&s.position.x===p.position.x&&s.position.x===q.position.x&&0===l?(r=30,i.find("#"+j+"degenerated-x").html("x"),i.find("#"+j+"degenerated-y").html(m),i.find("#"+this.idPrefix+"graph-normal-formula").hide(),i.find("#"+this.idPrefix+"degenerated-formula").show()):(b=0>m?"(<em>x</em> - ("+m+"))<sup>2</sup>":"(<em>x</em> - "+m+")<sup>2</sup>",c=0>o?"(<em>y</em> - ("+o+"))<sup>2</sup>":"(<em>y</em> - "+o+")<sup>2</sup>",s.position.x===t.position.x&&(f=k,k=l,l=f),d=k+"<sup>2</sup>",e=l+"<sup>2</sup>",i.find("#"+j+"graph-first-numerator").html(b),i.find("#"+j+"graph-first-denominator").html(d),i.find("#"+j+"graph-second-numerator").html(c),i.find("#"+j+"graph-second-denominator").html(e),i.find("#"+this.idPrefix+"graph-normal-formula").show(),i.find("#"+this.idPrefix+"degenerated-formula").hide()),this._setEllipseEquationPosition(r),i.find("#"+this.idPrefix+"graph-formula").show(),h.set("equationEllipseB",l),h.set("equationEllipseA",k)}else this.$el.find("#"+this.idPrefix+"graph-formula").hide()},_setEllipseEquationPosition:function(a){var b=this.model,c=b.get("shapeCenter").position,d=c.x,e=c.y,f=b.get("activityAreaStartPoint"),g=f.xCoordinate,h=f.yCoordinate,i=(this.viewStaticData,a||30),j=this.$("#"+this.idPrefix+"graph-formula"),k=j.width(),l=j.height(),m=b.get("minorAxis"),n=b.get("majorAxis"),o=b.get("foci1").position.x,p=b.get("foci2").position.x,q=null,r=null,s=this.dummyEllipse,t=null,u=null,r=null,v=null,w=null,x=b.get("activityAreaEndPoint"),y=x.xCoordinate,z=x.yCoordinate,A=y>=d+k/2,B=z>=e+l/2,C=d-k/2>=g,D=e-l/2>=h,E=30,F=b.get("shape");"circle"===F&&(j=this.$("#"+this.idPrefix+"graph-circle-formula"),m=n,k=j.width(),l=j.height(),A=y>=d+k/2,B=z>=e+l/2,C=d-k/2>=g,D=e-l/2>=h),o===p&&(w=n,n=m,m=w),z>=e+m/2+i+l&&A&&C?j.css({top:e+m/2+i,left:d-k/2}):(u=e+E+l,q=new this.paperScope2.Path.Line({from:[d,u],to:[-500,u]}),r=s.getIntersections(q),r.length>0?(v=r[0].point.x,t=d-v):t=k/2-1,m/2>l+i&&t>=k/2&&A&&B&&C&&D&&z>=l+i+e?j.css({top:e+E,left:d-k/2}):e-m/2-i-l>=h&&A&&C?j.css({top:e-(m/2+i+l),left:d-k/2}):d-n/2-i-k>=g&&B&&D?j.css({top:e-l/2,left:d-n/2-(i+k)}):y>=d+n/2+i+k&&B&&D?j.css({top:e-l/2,left:d+n/2+i}):d-(i+k+n)>=g&&e-(i+l+m)>=h?j.css({top:e-(i+m+l/4),left:d-(i+n/2+k/4)}):d-(i+k+n)>=g&&z>=e+(i+l+m)?j.css({top:e+(i+m+l/4),left:d-(i+n/2+k/4)}):y>=d+(i+k+n)&&z>=e+(i+l+m)?j.css({top:e+(i+m+l/4),left:d+(i+n/2+k/4)}):y>=d+(i+k+n)&&e-(i+l+m)>=h?j.css({top:e-(i+m+l/4),left:d+(i+n/2+k/4)}):"circle"===F?e+i+l>z?j.css({top:e-(i+l),left:d-k/2}):j.css({top:e+E,left:d-k/2}):"ellipse"===F&&j.css({top:b.getOriginPosition().y-l/2,left:b.getOriginPosition().x-k/2}))},_showHideCircleEquation:function(a){if(a){var b,c,d,e=this,f=e.model,g=this.$el,h=e.idPrefix,i=f.get("gridSizeXAxis"),j=f.get("majorAxis")/2,k=(f.get("shapeCenter"),f.get("shapeCenterSnapX")),l=f.get("shapeCenterSnapY"),m=navigator.userAgent,n=m.substr(13,14);b=0>k?"(<em>x</em> - ("+k+"))<sup>2</sup>":"(<em>x</em> - "+k+")<sup>2</sup>",c=0>l?"(<em>y</em> - ("+l+"))<sup>2</sup>":"(<em>y</em> - "+l+")<sup>2</sup>",j=Math.round(j/i*10)/10,d=j+"<sup>2</sup>",g.find("#"+h+"graph-circle-first-numerator").html(b),g.find("#"+h+"graph-circle-second-numerator").html(c),g.find("#"+h+"graph-circle-r-square").html(d),f.set("circleRadius",j),this._setEllipseEquationPosition(),
g.find("#"+this.idPrefix+"graph-circle-formula").show(),MathInteractives.Common.Utilities.Models.BrowserCheck.isFirefox&&n&&("Windows NT 6.1"===n||"Windows NT 6.2"===n)&&(this.$(".graph-circle-plus").css("margin-top","4px"),this.$(".graph-circle-equal-to").css("margin-top","4px"))}else this.$el.find("#"+this.idPrefix+"graph-circle-formula").hide()},_setCircleEquationPosition:function(){var a=this.model,b=a.get("shapeCenter").position,c=b.x,d=b.y,e=a.get("activityAreaStartPoint"),f=e.xCoordinate,g=e.yCoordinate,h=this.viewStaticData,i=h.PADDING_FROM_SHAPE,j=h.HEIGHT_OF_CIRCLE_EQUATION,k=h.WIDTH_OF_CIRCLE_EQUATION,l=a.get("majorAxis"),m=null,n=null,o=a.get("dashedShape"),p=null,q=null,n=null,r=null,s=a.get("activityAreaEndPoint"),t=s.xCoordinate,u=s.yCoordinate,v=t>=c+k/2,w=u>=d+j/2,x=c-k/2>=f,y=d-j/2>=g,z=this.$("#"+this.idPrefix+"graph-circle-formula");u>=d+l+i+j&&v&&x?z.css({top:d+l+i,left:c-k/2}):(q=d+i+j,m=new this.paperScope2.Path.Line({from:[c,q],to:[0,q]}),n=o.getIntersections(m),n.length>0?(r=n[0].point.x,p=c-r):p=k/2-1,l>j+i&&p>=k/2&&v&&w&&x&&y?z.css({top:d+i,left:c-k/2}):d-l-i-j>=g&&v&&x?z.css({top:d-l-i,left:c-k/2}):(c-l-i-k>=f&&w&&y&&z.css({top:d-j/2,left:c-l-i}),t>=c+l+i+k&&w&&y&&z.css({top:d-j/2,left:c+l+i})))},_generateString:function(a,b,c,d,e){var f,g,h,i=this.model,j=i.get("shape"),k=(this.paperScope2,this._getStringAngle(c,d)),l=[{raster:b,startingPoint:c,endingPoint:d,width:5,height:5,angle:k,isRatioBar:e,lineColor:a}];"ellipse"===j?"purple"==a?(f=this._drawLine(l),i.set("purple",f)):"red"==a&&(g=this._drawLine(l),i.set("red",g)):"circle"===j&&"black"==a&&(h=this._drawLine(l),h.sendToBack(),i.set("black",h))},_getStringAngle:function(a,b){var c=b.subtract(a);return c.angle},animate:function(){this.paperScope2.activate();var a=this.model,b=a.get("circumferencePath"),c=this,d=a.get("shape"),e=a.get("foci1"),f=a.get("foci2"),g=a.get("shapeCenter"),h=a.get("thumbTack"),i=null,j=a.get("shapeCenterCircle"),k=a.get("dummyThumbTack");this.lastIndexChanged=!1,a.set("restrictMovementAlongCircumference",!1),a.set("isFociMovable",!0),a.set("currentPointIndex",null),a.set("positionCounter",0),a.set("lastIndex",b.length),a.set("showPopupOnTryAnother",!0),this._unbindEventsOnDraggables(e),this._unbindEventsOnDraggables(f),this._unbindEventsOnDraggables(g),this._unbindEventsOnDraggables(h),this._unbindEventsOnDraggables(k),this.isAnimating=!0,this.isRedCircleShown=null,c._setTackPosition(),this.animateFirstTime=!0,this.redBarLoded=!1,a.set("animationStarted",!0),a.set("isCenterMovable",!1),a.set("isFociMovable",!1),a.set("isThumbTackMovable",!1),"ellipse"===d&&(i=new this.paperScope2.Point(g.position.x,g.position.y),j&&j.remove(),j=new this.paperScope2.Path.Circle({center:i,radius:4,strokeColor:"#555555",fillColor:"#555555"}),a.set("shapeCenterCircle",j),j.opacity=1,g.opacity=0),c._animateAlongCircumference()},setPreviousPositionToThumbTack:function(a,b){var c=this.model,d=(c.get("shape"),c.get("thumbTack")),e=c.get("dummyThumbTack");"undefined"!=typeof a&&null!==a&&(d.position=a,e.position=a,this.model.set("thumbTack",d),this.model.set("dummyThumbTack",e)),b===!0&&(this.draggableElement=d,this._showShapeMouseDragFeatures({point:new this.paperScope2.Point({x:d.position.x,y:d.position.y})}),this.draggableElement=null),this._bringShapeToFront(this.model.get("shape"))},_setTackPosition:function(a){var b=this.model.get("thumbTack"),c=a||b.position;this.dummyTackPath.position=[c.x-6,c.y],this.dummyTackPath.sendToBack()},_popOutInterSectingBubbles:function(){var a=this,b=a.model,c=b.get("intersectBubblesArray")||[],d=(c.length,null),e=null,f=a.viewStaticData,g=f.RADIUS_OF_BUBBLES,h=(f.POSITION_OF_BUBBLE,this.dummyTackPath),i=(h.position,null),j=[],k=null;b.get("removeGeneratedBubbles");for(i in c)e=c[i],e.getIntersections(h).length>0&&(d=a._getBubbleRadius(e),j=d===g.largeBubbleRadius?this.largeAnimateBubblesRasters:d===d.middleBubbleRadius?this.middleAnimateBubblesRasters:this.smallAnimateBubblesRasters,c.splice(i,1),b.set("intersectBubblesArray",c),a.intersectBubblesArray=c,k=e.position,a._popBubble(k,j,e.parent.children[1]))},_popBubble:function(a,b,c){var d=this,e=b[0].clone(),f=b[1].clone(),g=b[2].clone(),h=this.viewStaticData.CUSTOM_EVENTS,i=d.paperScope2.view,j=null,k=e.bounds,l=(k.width,k.height,f.bounds),m=(l.width,l.height,g.bounds),n=(m.width,m.height,c.bounds),o=!0,p=!0,q=(n.height,n.width);j=setInterval(function(){c.bounds.width>8*q/10&&p?c.scale(.8):(p=!1,o||(c.parent.remove(),clearInterval(j)),c.bounds.width<q&&o?c.scale(1.2):(o=!1,p=!0)),i.draw()},30),d.trigger(h.bubblePopAnimationStart)},_getBubbleRadius:function(a){return a.bounds.height/2},_redrawBar:function(){var a=this.model,b=a.get("purpleBar"),c=a.get("redBar");a.get("foci1"),a.get("foci2"),a.get("thumbTack");b&&b.remove(),c&&this.redBarLoded===!1&&c.remove(),this._generateBar()},_generateBar:function(){this.paperScope2.activate();var a,b,c,d,e,f,g,h,i,j,k=this.paperScope2,l=551,m=this.model,n=null,o=null,p=6;a=Math.floor(m.get("tackToFoci1")),b=Math.floor(m.get("tackToFoci2")),d=m.getOriginPosition(),e=m.get("majorAxis"),c=Math.floor(d.x-e/2),g=Math.floor(c+e),this.redBarLoded===!1&&(f=[{raster:o,startingPoint:new k.Point(c,l),endingPoint:new k.Point(g,l),width:p,height:10,angle:0,isRatioBar:!0,isRatioBar1:!0,isRatioBar2:!0,ratioBar1Height:23,ratioBar1Width:1,ratioBar2Height:23,ratioBar2Width:1,lineColor:"red"}],j=this._drawLine(f),m.set("redBar",j)),h=c+a,f=[{raster:n,startingPoint:new k.Point(c,l),endingPoint:new k.Point(h,l),width:p,height:10,angle:0,isRatioBar:!0,isRatioBar1:!1,isRatioBar2:!0,ratioBar2Height:23,ratioBar2Width:3,lineColor:"purple"}],i=this._drawLine(f),m.set("purpleBar",i)},_redrawStrings:function(){var a=this.model,b=a.get("purple"),c=a.get("red"),d=a.get("black"),e=a.get("foci1"),f=a.get("foci2"),g=a.get("thumbTack"),h=null,i=null,j=a.get("blackStringRaster"),k=a.get("shape",k),l=a.get("shapeCenter",l),m=new this.paperScope2.Point(0,0);g.position.x,g.position.y,l.position.x,l.position.y;m.x=g.position.x,m.y=g.position.y,"ellipse"===k?(b&&b.remove(),c&&c.remove(),this._generateString("purple",h,e.position,m,!1),this._generateString("red",i,f.position,m,!1)):"circle"===k&&(d&&d.remove(),this._generateString("black",j,l.position,g.position,!1))},_drawDashedLine:function(a,b){var c=null,d=this.paperScope2;return c=new d.Path.Line(a,b),c.strokeColor="#555555",c.dashArray=[3,5],c},getImageURLFromSprite:function(a){var b=null;return"red"===a?b=this.getSpritePartBase64URL("ellipse-explorer",0,15,1100,5):"purple"===a?b=this.getSpritePartBase64URL("ellipse-explorer",0,0,1100,5):"Barpurple"===a?b=this.getSpritePartBase64URL("ellipse-explorer",0,30,1500,10):"Barred"===a?b=this.getSpritePartBase64URL("ellipse-explorer",0,50,1856,10):"black"===a?b=this.getSpritePartBase64URL("circle-explorer",0,0,1100,5):"largeBubble"===a?b=this.getSpritePartBase64URL("explore-shapes",0,0,44,44):"smallBubble"===a?b=this.getSpritePartBase64URL("explore-shapes",96,0,24,24):"middleBubble"===a?b=this.getSpritePartBase64URL("explore-shapes",54,0,32,32):"animateLargeBubble1"===a?b=this.getSpritePartBase64URL("explore-shapes",130,0,44,44):"animateLargeBubble2"===a?b=this.getSpritePartBase64URL("explore-shapes",184,0,44,44):"animateLargeBubble3"===a?b=this.getSpritePartBase64URL("explore-shapes",238,0,44,44):"animateSmallBubble1"===a?b=this.getSpritePartBase64URL("explore-shapes",130,96,24,24):"animateSmallBubble2"===a?b=this.getSpritePartBase64URL("explore-shapes",164,96,24,24):"animateSmallBubble3"===a?b=this.getSpritePartBase64URL("explore-shapes",198,96,24,24):"animateMiddleBubble1"===a?b=this.getSpritePartBase64URL("explore-shapes",130,54,32,32):"animateMiddleBubble2"===a?b=this.getSpritePartBase64URL("explore-shapes",172,54,32,32):"animateMiddleBubble3"===a?b=this.getSpritePartBase64URL("explore-shapes",214,54,32,32):"arrowCenter"===a&&(b=this.getSpritePartBase64URL("explore-shapes",232,96,21,21)),b},renderImagePattern:function(a,b,c,d){if("undefined"==typeof this.rasterPattern[c]){var e=this.getImageURLFromSprite(c);this.rasterPattern[c]=new this.paperScope2.Raster(e),this.rasterPattern[c].opacity=0}var f=new this.paperScope2.Path({strokeColor:"red"}),g={x:a.x,y:a.y+d},h={x:b.x,y:b.y+d},i=this.rasterPattern[c].clone();f.add(a),f.add(b),f.add(h),f.add(g),f.closed=!0,i.opacity=1,i.position=a,i.position.y=a.y+d/2,i.position.x=a.x+this.viewStaticData.ADD_X_POSITION[c];var j=new this.paperScope2.Group([f,i]);return j.clipped=!0,j.position=i.position,j.position.y-=d/2,j},_drawLine:function(a){var b,c,d,e,f,g,h,i=(a[0].raster,this.paperScope2),j=0,k=a[0].startingPoint.x,l=a[0].startingPoint.y,b=(a[0].endingPoint.x,a[0].endingPoint.y,a[0].startingPoint.subtract(a[0].endingPoint)),m=a[0].height,n=null,o=a[0].isRatioBar;a[0].width;if(c=Math.floor(b.length),o===!0){j=k+c,n=this.renderImagePattern({x:k,y:l},{x:j,y:l},"Bar"+a[0].lineColor,10);var p,q,r,s,t=null;d=a[0].ratioBar1Height,e=a[0].ratioBar2Height,f=a[0].ratioBar1Width,g=a[0].ratioBar2Width,a[0].isRatioBar1===!0&&(t=new this.paperScope2.Group,h=(d-m)/2+m/2,p=new i.Point(k-f,l-h),q=new i.Point(k-f,l-h+d),r=new i.Path.Line(p,q),r.strokeColor="black",r.strokeWidth=f,t.addChild(r),t.moveAbove(n),n=new this.paperScope2.Group([n,t])),a[0].isRatioBar2===!0&&(t=new this.paperScope2.Group,h=(e-m)/2+m/2,p=new i.Point(j,l-h),q=new i.Point(j,l-h+e),s=new i.Path.Line(p,q),s.strokeColor="black",s.strokeWidth=g,t.addChild(s),t.moveAbove(n),n=new this.paperScope2.Group([n,t]))}else n=this.renderImagePattern({x:k,y:l},{x:k+c,y:l},a[0].lineColor,6);return n.rotate(a[0].angle,new i.Point(k,l)),o!==!0&&n.moveAbove(this.model.get("thumbTack")),n},_getPointDistance:function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},_loadCanvas:function(){var a={strokeColor:"#aaaaaa",dashArray:[2,2],strokeWidth:2},b=this.paperScope2,c=new b.Point(0,0);this.model.get("shape");this.focusRect=new this.paperScope2.Path.RegularPolygon(c,4,30),this.focusRect.style=a,this.focusRect.opacity=0,this._initAccessibility(),this._bindAccessibilityListeners(),this.afterFirstAnimate=!0},_initAccessibility:function(){var a={canvasHolderID:this.el.id+"-explore-graph-acc-container",paperItems:[],paperScope:this.paperScope2,manager:this.manager,player:this.player};this.canvasAcc=MathInteractives.global.CanvasAcc.intializeCanvasAcc(a),this.updateCanvasElement(!0)},updateCanvasElement:function(a){(a=!0)?this.canvasAcc.updatePaperItems(this.getPaperObjects()):this.canvasAcc.updatePaperItems(),this.currentIndex=null},getPaperObjects:function(){var a=this.model,b=a.get("shape"),c=null,d=null,e=null,f=null,g=a.get("isFociMovable"),h=a.get("isCenterMovable"),i=a.get("isThumbTackMovable"),j=[];switch(b){case"ellipse":return h===!0&&(e=a.get("shapeCenter"),j.push(e)),g===!0&&(c=a.get("foci1"),d=a.get("foci2"),j.push(c,d)),i===!0&&(f=a.get("thumbTack"),j.push(f)),j;case"circle":return h===!0&&(e=a.get("shapeCenter"),j.push(e)),i===!0&&(f=a.get("thumbTack"),j.push(f)),j}},_bindAccessibilityListeners:function(){var a=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_KEY_EVENTS,b=MathInteractives.Common.Player.Models.CanvasAcc.CANVAS_EVENTS,c=$("#"+this.el.id+"-explore-graph-acc-container"),d=this,e=null,f=null,e=null;c.on(a.TAB,function(a,b){f=null,e=b.item,f=[a,b],d.currentItem=e,d.previousItem&&(d.previousItem.fire("mouseleave",a),d.previousItem.fire("mouseup",a)),d.previousItem=e,d.focusRect.position=e.position,d.focusRect.visible=!0,d.focusRect.opacity=1,d.trigger(d.viewStaticData.CUSTOM_EVENTS.tabKeyPressed,f)}),c.on(a.SPACE,function(a,b){f=null,f=[a,b],e=b.item,d.currentItem=e,d.previousItem=e,d.focusRect.position=e.position,d.focusRect.visible=!0,d.focusRect.opacity=1,d.trigger(d.viewStaticData.CUSTOM_EVENTS.spaceKeyPressed,f)}),c.on(b.FOCUS_OUT,function(a,b){f=null,f=[a,b],e=b.item,d.previousItem&&(d.previousItem.fire("mouseleave",a),d.previousItem.fire("mouseup",a)),d.previousItem=null,d.focusRect.visible=!1,d.focusRect.opacity=0,d.trigger(d.viewStaticData.CUSTOM_EVENTS.focusOut,f),d.paperScope2.view.draw()}),c.off(a.ARROW).on(a.ARROW,$.proxy(this.arrowKeyPressed,this)),c.off(a.ROTATE_CLOCKWISE).on(a.ROTATE_CLOCKWISE,$.proxy(this.rotateClockWise,this)),c.off(a.ROTATE_ANTI_CLOCKWISE).on(a.ROTATE_ANTI_CLOCKWISE,$.proxy(this.rotateAntiClockWise,this))},arrowKeyPressed:function(a,b){var c=[a,b],d=this,e=b.item;d.draggableElement=e,d.trigger(d.viewStaticData.CUSTOM_EVENTS.arrowKeyPressed,c),d.paperScope2.view.draw()},rotateClockWise:function(a,b){var c=[a,b],d=this,e=b.item,f=e.position,g=d.model.get("circumferencePath"),h=null,i=this.model.get("isRotate"),j=this.model.get("thumbTack");d.model.get("gridSizeXAxis");if(d.draggableElement=e,e===j&&i===!0){if(null===this.currentIndex&&(this.currentIndex=d._getCurrentPointIndex(f,g)),h=this.currentIndex,a.target=e,a.target.name=e.name,a.event=a,a.event.which=1,0>h-4)switch(h-=0){case 0:h=356;break;case 1:h=357;break;case 2:h=358;break;case 3:h=359}a.point=new d.paperScope2.Point(g[h-4]),this.currentIndex=h-4,d._showShapeMouseDragFeatures(a),d._showShapeMouseUpFeatures(a),e.fire("mousedown",a),e.fire("mousedrag",a),d.paperScope2.view.draw(),d.trigger(d.viewStaticData.CUSTOM_EVENTS.rotateClockWise,c)}},rotateAntiClockWise:function(a,b){var c=[a,b],d=this,e=b.item,f=e.position,g=d.model.get("circumferencePath"),h=null,i=this.model.get("isRotate"),j=this.model.get("thumbTack");d.model.get("gridSizeXAxis");if(d.draggableElement=e,e===j&&i===!0){if(null===this.currentIndex&&(this.currentIndex=d._getCurrentPointIndex(f,g)),h=this.currentIndex,a.target=e,a.target.name=e.name,a.event=a,a.event.which=1,h+4>=360)switch(h=360-h){case 0:h=-4;break;case 1:h=-1;break;case 2:h=-2;break;case 3:h=-3}a.point=new d.paperScope2.Point(g[h+4]),this.currentIndex=h+4,d._showShapeMouseDragFeatures(a),d._showShapeMouseUpFeatures(a),e.fire("mousedown",a),e.fire("mousedrag",a),d.paperScope2.view.draw(),d.trigger(d.viewStaticData.CUSTOM_EVENTS.rotateAntiClockWise,c)}}},{ADD_X_POSITION:{red:500,purple:500,Barred:900,Barpurple:700,black:400},ANIMATION_DURATION:4e3,CUSTOM_EVENTS:{animationCompleate:"animationCompleate",bubblePopAnimationStart:"bubblePopAnimationStart",bubblePopAnimationEnd:"bubblePopAnimationEnd",bubblePopulationAnimationEnd:"bubblePopulationAnimationEnd",bubblePopulationAnimationStart:"bubblePopulationAnimationStart",onRedCircle:"onRedCircleShown",onInsideCollisionCircle:"onInsideCollisionCircle",initializationDone:"initializationDone",arrowKeyPressed:"arrowKeyPressed",tabKeyPressed:"tabKeyPressed",spaceKeyPressed:"spaceKeyPressed",rotateClockWise:"rotateClockWise",rotateAntiClockWise:"rotateAntiClockWise",focusOut:"focusOut"},RADIUS_OF_BUBBLES:{largeBubbleRadius:19,smallBubbleRadius:11,middleBubbleRadius:15},HEIGHT_OF_ELLIPSE_EQUATION:65,WIDTH_OF_ELLPSE_EQUATION:240,HEIGHT_OF_CIRCLE_EQUATION:50,WIDTH_OF_CIRCLE_EQUATION:240,PADDING_FROM_SHAPE:30,POSITION_OF_BUBBLE:{largeBubble:[0,0,44,44],smallBubble:[96,0,24,24],middleBubble:[54,0,32,32],largeAnimateBubbles:{bubble1:[130,0,44,44],bubble2:[184,0,44,44],bubble3:[238,0,44,44]},middleAnimateBubbles:{bubble1:[130,54,32,32],bubble2:[172,54,32,32],bubble3:[214,54,32,32]},smallAnimateBubbles:{bubble1:[130,96,24,24],bubble2:[164,96,24,24],bubble3:[198,96,24,24]}},createExplorerShapeView:function(a){var b=a.model,c="#"+a.contanierId,d=new MathInteractives.Common.Components.Views.ExplorerShape({el:c,model:b});return d}})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.explorerShapeEllipse=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-formula" class="graph-formula">\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-normal-formula">\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-first-equation" class="graph-first-equation">\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-first-numerator" class="graph-first-numerator">\r\n    <sup>2</sup>\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-bar" class="graph-bar"></div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-first-denominator" class="graph-first-denominator">\r\n  <sup>2</sup>\r\n    </div>\r\n  </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-plus" class="graph-plus"> + </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-second-equation" class="graph-second-equation">\r\n\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-second-numerator" class="graph-second-numerator">\r\n\r\n  <sup>2</sup>\r\n    </div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-bar" class="graph-bar"></div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-second-denominator" class="graph-second-denominator">\r\n   <sup>2</sup>\r\n    </div>\r\n  </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-equal-to-row" class="graph-equal-to">=</div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-one-row" class="graph-one">1</div>\r\n  </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'degenerated-formula" class="degenerated-formula">\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'degenerated-x" class="degenerated-x"></div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'degenerated-equal-to-row" class="degenerated-equal-to-row">=</div>\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'degenerated-y" class="degenerated-y"></div>\r\n  </div>\r\n  </div>\r\n</div>\r\n'})}(),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.explorerShapeCircle=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-circle-formula" class="graph-circle-formula">\r\n\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-circle-first-equation" class="graph-circle-first-equation">\r\n\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-circle-first-numerator" class="graph-circle-first-numerator">\r\n     <sup>2</sup>\r\n    </div>\r\n  </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-circle-plus" class="graph-circle-plus"> + </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-circle-second-equation" class="graph-circle-second-equation">\r\n\r\n    <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-circle-second-numerator" class="graph-circle-second-numerator">\r\n     <sup>2</sup>\r\n    </div>\r\n  </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-circle-equal-to" class="graph-circle-equal-to"> = </div>\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'graph-circle-r-square" class="graph-circle-r-square">\r\n    <sup>2</sup>\r\n  </div>\r\n</div>'})}();