!function(){"use strict";MathInteractives.Common.Components.Models.Ruler=Backbone.Model.extend({defaults:{player:null,manager:null,filePath:null,idPrefix:null,containerId:null,rulerHeight:null,rulerWidth:null,rotateByDefault:!0,fontColor:null,fontSize:10,backgroundColor:null,lineLength:null,allowmmScale:!1,tickInterVal:1},initialize:function(){},getRulerHeight:function(){return this.get("rulerHeight")+"px"},getRulerWidth:function(){return this.get("rulerWidth")+"px"},getIdPrefix:function(){return this.get("idPrefix")},getLineLength:function(){return this.get("lineLength")},getBackgroundColor:function(){return this.get("backgroundColor")},getFontColor:function(){return this.get("fontColor")},getFontSize:function(){return this.get("fontSize")+"px"},getAllowmmScale:function(){return this.get("allowmmScale")},getTickInterVal:function(){return this.get("tickInterVal")}})}(window.MathInteractives),function(){"use strict";MathInteractives.Common.Components.Views.Ruler=MathInteractives.Common.Player.Views.Base.extend({$ruler:null,elCenter:null,eventPoint:null,lastEventPoint:null,degree:0,origin:null,clicking:!1,$pivotLeft:null,$pivotRight:null,manager:null,player:null,filePath:null,fontColor:null,backgroundColor:null,rotateByDefault:!0,rulerHeight:null,rulerWidth:null,idPrefix:null,fontSize:null,allowmmScale:!1,lineLength:null,tickInterVal:null,initialize:function(){this.$ruler=this.$el,this.manager=this.model.get("manager"),this.player=this.model.get("player"),this.filePath=this.model.get("filePath"),this.idPrefix=this.model.getIdPrefix(),this.fontColor=this.model.getFontColor(),this.fontSize=this.model.getFontSize(),this.allowmmScale=this.model.getAllowmmScale(),this.backgroundColor=this.model.getBackgroundColor(),this.lineLength=this.model.getLineLength(),this.tickInterVal=this.model.getTickInterVal(),this.rotateByDefault=this.model.get("rotateByDefault"),this.rulerHeight=this.model.getRulerHeight(),this.rulerWidth=this.model.getRulerWidth(),this._render(),this._attachEvents(),this._makeRulerDraggable()},_render:function(){var a,b,c,d,e=null,f=null,g=0,h=this.lineLength,i=null,j=null,k=1,l=this.tickInterVal;for($("<canvas>").attr({id:this.idPrefix+"myCanvas",height:this.rulerHeight,width:this.rulerWidth}).addClass("ruler-container").appendTo(this.$ruler),e=document.getElementById(this.idPrefix+"myCanvas"),f=this.$("#"+this.idPrefix+"myCanvas"),a=e.getContext("2d"),f.css({"background-color":this.backgroundColor}),i=e.width/(h+1),j=i-this.model.get("fontSize")/2+2,a.beginPath(),b=0;b<e.width;b+=i)for(g++,a.moveTo(b+i,20),a.lineTo(b+i,0),a.font=""+this.fontSize+" Arial",a.fillStyle=this.fontColor,g>=l&&g%l===0&&a.fillText(g,b+j,35),c=b;Math.round(c)<Math.round(b+i);c+=i/2)if(0===c?(a.moveTo(c+i/2,13),a.lineTo(c+i/2,0)):(a.moveTo(2*c+i/2,13),a.lineTo(2*c+i/2,0)),this.allowmmScale)for(d=c;Math.round(d)<Math.round(c+i/2);d+=i/10)a.moveTo(d+i/10,7),a.lineTo(d+i/10,0),k++,k%4===0&&(a.moveTo(2*(d+i/10),7),k++);a.stroke(),$("<div>",{"class":"ruler-div",id:this.idPrefix+"rulerDiv",height:this.rulerHeight,width:this.rulerWidth,"data-items":""}).appendTo(this.$ruler),this.rotateByDefault===!0&&($("<div>",{"class":"pivot-point"}).appendTo(this.$ruler),$("<div>",{"class":"pivot-point"}).appendTo(this.$ruler),this.$pivotLeft=$(this.$(".pivot-point")[0]),this.$pivotRight=$(this.$(".pivot-point")[1]),$("<div>",{"class":"rotate-left-handler ruler-handle"}).appendTo(this.$pivotLeft),$("<div>",{"class":"rotate-right-handler ruler-handle"}).appendTo(this.$pivotRight),this.$ruler.css({height:this.rulerHeight,width:this.rulerWidth}),this.$pivotLeft.css({top:-(this.$ruler.height()/2+this.$pivotLeft.height()/2+5)+"px",left:-(this.$pivotLeft.width()/2)+"px"}),this.$pivotRight.css({top:-(this.$ruler.height()/2+this.$pivotLeft.height()/2+5)+"px",left:this.$ruler.width()-this.$pivotRight.width()/2-30+"px"}))},_attachEvents:function(){var a=this,b=this.$(".pivot-point"),c=$("#"+this.idPrefix+"myCanvas"),d=$("#"+this.idPrefix+"rulerDiv"),e=MathInteractives.Common.Utilities.Models.Utils;b.on("mouseenter",$.proxy(a._pivotMouseEnterHandler,a)),d.on("mouseenter",$.proxy(a._rulerMouseEnterHandler,a)),b.on("mouseleave",$.proxy(a._pivotMouseLeaveHandler,a)),d.on("mousedown",$.proxy(a._makeRulerDraggable,a)),c.on("mousedown",$.proxy(a._makeRulerDraggable,a)),this.$el.on({mousedown:$.proxy(this.disallowRotate,this)}),b.on({mousedown:$.proxy(this._allowRulerToRotate,a),mousemove:$.proxy(this._startRotateRuler,a)}),e.EnableTouch(this.$el,{specificEvents:e.SpecificEvents.DRAGGABLE}),e.EnableTouch(b,{specificEvents:e.SpecificEvents.DRAGGABLE+e.SpecificEvents.MOUSEMOVE}),e.EnableTouch(d,{specificEvents:e.SpecificEvents.DRAGGABLE})},_allowRulerToRotate:function(a){a.preventDefault();var b,c,d,e,f,g,h,i,j,k,l=this,m=MathInteractives.Common.Utilities.Models.BrowserCheck;f=this.$ruler.offset().top,g=this.$ruler.offset().left,this.clicking=!0,a.stopPropagation(),l.$el.draggable("option","disabled",!0),m.isMobile&&(a.clientX=a.originalEvent.touches[0].clientX,a.clientY=a.originalEvent.touches[0].clientY),this.eventPoint={x:a.clientX,y:a.clientY},d=l.$el.css("transform"),null===d&&(m.isIE||m.isIE11)&&(d=this.$el.css("-ms-transform")),null===d&&m.isFirefox&&(d=this.$el.css("-moz-transform")),null===d&&(m.isChrome||m.isSafari)&&(d=this.$el.css("-webkit-transform")),$(a.target).hasClass("rotate-left-handler")||$(a.target).find(".ruler-handle").hasClass("rotate-left-handler")?(this.elCenter={x:this.$pivotRight.offset().left+this.$pivotRight.outerWidth()/2,y:this.$pivotRight.offset().top+this.$pivotRight.outerHeight()/2},e={x:this.$ruler.width(),y:this.$ruler.height()/2}):(this.elCenter={x:this.$pivotLeft.offset().left+this.$pivotLeft.outerWidth()/2,y:this.$pivotLeft.offset().top+this.$pivotLeft.outerHeight()/2},e={x:0,y:this.$ruler.height()/2}),b=e.x+"px",c=e.y+"px",this.$ruler.css({"transform-origin":b+" "+c,"-ms-transform-origin":b+" "+c,"-moz-transform-origin":b+" "+c,"-webkit-transform-origin":b+" "+c}),i=f-this.$ruler.offset().top,h=g-this.$ruler.offset().left,j=this.$ruler.offset().left+h,k=this.$ruler.offset().top+i,this.$ruler.offset({top:k,left:j})},disallowRotate:function(a){this.clicking=!1},_startRotateRuler:function(a){var b,c,d,e,f,g,h=MathInteractives.Common.Utilities.Models.BrowserCheck;this.clicking===!0&&(this.lastEventPoint=this.eventPoint,h.isMobile&&(a.clientX=a.originalEvent.touches[0].clientX,a.clientY=a.originalEvent.touches[0].clientY),this.eventPoint={x:a.clientX,y:a.clientY},b=this.$ruler,c=this.elCenter,d=180*Math.atan2(this.lastEventPoint.y-c.y+$(window).scrollTop(),this.lastEventPoint.x-c.x+$(window).scrollLeft())/Math.PI,e=180*Math.atan2(a.clientY-c.y+$(window).scrollTop(),a.clientX-c.x+$(window).scrollLeft())/Math.PI,f=e-d,g=(Number(this.degree)+f+360)%360,b.css({transform:"rotate("+g+"deg)","-ms-transform":"rotate("+g+"deg)","-moz-transform":"rotate("+g+"deg)","-webkit-transform":"rotate("+g+"deg)"}),this.degree=g)},_pivotMouseEnterHandler:function(a){$(a.currentTarget).find(".ruler-handle").addClass("ruler-handle-hover")},_pivotMouseLeaveHandler:function(a){$(a.currentTarget).find(".ruler-handle").removeClass("ruler-handle-hover")},_rulerMouseEnterHandler:function(a){$(a.currentTarget).css({cursor:"pointer"})},_makeRulerDraggable:function(){var a=MathInteractives.Common.Utilities.Models.Utils;this.$ruler.draggable({}),a.EnableTouch(".ui-draggable",{specificEvents:a.SpecificEvents.DRAGGABLE})},_stopRotateRuler:function(a){$(document).off("mousemove.rotate-ruler touchmove.rotate-ruler"),$(document).off("mouseup.rotate-ruler touchend.rotate-ruler"),this.eventPoint,this.elCenter,this.lastEventPoint=null}},{createRuler:function(a){var b;if(a){b="#"+a.idPrefix+a.containerId;var c=new MathInteractives.Common.Components.Models.Ruler(a),d=new MathInteractives.Common.Components.Views.Ruler({el:b,model:c});return d}}}),MathInteractives.global.Ruler=MathInteractives.Common.Components.Views.Ruler}(window.MathInteractives),function(){var a=Handlebars.template,b=MathInteractives.Common.Components.templates=MathInteractives.Common.Components.templates||{};b.ruler=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='\ufeff<div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'ruler-outer " class="ruler-outer-common-component">\r\n  <div id="',(g=c.idPrefix)?f=g.call(b,{hash:{},data:e}):(g=b&&b.idPrefix,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'ruler1" class="ruler-user-container">\r\n  </div>\r\n</div>\r\n'})}();